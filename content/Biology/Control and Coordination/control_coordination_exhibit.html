<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Control and Coordination - The Biology of Response and Movement</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tween.js/18.6.4/tween.umd.js"></script>

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #8e44ad 0%, #3498db 100%);
            color: white;
            overflow: hidden;
            position: relative;
            height: 100vh;
        }

        /* Animated Background */
        .bg-animation {
            position: fixed;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: 0;
            opacity: 0.1;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 320"><path fill="%23ffffff" fill-opacity="0.2" d="M0,96L48,112C96,128,192,160,288,186.7C384,213,480,235,576,213.3C672,192,768,128,864,128C960,128,1056,192,1152,197.3C1248,203,1344,149,1392,122.7L1440,96L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z"></path></svg>') repeat-x;
            animation: wave 22s linear infinite;
        }

        @keyframes wave {
            0% { background-position-x: 0; }
            100% { background-position-x: 1440px; }
        }

        /* Museum Interface - Compact Header */
        .museum-header {
            position: absolute;
            top: 10px;
            left: 20px;
            text-align: left;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            padding: 10px 18px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .museum-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 4px;
            background: linear-gradient(45deg, #8e44ad, #f39c12);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: titleGlow 3s ease-in-out infinite;
        }

        @keyframes titleGlow {
            0%, 100% { filter: brightness(1); }
            50% { filter: brightness(1.2); }
        }

        .exhibit-subtitle {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.8);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .neural-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            background: #f39c12;
            border-radius: 50%;
            animation: neural-pulse 1.5s ease-in-out infinite;
        }

        @keyframes neural-pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.4); opacity: 0.6; }
        }

        /* Journey Navigation - Enhanced */
        .journey-navigation {
            position: absolute;
            bottom: 20px;
            left: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            padding: 15px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            max-width: 340px;
        }

        .journey-title {
            font-size: 14px;
            font-weight: 600;
            color: #8e44ad;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .journey-steps {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }

        .journey-btn {
            background: rgba(142, 68, 173, 0.2);
            border: 1px solid rgba(142, 68, 173, 0.4);
            color: white;
            padding: 6px 10px;
            border-radius: 20px;
            font-size: 11px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 4px;
            white-space: nowrap;
        }

        .journey-btn:hover {
            background: rgba(142, 68, 173, 0.3);
            border-color: #8e44ad;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(142, 68, 173, 0.3);
        }

        .journey-btn.active {
            background: linear-gradient(135deg, #8e44ad, #9b59b6);
            border-color: #8e44ad;
            box-shadow: 0 0 20px rgba(142, 68, 173, 0.5);
            animation: pulse 2s infinite;
        }

        .journey-btn.completed {
            background: rgba(243, 156, 18, 0.3);
            border-color: #f39c12;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        /* 3D Model Container */
        .model-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 0;
            overflow: hidden;
            border: none;
            z-index: 100;
        }

        .sketchfab-embed-wrapper {
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #8e44ad 0%, #3498db 100%);
        }

        .sketchfab-embed-wrapper iframe {
            width: 100%;
            height: 100%;
            border: none;
            border-radius: 0;
        }

        /* Information Panel - Enhanced */
        .info-panel {
            position: absolute;
            top: 70px;
            right: 20px;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(25px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 16px;
            padding: 24px;
            width: 380px;
            max-height: calc(100vh - 140px);
            z-index: 800;
            overflow-y: auto;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }

        .info-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        }

        .info-icon {
            font-size: 28px;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        .info-title {
            flex: 1;
        }

        .info-title h2 {
            font-size: 18px;
            color: #8e44ad;
            margin-bottom: 4px;
        }

        .info-subtitle {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.7);
        }

        .info-content {
            color: rgba(255, 255, 255, 0.9);
            font-size: 14px;
            line-height: 1.6;
        }

        /* Progress Tracker */
        .progress-tracker {
            background: linear-gradient(135deg, rgba(142, 68, 173, 0.1), rgba(243, 156, 18, 0.1));
            border: 1px solid rgba(142, 68, 173, 0.3);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 20px;
        }

        .progress-header {
            font-size: 13px;
            font-weight: 600;
            color: #8e44ad;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .progress-percentage {
            font-size: 18px;
            color: #f39c12;
            font-weight: 700;
        }

        .progress-bar {
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 12px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #8e44ad, #f39c12);
            border-radius: 4px;
            transition: width 0.8s ease;
            box-shadow: 0 0 10px rgba(142, 68, 173, 0.5);
        }

        .progress-steps-mini {
            display: flex;
            justify-content: space-between;
            font-size: 8px;
            color: rgba(255, 255, 255, 0.6);
        }

        .step-mini {
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .step-mini.active {
            color: #8e44ad;
            font-weight: 600;
        }

        .step-mini.completed {
            color: #f39c12;
        }

        /* Information Cards */
        .info-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 14px;
            margin-bottom: 14px;
        }

        .info-card-title {
            color: #8e44ad;
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .info-card-content {
            color: rgba(255, 255, 255, 0.85);
            font-size: 12px;
            line-height: 1.5;
        }

        .info-list {
            list-style: none;
            padding: 0;
        }

        .info-list li {
            padding: 6px 0;
            padding-left: 20px;
            position: relative;
            font-size: 12px;
            color: rgba(255, 255, 255, 0.8);
        }

        .info-list li:before {
            content: "‚ö°";
            position: absolute;
            left: 0;
            font-size: 10px;
        }

        /* Scientific Fact Box */
        .scientific-fact {
            background: linear-gradient(135deg, rgba(243, 156, 18, 0.1), rgba(142, 68, 173, 0.1));
            border: 1px solid rgba(243, 156, 18, 0.3);
            border-radius: 12px;
            padding: 14px;
            margin: 16px 0;
            position: relative;
            overflow: hidden;
        }

        .scientific-fact:before {
            content: "üß†";
            position: absolute;
            top: -20px;
            right: -20px;
            font-size: 60px;
            opacity: 0.1;
        }

        .scientific-fact-title {
            color: #f39c12;
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 6px;
        }

        .scientific-fact-text {
            color: rgba(255, 255, 255, 0.9);
            font-size: 12px;
            line-height: 1.5;
            position: relative;
            z-index: 1;
        }

        /* Voice Controls */
        .voice-controls {
            position: absolute;
            top: 10px;
            right: 20px;
            display: flex;
            gap: 8px;
            z-index: 1000;
        }

        .control-btn {
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            width: 44px;
            height: 44px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            position: relative;
        }

        .control-btn:hover {
            background: rgba(142, 68, 173, 0.3);
            border-color: #8e44ad;
            transform: scale(1.1);
        }

        .control-btn.active {
            background: rgba(142, 68, 173, 0.4);
            border-color: #8e44ad;
            box-shadow: 0 0 20px rgba(142, 68, 173, 0.5);
        }

        .control-tooltip {
            position: absolute;
            bottom: -30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9);
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 10px;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .control-btn:hover .control-tooltip {
            opacity: 1;
        }

        /* Loading Screen */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #8e44ad 0%, #3498db 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            transition: opacity 1s ease;
        }

        .loading-content {
            text-align: center;
        }

        .loading-neural {
            font-size: 60px;
            animation: neural-activity 2s ease-in-out infinite;
            margin-bottom: 20px;
        }

        @keyframes neural-activity {
            0%, 100% { transform: scale(1) rotate(0deg); }
            50% { transform: scale(1.1) rotate(180deg); }
        }

        .loading-text {
            color: white;
            font-size: 20px;
            margin-bottom: 20px;
        }

        .loading-progress {
            width: 200px;
            height: 4px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 2px;
            overflow: hidden;
        }

        .loading-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #8e44ad, #f39c12);
            animation: loading 2s ease-in-out infinite;
        }

        @keyframes loading {
            0% { width: 0%; }
            50% { width: 100%; }
            100% { width: 0%; }
        }

        /* Voice Indicator */
        .voice-indicator {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(142, 68, 173, 0.5);
            border-radius: 30px;
            padding: 14px 28px;
            display: flex;
            align-items: center;
            gap: 12px;
            z-index: 1000;
            opacity: 0;
            transition: all 0.3s ease;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }

        .voice-indicator.visible {
            opacity: 1;
            transform: translateX(-50%) translateY(-10px);
        }

        .voice-waves {
            display: flex;
            align-items: center;
            gap: 3px;
        }

        .voice-wave {
            width: 3px;
            height: 20px;
            background: linear-gradient(180deg, #8e44ad, #f39c12);
            border-radius: 2px;
            animation: voice-wave 1s ease-in-out infinite;
        }

        .voice-wave:nth-child(2) { animation-delay: 0.1s; }
        .voice-wave:nth-child(3) { animation-delay: 0.2s; }
        .voice-wave:nth-child(4) { animation-delay: 0.3s; }
        .voice-wave:nth-child(5) { animation-delay: 0.4s; }

        @keyframes voice-wave {
            0%, 100% { transform: scaleY(0.3); }
            50% { transform: scaleY(1); }
        }

        .narration-text {
            color: white;
            font-size: 13px;
            max-width: 300px;
        }

        /* Quick Actions */
        .quick-actions {
            position: absolute;
            bottom: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            z-index: 1000;
        }

        .action-btn {
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 10px 16px;
            border-radius: 25px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
        }

        .action-btn:hover {
            background: rgba(142, 68, 173, 0.3);
            border-color: #8e44ad;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(142, 68, 173, 0.3);
        }

        /* Custom Scrollbar */
        .info-panel::-webkit-scrollbar {
            width: 6px;
        }

        .info-panel::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 3px;
        }

        .info-panel::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, #8e44ad, #f39c12);
            border-radius: 3px;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .info-panel {
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                top: auto;
                width: 100%;
                max-height: 50vh;
                border-radius: 20px 20px 0 0;
            }
            
            .journey-navigation {
                bottom: 52vh;
                max-width: calc(100% - 40px);
            }
            
            .voice-controls {
                top: auto;
                bottom: 55vh;
                right: 10px;
            }
            
            .quick-actions {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="bg-animation"></div>

    <!-- Loading Screen -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-content">
            <div class="loading-neural">üß†</div>
            <div class="loading-text">Preparing Your Neural Journey...</div>
            <div class="loading-progress">
                <div class="loading-progress-bar"></div>
            </div>
        </div>
    </div>

    <!-- Museum Header -->
    <div class="museum-header">
        <div class="museum-title">Control and Coordination</div>
        <div class="exhibit-subtitle">
            <span class="neural-indicator"></span>
            The Biology of Response and Movement
        </div>
    </div>

    <!-- Journey Navigation -->
    <div class="journey-navigation">
        <div class="journey-title">
            <span>üß†</span>
            <span>Your Coordination Journey</span>
        </div>
        <div class="journey-steps">
            <button class="journey-btn active" onclick="loadJourneyStep('introduction')">
                <span>üéØ</span> Introduction
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('nervous')">
                <span>‚ö°</span> Nervous Tissue
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('muscle')">
                <span>üí™</span> Muscle Tissue
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('movement')">
                <span>üîÑ</span> Movement Types
            </button>
        </div>
    </div>

    <!-- 3D Model Container -->
    <div class="model-container">
        <div class="sketchfab-embed-wrapper">
            <iframe id="api-frame"
                    title="Nervous Tissue Model" 
                    frameborder="0" 
                    allowfullscreen 
                    mozallowfullscreen="true" 
                    webkitallowfullscreen="true" 
                    allow="autoplay; fullscreen; xr-spatial-tracking"
                    xr-spatial-tracking 
                    execution-while-out-of-viewport 
                    execution-while-not-rendered 
                    web-share 
                    src="https://sketchfab.com/models/6df0d6ee5cbb4e2d9ad5ffd11e703778/embed?autostart=1&internal=1&tracking=0&ui_ar=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0">
            </iframe>
        </div>
    </div>

    <!-- Information Panel -->
    <div class="info-panel" id="infoPanel">
        <div class="info-header">
            <div class="info-icon" id="stepIcon">üéØ</div>
            <div class="info-title">
                <h2 id="stepTitle">Introduction - Why Control and Coordination?</h2>
                <div class="info-subtitle" id="stepSubtitle">The need for organized responses</div>
            </div>
        </div>

        <!-- Progress Tracker -->
        <div class="progress-tracker">
            <div class="progress-header">
                <span>Learning Progress</span>
                <span class="progress-percentage" id="progressPercent">25%</span>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 25%"></div>
            </div>
            <div class="progress-steps-mini">
                <span class="step-mini active" onclick="loadJourneyStep('introduction')">Intro</span>
                <span class="step-mini" onclick="loadJourneyStep('nervous')">Nervous</span>
                <span class="step-mini" onclick="loadJourneyStep('muscle')">Muscle</span>
                <span class="step-mini" onclick="loadJourneyStep('movement')">Movement</span>
            </div>
        </div>

        <div class="info-content" id="mainDescription">
            All living organisms need control and coordination systems to respond effectively to their environment. These systems allow organisms to detect changes, process information, and produce appropriate responses that help them survive and thrive in their surroundings.
        </div>

        <div class="info-card">
            <div class="info-card-title">
                <span>üî¨</span> Key Concepts
            </div>
            <div class="info-card-content">
                <ul class="info-list" id="keyConcepts">
                    <li>Organisms must respond to environmental changes</li>
                    <li>Coordination ensures organized responses</li>
                    <li>Specialized tissues handle control functions</li>
                    <li>Movement helps organisms adapt and survive</li>
                </ul>
            </div>
        </div>

        <div class="scientific-fact">
            <div class="scientific-fact-title">Scientific Insight</div>
            <div class="scientific-fact-text" id="scientificFact">
                Even the simplest organisms like bacteria can detect and respond to environmental changes through chemical signals, demonstrating that control and coordination are fundamental to life itself.
            </div>
        </div>

        <div class="info-card">
            <div class="info-card-title">
                <span>üéØ</span> Learning Objectives
            </div>
            <div class="info-card-content" id="learningObjectives">
                Understand why organisms need control and coordination systems and how specialized tissues enable effective responses to environmental changes.
            </div>
        </div>
    </div>

    <!-- Voice Controls -->
    <div class="voice-controls">
        <button class="control-btn active" id="voiceToggle" onclick="toggleVoice()">
            üîä
            <span class="control-tooltip">Voice Narration</span>
        </button>
        <button class="control-btn" onclick="toggleAutoPlay()">
            ‚ñ∂Ô∏è
            <span class="control-tooltip">Auto Journey</span>
        </button>
        <button class="control-btn" onclick="toggleInfo()">
            ‚ÑπÔ∏è
            <span class="control-tooltip">Toggle Info</span>
        </button>
    </div>

    <!-- Quick Actions -->
    <div class="quick-actions">
        <button class="action-btn" onclick="startGuidedTour()">
            <span>üöÄ</span> Guided Tour
        </button>
        <button class="action-btn" onclick="showQuiz()">
            <span>üéØ</span> Test Knowledge
        </button>
    </div>

    <!-- Voice Indicator -->
    <div class="voice-indicator" id="voiceIndicator">
        <div class="voice-waves">
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
        </div>
        <div class="narration-text" id="narrationText">Narrating...</div>
    </div>

    <script>
        // Journey Step Data with Complete Educational Content
        const JOURNEY_DATA = {
            introduction: {
                title: "Introduction - Why Control and Coordination?",
                subtitle: "The need for organized responses",
                icon: "üéØ",
                modelUrl: "https://sketchfab.com/models/6df0d6ee5cbb4e2d9ad5ffd11e703778/embed?autostart=1&internal=1&tracking=0&ui_ar=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "All living organisms need control and coordination systems to respond effectively to their environment. These systems allow organisms to detect changes, process information, and produce appropriate responses that help them survive and thrive in their surroundings.",
                concepts: [
                    "Organisms must respond to environmental changes",
                    "Coordination ensures organized responses",
                    "Specialized tissues handle control functions",
                    "Movement helps organisms adapt and survive"
                ],
                scientificFact: "Even the simplest organisms like bacteria can detect and respond to environmental changes through chemical signals, demonstrating that control and coordination are fundamental to life itself.",
                objectives: "Understand why organisms need control and coordination systems and how specialized tissues enable effective responses to environmental changes.",
                narration: "Welcome to the fascinating world of control and coordination in living organisms! Imagine if your body couldn't coordinate its responses - if your hand couldn't pull away from something hot, or if your eyes couldn't adjust to changing light. Life would be impossible without these control systems. Every living organism, from the tiniest bacteria to complex multicellular organisms like humans, needs to respond to changes in their environment. This might be moving toward food, away from danger, or adjusting internal processes to maintain optimal conditions. The key to survival is not just responding, but responding in an organized, coordinated way. This requires specialized systems that can detect environmental changes, process this information, and coordinate appropriate responses throughout the organism. In multicellular organisms, this has led to the evolution of sophisticated nervous and muscular systems that work together to ensure survival and proper functioning."
            },
            nervous: {
                title: "Nervous Tissue - The Information Highway",
                subtitle: "Rapid communication and control",
                icon: "‚ö°",
                modelUrl: "https://sketchfab.com/models/6df0d6ee5cbb4e2d9ad5ffd11e703778/embed?autostart=1&internal=1&tracking=0&ui_ar=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "Nervous tissue is specialized for rapid communication throughout the body. It consists of neurons that transmit electrical and chemical signals, enabling organisms to detect stimuli, process information, and coordinate responses in milliseconds.",
                concepts: [
                    "Neurons are the functional units of nervous tissue",
                    "Electrical impulses travel along nerve fibers",
                    "Synapses allow communication between neurons",
                    "Networks process and integrate information"
                ],
                scientificFact: "Nerve impulses can travel at speeds up to 120 meters per second - that's faster than most cars drive in cities! This incredible speed allows for almost instantaneous responses to stimuli.",
                objectives: "Explore the structure and function of nervous tissue and understand how it enables rapid communication and coordination in organisms.",
                narration: "Discover nervous tissue - nature's most sophisticated communication network! This remarkable tissue consists of specialized cells called neurons that are perfectly designed for transmitting information at incredible speeds. Each neuron has a cell body containing the nucleus, dendrites that receive signals from other neurons, and an axon that carries signals away from the cell body. What makes neurons extraordinary is their ability to generate and transmit electrical impulses called action potentials. These impulses travel along the neuron's membrane by opening and closing ion channels, creating a wave of electrical activity. When an impulse reaches the end of an axon, it triggers the release of chemical messengers called neurotransmitters at structures called synapses. These chemicals cross the tiny gap between neurons and trigger responses in the next cell in the network. This system allows for incredibly complex processing - millions of neurons can work together to integrate information, make decisions, and coordinate responses throughout the body in just milliseconds."
            },
            muscle: {
                title: "Muscle Tissue - The Movement Makers",
                subtitle: "Converting signals into action",
                icon: "üí™",
                modelUrl: "https://sketchfab.com/models/5a7a63e0c48f4851a6e82599b2682d2c/embed?autostart=1&internal=1&tracking=0&ui_ar=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "Muscle tissue is specialized for contraction and movement. It responds to nervous system signals by contracting, which produces the force needed for movement, maintaining posture, and various physiological functions throughout the body.",
                concepts: [
                    "Muscle fibers contain contractile proteins",
                    "Calcium ions regulate muscle contraction",
                    "Different muscle types serve different functions",
                    "Energy is required for both contraction and relaxation"
                ],
                scientificFact: "A single muscle fiber can contract to about 60% of its resting length, and the strongest muscles in your body can generate forces equivalent to lifting several times your body weight!",
                objectives: "Understand the structure and function of muscle tissue and how it converts nervous system signals into mechanical force and movement.",
                narration: "Explore muscle tissue - the remarkable biological machinery that converts electrical signals into mechanical force! Muscle tissue is composed of specialized cells called muscle fibers that contain two key proteins: actin and myosin. These proteins are arranged in precise patterns that allow them to slide past each other when the muscle contracts. The process begins when a nerve impulse reaches the muscle fiber, causing the release of calcium ions from internal storage sites. These calcium ions bind to regulatory proteins, exposing binding sites on actin filaments. Myosin heads then attach to these sites and, using energy from ATP, pull the actin filaments along, causing the muscle fiber to shorten and contract. This sliding filament mechanism can generate tremendous force - some muscles can produce forces many times greater than their own weight. Different types of muscle tissue serve different functions: skeletal muscle moves bones, cardiac muscle pumps blood, and smooth muscle controls internal organ functions. The coordination between nervous tissue sending signals and muscle tissue producing movement is what enables all voluntary and involuntary movements in living organisms."
            },
            movement: {
                title: "Types of Movement - Growth vs. Independent",
                subtitle: "Understanding different response mechanisms",
                icon: "üîÑ",
                modelUrl: "https://sketchfab.com/models/6df0d6ee5cbb4e2d9ad5ffd11e703778/embed?autostart=1&internal=1&tracking=0&ui_ar=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "Organisms exhibit different types of movements in response to environmental stimuli. Growth-dependent movements involve changes in growth patterns, while growth-independent movements involve rapid responses that don't require changes in cell growth or division.",
                concepts: [
                    "Growth-dependent movements change development patterns",
                    "Growth-independent movements are rapid responses",
                    "Plant movements often involve growth responses",
                    "Animal movements typically don't require growth"
                ],
                scientificFact: "Plants can exhibit movements within seconds (like the Venus flytrap closing) or over hours and days (like sunflowers tracking the sun), demonstrating both growth-independent and growth-dependent responses.",
                objectives: "Compare and contrast growth-dependent and growth-independent movements and understand how different organisms use these mechanisms.",
                narration: "Let's explore the fascinating world of movement types in living organisms! There are two fundamentally different ways that organisms can move or change position in response to their environment. Growth-dependent movements involve actual changes in the growth patterns of the organism. These movements are typically slower and involve cell division, elongation, or differential growth rates in different parts of the organism. For example, when a plant stem bends toward light, it's because cells on the shaded side grow longer than those on the light side, causing the stem to curve. This type of movement, called tropism, is permanent and helps position the plant optimally for photosynthesis. In contrast, growth-independent movements are rapid responses that don't involve changes in growth. These movements rely on specialized tissues like muscle and nervous tissue working together. When you quickly pull your hand away from something hot, or when a mimosa plant's leaves fold when touched, these are growth-independent movements. Animals primarily use growth-independent movements because they need to respond quickly to their environment for survival, while plants often use growth-dependent movements because they're sessile and need to position themselves optimally for resources like light and water."
            }
        };

        // Global Variables
        let currentStep = 'introduction';
        let voiceEnabled = true;
        let autoPlayEnabled = false;
        let currentSpeech = null;
        let selectedVoice = null;
        let journeyProgress = 0;
        let guidedTourActive = false;

        // Initialize Voice System
        function initVoiceSystem() {
            if (!('speechSynthesis' in window)) {
                console.warn('Speech synthesis not supported');
                voiceEnabled = false;
                document.getElementById('voiceToggle').style.display = 'none';
                return;
            }

            function loadVoices() {
                const voices = speechSynthesis.getVoices();
                if (voices.length === 0) return;

                // Prefer natural-sounding voices
                const preferredVoices = [
                    'Google UK English Female',
                    'Microsoft Sonia',
                    'Microsoft Hazel',
                    'Samantha',
                    'Victoria'
                ];

                for (const name of preferredVoices) {
                    selectedVoice = voices.find(v => v.name.includes(name));
                    if (selectedVoice) break;
                }

                if (!selectedVoice) {
                    selectedVoice = voices.find(v => v.lang.startsWith('en'));
                }
            }

            loadVoices();
            if (speechSynthesis.onvoiceschanged !== undefined) {
                speechSynthesis.onvoiceschanged = loadVoices;
            }
        }

        // Load Journey Step
        function loadJourneyStep(stepId) {
            const stepData = JOURNEY_DATA[stepId];
            if (!stepData) return;

            currentStep = stepId;
            
            // Update model
            document.getElementById('api-frame').src = stepData.modelUrl;
            
            // Update info panel
            document.getElementById('stepIcon').textContent = stepData.icon;
            document.getElementById('stepTitle').textContent = stepData.title;
            document.getElementById('stepSubtitle').textContent = stepData.subtitle;
            document.getElementById('mainDescription').textContent = stepData.description;
            
            // Update key concepts
            const conceptsList = document.getElementById('keyConcepts');
            conceptsList.innerHTML = stepData.concepts.map(c => `<li>${c}</li>`).join('');
            
            // Update scientific fact
            document.getElementById('scientificFact').textContent = stepData.scientificFact;
            
            // Update learning objectives
            document.getElementById('learningObjectives').textContent = stepData.objectives;
            
            // Update navigation buttons
            updateNavigationButtons(stepId);
            
            // Update progress
            updateProgress();
            
            // Play narration if enabled
            if (voiceEnabled) {
                speakText(stepData.narration);
            }
        }

        // Update Navigation Buttons
        function updateNavigationButtons(activeStep) {
            const buttons = document.querySelectorAll('.journey-btn');
            const steps = ['introduction', 'nervous', 'muscle', 'movement'];
            const activeIndex = steps.indexOf(activeStep);
            
            buttons.forEach((btn, index) => {
                btn.classList.remove('active', 'completed');
                if (index < activeIndex) {
                    btn.classList.add('completed');
                } else if (index === activeIndex) {
                    btn.classList.add('active');
                }
            });
            
            // Update mini steps
            const miniSteps = document.querySelectorAll('.step-mini');
            miniSteps.forEach((step, index) => {
                step.classList.remove('active', 'completed');
                if (index < activeIndex) {
                    step.classList.add('completed');
                } else if (index === activeIndex) {
                    step.classList.add('active');
                }
            });
        }

        // Update Progress
        function updateProgress() {
            const steps = ['introduction', 'nervous', 'muscle', 'movement'];
            const currentIndex = steps.indexOf(currentStep);
            const progress = ((currentIndex + 1) / steps.length) * 100;
            
            document.getElementById('progressPercent').textContent = Math.round(progress) + '%';
            document.getElementById('progressFill').style.width = progress + '%';
        }

        // Speech Functions
        function speakText(text) {
            if (!voiceEnabled || !text) return;
            
            stopSpeech();
            
            currentSpeech = new SpeechSynthesisUtterance(text);
            if (selectedVoice) {
                currentSpeech.voice = selectedVoice;
            }
            currentSpeech.rate = 0.9;
            currentSpeech.pitch = 1.0;
            currentSpeech.volume = 0.9;
            
            currentSpeech.onstart = () => {
                document.getElementById('voiceIndicator').classList.add('visible');
                document.getElementById('narrationText').textContent = 
                    text.substring(0, 50) + (text.length > 50 ? '...' : '');
            };
            
            currentSpeech.onend = () => {
                document.getElementById('voiceIndicator').classList.remove('visible');
                currentSpeech = null;
                
                // Auto-advance if guided tour is active
                if (guidedTourActive) {
                    setTimeout(nextStep, 2000);
                }
            };
            
            speechSynthesis.speak(currentSpeech);
        }

        function stopSpeech() {
            if (currentSpeech) {
                speechSynthesis.cancel();
                currentSpeech = null;
                document.getElementById('voiceIndicator').classList.remove('visible');
            }
        }

        // Control Functions
        function toggleVoice() {
            voiceEnabled = !voiceEnabled;
            const btn = document.getElementById('voiceToggle');
            btn.textContent = voiceEnabled ? 'üîä' : 'üîá';
            btn.classList.toggle('active', voiceEnabled);
            
            if (!voiceEnabled) {
                stopSpeech();
            }
        }

        function toggleAutoPlay() {
            autoPlayEnabled = !autoPlayEnabled;
            if (autoPlayEnabled) {
                startGuidedTour();
            } else {
                guidedTourActive = false;
            }
        }

        function toggleInfo() {
            const panel = document.getElementById('infoPanel');
            panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
        }

        // Guided Tour
        function startGuidedTour() {
            guidedTourActive = true;
            const steps = ['introduction', 'nervous', 'muscle', 'movement'];
            let stepIndex = 0;
            
            function tourStep() {
                if (stepIndex < steps.length && guidedTourActive) {
                    loadJourneyStep(steps[stepIndex]);
                    stepIndex++;
                } else {
                    guidedTourActive = false;
                    if (voiceEnabled) {
                        speakText("You have completed your journey through control and coordination systems! You now understand how organisms detect, process, and respond to environmental changes through specialized tissues and coordinated movements.");
                    }
                }
            }
            
            tourStep();
            window.nextStep = tourStep;
        }

        // Quiz Function
        function showQuiz() {
            const questions = [
                "Why do organisms need control and coordination systems?",
                "How do nervous tissues enable rapid communication?",
                "What is the role of muscle tissue in movement?",
                "What's the difference between growth-dependent and independent movements?",
                "How do specialized tissues work together for coordinated responses?"
            ];
            
            const randomQ = questions[Math.floor(Math.random() * questions.length)];
            
            if (voiceEnabled) {
                speakText(`Here's a question about control and coordination: ${randomQ} Think about what you've learned about how organisms respond to their environment.`);
            }
        }

        // Initialize
        function init() {
            initVoiceSystem();
            
            // Hide loading screen
            setTimeout(() => {
                const loading = document.getElementById('loadingOverlay');
                loading.style.opacity = '0';
                setTimeout(() => {
                    loading.style.display = 'none';
                    
                    // Welcome message
                    if (voiceEnabled) {
                        speakText("Welcome to your exploration of control and coordination in living organisms! We'll discover how organisms detect changes in their environment and coordinate appropriate responses through specialized tissues. Let's begin by understanding why these systems are essential for life!");
                    }
                }, 1000);
            }, 3000);
            
            // Keyboard shortcuts
            document.addEventListener('keydown', (e) => {
                switch(e.key) {
                    case 'v': toggleVoice(); break;
                    case 'i': toggleInfo(); break;
                    case 'g': startGuidedTour(); break;
                    case 'Escape': stopSpeech(); guidedTourActive = false; break;
                    case 'ArrowRight': nextStep && nextStep(); break;
                }
            });
        }

        // Start the application
        init();
    </script>
</body>
</html>