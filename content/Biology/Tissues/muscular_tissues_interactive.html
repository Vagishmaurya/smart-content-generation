<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Muscular Tissues - Structure and Function</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tween.js/18.6.4/tween.umd.js"></script>

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #8B0000 0%, #B22222 100%);
            color: white;
            overflow: hidden;
            position: relative;
            height: 100vh;
        }

        /* Animated Background */
        .bg-animation {
            position: fixed;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: 0;
            opacity: 0.1;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 320"><path fill="%23ffffff" fill-opacity="0.2" d="M0,96L48,112C96,128,192,160,288,186.7C384,213,480,235,576,213.3C672,192,768,128,864,128C960,128,1056,192,1152,197.3C1248,203,1344,149,1392,122.7L1440,96L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z"></path></svg>') repeat-x;
            animation: wave 10s linear infinite;
        }

        @keyframes wave {
            0% { background-position-x: 0; }
            100% { background-position-x: 1440px; }
        }

        /* Museum Interface - Compact Header */
        .museum-header {
            position: absolute;
            top: 10px;
            left: 20px;
            text-align: left;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            padding: 10px 18px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .museum-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 4px;
            background: linear-gradient(45deg, #DC143C, #FF6347);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: titleGlow 3s ease-in-out infinite;
        }

        @keyframes titleGlow {
            0%, 100% { filter: brightness(1); }
            50% { filter: brightness(1.2); }
        }

        .exhibit-subtitle {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.8);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .muscle-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            background: #DC143C;
            border-radius: 50%;
            animation: muscle-contract 1.5s ease-in-out infinite;
        }

        @keyframes muscle-contract {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.4); opacity: 0.7; }
        }

        /* Journey Navigation - Enhanced */
        .journey-navigation {
            position: absolute;
            bottom: 20px;
            left: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            padding: 15px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            max-width: 300px;
        }

        .journey-title {
            font-size: 14px;
            font-weight: 600;
            color: #DC143C;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .journey-steps {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }

        .journey-btn {
            background: rgba(220, 20, 60, 0.2);
            border: 1px solid rgba(220, 20, 60, 0.4);
            color: white;
            padding: 6px 10px;
            border-radius: 20px;
            font-size: 11px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 4px;
            white-space: nowrap;
        }

        .journey-btn:hover {
            background: rgba(220, 20, 60, 0.3);
            border-color: #DC143C;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(220, 20, 60, 0.3);
        }

        .journey-btn.active {
            background: linear-gradient(135deg, #8B0000, #DC143C);
            border-color: #8B0000;
            box-shadow: 0 0 20px rgba(139, 0, 0, 0.5);
            animation: pulse 2s infinite;
        }

        .journey-btn.completed {
            background: rgba(46, 204, 113, 0.3);
            border-color: #2ecc71;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        /* 3D Model Container */
        .model-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 0;
            overflow: hidden;
            border: none;
            z-index: 100;
        }

        .sketchfab-embed-wrapper {
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #8B0000 0%, #B22222 100%);
        }

        .sketchfab-embed-wrapper iframe {
            width: 100%;
            height: 100%;
            border: none;
            border-radius: 0;
        }

        /* Information Panel - Enhanced */
        .info-panel {
            position: absolute;
            top: 70px;
            right: 20px;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(25px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 16px;
            padding: 24px;
            width: 380px;
            max-height: calc(100vh - 140px);
            z-index: 800;
            overflow-y: auto;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }

        .info-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        }

        .info-icon {
            font-size: 28px;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        .info-title {
            flex: 1;
        }

        .info-title h2 {
            font-size: 18px;
            color: #DC143C;
            margin-bottom: 4px;
        }

        .info-subtitle {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.7);
        }

        .info-content {
            color: rgba(255, 255, 255, 0.9);
            font-size: 14px;
            line-height: 1.6;
        }

        /* Progress Tracker */
        .progress-tracker {
            background: linear-gradient(135deg, rgba(220, 20, 60, 0.1), rgba(139, 0, 0, 0.1));
            border: 1px solid rgba(220, 20, 60, 0.3);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 20px;
        }

        .progress-header {
            font-size: 13px;
            font-weight: 600;
            color: #DC143C;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .progress-percentage {
            font-size: 18px;
            color: #8B0000;
            font-weight: 700;
        }

        .progress-bar {
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 12px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #DC143C, #8B0000);
            border-radius: 4px;
            transition: width 0.8s ease;
            box-shadow: 0 0 10px rgba(139, 0, 0, 0.5);
        }

        .progress-steps-mini {
            display: flex;
            justify-content: space-between;
            font-size: 10px;
            color: rgba(255, 255, 255, 0.6);
        }

        .step-mini {
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .step-mini.active {
            color: #8B0000;
            font-weight: 600;
        }

        .step-mini.completed {
            color: #2ecc71;
        }

        /* Information Cards */
        .info-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 14px;
            margin-bottom: 14px;
        }

        .info-card-title {
            color: #DC143C;
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .info-card-content {
            color: rgba(255, 255, 255, 0.85);
            font-size: 12px;
            line-height: 1.5;
        }

        .info-list {
            list-style: none;
            padding: 0;
        }

        .info-list li {
            padding: 6px 0;
            padding-left: 20px;
            position: relative;
            font-size: 12px;
            color: rgba(255, 255, 255, 0.8);
        }

        .info-list li:before {
            content: "💪";
            position: absolute;
            left: 0;
            font-size: 10px;
        }

        /* Fun Fact Box */
        .fun-fact {
            background: linear-gradient(135deg, rgba(255, 140, 0, 0.1), rgba(255, 165, 0, 0.1));
            border: 1px solid rgba(255, 140, 0, 0.3);
            border-radius: 12px;
            padding: 14px;
            margin: 16px 0;
            position: relative;
            overflow: hidden;
        }

        .fun-fact:before {
            content: "⚡";
            position: absolute;
            top: -20px;
            right: -20px;
            font-size: 60px;
            opacity: 0.1;
        }

        .fun-fact-title {
            color: #FF8C00;
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 6px;
        }

        .fun-fact-text {
            color: rgba(255, 255, 255, 0.9);
            font-size: 12px;
            line-height: 1.5;
            position: relative;
            z-index: 1;
        }

        /* Voice Controls */
        .voice-controls {
            position: absolute;
            top: 10px;
            right: 20px;
            display: flex;
            gap: 8px;
            z-index: 1000;
        }

        .control-btn {
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            width: 44px;
            height: 44px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            position: relative;
        }

        .control-btn:hover {
            background: rgba(139, 0, 0, 0.3);
            border-color: #8B0000;
            transform: scale(1.1);
        }

        .control-btn.active {
            background: rgba(139, 0, 0, 0.4);
            border-color: #8B0000;
            box-shadow: 0 0 20px rgba(139, 0, 0, 0.5);
        }

        .control-tooltip {
            position: absolute;
            bottom: -30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9);
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 10px;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .control-btn:hover .control-tooltip {
            opacity: 1;
        }

        /* Loading Screen */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #8B0000 0%, #B22222 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            transition: opacity 1s ease;
        }

        .loading-content {
            text-align: center;
        }

        .loading-muscle {
            font-size: 60px;
            animation: muscle-contract 1.5s ease-in-out infinite;
            margin-bottom: 20px;
        }

        .loading-text {
            color: white;
            font-size: 20px;
            margin-bottom: 20px;
        }

        .loading-progress {
            width: 200px;
            height: 4px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 2px;
            overflow: hidden;
        }

        .loading-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #8B0000, #DC143C);
            animation: loading 2s ease-in-out infinite;
        }

        @keyframes loading {
            0% { width: 0%; }
            50% { width: 100%; }
            100% { width: 0%; }
        }

        /* Voice Indicator */
        .voice-indicator {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(139, 0, 0, 0.5);
            border-radius: 30px;
            padding: 14px 28px;
            display: flex;
            align-items: center;
            gap: 12px;
            z-index: 1000;
            opacity: 0;
            transition: all 0.3s ease;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }

        .voice-indicator.visible {
            opacity: 1;
            transform: translateX(-50%) translateY(-10px);
        }

        .voice-waves {
            display: flex;
            align-items: center;
            gap: 3px;
        }

        .voice-wave {
            width: 3px;
            height: 20px;
            background: linear-gradient(180deg, #8B0000, #DC143C);
            border-radius: 2px;
            animation: voice-wave 1s ease-in-out infinite;
        }

        .voice-wave:nth-child(2) { animation-delay: 0.1s; }
        .voice-wave:nth-child(3) { animation-delay: 0.2s; }
        .voice-wave:nth-child(4) { animation-delay: 0.3s; }
        .voice-wave:nth-child(5) { animation-delay: 0.4s; }

        @keyframes voice-wave {
            0%, 100% { transform: scaleY(0.3); }
            50% { transform: scaleY(1); }
        }

        .narration-text {
            color: white;
            font-size: 13px;
            max-width: 300px;
        }

        /* Quick Actions */
        .quick-actions {
            position: absolute;
            bottom: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            z-index: 1000;
        }

        .action-btn {
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 10px 16px;
            border-radius: 25px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
        }

        .action-btn:hover {
            background: rgba(220, 20, 60, 0.3);
            border-color: #DC143C;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(220, 20, 60, 0.3);
        }

        /* Custom Scrollbar */
        .info-panel::-webkit-scrollbar {
            width: 6px;
        }

        .info-panel::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 3px;
        }

        .info-panel::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, #8B0000, #DC143C);
            border-radius: 3px;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .info-panel {
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                top: auto;
                width: 100%;
                max-height: 50vh;
                border-radius: 20px 20px 0 0;
            }
            
            .journey-navigation {
                bottom: 52vh;
                max-width: calc(100% - 40px);
            }
            
            .voice-controls {
                top: auto;
                bottom: 55vh;
                right: 10px;
            }
            
            .quick-actions {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="bg-animation"></div>

    <!-- Loading Screen -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-content">
            <div class="loading-muscle">💪</div>
            <div class="loading-text">Powering Up Muscle Systems...</div>
            <div class="loading-progress">
                <div class="loading-progress-bar"></div>
            </div>
        </div>
    </div>

    <!-- Museum Header -->
    <div class="museum-header">
        <div class="museum-title">Muscular Tissues</div>
        <div class="exhibit-subtitle">
            <span class="muscle-indicator"></span>
            The Body's Movement Machinery
        </div>
    </div>

    <!-- Journey Navigation -->
    <div class="journey-navigation">
        <div class="journey-title">
            <span>💪</span>
            <span>Muscle Journey</span>
        </div>
        <div class="journey-steps">
            <button class="journey-btn active" onclick="loadJourneyStep('introduction')">
                <span>📚</span> Overview
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('skeletal')">
                <span>🦴</span> Skeletal
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('smooth')">
                <span>🌊</span> Smooth
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('cardiac')">
                <span>❤️</span> Cardiac
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('comparison')">
                <span>⚖️</span> Comparison
            </button>
        </div>
    </div>

    <!-- 3D Model Container -->
    <div class="model-container">
        <div class="sketchfab-embed-wrapper">
            <iframe id="api-frame"
                    title="Muscle Tissue Structure" 
                    frameborder="0" 
                    allowfullscreen 
                    mozallowfullscreen="true" 
                    webkitallowfullscreen="true" 
                    allow="autoplay; fullscreen; xr-spatial-tracking"
                    xr-spatial-tracking 
                    execution-while-out-of-viewport 
                    execution-while-not-rendered 
                    web-share 
                    src="https://sketchfab.com/models/65e5b7f38585400aa1e2aa5ad405736c/embed?autostart=1&internal=1&tracking=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_watermark=0">
            </iframe>
        </div>
    </div>

    <!-- Information Panel -->
    <div class="info-panel" id="infoPanel">
        <div class="info-header">
            <div class="info-icon" id="stepIcon">📚</div>
            <div class="info-title">
                <h2 id="stepTitle">Muscular Tissues</h2>
                <div class="info-subtitle" id="stepSubtitle">Specialized tissues for movement and force generation</div>
            </div>
        </div>

        <!-- Progress Tracker -->
        <div class="progress-tracker">
            <div class="progress-header">
                <span>Muscle Mastery</span>
                <span class="progress-percentage" id="progressPercent">0%</span>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 0%"></div>
            </div>
            <div class="progress-steps-mini">
                <span class="step-mini active" onclick="loadJourneyStep('introduction')">Intro</span>
                <span class="step-mini" onclick="loadJourneyStep('skeletal')">Skeletal</span>
                <span class="step-mini" onclick="loadJourneyStep('smooth')">Smooth</span>
                <span class="step-mini" onclick="loadJourneyStep('cardiac')">Cardiac</span>
                <span class="step-mini" onclick="loadJourneyStep('comparison')">Compare</span>
            </div>
        </div>

        <div class="info-content" id="mainDescription">
            Muscular tissues are specialized for contraction and force generation, enabling movement throughout the body. The three types - skeletal, smooth, and cardiac - each have unique structural features that match their specific functional demands, from voluntary movement to involuntary organ function.
        </div>

        <div class="info-card">
            <div class="info-card-title">
                <span>💪</span> Key Concepts
            </div>
            <div class="info-card-content">
                <ul class="info-list" id="keyConcepts">
                    <li>All muscle tissues contract to generate force</li>
                    <li>Striation patterns reflect contractile organization</li>
                    <li>Control mechanisms vary by muscle type</li>
                    <li>Structure matches functional demands</li>
                </ul>
            </div>
        </div>

        <div class="fun-fact">
            <div class="fun-fact-title">Muscle Power</div>
            <div class="fun-fact-text" id="funFact">
                Your muscles make up about 40% of your body weight and contain over 600 individual muscles that work together to create every movement you make!
            </div>
        </div>

        <div class="info-card">
            <div class="info-card-title">
                <span>🎯</span> Learning Objectives
            </div>
            <div class="info-card-content" id="learningObjectives">
                Understand the structural differences between muscle types and learn how their unique features enable specific functions in movement and organ control.
            </div>
        </div>
    </div>

    <!-- Voice Controls -->
    <div class="voice-controls">
        <button class="control-btn active" id="voiceToggle" onclick="toggleVoice()">
            🔊
            <span class="control-tooltip">Voice Narration</span>
        </button>
        <button class="control-btn" onclick="toggleAutoPlay()">
            ▶️
            <span class="control-tooltip">Auto Journey</span>
        </button>
        <button class="control-btn" onclick="toggleInfo()">
            ℹ️
            <span class="control-tooltip">Toggle Info</span>
        </button>
    </div>

    <!-- Quick Actions -->
    <div class="quick-actions">
        <button class="action-btn" onclick="startGuidedTour()">
            <span>🚀</span> Guided Tour
        </button>
        <button class="action-btn" onclick="showQuiz()">
            <span>🎯</span> Test Knowledge
        </button>
    </div>

    <!-- Voice Indicator -->
    <div class="voice-indicator" id="voiceIndicator">
        <div class="voice-waves">
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
        </div>
        <div class="narration-text" id="narrationText">Narrating...</div>
    </div>

    <script>
        // Journey Step Data with Complete Educational Content
        const JOURNEY_DATA = {
            introduction: {
                title: "Muscular Tissues",
                subtitle: "Specialized tissues for movement and force generation",
                icon: "📚",
                modelUrl: "https://sketchfab.com/models/65e5b7f38585400aa1e2aa5ad405736c/embed?autostart=1&internal=1&tracking=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_watermark=0",
                description: "Muscular tissues are specialized for contraction and force generation, enabling movement throughout the body. The three types - skeletal, smooth, and cardiac - each have unique structural features that match their specific functional demands, from voluntary movement to involuntary organ function.",
                concepts: [
                    "All muscle tissues contract to generate force",
                    "Striation patterns reflect contractile organization",
                    "Control mechanisms vary by muscle type",
                    "Structure matches functional demands"
                ],
                funFact: "Your muscles make up about 40% of your body weight and contain over 600 individual muscles that work together to create every movement you make!",
                objectives: "Understand the structural differences between muscle types and learn how their unique features enable specific functions in movement and organ control.",
                narration: "Welcome to the dynamic world of muscular tissues! You're viewing the three fundamental types of muscle tissue that power every movement in your body. All muscle tissues share one crucial ability - they can contract to generate force. However, each type has evolved unique structural features to meet specific functional demands. Skeletal muscle, attached to bones, provides voluntary movement with its distinctive striped appearance. Smooth muscle, found in organ walls, creates involuntary movements like digestion and blood vessel constriction. Cardiac muscle, exclusive to the heart, combines features of both other types to pump blood continuously throughout your life. The key to understanding muscle tissue lies in recognizing how structure determines function. The presence or absence of striations, the arrangement of contractile proteins, the control mechanisms, and the cellular connections all reflect the specific job each muscle type must perform. From the precise control needed for writing to the rhythmic beating of your heart, muscular tissues represent some of the most specialized and efficient biological machines ever evolved."
            },
            skeletal: {
                title: "Skeletal Muscle Tissue",
                subtitle: "Voluntary striated muscle for body movement",
                icon: "🦴",
                modelUrl: "https://sketchfab.com/models/bd84a4933a404842aa51af2024a83c79/embed?autostart=1&internal=1&tracking=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_watermark=0",
                description: "Skeletal muscle consists of long, cylindrical, multinucleated fibers with distinct cross-striations. These voluntary muscles attach to bones via tendons and are responsible for body movement, posture maintenance, and heat production. Their striated appearance reflects the organized arrangement of contractile proteins.",
                concepts: [
                    "Long, cylindrical, multinucleated fibers",
                    "Cross-striations from organized sarcomeres",
                    "Voluntary control via motor neurons",
                    "Attached to bones by tendons"
                ],
                funFact: "A single skeletal muscle fiber can be over a foot long and contains hundreds of nuclei to manage its massive size!",
                objectives: "Examine skeletal muscle fiber structure and understand how striation patterns enable powerful, controlled voluntary movement.",
                narration: "Here's skeletal muscle - the powerhouse of voluntary movement! You're looking at individual muscle fibers that are truly remarkable cellular structures. Each fiber is essentially a single cell, but unlike typical cells, these are enormous - they can be over 30 centimeters long and contain hundreds of nuclei scattered along their length. This multinucleated arrangement is necessary because these cells are so large that a single nucleus couldn't effectively manage all the cellular activities. The most striking feature is the cross-striation pattern - those alternating light and dark bands that give skeletal muscle its characteristic striped appearance. These striations represent the highly organized arrangement of contractile proteins actin and myosin within structures called sarcomeres. When these proteins slide past each other during contraction, they generate the force that moves your bones. Skeletal muscle is under voluntary control, meaning you consciously decide when to contract these muscles. Motor neurons from your brain and spinal cord release acetylcholine at neuromuscular junctions, triggering the electrical events that lead to contraction. This precise control allows for everything from delicate movements like threading a needle to powerful actions like jumping or lifting."
            },
            smooth: {
                title: "Smooth Muscle Tissue",
                subtitle: "Involuntary non-striated muscle for organ function",
                icon: "🌊",
                modelUrl: "https://sketchfab.com/models/1525fe1477e34d578836236c6a14f5cf/embed?autostart=1&internal=1&tracking=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_watermark=0",
                description: "Smooth muscle cells are spindle-shaped, single-nucleated, and lack cross-striations. Found in organ walls, blood vessels, and airways, these involuntary muscles control internal functions like digestion, blood pressure regulation, and breathing through sustained, slow contractions.",
                concepts: [
                    "Spindle-shaped cells with single nucleus",
                    "No cross-striations visible",
                    "Involuntary control by autonomic nervous system",
                    "Found in organ walls and blood vessels"
                ],
                funFact: "Smooth muscle can maintain tension for hours with minimal energy expenditure - that's how your blood vessels stay partially contracted all day!",
                objectives: "Identify smooth muscle characteristics and understand how its structure enables sustained involuntary contractions for organ function.",
                narration: "Now we're examining smooth muscle - the body's tireless worker that operates behind the scenes! These cells look completely different from skeletal muscle. Notice their spindle or cigar-like shape with tapered ends and a single, centrally located nucleus. The name 'smooth' comes from their appearance - there are no visible cross-striations because the contractile proteins aren't organized in the same regular pattern as skeletal muscle. Smooth muscle cells are much smaller than skeletal muscle fibers, typically only 50 to 200 micrometers long. But what they lack in size, they make up for in endurance and efficiency. These muscles can maintain sustained contractions for hours or even days with minimal energy expenditure - a feat impossible for skeletal muscle. Smooth muscle is involuntary, controlled by the autonomic nervous system, hormones, and local chemical signals. You'll find smooth muscle in the walls of hollow organs like your stomach, intestines, bladder, and uterus, where it creates the waves of contraction that move contents through these organs. It's also in your blood vessels, where it regulates blood pressure and flow, and in your airways, where it controls the diameter of breathing passages."
            },
            cardiac: {
                title: "Cardiac Muscle Tissue",
                subtitle: "Involuntary striated muscle exclusive to the heart",
                icon: "❤️",
                modelUrl: "https://sketchfab.com/models/16e33d3b0be74b4c800cb7601fb51dd2/embed?autostart=1&internal=1&tracking=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_watermark=0",
                description: "Cardiac muscle combines features of skeletal and smooth muscle. These branched, single-nucleated cells show cross-striations and are connected by intercalated discs. Found only in the heart, cardiac muscle contracts rhythmically and involuntarily throughout life without fatigue.",
                concepts: [
                    "Branched cells with single central nucleus",
                    "Cross-striations like skeletal muscle",
                    "Intercalated discs connect adjacent cells",
                    "Involuntary rhythmic contractions"
                ],
                funFact: "Your cardiac muscle contracts about 100,000 times per day and never gets a break - it's been beating since before you were born!",
                objectives: "Analyze cardiac muscle structure and understand how intercalated discs enable coordinated heart contractions.",
                narration: "Here's cardiac muscle - the heart's exclusive tissue that combines the best features of both other muscle types! Cardiac muscle cells are fascinating because they're like a hybrid. They show cross-striations similar to skeletal muscle, indicating organized sarcomeres for strong contractions, but they're involuntary like smooth muscle. Each cell is typically branched and contains a single, centrally located nucleus, though some cells may have two nuclei. The most distinctive feature of cardiac muscle is the intercalated discs - those dark, stepped lines where adjacent cells connect. These aren't just simple connections; they're complex junctions containing desmosomes for mechanical strength and gap junctions for electrical communication. This allows the entire heart to contract as a coordinated unit, with electrical signals spreading rapidly from cell to cell. Cardiac muscle has an incredible property - it's autorhythmic, meaning it can generate its own electrical impulses without external stimulation. Specialized pacemaker cells in the heart's conduction system set the rhythm, and the intercalated discs ensure this rhythm spreads throughout the heart muscle. This tissue must be incredibly durable - it contracts rhythmically about 70 times per minute, 24 hours a day, for your entire life without ever resting."
            },
            comparison: {
                title: "Muscle Tissue Comparison",
                subtitle: "Structure-function relationships across muscle types",
                icon: "⚖️",
                modelUrl: "https://sketchfab.com/models/65e5b7f38585400aa1e2aa5ad405736c/embed?autostart=1&internal=1&tracking=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_watermark=0",
                description: "Comparing the three muscle types reveals how structure perfectly matches function. Skeletal muscle's striations enable powerful voluntary movement, smooth muscle's organization allows sustained involuntary contractions, and cardiac muscle's intercalated discs coordinate rhythmic heart pumping.",
                concepts: [
                    "Striations indicate organized contractile machinery",
                    "Cell connections reflect coordination needs",
                    "Control mechanisms match functional requirements",
                    "Each type optimized for specific roles"
                ],
                funFact: "The three muscle types work together constantly - your diaphragm (skeletal) helps breathing, your heart (cardiac) pumps blood, and your blood vessels (smooth) direct that blood where it's needed!",
                objectives: "Compare and contrast muscle tissue types and understand how their structural differences enable specialized functions in the body.",
                narration: "Now let's compare our three muscle types and see how each is perfectly designed for its role! Looking at this overview, you can see the fundamental differences that make each type specialized. Skeletal muscle, with its prominent striations and multiple nuclei, is built for power and precision. The organized sarcomeres allow for strong, rapid contractions that can be finely controlled - perfect for voluntary movements that require varying degrees of force and speed. The multiple nuclei support the high metabolic demands of active muscle tissue. Smooth muscle, lacking striations but with its spindle shape, is optimized for sustained, slow contractions. The less organized arrangement of contractile proteins allows for prolonged tension with minimal energy use - ideal for maintaining blood pressure or slowly moving food through your digestive tract. Cardiac muscle beautifully combines features of both: it has the striations needed for strong contractions like skeletal muscle, but the intercalated discs create an electrical syncytium where all cells contract together as one unit. This ensures the coordinated pumping action essential for effective blood circulation. The control mechanisms also reflect function: skeletal muscle responds to conscious commands for precise movement, smooth muscle responds to autonomic signals for automatic organ function, and cardiac muscle generates its own rhythm while being modulated by the nervous system. Each muscle type represents millions of years of evolutionary refinement for its specific job in keeping you alive and mobile."
            }
        };

        // Global Variables
        let currentStep = 'introduction';
        let voiceEnabled = true;
        let autoPlayEnabled = false;
        let currentSpeech = null;
        let selectedVoice = null;
        let journeyProgress = 0;
        let guidedTourActive = false;

        // Initialize Voice System
        function initVoiceSystem() {
            if (!('speechSynthesis' in window)) {
                console.warn('Speech synthesis not supported');
                voiceEnabled = false;
                document.getElementById('voiceToggle').style.display = 'none';
                return;
            }

            function loadVoices() {
                const voices = speechSynthesis.getVoices();
                if (voices.length === 0) return;

                const preferredVoices = [
                    'Google UK English Female',
                    'Microsoft Sonia',
                    'Microsoft Hazel',
                    'Samantha',
                    'Victoria'
                ];

                for (const name of preferredVoices) {
                    selectedVoice = voices.find(v => v.name.includes(name));
                    if (selectedVoice) break;
                }

                if (!selectedVoice) {
                    selectedVoice = voices.find(v => v.lang.startsWith('en'));
                }
            }

            loadVoices();
            if (speechSynthesis.onvoiceschanged !== undefined) {
                speechSynthesis.onvoiceschanged = loadVoices;
            }
        }

        // Load Journey Step
        function loadJourneyStep(stepId) {
            const stepData = JOURNEY_DATA[stepId];
            if (!stepData) return;

            currentStep = stepId;
            
            document.getElementById('api-frame').src = stepData.modelUrl;
            
            document.getElementById('stepIcon').textContent = stepData.icon;
            document.getElementById('stepTitle').textContent = stepData.title;
            document.getElementById('stepSubtitle').textContent = stepData.subtitle;
            document.getElementById('mainDescription').textContent = stepData.description;
            
            const conceptsList = document.getElementById('keyConcepts');
            conceptsList.innerHTML = stepData.concepts.map(c => `<li>${c}</li>`).join('');
            
            document.getElementById('funFact').textContent = stepData.funFact;
            document.getElementById('learningObjectives').textContent = stepData.objectives;
            
            updateNavigationButtons(stepId);
            updateProgress();
            
            if (voiceEnabled) {
                speakText(stepData.narration);
            }
        }

        // Update Navigation Buttons
        function updateNavigationButtons(activeStep) {
            const buttons = document.querySelectorAll('.journey-btn');
            const steps = ['introduction', 'skeletal', 'smooth', 'cardiac', 'comparison'];
            const activeIndex = steps.indexOf(activeStep);
            
            buttons.forEach((btn, index) => {
                btn.classList.remove('active', 'completed');
                if (index < activeIndex) {
                    btn.classList.add('completed');
                } else if (index === activeIndex) {
                    btn.classList.add('active');
                }
            });
            
            const miniSteps = document.querySelectorAll('.step-mini');
            miniSteps.forEach((step, index) => {
                step.classList.remove('active', 'completed');
                if (index < activeIndex) {
                    step.classList.add('completed');
                } else if (index === activeIndex) {
                    step.classList.add('active');
                }
            });
        }

        // Update Progress
        function updateProgress() {
            const steps = ['introduction', 'skeletal', 'smooth', 'cardiac', 'comparison'];
            const currentIndex = steps.indexOf(currentStep);
            const progress = ((currentIndex + 1) / steps.length) * 100;
            
            document.getElementById('progressPercent').textContent = Math.round(progress) + '%';
            document.getElementById('progressFill').style.width = progress + '%';
        }

        // Speech Functions
        function speakText(text) {
            if (!voiceEnabled || !text) return;
            
            stopSpeech();
            
            currentSpeech = new SpeechSynthesisUtterance(text);
            if (selectedVoice) {
                currentSpeech.voice = selectedVoice;
            }
            currentSpeech.rate = 0.9;
            currentSpeech.pitch = 1.0;
            currentSpeech.volume = 0.9;
            
            currentSpeech.onstart = () => {
                document.getElementById('voiceIndicator').classList.add('visible');
                document.getElementById('narrationText').textContent = 
                    text.substring(0, 50) + (text.length > 50 ? '...' : '');
            };
            
            currentSpeech.onend = () => {
                document.getElementById('voiceIndicator').classList.remove('visible');
                currentSpeech = null;
                
                if (guidedTourActive) {
                    setTimeout(nextStep, 2000);
                }
            };
            
            speechSynthesis.speak(currentSpeech);
        }

        function stopSpeech() {
            if (currentSpeech) {
                speechSynthesis.cancel();
                currentSpeech = null;
                document.getElementById('voiceIndicator').classList.remove('visible');
            }
        }

        // Control Functions
        function toggleVoice() {
            voiceEnabled = !voiceEnabled;
            const btn = document.getElementById('voiceToggle');
            btn.textContent = voiceEnabled ? '🔊' : '🔇';
            btn.classList.toggle('active', voiceEnabled);
            
            if (!voiceEnabled) {
                stopSpeech();
            }
        }

        function toggleAutoPlay() {
            autoPlayEnabled = !autoPlayEnabled;
            if (autoPlayEnabled) {
                startGuidedTour();
            } else {
                guidedTourActive = false;
            }
        }

        function toggleInfo() {
            const panel = document.getElementById('infoPanel');
            panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
        }

        // Guided Tour
        function startGuidedTour() {
            guidedTourActive = true;
            const steps = ['introduction', 'skeletal', 'smooth', 'cardiac', 'comparison'];
            let stepIndex = 0;
            
            function tourStep() {
                if (stepIndex < steps.length && guidedTourActive) {
                    loadJourneyStep(steps[stepIndex]);
                    stepIndex++;
                } else {
                    guidedTourActive = false;
                    if (voiceEnabled) {
                        speakText("Outstanding! You've mastered the three types of muscular tissue. You now understand how skeletal muscle enables voluntary movement, smooth muscle controls organ functions, and cardiac muscle powers the heart. Each type's structure perfectly matches its role in keeping your body functioning and mobile!");
                    }
                }
            }
            
            tourStep();
            window.nextStep = tourStep;
        }

        // Quiz Function
        function showQuiz() {
            const questions = [
                "Why do skeletal muscle fibers have multiple nuclei?",
                "How do intercalated discs enable cardiac muscle function?",
                "What structural feature allows smooth muscle sustained contractions?",
                "Why are striations important in skeletal and cardiac muscle?",
                "How do the control mechanisms differ between muscle types?"
            ];
            
            const randomQ = questions[Math.floor(Math.random() * questions.length)];
            
            if (voiceEnabled) {
                speakText(`Time to test your muscle knowledge! Here's your question: ${randomQ} Think about how structure determines function in each muscle type!`);
            }
        }

        // Initialize
        function init() {
            initVoiceSystem();
            
            setTimeout(() => {
                const loading = document.getElementById('loadingOverlay');
                loading.style.opacity = '0';
                setTimeout(() => {
                    loading.style.display = 'none';
                    
                    if (voiceEnabled) {
                        speakText("Welcome to your exploration of muscular tissues! We'll discover the three types of muscle tissue and learn how their unique structures enable everything from voluntary movement to involuntary organ function. Let's power up your understanding of the body's movement machinery!");
                    }
                }, 1000);
            }, 3000);
            
            document.addEventListener('keydown', (e) => {
                switch(e.key) {
                    case 'v': toggleVoice(); break;
                    case 'i': toggleInfo(); break;
                    case 'g': startGuidedTour(); break;
                    case 'Escape': stopSpeech(); guidedTourActive = false; break;
                    case 'ArrowRight': nextStep && nextStep(); break;
                }
            });
        }

        init();
    </script>
</body>
</html>