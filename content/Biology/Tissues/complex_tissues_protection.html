<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Complex Tissues and Plant Protection</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tween.js/18.6.4/tween.umd.js"></script>

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #2E8B57 0%, #3CB371 100%);
            color: white;
            overflow: hidden;
            position: relative;
            height: 100vh;
        }

        /* Animated Background */
        .bg-animation {
            position: fixed;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: 0;
            opacity: 0.1;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 320"><path fill="%23ffffff" fill-opacity="0.2" d="M0,96L48,112C96,128,192,160,288,186.7C384,213,480,235,576,213.3C672,192,768,128,864,128C960,128,1056,192,1152,197.3C1248,203,1344,149,1392,122.7L1440,96L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z"></path></svg>') repeat-x;
            animation: wave 10s linear infinite;
        }

        @keyframes wave {
            0% { background-position-x: 0; }
            100% { background-position-x: 1440px; }
        }

        /* Museum Interface - Compact Header */
        .museum-header {
            position: absolute;
            top: 10px;
            left: 20px;
            text-align: left;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            padding: 10px 18px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .museum-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 4px;
            background: linear-gradient(45deg, #20B2AA, #48D1CC);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: titleGlow 3s ease-in-out infinite;
        }

        @keyframes titleGlow {
            0%, 100% { filter: brightness(1); }
            50% { filter: brightness(1.2); }
        }

        .exhibit-subtitle {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.8);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .protection-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            background: #20B2AA;
            border-radius: 50%;
            animation: protection-pulse 2s ease-in-out infinite;
        }

        @keyframes protection-pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.3); opacity: 0.7; }
        }

        /* Journey Navigation - Enhanced */
        .journey-navigation {
            position: absolute;
            bottom: 20px;
            left: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            padding: 15px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            max-width: 280px;
        }

        .journey-title {
            font-size: 14px;
            font-weight: 600;
            color: #20B2AA;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .journey-steps {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }

        .journey-btn {
            background: rgba(32, 178, 170, 0.2);
            border: 1px solid rgba(32, 178, 170, 0.4);
            color: white;
            padding: 6px 10px;
            border-radius: 20px;
            font-size: 11px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 4px;
            white-space: nowrap;
        }

        .journey-btn:hover {
            background: rgba(32, 178, 170, 0.3);
            border-color: #20B2AA;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(32, 178, 170, 0.3);
        }

        .journey-btn.active {
            background: linear-gradient(135deg, #2E8B57, #20B2AA);
            border-color: #2E8B57;
            box-shadow: 0 0 20px rgba(46, 139, 87, 0.5);
            animation: pulse 2s infinite;
        }

        .journey-btn.completed {
            background: rgba(46, 204, 113, 0.3);
            border-color: #2ecc71;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        /* 3D Model Container */
        .model-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 0;
            overflow: hidden;
            border: none;
            z-index: 100;
        }

        .sketchfab-embed-wrapper {
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #2E8B57 0%, #3CB371 100%);
        }

        .sketchfab-embed-wrapper iframe {
            width: 100%;
            height: 100%;
            border: none;
            border-radius: 0;
        }

        /* Information Panel - Enhanced */
        .info-panel {
            position: absolute;
            top: 70px;
            right: 20px;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(25px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 16px;
            padding: 24px;
            width: 380px;
            max-height: calc(100vh - 140px);
            z-index: 800;
            overflow-y: auto;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }

        .info-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        }

        .info-icon {
            font-size: 28px;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        .info-title {
            flex: 1;
        }

        .info-title h2 {
            font-size: 18px;
            color: #20B2AA;
            margin-bottom: 4px;
        }

        .info-subtitle {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.7);
        }

        .info-content {
            color: rgba(255, 255, 255, 0.9);
            font-size: 14px;
            line-height: 1.6;
        }

        /* Progress Tracker */
        .progress-tracker {
            background: linear-gradient(135deg, rgba(32, 178, 170, 0.1), rgba(46, 139, 87, 0.1));
            border: 1px solid rgba(32, 178, 170, 0.3);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 20px;
        }

        .progress-header {
            font-size: 13px;
            font-weight: 600;
            color: #20B2AA;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .progress-percentage {
            font-size: 18px;
            color: #2E8B57;
            font-weight: 700;
        }

        .progress-bar {
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 12px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #20B2AA, #2E8B57);
            border-radius: 4px;
            transition: width 0.8s ease;
            box-shadow: 0 0 10px rgba(46, 139, 87, 0.5);
        }

        .progress-steps-mini {
            display: flex;
            justify-content: space-between;
            font-size: 10px;
            color: rgba(255, 255, 255, 0.6);
        }

        .step-mini {
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .step-mini.active {
            color: #2E8B57;
            font-weight: 600;
        }

        .step-mini.completed {
            color: #2ecc71;
        }

        /* Information Cards */
        .info-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 14px;
            margin-bottom: 14px;
        }

        .info-card-title {
            color: #20B2AA;
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .info-card-content {
            color: rgba(255, 255, 255, 0.85);
            font-size: 12px;
            line-height: 1.5;
        }

        .info-list {
            list-style: none;
            padding: 0;
        }

        .info-list li {
            padding: 6px 0;
            padding-left: 20px;
            position: relative;
            font-size: 12px;
            color: rgba(255, 255, 255, 0.8);
        }

        .info-list li:before {
            content: "üõ°Ô∏è";
            position: absolute;
            left: 0;
            font-size: 10px;
        }

        /* Fun Fact Box */
        .fun-fact {
            background: linear-gradient(135deg, rgba(255, 140, 0, 0.1), rgba(255, 165, 0, 0.1));
            border: 1px solid rgba(255, 140, 0, 0.3);
            border-radius: 12px;
            padding: 14px;
            margin: 16px 0;
            position: relative;
            overflow: hidden;
        }

        .fun-fact:before {
            content: "üîç";
            position: absolute;
            top: -20px;
            right: -20px;
            font-size: 60px;
            opacity: 0.1;
        }

        .fun-fact-title {
            color: #FF8C00;
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 6px;
        }

        .fun-fact-text {
            color: rgba(255, 255, 255, 0.9);
            font-size: 12px;
            line-height: 1.5;
            position: relative;
            z-index: 1;
        }

        /* Voice Controls */
        .voice-controls {
            position: absolute;
            top: 10px;
            right: 20px;
            display: flex;
            gap: 8px;
            z-index: 1000;
        }

        .control-btn {
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            width: 44px;
            height: 44px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            position: relative;
        }

        .control-btn:hover {
            background: rgba(46, 139, 87, 0.3);
            border-color: #2E8B57;
            transform: scale(1.1);
        }

        .control-btn.active {
            background: rgba(46, 139, 87, 0.4);
            border-color: #2E8B57;
            box-shadow: 0 0 20px rgba(46, 139, 87, 0.5);
        }

        .control-tooltip {
            position: absolute;
            bottom: -30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9);
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 10px;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .control-btn:hover .control-tooltip {
            opacity: 1;
        }

        /* Loading Screen */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #2E8B57 0%, #3CB371 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            transition: opacity 1s ease;
        }

        .loading-content {
            text-align: center;
        }

        .loading-protection {
            font-size: 60px;
            animation: protection-pulse 1.5s ease-in-out infinite;
            margin-bottom: 20px;
        }

        .loading-text {
            color: white;
            font-size: 20px;
            margin-bottom: 20px;
        }

        .loading-progress {
            width: 200px;
            height: 4px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 2px;
            overflow: hidden;
        }

        .loading-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #2E8B57, #20B2AA);
            animation: loading 2s ease-in-out infinite;
        }

        @keyframes loading {
            0% { width: 0%; }
            50% { width: 100%; }
            100% { width: 0%; }
        }

        /* Voice Indicator */
        .voice-indicator {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(46, 139, 87, 0.5);
            border-radius: 30px;
            padding: 14px 28px;
            display: flex;
            align-items: center;
            gap: 12px;
            z-index: 1000;
            opacity: 0;
            transition: all 0.3s ease;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }

        .voice-indicator.visible {
            opacity: 1;
            transform: translateX(-50%) translateY(-10px);
        }

        .voice-waves {
            display: flex;
            align-items: center;
            gap: 3px;
        }

        .voice-wave {
            width: 3px;
            height: 20px;
            background: linear-gradient(180deg, #2E8B57, #20B2AA);
            border-radius: 2px;
            animation: voice-wave 1s ease-in-out infinite;
        }

        .voice-wave:nth-child(2) { animation-delay: 0.1s; }
        .voice-wave:nth-child(3) { animation-delay: 0.2s; }
        .voice-wave:nth-child(4) { animation-delay: 0.3s; }
        .voice-wave:nth-child(5) { animation-delay: 0.4s; }

        @keyframes voice-wave {
            0%, 100% { transform: scaleY(0.3); }
            50% { transform: scaleY(1); }
        }

        .narration-text {
            color: white;
            font-size: 13px;
            max-width: 300px;
        }

        /* Quick Actions */
        .quick-actions {
            position: absolute;
            bottom: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            z-index: 1000;
        }

        .action-btn {
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 10px 16px;
            border-radius: 25px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
        }

        .action-btn:hover {
            background: rgba(32, 178, 170, 0.3);
            border-color: #20B2AA;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(32, 178, 170, 0.3);
        }

        /* Custom Scrollbar */
        .info-panel::-webkit-scrollbar {
            width: 6px;
        }

        .info-panel::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 3px;
        }

        .info-panel::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, #2E8B57, #20B2AA);
            border-radius: 3px;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .info-panel {
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                top: auto;
                width: 100%;
                max-height: 50vh;
                border-radius: 20px 20px 0 0;
            }
            
            .journey-navigation {
                bottom: 52vh;
                max-width: calc(100% - 40px);
            }
            
            .voice-controls {
                top: auto;
                bottom: 55vh;
                right: 10px;
            }
            
            .quick-actions {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="bg-animation"></div>

    <!-- Loading Screen -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-content">
            <div class="loading-protection">üõ°Ô∏è</div>
            <div class="loading-text">Fortifying Plant Protection Systems...</div>
            <div class="loading-progress">
                <div class="loading-progress-bar"></div>
            </div>
        </div>
    </div>

    <!-- Museum Header -->
    <div class="museum-header">
        <div class="museum-title">Complex Tissues & Protection</div>
        <div class="exhibit-subtitle">
            <span class="protection-indicator"></span>
            Defense and Transport Systems
        </div>
    </div>

    <!-- Journey Navigation -->
    <div class="journey-navigation">
        <div class="journey-title">
            <span>üõ°Ô∏è</span>
            <span>Protection Journey</span>
        </div>
        <div class="journey-steps">
            <button class="journey-btn active" onclick="loadJourneyStep('introduction')">
                <span>üìö</span> Complex Tissues
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('epidermis')">
                <span>üõ°Ô∏è</span> Epidermis
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('stomata')">
                <span>üí®</span> Stomata
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('cork')">
                <span>üå∞</span> Cork
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('vascular')">
                <span>üö∞</span> Vascular
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('integration')">
                <span>üîÑ</span> Integration
            </button>
        </div>
    </div>

    <!-- 3D Model Container -->
    <div class="model-container">
        <div class="sketchfab-embed-wrapper">
            <iframe id="api-frame"
                    title="Plant Protection System" 
                    frameborder="0" 
                    allowfullscreen 
                    mozallowfullscreen="true" 
                    webkitallowfullscreen="true" 
                    allow="autoplay; fullscreen; xr-spatial-tracking"
                    xr-spatial-tracking 
                    execution-while-out-of-viewport 
                    execution-while-not-rendered 
                    web-share 
                    src="https://sketchfab.com/models/e71bfcf145c742cdbbde168d0f9736b8/embed?autostart=1&internal=1&tracking=0&ui_ar=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0">
            </iframe>
        </div>
    </div>

    <!-- Information Panel -->
    <div class="info-panel" id="infoPanel">
        <div class="info-header">
            <div class="info-icon" id="stepIcon">üìö</div>
            <div class="info-title">
                <h2 id="stepTitle">Complex Tissues</h2>
                <div class="info-subtitle" id="stepSubtitle">Multiple cell types working together</div>
            </div>
        </div>

        <!-- Progress Tracker -->
        <div class="progress-tracker">
            <div class="progress-header">
                <span>Protection Progress</span>
                <span class="progress-percentage" id="progressPercent">0%</span>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 0%"></div>
            </div>
            <div class="progress-steps-mini">
                <span class="step-mini active" onclick="loadJourneyStep('introduction')">Intro</span>
                <span class="step-mini" onclick="loadJourneyStep('epidermis')">Epider.</span>
                <span class="step-mini" onclick="loadJourneyStep('stomata')">Stomata</span>
                <span class="step-mini" onclick="loadJourneyStep('cork')">Cork</span>
                <span class="step-mini" onclick="loadJourneyStep('vascular')">Vascular</span>
                <span class="step-mini" onclick="loadJourneyStep('integration')">Integr.</span>
            </div>
        </div>

        <div class="info-content" id="mainDescription">
            Complex tissues contain multiple cell types working together for specialized functions. Unlike simple tissues with one cell type, complex tissues coordinate different cells to achieve sophisticated tasks like protection, transport, and controlled exchange with the environment.
        </div>

        <div class="info-card">
            <div class="info-card-title">
                <span>üî¨</span> Key Concepts
            </div>
            <div class="info-card-content">
                <ul class="info-list" id="keyConcepts">
                    <li>Multiple cell types in one tissue</li>
                    <li>Coordinated functions for complex tasks</li>
                    <li>Protection and transport specialization</li>
                    <li>Environmental interaction control</li>
                </ul>
            </div>
        </div>

        <div class="fun-fact">
            <div class="fun-fact-title">Tissue Teamwork</div>
            <div class="fun-fact-text" id="funFact">
                Complex tissues demonstrate that the whole is greater than the sum of its parts - different cell types collaborate to accomplish what no single cell type could achieve alone!
            </div>
        </div>

        <div class="info-card">
            <div class="info-card-title">
                <span>üéØ</span> Learning Objectives
            </div>
            <div class="info-card-content" id="learningObjectives">
                Understand how complex tissues use multiple cell types to achieve protection, transport, and controlled environmental exchange functions.
            </div>
        </div>
    </div>

    <!-- Voice Controls -->
    <div class="voice-controls">
        <button class="control-btn active" id="voiceToggle" onclick="toggleVoice()">
            üîä
            <span class="control-tooltip">Voice Narration</span>
        </button>
        <button class="control-btn" onclick="toggleAutoPlay()">
            ‚ñ∂Ô∏è
            <span class="control-tooltip">Auto Journey</span>
        </button>
        <button class="control-btn" onclick="toggleInfo()">
            ‚ÑπÔ∏è
            <span class="control-tooltip">Toggle Info</span>
        </button>
    </div>

    <!-- Quick Actions -->
    <div class="quick-actions">
        <button class="action-btn" onclick="startGuidedTour()">
            <span>üöÄ</span> Guided Tour
        </button>
        <button class="action-btn" onclick="showQuiz()">
            <span>üéØ</span> Test Knowledge
        </button>
    </div>

    <!-- Voice Indicator -->
    <div class="voice-indicator" id="voiceIndicator">
        <div class="voice-waves">
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
        </div>
        <div class="narration-text" id="narrationText">Narrating...</div>
    </div>

    <script>
        // Journey Step Data with Complete Educational Content
        const JOURNEY_DATA = {
            introduction: {
                title: "Complex Tissues",
                subtitle: "Multiple cell types working together",
                icon: "üìö",
                modelUrl: "https://sketchfab.com/models/e71bfcf145c742cdbbde168d0f9736b8/embed?autostart=1&internal=1&tracking=0&ui_ar=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "Complex tissues contain multiple cell types working together for specialized functions. Unlike simple tissues with one cell type, complex tissues coordinate different cells to achieve sophisticated tasks like protection, transport, and controlled exchange with the environment.",
                concepts: [
                    "Multiple cell types in one tissue",
                    "Coordinated functions for complex tasks",
                    "Protection and transport specialization",
                    "Environmental interaction control"
                ],
                funFact: "Complex tissues demonstrate that the whole is greater than the sum of its parts - different cell types collaborate to accomplish what no single cell type could achieve alone!",
                objectives: "Understand how complex tissues use multiple cell types to achieve protection, transport, and controlled environmental exchange functions.",
                narration: "Welcome to the sophisticated world of complex tissues! You're viewing a leaf cross-section that reveals the intricate organization of plant protection systems. While simple tissues use one cell type for basic functions, complex tissues coordinate multiple specialized cell types to accomplish remarkable feats. Think of complex tissues as specialized teams where each member has a different skill set, but together they achieve goals impossible for any individual. In plants, complex tissues handle the most challenging jobs: protecting the plant from environmental threats while still allowing necessary exchanges of gases and nutrients, and transporting materials throughout the plant body. The epidermis shields the plant while controlling gas exchange, cork provides secondary protection, and vascular tissues create highways for water and nutrient transport. Each complex tissue is an integrated system where structure, function, and teamwork create plant survival strategies that have evolved over millions of years."
            },
            epidermis: {
                title: "Epidermis - The Primary Shield",
                subtitle: "First line of defense with selective permeability",
                icon: "üõ°Ô∏è",
                modelUrl: "https://sketchfab.com/models/e71bfcf145c742cdbbde168d0f9736b8/embed?autostart=1&internal=1&tracking=0&ui_ar=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "The epidermis forms the outer protective layer of leaves and young stems. This complex tissue includes regular epidermal cells, specialized guard cells for gas exchange, and often protective structures like hairs and wax coatings. It must balance protection with the need for gas exchange and light penetration.",
                concepts: [
                    "Single layer of tightly packed cells",
                    "Waxy cuticle prevents water loss",
                    "Contains specialized cells for different functions",
                    "Transparent to allow light penetration"
                ],
                funFact: "The epidermis is like a smart membrane - it can distinguish between friend and foe, allowing beneficial exchanges while blocking harmful substances!",
                objectives: "Examine epidermal structure and understand how it provides protection while maintaining essential plant functions.",
                narration: "Here's the plant's primary defense system - the epidermis! In this leaf cross-section, you can see the upper and lower epidermal layers forming protective boundaries. The epidermis faces a complex challenge: it must protect the delicate internal tissues from physical damage, pathogens, and excessive water loss, while still allowing light to reach photosynthetic cells and permitting gas exchange for photosynthesis and respiration. Epidermal cells are typically flat and tightly fitted together like puzzle pieces, creating a continuous barrier. Many epidermal cells secrete a waxy cuticle that's like a natural waterproof coating. You might also see specialized epidermal cells called trichomes or leaf hairs that provide additional protection from insects, reduce air movement to minimize water loss, or even reflect excess sunlight. The transparency of most epidermal cells is crucial - they must be clear enough to let light through to the photosynthetic cells below. This tissue demonstrates how plants solve the fundamental challenge of being open systems that must interact with their environment while protecting themselves from its dangers."
            },
            stomata: {
                title: "Stomata and Guard Cells",
                subtitle: "Precision-controlled gateway system",
                icon: "üí®",
                modelUrl: "https://sketchfab.com/models/09188347727249ac8cf02d7ee2c15964/embed?autostart=1&internal=1&tracking=0&ui_ar=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "Stomata are microscopic pores in the epidermis controlled by specialized guard cells. These cellular valves regulate gas exchange and water loss with remarkable precision, responding to light, carbon dioxide levels, water availability, and other environmental factors.",
                concepts: [
                    "Guard cells control pore opening and closing",
                    "Respond to multiple environmental signals",
                    "Balance gas exchange with water conservation",
                    "Kidney-shaped cells with thick inner walls"
                ],
                funFact: "A single leaf can contain over 100,000 stomata, each one a microscopic valve that responds to environmental conditions in real-time!",
                objectives: "Analyze stomatal structure and understand the mechanisms controlling gas exchange and water regulation.",
                narration: "You're now examining one of nature's most sophisticated control systems - stomata and their guard cells! These microscopic gateways solve one of plant biology's biggest challenges: how to allow gas exchange for photosynthesis while controlling water loss. Each stoma consists of two kidney-shaped guard cells that can change shape to open or close the pore between them. When guard cells take up water, they swell and curve away from each other, opening the pore. When they lose water, they collapse together, closing the pore. But here's what makes this system remarkable: guard cells respond to multiple environmental signals simultaneously. They open in light when photosynthesis needs carbon dioxide, but close when water is scarce or when carbon dioxide levels are already high inside the leaf. The thick inner walls of guard cells are crucial to their function - they prevent the cells from swelling uniformly and force them to bend in a specific way. This elegant mechanism allows plants to 'breathe' and photosynthesize while maintaining careful control over their water balance."
            },
            cork: {
                title: "Cork Tissue - Secondary Protection",
                subtitle: "Protective bark formation in woody plants",
                icon: "üå∞",
                modelUrl: "https://sketchfab.com/models/4205428ed2c845adbf621ea833712fd9/embed?autostart=1&internal=1&tracking=0&ui_ar=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "Cork tissue forms the protective outer bark of woody plants and trees. Produced by cork cambium, these dead cells with thick, waxy walls provide excellent insulation and protection against fire, insects, and physical damage while allowing the plant to continue growing in diameter.",
                concepts: [
                    "Dead cells with thick, waxy walls",
                    "Forms protective bark layer",
                    "Excellent insulation properties",
                    "Allows continued radial growth"
                ],
                funFact: "Cork is so effective at protection that some tree species like cork oak and sequoia can survive forest fires that would destroy other plants!",
                objectives: "Understand cork formation and its role in protecting mature woody plants from environmental threats.",
                narration: "Welcome to the fortress walls of the plant kingdom - cork tissue! You're looking at tree bark, which is primarily composed of cork cells produced by a special meristematic tissue called cork cambium. As woody plants age, their original epidermis can no longer accommodate the increasing diameter of growing stems and roots. Cork tissue solves this problem by forming a new, expandable protective layer. Cork cells are remarkable because they sacrifice themselves for protection - they die at maturity but leave behind incredibly tough cell walls impregnated with suberin, a waxy substance that makes them nearly impermeable to water and gases. This creates multiple layers of protection: cork tissue insulates against temperature extremes, blocks pathogen entry, provides fire resistance, and protects against mechanical damage. The dead air spaces between cork cells make excellent insulation - that's why cork has been used for centuries in wine bottles and insulation materials. What's particularly clever about cork is that it forms in sheets that can split and peel as the tree grows, allowing the bark to expand without cracking the protective barrier."
            },
            vascular: {
                title: "Vascular Complex Tissues",
                subtitle: "Xylem and phloem transport systems",
                icon: "üö∞",
                modelUrl: "https://sketchfab.com/models/a8e93a28252c4717b50ff068a79f7c87/embed?autostart=1&internal=1&tracking=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_watermark=0",
                description: "Xylem and phloem are complex tissues that form the plant's circulatory system. Xylem transports water and minerals from roots to leaves using specialized vessel elements and tracheids, while phloem transports sugars and other organic compounds using sieve tube elements and companion cells.",
                concepts: [
                    "Xylem transports water and minerals upward",
                    "Phloem transports sugars and organic compounds",
                    "Multiple specialized cell types in each tissue",
                    "Forms continuous transport network"
                ],
                funFact: "Water can travel from a tree's roots to its highest leaves at speeds up to 150 feet per hour through xylem tissue - that's like a natural elevator system!",
                objectives: "Examine vascular tissue organization and understand how plants transport materials throughout their bodies.",
                narration: "You're now exploring the plant's highway system - the vascular tissues xylem and phloem! This cross-section reveals the intricate organization of plant transport systems. Xylem tissue is the plant's water delivery system, consisting of hollow, tube-like cells called vessel elements and tracheids. These cells die at maturity, leaving behind their reinforced cell walls to form continuous pipes that can transport water and dissolved minerals from roots to the highest leaves. The thick walls of xylem cells prevent collapse under the negative pressure created as water evaporates from leaves. Phloem tissue is the plant's food distribution network, transporting sugars produced by photosynthesis to all parts of the plant. Unlike xylem, phloem cells remain alive and include specialized sieve tube elements with perforated end walls that allow fluid flow, and companion cells that provide metabolic support. Both tissues also contain parenchyma cells for storage and sclerenchyma fibers for structural support. Together, xylem and phloem create a two-way transportation system that can move materials hundreds of feet vertically in large trees - a remarkable feat of biological engineering!"
            },
            integration: {
                title: "Integrated Protection System",
                subtitle: "How complex tissues work together",
                icon: "üîÑ",
                modelUrl: "https://sketchfab.com/models/e71bfcf145c742cdbbde168d0f9736b8/embed?autostart=1&internal=1&tracking=0&ui_ar=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "Plant complex tissues don't work in isolation - they form integrated systems where epidermis provides primary protection, stomata control exchange, cork offers secondary protection, and vascular tissues transport materials while maintaining structural integrity. This coordination allows plants to thrive in diverse environments.",
                concepts: [
                    "Multiple tissues coordinate for plant survival",
                    "Protection balanced with essential functions",
                    "Environmental responses involve tissue cooperation",
                    "Evolutionary solutions to conflicting demands"
                ],
                funFact: "During drought stress, stomata close to conserve water while cork and epidermis maintain protection, and vascular tissues adjust transport - it's like a coordinated emergency response system!",
                objectives: "Synthesize understanding of how complex tissues integrate to solve the challenges of plant survival and environmental adaptation.",
                narration: "Let's see how all these complex tissues work together as an integrated protection and transport system! Looking at this complete leaf cross-section, you can observe the remarkable coordination between different tissue systems. The epidermis provides the first line of defense while remaining transparent enough for photosynthesis. Stomata within the epidermis act as controllable valves, opening when the plant needs gas exchange and closing when water conservation is more important. The vascular bundles running through the leaf bring water and nutrients from the roots while taking away the sugars produced by photosynthesis. In woody plants, cork tissue eventually replaces the epidermis as the primary protective layer, allowing for continued growth while maintaining defense. What's truly remarkable is how these tissues respond to environmental challenges as a coordinated system. During hot, dry conditions, stomata close to prevent water loss, the waxy cuticle of the epidermis becomes more prominent, and vascular tissues may adjust their transport capacity. During pathogen attack, the epidermis may thicken, specialized cells may produce defensive compounds, and vascular tissues can isolate infected areas. This integration demonstrates how complex tissues represent evolutionary solutions to the fundamental challenge of being a stationary organism that must interact with a changing environment while maintaining protection and internal organization."
            }
        };

        // Global Variables
        let currentStep = 'introduction';
        let voiceEnabled = true;
        let autoPlayEnabled = false;
        let currentSpeech = null;
        let selectedVoice = null;
        let journeyProgress = 0;
        let guidedTourActive = false;

        // Initialize Voice System
        function initVoiceSystem() {
            if (!('speechSynthesis' in window)) {
                console.warn('Speech synthesis not supported');
                voiceEnabled = false;
                document.getElementById('voiceToggle').style.display = 'none';
                return;
            }

            function loadVoices() {
                const voices = speechSynthesis.getVoices();
                if (voices.length === 0) return;

                const preferredVoices = [
                    'Google UK English Female',
                    'Microsoft Sonia',
                    'Microsoft Hazel',
                    'Samantha',
                    'Victoria'
                ];

                for (const name of preferredVoices) {
                    selectedVoice = voices.find(v => v.name.includes(name));
                    if (selectedVoice) break;
                }

                if (!selectedVoice) {
                    selectedVoice = voices.find(v => v.lang.startsWith('en'));
                }
            }

            loadVoices();
            if (speechSynthesis.onvoiceschanged !== undefined) {
                speechSynthesis.onvoiceschanged = loadVoices;
            }
        }

        // Load Journey Step
        function loadJourneyStep(stepId) {
            const stepData = JOURNEY_DATA[stepId];
            if (!stepData) return;

            currentStep = stepId;
            
            document.getElementById('api-frame').src = stepData.modelUrl;
            
            document.getElementById('stepIcon').textContent = stepData.icon;
            document.getElementById('stepTitle').textContent = stepData.title;
            document.getElementById('stepSubtitle').textContent = stepData.subtitle;
            document.getElementById('mainDescription').textContent = stepData.description;
            
            const conceptsList = document.getElementById('keyConcepts');
            conceptsList.innerHTML = stepData.concepts.map(c => `<li>${c}</li>`).join('');
            
            document.getElementById('funFact').textContent = stepData.funFact;
            document.getElementById('learningObjectives').textContent = stepData.objectives;
            
            updateNavigationButtons(stepId);
            updateProgress();
            
            if (voiceEnabled) {
                speakText(stepData.narration);
            }
        }

        // Update Navigation Buttons
        function updateNavigationButtons(activeStep) {
            const buttons = document.querySelectorAll('.journey-btn');
            const steps = ['introduction', 'epidermis', 'stomata', 'cork', 'vascular', 'integration'];
            const activeIndex = steps.indexOf(activeStep);
            
            buttons.forEach((btn, index) => {
                btn.classList.remove('active', 'completed');
                if (index < activeIndex) {
                    btn.classList.add('completed');
                } else if (index === activeIndex) {
                    btn.classList.add('active');
                }
            });
            
            const miniSteps = document.querySelectorAll('.step-mini');
            miniSteps.forEach((step, index) => {
                step.classList.remove('active', 'completed');
                if (index < activeIndex) {
                    step.classList.add('completed');
                } else if (index === activeIndex) {
                    step.classList.add('active');
                }
            });
        }

        // Update Progress
        function updateProgress() {
            const steps = ['introduction', 'epidermis', 'stomata', 'cork', 'vascular', 'integration'];
            const currentIndex = steps.indexOf(currentStep);
            const progress = ((currentIndex + 1) / steps.length) * 100;
            
            document.getElementById('progressPercent').textContent = Math.round(progress) + '%';
            document.getElementById('progressFill').style.width = progress + '%';
        }

        // Speech Functions
        function speakText(text) {
            if (!voiceEnabled || !text) return;
            
            stopSpeech();
            
            currentSpeech = new SpeechSynthesisUtterance(text);
            if (selectedVoice) {
                currentSpeech.voice = selectedVoice;
            }
            currentSpeech.rate = 0.9;
            currentSpeech.pitch = 1.0;
            currentSpeech.volume = 0.9;
            
            currentSpeech.onstart = () => {
                document.getElementById('voiceIndicator').classList.add('visible');
                document.getElementById('narrationText').textContent = 
                    text.substring(0, 50) + (text.length > 50 ? '...' : '');
            };
            
            currentSpeech.onend = () => {
                document.getElementById('voiceIndicator').classList.remove('visible');
                currentSpeech = null;
                
                if (guidedTourActive) {
                    setTimeout(nextStep, 2000);
                }
            };
            
            speechSynthesis.speak(currentSpeech);
        }

        function stopSpeech() {
            if (currentSpeech) {
                speechSynthesis.cancel();
                currentSpeech = null;
                document.getElementById('voiceIndicator').classList.remove('visible');
            }
        }

        // Control Functions
        function toggleVoice() {
            voiceEnabled = !voiceEnabled;
            const btn = document.getElementById('voiceToggle');
            btn.textContent = voiceEnabled ? 'üîä' : 'üîá';
            btn.classList.toggle('active', voiceEnabled);
            
            if (!voiceEnabled) {
                stopSpeech();
            }
        }

        function toggleAutoPlay() {
            autoPlayEnabled = !autoPlayEnabled;
            if (autoPlayEnabled) {
                startGuidedTour();
            } else {
                guidedTourActive = false;
            }
        }

        function toggleInfo() {
            const panel = document.getElementById('infoPanel');
            panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
        }

        // Guided Tour
        function startGuidedTour() {
            guidedTourActive = true;
            const steps = ['introduction', 'epidermis', 'stomata', 'cork', 'vascular', 'integration'];
            let stepIndex = 0;
            
            function tourStep() {
                if (stepIndex < steps.length && guidedTourActive) {
                    loadJourneyStep(steps[stepIndex]);
                    stepIndex++;
                } else {
                    guidedTourActive = false;
                    if (voiceEnabled) {
                        speakText("Outstanding! You've mastered plant protection and transport systems. You now understand how complex tissues coordinate multiple cell types to solve the challenges of plant survival, from protection to transport to environmental adaptation.");
                    }
                }
            }
            
            tourStep();
            window.nextStep = tourStep;
        }

        // Quiz Function
        function showQuiz() {
            const questions = [
                "How does the epidermis balance protection with light penetration?",
                "What mechanisms allow guard cells to control stomatal opening?",
                "Why is cork tissue particularly effective for fire protection?",
                "How do xylem and phloem work together in transport?",
                "How do complex tissues coordinate during environmental stress?"
            ];
            
            const randomQ = questions[Math.floor(Math.random() * questions.length)];
            
            if (voiceEnabled) {
                speakText(`Time to test your complex tissue knowledge! Here's your question: ${randomQ} Think about how multiple cell types coordinate for plant survival!`);
            }
        }

        // Initialize
        function init() {
            initVoiceSystem();
            
            setTimeout(() => {
                const loading = document.getElementById('loadingOverlay');
                loading.style.opacity = '0';
                setTimeout(() => {
                    loading.style.display = 'none';
                    
                    if (voiceEnabled) {
                        speakText("Welcome to your exploration of complex tissues and plant protection systems! We'll discover how multiple cell types coordinate to achieve sophisticated protection, transport, and environmental control functions. Let's explore these remarkable biological partnerships!");
                    }
                }, 1000);
            }, 3000);
            
            document.addEventListener('keydown', (e) => {
                switch(e.key) {
                    case 'v': toggleVoice(); break;
                    case 'i': toggleInfo(); break;
                    case 'g': startGuidedTour(); break;
                    case 'Escape': stopSpeech(); guidedTourActive = false; break;
                    case 'ArrowRight': nextStep && nextStep(); break;
                }
            });
        }

        init();
    </script>
</body>
</html>