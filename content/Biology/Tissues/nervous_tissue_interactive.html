<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nervous Tissue - Communication and Control</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tween.js/18.6.4/tween.umd.js"></script>

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%);
            color: white;
            overflow: hidden;
            position: relative;
            height: 100vh;
        }

        /* Animated Background */
        .bg-animation {
            position: fixed;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: 0;
            opacity: 0.1;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 320"><path fill="%23ffffff" fill-opacity="0.2" d="M0,96L48,112C96,128,192,160,288,186.7C384,213,480,235,576,213.3C672,192,768,128,864,128C960,128,1056,192,1152,197.3C1248,203,1344,149,1392,122.7L1440,96L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z"></path></svg>') repeat-x;
            animation: wave 10s linear infinite;
        }

        @keyframes wave {
            0% { background-position-x: 0; }
            100% { background-position-x: 1440px; }
        }

        /* Museum Interface - Compact Header */
        .museum-header {
            position: absolute;
            top: 10px;
            left: 20px;
            text-align: left;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            padding: 10px 18px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .museum-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 4px;
            background: linear-gradient(45deg, #60a5fa, #a78bfa);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: titleGlow 3s ease-in-out infinite;
        }

        @keyframes titleGlow {
            0%, 100% { filter: brightness(1); }
            50% { filter: brightness(1.2); }
        }

        .exhibit-subtitle {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.8);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .neural-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            background: #60a5fa;
            border-radius: 50%;
            animation: neural-pulse 1s ease-in-out infinite;
        }

        @keyframes neural-pulse {
            0%, 100% { transform: scale(1); opacity: 1; box-shadow: 0 0 0 0 rgba(96, 165, 250, 0.7); }
            50% { transform: scale(1.2); opacity: 0.8; box-shadow: 0 0 0 10px rgba(96, 165, 250, 0); }
        }

        /* Journey Navigation - Enhanced */
        .journey-navigation {
            position: absolute;
            bottom: 20px;
            left: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            padding: 15px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            max-width: 300px;
        }

        .journey-title {
            font-size: 14px;
            font-weight: 600;
            color: #60a5fa;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .journey-steps {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }

        .journey-btn {
            background: rgba(96, 165, 250, 0.2);
            border: 1px solid rgba(96, 165, 250, 0.4);
            color: white;
            padding: 6px 10px;
            border-radius: 20px;
            font-size: 11px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 4px;
            white-space: nowrap;
        }

        .journey-btn:hover {
            background: rgba(96, 165, 250, 0.3);
            border-color: #60a5fa;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(96, 165, 250, 0.3);
        }

        .journey-btn.active {
            background: linear-gradient(135deg, #1e3a8a, #60a5fa);
            border-color: #1e3a8a;
            box-shadow: 0 0 20px rgba(30, 58, 138, 0.5);
            animation: pulse 2s infinite;
        }

        .journey-btn.completed {
            background: rgba(46, 204, 113, 0.3);
            border-color: #2ecc71;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        /* 3D Model Container */
        .model-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 0;
            overflow: hidden;
            border: none;
            z-index: 100;
        }

        .sketchfab-embed-wrapper {
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%);
        }

        .sketchfab-embed-wrapper iframe {
            width: 100%;
            height: 100%;
            border: none;
            border-radius: 0;
        }

        /* Information Panel - Enhanced */
        .info-panel {
            position: absolute;
            top: 70px;
            right: 20px;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(25px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 16px;
            padding: 24px;
            width: 380px;
            max-height: calc(100vh - 140px);
            z-index: 800;
            overflow-y: auto;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }

        .info-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        }

        .info-icon {
            font-size: 28px;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        .info-title {
            flex: 1;
        }

        .info-title h2 {
            font-size: 18px;
            color: #60a5fa;
            margin-bottom: 4px;
        }

        .info-subtitle {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.7);
        }

        .info-content {
            color: rgba(255, 255, 255, 0.9);
            font-size: 14px;
            line-height: 1.6;
        }

        /* Progress Tracker */
        .progress-tracker {
            background: linear-gradient(135deg, rgba(96, 165, 250, 0.1), rgba(30, 58, 138, 0.1));
            border: 1px solid rgba(96, 165, 250, 0.3);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 20px;
        }

        .progress-header {
            font-size: 13px;
            font-weight: 600;
            color: #60a5fa;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .progress-percentage {
            font-size: 18px;
            color: #1e3a8a;
            font-weight: 700;
        }

        .progress-bar {
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 12px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #60a5fa, #1e3a8a);
            border-radius: 4px;
            transition: width 0.8s ease;
            box-shadow: 0 0 10px rgba(30, 58, 138, 0.5);
        }

        .progress-steps-mini {
            display: flex;
            justify-content: space-between;
            font-size: 10px;
            color: rgba(255, 255, 255, 0.6);
        }

        .step-mini {
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .step-mini.active {
            color: #1e3a8a;
            font-weight: 600;
        }

        .step-mini.completed {
            color: #2ecc71;
        }

        /* Information Cards */
        .info-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 14px;
            margin-bottom: 14px;
        }

        .info-card-title {
            color: #60a5fa;
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .info-card-content {
            color: rgba(255, 255, 255, 0.85);
            font-size: 12px;
            line-height: 1.5;
        }

        .info-list {
            list-style: none;
            padding: 0;
        }

        .info-list li {
            padding: 6px 0;
            padding-left: 20px;
            position: relative;
            font-size: 12px;
            color: rgba(255, 255, 255, 0.8);
        }

        .info-list li:before {
            content: "⚡";
            position: absolute;
            left: 0;
            font-size: 10px;
        }

        /* Fun Fact Box */
        .fun-fact {
            background: linear-gradient(135deg, rgba(168, 85, 247, 0.1), rgba(139, 92, 246, 0.1));
            border: 1px solid rgba(168, 85, 247, 0.3);
            border-radius: 12px;
            padding: 14px;
            margin: 16px 0;
            position: relative;
            overflow: hidden;
        }

        .fun-fact:before {
            content: "🧠";
            position: absolute;
            top: -20px;
            right: -20px;
            font-size: 60px;
            opacity: 0.1;
        }

        .fun-fact-title {
            color: #a855f7;
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 6px;
        }

        .fun-fact-text {
            color: rgba(255, 255, 255, 0.9);
            font-size: 12px;
            line-height: 1.5;
            position: relative;
            z-index: 1;
        }

        /* Voice Controls */
        .voice-controls {
            position: absolute;
            top: 10px;
            right: 20px;
            display: flex;
            gap: 8px;
            z-index: 1000;
        }

        .control-btn {
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            width: 44px;
            height: 44px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            position: relative;
        }

        .control-btn:hover {
            background: rgba(30, 58, 138, 0.3);
            border-color: #1e3a8a;
            transform: scale(1.1);
        }

        .control-btn.active {
            background: rgba(30, 58, 138, 0.4);
            border-color: #1e3a8a;
            box-shadow: 0 0 20px rgba(30, 58, 138, 0.5);
        }

        .control-tooltip {
            position: absolute;
            bottom: -30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9);
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 10px;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .control-btn:hover .control-tooltip {
            opacity: 1;
        }

        /* Loading Screen */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            transition: opacity 1s ease;
        }

        .loading-content {
            text-align: center;
        }

        .loading-neural {
            font-size: 60px;
            animation: neural-pulse 1.5s ease-in-out infinite;
            margin-bottom: 20px;
        }

        .loading-text {
            color: white;
            font-size: 20px;
            margin-bottom: 20px;
        }

        .loading-progress {
            width: 200px;
            height: 4px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 2px;
            overflow: hidden;
        }

        .loading-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #1e3a8a, #60a5fa);
            animation: loading 2s ease-in-out infinite;
        }

        @keyframes loading {
            0% { width: 0%; }
            50% { width: 100%; }
            100% { width: 0%; }
        }

        /* Voice Indicator */
        .voice-indicator {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(30, 58, 138, 0.5);
            border-radius: 30px;
            padding: 14px 28px;
            display: flex;
            align-items: center;
            gap: 12px;
            z-index: 1000;
            opacity: 0;
            transition: all 0.3s ease;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }

        .voice-indicator.visible {
            opacity: 1;
            transform: translateX(-50%) translateY(-10px);
        }

        .voice-waves {
            display: flex;
            align-items: center;
            gap: 3px;
        }

        .voice-wave {
            width: 3px;
            height: 20px;
            background: linear-gradient(180deg, #1e3a8a, #60a5fa);
            border-radius: 2px;
            animation: voice-wave 1s ease-in-out infinite;
        }

        .voice-wave:nth-child(2) { animation-delay: 0.1s; }
        .voice-wave:nth-child(3) { animation-delay: 0.2s; }
        .voice-wave:nth-child(4) { animation-delay: 0.3s; }
        .voice-wave:nth-child(5) { animation-delay: 0.4s; }

        @keyframes voice-wave {
            0%, 100% { transform: scaleY(0.3); }
            50% { transform: scaleY(1); }
        }

        .narration-text {
            color: white;
            font-size: 13px;
            max-width: 300px;
        }

        /* Quick Actions */
        .quick-actions {
            position: absolute;
            bottom: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            z-index: 1000;
        }

        .action-btn {
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 10px 16px;
            border-radius: 25px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
        }

        .action-btn:hover {
            background: rgba(96, 165, 250, 0.3);
            border-color: #60a5fa;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(96, 165, 250, 0.3);
        }

        /* Custom Scrollbar */
        .info-panel::-webkit-scrollbar {
            width: 6px;
        }

        .info-panel::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 3px;
        }

        .info-panel::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, #1e3a8a, #60a5fa);
            border-radius: 3px;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .info-panel {
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                top: auto;
                width: 100%;
                max-height: 50vh;
                border-radius: 20px 20px 0 0;
            }
            
            .journey-navigation {
                bottom: 52vh;
                max-width: calc(100% - 40px);
            }
            
            .voice-controls {
                top: auto;
                bottom: 55vh;
                right: 10px;
            }
            
            .quick-actions {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="bg-animation"></div>

    <!-- Loading Screen -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-content">
            <div class="loading-neural">🧠</div>
            <div class="loading-text">Connecting Neural Networks...</div>
            <div class="loading-progress">
                <div class="loading-progress-bar"></div>
            </div>
        </div>
    </div>

    <!-- Museum Header -->
    <div class="museum-header">
        <div class="museum-title">Nervous Tissue</div>
        <div class="exhibit-subtitle">
            <span class="neural-indicator"></span>
            Communication and Control Systems
        </div>
    </div>

    <!-- Journey Navigation -->
    <div class="journey-navigation">
        <div class="journey-title">
            <span>🧠</span>
            <span>Neural Journey</span>
        </div>
        <div class="journey-steps">
            <button class="journey-btn active" onclick="loadJourneyStep('introduction')">
                <span>📖</span> Overview
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('structure')">
                <span>🏗️</span> Structure
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('dendrites')">
                <span>🌿</span> Dendrites
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('impulse')">
                <span>⚡</span> Impulse
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('networks')">
                <span>🔗</span> Networks
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('integration')">
                <span>🤝</span> Integration
            </button>
        </div>
    </div>

    <!-- 3D Model Container -->
    <div class="model-container">
        <div class="sketchfab-embed-wrapper">
            <iframe id="api-frame"
                    title="Nervous Tissue Structure" 
                    frameborder="0" 
                    allowfullscreen 
                    mozallowfullscreen="true" 
                    webkitallowfullscreen="true" 
                    allow="autoplay; fullscreen; xr-spatial-tracking"
                    xr-spatial-tracking 
                    execution-while-out-of-viewport 
                    execution-while-not-rendered 
                    web-share 
                    src="https://sketchfab.com/models/20e930a5fae5457fa6d1738afa00c7bb/embed?autostart=1&internal=1&tracking=0&ui_ar=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0">
            </iframe>
        </div>
    </div>

    <!-- Information Panel -->
    <div class="info-panel" id="infoPanel">
        <div class="info-header">
            <div class="info-icon" id="stepIcon">📖</div>
            <div class="info-title">
                <h2 id="stepTitle">Nervous Tissue</h2>
                <div class="info-subtitle" id="stepSubtitle">Specialized for rapid communication and control</div>
            </div>
        </div>

        <!-- Progress Tracker -->
        <div class="progress-tracker">
            <div class="progress-header">
                <span>Neural Understanding</span>
                <span class="progress-percentage" id="progressPercent">0%</span>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 0%"></div>
            </div>
            <div class="progress-steps-mini">
                <span class="step-mini active" onclick="loadJourneyStep('introduction')">Intro</span>
                <span class="step-mini" onclick="loadJourneyStep('structure')">Struct.</span>
                <span class="step-mini" onclick="loadJourneyStep('dendrites')">Dendr.</span>
                <span class="step-mini" onclick="loadJourneyStep('impulse')">Impulse</span>
                <span class="step-mini" onclick="loadJourneyStep('networks')">Network</span>
                <span class="step-mini" onclick="loadJourneyStep('integration')">Integr.</span>
            </div>
        </div>

        <div class="info-content" id="mainDescription">
            Nervous tissue is the body's communication network, specialized for receiving, processing, and transmitting information through electrical and chemical signals. Composed primarily of neurons and supporting glial cells, nervous tissue enables rapid responses to environmental changes and coordinates all body functions.
        </div>

        <div class="info-card">
            <div class="info-card-title">
                <span>⚡</span> Key Concepts
            </div>
            <div class="info-card-content">
                <ul class="info-list" id="keyConcepts">
                    <li>Neurons are specialized for communication</li>
                    <li>Electrical signals travel along cell membranes</li>
                    <li>Chemical signals cross synapses</li>
                    <li>Integration enables complex responses</li>
                </ul>
            </div>
        </div>

        <div class="fun-fact">
            <div class="fun-fact-title">Neural Speed</div>
            <div class="fun-fact-text" id="funFact">
                Nerve impulses can travel at speeds up to 120 meters per second - that's over 250 miles per hour, faster than most race cars!
            </div>
        </div>

        <div class="info-card">
            <div class="info-card-title">
                <span>🎯</span> Learning Objectives
            </div>
            <div class="info-card-content" id="learningObjectives">
                Understand neuron structure and function, learn how nerve impulses are generated and transmitted, and explore how nervous tissue integrates with other tissues.
            </div>
        </div>
    </div>

    <!-- Voice Controls -->
    <div class="voice-controls">
        <button class="control-btn active" id="voiceToggle" onclick="toggleVoice()">
            🔊
            <span class="control-tooltip">Voice Narration</span>
        </button>
        <button class="control-btn" onclick="toggleAutoPlay()">
            ▶️
            <span class="control-tooltip">Auto Journey</span>
        </button>
        <button class="control-btn" onclick="toggleInfo()">
            ℹ️
            <span class="control-tooltip">Toggle Info</span>
        </button>
    </div>

    <!-- Quick Actions -->
    <div class="quick-actions">
        <button class="action-btn" onclick="startGuidedTour()">
            <span>🚀</span> Guided Tour
        </button>
        <button class="action-btn" onclick="showQuiz()">
            <span>🎯</span> Test Knowledge
        </button>
    </div>

    <!-- Voice Indicator -->
    <div class="voice-indicator" id="voiceIndicator">
        <div class="voice-waves">
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
        </div>
        <div class="narration-text" id="narrationText">Narrating...</div>
    </div>

    <script>
        // Journey Step Data with Complete Educational Content
        const JOURNEY_DATA = {
            introduction: {
                title: "Nervous Tissue",
                subtitle: "Specialized for rapid communication and control",
                icon: "📖",
                modelUrl: "https://sketchfab.com/models/20e930a5fae5457fa6d1738afa00c7bb/embed?autostart=1&internal=1&tracking=0&ui_ar=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "Nervous tissue is the body's communication network, specialized for receiving, processing, and transmitting information through electrical and chemical signals. Composed primarily of neurons and supporting glial cells, nervous tissue enables rapid responses to environmental changes and coordinates all body functions.",
                concepts: [
                    "Neurons are specialized for communication",
                    "Electrical signals travel along cell membranes",
                    "Chemical signals cross synapses",
                    "Integration enables complex responses"
                ],
                funFact: "Nerve impulses can travel at speeds up to 120 meters per second - that's over 250 miles per hour, faster than most race cars!",
                objectives: "Understand neuron structure and function, learn how nerve impulses are generated and transmitted, and explore how nervous tissue integrates with other tissues.",
                narration: "Welcome to the remarkable world of nervous tissue - your body's high-speed communication network! You're viewing neurons, the specialized cells that make thinking, feeling, and moving possible. Nervous tissue is fundamentally different from all other tissues because it's designed for one primary purpose: rapid, long-distance communication. While other tissues might contract, secrete, or provide support, nervous tissue processes information and coordinates responses throughout your body. The nervous system is like the body's internet, with neurons serving as both the cables and the computers. These cells can receive information from multiple sources, process that information, and then send signals to other neurons, muscles, or glands. What makes this even more amazing is the speed - electrical signals race along neuron membranes at incredible velocities, allowing you to react to stimuli in milliseconds. The nervous tissue consists mainly of neurons for communication and glial cells that support, protect, and nourish the neurons. Together, they create a network so sophisticated that it can store memories, generate thoughts, control movements, and maintain all the automatic functions that keep you alive."
            },
            structure: {
                title: "Neuron Structure",
                subtitle: "Anatomy of the communication cell",
                icon: "🏗️",
                modelUrl: "https://sketchfab.com/models/bbf5747eeb1340109128ef36c966d543/embed?autostart=1&internal=1&tracking=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "A typical neuron consists of three main parts: dendrites that receive signals, a cell body containing the nucleus and most organelles, and an axon that transmits signals to other cells. This specialized structure enables neurons to function as living communication cables.",
                concepts: [
                    "Dendrites receive incoming signals",
                    "Cell body contains nucleus and organelles",
                    "Axon transmits signals away from cell body",
                    "Synapses connect neurons to other cells"
                ],
                funFact: "A single neuron can receive input from thousands of other neurons through its branching dendrites!",
                objectives: "Identify the major components of a neuron and understand how each part contributes to the cell's communication function.",
                narration: "Here's a detailed look at neuron structure - nature's solution to long-distance cellular communication! Notice how different this cell looks from other body cells you've studied. The neuron has three distinct regions, each specialized for a specific aspect of communication. The dendrites are the neuron's receiving stations - these branched projections extend out from the cell body like the branches of a tree. Their name actually comes from the Greek word for tree! Dendrites are covered with receptors that can detect chemical signals from other neurons. The more dendrites a neuron has, the more information it can receive and process. The cell body, or soma, contains the nucleus and most of the neuron's organelles. This is where the cell's metabolic activities occur and where the decision is made whether to send a signal down the axon. The axon is the neuron's transmission line - a long projection that can extend from less than a millimeter to over a meter in length! The axon carries electrical signals away from the cell body toward other neurons, muscles, or glands. At the end of the axon are synaptic terminals that release chemical messengers to communicate with the next cell in the pathway. This specialized structure allows a single neuron to receive information from many sources, integrate that information, and then influence many target cells."
            },
            dendrites: {
                title: "Dendrites - The Receivers",
                subtitle: "Input stations of the neuron",
                icon: "🌿",
                modelUrl: "https://sketchfab.com/models/f67f9683e3f94f7da6ea1810d160a129/embed?autostart=1&internal=1&tracking=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "Dendrites are highly branched extensions that increase the neuron's surface area for receiving signals. They contain receptors for neurotransmitters and can process multiple inputs simultaneously, acting like the neuron's sensory antennae to gather information from the neural network.",
                concepts: [
                    "Highly branched to maximize surface area",
                    "Contain neurotransmitter receptors",
                    "Process multiple simultaneous inputs",
                    "Generate local electrical changes"
                ],
                funFact: "Some neurons have dendritic trees so complex that if you could stretch them out, they would span several millimeters - huge for a microscopic structure!",
                objectives: "Examine dendritic structure and understand how branching patterns enable neurons to integrate multiple signals.",
                narration: "Take a closer look at dendrites - the neuron's sophisticated input system! These intricate branching structures are like the neuron's sensory antennae, designed to capture and process incoming signals from other neurons. The extensive branching you see serves a crucial purpose: it dramatically increases the surface area available for receiving chemical messages. Think of dendrites as the neuron's social network - the more branches they have, the more connections they can make with other neurons. Each branch can have specialized receptors for different types of neurotransmitters, allowing the neuron to receive various kinds of information simultaneously. What's remarkable about dendrites is their ability to perform local processing. When neurotransmitters bind to receptors on dendritic branches, they create small electrical changes called graded potentials. These potentials can add up or cancel each other out as they travel toward the cell body. This means dendrites aren't just passive receivers - they're actively processing and integrating information. The pattern of dendritic branching can also change throughout life based on experience and learning, allowing neurons to form new connections and strengthen existing ones. This plasticity is fundamental to how your brain adapts and learns."
            },
            impulse: {
                title: "Action Potential - The Nerve Impulse",
                subtitle: "Electrical signaling in neurons",
                icon: "⚡",
                modelUrl: "https://sketchfab.com/models/c7ca6da31f5848748f7ba7ccb2508266/embed?autostart=1&internal=1&tracking=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "The action potential is a rapid change in electrical charge that travels along the neuron's membrane. This all-or-nothing electrical signal is the fundamental unit of neural communication, allowing information to travel rapidly over long distances without degradation.",
                concepts: [
                    "All-or-nothing electrical signal",
                    "Caused by ion movement across membrane",
                    "Travels without losing strength",
                    "Triggers neurotransmitter release"
                ],
                funFact: "An action potential lasts only about 1 millisecond, but in that tiny fraction of a second, millions of sodium and potassium ions rush across the neuron membrane!",
                objectives: "Understand how action potentials are generated and how they enable rapid, long-distance communication in the nervous system.",
                narration: "Now you're witnessing the action potential - the electrical spark that powers all neural communication! This is one of biology's most elegant solutions to the problem of long-distance cellular communication. An action potential is like a wave of electrical activity that races along the neuron's membrane at incredible speeds. The process begins when the electrical charge inside the neuron reaches a critical threshold. At this point, voltage-gated sodium channels snap open, allowing sodium ions to flood into the cell. This sudden influx of positive charge creates the rising phase of the action potential. Almost immediately, potassium channels open and sodium channels close, allowing potassium to flow out and restore the negative charge inside the cell. What makes action potentials so remarkable is that they're all-or-nothing events - they either happen completely or not at all. This ensures that the signal doesn't weaken as it travels along the axon. The action potential regenerates itself at each point along the membrane, like a domino effect, allowing the signal to travel from the cell body all the way to the axon terminals without losing strength. When the action potential reaches the synaptic terminals, it triggers the release of chemical neurotransmitters, converting the electrical signal back into a chemical one to communicate with the next cell."
            },
            networks: {
                title: "Neural Networks",
                subtitle: "Interconnected communication systems",
                icon: "🔗",
                modelUrl: "https://sketchfab.com/models/20e930a5fae5457fa6d1738afa00c7bb/embed?autostart=1&internal=1&tracking=0&ui_ar=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "Neurons function not in isolation but as part of vast interconnected networks. These neural circuits process information through complex patterns of connections, allowing for sophisticated behaviors like learning, memory, and coordinated movement.",
                concepts: [
                    "Neurons form complex interconnected circuits",
                    "Information flows through network pathways",
                    "Parallel processing enables fast responses",
                    "Network plasticity allows learning"
                ],
                funFact: "Your brain contains approximately 86 billion neurons, each connecting to thousands of others, creating over 100 trillion synaptic connections!",
                objectives: "Explore how individual neurons work together in networks to create complex behaviors and information processing capabilities.",
                narration: "Here you see multiple neurons working together as a network - the true power of nervous tissue! Individual neurons are impressive, but when they connect into networks, they become capable of extraordinary feats of information processing. Think of neural networks like a vast city with interconnected highways, side streets, and local roads. Information can travel along multiple pathways simultaneously, creating the parallel processing that makes rapid decision-making possible. In these networks, some neurons act as input sensors, gathering information from the environment. Others serve as interneurons, processing and integrating that information. Still others are output neurons that control muscles or glands. The connections between neurons aren't fixed - they can strengthen or weaken based on use, and new connections can form throughout life. This plasticity is what allows you to learn new skills, form memories, and adapt to new situations. The network also shows redundancy - if one pathway is damaged, information can often find alternative routes to reach its destination. What you're seeing represents just a tiny fraction of the neural networks in your nervous system, yet even this small sample demonstrates the incredible complexity that emerges when millions of these communication specialists work together as a coordinated system."
            },
            integration: {
                title: "Neural-Muscle Integration",
                subtitle: "How nervous tissue controls movement",
                icon: "🤝",
                modelUrl: "https://sketchfab.com/models/bbf5747eeb1340109128ef36c966d543/embed?autostart=1&internal=1&tracking=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "Nervous tissue integrates with muscle tissue to create coordinated movement. Motor neurons transmit signals from the brain and spinal cord to muscle fibers, while sensory neurons provide feedback about muscle position and tension, creating sophisticated motor control systems.",
                concepts: [
                    "Motor neurons control muscle contraction",
                    "Sensory neurons provide movement feedback",
                    "Integration occurs in spinal cord and brain",
                    "Reflexes provide rapid protective responses"
                ],
                funFact: "The connection between a motor neuron and muscle fiber is so precise that one action potential in the neuron always triggers one muscle contraction!",
                objectives: "Understand how nervous tissue coordinates with muscle tissue to produce controlled, purposeful movement and protective reflexes.",
                narration: "This demonstrates how nervous tissue integrates with muscle tissue to create the miracle of controlled movement! The relationship between neurons and muscles is one of the most important partnerships in your body. Motor neurons are the command officers that deliver instructions from your brain and spinal cord directly to muscle fibers. Each motor neuron branches to connect with multiple muscle fibers, forming what's called a motor unit. When an action potential travels down the motor neuron and reaches the muscle, it triggers the release of acetylcholine at the neuromuscular junction. This neurotransmitter causes the muscle fiber to contract, converting the electrical signal into mechanical force. But this is only half of the story! Sensory neurons embedded in muscles and tendons constantly monitor what's happening - they detect how much the muscle is stretched, how much force it's generating, and what position your limbs are in. This sensory information travels back to the spinal cord and brain, providing the feedback necessary for smooth, coordinated movement. The integration of these motor and sensory signals allows for incredibly precise control. Whether you're writing with a pen or lifting a heavy object, your nervous system is constantly adjusting muscle activity based on sensory feedback. This neural-muscle partnership also enables protective reflexes that can respond faster than conscious thought, pulling your hand away from danger before you're even aware of the threat."
            }
        };

        // Global Variables
        let currentStep = 'introduction';
        let voiceEnabled = true;
        let autoPlayEnabled = false;
        let currentSpeech = null;
        let selectedVoice = null;
        let journeyProgress = 0;
        let guidedTourActive = false;

        // Initialize Voice System
        function initVoiceSystem() {
            if (!('speechSynthesis' in window)) {
                console.warn('Speech synthesis not supported');
                voiceEnabled = false;
                document.getElementById('voiceToggle').style.display = 'none';
                return;
            }

            function loadVoices() {
                const voices = speechSynthesis.getVoices();
                if (voices.length === 0) return;

                const preferredVoices = [
                    'Google UK English Female',
                    'Microsoft Sonia',
                    'Microsoft Hazel',
                    'Samantha',
                    'Victoria'
                ];

                for (const name of preferredVoices) {
                    selectedVoice = voices.find(v => v.name.includes(name));
                    if (selectedVoice) break;
                }

                if (!selectedVoice) {
                    selectedVoice = voices.find(v => v.lang.startsWith('en'));
                }
            }

            loadVoices();
            if (speechSynthesis.onvoiceschanged !== undefined) {
                speechSynthesis.onvoiceschanged = loadVoices;
            }
        }

        // Load Journey Step
        function loadJourneyStep(stepId) {
            const stepData = JOURNEY_DATA[stepId];
            if (!stepData) return;

            currentStep = stepId;
            
            document.getElementById('api-frame').src = stepData.modelUrl;
            
            document.getElementById('stepIcon').textContent = stepData.icon;
            document.getElementById('stepTitle').textContent = stepData.title;
            document.getElementById('stepSubtitle').textContent = stepData.subtitle;
            document.getElementById('mainDescription').textContent = stepData.description;
            
            const conceptsList = document.getElementById('keyConcepts');
            conceptsList.innerHTML = stepData.concepts.map(c => `<li>${c}</li>`).join('');
            
            document.getElementById('funFact').textContent = stepData.funFact;
            document.getElementById('learningObjectives').textContent = stepData.objectives;
            
            updateNavigationButtons(stepId);
            updateProgress();
            
            if (voiceEnabled) {
                speakText(stepData.narration);
            }
        }

        // Update Navigation Buttons
        function updateNavigationButtons(activeStep) {
            const buttons = document.querySelectorAll('.journey-btn');
            const steps = ['introduction', 'structure', 'dendrites', 'impulse', 'networks', 'integration'];
            const activeIndex = steps.indexOf(activeStep);
            
            buttons.forEach((btn, index) => {
                btn.classList.remove('active', 'completed');
                if (index < activeIndex) {
                    btn.classList.add('completed');
                } else if (index === activeIndex) {
                    btn.classList.add('active');
                }
            });
            
            const miniSteps = document.querySelectorAll('.step-mini');
            miniSteps.forEach((step, index) => {
                step.classList.remove('active', 'completed');
                if (index < activeIndex) {
                    step.classList.add('completed');
                } else if (index === activeIndex) {
                    step.classList.add('active');
                }
            });
        }

        // Update Progress
        function updateProgress() {
            const steps = ['introduction', 'structure', 'dendrites', 'impulse', 'networks', 'integration'];
            const currentIndex = steps.indexOf(currentStep);
            const progress = ((currentIndex + 1) / steps.length) * 100;
            
            document.getElementById('progressPercent').textContent = Math.round(progress) + '%';
            document.getElementById('progressFill').style.width = progress + '%';
        }

        // Speech Functions
        function speakText(text) {
            if (!voiceEnabled || !text) return;
            
            stopSpeech();
            
            currentSpeech = new SpeechSynthesisUtterance(text);
            if (selectedVoice) {
                currentSpeech.voice = selectedVoice;
            }
            currentSpeech.rate = 0.9;
            currentSpeech.pitch = 1.0;
            currentSpeech.volume = 0.9;
            
            currentSpeech.onstart = () => {
                document.getElementById('voiceIndicator').classList.add('visible');
                document.getElementById('narrationText').textContent = 
                    text.substring(0, 50) + (text.length > 50 ? '...' : '');
            };
            
            currentSpeech.onend = () => {
                document.getElementById('voiceIndicator').classList.remove('visible');
                currentSpeech = null;
                
                if (guidedTourActive) {
                    setTimeout(nextStep, 2000);
                }
            };
            
            speechSynthesis.speak(currentSpeech);
        }

        function stopSpeech() {
            if (currentSpeech) {
                speechSynthesis.cancel();
                currentSpeech = null;
                document.getElementById('voiceIndicator').classList.remove('visible');
            }
        }

        // Control Functions
        function toggleVoice() {
            voiceEnabled = !voiceEnabled;
            const btn = document.getElementById('voiceToggle');
            btn.textContent = voiceEnabled ? '🔊' : '🔇';
            btn.classList.toggle('active', voiceEnabled);
            
            if (!voiceEnabled) {
                stopSpeech();
            }
        }

        function toggleAutoPlay() {
            autoPlayEnabled = !autoPlayEnabled;
            if (autoPlayEnabled) {
                startGuidedTour();
            } else {
                guidedTourActive = false;
            }
        }

        function toggleInfo() {
            const panel = document.getElementById('infoPanel');
            panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
        }

        // Guided Tour
        function startGuidedTour() {
            guidedTourActive = true;
            const steps = ['introduction', 'structure', 'dendrites', 'impulse', 'networks', 'integration'];
            let stepIndex = 0;
            
            function tourStep() {
                if (stepIndex < steps.length && guidedTourActive) {
                    loadJourneyStep(steps[stepIndex]);
                    stepIndex++;
                } else {
                    guidedTourActive = false;
                    if (voiceEnabled) {
                        speakText("Excellent! You've mastered nervous tissue and neural communication. You now understand how neurons receive, process, and transmit information through electrical and chemical signals, and how they integrate with other tissues to control body functions. The nervous system truly is the body's master control network!");
                    }
                }
            }
            
            tourStep();
            window.nextStep = tourStep;
        }

        // Quiz Function
        function showQuiz() {
            const questions = [
                "What are the three main parts of a neuron and their functions?",
                "How do dendrites increase a neuron's ability to receive signals?",
                "Why are action potentials called 'all-or-nothing' events?",
                "How do neural networks enable complex information processing?",
                "How does nervous tissue coordinate with muscle tissue for movement?"
            ];
            
            const randomQ = questions[Math.floor(Math.random() * questions.length)];
            
            if (voiceEnabled) {
                speakText(`Time to test your neural knowledge! Here's your question: ${randomQ} Think about how structure enables the remarkable functions of nervous tissue!`);
            }
        }

        // Initialize
        function init() {
            initVoiceSystem();
            
            setTimeout(() => {
                const loading = document.getElementById('loadingOverlay');
                loading.style.opacity = '0';
                setTimeout(() => {
                    loading.style.display = 'none';
                    
                    if (voiceEnabled) {
                        speakText("Welcome to your exploration of nervous tissue! We'll discover how neurons are specialized for rapid communication, learn about nerve impulse transmission, and explore how nervous tissue integrates with other systems. Let's connect to the body's amazing communication network!");
                    }
                }, 1000);
            }, 3000);
            
            document.addEventListener('keydown', (e) => {
                switch(e.key) {
                    case 'v': toggleVoice(); break;
                    case 'i': toggleInfo(); break;
                    case 'g': startGuidedTour(); break;
                    case 'Escape': stopSpeech(); guidedTourActive = false; break;
                    case 'ArrowRight': nextStep && nextStep(); break;
                }
            });
        }

        init();
    </script>
</body>
</html>