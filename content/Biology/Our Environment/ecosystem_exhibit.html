<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ecosystem Components and Interactions - Complete Ecological Journey</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tween.js/18.6.4/tween.umd.js"></script>

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #2d5a27 0%, #56ab91 100%);
            color: white;
            overflow: hidden;
            position: relative;
            height: 100vh;
        }

        /* Animated Background */
        .bg-animation {
            position: fixed;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: 0;
            opacity: 0.1;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 320"><path fill="%23ffffff" fill-opacity="0.2" d="M0,96L48,112C96,128,192,160,288,186.7C384,213,480,235,576,213.3C672,192,768,128,864,128C960,128,1056,192,1152,197.3C1248,203,1344,149,1392,122.7L1440,96L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z"></path></svg>') repeat-x;
            animation: wave 10s linear infinite;
        }

        @keyframes wave {
            0% { background-position-x: 0; }
            100% { background-position-x: 1440px; }
        }

        /* Museum Interface - Compact Header */
        .museum-header {
            position: absolute;
            top: 10px;
            left: 20px;
            text-align: left;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            padding: 10px 18px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .museum-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 4px;
            background: linear-gradient(45deg, #2ecc71, #27ae60);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: titleGlow 3s ease-in-out infinite;
        }

        @keyframes titleGlow {
            0%, 100% { filter: brightness(1); }
            50% { filter: brightness(1.2); }
        }

        .exhibit-subtitle {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.8);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .ecosystem-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            background: #2ecc71;
            border-radius: 50%;
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.3); opacity: 0.7; }
        }

        /* Journey Navigation - Enhanced */
        .journey-navigation {
            position: absolute;
            bottom: 20px;
            left: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            padding: 15px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            max-width: 280px;
        }

        .journey-title {
            font-size: 14px;
            font-weight: 600;
            color: #2ecc71;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .journey-steps {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }

        .journey-btn {
            background: rgba(46, 204, 113, 0.2);
            border: 1px solid rgba(46, 204, 113, 0.4);
            color: white;
            padding: 6px 10px;
            border-radius: 20px;
            font-size: 11px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 4px;
            white-space: nowrap;
        }

        .journey-btn:hover {
            background: rgba(46, 204, 113, 0.3);
            border-color: #2ecc71;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(46, 204, 113, 0.3);
        }

        .journey-btn.active {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            border-color: #2ecc71;
            box-shadow: 0 0 20px rgba(46, 204, 113, 0.5);
            animation: ecosystemPulse 2s infinite;
        }

        .journey-btn.completed {
            background: rgba(52, 152, 219, 0.3);
            border-color: #3498db;
        }

        @keyframes ecosystemPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        /* 3D Model Container */
        .model-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 0;
            overflow: hidden;
            border: none;
            z-index: 100;
        }

        .sketchfab-embed-wrapper {
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #2d5a27 0%, #56ab91 100%);
        }

        .sketchfab-embed-wrapper iframe {
            width: 100%;
            height: 100%;
            border: none;
            border-radius: 0;
        }

        /* Information Panel - Enhanced */
        .info-panel {
            position: absolute;
            top: 70px;
            right: 20px;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(25px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 16px;
            padding: 24px;
            width: 380px;
            max-height: calc(100vh - 140px);
            z-index: 800;
            overflow-y: auto;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }

        .info-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        }

        .info-icon {
            font-size: 28px;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        .info-title {
            flex: 1;
        }

        .info-title h2 {
            font-size: 18px;
            color: #2ecc71;
            margin-bottom: 4px;
        }

        .info-subtitle {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.7);
        }

        .info-content {
            color: rgba(255, 255, 255, 0.9);
            font-size: 14px;
            line-height: 1.6;
        }

        /* Progress Tracker */
        .progress-tracker {
            background: linear-gradient(135deg, rgba(46, 204, 113, 0.1), rgba(39, 174, 96, 0.1));
            border: 1px solid rgba(46, 204, 113, 0.3);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 20px;
        }

        .progress-header {
            font-size: 13px;
            font-weight: 600;
            color: #2ecc71;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .progress-percentage {
            font-size: 18px;
            color: #27ae60;
            font-weight: 700;
        }

        .progress-bar {
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 12px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #27ae60, #2ecc71);
            border-radius: 4px;
            transition: width 0.8s ease;
            box-shadow: 0 0 10px rgba(46, 204, 113, 0.5);
        }

        .progress-steps-mini {
            display: flex;
            justify-content: space-between;
            font-size: 10px;
            color: rgba(255, 255, 255, 0.6);
        }

        .step-mini {
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .step-mini.active {
            color: #2ecc71;
            font-weight: 600;
        }

        .step-mini.completed {
            color: #3498db;
        }

        /* Information Cards */
        .info-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 14px;
            margin-bottom: 14px;
        }

        .info-card-title {
            color: #2ecc71;
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .info-card-content {
            color: rgba(255, 255, 255, 0.85);
            font-size: 12px;
            line-height: 1.5;
        }

        .info-list {
            list-style: none;
            padding: 0;
        }

        .info-list li {
            padding: 6px 0;
            padding-left: 20px;
            position: relative;
            font-size: 12px;
            color: rgba(255, 255, 255, 0.8);
        }

        .info-list li:before {
            content: "→";
            position: absolute;
            left: 0;
            color: #2ecc71;
        }

        /* Fun Fact Box */
        .fun-fact {
            background: linear-gradient(135deg, rgba(52, 152, 219, 0.1), rgba(46, 204, 113, 0.1));
            border: 1px solid rgba(52, 152, 219, 0.3);
            border-radius: 12px;
            padding: 14px;
            margin: 16px 0;
            position: relative;
            overflow: hidden;
        }

        .fun-fact:before {
            content: "🌱";
            position: absolute;
            top: -20px;
            right: -20px;
            font-size: 60px;
            opacity: 0.1;
        }

        .fun-fact-title {
            color: #3498db;
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 6px;
        }

        .fun-fact-text {
            color: rgba(255, 255, 255, 0.9);
            font-size: 12px;
            line-height: 1.5;
            position: relative;
            z-index: 1;
        }

        /* Voice Controls */
        .voice-controls {
            position: absolute;
            top: 10px;
            right: 20px;
            display: flex;
            gap: 8px;
            z-index: 1000;
        }

        .control-btn {
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            width: 44px;
            height: 44px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            position: relative;
        }

        .control-btn:hover {
            background: rgba(46, 204, 113, 0.3);
            border-color: #2ecc71;
            transform: scale(1.1);
        }

        .control-btn.active {
            background: rgba(46, 204, 113, 0.4);
            border-color: #2ecc71;
            box-shadow: 0 0 20px rgba(46, 204, 113, 0.5);
        }

        .control-tooltip {
            position: absolute;
            bottom: -30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9);
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 10px;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .control-btn:hover .control-tooltip {
            opacity: 1;
        }

        /* Loading Screen */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #2d5a27 0%, #56ab91 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            transition: opacity 1s ease;
        }

        .loading-content {
            text-align: center;
        }

        .loading-ecosystem {
            font-size: 60px;
            animation: pulse 1.5s ease-in-out infinite;
            margin-bottom: 20px;
        }

        .loading-text {
            color: white;
            font-size: 20px;
            margin-bottom: 20px;
        }

        .loading-progress {
            width: 200px;
            height: 4px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 2px;
            overflow: hidden;
        }

        .loading-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #27ae60, #2ecc71);
            animation: loading 2s ease-in-out infinite;
        }

        @keyframes loading {
            0% { width: 0%; }
            50% { width: 100%; }
            100% { width: 0%; }
        }

        /* Voice Indicator */
        .voice-indicator {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(46, 204, 113, 0.5);
            border-radius: 30px;
            padding: 14px 28px;
            display: flex;
            align-items: center;
            gap: 12px;
            z-index: 1000;
            opacity: 0;
            transition: all 0.3s ease;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }

        .voice-indicator.visible {
            opacity: 1;
            transform: translateX(-50%) translateY(-10px);
        }

        .voice-waves {
            display: flex;
            align-items: center;
            gap: 3px;
        }

        .voice-wave {
            width: 3px;
            height: 20px;
            background: linear-gradient(180deg, #2ecc71, #27ae60);
            border-radius: 2px;
            animation: voice-wave 1s ease-in-out infinite;
        }

        .voice-wave:nth-child(2) { animation-delay: 0.1s; }
        .voice-wave:nth-child(3) { animation-delay: 0.2s; }
        .voice-wave:nth-child(4) { animation-delay: 0.3s; }
        .voice-wave:nth-child(5) { animation-delay: 0.4s; }

        @keyframes voice-wave {
            0%, 100% { transform: scaleY(0.3); }
            50% { transform: scaleY(1); }
        }

        .narration-text {
            color: white;
            font-size: 13px;
            max-width: 300px;
        }

        /* Quick Actions */
        .quick-actions {
            position: absolute;
            bottom: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            z-index: 1000;
        }

        .action-btn {
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 10px 16px;
            border-radius: 25px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
        }

        .action-btn:hover {
            background: rgba(46, 204, 113, 0.3);
            border-color: #2ecc71;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(46, 204, 113, 0.3);
        }

        /* Custom Scrollbar */
        .info-panel::-webkit-scrollbar {
            width: 6px;
        }

        .info-panel::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 3px;
        }

        .info-panel::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, #2ecc71, #27ae60);
            border-radius: 3px;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .info-panel {
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                top: auto;
                width: 100%;
                max-height: 50vh;
                border-radius: 20px 20px 0 0;
            }
            
            .journey-navigation {
                bottom: 52vh;
                max-width: calc(100% - 40px);
            }
            
            .voice-controls {
                top: auto;
                bottom: 55vh;
                right: 10px;
            }
            
            .quick-actions {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="bg-animation"></div>

    <!-- Loading Screen -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-content">
            <div class="loading-ecosystem">🌿</div>
            <div class="loading-text">Preparing Your Ecosystem Journey...</div>
            <div class="loading-progress">
                <div class="loading-progress-bar"></div>
            </div>
        </div>
    </div>

    <!-- Museum Header -->
    <div class="museum-header">
        <div class="museum-title">Ecosystem Components and Interactions</div>
        <div class="exhibit-subtitle">
            <span class="ecosystem-indicator"></span>
            Understanding Life's Interconnected Web
        </div>
    </div>

    <!-- Journey Navigation -->
    <div class="journey-navigation">
        <div class="journey-title">
            <span>🌍</span>
            <span>Ecosystem Explorer</span>
        </div>
        <div class="journey-steps">
            <button class="journey-btn active" onclick="loadJourneyStep('definition')">
                <span>🌍</span> Definition
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('biotic')">
                <span>🦠</span> Biotic
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('abiotic')">
                <span>☀️</span> Abiotic
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('producers')">
                <span>🌱</span> Producers
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('consumers')">
                <span>🐟</span> Consumers
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('decomposers')">
                <span>🦴</span> Decomposers
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('aquarium')">
                <span>🐠</span> Aquarium
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('dependency')">
                <span>🔗</span> Dependencies
            </button>
        </div>
    </div>

    <!-- 3D Model Container -->
    <div class="model-container">
        <div class="sketchfab-embed-wrapper">
            <iframe id="api-frame"
                    title="Ecosystem Model" 
                    frameborder="0" 
                    allowfullscreen 
                    mozallowfullscreen="true" 
                    webkitallowfullscreen="true" 
                    allow="autoplay; fullscreen; xr-spatial-tracking"
                    xr-spatial-tracking 
                    execution-while-out-of-viewport 
                    execution-while-not-rendered 
                    web-share 
                    src="https://sketchfab.com/models/4efcf2fb00e14f1a9e6fa2bb457066d4/embed?autostart=1&internal=1&tracking=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_watermark=0">
            </iframe>
        </div>
    </div>

    <!-- Information Panel -->
    <div class="info-panel" id="infoPanel">
        <div class="info-header">
            <div class="info-icon" id="stepIcon">🌍</div>
            <div class="info-title">
                <h2 id="stepTitle">Ecosystem Definition</h2>
                <div class="info-subtitle" id="stepSubtitle">The foundation of ecological understanding</div>
            </div>
        </div>

        <!-- Progress Tracker -->
        <div class="progress-tracker">
            <div class="progress-header">
                <span>Learning Progress</span>
                <span class="progress-percentage" id="progressPercent">0%</span>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 0%"></div>
            </div>
            <div class="progress-steps-mini">
                <span class="step-mini active" onclick="loadJourneyStep('definition')">Def</span>
                <span class="step-mini" onclick="loadJourneyStep('biotic')">Bio</span>
                <span class="step-mini" onclick="loadJourneyStep('abiotic')">Abio</span>
                <span class="step-mini" onclick="loadJourneyStep('producers')">Prod</span>
                <span class="step-mini" onclick="loadJourneyStep('consumers')">Cons</span>
                <span class="step-mini" onclick="loadJourneyStep('decomposers')">Dec</span>
                <span class="step-mini" onclick="loadJourneyStep('aquarium')">Aqr</span>
                <span class="step-mini" onclick="loadJourneyStep('dependency')">Dep</span>
            </div>
        </div>

        <div class="info-content" id="mainDescription">
            An ecosystem is a complex network of living and non-living components that interact with each other in a specific area. It's like a giant web where every strand is connected - from the tiniest microorganisms to the largest predators, from sunlight and water to soil and air. Understanding ecosystems helps us appreciate how life on Earth is interconnected and interdependent.
        </div>

        <div class="info-card">
            <div class="info-card-title">
                <span>🔬</span> Key Concepts
            </div>
            <div class="info-card-content">
                <ul class="info-list" id="keyConcepts">
                    <li>All living and non-living things interact</li>
                    <li>Energy flows through the system</li>
                    <li>Matter cycles within the ecosystem</li>
                    <li>Balance is essential for stability</li>
                </ul>
            </div>
        </div>

        <div class="fun-fact">
            <div class="fun-fact-title">Amazing Fact!</div>
            <div class="fun-fact-text" id="funFact">
                A single handful of soil contains more microorganisms than there are people on Earth - around 10 billion bacteria, fungi, and other tiny life forms!
            </div>
        </div>

        <div class="info-card">
            <div class="info-card-title">
                <span>🎯</span> Learning Objectives
            </div>
            <div class="info-card-content" id="learningObjectives">
                By exploring this section, you'll understand what makes an ecosystem and how all its parts work together to support life.
            </div>
        </div>
    </div>

    <!-- Voice Controls -->
    <div class="voice-controls">
        <button class="control-btn active" id="voiceToggle" onclick="toggleVoice()">
            🔊
            <span class="control-tooltip">Voice Narration</span>
        </button>
        <button class="control-btn" onclick="toggleAutoPlay()">
            ▶️
            <span class="control-tooltip">Auto Journey</span>
        </button>
        <button class="control-btn" onclick="toggleInfo()">
            ℹ️
            <span class="control-tooltip">Toggle Info</span>
        </button>
    </div>

    <!-- Quick Actions -->
    <div class="quick-actions">
        <button class="action-btn" onclick="startGuidedTour()">
            <span>🚀</span> Guided Tour
        </button>
        <button class="action-btn" onclick="showQuiz()">
            <span>🎯</span> Test Knowledge
        </button>
    </div>

    <!-- Voice Indicator -->
    <div class="voice-indicator" id="voiceIndicator">
        <div class="voice-waves">
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
        </div>
        <div class="narration-text" id="narrationText">Narrating...</div>
    </div>

    <script>
        // Journey Step Data with Complete Ecological Content
        const JOURNEY_DATA = {
            definition: {
                title: "Ecosystem Definition",
                subtitle: "The foundation of ecological understanding",
                icon: "🌍",
                modelUrl: "https://sketchfab.com/models/4efcf2fb00e14f1a9e6fa2bb457066d4/embed?autostart=1&internal=1&tracking=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_watermark=0",
                description: "An ecosystem is a complex network of living and non-living components that interact with each other in a specific area. It's like a giant web where every strand is connected - from the tiniest microorganisms to the largest predators, from sunlight and water to soil and air. Understanding ecosystems helps us appreciate how life on Earth is interconnected and interdependent.",
                concepts: [
                    "All living and non-living things interact",
                    "Energy flows through the system",
                    "Matter cycles within the ecosystem",
                    "Balance is essential for stability"
                ],
                funFact: "A single handful of soil contains more microorganisms than there are people on Earth - around 10 billion bacteria, fungi, and other tiny life forms!",
                objectives: "By exploring this section, you'll understand what makes an ecosystem and how all its parts work together to support life.",
                narration: "Welcome to the amazing world of ecosystems! You're looking at microorganisms - the tiny but mighty foundation of all ecosystems. These microscopic life forms may be invisible to the naked eye, but they're the unsung heroes of our planet. They break down dead material, recycle nutrients, and form the base of countless food webs. An ecosystem is like a vast, interconnected city where every organism, from bacteria to blue whales, has a role to play. Energy flows through this system like electricity through circuits, while nutrients cycle endlessly like water in a fountain. These microorganisms you see are the recyclers, the decomposers, and often the primary producers that make life possible for all other organisms."
            },
            biotic: {
                title: "Biotic Factors - The Living Components",
                subtitle: "All living things in the ecosystem",
                icon: "🦠",
                modelUrl: "https://sketchfab.com/models/4efcf2fb00e14f1a9e6fa2bb457066d4/embed?autostart=1&internal=1&tracking=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_watermark=0",
                description: "Biotic factors are all the living components of an ecosystem. From bacteria and fungi to plants and animals, each organism plays a crucial role. These living things interact through feeding relationships, competition, cooperation, and symbiosis, creating a dynamic web of life.",
                concepts: [
                    "Includes all living organisms",
                    "Bacteria, fungi, plants, and animals",
                    "Interact through various relationships",
                    "Create food webs and energy flows"
                ],
                funFact: "A single teaspoon of ocean water contains about 5 million bacteria and 50 million viruses!",
                objectives: "Learn to identify biotic factors and understand how living organisms interact within ecosystems.",
                narration: "These are the biotic factors - the living heart of every ecosystem! What you're seeing are microorganisms, but they represent all living things: bacteria that decompose organic matter, algae that photosynthesize, fungi that form partnerships with plant roots, and countless other microscopic life forms. Biotic factors include everything that's alive - from the smallest virus to the largest whale. These organisms don't live in isolation; they're constantly interacting. Some compete for resources, others cooperate for mutual benefit, and many form complex feeding relationships. The microorganisms you see here are often the most abundant biotic factors, playing essential roles as decomposers, producers, and the foundation of food webs."
            },
            abiotic: {
                title: "Abiotic Factors - The Non-Living Foundation",
                subtitle: "Physical and chemical environment",
                icon: "☀️",
                modelUrl: "https://sketchfab.com/models/4efcf2fb00e14f1a9e6fa2bb457066d4/embed?autostart=1&internal=1&tracking=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_watermark=0",
                description: "Abiotic factors are the non-living components that shape ecosystem conditions. Temperature, light, water, soil, pH, and oxygen levels all influence which organisms can survive and thrive in a particular environment. These factors create the stage upon which the drama of life unfolds.",
                concepts: [
                    "Non-living environmental factors",
                    "Temperature, light, water, soil",
                    "pH, oxygen, and nutrient levels",
                    "Determine what organisms can survive"
                ],
                funFact: "Just a 2°C change in ocean temperature can trigger massive coral bleaching events affecting entire reef ecosystems!",
                objectives: "Understand how non-living factors control ecosystem structure and function.",
                narration: "While you see living microorganisms, remember they depend entirely on abiotic factors - the non-living components of their environment. Temperature affects their metabolism, pH levels determine which enzymes work properly, oxygen availability controls respiration, and nutrient concentrations limit growth. These microorganisms are incredibly sensitive to changes in their abiotic environment. Too much heat and their proteins denature, too little light and photosynthetic species can't make food, wrong pH and their cellular processes shut down. The amazing thing is how these tiny organisms have adapted to survive in almost every abiotic condition on Earth - from boiling hot springs to frozen Antarctic ice!"
            },
            producers: {
                title: "Producers - The Energy Converters",
                subtitle: "Converting sunlight into food",
                icon: "🌱",
                modelUrl: "https://sketchfab.com/models/520e3c190b4348b783a386d04697935f/embed?autostart=1&internal=1&tracking=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_watermark=0",
                description: "Producers are the foundation of almost all ecosystems. These autotrophic organisms convert solar energy into chemical energy through photosynthesis, creating the organic compounds that feed entire food webs. Aquatic plants, algae, and photosynthetic bacteria are nature's solar panels.",
                concepts: [
                    "Convert sunlight into chemical energy",
                    "Include plants, algae, and some bacteria",
                    "Form the base of food pyramids",
                    "Produce oxygen as a byproduct"
                ],
                funFact: "Aquatic plants produce about 70% of the world's oxygen - more than all land plants combined!",
                objectives: "Discover how producers capture energy and support all other life in aquatic ecosystems.",
                narration: "Meet the producers - the ultimate energy converters of aquatic ecosystems! These aquatic plants are like underwater solar panels, capturing sunlight and transforming it into chemical energy through photosynthesis. Every leaf, every blade of aquatic grass you see is a food factory, taking in carbon dioxide and water and producing glucose and oxygen. These plants form the foundation of aquatic food webs. Small fish eat the plants, larger fish eat the small fish, and so on up the food chain. Without these primary producers, entire aquatic ecosystems would collapse. They also release the oxygen that fish and other aquatic animals need to breathe. The elegant movements of these underwater plants aren't just beautiful - they're constantly working to capture light and exchange gases with the water around them."
            },
            consumers: {
                title: "Consumers - The Energy Transfer Agents",
                subtitle: "Primary, secondary, and tertiary consumers",
                icon: "🐟",
                modelUrl: "https://sketchfab.com/models/a4fad974d1c24683916a756c88700482/embed?autostart=1&internal=1&tracking=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_watermark=0",
                description: "Consumers are organisms that cannot produce their own food and must eat other organisms to survive. They form complex feeding relationships in aquatic ecosystems, from tiny zooplankton that eat algae to large predatory fish that hunt other fish.",
                concepts: [
                    "Cannot produce their own food",
                    "Primary consumers eat producers",
                    "Secondary consumers eat primary consumers",
                    "Tertiary consumers are top predators"
                ],
                funFact: "A single bluefin tuna can swim over 10,000 miles per year following food sources across entire ocean basins!",
                objectives: "Explore the different levels of consumers and their roles in energy transfer through aquatic food webs.",
                narration: "Welcome to the world of aquatic consumers! These fish represent the various levels of consumers in aquatic ecosystems. Some are herbivores - primary consumers that feed directly on aquatic plants and algae. Others are carnivores - secondary or tertiary consumers that hunt other fish. Watch how they move and behave - each species has evolved specific adaptations for their feeding lifestyle. The small, quick-moving fish might be primary consumers, darting between plants to avoid predators while grazing on algae. The larger, more powerful fish could be secondary or tertiary consumers, using speed and strength to catch their prey. Each consumer level transfers energy up the food chain, but with each transfer, about 90% of the energy is lost to metabolic processes. This is why there are always fewer top predators than plant-eaters in any ecosystem."
            },
            decomposers: {
                title: "Decomposers - Nature's Recyclers",
                subtitle: "Breaking down and recycling nutrients",
                icon: "🦴",
                modelUrl: "https://sketchfab.com/models/4628f72cfec74b64b64f3ac758fd1303/embed?autostart=1&internal=1&tracking=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_watermark=0",
                description: "Decomposers are the unsung heroes of ecosystems. Bacteria, fungi, and other organisms break down dead organic matter, recycling nutrients back into the ecosystem. This process is essential for maintaining the flow of nutrients that all living things depend on.",
                concepts: [
                    "Break down dead organic matter",
                    "Include bacteria, fungi, and detritivores",
                    "Recycle nutrients back to ecosystem",
                    "Essential for nutrient cycling"
                ],
                funFact: "When a whale dies and sinks to the ocean floor, it can support a unique ecosystem of decomposers for over 50 years!",
                objectives: "Understand the crucial role of decomposers in nutrient cycling and ecosystem sustainability.",
                narration: "Behold one of nature's most important processes - decomposition! This whale carcass represents what happens when large organisms die in aquatic ecosystems. It becomes a feast for decomposers - bacteria, fungi, and scavenging animals that break down organic matter. This isn't just decay; it's nature's ultimate recycling program! The decomposers you can't see - countless bacteria and marine worms - are working tirelessly to break down proteins, fats, and other organic compounds. As they do this, they release nutrients like nitrogen, phosphorus, and carbon back into the water, where they can be used by producers to grow. Without decomposers, dead organic matter would pile up, and essential nutrients would become locked away and unavailable to living organisms. This whale fall creates a unique deep-sea ecosystem that can support specialized communities for decades!"
            },
            aquarium: {
                title: "Activity 13.1 - Aquarium Design",
                subtitle: "Building a balanced ecosystem",
                icon: "🐠",
                modelUrl: "https://sketchfab.com/models/520e3c190b4348b783a386d04697935f/embed?autostart=1&internal=1&tracking=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_watermark=0",
                description: "Design your own aquarium ecosystem! Consider what producers, consumers, and decomposers you need for a balanced system. Think about water quality, lighting, filtration, and how different species will interact. A successful aquarium is a mini-ecosystem in perfect balance.",
                concepts: [
                    "Balance producers and consumers",
                    "Maintain proper water chemistry",
                    "Provide adequate lighting and filtration",
                    "Consider species compatibility"
                ],
                funFact: "The largest home aquarium ever built holds 180,000 gallons and required a reinforced concrete floor to support its weight!",
                objectives: "Apply ecosystem principles to design a functional aquarium that maintains ecological balance.",
                narration: "Now it's time to become an ecosystem designer! Look at these beautiful aquatic plants - they'll be the producers in your aquarium ecosystem. When designing an aquarium, you're essentially creating a miniature ecosystem that must be perfectly balanced. These plants will produce oxygen through photosynthesis and provide food and shelter for your fish. You'll need to consider lighting - too little and your plants won't thrive, too much and algae will take over. Water chemistry is crucial - pH, temperature, and nutrient levels must be just right. You'll also need consumers - fish that will eat algae and dead plant matter, and decomposers like beneficial bacteria in your filter to break down waste. The key is balance: enough plants to produce oxygen and absorb waste, but not so many that they overcrowd the tank. The right number of fish to create activity without overwhelming the system's ability to process their waste."
            },
            dependency: {
                title: "Activity 13.2 - Organism Dependency Analysis",
                subtitle: "Mapping the web of life",
                icon: "🔗",
                modelUrl: "https://sketchfab.com/models/a4fad974d1c24683916a756c88700482/embed?autostart=1&internal=1&tracking=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_watermark=0",
                description: "Explore the intricate web of dependencies in aquatic ecosystems. Trace the connections between organisms and discover how the removal of one species can cascade through the entire system. Every organism depends on others for survival.",
                concepts: [
                    "All organisms are interconnected",
                    "Food webs show feeding relationships",
                    "Keystone species have outsized impacts",
                    "Biodiversity increases stability"
                ],
                funFact: "Removing wolves from Yellowstone changed the entire ecosystem - even the shape of rivers - showing how interconnected nature really is!",
                objectives: "Analyze the complex relationships between organisms and predict the effects of changes in ecosystem balance.",
                narration: "Let's analyze the web of dependencies in this aquatic ecosystem! Watch these fish carefully - each one represents multiple dependency relationships. That small fish depends on algae and aquatic plants for food, but it's also food for larger predators. Remove the plants, and the small fish starve. Remove the small fish, and the large predators must find new food sources or their population will crash. These fish also depend on dissolved oxygen produced by plants, proper water temperature, and countless microorganisms that process waste and recycle nutrients. The fascinating thing about ecosystem dependencies is how they form complex webs rather than simple chains. Each organism typically depends on multiple others and supports multiple others in return. This redundancy makes ecosystems resilient, but it also means that losing a keystone species - one that many others depend on - can cause dramatic changes throughout the entire system."
            }
        };

        // Global Variables
        let currentStep = 'definition';
        let voiceEnabled = true;
        let autoPlayEnabled = false;
        let currentSpeech = null;
        let selectedVoice = null;
        let journeyProgress = 0;
        let guidedTourActive = false;

        // Initialize Voice System
        function initVoiceSystem() {
            if (!('speechSynthesis' in window)) {
                console.warn('Speech synthesis not supported');
                voiceEnabled = false;
                document.getElementById('voiceToggle').style.display = 'none';
                return;
            }

            function loadVoices() {
                const voices = speechSynthesis.getVoices();
                if (voices.length === 0) return;

                // Prefer natural-sounding voices
                const preferredVoices = [
                    'Google UK English Female',
                    'Microsoft Sonia',
                    'Microsoft Hazel',
                    'Samantha',
                    'Victoria'
                ];

                for (const name of preferredVoices) {
                    selectedVoice = voices.find(v => v.name.includes(name));
                    if (selectedVoice) break;
                }

                if (!selectedVoice) {
                    selectedVoice = voices.find(v => v.lang.startsWith('en'));
                }
            }

            loadVoices();
            if (speechSynthesis.onvoiceschanged !== undefined) {
                speechSynthesis.onvoiceschanged = loadVoices;
            }
        }

        // Load Journey Step
        function loadJourneyStep(stepId) {
            const stepData = JOURNEY_DATA[stepId];
            if (!stepData) return;

            currentStep = stepId;
            
            // Update model
            document.getElementById('api-frame').src = stepData.modelUrl;
            
            // Update info panel
            document.getElementById('stepIcon').textContent = stepData.icon;
            document.getElementById('stepTitle').textContent = stepData.title;
            document.getElementById('stepSubtitle').textContent = stepData.subtitle;
            document.getElementById('mainDescription').textContent = stepData.description;
            
            // Update key concepts
            const conceptsList = document.getElementById('keyConcepts');
            conceptsList.innerHTML = stepData.concepts.map(c => `<li>${c}</li>`).join('');
            
            // Update fun fact
            document.getElementById('funFact').textContent = stepData.funFact;
            
            // Update learning objectives
            document.getElementById('learningObjectives').textContent = stepData.objectives;
            
            // Update navigation buttons
            updateNavigationButtons(stepId);
            
            // Update progress
            updateProgress();
            
            // Play narration if enabled
            if (voiceEnabled) {
                speakText(stepData.narration);
            }
        }

        // Update Navigation Buttons
        function updateNavigationButtons(activeStep) {
            const buttons = document.querySelectorAll('.journey-btn');
            const steps = ['definition', 'biotic', 'abiotic', 'producers', 'consumers', 'decomposers', 'aquarium', 'dependency'];
            const activeIndex = steps.indexOf(activeStep);
            
            buttons.forEach((btn, index) => {
                btn.classList.remove('active', 'completed');
                if (index < activeIndex) {
                    btn.classList.add('completed');
                } else if (index === activeIndex) {
                    btn.classList.add('active');
                }
            });
            
            // Update mini steps
            const miniSteps = document.querySelectorAll('.step-mini');
            miniSteps.forEach((step, index) => {
                step.classList.remove('active', 'completed');
                if (index < activeIndex) {
                    step.classList.add('completed');
                } else if (index === activeIndex) {
                    step.classList.add('active');
                }
            });
        }

        // Update Progress
        function updateProgress() {
            const steps = ['definition', 'biotic', 'abiotic', 'producers', 'consumers', 'decomposers', 'aquarium', 'dependency'];
            const currentIndex = steps.indexOf(currentStep);
            const progress = ((currentIndex + 1) / steps.length) * 100;
            
            document.getElementById('progressPercent').textContent = Math.round(progress) + '%';
            document.getElementById('progressFill').style.width = progress + '%';
        }

        // Speech Functions
        function speakText(text) {
            if (!voiceEnabled || !text) return;
            
            stopSpeech();
            
            currentSpeech = new SpeechSynthesisUtterance(text);
            if (selectedVoice) {
                currentSpeech.voice = selectedVoice;
            }
            currentSpeech.rate = 0.9;
            currentSpeech.pitch = 1.0;
            currentSpeech.volume = 0.9;
            
            currentSpeech.onstart = () => {
                document.getElementById('voiceIndicator').classList.add('visible');
                document.getElementById('narrationText').textContent = 
                    text.substring(0, 50) + (text.length > 50 ? '...' : '');
            };
            
            currentSpeech.onend = () => {
                document.getElementById('voiceIndicator').classList.remove('visible');
                currentSpeech = null;
                
                // Auto-advance if guided tour is active
                if (guidedTourActive) {
                    setTimeout(nextStep, 2000);
                }
            };
            
            speechSynthesis.speak(currentSpeech);
        }

        function stopSpeech() {
            if (currentSpeech) {
                speechSynthesis.cancel();
                currentSpeech = null;
                document.getElementById('voiceIndicator').classList.remove('visible');
            }
        }

        // Control Functions
        function toggleVoice() {
            voiceEnabled = !voiceEnabled;
            const btn = document.getElementById('voiceToggle');
            btn.textContent = voiceEnabled ? '🔊' : '🔇';
            btn.classList.toggle('active', voiceEnabled);
            
            if (!voiceEnabled) {
                stopSpeech();
            }
        }

        function toggleAutoPlay() {
            autoPlayEnabled = !autoPlayEnabled;
            if (autoPlayEnabled) {
                startGuidedTour();
            } else {
                guidedTourActive = false;
            }
        }

        function toggleInfo() {
            const panel = document.getElementById('infoPanel');
            panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
        }

        // Guided Tour
        function startGuidedTour() {
            guidedTourActive = true;
            const steps = ['definition', 'biotic', 'abiotic', 'producers', 'consumers', 'decomposers', 'aquarium', 'dependency'];
            let stepIndex = 0;
            
            function tourStep() {
                if (stepIndex < steps.length && guidedTourActive) {
                    loadJourneyStep(steps[stepIndex]);
                    stepIndex++;
                } else {
                    guidedTourActive = false;
                    if (voiceEnabled) {
                        speakText("Congratulations! You've completed your journey through ecosystem components and interactions. You now understand how living and non-living factors work together to create the web of life!");
                    }
                }
            }
            
            tourStep();
            window.nextStep = tourStep;
        }

        // Quiz Function
        function showQuiz() {
            const questions = [
                "What is the difference between biotic and abiotic factors?",
                "Why are producers essential for all ecosystems?",
                "How do decomposers contribute to nutrient cycling?",
                "What makes a good aquarium ecosystem design?",
                "How are organisms in an ecosystem dependent on each other?"
            ];
            
            const randomQ = questions[Math.floor(Math.random() * questions.length)];
            
            if (voiceEnabled) {
                speakText(`Here's a question to test your ecosystem knowledge: ${randomQ} Think about the connections you've discovered in this journey!`);
            }
        }

        // Initialize
        function init() {
            initVoiceSystem();
            
            // Hide loading screen
            setTimeout(() => {
                const loading = document.getElementById('loadingOverlay');
                loading.style.opacity = '0';
                setTimeout(() => {
                    loading.style.display = 'none';
                    
                    // Welcome message
                    if (voiceEnabled) {
                        speakText("Welcome to your ecosystem exploration journey! We'll discover how living and non-living components interact to create the amazing web of life. Let's start by understanding what an ecosystem really is!");
                    }
                }, 1000);
            }, 3000);
            
            // Keyboard shortcuts
            document.addEventListener('keydown', (e) => {
                switch(e.key) {
                    case 'v': toggleVoice(); break;
                    case 'i': toggleInfo(); break;
                    case 'g': startGuidedTour(); break;
                    case 'Escape': stopSpeech(); guidedTourActive = false; break;
                    case 'ArrowRight': nextStep && nextStep(); break;
                }
            });
        }

        // Start the application
        init();
    </script>
</body>
</html>