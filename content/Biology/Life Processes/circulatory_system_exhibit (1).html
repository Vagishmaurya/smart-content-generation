<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Human Circulatory System - Interactive Journey</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tween.js/18.6.4/tween.umd.js"></script>

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #c0392b 0%, #e74c3c 30%, #3498db 70%, #2980b9 100%);
            color: white;
            overflow: hidden;
            position: relative;
            height: 100vh;
        }

        /* Animated Background */
        .bg-animation {
            position: fixed;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: 0;
            opacity: 0.1;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 320"><path fill="%23ffffff" fill-opacity="0.2" d="M0,96L48,112C96,128,192,160,288,186.7C384,213,480,235,576,213.3C672,192,768,128,864,128C960,128,1056,192,1152,197.3C1248,203,1344,149,1392,122.7L1440,96L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z"></path></svg>') repeat-x;
            animation: wave 12s linear infinite;
        }

        @keyframes wave {
            0% { background-position-x: 0; }
            100% { background-position-x: 1440px; }
        }

        /* Museum Interface */
        .museum-header {
            position: absolute;
            top: 10px;
            left: 20px;
            text-align: left;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            padding: 10px 18px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .museum-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 4px;
            background: linear-gradient(45deg, #e74c3c, #3498db);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: titleGlow 3s ease-in-out infinite;
        }

        @keyframes titleGlow {
            0%, 100% { filter: brightness(1); }
            50% { filter: brightness(1.3); }
        }

        .exhibit-subtitle {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.8);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .heartbeat-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            background: #e74c3c;
            border-radius: 50%;
            animation: heartbeat 1.2s ease-in-out infinite;
        }

        @keyframes heartbeat {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.4); opacity: 0.7; }
        }

        /* Journey Navigation */
        .journey-navigation {
            position: absolute;
            bottom: 20px;
            left: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            padding: 15px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            max-width: 320px;
        }

        .journey-title {
            font-size: 14px;
            font-weight: 600;
            color: #e74c3c;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .journey-steps {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }

        .journey-btn {
            background: rgba(231, 76, 60, 0.2);
            border: 1px solid rgba(231, 76, 60, 0.4);
            color: white;
            padding: 6px 10px;
            border-radius: 20px;
            font-size: 11px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 4px;
            white-space: nowrap;
        }

        .journey-btn:hover {
            background: rgba(231, 76, 60, 0.3);
            border-color: #e74c3c;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(231, 76, 60, 0.3);
        }

        .journey-btn.active {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            border-color: #e74c3c;
            box-shadow: 0 0 20px rgba(231, 76, 60, 0.5);
            animation: pulse 2s infinite;
        }

        .journey-btn.completed {
            background: rgba(46, 204, 113, 0.3);
            border-color: #2ecc71;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        /* 3D Model Container */
        .model-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 0;
            overflow: hidden;
            border: none;
            z-index: 100;
        }

        .sketchfab-embed-wrapper {
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #c0392b 0%, #e74c3c 30%, #3498db 70%, #2980b9 100%);
        }

        .sketchfab-embed-wrapper iframe {
            width: 100%;
            height: 100%;
            border: none;
            border-radius: 0;
        }

        /* Information Panel */
        .info-panel {
            position: absolute;
            top: 70px;
            right: 20px;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(25px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 16px;
            padding: 24px;
            width: 420px;
            max-height: calc(100vh - 140px);
            z-index: 800;
            overflow-y: auto;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }

        .info-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        }

        .info-icon {
            font-size: 28px;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        .info-title {
            flex: 1;
        }

        .info-title h2 {
            font-size: 18px;
            color: #e74c3c;
            margin-bottom: 4px;
        }

        .info-subtitle {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.7);
        }

        .info-content {
            color: rgba(255, 255, 255, 0.9);
            font-size: 14px;
            line-height: 1.6;
        }

        /* Progress Tracker */
        .progress-tracker {
            background: linear-gradient(135deg, rgba(231, 76, 60, 0.1), rgba(52, 152, 219, 0.1));
            border: 1px solid rgba(231, 76, 60, 0.3);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 20px;
        }

        .progress-header {
            font-size: 13px;
            font-weight: 600;
            color: #e74c3c;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .progress-percentage {
            font-size: 18px;
            color: #3498db;
            font-weight: 700;
        }

        .progress-bar {
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 12px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #e74c3c, #3498db);
            border-radius: 4px;
            transition: width 0.8s ease;
            box-shadow: 0 0 10px rgba(231, 76, 60, 0.5);
        }

        .progress-steps-mini {
            display: flex;
            justify-content: space-between;
            font-size: 9px;
            color: rgba(255, 255, 255, 0.6);
            flex-wrap: wrap;
            gap: 3px;
        }

        .step-mini {
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            flex: 1;
            min-width: 45px;
        }

        .step-mini.active {
            color: #e74c3c;
            font-weight: 600;
        }

        .step-mini.completed {
            color: #2ecc71;
        }

        /* Information Cards */
        .info-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 14px;
            margin-bottom: 14px;
        }

        .info-card-title {
            color: #e74c3c;
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .info-card-content {
            color: rgba(255, 255, 255, 0.85);
            font-size: 12px;
            line-height: 1.5;
        }

        .info-list {
            list-style: none;
            padding: 0;
        }

        .info-list li {
            padding: 6px 0;
            padding-left: 20px;
            position: relative;
            font-size: 12px;
            color: rgba(255, 255, 255, 0.8);
        }

        .info-list li:before {
            content: "‚ô•";
            position: absolute;
            left: 0;
            color: #e74c3c;
        }

        /* Activity Box */
        .activity-box {
            background: linear-gradient(135deg, rgba(155, 89, 182, 0.1), rgba(231, 76, 60, 0.1));
            border: 1px solid rgba(155, 89, 182, 0.3);
            border-radius: 12px;
            padding: 14px;
            margin: 16px 0;
            position: relative;
            overflow: hidden;
        }

        .activity-box:before {
            content: "üî¨";
            position: absolute;
            top: -20px;
            right: -20px;
            font-size: 60px;
            opacity: 0.1;
        }

        .activity-title {
            color: #9b59b6;
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 6px;
        }

        .activity-text {
            color: rgba(255, 255, 255, 0.9);
            font-size: 12px;
            line-height: 1.5;
            position: relative;
            z-index: 1;
        }

        /* Fun Fact Box */
        .fun-fact {
            background: linear-gradient(135deg, rgba(46, 204, 113, 0.1), rgba(52, 152, 219, 0.1));
            border: 1px solid rgba(46, 204, 113, 0.3);
            border-radius: 12px;
            padding: 14px;
            margin: 16px 0;
            position: relative;
            overflow: hidden;
        }

        .fun-fact:before {
            content: "üí°";
            position: absolute;
            top: -20px;
            right: -20px;
            font-size: 60px;
            opacity: 0.1;
        }

        .fun-fact-title {
            color: #2ecc71;
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 6px;
        }

        .fun-fact-text {
            color: rgba(255, 255, 255, 0.9);
            font-size: 12px;
            line-height: 1.5;
            position: relative;
            z-index: 1;
        }

        /* Voice Controls */
        .voice-controls {
            position: absolute;
            top: 10px;
            right: 20px;
            display: flex;
            gap: 8px;
            z-index: 1000;
        }

        .control-btn {
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            width: 44px;
            height: 44px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            position: relative;
        }

        .control-btn:hover {
            background: rgba(231, 76, 60, 0.3);
            border-color: #e74c3c;
            transform: scale(1.1);
        }

        .control-btn.active {
            background: rgba(231, 76, 60, 0.4);
            border-color: #e74c3c;
            box-shadow: 0 0 20px rgba(231, 76, 60, 0.5);
        }

        .control-tooltip {
            position: absolute;
            bottom: -30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9);
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 10px;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .control-btn:hover .control-tooltip {
            opacity: 1;
        }

        /* Loading Screen */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #c0392b 0%, #e74c3c 30%, #3498db 70%, #2980b9 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            transition: opacity 1s ease;
        }

        .loading-content {
            text-align: center;
        }

        .loading-icon {
            font-size: 60px;
            animation: heartbeat 1.2s ease-in-out infinite;
            margin-bottom: 20px;
        }

        .loading-text {
            color: white;
            font-size: 20px;
            margin-bottom: 20px;
        }

        .loading-progress {
            width: 200px;
            height: 4px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 2px;
            overflow: hidden;
        }

        .loading-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #e74c3c, #3498db);
            animation: loading 2s ease-in-out infinite;
        }

        @keyframes loading {
            0% { width: 0%; }
            50% { width: 100%; }
            100% { width: 0%; }
        }

        /* Voice Indicator */
        .voice-indicator {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(231, 76, 60, 0.5);
            border-radius: 30px;
            padding: 14px 28px;
            display: flex;
            align-items: center;
            gap: 12px;
            z-index: 1000;
            opacity: 0;
            transition: all 0.3s ease;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }

        .voice-indicator.visible {
            opacity: 1;
            transform: translateX(-50%) translateY(-10px);
        }

        .voice-waves {
            display: flex;
            align-items: center;
            gap: 3px;
        }

        .voice-wave {
            width: 3px;
            height: 20px;
            background: linear-gradient(180deg, #e74c3c, #3498db);
            border-radius: 2px;
            animation: voice-wave 1s ease-in-out infinite;
        }

        .voice-wave:nth-child(2) { animation-delay: 0.1s; }
        .voice-wave:nth-child(3) { animation-delay: 0.2s; }
        .voice-wave:nth-child(4) { animation-delay: 0.3s; }
        .voice-wave:nth-child(5) { animation-delay: 0.4s; }

        @keyframes voice-wave {
            0%, 100% { transform: scaleY(0.3); }
            50% { transform: scaleY(1); }
        }

        .narration-text {
            color: white;
            font-size: 13px;
            max-width: 300px;
        }

        /* Quick Actions */
        .quick-actions {
            position: absolute;
            bottom: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            z-index: 1000;
        }

        .action-btn {
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 10px 16px;
            border-radius: 25px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
        }

        .action-btn:hover {
            background: rgba(231, 76, 60, 0.3);
            border-color: #e74c3c;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(231, 76, 60, 0.3);
        }

        /* Custom Scrollbar */
        .info-panel::-webkit-scrollbar {
            width: 6px;
        }

        .info-panel::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 3px;
        }

        .info-panel::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, #e74c3c, #3498db);
            border-radius: 3px;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .info-panel {
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                top: auto;
                width: 100%;
                max-height: 50vh;
                border-radius: 20px 20px 0 0;
            }
            
            .journey-navigation {
                bottom: 52vh;
                max-width: calc(100% - 40px);
            }
            
            .voice-controls {
                top: auto;
                bottom: 55vh;
                right: 10px;
            }
            
            .quick-actions {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="bg-animation"></div>

    <!-- Loading Screen -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-content">
            <div class="loading-icon">‚ù§Ô∏è</div>
            <div class="loading-text">Preparing Circulatory Journey...</div>
            <div class="loading-progress">
                <div class="loading-progress-bar"></div>
            </div>
        </div>
    </div>

    <!-- Museum Header -->
    <div class="museum-header">
        <div class="museum-title">Human Circulatory System</div>
        <div class="exhibit-subtitle">
            <span class="heartbeat-indicator"></span>
            Life's Transportation Network
        </div>
    </div>

    <!-- Journey Navigation -->
    <div class="journey-navigation">
        <div class="journey-title">
            <span>ü´Ä</span>
            <span>Circulatory Journey</span>
        </div>
        <div class="journey-steps">
            <button class="journey-btn active" onclick="loadJourneyStep('heart')">
                <span>ü´Ä</span> Heart
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('bloodcells')">
                <span>ü©∏</span> Blood Cells
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('vessels')">
                <span>üöá</span> Vessels
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('bloodflow')">
                <span>üåä</span> Blood Flow
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('circulation')">
                <span>üîÑ</span> Double Circuit
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('hemoglobin')">
                <span>üî¨</span> Hgb Study
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('pathways')">
                <span>üó∫Ô∏è</span> Pathways
            </button>
        </div>
    </div>

    <!-- 3D Model Container -->
    <div class="model-container">
        <div class="sketchfab-embed-wrapper">
            <iframe id="api-frame"
                    title="Circulatory System Model" 
                    frameborder="0" 
                    allowfullscreen 
                    mozallowfullscreen="true" 
                    webkitallowfullscreen="true" 
                    allow="autoplay; fullscreen; xr-spatial-tracking"
                    xr-spatial-tracking 
                    execution-while-out-of-viewport 
                    execution-while-not-rendered 
                    web-share 
                    src="https://sketchfab.com/3d-models/animated-human-heart-cross-section-6736a2b663d5421a956bd60778fcd877/embed?autostart=1&internal=1&tracking=0&ui_ar=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0">
            </iframe>
        </div>
    </div>

    <!-- Information Panel -->
    <div class="info-panel" id="infoPanel">
        <div class="info-header">
            <div class="info-icon" id="stepIcon">ü´Ä</div>
            <div class="info-title">
                <h2 id="stepTitle">Heart Structure & Function</h2>
                <div class="info-subtitle" id="stepSubtitle">The muscular pump that drives circulation</div>
            </div>
        </div>

        <!-- Progress Tracker -->
        <div class="progress-tracker">
            <div class="progress-header">
                <span>Circulation Progress</span>
                <span class="progress-percentage" id="progressPercent">14%</span>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 14%"></div>
            </div>
            <div class="progress-steps-mini">
                <span class="step-mini active" onclick="loadJourneyStep('heart')">Heart</span>
                <span class="step-mini" onclick="loadJourneyStep('bloodcells')">Cells</span>
                <span class="step-mini" onclick="loadJourneyStep('vessels')">Vessels</span>
                <span class="step-mini" onclick="loadJourneyStep('bloodflow')">Flow</span>
                <span class="step-mini" onclick="loadJourneyStep('circulation')">Circuit</span>
                <span class="step-mini" onclick="loadJourneyStep('hemoglobin')">Study</span>
                <span class="step-mini" onclick="loadJourneyStep('pathways')">Paths</span>
            </div>
        </div>

        <div class="info-content" id="mainDescription">
            The heart is a remarkable four-chambered muscular pump that drives blood circulation throughout your body. This animated cross-section reveals the internal anatomy, showing how the atria receive blood while the ventricles pump it out, creating the continuous flow that sustains life.
        </div>

        <div class="info-card">
            <div class="info-card-title">
                <span>üèóÔ∏è</span> Heart Anatomy
            </div>
            <div class="info-card-content">
                <ul class="info-list" id="keyConcepts">
                    <li>Four chambers: right & left atria, right & left ventricles</li>
                    <li>Atrioventricular valves (tricuspid & bicuspid)</li>
                    <li>Semilunar valves (pulmonary & aortic)</li>
                    <li>Muscular walls: myocardium contracts rhythmically</li>
                    <li>Electrical conduction system controls heartbeat</li>
                </ul>
            </div>
        </div>

        <div class="fun-fact">
            <div class="fun-fact-title">Incredible Heart Facts!</div>
            <div class="fun-fact-text" id="funFact">
                Your heart beats about 100,000 times per day, pumping 2,000 gallons of blood through 60,000 miles of blood vessels!
            </div>
        </div>

        <div class="info-card">
            <div class="info-card-title">
                <span>üéØ</span> Learning Objectives
            </div>
            <div class="info-card-content" id="learningObjectives">
                Understand heart anatomy, the cardiac cycle, valve function, and how this muscular pump maintains continuous blood circulation.
            </div>
        </div>
    </div>

    <!-- Voice Controls -->
    <div class="voice-controls">
        <button class="control-btn active" id="voiceToggle" onclick="toggleVoice()">
            üîä
            <span class="control-tooltip">Voice Narration</span>
        </button>
        <button class="control-btn" onclick="toggleAutoPlay()">
            ‚ñ∂Ô∏è
            <span class="control-tooltip">Auto Journey</span>
        </button>
        <button class="control-btn" onclick="toggleInfo()">
            ‚ÑπÔ∏è
            <span class="control-tooltip">Toggle Info</span>
        </button>
    </div>

    <!-- Quick Actions -->
    <div class="quick-actions">
        <button class="action-btn" onclick="startGuidedTour()">
            <span>üöÄ</span> Guided Tour
        </button>
        <button class="action-btn" onclick="showQuiz()">
            <span>üéØ</span> Test Knowledge
        </button>
    </div>

    <!-- Voice Indicator -->
    <div class="voice-indicator" id="voiceIndicator">
        <div class="voice-waves">
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
        </div>
        <div class="narration-text" id="narrationText">Narrating...</div>
    </div>

    <script>
        // Journey Step Data for Human Circulatory System
        const JOURNEY_DATA = {
            heart: {
                title: "Heart Structure & Function",
                subtitle: "The muscular pump that drives circulation",
                icon: "ü´Ä",
                modelUrl: "https://sketchfab.com/3d-models/animated-human-heart-cross-section-6736a2b663d5421a956bd60778fcd877/embed?autostart=1&internal=1&tracking=0&ui_ar=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "The heart is a remarkable four-chambered muscular pump that drives blood circulation throughout your body. This animated cross-section reveals the internal anatomy, showing how the atria receive blood while the ventricles pump it out, creating the continuous flow that sustains life.",
                concepts: [
                    "Four chambers: right & left atria, right & left ventricles",
                    "Atrioventricular valves (tricuspid & bicuspid)",
                    "Semilunar valves (pulmonary & aortic)",
                    "Muscular walls: myocardium contracts rhythmically",
                    "Electrical conduction system controls heartbeat"
                ],
                funFact: "Your heart beats about 100,000 times per day, pumping 2,000 gallons of blood through 60,000 miles of blood vessels!",
                objectives: "Understand heart anatomy, the cardiac cycle, valve function, and how this muscular pump maintains continuous blood circulation.",
                narration: "Welcome to the heart - your body's most vital organ! Watch this animated cross-section as it reveals the heart's incredible four-chambered design. The upper chambers, called atria, act as receiving stations for blood returning to the heart. The right atrium receives deoxygenated blood from the body, while the left atrium receives oxygenated blood from the lungs. Below them, the powerful ventricles serve as the main pumps. The right ventricle sends blood to the lungs for oxygenation, while the left ventricle - with its thickest muscular wall - pumps oxygenated blood to the entire body. Watch how the valves open and close in perfect coordination, ensuring blood flows in only one direction. The lub-dub sound of your heartbeat is actually these valves snapping shut!"
            },
            bloodcells: {
                title: "Blood Components - Cellular Heroes",
                subtitle: "Red cells, white cells, and platelets in action",
                icon: "ü©∏",
                modelUrl: "https://sketchfab.com/models/2be55543997d4641a539a339a8e402fe/embed?autostart=1&internal=1&tracking=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_watermark=0",
                description: "Blood is a complex tissue containing specialized cells suspended in plasma. Red blood cells carry oxygen, white blood cells defend against infection, and platelets help with clotting. Each type has unique structures perfectly adapted for their specific functions.",
                concepts: [
                    "Red blood cells: biconcave discs, no nucleus, 97% hemoglobin",
                    "White blood cells: various types, nucleated, immune defense",
                    "Platelets: cell fragments, clotting and hemostasis",
                    "Plasma: liquid matrix, proteins, nutrients, waste",
                    "Hematocrit: percentage of blood volume as cells"
                ],
                funFact: "You have about 25 trillion red blood cells in your body - if you lined them up, they would circle the Earth four times!",
                objectives: "Identify different blood cell types, understand their specific functions, and appreciate how their structure relates to their roles.",
                narration: "Meet the cellular heroes of your circulatory system! In this detailed view, you can see the three main types of blood cells. The numerous red, disc-shaped cells are red blood cells or erythrocytes. Notice their biconcave shape - like donuts without holes. This unique shape maximizes surface area for gas exchange and allows them to squeeze through tiny capillaries. They've sacrificed their nucleus to pack in more hemoglobin for oxygen transport. The larger, more complex cells are white blood cells or leukocytes. These are your immune system's patrol officers, each type specialized for different defensive tasks. Finally, the tiny fragments are platelets or thrombocytes - your body's repair crew that springs into action when blood vessels are damaged, forming clots to prevent blood loss."
            },
            vessels: {
                title: "Blood Vessel Architecture",
                subtitle: "The highways of circulation",
                icon: "üöá",
                modelUrl: "https://sketchfab.com/models/29ac5461ef1745fb8d92f69d92d52d7d/embed?autostart=1&internal=1&tracking=0&ui_ar=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "Blood vessels form an intricate network of tubes that transport blood throughout the body. Arteries, veins, and capillaries each have specialized structures that enable them to perform their specific roles in circulation.",
                concepts: [
                    "Arteries: thick elastic walls, high pressure, carry blood away from heart",
                    "Veins: thinner walls, valves prevent backflow, return blood to heart",
                    "Capillaries: single cell layer, gas and nutrient exchange",
                    "Smooth muscle controls vessel diameter (vasoconstriction/dilation)",
                    "Endothelium: inner lining, maintains vessel health"
                ],
                funFact: "Your capillaries are so narrow that red blood cells must travel through them in single file, like cars in a tunnel!",
                objectives: "Compare vessel types, understand how structure relates to function, and learn about blood pressure regulation.",
                narration: "Explore the architecture of your vascular highways! This detailed cross-section shows the three main types of blood vessels. Arteries have thick, muscular walls with elastic fibers that can stretch and recoil with each heartbeat. This elasticity helps maintain blood pressure between heartbeats. The smooth muscle layer allows arteries to constrict or dilate, controlling blood flow to different organs. Veins have thinner walls and contain one-way valves that prevent blood from flowing backward as it returns to the heart against gravity. Between arteries and veins lie the microscopic capillaries - so thin their walls are just one cell thick. This minimal barrier allows rapid exchange of oxygen, nutrients, and waste between blood and tissues. Together, these vessels form a 60,000-mile network that reaches every cell in your body!"
            },
            bloodflow: {
                title: "Blood Flow Dynamics",
                subtitle: "Journey through the arterial highway",
                icon: "üåä",
                modelUrl: "https://sketchfab.com/models/246576050a644cb4ae16840922385e39/embed?autostart=1&internal=1&tracking=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_watermark=0",
                description: "Take an incredible journey inside an artery and witness blood flow in action. See how red and white blood cells travel through the bloodstream, adapting to the vessel's geometry and responding to the pulsatile flow from the heart.",
                concepts: [
                    "Pulsatile flow: pressure waves from heartbeat",
                    "Laminar flow: smooth layers, fastest in center",
                    "Blood viscosity: thickness affects flow resistance", 
                    "Hematocrit effects: cell concentration impacts flow",
                    "Autoregulation: vessels adjust to maintain flow"
                ],
                funFact: "Blood travels at different speeds - about 40 cm/second in the aorta but slows to 0.03 cm/second in capillaries for optimal exchange!",
                objectives: "Understand blood flow physics, observe cellular behavior in vessels, and appreciate hemodynamic principles.",
                narration: "Welcome aboard the arterial express! You're now traveling inside a blood vessel, witnessing the incredible rush hour that happens in your circulatory system 24/7. Watch the red blood cells flowing past you - they're not just passively carried along, but actively deform and tumble as they navigate the vessel. Notice how they travel faster in the center of the vessel where there's less friction, creating what we call laminar flow. The white blood cells move more slowly and sometimes roll along the vessel walls, ready to exit if they detect signs of infection. You can see the pulsatile nature of blood flow - each surge corresponds to a heartbeat pushing blood forward. The vessel walls are alive too, with smooth muscle cells that can contract or relax to control the vessel diameter and regulate blood pressure. This is your body's circulatory highway in action!"
            },
            circulation: {
                title: "Double Circulation System",
                subtitle: "Two circuits working in perfect harmony",
                icon: "üîÑ",
                modelUrl: "https://sketchfab.com/models/e3bce8d00627427aaa51311939826e1b/embed?autostart=1&internal=1&tracking=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_watermark=0",
                description: "Humans have evolved a sophisticated double circulation system where blood passes through the heart twice in each complete circuit. This design efficiently separates oxygenated and deoxygenated blood, maximizing oxygen delivery to tissues.",
                concepts: [
                    "Pulmonary circulation: right heart ‚Üí lungs ‚Üí left heart",
                    "Systemic circulation: left heart ‚Üí body ‚Üí right heart",
                    "Complete separation of oxygenated and deoxygenated blood",
                    "Higher efficiency than single circulation systems",
                    "Allows for different pressures in each circuit"
                ],
                funFact: "Complete circulation takes only 60 seconds - blood travels from your heart to your toes and back in just one minute!",
                objectives: "Trace the path of blood through both circuits, understand the advantages of double circulation, and compare with other circulatory systems.",
                narration: "Behold the elegant double circulation system that powers human life! Follow the blue pathway showing deoxygenated blood leaving the right ventricle through the pulmonary artery, traveling to the lungs where it releases carbon dioxide and picks up oxygen. The now oxygen-rich blood returns through pulmonary veins to the left atrium - this is pulmonary circulation. Now follow the red pathway as oxygenated blood leaves the left ventricle through the mighty aorta, delivering oxygen and nutrients to every organ and tissue in your body. After giving up its oxygen, the deoxygenated blood returns through the vena cava to the right atrium - this is systemic circulation. This double system is incredibly efficient because it ensures tissues always receive fully oxygenated blood, unlike the mixed blood found in simpler circulatory systems. The separation also allows different pressures - high pressure for systemic circulation to reach distant organs, and lower pressure for delicate lung circulation."
            },
            hemoglobin: {
                title: "Activity 5.7 - Hemoglobin Investigation",
                subtitle: "Investigating oxygen-carrying capacity",
                icon: "üî¨",
                modelUrl: "https://sketchfab.com/models/2be55543997d4641a539a339a8e402fe/embed?autostart=1&internal=1&tracking=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_watermark=0",
                description: "This activity investigates how hemoglobin concentration affects blood's oxygen-carrying capacity. By examining blood samples and measuring hemoglobin levels, we can understand the relationship between hemoglobin content and oxygen transport efficiency.",
                concepts: [
                    "Normal hemoglobin levels: 12-16 g/dL (females), 14-18 g/dL (males)",
                    "Each gram of hemoglobin carries 1.34 mL of oxygen",
                    "Oxygen-carrying capacity = Hemoglobin √ó 1.34 √ó Oxygen saturation",
                    "Anemia: reduced hemoglobin affects oxygen delivery",
                    "Altitude adaptation: increased hemoglobin production"
                ],
                funFact: "People living at high altitudes naturally produce more red blood cells and hemoglobin to compensate for lower oxygen levels!",
                objectives: "Calculate oxygen-carrying capacity from hemoglobin measurements and understand factors affecting hemoglobin levels.",
                narration: "Let's investigate hemoglobin content and its crucial role in oxygen transport! In this activity, we examine how varying hemoglobin concentrations directly impact blood's ability to carry oxygen. Normal hemoglobin levels range from 12-16 grams per deciliter in females and 14-18 grams per deciliter in males. Here's the key calculation: each gram of hemoglobin can carry 1.34 milliliters of oxygen when fully saturated. So if someone has 15 grams of hemoglobin per deciliter, their oxygen-carrying capacity would be 15 times 1.34, which equals about 20 milliliters of oxygen per deciliter of blood! When hemoglobin levels drop due to anemia, oxygen delivery to tissues decreases, causing fatigue and weakness. Conversely, people living at high altitudes naturally produce more hemoglobin to compensate for the lower oxygen availability. This investigation helps us understand why hemoglobin measurement is such an important clinical test!",
                activity: "Investigate how hemoglobin levels affect oxygen transport by calculating oxygen-carrying capacity using the formula: Hb level √ó 1.34 √ó O‚ÇÇ saturation percentage."
            },
            pathways: {
                title: "Circulation Pathways Overview",
                subtitle: "Mapping the complete circulatory network",
                icon: "üó∫Ô∏è",
                modelUrl: "https://sketchfab.com/models/e3bce8d00627427aaa51311939826e1b/embed?autostart=1&internal=1&tracking=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_watermark=0",
                description: "The complete circulatory system includes specialized pathways for different organs and functions. Portal systems, coronary circulation, and cerebral blood flow each have unique characteristics that meet specific physiological needs.",
                concepts: [
                    "Coronary circulation: heart's own blood supply",
                    "Cerebral circulation: brain's protected blood flow",
                    "Hepatic portal system: liver's dual blood supply",
                    "Renal circulation: kidney's filtration system",
                    "Fetal circulation: unique pathways before birth"
                ],
                funFact: "Your brain receives 20% of your total blood flow despite being only 2% of your body weight - it's a very demanding organ!",
                objectives: "Identify specialized circulation pathways and understand how different organs have adapted circulation to meet their specific needs.",
                narration: "Let's explore the specialized highways of circulation that serve different organs! The heart has its own private blood supply called coronary circulation - the coronary arteries branch directly from the aorta to feed the heart muscle itself. The brain has special protection with the blood-brain barrier and receives a generous 20% of total blood flow despite being only 2% of body weight. The liver is unique with its portal system - it receives blood from both the hepatic artery and the portal vein that collects nutrient-rich blood from the intestines. The kidneys get about 25% of cardiac output for their filtration work. During fetal development, circulation follows completely different pathways with shunts that bypass the non-functioning lungs. Each of these specialized circuits demonstrates how evolution has fine-tuned circulation to meet the specific metabolic demands of different organs and life stages. It's a beautifully orchestrated system where every pathway serves a purpose!"
            }
        };

        // Global Variables
        let currentStep = 'heart';
        let voiceEnabled = true;
        let autoPlayEnabled = false;
        let currentSpeech = null;
        let selectedVoice = null;
        let journeyProgress = 0;
        let guidedTourActive = false;

        // Initialize Voice System
        function initVoiceSystem() {
            if (!('speechSynthesis' in window)) {
                console.warn('Speech synthesis not supported');
                voiceEnabled = false;
                document.getElementById('voiceToggle').style.display = 'none';
                return;
            }

            function loadVoices() {
                const voices = speechSynthesis.getVoices();
                if (voices.length === 0) return;

                const preferredVoices = [
                    'Google UK English Female',
                    'Microsoft Sonia',
                    'Microsoft Hazel',
                    'Samantha',
                    'Victoria'
                ];

                for (const name of preferredVoices) {
                    selectedVoice = voices.find(v => v.name.includes(name));
                    if (selectedVoice) break;
                }

                if (!selectedVoice) {
                    selectedVoice = voices.find(v => v.lang.startsWith('en'));
                }
            }

            loadVoices();
            if (speechSynthesis.onvoiceschanged !== undefined) {
                speechSynthesis.onvoiceschanged = loadVoices;
            }
        }

        // Load Journey Step
        function loadJourneyStep(stepId) {
            const stepData = JOURNEY_DATA[stepId];
            if (!stepData) return;

            currentStep = stepId;
            
            // Update model
            document.getElementById('api-frame').src = stepData.modelUrl;
            
            // Update info panel
            document.getElementById('stepIcon').textContent = stepData.icon;
            document.getElementById('stepTitle').textContent = stepData.title;
            document.getElementById('stepSubtitle').textContent = stepData.subtitle;
            document.getElementById('mainDescription').textContent = stepData.description;
            
            // Update key concepts
            const conceptsList = document.getElementById('keyConcepts');
            conceptsList.innerHTML = stepData.concepts.map(c => `<li>${c}</li>`).join('');
            
            // Update fun fact
            document.getElementById('funFact').textContent = stepData.funFact;
            
            // Update learning objectives
            document.getElementById('learningObjectives').textContent = stepData.objectives;
            
            // Add activity box if present
            const existingActivity = document.querySelector('.activity-box');
            if (existingActivity) existingActivity.remove();
            
            if (stepData.activity) {
                const activityBox = document.createElement('div');
                activityBox.className = 'activity-box';
                activityBox.innerHTML = `
                    <div class="activity-title">Activity 5.7 - Laboratory Investigation</div>
                    <div class="activity-text">${stepData.activity}</div>
                `;
                document.querySelector('.fun-fact').parentNode.insertBefore(activityBox, document.querySelector('.fun-fact').nextSibling);
            }
            
            // Update navigation buttons
            updateNavigationButtons(stepId);
            
            // Update progress
            updateProgress();
            
            // Play narration if enabled
            if (voiceEnabled) {
                speakText(stepData.narration);
            }
        }

        // Update Navigation Buttons
        function updateNavigationButtons(activeStep) {
            const buttons = document.querySelectorAll('.journey-btn');
            const steps = ['heart', 'bloodcells', 'vessels', 'bloodflow', 'circulation', 'hemoglobin', 'pathways'];
            const activeIndex = steps.indexOf(activeStep);
            
            buttons.forEach((btn, index) => {
                btn.classList.remove('active', 'completed');
                if (index < activeIndex) {
                    btn.classList.add('completed');
                } else if (index === activeIndex) {
                    btn.classList.add('active');
                }
            });
            
            // Update mini steps
            const miniSteps = document.querySelectorAll('.step-mini');
            miniSteps.forEach((step, index) => {
                step.classList.remove('active', 'completed');
                if (index < activeIndex) {
                    step.classList.add('completed');
                } else if (index === activeIndex) {
                    step.classList.add('active');
                }
            });
        }

        // Update Progress
        function updateProgress() {
            const steps = ['heart', 'bloodcells', 'vessels', 'bloodflow', 'circulation', 'hemoglobin', 'pathways'];
            const currentIndex = steps.indexOf(currentStep);
            const progress = ((currentIndex + 1) / steps.length) * 100;
            
            document.getElementById('progressPercent').textContent = Math.round(progress) + '%';
            document.getElementById('progressFill').style.width = progress + '%';
        }

        // Speech Functions
        function speakText(text) {
            if (!voiceEnabled || !text) return;
            
            stopSpeech();
            
            currentSpeech = new SpeechSynthesisUtterance(text);
            if (selectedVoice) {
                currentSpeech.voice = selectedVoice;
            }
            currentSpeech.rate = 0.9;
            currentSpeech.pitch = 1.0;
            currentSpeech.volume = 0.9;
            
            currentSpeech.onstart = () => {
                document.getElementById('voiceIndicator').classList.add('visible');
                document.getElementById('narrationText').textContent = 
                    text.substring(0, 50) + (text.length > 50 ? '...' : '');
            };
            
            currentSpeech.onend = () => {
                document.getElementById('voiceIndicator').classList.remove('visible');
                currentSpeech = null;
                
                if (guidedTourActive) {
                    setTimeout(nextStep, 2000);
                }
            };
            
            speechSynthesis.speak(currentSpeech);
        }

        function stopSpeech() {
            if (currentSpeech) {
                speechSynthesis.cancel();
                currentSpeech = null;
                document.getElementById('voiceIndicator').classList.remove('visible');
            }
        }

        // Control Functions
        function toggleVoice() {
            voiceEnabled = !voiceEnabled;
            const btn = document.getElementById('voiceToggle');
            btn.textContent = voiceEnabled ? 'üîä' : 'üîá';
            btn.classList.toggle('active', voiceEnabled);
            
            if (!voiceEnabled) {
                stopSpeech();
            }
        }

        function toggleAutoPlay() {
            autoPlayEnabled = !autoPlayEnabled;
            if (autoPlayEnabled) {
                startGuidedTour();
            } else {
                guidedTourActive = false;
            }
        }

        function toggleInfo() {
            const panel = document.getElementById('infoPanel');
            panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
        }

        // Guided Tour
        function startGuidedTour() {
            guidedTourActive = true;
            const steps = ['heart', 'bloodcells', 'vessels', 'bloodflow', 'circulation', 'hemoglobin', 'pathways'];
            let stepIndex = 0;
            
            function tourStep() {
                if (stepIndex < steps.length && guidedTourActive) {
                    loadJourneyStep(steps[stepIndex]);
                    stepIndex++;
                } else {
                    guidedTourActive = false;
                    if (voiceEnabled) {
                        speakText("Congratulations! You've completed your journey through the human circulatory system. You now understand how your heart, blood vessels, and blood work together to sustain life!");
                    }
                }
            }
            
            tourStep();
            window.nextStep = tourStep;
        }

        // Quiz Function
        function showQuiz() {
            const questions = [
                "How many chambers does the human heart have?",
                "What's the difference between arteries and veins?",
                "Why is double circulation more efficient?",
                "How much oxygen can one gram of hemoglobin carry?",
                "Which circuit carries blood to the lungs?"
            ];
            
            const randomQ = questions[Math.floor(Math.random() * questions.length)];
            
            if (voiceEnabled) {
                speakText(`Here's a question to test your knowledge: ${randomQ} Think about what you've learned about circulation!`);
            }
        }

        // Initialize
        function init() {
            initVoiceSystem();
            
            // Hide loading screen
            setTimeout(() => {
                const loading = document.getElementById('loadingOverlay');
                loading.style.opacity = '0';
                setTimeout(() => {
                    loading.style.display = 'none';
                    
                    // Welcome message
                    if (voiceEnabled) {
                        speakText("Welcome to your journey through the human circulatory system! We'll explore how your heart pumps blood through an amazing network of vessels to sustain every cell in your body. Let's start with the incredible four-chambered heart!");
                    }
                }, 1000);
            }, 3000);
            
            // Keyboard shortcuts
            document.addEventListener('keydown', (e) => {
                switch(e.key) {
                    case 'v': toggleVoice(); break;
                    case 'i': toggleInfo(); break;
                    case 'g': startGuidedTour(); break;
                    case 'Escape': stopSpeech(); guidedTourActive = false; break;
                    case 'ArrowRight': nextStep && nextStep(); break;
                }
            });
        }

        // Start the application
        init();
    </script>
</body>
</html>