<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Excretion Regulation and Plant Excretion - Interactive Journey</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tween.js/18.6.4/tween.umd.js"></script>

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 25%, #3498db 50%, #e67e22 75%, #f39c12 100%);
            color: white;
            overflow: hidden;
            position: relative;
            height: 100vh;
        }

        /* Animated Background */
        .bg-animation {
            position: fixed;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: 0;
            opacity: 0.1;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 320"><path fill="%23ffffff" fill-opacity="0.2" d="M0,96L48,112C96,128,192,160,288,186.7C384,213,480,235,576,213.3C672,192,768,128,864,128C960,128,1056,192,1152,197.3C1248,203,1344,149,1392,122.7L1440,96L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z"></path></svg>') repeat-x;
            animation: wave 14s linear infinite;
        }

        @keyframes wave {
            0% { background-position-x: 0; }
            100% { background-position-x: 1440px; }
        }

        /* Museum Interface */
        .museum-header {
            position: absolute;
            top: 10px;
            left: 20px;
            text-align: left;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            padding: 10px 18px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .museum-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 4px;
            background: linear-gradient(45deg, #27ae60, #f39c12);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: titleGlow 3s ease-in-out infinite;
        }

        @keyframes titleGlow {
            0%, 100% { filter: brightness(1); }
            50% { filter: brightness(1.3); }
        }

        .exhibit-subtitle {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.8);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .excretion-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            background: #3498db;
            border-radius: 50%;
            animation: excretion 2.5s ease-in-out infinite;
        }

        @keyframes excretion {
            0%, 100% { transform: scale(1) translateY(0); opacity: 1; background: #3498db; }
            33% { transform: scale(1.2) translateY(-2px); opacity: 0.8; background: #27ae60; }
            66% { transform: scale(1.4) translateY(-4px); opacity: 0.6; background: #f39c12; }
        }

        /* Journey Navigation */
        .journey-navigation {
            position: absolute;
            bottom: 20px;
            left: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            padding: 15px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            max-width: 350px;
        }

        .journey-title {
            font-size: 14px;
            font-weight: 600;
            color: #27ae60;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .journey-steps {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }

        .journey-btn {
            background: rgba(39, 174, 96, 0.2);
            border: 1px solid rgba(39, 174, 96, 0.4);
            color: white;
            padding: 6px 10px;
            border-radius: 20px;
            font-size: 11px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 4px;
            white-space: nowrap;
        }

        .journey-btn:hover {
            background: rgba(39, 174, 96, 0.3);
            border-color: #27ae60;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(39, 174, 96, 0.3);
        }

        .journey-btn.active {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            border-color: #27ae60;
            box-shadow: 0 0 20px rgba(39, 174, 96, 0.5);
            animation: pulse 2s infinite;
        }

        .journey-btn.completed {
            background: rgba(243, 156, 18, 0.3);
            border-color: #f39c12;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        /* 3D Model Container */
        .model-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 0;
            overflow: hidden;
            border: none;
            z-index: 100;
        }

        .sketchfab-embed-wrapper {
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 25%, #3498db 50%, #e67e22 75%, #f39c12 100%);
        }

        .sketchfab-embed-wrapper iframe {
            width: 100%;
            height: 100%;
            border: none;
            border-radius: 0;
        }

        /* Information Panel */
        .info-panel {
            position: absolute;
            top: 70px;
            right: 20px;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(25px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 16px;
            padding: 24px;
            width: 420px;
            max-height: calc(100vh - 140px);
            z-index: 800;
            overflow-y: auto;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }

        .info-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        }

        .info-icon {
            font-size: 28px;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        .info-title {
            flex: 1;
        }

        .info-title h2 {
            font-size: 18px;
            color: #27ae60;
            margin-bottom: 4px;
        }

        .info-subtitle {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.7);
        }

        .info-content {
            color: rgba(255, 255, 255, 0.9);
            font-size: 14px;
            line-height: 1.6;
        }

        /* Progress Tracker */
        .progress-tracker {
            background: linear-gradient(135deg, rgba(39, 174, 96, 0.1), rgba(243, 156, 18, 0.1));
            border: 1px solid rgba(39, 174, 96, 0.3);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 20px;
        }

        .progress-header {
            font-size: 13px;
            font-weight: 600;
            color: #27ae60;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .progress-percentage {
            font-size: 18px;
            color: #f39c12;
            font-weight: 700;
        }

        .progress-bar {
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 12px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #27ae60, #f39c12);
            border-radius: 4px;
            transition: width 0.8s ease;
            box-shadow: 0 0 10px rgba(39, 174, 96, 0.5);
        }

        .progress-steps-mini {
            display: flex;
            justify-content: space-between;
            font-size: 9px;
            color: rgba(255, 255, 255, 0.6);
            flex-wrap: wrap;
            gap: 3px;
        }

        .step-mini {
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            flex: 1;
            min-width: 45px;
        }

        .step-mini.active {
            color: #27ae60;
            font-weight: 600;
        }

        .step-mini.completed {
            color: #f39c12;
        }

        /* Information Cards */
        .info-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 14px;
            margin-bottom: 14px;
        }

        .info-card-title {
            color: #27ae60;
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .info-card-content {
            color: rgba(255, 255, 255, 0.85);
            font-size: 12px;
            line-height: 1.5;
        }

        .info-list {
            list-style: none;
            padding: 0;
        }

        .info-list li {
            padding: 6px 0;
            padding-left: 20px;
            position: relative;
            font-size: 12px;
            color: rgba(255, 255, 255, 0.8);
        }

        .info-list li:before {
            content: "→";
            position: absolute;
            left: 0;
            color: #27ae60;
        }

        /* Comparison Box */
        .comparison-box {
            background: linear-gradient(135deg, rgba(155, 89, 182, 0.1), rgba(52, 152, 219, 0.1));
            border: 1px solid rgba(155, 89, 182, 0.3);
            border-radius: 12px;
            padding: 14px;
            margin: 16px 0;
            position: relative;
            overflow: hidden;
        }

        .comparison-box:before {
            content: "⚖️";
            position: absolute;
            top: -20px;
            right: -20px;
            font-size: 60px;
            opacity: 0.1;
        }

        .comparison-title {
            color: #9b59b6;
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 6px;
        }

        .comparison-text {
            color: rgba(255, 255, 255, 0.9);
            font-size: 12px;
            line-height: 1.5;
            position: relative;
            z-index: 1;
        }

        /* Fun Fact Box */
        .fun-fact {
            background: linear-gradient(135deg, rgba(46, 204, 113, 0.1), rgba(52, 152, 219, 0.1));
            border: 1px solid rgba(46, 204, 113, 0.3);
            border-radius: 12px;
            padding: 14px;
            margin: 16px 0;
            position: relative;
            overflow: hidden;
        }

        .fun-fact:before {
            content: "🌿";
            position: absolute;
            top: -20px;
            right: -20px;
            font-size: 60px;
            opacity: 0.1;
        }

        .fun-fact-title {
            color: #2ecc71;
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 6px;
        }

        .fun-fact-text {
            color: rgba(255, 255, 255, 0.9);
            font-size: 12px;
            line-height: 1.5;
            position: relative;
            z-index: 1;
        }

        /* Voice Controls */
        .voice-controls {
            position: absolute;
            top: 10px;
            right: 20px;
            display: flex;
            gap: 8px;
            z-index: 1000;
        }

        .control-btn {
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            width: 44px;
            height: 44px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            position: relative;
        }

        .control-btn:hover {
            background: rgba(39, 174, 96, 0.3);
            border-color: #27ae60;
            transform: scale(1.1);
        }

        .control-btn.active {
            background: rgba(39, 174, 96, 0.4);
            border-color: #27ae60;
            box-shadow: 0 0 20px rgba(39, 174, 96, 0.5);
        }

        .control-tooltip {
            position: absolute;
            bottom: -30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9);
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 10px;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .control-btn:hover .control-tooltip {
            opacity: 1;
        }

        /* Loading Screen */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 25%, #3498db 50%, #e67e22 75%, #f39c12 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            transition: opacity 1s ease;
        }

        .loading-content {
            text-align: center;
        }

        .loading-icon {
            font-size: 60px;
            animation: excretion 1.5s ease-in-out infinite;
            margin-bottom: 20px;
        }

        .loading-text {
            color: white;
            font-size: 20px;
            margin-bottom: 20px;
        }

        .loading-progress {
            width: 200px;
            height: 4px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 2px;
            overflow: hidden;
        }

        .loading-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #27ae60, #f39c12);
            animation: loading 2s ease-in-out infinite;
        }

        @keyframes loading {
            0% { width: 0%; }
            50% { width: 100%; }
            100% { width: 0%; }
        }

        /* Voice Indicator */
        .voice-indicator {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(39, 174, 96, 0.5);
            border-radius: 30px;
            padding: 14px 28px;
            display: flex;
            align-items: center;
            gap: 12px;
            z-index: 1000;
            opacity: 0;
            transition: all 0.3s ease;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }

        .voice-indicator.visible {
            opacity: 1;
            transform: translateX(-50%) translateY(-10px);
        }

        .voice-waves {
            display: flex;
            align-items: center;
            gap: 3px;
        }

        .voice-wave {
            width: 3px;
            height: 20px;
            background: linear-gradient(180deg, #27ae60, #f39c12);
            border-radius: 2px;
            animation: voice-wave 1s ease-in-out infinite;
        }

        .voice-wave:nth-child(2) { animation-delay: 0.1s; }
        .voice-wave:nth-child(3) { animation-delay: 0.2s; }
        .voice-wave:nth-child(4) { animation-delay: 0.3s; }
        .voice-wave:nth-child(5) { animation-delay: 0.4s; }

        @keyframes voice-wave {
            0%, 100% { transform: scaleY(0.3); }
            50% { transform: scaleY(1); }
        }

        .narration-text {
            color: white;
            font-size: 13px;
            max-width: 300px;
        }

        /* Quick Actions */
        .quick-actions {
            position: absolute;
            bottom: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            z-index: 1000;
        }

        .action-btn {
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 10px 16px;
            border-radius: 25px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
        }

        .action-btn:hover {
            background: rgba(39, 174, 96, 0.3);
            border-color: #27ae60;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(39, 174, 96, 0.3);
        }

        /* Custom Scrollbar */
        .info-panel::-webkit-scrollbar {
            width: 6px;
        }

        .info-panel::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 3px;
        }

        .info-panel::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, #27ae60, #f39c12);
            border-radius: 3px;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .info-panel {
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                top: auto;
                width: 100%;
                max-height: 50vh;
                border-radius: 20px 20px 0 0;
            }
            
            .journey-navigation {
                bottom: 52vh;
                max-width: calc(100% - 40px);
            }
            
            .voice-controls {
                top: auto;
                bottom: 55vh;
                right: 10px;
            }
            
            .quick-actions {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="bg-animation"></div>

    <!-- Loading Screen -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-content">
            <div class="loading-icon">🌱</div>
            <div class="loading-text">Preparing Excretion Journey...</div>
            <div class="loading-progress">
                <div class="loading-progress-bar"></div>
            </div>
        </div>
    </div>

    <!-- Museum Header -->
    <div class="museum-header">
        <div class="museum-title">Excretion Regulation & Plant Excretion</div>
        <div class="exhibit-subtitle">
            <span class="excretion-indicator"></span>
            Waste Management Across Life Forms
        </div>
    </div>

    <!-- Journey Navigation -->
    <div class="journey-navigation">
        <div class="journey-title">
            <span>🌿</span>
            <span>Excretion Systems Journey</span>
        </div>
        <div class="journey-steps">
            <button class="journey-btn active" onclick="loadJourneyStep('regulation')">
                <span>⚙️</span> Urine Regulation
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('plantcell')">
                <span>🌱</span> Plant Cell
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('bark')">
                <span>🌳</span> Tree Bark
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('leaves')">
                <span>🍃</span> Leaf Shedding
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('strategies')">
                <span>🎯</span> Plant Strategies
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('comparison')">
                <span>⚖️</span> Comparison
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('evolution')">
                <span>🔄</span> Evolution
            </button>
        </div>
    </div>

    <!-- 3D Model Container -->
    <div class="model-container">
        <div class="sketchfab-embed-wrapper">
            <iframe id="api-frame"
                    title="Excretion Systems Model" 
                    frameborder="0" 
                    allowfullscreen 
                    mozallowfullscreen="true" 
                    webkitallowfullscreen="true" 
                    allow="autoplay; fullscreen; xr-spatial-tracking"
                    xr-spatial-tracking 
                    execution-while-out-of-viewport 
                    execution-while-not-rendered 
                    web-share 
                    src="https://sketchfab.com/models/30319ce9c5a441bdb6feeb9926c15284/embed?autostart=1&internal=1&tracking=0&ui_ar=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0">
            </iframe>
        </div>
    </div>

    <!-- Information Panel -->
    <div class="info-panel" id="infoPanel">
        <div class="info-header">
            <div class="info-icon" id="stepIcon">⚙️</div>
            <div class="info-title">
                <h2 id="stepTitle">Urine Concentration Regulation</h2>
                <div class="info-subtitle" id="stepSubtitle">Precise control of water and waste balance</div>
            </div>
        </div>

        <!-- Progress Tracker -->
        <div class="progress-tracker">
            <div class="progress-header">
                <span>Excretion Knowledge Progress</span>
                <span class="progress-percentage" id="progressPercent">14%</span>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 14%"></div>
            </div>
            <div class="progress-steps-mini">
                <span class="step-mini active" onclick="loadJourneyStep('regulation')">Reg</span>
                <span class="step-mini" onclick="loadJourneyStep('plantcell')">Cell</span>
                <span class="step-mini" onclick="loadJourneyStep('bark')">Bark</span>
                <span class="step-mini" onclick="loadJourneyStep('leaves')">Leaves</span>
                <span class="step-mini" onclick="loadJourneyStep('strategies')">Strat</span>
                <span class="step-mini" onclick="loadJourneyStep('comparison')">Comp</span>
                <span class="step-mini" onclick="loadJourneyStep('evolution')">Evol</span>
            </div>
        </div>

        <div class="info-content" id="mainDescription">
            The nephron's ability to concentrate urine is one of the most sophisticated regulatory mechanisms in biology. Through hormonal control and osmotic gradients, kidneys can produce urine ranging from very dilute to highly concentrated, precisely matching the body's hydration needs.
        </div>

        <div class="info-card">
            <div class="info-card-title">
                <span>🔬</span> Regulation Mechanisms
            </div>
            <div class="info-card-content">
                <ul class="info-list" id="keyConcepts">
                    <li>ADH hormone controls water reabsorption in collecting duct</li>
                    <li>Aldosterone regulates sodium reabsorption</li>
                    <li>Osmotic gradient in medulla concentrates urine</li>
                    <li>Countercurrent system multiplies concentration</li>
                    <li>Thirst mechanism coordinates with kidney function</li>
                </ul>
            </div>
        </div>

        <div class="fun-fact">
            <div class="fun-fact-title">Regulation Facts!</div>
            <div class="fun-fact-text" id="funFact">
                Your kidneys can concentrate urine to 1200 mOsm/kg - four times more concentrated than your blood plasma!
            </div>
        </div>

        <div class="info-card">
            <div class="info-card-title">
                <span>🎯</span> Learning Objectives
            </div>
            <div class="info-card-content" id="learningObjectives">
                Understand how hormones regulate urine concentration, learn about osmotic gradients, and appreciate the precision of kidney regulation.
            </div>
        </div>
    </div>

    <!-- Voice Controls -->
    <div class="voice-controls">
        <button class="control-btn active" id="voiceToggle" onclick="toggleVoice()">
            🔊
            <span class="control-tooltip">Voice Narration</span>
        </button>
        <button class="control-btn" onclick="toggleAutoPlay()">
            ▶️
            <span class="control-tooltip">Auto Journey</span>
        </button>
        <button class="control-btn" onclick="toggleInfo()">
            ℹ️
            <span class="control-tooltip">Toggle Info</span>
        </button>
    </div>

    <!-- Quick Actions -->
    <div class="quick-actions">
        <button class="action-btn" onclick="startGuidedTour()">
            <span>🚀</span> Guided Tour
        </button>
        <button class="action-btn" onclick="showQuiz()">
            <span>🎯</span> Test Knowledge
        </button>
    </div>

    <!-- Voice Indicator -->
    <div class="voice-indicator" id="voiceIndicator">
        <div class="voice-waves">
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
        </div>
        <div class="narration-text" id="narrationText">Narrating...</div>
    </div>

    <script>
        // Journey Step Data for Excretion Regulation and Plant Excretion
        const JOURNEY_DATA = {
            regulation: {
                title: "Urine Concentration Regulation",
                subtitle: "Precise control of water and waste balance",
                icon: "⚙️",
                modelUrl: "https://sketchfab.com/models/30319ce9c5a441bdb6feeb9926c15284/embed?autostart=1&internal=1&tracking=0&ui_ar=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "The nephron's ability to concentrate urine is one of the most sophisticated regulatory mechanisms in biology. Through hormonal control and osmotic gradients, kidneys can produce urine ranging from very dilute to highly concentrated, precisely matching the body's hydration needs.",
                concepts: [
                    "ADH hormone controls water reabsorption in collecting duct",
                    "Aldosterone regulates sodium reabsorption",
                    "Osmotic gradient in medulla concentrates urine",
                    "Countercurrent system multiplies concentration",
                    "Thirst mechanism coordinates with kidney function"
                ],
                funFact: "Your kidneys can concentrate urine to 1200 mOsm/kg - four times more concentrated than your blood plasma!",
                objectives: "Understand how hormones regulate urine concentration, learn about osmotic gradients, and appreciate the precision of kidney regulation.",
                narration: "Welcome to the remarkable world of urine concentration regulation! This nephron model shows how your kidneys precisely control water and waste balance. When you're dehydrated, your brain releases ADH - antidiuretic hormone - which makes the collecting duct more permeable to water. This allows more water to be reabsorbed back into your bloodstream, producing concentrated urine. The loop of Henle creates a concentration gradient in the kidney medulla through its countercurrent multiplier system. The descending limb allows water out but not salt, while the ascending limb actively pumps out salt but not water. This creates an increasingly concentrated environment that can concentrate urine up to 1200 milliosmoles per kilogram! Meanwhile, aldosterone fine-tunes sodium reabsorption, and your thirst mechanism works in coordination to maintain perfect fluid balance. It's like having a sophisticated water treatment plant that automatically adjusts based on your body's needs!"
            },
            plantcell: {
                title: "Plant Cell Excretion - Vacuole Storage",
                subtitle: "Cellular waste management in plants",
                icon: "🌱",
                modelUrl: "https://sketchfab.com/models/f258c65762e5435c9d58c1aa136b557a/embed?autostart=1&internal=1&tracking=0&ui_ar=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "Unlike animals, plant cells have evolved unique excretion strategies centered around the large central vacuole. This organelle serves as a storage compartment for metabolic wastes, maintaining cellular homeostasis through isolation rather than elimination.",
                concepts: [
                    "Central vacuole: primary waste storage organelle",
                    "Metabolic wastes stored as crystals or dissolved compounds",
                    "Alkaloids and tannins: toxic waste products with secondary functions",
                    "Cellular compartmentalization prevents waste toxicity",
                    "No active transport system needed for waste removal"
                ],
                funFact: "A plant cell's vacuole can occupy up to 90% of the cell volume, making it the largest organelle and primary waste storage facility!",
                objectives: "Learn how plant cells manage waste through storage, understand vacuole function, and appreciate cellular compartmentalization strategies.",
                narration: "Explore the ingenious excretion strategy of plant cells! Unlike animal cells that must actively remove wastes, plant cells use the large central vacuole as a permanent storage facility. This massive organelle can occupy up to 90% of the cell volume and serves as both a waste depot and structural support. Metabolic wastes like oxalic acid are stored as calcium oxalate crystals, while other wastes are dissolved in the vacuolar sap. Many waste products serve double duty - alkaloids like caffeine and nicotine are waste compounds that also function as pesticides to protect the plant! Tannins, which give tea and wine their bitter taste, are also waste products stored in vacuoles. The beauty of this system is that it requires no energy for waste removal - the cell simply sequesters harmful compounds away from vital cellular machinery. The vacuolar membrane carefully controls what enters and exits, maintaining the proper ionic balance while safely storing potentially toxic metabolic byproducts!"
            },
            bark: {
                title: "Tree Bark - Permanent Waste Storage",
                subtitle: "Structural excretion through bark formation",
                icon: "🌳",
                modelUrl: "https://sketchfab.com/models/462787a180cc4f438c979d39138130a1/embed?autostart=1&internal=1&tracking=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_watermark=0",
                description: "Tree bark represents one of nature's most elegant excretion solutions. Dead bark cells become permanent repositories for metabolic wastes, including tannins, resins, and toxic compounds, effectively removing them from the living tree while providing protection.",
                concepts: [
                    "Outer bark: dead tissue filled with waste products",
                    "Cork cambium continuously produces new bark cells",
                    "Tannins and phenolic compounds concentrated in bark",
                    "Resins and oils stored as waste products",
                    "Bark shedding physically removes accumulated wastes"
                ],
                funFact: "The bark of a 100-year-old oak tree can contain over 50 different waste compounds, some of which have become valuable medicines and industrial chemicals!",
                objectives: "Understand how trees use bark for waste storage, learn about waste accumulation in dead tissue, and appreciate structural excretion strategies.",
                narration: "Discover how trees have turned waste storage into a protective advantage! Tree bark is essentially a graveyard of cells that have been filled with metabolic wastes and then abandoned by the tree. The cork cambium continuously produces new bark cells that quickly fill with waste products like tannins, phenolic compounds, resins, and oils. These dead cells form protective layers that shield the living tree from insects, pathogens, and physical damage. What's remarkable is that many of these 'waste' compounds have become incredibly valuable - the tannins used in leather production, the salicin in willow bark that led to aspirin, and countless other medicinal compounds. As the tree grows, older bark is shed, physically removing accumulated wastes from the tree. This system is so effective that some trees can live for thousands of years without any waste-related toxicity. The bark literally becomes a library of the tree's metabolic history, with different layers representing different years of waste accumulation!"
            },
            leaves: {
                title: "Leaf Shedding - Annual Waste Removal",
                subtitle: "Deciduous trees' seasonal excretion strategy",
                icon: "🍃",
                modelUrl: "https://sketchfab.com/models/aa926551c9184f37afdca7b07e1f6421/embed?autostart=1&internal=1&tracking=0&ui_ar=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "Deciduous leaf shedding represents the ultimate plant excretion strategy - removing entire organs loaded with accumulated metabolic wastes. This annual process combines waste removal with resource conservation and seasonal adaptation.",
                concepts: [
                    "Senescence: programmed aging and waste accumulation in leaves",
                    "Nutrient translocation: valuable materials moved before shedding",
                    "Abscission layer: specialized tissue for clean leaf separation",
                    "Waste compounds concentrated before leaf drop",
                    "Seasonal timing coordinated with environmental cues"
                ],
                funFact: "A single large deciduous tree can shed 200,000 leaves each fall, removing several kilograms of accumulated metabolic wastes from the tree!",
                objectives: "Learn how leaf shedding removes wastes, understand senescence and abscission processes, and appreciate seasonal excretion strategies.",
                narration: "Witness one of nature's most spectacular excretion events - the annual leaf drop! These fallen leaves represent a massive waste removal operation that deciduous trees perform each autumn. Throughout the growing season, leaves accumulate metabolic wastes, damaged proteins, and toxic compounds. As winter approaches, the tree initiates senescence - a programmed aging process where valuable nutrients like nitrogen and phosphorus are transported back to the trunk and roots for storage. Meanwhile, waste compounds become concentrated in the aging leaves. The tree then forms an abscission layer - a specialized zone of cells that will eventually separate the leaf from the branch. This process is triggered by environmental cues like shorter days and cooler temperatures. When the abscission layer activates, the leaf detaches cleanly, carrying away all its accumulated wastes. A large tree can shed 200,000 leaves, removing several kilograms of metabolic waste in one coordinated event! The beautiful autumn colors we see are actually waste products - anthocyanins and carotenoids - being concentrated before disposal. It's the ultimate spring cleaning, but in reverse!"
            },
            strategies: {
                title: "Plant Excretion Strategies Overview",
                subtitle: "Diverse approaches to waste management",
                icon: "🎯",
                modelUrl: "https://sketchfab.com/models/f258c65762e5435c9d58c1aa136b557a/embed?autostart=1&internal=1&tracking=0&ui_ar=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "Plants have evolved multiple ingenious excretion strategies that differ fundamentally from animal systems. These include cellular storage, structural deposition, organ shedding, and even transforming wastes into useful compounds.",
                concepts: [
                    "Storage excretion: vacuoles and specialized cells",
                    "Structural excretion: bark, heartwood, and dead tissues",
                    "Shedding excretion: leaves, flowers, and fruit",
                    "Transformation: converting wastes to defensive compounds",
                    "Secretion: gums, resins, and latex as waste products"
                ],
                funFact: "Some plants like rubber trees have turned waste excretion into a defense mechanism - their latex contains 200+ toxic compounds that deter herbivores!",
                objectives: "Compare different plant excretion strategies, understand their advantages and limitations, and appreciate plant waste management diversity.",
                narration: "Let's explore the diverse excretion strategies that plants have evolved! Unlike animals with dedicated excretory organs, plants have developed multiple creative approaches to waste management. Storage excretion uses vacuoles and specialized cells as permanent waste repositories - like having built-in landfills at the cellular level. Structural excretion incorporates wastes into non-living tissues like bark and heartwood, effectively building with waste materials. Shedding excretion removes entire organs loaded with wastes - not just leaves, but also flowers, fruits, and even branches. Many plants practice transformation excretion, converting metabolic wastes into useful defensive compounds. The caffeine in coffee beans, nicotine in tobacco, and capsaicin in peppers are all waste products repurposed as pesticides! Secretion excretion produces gums, resins, and latex that carry away dissolved wastes while serving protective functions. Some plants combine multiple strategies - a rose bush stores wastes in vacuoles, deposits them in bark, sheds leaves seasonally, and secretes protective oils. This diversity reflects the challenge of being stationary organisms that can't simply excrete and move away like animals!"
            },
            comparison: {
                title: "Animal vs Plant Excretion Systems",
                subtitle: "Fundamental differences in waste management",
                icon: "⚖️",
                modelUrl: "https://sketchfab.com/models/30319ce9c5a441bdb6feeb9926c15284/embed?autostart=1&internal=1&tracking=0&ui_ar=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "The excretion strategies of animals and plants reflect their fundamental biological differences. Animals actively eliminate wastes through specialized organs, while plants primarily store or structurally incorporate wastes, creating fascinating contrasts in approach.",
                concepts: [
                    "Active vs passive: animals pump out wastes, plants store them",
                    "Specialized organs vs distributed systems",
                    "Immediate removal vs long-term storage",
                    "Energy costs: high in animals, minimal in plants",
                    "Mobility differences drive excretion strategies"
                ],
                funFact: "Animals spend up to 10% of their metabolic energy on excretion, while plants use less than 1% because they rely on storage rather than active transport!",
                objectives: "Compare animal and plant excretion strategies, understand the evolutionary trade-offs, and appreciate how lifestyle influences waste management.",
                narration: "Let's compare the fascinating differences between animal and plant excretion systems! Animals have evolved active excretion - they use energy-intensive organs like kidneys to continuously filter and remove wastes from their bodies. This allows for precise control and immediate waste removal, essential for mobile creatures that encounter varying environments. Animals can't afford to accumulate toxic wastes because they need all their tissues functioning optimally for movement and rapid responses. Plants, being stationary, have taken the opposite approach - passive excretion through storage and structural incorporation. They've evolved to tolerate waste accumulation by safely sequestering compounds in vacuoles, dead tissues, and specialized storage cells. This strategy requires minimal energy but limits the plant's ability to quickly respond to changing conditions. The trade-offs are clear: animals pay high energy costs for precise waste control and metabolic flexibility, while plants sacrifice some physiological responsiveness for energy efficiency. Interestingly, some waste products serve dual purposes in plants - the same compounds that are metabolic wastes also function as pesticides, structural materials, or attractants. It's like having a waste management system that also serves as security, construction, and marketing departments!"
            },
            evolution: {
                title: "Evolution of Excretion Systems",
                subtitle: "How waste management shaped life",
                icon: "🔄",
                modelUrl: "https://sketchfab.com/models/aa926551c9184f37afdca7b07e1f6421/embed?autostart=1&internal=1&tracking=0&ui_ar=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "The evolution of excretion systems reveals fundamental constraints and opportunities that shaped life on Earth. From simple diffusion to complex regulatory organs, excretion strategies reflect the evolutionary pressures faced by different life forms.",
                concepts: [
                    "Simple organisms: diffusion and passive loss",
                    "Complex animals: specialized excretory organs",
                    "Terrestrial adaptation: water conservation strategies",
                    "Plant immobility: storage-based solutions",
                    "Metabolic complexity drives excretion innovation"
                ],
                funFact: "The evolution of efficient excretion systems was crucial for the colonization of land - early terrestrial animals needed new ways to conserve water while removing wastes!",
                objectives: "Understand excretion system evolution, connect environmental pressures to excretion strategies, and appreciate excretion's role in evolutionary success.",
                narration: "Explore how excretion systems have driven the evolution of life on Earth! Early single-celled organisms relied on simple diffusion - wastes just leaked out across cell membranes. As organisms became larger and more complex, this simple approach became inadequate. The evolution of specialized excretory organs like kidneys represented a major evolutionary breakthrough, allowing animals to maintain precise internal environments while growing larger and more active. The transition from water to land created new challenges - terrestrial organisms needed to conserve precious water while still removing toxic wastes. This drove the evolution of increasingly sophisticated concentration mechanisms, like the mammalian kidney's ability to produce highly concentrated urine. Plants faced different evolutionary pressures - being immobile, they couldn't move away from their wastes, leading to storage-based solutions and the evolution of cellular compartmentalization. Interestingly, many plant waste compounds evolved secondary functions as defenses, creating evolutionary advantages from what started as metabolic byproducts. The diversity of excretion strategies we see today reflects millions of years of evolutionary experimentation with the fundamental challenge of waste management. Every major evolutionary transition - from water to land, from simple to complex, from plant to animal - has been accompanied by innovations in excretion!"
            }
        };

        // Global Variables
        let currentStep = 'regulation';
        let voiceEnabled = true;
        let autoPlayEnabled = false;
        let currentSpeech = null;
        let selectedVoice = null;
        let journeyProgress = 0;
        let guidedTourActive = false;

        // Initialize Voice System
        function initVoiceSystem() {
            if (!('speechSynthesis' in window)) {
                console.warn('Speech synthesis not supported');
                voiceEnabled = false;
                document.getElementById('voiceToggle').style.display = 'none';
                return;
            }

            function loadVoices() {
                const voices = speechSynthesis.getVoices();
                if (voices.length === 0) return;

                const preferredVoices = [
                    'Google UK English Female',
                    'Microsoft Sonia',
                    'Microsoft Hazel',
                    'Samantha',
                    'Victoria'
                ];

                for (const name of preferredVoices) {
                    selectedVoice = voices.find(v => v.name.includes(name));
                    if (selectedVoice) break;
                }

                if (!selectedVoice) {
                    selectedVoice = voices.find(v => v.lang.startsWith('en'));
                }
            }

            loadVoices();
            if (speechSynthesis.onvoiceschanged !== undefined) {
                speechSynthesis.onvoiceschanged = loadVoices;
            }
        }

        // Load Journey Step
        function loadJourneyStep(stepId) {
            const stepData = JOURNEY_DATA[stepId];
            if (!stepData) return;

            currentStep = stepId;
            
            // Update model
            document.getElementById('api-frame').src = stepData.modelUrl;
            
            // Update info panel
            document.getElementById('stepIcon').textContent = stepData.icon;
            document.getElementById('stepTitle').textContent = stepData.title;
            document.getElementById('stepSubtitle').textContent = stepData.subtitle;
            document.getElementById('mainDescription').textContent = stepData.description;
            
            // Update key concepts
            const conceptsList = document.getElementById('keyConcepts');
            conceptsList.innerHTML = stepData.concepts.map(c => `<li>${c}</li>`).join('');
            
            // Update fun fact
            document.getElementById('funFact').textContent = stepData.funFact;
            
            // Update learning objectives
            document.getElementById('learningObjectives').textContent = stepData.objectives;
            
            // Add comparison box if present
            const existingComparison = document.querySelector('.comparison-box');
            if (existingComparison) existingComparison.remove();
            
            if (stepData.comparison) {
                const comparisonBox = document.createElement('div');
                comparisonBox.className = 'comparison-box';
                comparisonBox.innerHTML = `
                    <div class="comparison-title">Key Comparison</div>
                    <div class="comparison-text">${stepData.comparison}</div>
                `;
                document.querySelector('.fun-fact').parentNode.insertBefore(comparisonBox, document.querySelector('.fun-fact').nextSibling);
            }
            
            // Update navigation buttons
            updateNavigationButtons(stepId);
            
            // Update progress
            updateProgress();
            
            // Play narration if enabled
            if (voiceEnabled) {
                speakText(stepData.narration);
            }
        }

        // Update Navigation Buttons
        function updateNavigationButtons(activeStep) {
            const buttons = document.querySelectorAll('.journey-btn');
            const steps = ['regulation', 'plantcell', 'bark', 'leaves', 'strategies', 'comparison', 'evolution'];
            const activeIndex = steps.indexOf(activeStep);
            
            buttons.forEach((btn, index) => {
                btn.classList.remove('active', 'completed');
                if (index < activeIndex) {
                    btn.classList.add('completed');
                } else if (index === activeIndex) {
                    btn.classList.add('active');
                }
            });
            
            // Update mini steps
            const miniSteps = document.querySelectorAll('.step-mini');
            miniSteps.forEach((step, index) => {
                step.classList.remove('active', 'completed');
                if (index < activeIndex) {
                    step.classList.add('completed');
                } else if (index === activeIndex) {
                    step.classList.add('active');
                }
            });
        }

        // Update Progress
        function updateProgress() {
            const steps = ['regulation', 'plantcell', 'bark', 'leaves', 'strategies', 'comparison', 'evolution'];
            const currentIndex = steps.indexOf(currentStep);
            const progress = ((currentIndex + 1) / steps.length) * 100;
            
            document.getElementById('progressPercent').textContent = Math.round(progress) + '%';
            document.getElementById('progressFill').style.width = progress + '%';
        }

        // Speech Functions
        function speakText(text) {
            if (!voiceEnabled || !text) return;
            
            stopSpeech();
            
            currentSpeech = new SpeechSynthesisUtterance(text);
            if (selectedVoice) {
                currentSpeech.voice = selectedVoice;
            }
            currentSpeech.rate = 0.9;
            currentSpeech.pitch = 1.0;
            currentSpeech.volume = 0.9;
            
            currentSpeech.onstart = () => {
                document.getElementById('voiceIndicator').classList.add('visible');
                document.getElementById('narrationText').textContent = 
                    text.substring(0, 50) + (text.length > 50 ? '...' : '');
            };
            
            currentSpeech.onend = () => {
                document.getElementById('voiceIndicator').classList.remove('visible');
                currentSpeech = null;
                
                if (guidedTourActive) {
                    setTimeout(nextStep, 2000);
                }
            };
            
            speechSynthesis.speak(currentSpeech);
        }

        function stopSpeech() {
            if (currentSpeech) {
                speechSynthesis.cancel();
                currentSpeech = null;
                document.getElementById('voiceIndicator').classList.remove('visible');
            }
        }

        // Control Functions
        function toggleVoice() {
            voiceEnabled = !voiceEnabled;
            const btn = document.getElementById('voiceToggle');
            btn.textContent = voiceEnabled ? '🔊' : '🔇';
            btn.classList.toggle('active', voiceEnabled);
            
            if (!voiceEnabled) {
                stopSpeech();
            }
        }

        function toggleAutoPlay() {
            autoPlayEnabled = !autoPlayEnabled;
            if (autoPlayEnabled) {
                startGuidedTour();
            } else {
                guidedTourActive = false;
            }
        }

        function toggleInfo() {
            const panel = document.getElementById('infoPanel');
            panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
        }

        // Guided Tour
        function startGuidedTour() {
            guidedTourActive = true;
            const steps = ['regulation', 'plantcell', 'bark', 'leaves', 'strategies', 'comparison', 'evolution'];
            let stepIndex = 0;
            
            function tourStep() {
                if (stepIndex < steps.length && guidedTourActive) {
                    loadJourneyStep(steps[stepIndex]);
                    stepIndex++;
                } else {
                    guidedTourActive = false;
                    if (voiceEnabled) {
                        speakText("Congratulations! You've completed your journey through excretion regulation and plant excretion systems. You now understand the fascinating diversity of waste management strategies across life forms!");
                    }
                }
            }
            
            tourStep();
            window.nextStep = tourStep;
        }

        // Quiz Function
        function showQuiz() {
            const questions = [
                "How do hormones regulate urine concentration?",
                "What role does the vacuole play in plant excretion?",
                "How does bark formation remove plant wastes?",
                "Why do plants shed their leaves annually?",
                "What are the main differences between animal and plant excretion?"
            ];
            
            const randomQ = questions[Math.floor(Math.random() * questions.length)];
            
            if (voiceEnabled) {
                speakText(`Here's a question to test your knowledge: ${randomQ} Think about what you've learned about excretion systems!`);
            }
        }

        // Initialize
        function init() {
            initVoiceSystem();
            
            // Hide loading screen
            setTimeout(() => {
                const loading = document.getElementById('loadingOverlay');
                loading.style.opacity = '0';
                setTimeout(() => {
                    loading.style.display = 'none';
                    
                    // Welcome message
                    if (voiceEnabled) {
                        speakText("Welcome to your journey through excretion regulation and plant excretion systems! We'll explore how animals precisely control waste removal and how plants have evolved completely different strategies. Let's start with urine concentration regulation!");
                    }
                }, 1000);
            }, 3000);
            
            // Keyboard shortcuts
            document.addEventListener('keydown', (e) => {
                switch(e.key) {
                    case 'v': toggleVoice(); break;
                    case 'i': toggleInfo(); break;
                    case 'g': startGuidedTour(); break;
                    case 'Escape': stopSpeech(); guidedTourActive = false; break;
                    case 'ArrowRight': nextStep && nextStep(); break;
                }
            });
        }

        // Start the application
        init();
    </script>
</body>
</html>