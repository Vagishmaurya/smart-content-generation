<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nutrient Management and Soil Care - Complete Soil Science Journey</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tween.js/18.6.4/tween.umd.js"></script>

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #3E2723 0%, #5D4037 50%, #8D6E63 100%);
            color: white;
            overflow: hidden;
            position: relative;
            height: 100vh;
        }

        /* Animated Background */
        .bg-animation {
            position: fixed;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: 0;
            opacity: 0.1;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 320"><path fill="%23ffffff" fill-opacity="0.2" d="M0,192L48,208C96,224,192,256,288,250.7C384,245,480,203,576,192C672,181,768,203,864,218.7C960,235,1056,245,1152,229.3C1248,213,1344,171,1392,149.3L1440,128L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z"></path></svg>') repeat-x;
            animation: wave 20s linear infinite;
        }

        @keyframes wave {
            0% { background-position-x: 0; }
            100% { background-position-x: 1440px; }
        }

        /* Museum Interface - Compact Header */
        .museum-header {
            position: absolute;
            top: 10px;
            left: 20px;
            text-align: left;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            padding: 10px 18px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .museum-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 4px;
            background: linear-gradient(45deg, #8D6E63, #4CAF50);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: titleGlow 3s ease-in-out infinite;
        }

        @keyframes titleGlow {
            0%, 100% { filter: brightness(1); }
            50% { filter: brightness(1.2); }
        }

        .exhibit-subtitle {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.8);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .soil-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            background: #8D6E63;
            border-radius: 50%;
            animation: soil-pulse 2s ease-in-out infinite;
        }

        @keyframes soil-pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.3); opacity: 0.7; }
        }

        /* Journey Navigation - Enhanced */
        .journey-navigation {
            position: absolute;
            bottom: 20px;
            left: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            padding: 15px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            max-width: 340px;
        }

        .journey-title {
            font-size: 14px;
            font-weight: 600;
            color: #8D6E63;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .journey-steps {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }

        .journey-btn {
            background: rgba(141, 110, 99, 0.2);
            border: 1px solid rgba(141, 110, 99, 0.4);
            color: white;
            padding: 6px 10px;
            border-radius: 20px;
            font-size: 11px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 4px;
            white-space: nowrap;
        }

        .journey-btn:hover {
            background: rgba(141, 110, 99, 0.3);
            border-color: #8D6E63;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(141, 110, 99, 0.3);
        }

        .journey-btn.active {
            background: linear-gradient(135deg, #FF8F00, #F57C00);
            border-color: #FF8F00;
            box-shadow: 0 0 20px rgba(255, 143, 0, 0.5);
            animation: pulse 2s infinite;
        }

        .journey-btn.completed {
            background: rgba(76, 175, 80, 0.3);
            border-color: #4CAF50;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        /* 3D Model Container */
        .model-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 0;
            overflow: hidden;
            border: none;
            z-index: 100;
        }

        .sketchfab-embed-wrapper {
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #3E2723 0%, #5D4037 50%, #8D6E63 100%);
        }

        .sketchfab-embed-wrapper iframe {
            width: 100%;
            height: 100%;
            border: none;
            border-radius: 0;
        }

        /* Information Panel - Enhanced */
        .info-panel {
            position: absolute;
            top: 70px;
            right: 20px;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(25px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 16px;
            padding: 24px;
            width: 380px;
            max-height: calc(100vh - 140px);
            z-index: 800;
            overflow-y: auto;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }

        .info-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        }

        .info-icon {
            font-size: 28px;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        .info-title {
            flex: 1;
        }

        .info-title h2 {
            font-size: 18px;
            color: #8D6E63;
            margin-bottom: 4px;
        }

        .info-subtitle {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.7);
        }

        .info-content {
            color: rgba(255, 255, 255, 0.9);
            font-size: 14px;
            line-height: 1.6;
        }

        /* Progress Tracker */
        .progress-tracker {
            background: linear-gradient(135deg, rgba(141, 110, 99, 0.1), rgba(76, 175, 80, 0.1));
            border: 1px solid rgba(141, 110, 99, 0.3);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 20px;
        }

        .progress-header {
            font-size: 13px;
            font-weight: 600;
            color: #8D6E63;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .progress-percentage {
            font-size: 18px;
            color: #FF8F00;
            font-weight: 700;
        }

        .progress-bar {
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 12px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #8D6E63, #FF8F00);
            border-radius: 4px;
            transition: width 0.8s ease;
            box-shadow: 0 0 10px rgba(255, 143, 0, 0.5);
        }

        .progress-steps-mini {
            display: flex;
            justify-content: space-between;
            font-size: 10px;
            color: rgba(255, 255, 255, 0.6);
        }

        .step-mini {
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .step-mini.active {
            color: #FF8F00;
            font-weight: 600;
        }

        .step-mini.completed {
            color: #4CAF50;
        }

        /* Information Cards */
        .info-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 14px;
            margin-bottom: 14px;
        }

        .info-card-title {
            color: #8D6E63;
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .info-card-content {
            color: rgba(255, 255, 255, 0.85);
            font-size: 12px;
            line-height: 1.5;
        }

        .info-list {
            list-style: none;
            padding: 0;
        }

        .info-list li {
            padding: 6px 0;
            padding-left: 20px;
            position: relative;
            font-size: 12px;
            color: rgba(255, 255, 255, 0.8);
        }

        .info-list li:before {
            content: "🌱";
            position: absolute;
            left: 0;
            color: #8D6E63;
        }

        /* Fun Fact Box */
        .fun-fact {
            background: linear-gradient(135deg, rgba(255, 143, 0, 0.1), rgba(141, 110, 99, 0.1));
            border: 1px solid rgba(255, 143, 0, 0.3);
            border-radius: 12px;
            padding: 14px;
            margin: 16px 0;
            position: relative;
            overflow: hidden;
        }

        .fun-fact:before {
            content: "🌍";
            position: absolute;
            top: -20px;
            right: -20px;
            font-size: 60px;
            opacity: 0.1;
        }

        .fun-fact-title {
            color: #FF8F00;
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 6px;
        }

        .fun-fact-text {
            color: rgba(255, 255, 255, 0.9);
            font-size: 12px;
            line-height: 1.5;
            position: relative;
            z-index: 1;
        }

        /* Voice Controls */
        .voice-controls {
            position: absolute;
            top: 10px;
            right: 20px;
            display: flex;
            gap: 8px;
            z-index: 1000;
        }

        .control-btn {
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            width: 44px;
            height: 44px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            position: relative;
        }

        .control-btn:hover {
            background: rgba(141, 110, 99, 0.3);
            border-color: #8D6E63;
            transform: scale(1.1);
        }

        .control-btn.active {
            background: rgba(141, 110, 99, 0.4);
            border-color: #8D6E63;
            box-shadow: 0 0 20px rgba(141, 110, 99, 0.5);
        }

        .control-tooltip {
            position: absolute;
            bottom: -30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9);
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 10px;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .control-btn:hover .control-tooltip {
            opacity: 1;
        }

        /* Loading Screen */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #3E2723 0%, #5D4037 50%, #8D6E63 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            transition: opacity 1s ease;
        }

        .loading-content {
            text-align: center;
        }

        .loading-heart {
            font-size: 60px;
            animation: soil-pulse 1.5s ease-in-out infinite;
            margin-bottom: 20px;
        }

        .loading-text {
            color: white;
            font-size: 20px;
            margin-bottom: 20px;
        }

        .loading-progress {
            width: 200px;
            height: 4px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 2px;
            overflow: hidden;
        }

        .loading-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #8D6E63, #FF8F00);
            animation: loading 2s ease-in-out infinite;
        }

        @keyframes loading {
            0% { width: 0%; }
            50% { width: 100%; }
            100% { width: 0%; }
        }

        /* Voice Indicator */
        .voice-indicator {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(141, 110, 99, 0.5);
            border-radius: 30px;
            padding: 14px 28px;
            display: flex;
            align-items: center;
            gap: 12px;
            z-index: 1000;
            opacity: 0;
            transition: all 0.3s ease;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }

        .voice-indicator.visible {
            opacity: 1;
            transform: translateX(-50%) translateY(-10px);
        }

        .voice-waves {
            display: flex;
            align-items: center;
            gap: 3px;
        }

        .voice-wave {
            width: 3px;
            height: 20px;
            background: linear-gradient(180deg, #8D6E63, #FF8F00);
            border-radius: 2px;
            animation: voice-wave 1s ease-in-out infinite;
        }

        .voice-wave:nth-child(2) { animation-delay: 0.1s; }
        .voice-wave:nth-child(3) { animation-delay: 0.2s; }
        .voice-wave:nth-child(4) { animation-delay: 0.3s; }
        .voice-wave:nth-child(5) { animation-delay: 0.4s; }

        @keyframes voice-wave {
            0%, 100% { transform: scaleY(0.3); }
            50% { transform: scaleY(1); }
        }

        .narration-text {
            color: white;
            font-size: 13px;
            max-width: 300px;
        }

        /* Quick Actions */
        .quick-actions {
            position: absolute;
            bottom: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            z-index: 1000;
        }

        .action-btn {
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 10px 16px;
            border-radius: 25px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
        }

        .action-btn:hover {
            background: rgba(141, 110, 99, 0.3);
            border-color: #8D6E63;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(141, 110, 99, 0.3);
        }

        /* Custom Scrollbar */
        .info-panel::-webkit-scrollbar {
            width: 6px;
        }

        .info-panel::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 3px;
        }

        .info-panel::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, #8D6E63, #FF8F00);
            border-radius: 3px;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .info-panel {
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                top: auto;
                width: 100%;
                max-height: 50vh;
                border-radius: 20px 20px 0 0;
            }
            
            .journey-navigation {
                bottom: 52vh;
                max-width: calc(100% - 40px);
            }
            
            .voice-controls {
                top: auto;
                bottom: 55vh;
                right: 10px;
            }
            
            .quick-actions {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="bg-animation"></div>

    <!-- Loading Screen -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-content">
            <div class="loading-heart">🌍</div>
            <div class="loading-text">Preparing Your Soil Science Journey...</div>
            <div class="loading-progress">
                <div class="loading-progress-bar"></div>
            </div>
        </div>
    </div>

    <!-- Museum Header -->
    <div class="museum-header">
        <div class="museum-title">Nutrient Management and Soil Care</div>
        <div class="exhibit-subtitle">
            <span class="soil-indicator"></span>
            Foundation of Sustainable Agriculture
        </div>
    </div>

    <!-- Journey Navigation -->
    <div class="journey-navigation">
        <div class="journey-title">
            <span>🗺️</span>
            <span>Soil Science Journey</span>
        </div>
        <div class="journey-steps">
            <button class="journey-btn active" onclick="loadJourneyStep('nutrients')">
                <span>⚗️</span> Nutrients
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('soilhealth')">
                <span>🌍</span> Soil
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('compost')">
                <span>♻️</span> Compost
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('vermicompost')">
                <span>🪱</span> Worms
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('greenmanure')">
                <span>🌿</span> Green
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('fertilizers')">
                <span>🧪</span> Fertilizers
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('organic')">
                <span>🌱</span> Organic
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('seasonal')">
                <span>📅</span> Seasonal
            </button>
        </div>
    </div>

    <!-- 3D Model Container -->
    <div class="model-container">
        <div class="sketchfab-embed-wrapper">
            <iframe id="api-frame"
                    title="Soil Science Model" 
                    frameborder="0" 
                    allowfullscreen 
                    mozallowfullscreen="true" 
                    webkitallowfullscreen="true" 
                    allow="autoplay; fullscreen; xr-spatial-tracking"
                    xr-spatial-tracking 
                    execution-while-out-of-viewport 
                    execution-while-not-rendered 
                    web-share 
                    src="https://sketchfab.com/models/87bde8f2a0854d2c8e82447e7318438a/embed?autostart=1&internal=1&tracking=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0">
            </iframe>
        </div>
    </div>

    <!-- Information Panel -->
    <div class="info-panel" id="infoPanel">
        <div class="info-header">
            <div class="info-icon" id="stepIcon">⚗️</div>
            <div class="info-title">
                <h2 id="stepTitle">Plant Nutrients - Essential Elements</h2>
                <div class="info-subtitle" id="stepSubtitle">Macro and micro nutrient requirements</div>
            </div>
        </div>

        <!-- Progress Tracker -->
        <div class="progress-tracker">
            <div class="progress-header">
                <span>Soil Science Progress</span>
                <span class="progress-percentage" id="progressPercent">0%</span>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 0%"></div>
            </div>
            <div class="progress-steps-mini">
                <span class="step-mini active" onclick="loadJourneyStep('nutrients')">Nut</span>
                <span class="step-mini" onclick="loadJourneyStep('soilhealth')">Soi</span>
                <span class="step-mini" onclick="loadJourneyStep('compost')">Com</span>
                <span class="step-mini" onclick="loadJourneyStep('vermicompost')">Wor</span>
                <span class="step-mini" onclick="loadJourneyStep('greenmanure')">Gre</span>
                <span class="step-mini" onclick="loadJourneyStep('fertilizers')">Fer</span>
                <span class="step-mini" onclick="loadJourneyStep('organic')">Org</span>
                <span class="step-mini" onclick="loadJourneyStep('seasonal')">Sea</span>
            </div>
        </div>

        <div class="info-content" id="mainDescription">
            Plants need 17 essential nutrients to grow properly. Just like humans need vitamins and minerals, plants require specific elements in the right amounts. This organic compost waste represents a natural source of these nutrients, slowly releasing them as it decomposes to feed plants throughout their growing season.
        </div>

        <div class="info-card">
            <div class="info-card-title">
                <span>⚗️</span> Key Concepts
            </div>
            <div class="info-card-content">
                <ul class="info-list" id="keyConcepts">
                    <li>Macronutrients: N, P, K needed in large amounts</li>
                    <li>Secondary: Calcium, magnesium, sulfur</li>
                    <li>Micronutrients: Iron, zinc, boron in tiny amounts</li>
                    <li>Liebig's Law: Growth limited by scarcest nutrient</li>
                </ul>
            </div>
        </div>

        <div class="fun-fact">
            <div class="fun-fact-title">Soil Science Fact!</div>
            <div class="fun-fact-text" id="funFact">
                A single teaspoon of healthy soil contains more microorganisms than there are people on Earth - about 1 billion bacteria!
            </div>
        </div>

        <div class="info-card">
            <div class="info-card-title">
                <span>🎯</span> Learning Objectives
            </div>
            <div class="info-card-content" id="learningObjectives">
                Understanding plant nutrient requirements and how different sources provide these essential elements for healthy crop growth.
            </div>
        </div>
    </div>

    <!-- Voice Controls -->
    <div class="voice-controls">
        <button class="control-btn active" id="voiceToggle" onclick="toggleVoice()">
            🔊
            <span class="control-tooltip">Voice Narration</span>
        </button>
        <button class="control-btn" onclick="toggleAutoPlay()">
            ▶️
            <span class="control-tooltip">Auto Journey</span>
        </button>
        <button class="control-btn" onclick="toggleInfo()">
            ℹ️
            <span class="control-tooltip">Toggle Info</span>
        </button>
    </div>

    <!-- Quick Actions -->
    <div class="quick-actions">
        <button class="action-btn" onclick="startGuidedTour()">
            <span>🚀</span> Guided Tour
        </button>
        <button class="action-btn" onclick="showQuiz()">
            <span>🎯</span> Test Knowledge
        </button>
    </div>

    <!-- Voice Indicator -->
    <div class="voice-indicator" id="voiceIndicator">
        <div class="voice-waves">
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
        </div>
        <div class="narration-text" id="narrationText">Narrating...</div>
    </div>

    <script>
        // Journey Step Data with Complete Soil Science Content
        const JOURNEY_DATA = {
            nutrients: {
                title: "Plant Nutrients - Essential Elements",
                subtitle: "Macro and micro nutrient requirements",
                icon: "⚗️",
                modelUrl: "https://sketchfab.com/models/87bde8f2a0854d2c8e82447e7318438a/embed?autostart=1&internal=1&tracking=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "Plants need 17 essential nutrients to grow properly. Just like humans need vitamins and minerals, plants require specific elements in the right amounts. This organic compost waste represents a natural source of these nutrients, slowly releasing them as it decomposes to feed plants throughout their growing season.",
                concepts: [
                    "Macronutrients: N, P, K needed in large amounts",
                    "Secondary: Calcium, magnesium, sulfur",
                    "Micronutrients: Iron, zinc, boron in tiny amounts",
                    "Liebig's Law: Growth limited by scarcest nutrient"
                ],
                funFact: "A single teaspoon of healthy soil contains more microorganisms than there are people on Earth - about 1 billion bacteria!",
                objectives: "Understanding plant nutrient requirements and how different sources provide these essential elements for healthy crop growth.",
                narration: "Welcome to the fascinating world of plant nutrition! You're looking at organic compost waste - nature's perfect nutrient factory. Plants need 17 essential nutrients to grow, just like humans need vitamins and minerals in their diet. The three most important are the macronutrients: nitrogen for green growth, phosphorus for roots and flowers, and potassium for overall plant health - remember N-P-K! Then there are secondary nutrients like calcium for cell walls, magnesium for chlorophyll, and sulfur for proteins. Plants also need tiny amounts of micronutrients like iron for green leaves, zinc for enzymes, and boron for cell development. This compost provides all these nutrients naturally as it slowly decomposes. According to Liebig's Law of the Minimum, plant growth is limited by whichever nutrient is most scarce - it's like a chain that's only as strong as its weakest link. Understanding these nutrient needs is the first step in feeding plants properly for maximum growth and productivity."
            },
            soilhealth: {
                title: "Soil Health - Living Foundation",
                subtitle: "The ecosystem beneath our feet",
                icon: "🌍",
                modelUrl: "https://sketchfab.com/models/87bde8f2a0854d2c8e82447e7318438a/embed?autostart=1&internal=1&tracking=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "Healthy soil is not just dirt - it's a living ecosystem teeming with billions of microorganisms. This compost material shows how organic matter transforms into the foundation of soil fertility, providing nutrients, improving structure, and supporting the complex web of soil life.",
                concepts: [
                    "Soil contains 25% air, 25% water, 45% minerals, 5% organic matter",
                    "Billions of microorganisms in every gram",
                    "Soil structure affects water and air movement",
                    "pH affects nutrient availability"
                ],
                funFact: "It takes 500-1000 years to form just one inch of topsoil naturally, but it can be lost in a few years through erosion!",
                objectives: "Learn about soil as a living system and understand the factors that determine soil health and fertility.",
                narration: "Soil is much more than just dirt - it's one of the most complex ecosystems on Earth! Healthy soil is about 25% air, 25% water, 45% mineral particles, and 5% organic matter. But that small 5% of organic matter, like this compost, makes all the difference! Soil is alive with billions of bacteria, fungi, protozoa, nematodes, and other microorganisms in every gram. These tiny creatures break down organic matter, cycle nutrients, and create soil structure. Soil structure is crucial - it determines how water infiltrates, how air moves through the soil, and how easily roots can penetrate. Soil pH is also critical because it affects which nutrients plants can actually absorb. Even if nutrients are present, plants can't use them if the pH is wrong. It takes 500 to 1000 years for nature to create just one inch of topsoil, yet we can lose it in just a few years through poor farming practices. That's why protecting and improving soil health is so important for sustainable agriculture and food security."
            },
            compost: {
                title: "Composting - Nature's Recycling",
                subtitle: "Transforming waste into black gold",
                icon: "♻️",
                modelUrl: "https://sketchfab.com/models/87bde8f2a0854d2c8e82447e7318438a/embed?autostart=1&internal=1&tracking=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "Composting is nature's way of recycling organic matter. This pile of organic waste demonstrates the decomposition process where microorganisms break down kitchen scraps, yard waste, and crop residues into nutrient-rich humus that plants love.",
                concepts: [
                    "Requires carbon-rich browns and nitrogen-rich greens",
                    "Microorganisms break down organic matter",
                    "Proper moisture and aeration needed",
                    "Finished compost improves soil structure and fertility"
                ],
                funFact: "Compost can reduce the need for chemical fertilizers by 50% while improving soil health and water retention!",
                objectives: "Understanding the composting process and how to create nutrient-rich organic matter for soil improvement.",
                narration: "This organic waste represents the beginning of one of nature's most important processes - composting! Composting is like cooking for the soil - you need the right ingredients, proper conditions, and time. The recipe calls for carbon-rich 'browns' like dry leaves, straw, and paper, mixed with nitrogen-rich 'greens' like food scraps, grass clippings, and manure. The ideal ratio is about 30:1 carbon to nitrogen. Add water to keep it moist like a wrung-out sponge, and turn it regularly for aeration. Billions of microorganisms go to work, heating the pile to 140-160°F as they decompose the organic matter. This heat kills weed seeds and harmful pathogens. Over 3-6 months, these materials transform into dark, crumbly, earthy-smelling humus - gardener's black gold! Finished compost provides slow-release nutrients, improves soil structure, increases water retention, and feeds beneficial soil organisms. It can reduce the need for chemical fertilizers by 50% while building long-term soil health. Composting also reduces waste going to landfills where it would produce methane, a greenhouse gas."
            },
            vermicompost: {
                title: "Vermicomposting - Worm Power",
                subtitle: "Earthworms as soil engineers",
                icon: "🪱",
                modelUrl: "https://sketchfab.com/models/79d7f1ea7ec04413807abb792964c809/embed?autostart=1&internal=1&tracking=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "Earthworms are nature's ultimate soil engineers. This earthworm represents millions of these creatures that eat organic matter and produce vermicompost - worm castings that are incredibly rich in nutrients and beneficial microorganisms.",
                concepts: [
                    "Red wigglers are best for composting",
                    "Worms eat their body weight daily in organic matter",
                    "Castings contain 5x more nutrients than regular compost",
                    "Worms improve soil aeration and drainage"
                ],
                funFact: "Earthworms can process their own body weight in organic matter every single day, producing nutrient-rich castings!",
                objectives: "Learn how earthworms create superior compost and improve soil structure through their natural activities.",
                narration: "Meet the earthworm - one of agriculture's most valuable workers! This amazing creature is a living soil factory. Earthworms eat organic matter - everything from food scraps to dead leaves - and their digestive process transforms it into vermicompost, also called worm castings. These castings are incredibly valuable, containing 5 times more nitrogen, 7 times more phosphorus, and 11 times more potassium than regular compost! Red wigglers are the champions of composting - they can eat their own body weight in organic matter every single day. As they move through the soil, earthworms create tunnels that improve aeration and drainage. Their castings are perfectly pH-balanced and contain beneficial microorganisms that help plants resist diseases. Vermicomposting can be done indoors in bins, making it perfect for urban areas. The process is odorless when done correctly and produces both solid castings and liquid worm tea - both excellent fertilizers. Charles Darwin called earthworms 'nature's plows' because of their crucial role in soil formation. Without earthworms, our soils would be much less fertile and productive."
            },
            greenmanure: {
                title: "Green Manure - Living Fertilizer",
                subtitle: "Crops grown to feed the soil",
                icon: "🌿",
                modelUrl: "https://sketchfab.com/models/87bde8f2a0854d2c8e82447e7318438a/embed?autostart=1&internal=1&tracking=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "Green manure crops are plants grown specifically to be plowed back into the soil while still green. These living fertilizers add organic matter, fix nitrogen, prevent erosion, and break pest cycles naturally.",
                concepts: [
                    "Legumes like clover fix nitrogen from air",
                    "Deep-rooted crops bring up buried nutrients",
                    "Prevents soil erosion and suppresses weeds",
                    "Increases soil organic matter when incorporated"
                ],
                funFact: "A single acre of crimson clover can fix 100-200 pounds of nitrogen from the air - equivalent to several bags of chemical fertilizer!",
                objectives: "Understanding how cover crops and green manures naturally improve soil fertility and structure.",
                narration: "Green manure represents one of agriculture's cleverest strategies - growing crops not to harvest, but to feed the soil! These are crops planted specifically to be turned back into the soil while still green and growing. Different green manure crops provide different benefits. Legumes like clover, alfalfa, and cowpeas have special bacteria in their roots that capture nitrogen from the air and convert it into a form plants can use - this process is called nitrogen fixation. A single acre of crimson clover can add 100-200 pounds of nitrogen to the soil! Deep-rooted crops like radishes act like living plows, breaking up compacted soil and bringing buried nutrients to the surface. Grasses like rye improve soil structure with their fibrous roots. Green manures also prevent soil erosion, suppress weeds, and break pest and disease cycles. When the crop is plowed under, all that organic matter decomposes, adding humus and feeding soil organisms. This practice has been used for thousands of years - Roman farmers wrote about it 2000 years ago! It's nature's way of keeping soil fertile without external inputs."
            },
            fertilizers: {
                title: "Fertilizers - Concentrated Nutrition",
                subtitle: "Chemical nutrients for rapid growth",
                icon: "🧪",
                modelUrl: "https://sketchfab.com/models/87bde8f2a0854d2c8e82447e7318438a/embed?autostart=1&internal=1&tracking=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "Chemical fertilizers provide concentrated, immediately available nutrients to plants. While organic matter like this compost feeds the soil ecosystem, fertilizers deliver specific nutrients directly to plant roots for rapid growth and high yields.",
                concepts: [
                    "NPK numbers show nitrogen, phosphorus, potassium percentages",
                    "Immediately available to plants",
                    "Must be applied in correct amounts and timing",
                    "Can cause environmental problems if overused"
                ],
                funFact: "The Haber-Bosch process for making nitrogen fertilizer feeds about 3 billion people worldwide but uses 1-2% of global energy!",
                objectives: "Learn about chemical fertilizers, their proper use, and their role in modern high-yield agriculture.",
                narration: "Chemical fertilizers are agriculture's power tools - they provide concentrated, immediately available nutrition for rapid plant growth! Unlike organic matter that feeds the soil ecosystem slowly, fertilizers deliver nutrients directly to plant roots. The three numbers on fertilizer bags show the NPK ratio - nitrogen for leafy growth, phosphorus for roots and flowering, and potassium for overall plant health and disease resistance. Nitrogen fertilizers are made through the Haber-Bosch process, which captures nitrogen from the air and combines it with hydrogen at high temperature and pressure. This process feeds about 3 billion people worldwide but uses 1-2% of all global energy! Phosphorus comes from mined rock phosphate, while potassium comes from underground salt deposits. Fertilizers work fast because nutrients are in forms plants can immediately absorb. However, timing and amount are crucial - too much can burn plants or leach into groundwater, while too little limits growth. The challenge is using fertilizers efficiently to maximize crop yields while minimizing environmental impact. Modern precision agriculture uses soil testing, GPS guidance, and variable-rate application to put exactly the right amount of fertilizer in the right place at the right time."
            },
            organic: {
                title: "Organic Farming - Natural Harmony",
                subtitle: "Sustainable agriculture practices",
                icon: "🌱",
                modelUrl: "https://sketchfab.com/models/87bde8f2a0854d2c8e82447e7318438a/embed?autostart=1&internal=1&tracking=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "Organic farming works with natural processes to maintain soil health and crop productivity. This compost represents the foundation of organic systems - building soil biology and fertility through natural materials rather than synthetic inputs.",
                concepts: [
                    "No synthetic pesticides or fertilizers allowed",
                    "Relies on compost, crop rotation, biological control",
                    "Emphasizes soil health and biodiversity",
                    "May have lower yields but better sustainability"
                ],
                funFact: "Organic soils can store 25% more carbon than conventional soils, helping fight climate change through carbon sequestration!",
                objectives: "Understanding organic farming principles and how they create sustainable agricultural systems.",
                narration: "Organic farming is agriculture in harmony with nature! This system relies on natural processes rather than synthetic inputs to maintain soil fertility and control pests. Organic farmers use compost, green manures, and animal manures instead of chemical fertilizers. They practice crop rotation to break pest cycles and maintain soil nutrients. Instead of pesticides, they use beneficial insects, companion planting, and natural pest deterrents. The foundation of organic farming is healthy soil - organic farmers focus on feeding the soil ecosystem, which then feeds the plants. Organic soils typically contain more organic matter, have better structure, and support more diverse microbial communities. They can store 25% more carbon than conventional soils, helping fight climate change! Organic certification requires following strict standards - no synthetic pesticides, fertilizers, GMOs, or growth hormones. The system emphasizes biodiversity, animal welfare, and environmental protection. While organic yields may be 10-25% lower than conventional farming, organic systems often use less energy and can be more profitable due to premium prices. Organic farming shows that it's possible to produce food while building rather than depleting natural resources."
            },
            seasonal: {
                title: "Seasonal Information - Activity 12.2",
                subtitle: "Crop timing and nutrient planning",
                icon: "📅",
                modelUrl: "https://sketchfab.com/models/87bde8f2a0854d2c8e82447e7318438a/embed?autostart=1&internal=1&tracking=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "Activity 12.2 involves understanding seasonal crop requirements and nutrient management timing. This organic matter decomposes at different rates through the seasons, providing nutrients when crops need them most.",
                concepts: [
                    "Kharif crops need nutrients during monsoon season",
                    "Rabi crops require different fertilization timing",
                    "Soil temperature affects nutrient availability",
                    "Seasonal composting matches nutrient release"
                ],
                funFact: "Soil microorganisms are most active at 68-86°F, so nutrient release from organic matter peaks during warm growing seasons!",
                objectives: "Learn to match nutrient management practices with seasonal crop needs and soil conditions.",
                narration: "Understanding seasonal patterns is crucial for effective nutrient management! Different crops grown in different seasons have varying nutrient needs and timing. Kharif crops like rice and cotton, grown during the monsoon season, need nutrients available when soils are warm and wet. The high temperature and moisture accelerate organic matter decomposition, releasing nutrients just when plants are growing rapidly. Rabi crops like wheat and mustard, grown in cooler months, need nutrients that remain available even when soil biological activity slows down. Soil temperature greatly affects nutrient availability - microorganisms that decompose organic matter are most active between 68-86°F. This is why organic matter releases nutrients faster in summer than winter. Smart farmers time their compost application to match these patterns. Fresh compost applied in spring provides nutrients throughout the growing season, while aged compost applied in fall slowly releases nutrients for winter crops. Activity 12.2 helps students understand these seasonal patterns by observing how different organic materials decompose and release nutrients at different times of year. This knowledge is essential for timing fertilizer applications, planning crop rotations, and maximizing nutrient use efficiency throughout the agricultural calendar."
            }
        };

        // Global Variables
        let currentStep = 'nutrients';
        let voiceEnabled = true;
        let autoPlayEnabled = false;
        let currentSpeech = null;
        let selectedVoice = null;
        let journeyProgress = 0;
        let guidedTourActive = false;

        // Initialize Voice System
        function initVoiceSystem() {
            if (!('speechSynthesis' in window)) {
                console.warn('Speech synthesis not supported');
                voiceEnabled = false;
                document.getElementById('voiceToggle').style.display = 'none';
                return;
            }

            function loadVoices() {
                const voices = speechSynthesis.getVoices();
                if (voices.length === 0) return;

                // Prefer natural-sounding voices
                const preferredVoices = [
                    'Google UK English Female',
                    'Microsoft Sonia',
                    'Microsoft Hazel',
                    'Samantha',
                    'Victoria'
                ];

                for (const name of preferredVoices) {
                    selectedVoice = voices.find(v => v.name.includes(name));
                    if (selectedVoice) break;
                }

                if (!selectedVoice) {
                    selectedVoice = voices.find(v => v.lang.startsWith('en'));
                }
            }

            loadVoices();
            if (speechSynthesis.onvoiceschanged !== undefined) {
                speechSynthesis.onvoiceschanged = loadVoices;
            }
        }

        // Load Journey Step
        function loadJourneyStep(stepId) {
            const stepData = JOURNEY_DATA[stepId];
            if (!stepData) return;

            currentStep = stepId;
            
            // Update model
            document.getElementById('api-frame').src = stepData.modelUrl;
            
            // Update info panel
            document.getElementById('stepIcon').textContent = stepData.icon;
            document.getElementById('stepTitle').textContent = stepData.title;
            document.getElementById('stepSubtitle').textContent = stepData.subtitle;
            document.getElementById('mainDescription').textContent = stepData.description;
            
            // Update key concepts
            const conceptsList = document.getElementById('keyConcepts');
            conceptsList.innerHTML = stepData.concepts.map(c => `<li>${c}</li>`).join('');
            
            // Update fun fact
            document.getElementById('funFact').textContent = stepData.funFact;
            
            // Update learning objectives
            document.getElementById('learningObjectives').textContent = stepData.objectives;
            
            // Update navigation buttons
            updateNavigationButtons(stepId);
            
            // Update progress
            updateProgress();
            
            // Play narration if enabled
            if (voiceEnabled) {
                speakText(stepData.narration);
            }
        }

        // Update Navigation Buttons
        function updateNavigationButtons(activeStep) {
            const buttons = document.querySelectorAll('.journey-btn');
            const steps = ['nutrients', 'soilhealth', 'compost', 'vermicompost', 'greenmanure', 'fertilizers', 'organic', 'seasonal'];
            const activeIndex = steps.indexOf(activeStep);
            
            buttons.forEach((btn, index) => {
                btn.classList.remove('active', 'completed');
                if (index < activeIndex) {
                    btn.classList.add('completed');
                } else if (index === activeIndex) {
                    btn.classList.add('active');
                }
            });
            
            // Update mini steps
            const miniSteps = document.querySelectorAll('.step-mini');
            miniSteps.forEach((step, index) => {
                step.classList.remove('active', 'completed');
                if (index < activeIndex) {
                    step.classList.add('completed');
                } else if (index === activeIndex) {
                    step.classList.add('active');
                }
            });
        }

        // Update Progress
        function updateProgress() {
            const steps = ['nutrients', 'soilhealth', 'compost', 'vermicompost', 'greenmanure', 'fertilizers', 'organic', 'seasonal'];
            const currentIndex = steps.indexOf(currentStep);
            const progress = ((currentIndex + 1) / steps.length) * 100;
            
            document.getElementById('progressPercent').textContent = Math.round(progress) + '%';
            document.getElementById('progressFill').style.width = progress + '%';
        }

        // Speech Functions
        function speakText(text) {
            if (!voiceEnabled || !text) return;
            
            stopSpeech();
            
            currentSpeech = new SpeechSynthesisUtterance(text);
            if (selectedVoice) {
                currentSpeech.voice = selectedVoice;
            }
            currentSpeech.rate = 0.9;
            currentSpeech.pitch = 1.0;
            currentSpeech.volume = 0.9;
            
            currentSpeech.onstart = () => {
                document.getElementById('voiceIndicator').classList.add('visible');
                document.getElementById('narrationText').textContent = 
                    text.substring(0, 50) + (text.length > 50 ? '...' : '');
            };
            
            currentSpeech.onend = () => {
                document.getElementById('voiceIndicator').classList.remove('visible');
                currentSpeech = null;
                
                // Auto-advance if guided tour is active
                if (guidedTourActive) {
                    setTimeout(nextStep, 2000);
                }
            };
            
            speechSynthesis.speak(currentSpeech);
        }

        function stopSpeech() {
            if (currentSpeech) {
                speechSynthesis.cancel();
                currentSpeech = null;
                document.getElementById('voiceIndicator').classList.remove('visible');
            }
        }

        // Control Functions
        function toggleVoice() {
            voiceEnabled = !voiceEnabled;
            const btn = document.getElementById('voiceToggle');
            btn.textContent = voiceEnabled ? '🔊' : '🔇';
            btn.classList.toggle('active', voiceEnabled);
            
            if (!voiceEnabled) {
                stopSpeech();
            }
        }

        function toggleAutoPlay() {
            autoPlayEnabled = !autoPlayEnabled;
            if (autoPlayEnabled) {
                startGuidedTour();
            } else {
                guidedTourActive = false;
            }
        }

        function toggleInfo() {
            const panel = document.getElementById('infoPanel');
            panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
        }

        // Guided Tour
        function startGuidedTour() {
            guidedTourActive = true;
            const steps = ['nutrients', 'soilhealth', 'compost', 'vermicompost', 'greenmanure', 'fertilizers', 'organic', 'seasonal'];
            let stepIndex = 0;
            
            function tourStep() {
                if (stepIndex < steps.length && guidedTourActive) {
                    loadJourneyStep(steps[stepIndex]);
                    stepIndex++;
                } else {
                    guidedTourActive = false;
                    if (voiceEnabled) {
                        speakText("Congratulations! You've completed your journey through nutrient management and soil care. You now understand how plants get their nutrition, the importance of soil health, and various methods of providing nutrients naturally and sustainably. Feel free to explore any section again or test your knowledge!");
                    }
                }
            }
            
            tourStep();
            window.nextStep = tourStep;
        }

        // Quiz Function
        function showQuiz() {
            const questions = [
                "What are the three primary macronutrients plants need?",
                "How do earthworms improve soil health?",
                "What's the difference between compost and vermicompost?",
                "Why is soil pH important for plant nutrition?",
                "How do green manure crops benefit soil fertility?"
            ];
            
            const randomQ = questions[Math.floor(Math.random() * questions.length)];
            
            if (voiceEnabled) {
                speakText(`Here's a question to test your soil science knowledge: ${randomQ} Think about what you've learned about plant nutrition and soil management!`);
            }
        }

        // Initialize
        function init() {
            initVoiceSystem();
            
            // Hide loading screen
            setTimeout(() => {
                const loading = document.getElementById('loadingOverlay');
                loading.style.opacity = '0';
                setTimeout(() => {
                    loading.style.display = 'none';
                    
                    // Welcome message
                    if (voiceEnabled) {
                        speakText("Welcome to your soil science journey! We'll explore how plants get their nutrition from the soil and how farmers and gardeners can maintain healthy, fertile soils naturally. Starting with plant nutrients - the essential elements that every plant needs to grow strong and healthy. Let's dig into the world beneath our feet!");
                    }
                }, 1000);
            }, 3000);
            
            // Keyboard shortcuts
            document.addEventListener('keydown', (e) => {
                switch(e.key) {
                    case 'v': toggleVoice(); break;
                    case 'i': toggleInfo(); break;
                    case 'g': startGuidedTour(); break;
                    case 'Escape': stopSpeech(); guidedTourActive = false; break;
                    case 'ArrowRight': nextStep && nextStep(); break;
                }
            });
        }

        // Start the application
        init();
    </script>
</body>
</html>