<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cytoplasm and Organelle Systems - Complete Cellular Journey</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tween.js/18.6.4/tween.umd.js"></script>

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #16a085 0%, #2980b9 100%);
            color: white;
            overflow: hidden;
            position: relative;
            height: 100vh;
        }

        /* Animated Background */
        .bg-animation {
            position: fixed;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: 0;
            opacity: 0.1;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 320"><path fill="%23ffffff" fill-opacity="0.2" d="M0,96L48,112C96,128,192,160,288,186.7C384,213,480,235,576,213.3C672,192,768,128,864,128C960,128,1056,192,1152,197.3C1248,203,1344,149,1392,122.7L1440,96L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z"></path></svg>') repeat-x;
            animation: wave 10s linear infinite;
        }

        @keyframes wave {
            0% { background-position-x: 0; }
            100% { background-position-x: 1440px; }
        }

        /* Museum Interface - Compact Header */
        .museum-header {
            position: absolute;
            top: 10px;
            left: 20px;
            text-align: left;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            padding: 10px 18px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .museum-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 4px;
            background: linear-gradient(45deg, #16a085, #2980b9);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: titleGlow 3s ease-in-out infinite;
        }

        @keyframes titleGlow {
            0%, 100% { filter: brightness(1); }
            50% { filter: brightness(1.2); }
        }

        .exhibit-subtitle {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.8);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .organelle-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            background: #16a085;
            border-radius: 50%;
            animation: organellePulse 2s ease-in-out infinite;
        }

        @keyframes organellePulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.3); opacity: 0.7; }
        }

        /* Journey Navigation - Enhanced */
        .journey-navigation {
            position: absolute;
            bottom: 20px;
            left: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            padding: 15px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            max-width: 300px;
        }

        .journey-title {
            font-size: 14px;
            font-weight: 600;
            color: #3498db;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .journey-steps {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }

        .journey-btn {
            background: rgba(52, 152, 219, 0.2);
            border: 1px solid rgba(52, 152, 219, 0.4);
            color: white;
            padding: 6px 10px;
            border-radius: 20px;
            font-size: 11px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 4px;
            white-space: nowrap;
        }

        .journey-btn:hover {
            background: rgba(52, 152, 219, 0.3);
            border-color: #3498db;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(52, 152, 219, 0.3);
        }

        .journey-btn.active {
            background: linear-gradient(135deg, #16a085, #27ae60);
            border-color: #16a085;
            box-shadow: 0 0 20px rgba(22, 160, 133, 0.5);
            animation: organelleActive 2s infinite;
        }

        .journey-btn.completed {
            background: rgba(46, 204, 113, 0.3);
            border-color: #2ecc71;
        }

        @keyframes organelleActive {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        /* 3D Model Container */
        .model-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 0;
            overflow: hidden;
            border: none;
            z-index: 100;
        }

        .sketchfab-embed-wrapper {
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #16a085 0%, #2980b9 100%);
        }

        .sketchfab-embed-wrapper iframe {
            width: 100%;
            height: 100%;
            border: none;
            border-radius: 0;
        }

        /* Information Panel - Enhanced */
        .info-panel {
            position: absolute;
            top: 70px;
            right: 20px;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(25px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 16px;
            padding: 24px;
            width: 380px;
            max-height: calc(100vh - 140px);
            z-index: 800;
            overflow-y: auto;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }

        .info-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        }

        .info-icon {
            font-size: 28px;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        .info-title {
            flex: 1;
        }

        .info-title h2 {
            font-size: 18px;
            color: #16a085;
            margin-bottom: 4px;
        }

        .info-subtitle {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.7);
        }

        .info-content {
            color: rgba(255, 255, 255, 0.9);
            font-size: 14px;
            line-height: 1.6;
        }

        /* Progress Tracker */
        .progress-tracker {
            background: linear-gradient(135deg, rgba(52, 152, 219, 0.1), rgba(22, 160, 133, 0.1));
            border: 1px solid rgba(52, 152, 219, 0.3);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 20px;
        }

        .progress-header {
            font-size: 13px;
            font-weight: 600;
            color: #3498db;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .progress-percentage {
            font-size: 18px;
            color: #16a085;
            font-weight: 700;
        }

        .progress-bar {
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 12px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #3498db, #16a085);
            border-radius: 4px;
            transition: width 0.8s ease;
            box-shadow: 0 0 10px rgba(22, 160, 133, 0.5);
        }

        .progress-steps-mini {
            display: flex;
            justify-content: space-between;
            font-size: 9px;
            color: rgba(255, 255, 255, 0.6);
        }

        .step-mini {
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .step-mini.active {
            color: #16a085;
            font-weight: 600;
        }

        .step-mini.completed {
            color: #2ecc71;
        }

        /* Information Cards */
        .info-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 14px;
            margin-bottom: 14px;
        }

        .info-card-title {
            color: #3498db;
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .info-card-content {
            color: rgba(255, 255, 255, 0.85);
            font-size: 12px;
            line-height: 1.5;
        }

        .info-list {
            list-style: none;
            padding: 0;
        }

        .info-list li {
            padding: 6px 0;
            padding-left: 20px;
            position: relative;
            font-size: 12px;
            color: rgba(255, 255, 255, 0.8);
        }

        .info-list li:before {
            content: "→";
            position: absolute;
            left: 0;
            color: #16a085;
        }

        /* Fun Fact Box */
        .fun-fact {
            background: linear-gradient(135deg, rgba(46, 204, 113, 0.1), rgba(52, 152, 219, 0.1));
            border: 1px solid rgba(46, 204, 113, 0.3);
            border-radius: 12px;
            padding: 14px;
            margin: 16px 0;
            position: relative;
            overflow: hidden;
        }

        .fun-fact:before {
            content: "🔬";
            position: absolute;
            top: -20px;
            right: -20px;
            font-size: 60px;
            opacity: 0.1;
        }

        .fun-fact-title {
            color: #2ecc71;
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 6px;
        }

        .fun-fact-text {
            color: rgba(255, 255, 255, 0.9);
            font-size: 12px;
            line-height: 1.5;
            position: relative;
            z-index: 1;
        }

        /* Historical Bio Box */
        .bio-fact {
            background: linear-gradient(135deg, rgba(142, 68, 173, 0.1), rgba(52, 152, 219, 0.1));
            border: 1px solid rgba(142, 68, 173, 0.3);
            border-radius: 12px;
            padding: 14px;
            margin: 16px 0;
            position: relative;
            overflow: hidden;
        }

        .bio-fact:before {
            content: "👨‍🔬";
            position: absolute;
            top: -20px;
            right: -20px;
            font-size: 60px;
            opacity: 0.1;
        }

        .bio-fact-title {
            color: #8e44ad;
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 6px;
        }

        .bio-fact-text {
            color: rgba(255, 255, 255, 0.9);
            font-size: 12px;
            line-height: 1.5;
            position: relative;
            z-index: 1;
        }

        /* Voice Controls */
        .voice-controls {
            position: absolute;
            top: 10px;
            right: 20px;
            display: flex;
            gap: 8px;
            z-index: 1000;
        }

        .control-btn {
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            width: 44px;
            height: 44px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            position: relative;
        }

        .control-btn:hover {
            background: rgba(22, 160, 133, 0.3);
            border-color: #16a085;
            transform: scale(1.1);
        }

        .control-btn.active {
            background: rgba(22, 160, 133, 0.4);
            border-color: #16a085;
            box-shadow: 0 0 20px rgba(22, 160, 133, 0.5);
        }

        .control-tooltip {
            position: absolute;
            bottom: -30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9);
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 10px;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .control-btn:hover .control-tooltip {
            opacity: 1;
        }

        /* Loading Screen */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #16a085 0%, #2980b9 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            transition: opacity 1s ease;
        }

        .loading-content {
            text-align: center;
        }

        .loading-organelle {
            font-size: 60px;
            animation: organelleFloat 3s ease-in-out infinite;
            margin-bottom: 20px;
        }

        @keyframes organelleFloat {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-10px) rotate(180deg); }
        }

        .loading-text {
            color: white;
            font-size: 20px;
            margin-bottom: 20px;
        }

        .loading-progress {
            width: 200px;
            height: 4px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 2px;
            overflow: hidden;
        }

        .loading-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #16a085, #3498db);
            animation: loading 2s ease-in-out infinite;
        }

        @keyframes loading {
            0% { width: 0%; }
            50% { width: 100%; }
            100% { width: 0%; }
        }

        /* Voice Indicator */
        .voice-indicator {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(22, 160, 133, 0.5);
            border-radius: 30px;
            padding: 14px 28px;
            display: flex;
            align-items: center;
            gap: 12px;
            z-index: 1000;
            opacity: 0;
            transition: all 0.3s ease;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }

        .voice-indicator.visible {
            opacity: 1;
            transform: translateX(-50%) translateY(-10px);
        }

        .voice-waves {
            display: flex;
            align-items: center;
            gap: 3px;
        }

        .voice-wave {
            width: 3px;
            height: 20px;
            background: linear-gradient(180deg, #16a085, #3498db);
            border-radius: 2px;
            animation: voice-wave 1s ease-in-out infinite;
        }

        .voice-wave:nth-child(2) { animation-delay: 0.1s; }
        .voice-wave:nth-child(3) { animation-delay: 0.2s; }
        .voice-wave:nth-child(4) { animation-delay: 0.3s; }
        .voice-wave:nth-child(5) { animation-delay: 0.4s; }

        @keyframes voice-wave {
            0%, 100% { transform: scaleY(0.3); }
            50% { transform: scaleY(1); }
        }

        .narration-text {
            color: white;
            font-size: 13px;
            max-width: 300px;
        }

        /* Quick Actions */
        .quick-actions {
            position: absolute;
            bottom: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            z-index: 1000;
        }

        .action-btn {
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 10px 16px;
            border-radius: 25px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
        }

        .action-btn:hover {
            background: rgba(52, 152, 219, 0.3);
            border-color: #3498db;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(52, 152, 219, 0.3);
        }

        /* Custom Scrollbar */
        .info-panel::-webkit-scrollbar {
            width: 6px;
        }

        .info-panel::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 3px;
        }

        .info-panel::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, #16a085, #3498db);
            border-radius: 3px;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .info-panel {
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                top: auto;
                width: 100%;
                max-height: 50vh;
                border-radius: 20px 20px 0 0;
            }
            
            .journey-navigation {
                bottom: 52vh;
                max-width: calc(100% - 40px);
            }
            
            .voice-controls {
                top: auto;
                bottom: 55vh;
                right: 10px;
            }
            
            .quick-actions {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="bg-animation"></div>

    <!-- Loading Screen -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-content">
            <div class="loading-organelle">🧪</div>
            <div class="loading-text">Preparing Your Organelle Journey...</div>
            <div class="loading-progress">
                <div class="loading-progress-bar"></div>
            </div>
        </div>
    </div>

    <!-- Museum Header -->
    <div class="museum-header">
        <div class="museum-title">Cytoplasm and Organelle Systems</div>
        <div class="exhibit-subtitle">
            <span class="organelle-indicator"></span>
            The Cellular Factory Network
        </div>
    </div>

    <!-- Journey Navigation -->
    <div class="journey-navigation">
        <div class="journey-title">
            <span>🧪</span>
            <span>Your Organelle Journey</span>
        </div>
        <div class="journey-steps">
            <button class="journey-btn active" onclick="loadJourneyStep('cytoplasm')">
                <span>🌊</span> Cytoplasm
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('rough_er')">
                <span>🏭</span> Rough ER
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('smooth_er')">
                <span>⚙️</span> Smooth ER
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('golgi')">
                <span>📦</span> Golgi
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('lysosomes')">
                <span>🗑️</span> Lysosomes
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('integration')">
                <span>🔄</span> Integration
            </button>
        </div>
    </div>

    <!-- 3D Model Container -->
    <div class="model-container">
        <div class="sketchfab-embed-wrapper">
            <iframe id="api-frame"
                    title="Cytoplasm Structure Model" 
                    frameborder="0" 
                    allowfullscreen 
                    mozallowfullscreen="true" 
                    webkitallowfullscreen="true" 
                    allow="autoplay; fullscreen; xr-spatial-tracking"
                    xr-spatial-tracking 
                    execution-while-out-of-viewport 
                    execution-while-not-rendered 
                    web-share 
                    src="https://sketchfab.com/models/339c5a52e99e4713add1fec2298f66cb/embed?autostart=1&internal=1&tracking=0&ui_ar=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0">
            </iframe>
        </div>
    </div>

    <!-- Information Panel -->
    <div class="info-panel" id="infoPanel">
        <div class="info-header">
            <div class="info-icon" id="stepIcon">🌊</div>
            <div class="info-title">
                <h2 id="stepTitle">Cytoplasm - The Cellular Ocean</h2>
                <div class="info-subtitle" id="stepSubtitle">Where life's chemistry happens</div>
            </div>
        </div>

        <!-- Progress Tracker -->
        <div class="progress-tracker">
            <div class="progress-header">
                <span>Journey Progress</span>
                <span class="progress-percentage" id="progressPercent">0%</span>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 0%"></div>
            </div>
            <div class="progress-steps-mini">
                <span class="step-mini active" onclick="loadJourneyStep('cytoplasm')">Cytoplasm</span>
                <span class="step-mini" onclick="loadJourneyStep('rough_er')">Rough ER</span>
                <span class="step-mini" onclick="loadJourneyStep('smooth_er')">Smooth ER</span>
                <span class="step-mini" onclick="loadJourneyStep('golgi')">Golgi</span>
                <span class="step-mini" onclick="loadJourneyStep('lysosomes')">Lysosomes</span>
                <span class="step-mini" onclick="loadJourneyStep('integration')">Integration</span>
            </div>
        </div>

        <div class="info-content" id="mainDescription">
            Welcome to the cytoplasm - the gel-like matrix that fills the space between the cell membrane and nucleus! This isn't empty space, but a dynamic, organized environment where thousands of chemical reactions occur simultaneously. It's the cellular ocean where organelles float and life's essential processes unfold.
        </div>

        <div class="info-card">
            <div class="info-card-title">
                <span>🔬</span> Key Components
            </div>
            <div class="info-card-content">
                <ul class="info-list" id="keyConcepts">
                    <li>Cytosol - the liquid component (70% water)</li>
                    <li>Dissolved proteins, salts, and organic molecules</li>
                    <li>Cytoskeleton providing structural support</li>
                    <li>Organelles suspended throughout</li>
                </ul>
            </div>
        </div>

        <div class="fun-fact">
            <div class="fun-fact-title">Amazing Fact!</div>
            <div class="fun-fact-text" id="funFact">
                The cytoplasm makes up about 80% of a cell's volume and contains over 4 billion protein molecules working together in perfect coordination!
            </div>
        </div>

        <div class="info-card">
            <div class="info-card-title">
                <span>🎯</span> Learning Objectives
            </div>
            <div class="info-card-content" id="learningObjectives">
                By exploring this section, you'll understand how the cytoplasm provides the perfect environment for cellular life and organelle function.
            </div>
        </div>
    </div>

    <!-- Voice Controls -->
    <div class="voice-controls">
        <button class="control-btn active" id="voiceToggle" onclick="toggleVoice()">
            🔊
            <span class="control-tooltip">Voice Narration</span>
        </button>
        <button class="control-btn" onclick="toggleAutoPlay()">
            ▶️
            <span class="control-tooltip">Auto Journey</span>
        </button>
        <button class="control-btn" onclick="toggleInfo()">
            ℹ️
            <span class="control-tooltip">Toggle Info</span>
        </button>
    </div>

    <!-- Quick Actions -->
    <div class="quick-actions">
        <button class="action-btn" onclick="startGuidedTour()">
            <span>🚀</span> Guided Tour
        </button>
        <button class="action-btn" onclick="showQuiz()">
            <span>🎯</span> Test Knowledge
        </button>
    </div>

    <!-- Voice Indicator -->
    <div class="voice-indicator" id="voiceIndicator">
        <div class="voice-waves">
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
        </div>
        <div class="narration-text" id="narrationText">Narrating...</div>
    </div>

    <script>
        // Journey Step Data with Complete Pedagogical Content
        const JOURNEY_DATA = {
            cytoplasm: {
                title: "Cytoplasm - The Cellular Ocean",
                subtitle: "Where life's chemistry happens",
                icon: "🌊",
                modelUrl: "https://sketchfab.com/models/339c5a52e99e4713add1fec2298f66cb/embed?autostart=1&internal=1&tracking=0&ui_ar=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "Welcome to the cytoplasm - the gel-like matrix that fills the space between the cell membrane and nucleus! This isn't empty space, but a dynamic, organized environment where thousands of chemical reactions occur simultaneously. It's the cellular ocean where organelles float and life's essential processes unfold.",
                concepts: [
                    "Cytosol - the liquid component (70% water)",
                    "Dissolved proteins, salts, and organic molecules", 
                    "Cytoskeleton providing structural support",
                    "Organelles suspended throughout"
                ],
                funFact: "The cytoplasm makes up about 80% of a cell's volume and contains over 4 billion protein molecules working together in perfect coordination!",
                objectives: "By exploring this section, you'll understand how the cytoplasm provides the perfect environment for cellular life and organelle function.",
                narration: "Welcome to the cytoplasm - the bustling metropolis inside every cell! This isn't just empty space filled with water, but a highly organized, gel-like environment teeming with activity. The cytoplasm consists of the cytosol - a complex aqueous solution containing dissolved ions, small molecules, and proteins - plus all the organelles suspended within it. Think of it like a busy city where the cytosol is the streets and the organelles are the buildings, each with specialized functions. The cytoskeleton acts like the city's infrastructure, providing highways for transport and structural support. Thousands of chemical reactions happen here every second - proteins are being made, energy is being converted, and materials are being transported. The pH is carefully maintained, the ionic balance is precisely controlled, and the temperature is just right for life's delicate chemistry. This is where the magic of cellular life truly happens!"
            },
            rough_er: {
                title: "Rough ER - The Protein Factory",
                subtitle: "Ribosomes create the cellular workforce",
                icon: "🏭",
                modelUrl: "https://sketchfab.com/models/618858f0395542faa875b21083990f72/embed?autostart=1&internal=1&tracking=0&ui_ar=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "The rough endoplasmic reticulum is the cell's protein manufacturing center! Its surface is studded with ribosomes, giving it a 'rough' appearance. Here, proteins destined for secretion, membrane incorporation, or organelle function are synthesized and initially processed.",
                concepts: [
                    "Membrane-bound ribosomes give 'rough' appearance",
                    "Synthesizes proteins for export and membranes",
                    "Co-translational protein insertion and folding",
                    "Connected to nuclear envelope"
                ],
                funFact: "A single rough ER can have millions of ribosomes attached, producing thousands of proteins simultaneously - like having thousands of assembly lines working in parallel!",
                objectives: "Learn how the rough ER coordinates protein synthesis with membrane biogenesis and quality control.",
                narration: "Welcome to the rough endoplasmic reticulum - the cell's massive protein manufacturing plant! The 'rough' appearance comes from thousands of ribosomes studded across its membrane surface, like barnacles on a ship's hull. But these aren't just decorations - they're sophisticated protein-making machines working around the clock. As ribosomes translate messenger RNA, newly forming proteins are fed directly through pores in the ER membrane into the internal space called the lumen. This is where the magic of co-translational processing happens - proteins are folded, modified, and quality-checked even as they're being made! The rough ER specializes in making proteins destined for three key locations: secretion outside the cell, incorporation into cell membranes, or delivery to other organelles. It's directly connected to the nuclear envelope, creating a highway for messenger RNA to travel from genes to ribosomes. This assembly line approach ensures that proteins are made efficiently and correctly from the very start of their synthesis!"
            },
            smooth_er: {
                title: "Smooth ER - The Lipid Workshop",
                subtitle: "Synthesis and detoxification center",
                icon: "⚙️",
                modelUrl: "https://sketchfab.com/models/278a07ba7bff424b8095c4b3e840781c/embed?autostart=1&internal=1&tracking=0&ui_ar=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "The smooth endoplasmic reticulum lacks ribosomes but is equally important! This tubular network specializes in lipid synthesis, steroid hormone production, calcium storage, and detoxification of harmful substances. It's the cell's chemical processing plant.",
                concepts: [
                    "No ribosomes - smooth membrane surface",
                    "Synthesizes phospholipids and steroids",
                    "Calcium ion storage and release",
                    "Detoxifies drugs and metabolic waste"
                ],
                funFact: "In liver cells, the smooth ER can expand up to 30 times its normal size when processing large amounts of alcohol or drugs - it's like the cell's adjustable detox facility!",
                objectives: "Understand how the smooth ER serves multiple specialized functions from membrane biogenesis to cellular detoxification.",
                narration: "Meet the smooth endoplasmic reticulum - the cell's versatile chemical workshop! Unlike its rough cousin, the smooth ER has no ribosomes, giving it a sleek, tubular appearance that can twist and branch throughout the cytoplasm. But don't let its smooth surface fool you - this organelle is incredibly busy with specialized chemistry! The smooth ER is the cell's lipid factory, synthesizing phospholipids that will become new cell membranes, and cholesterol that serves as a membrane stabilizer and hormone precursor. In steroid-producing cells, it manufactures hormones like testosterone, estrogen, and cortisol. The smooth ER also acts as the cell's calcium vault, storing and releasing calcium ions that trigger everything from muscle contractions to enzyme activation. Perhaps most impressively, it's the cell's detoxification center - especially in liver cells, where specialized enzymes break down alcohol, drugs, and other potentially harmful substances. When you take medication, it's the smooth ER that works to process and neutralize it!"
            },
            golgi: {
                title: "Golgi Apparatus - The Cellular Post Office",
                subtitle: "Processing, packaging, and shipping center",
                icon: "📦",
                modelUrl: "https://sketchfab.com/models/eb4ef6566cce4c65a1c4bc33fe8c0f7b/embed?autostart=1&internal=1&tracking=0&ui_ar=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "The Golgi apparatus is the cell's processing and shipping center! This stack of flattened membranes receives proteins from the rough ER, modifies them with chemical tags, packages them into vesicles, and ships them to their final destinations.",
                concepts: [
                    "Stack of flattened membrane cisternae",
                    "Modifies proteins with sugar groups",
                    "Sorts and packages into transport vesicles",
                    "Three regions: cis, medial, and trans"
                ],
                funFact: "The Golgi was discovered by Italian scientist Camillo Golgi in 1898 using a silver staining technique he invented - he won the Nobel Prize in 1906 for his groundbreaking work!",
                objectives: "Learn how the Golgi apparatus processes and directs protein traffic throughout the cell.",
                narration: "Welcome to the Golgi apparatus - the cell's sophisticated processing and shipping center! This remarkable organelle looks like a stack of pancakes, but each 'pancake' is actually a flattened membrane compartment called a cisterna. Named after Italian scientist Camillo Golgi who discovered it in 1898, this organelle is like a biological post office with three main departments. Proteins arrive at the cis face - the receiving dock - in transport vesicles from the rough ER. As proteins move through the medial region, they're chemically modified with sugar groups in a process called glycosylation, like adding address labels and shipping instructions. Finally, at the trans face - the shipping dock - proteins are sorted and packaged into new vesicles based on their final destinations: some go to lysosomes, others to the cell membrane, and some are secreted outside the cell. Each modification is precise and purposeful, ensuring proteins reach exactly where they're needed. The Golgi literally reads the molecular addresses and provides the appropriate shipping methods!"
            },
            lysosomes: {
                title: "Lysosomes - The Cleanup Crew",
                subtitle: "Cellular waste disposal and recycling",
                icon: "🗑️",
                modelUrl: "https://sketchfab.com/models/6bd2957542ae4625aa0dcd180d979f9b/embed?autostart=1&internal=1&tracking=0&ui_ar=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "Lysosomes are the cell's waste disposal and recycling centers! These membrane-bound organelles contain powerful digestive enzymes that break down worn-out organelles, cellular waste, and foreign substances. They're sometimes called 'suicide bags' for their role in programmed cell death.",
                concepts: [
                    "Contains 40+ digestive enzymes",
                    "Acidic interior (pH ~4.5) for enzyme activity",
                    "Autophagy - recycling cellular components",
                    "Role in programmed cell death (apoptosis)"
                ],
                funFact: "Lysosomes can digest almost anything - they even recycle entire mitochondria and other organelles when they become old or damaged, earning them the nickname 'cellular recycling centers'!",
                objectives: "Understand how lysosomes maintain cellular health through waste disposal and recycling processes.",
                narration: "Meet the lysosomes - the cell's dedicated cleanup and recycling crew! These spherical organelles might look simple, but they're packed with over 40 different digestive enzymes capable of breaking down almost any biological molecule. The interior of a lysosome is highly acidic - about pH 4.5 - which is perfect for enzyme activity but would be lethal to the rest of the cell. That's why the lysosomal membrane is so important - it keeps these powerful enzymes safely contained until they're needed. Lysosomes have several crucial jobs: they digest food particles brought in from outside the cell, break down worn-out organelles in a process called autophagy, and destroy harmful substances like bacteria. They're also involved in programmed cell death, or apoptosis - when a cell needs to die for the good of the organism, lysosomes release their enzymes to carefully dismantle the cell from within. This is why they're sometimes called 'suicide bags,' though this term doesn't capture their essential role in maintaining cellular health through constant cleaning and recycling!"
            },
            integration: {
                title: "Integration - The Cellular Symphony",
                subtitle: "How organelles work together",
                icon: "🔄",
                modelUrl: "https://sketchfab.com/models/339c5a52e99e4713add1fec2298f66cb/embed?autostart=1&internal=1&tracking=0&ui_ar=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "Now let's see how all these organelles work together in perfect harmony! The endomembrane system - consisting of the nuclear envelope, ER, Golgi, and lysosomes - functions as an integrated network for protein synthesis, processing, and transport throughout the cell.",
                concepts: [
                    "Endomembrane system integration",
                    "Vesicle transport between organelles", 
                    "Coordinated protein processing pathway",
                    "Membrane biogenesis and recycling"
                ],
                funFact: "A single protein can travel from the rough ER to the Golgi to its final destination in just 30 minutes, passing through multiple organelles in a precisely choreographed cellular dance!",
                objectives: "Synthesize knowledge of how organelles coordinate their functions to maintain cellular life and respond to changing conditions.",
                narration: "Welcome to the grand finale - understanding how all these organelles work together in the cellular symphony! The cytoplasm isn't just a container holding separate organelles; it's the stage where an incredibly coordinated performance takes place every moment of every day. Let's trace a protein's journey: it begins as a gene in the nucleus, becomes messenger RNA that travels to ribosomes on the rough ER, gets synthesized and folded in the ER lumen, travels in a vesicle to the Golgi apparatus where it's modified and packaged, then travels in another vesicle to its final destination - perhaps the cell membrane, a lysosome, or secretion outside the cell. Meanwhile, the smooth ER is synthesizing the very membranes these vesicles are made from, and lysosomes are recycling old components to make room for new ones. This endomembrane system works like a perfectly orchestrated assembly line, with each organelle playing its specific role while communicating constantly with the others through chemical signals and membrane contacts. The result? A living cell that can grow, respond to its environment, and maintain itself indefinitely - truly one of nature's greatest achievements!"
            }
        };

        // Global Variables
        let currentStep = 'cytoplasm';
        let voiceEnabled = true;
        let autoPlayEnabled = false;
        let currentSpeech = null;
        let selectedVoice = null;
        let journeyProgress = 0;
        let guidedTourActive = false;

        // Initialize Voice System
        function initVoiceSystem() {
            if (!('speechSynthesis' in window)) {
                console.warn('Speech synthesis not supported');
                voiceEnabled = false;
                document.getElementById('voiceToggle').style.display = 'none';
                return;
            }

            function loadVoices() {
                const voices = speechSynthesis.getVoices();
                if (voices.length === 0) return;

                // Prefer natural-sounding voices
                const preferredVoices = [
                    'Google UK English Female',
                    'Microsoft Sonia',
                    'Microsoft Hazel',
                    'Samantha',
                    'Victoria'
                ];

                for (const name of preferredVoices) {
                    selectedVoice = voices.find(v => v.name.includes(name));
                    if (selectedVoice) break;
                }

                if (!selectedVoice) {
                    selectedVoice = voices.find(v => v.lang.startsWith('en'));
                }
            }

            loadVoices();
            if (speechSynthesis.onvoiceschanged !== undefined) {
                speechSynthesis.onvoiceschanged = loadVoices;
            }
        }

        // Load Journey Step
        function loadJourneyStep(stepId) {
            const stepData = JOURNEY_DATA[stepId];
            if (!stepData) return;

            currentStep = stepId;
            
            // Update model
            document.getElementById('api-frame').src = stepData.modelUrl;
            
            // Update info panel
            document.getElementById('stepIcon').textContent = stepData.icon;
            document.getElementById('stepTitle').textContent = stepData.title;
            document.getElementById('stepSubtitle').textContent = stepData.subtitle;
            document.getElementById('mainDescription').textContent = stepData.description;
            
            // Update key concepts
            const conceptsList = document.getElementById('keyConcepts');
            conceptsList.innerHTML = stepData.concepts.map(c => `<li>${c}</li>`).join('');
            
            // Update fun fact
            document.getElementById('funFact').textContent = stepData.funFact;
            
            // Update learning objectives
            document.getElementById('learningObjectives').textContent = stepData.objectives;
            
            // Add biographical information for Golgi
            const existingBio = document.querySelector('.bio-fact');
            if (existingBio) existingBio.remove();
            
            if (stepId === 'golgi') {
                const bioFact = document.createElement('div');
                bioFact.className = 'bio-fact';
                bioFact.innerHTML = `
                    <div class="bio-fact-title">Meet Camillo Golgi (1843-1926)</div>
                    <div class="bio-fact-text">Italian physician and scientist who revolutionized our understanding of the nervous system and cellular structure. He developed the "black reaction" silver staining technique that made it possible to see individual neurons and discover the organelle that bears his name. Golgi shared the 1906 Nobel Prize in Physiology or Medicine with Santiago Ramón y Cajal for their work on the structure of the nervous system.</div>
                `;
                document.querySelector('.fun-fact').insertAdjacentElement('afterend', bioFact);
            }
            
            // Update navigation buttons
            updateNavigationButtons(stepId);
            
            // Update progress
            updateProgress();
            
            // Play narration if enabled
            if (voiceEnabled) {
                speakText(stepData.narration);
            }
        }

        // Update Navigation Buttons
        function updateNavigationButtons(activeStep) {
            const buttons = document.querySelectorAll('.journey-btn');
            const steps = ['cytoplasm', 'rough_er', 'smooth_er', 'golgi', 'lysosomes', 'integration'];
            const activeIndex = steps.indexOf(activeStep);
            
            buttons.forEach((btn, index) => {
                btn.classList.remove('active', 'completed');
                if (index < activeIndex) {
                    btn.classList.add('completed');
                } else if (index === activeIndex) {
                    btn.classList.add('active');
                }
            });
            
            // Update mini steps
            const miniSteps = document.querySelectorAll('.step-mini');
            miniSteps.forEach((step, index) => {
                step.classList.remove('active', 'completed');
                if (index < activeIndex) {
                    step.classList.add('completed');
                } else if (index === activeIndex) {
                    step.classList.add('active');
                }
            });
        }

        // Update Progress
        function updateProgress() {
            const steps = ['cytoplasm', 'rough_er', 'smooth_er', 'golgi', 'lysosomes', 'integration'];
            const currentIndex = steps.indexOf(currentStep);
            const progress = ((currentIndex + 1) / steps.length) * 100;
            
            document.getElementById('progressPercent').textContent = Math.round(progress) + '%';
            document.getElementById('progressFill').style.width = progress + '%';
        }

        // Speech Functions
        function speakText(text) {
            if (!voiceEnabled || !text) return;
            
            stopSpeech();
            
            currentSpeech = new SpeechSynthesisUtterance(text);
            if (selectedVoice) {
                currentSpeech.voice = selectedVoice;
            }
            currentSpeech.rate = 0.9;
            currentSpeech.pitch = 1.0;
            currentSpeech.volume = 0.9;
            
            currentSpeech.onstart = () => {
                document.getElementById('voiceIndicator').classList.add('visible');
                document.getElementById('narrationText').textContent = 
                    text.substring(0, 50) + (text.length > 50 ? '...' : '');
            };
            
            currentSpeech.onend = () => {
                document.getElementById('voiceIndicator').classList.remove('visible');
                currentSpeech = null;
                
                // Auto-advance if guided tour is active
                if (guidedTourActive) {
                    setTimeout(nextStep, 2000);
                }
            };
            
            speechSynthesis.speak(currentSpeech);
        }

        function stopSpeech() {
            if (currentSpeech) {
                speechSynthesis.cancel();
                currentSpeech = null;
                document.getElementById('voiceIndicator').classList.remove('visible');
            }
        }

        // Control Functions
        function toggleVoice() {
            voiceEnabled = !voiceEnabled;
            const btn = document.getElementById('voiceToggle');
            btn.textContent = voiceEnabled ? '🔊' : '🔇';
            btn.classList.toggle('active', voiceEnabled);
            
            if (!voiceEnabled) {
                stopSpeech();
            }
        }

        function toggleAutoPlay() {
            autoPlayEnabled = !autoPlayEnabled;
            if (autoPlayEnabled) {
                startGuidedTour();
            } else {
                guidedTourActive = false;
            }
        }

        function toggleInfo() {
            const panel = document.getElementById('infoPanel');
            panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
        }

        // Guided Tour
        function startGuidedTour() {
            guidedTourActive = true;
            const steps = ['cytoplasm', 'rough_er', 'smooth_er', 'golgi', 'lysosomes', 'integration'];
            let stepIndex = 0;
            
            function tourStep() {
                if (stepIndex < steps.length && guidedTourActive) {
                    loadJourneyStep(steps[stepIndex]);
                    stepIndex++;
                } else {
                    guidedTourActive = false;
                    if (voiceEnabled) {
                        speakText("Congratulations! You've completed your journey through the cytoplasm and organelle systems. You now understand how these cellular components work together to maintain life!");
                    }
                }
            }
            
            tourStep();
            window.nextStep = tourStep;
        }

        // Quiz Function
        function showQuiz() {
            const questions = [
                "What makes the rough ER 'rough'?",
                "What is the main function of the smooth ER?",
                "Why is the Golgi apparatus called the cellular post office?",
                "What makes lysosomes potentially dangerous to the cell?",
                "How do organelles communicate with each other?"
            ];
            
            const randomQ = questions[Math.floor(Math.random() * questions.length)];
            
            if (voiceEnabled) {
                speakText(`Here's a question to test your knowledge: ${randomQ} Think about what you've learned in this organelle journey!`);
            }
        }

        // Initialize
        function init() {
            initVoiceSystem();
            
            // Hide loading screen
            setTimeout(() => {
                const loading = document.getElementById('loadingOverlay');
                loading.style.opacity = '0';
                setTimeout(() => {
                    loading.style.display = 'none';
                    
                    // Welcome message
                    if (voiceEnabled) {
                        speakText("Welcome to your journey through the cytoplasm and organelle systems! We'll explore how these cellular components work together like departments in a well-organized factory. Let's start with the cytoplasm - the cellular ocean where all life's chemistry happens!");
                    }
                }, 1000);
            }, 3000);
            
            // Keyboard shortcuts
            document.addEventListener('keydown', (e) => {
                switch(e.key) {
                    case 'v': toggleVoice(); break;
                    case 'i': toggleInfo(); break;
                    case 'g': startGuidedTour(); break;
                    case 'Escape': stopSpeech(); guidedTourActive = false; break;
                    case 'ArrowRight': nextStep && nextStep(); break;
                }
            });
        }

        // Start the application
        init();
    </script>
</body>
</html>