<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sex Determination in Humans - Complete Genetic Journey</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tween.js/18.6.4/tween.umd.js"></script>

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            overflow: hidden;
            position: relative;
            height: 100vh;
        }

        /* Animated Background */
        .bg-animation {
            position: fixed;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: 0;
            opacity: 0.1;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 320"><path fill="%23ffffff" fill-opacity="0.2" d="M0,96L48,112C96,128,192,160,288,186.7C384,213,480,235,576,213.3C672,192,768,128,864,128C960,128,1056,192,1152,197.3C1248,203,1344,149,1392,122.7L1440,96L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z"></path></svg>') repeat-x;
            animation: wave 10s linear infinite;
        }

        @keyframes wave {
            0% { background-position-x: 0; }
            100% { background-position-x: 1440px; }
        }

        /* Museum Interface - Compact Header */
        .museum-header {
            position: absolute;
            top: 10px;
            left: 20px;
            text-align: left;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            padding: 10px 18px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .museum-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 4px;
            background: linear-gradient(45deg, #3498db, #e74c3c);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: titleGlow 3s ease-in-out infinite;
        }

        @keyframes titleGlow {
            0%, 100% { filter: brightness(1); }
            50% { filter: brightness(1.2); }
        }

        .exhibit-subtitle {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.8);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .dna-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            background: #3498db;
            border-radius: 50%;
            animation: dna-pulse 1.5s ease-in-out infinite;
        }

        @keyframes dna-pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.3); opacity: 0.7; }
        }

        /* Journey Navigation - Enhanced */
        .journey-navigation {
            position: absolute;
            bottom: 20px;
            left: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            padding: 15px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            max-width: 280px;
        }

        .journey-title {
            font-size: 14px;
            font-weight: 600;
            color: #3498db;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .journey-steps {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }

        .journey-btn {
            background: rgba(52, 152, 219, 0.2);
            border: 1px solid rgba(52, 152, 219, 0.4);
            color: white;
            padding: 6px 10px;
            border-radius: 20px;
            font-size: 11px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 4px;
            white-space: nowrap;
        }

        .journey-btn:hover {
            background: rgba(52, 152, 219, 0.3);
            border-color: #3498db;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(52, 152, 219, 0.3);
        }

        .journey-btn.active {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            border-color: #e74c3c;
            box-shadow: 0 0 20px rgba(231, 76, 60, 0.5);
            animation: pulse 2s infinite;
        }

        .journey-btn.completed {
            background: rgba(46, 204, 113, 0.3);
            border-color: #2ecc71;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        /* 3D Model Container */
        .model-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 0;
            overflow: hidden;
            border: none;
            z-index: 100;
        }

        .sketchfab-embed-wrapper {
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .sketchfab-embed-wrapper iframe {
            width: 100%;
            height: 100%;
            border: none;
            border-radius: 0;
        }

        /* Information Panel - Enhanced */
        .info-panel {
            position: absolute;
            top: 70px;
            right: 20px;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(25px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 16px;
            padding: 24px;
            width: 380px;
            max-height: calc(100vh - 140px);
            z-index: 800;
            overflow-y: auto;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }

        .info-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        }

        .info-icon {
            font-size: 28px;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        .info-title {
            flex: 1;
        }

        .info-title h2 {
            font-size: 18px;
            color: #3498db;
            margin-bottom: 4px;
        }

        .info-subtitle {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.7);
        }

        .info-content {
            color: rgba(255, 255, 255, 0.9);
            font-size: 14px;
            line-height: 1.6;
        }

        /* Progress Tracker */
        .progress-tracker {
            background: linear-gradient(135deg, rgba(52, 152, 219, 0.1), rgba(155, 89, 182, 0.1));
            border: 1px solid rgba(52, 152, 219, 0.3);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 20px;
        }

        .progress-header {
            font-size: 13px;
            font-weight: 600;
            color: #3498db;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .progress-percentage {
            font-size: 18px;
            color: #e74c3c;
            font-weight: 700;
        }

        .progress-bar {
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 12px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #3498db, #e74c3c);
            border-radius: 4px;
            transition: width 0.8s ease;
            box-shadow: 0 0 10px rgba(52, 152, 219, 0.5);
        }

        .progress-steps-mini {
            display: flex;
            justify-content: space-between;
            font-size: 10px;
            color: rgba(255, 255, 255, 0.6);
        }

        .step-mini {
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .step-mini.active {
            color: #e74c3c;
            font-weight: 600;
        }

        .step-mini.completed {
            color: #2ecc71;
        }

        /* Information Cards */
        .info-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 14px;
            margin-bottom: 14px;
        }

        .info-card-title {
            color: #3498db;
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .info-card-content {
            color: rgba(255, 255, 255, 0.85);
            font-size: 12px;
            line-height: 1.5;
        }

        .info-list {
            list-style: none;
            padding: 0;
        }

        .info-list li {
            padding: 6px 0;
            padding-left: 20px;
            position: relative;
            font-size: 12px;
            color: rgba(255, 255, 255, 0.8);
        }

        .info-list li:before {
            content: "→";
            position: absolute;
            left: 0;
            color: #3498db;
        }

        /* Fun Fact Box */
        .fun-fact {
            background: linear-gradient(135deg, rgba(46, 204, 113, 0.1), rgba(52, 152, 219, 0.1));
            border: 1px solid rgba(46, 204, 113, 0.3);
            border-radius: 12px;
            padding: 14px;
            margin: 16px 0;
            position: relative;
            overflow: hidden;
        }

        .fun-fact:before {
            content: "🧬";
            position: absolute;
            top: -20px;
            right: -20px;
            font-size: 60px;
            opacity: 0.1;
        }

        .fun-fact-title {
            color: #2ecc71;
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 6px;
        }

        .fun-fact-text {
            color: rgba(255, 255, 255, 0.9);
            font-size: 12px;
            line-height: 1.5;
            position: relative;
            z-index: 1;
        }

        /* Voice Controls */
        .voice-controls {
            position: absolute;
            top: 10px;
            right: 20px;
            display: flex;
            gap: 8px;
            z-index: 1000;
        }

        .control-btn {
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            width: 44px;
            height: 44px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            position: relative;
        }

        .control-btn:hover {
            background: rgba(52, 152, 219, 0.3);
            border-color: #3498db;
            transform: scale(1.1);
        }

        .control-btn.active {
            background: rgba(52, 152, 219, 0.4);
            border-color: #3498db;
            box-shadow: 0 0 20px rgba(52, 152, 219, 0.5);
        }

        .control-tooltip {
            position: absolute;
            bottom: -30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9);
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 10px;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .control-btn:hover .control-tooltip {
            opacity: 1;
        }

        /* Loading Screen */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            transition: opacity 1s ease;
        }

        .loading-content {
            text-align: center;
        }

        .loading-dna {
            font-size: 60px;
            animation: dna-spin 2s ease-in-out infinite;
            margin-bottom: 20px;
        }

        @keyframes dna-spin {
            0%, 100% { transform: rotate(0deg) scale(1); }
            50% { transform: rotate(180deg) scale(1.1); }
        }

        .loading-text {
            color: white;
            font-size: 20px;
            margin-bottom: 20px;
        }

        .loading-progress {
            width: 200px;
            height: 4px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 2px;
            overflow: hidden;
        }

        .loading-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #3498db, #e74c3c);
            animation: loading 2s ease-in-out infinite;
        }

        @keyframes loading {
            0% { width: 0%; }
            50% { width: 100%; }
            100% { width: 0%; }
        }

        /* Voice Indicator */
        .voice-indicator {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(52, 152, 219, 0.5);
            border-radius: 30px;
            padding: 14px 28px;
            display: flex;
            align-items: center;
            gap: 12px;
            z-index: 1000;
            opacity: 0;
            transition: all 0.3s ease;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }

        .voice-indicator.visible {
            opacity: 1;
            transform: translateX(-50%) translateY(-10px);
        }

        .voice-waves {
            display: flex;
            align-items: center;
            gap: 3px;
        }

        .voice-wave {
            width: 3px;
            height: 20px;
            background: linear-gradient(180deg, #3498db, #e74c3c);
            border-radius: 2px;
            animation: voice-wave 1s ease-in-out infinite;
        }

        .voice-wave:nth-child(2) { animation-delay: 0.1s; }
        .voice-wave:nth-child(3) { animation-delay: 0.2s; }
        .voice-wave:nth-child(4) { animation-delay: 0.3s; }
        .voice-wave:nth-child(5) { animation-delay: 0.4s; }

        @keyframes voice-wave {
            0%, 100% { transform: scaleY(0.3); }
            50% { transform: scaleY(1); }
        }

        .narration-text {
            color: white;
            font-size: 13px;
            max-width: 300px;
        }

        /* Quick Actions */
        .quick-actions {
            position: absolute;
            bottom: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            z-index: 1000;
        }

        .action-btn {
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 10px 16px;
            border-radius: 25px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
        }

        .action-btn:hover {
            background: rgba(52, 152, 219, 0.3);
            border-color: #3498db;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(52, 152, 219, 0.3);
        }

        /* Custom Scrollbar */
        .info-panel::-webkit-scrollbar {
            width: 6px;
        }

        .info-panel::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 3px;
        }

        .info-panel::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, #3498db, #e74c3c);
            border-radius: 3px;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .info-panel {
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                top: auto;
                width: 100%;
                max-height: 50vh;
                border-radius: 20px 20px 0 0;
            }
            
            .journey-navigation {
                bottom: 52vh;
                max-width: calc(100% - 40px);
            }
            
            .voice-controls {
                top: auto;
                bottom: 55vh;
                right: 10px;
            }
            
            .quick-actions {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="bg-animation"></div>

    <!-- Loading Screen -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-content">
            <div class="loading-dna">🧬</div>
            <div class="loading-text">Exploring the Genetics of Sex Determination...</div>
            <div class="loading-progress">
                <div class="loading-progress-bar"></div>
            </div>
        </div>
    </div>

    <!-- Museum Header -->
    <div class="museum-header">
        <div class="museum-title">Sex Determination in Humans</div>
        <div class="exhibit-subtitle">
            <span class="dna-indicator"></span>
            The Chromosomal Journey
        </div>
    </div>

    <!-- Journey Navigation -->
    <div class="journey-navigation">
        <div class="journey-title">
            <span>🧬</span>
            <span>Genetic Discovery Path</span>
        </div>
        <div class="journey-steps">
            <button class="journey-btn active" onclick="loadJourneyStep('introduction')">
                <span>🌟</span> Introduction
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('chromosomes')">
                <span>📚</span> Chromosomes
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('gametes')">
                <span>🥚</span> Gametes
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('fertilization')">
                <span>✨</span> Fertilization
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('xy_system')">
                <span>🧬</span> XY System
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('cross_diagram')">
                <span>📊</span> Inheritance
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('variations')">
                <span>🌍</span> Natural Variations
            </button>
        </div>
    </div>

    <!-- 3D Model Container -->
    <div class="model-container">
        <div class="sketchfab-embed-wrapper">
            <iframe id="api-frame"
                    title="Chromosome Structure Model" 
                    frameborder="0" 
                    allowfullscreen 
                    mozallowfullscreen="true" 
                    webkitallowfullscreen="true" 
                    allow="autoplay; fullscreen; xr-spatial-tracking"
                    xr-spatial-tracking 
                    execution-while-out-of-viewport 
                    execution-while-not-rendered 
                    web-share 
                    src="https://sketchfab.com/models/cc33bb1ebe6141b08d0d06f1bbebc2b7/embed?autostart=1&internal=1&tracking=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_watermark=0">
            </iframe>
        </div>
    </div>

    <!-- Information Panel -->
    <div class="info-panel" id="infoPanel">
        <div class="info-header">
            <div class="info-icon" id="stepIcon">🌟</div>
            <div class="info-title">
                <h2 id="stepTitle">Welcome to Sex Determination</h2>
                <div class="info-subtitle" id="stepSubtitle">The genetic basis of biological sex</div>
            </div>
        </div>

        <!-- Progress Tracker -->
        <div class="progress-tracker">
            <div class="progress-header">
                <span>Discovery Progress</span>
                <span class="progress-percentage" id="progressPercent">0%</span>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 0%"></div>
            </div>
            <div class="progress-steps-mini">
                <span class="step-mini active" onclick="loadJourneyStep('introduction')">Intro</span>
                <span class="step-mini" onclick="loadJourneyStep('chromosomes')">Chromo</span>
                <span class="step-mini" onclick="loadJourneyStep('gametes')">Gametes</span>
                <span class="step-mini" onclick="loadJourneyStep('fertilization')">Fertilize</span>
                <span class="step-mini" onclick="loadJourneyStep('xy_system')">XY</span>
                <span class="step-mini" onclick="loadJourneyStep('cross_diagram')">Cross</span>
                <span class="step-mini" onclick="loadJourneyStep('variations')">Variations</span>
            </div>
        </div>

        <div class="info-content" id="mainDescription">
            Sex determination is one of biology's most fascinating processes. In humans, biological sex is determined by a pair of special chromosomes called sex chromosomes. This incredible system ensures roughly equal numbers of males and females in the population through a precise genetic mechanism.
        </div>

        <div class="info-card">
            <div class="info-card-title">
                <span>🔬</span> Key Concepts
            </div>
            <div class="info-card-content">
                <ul class="info-list" id="keyConcepts">
                    <li>Sex chromosomes determine biological sex</li>
                    <li>Human males are XY, females are XX</li>
                    <li>Equal probability for male and female offspring</li>
                    <li>Different mechanisms exist across species</li>
                </ul>
            </div>
        </div>

        <div class="fun-fact">
            <div class="fun-fact-title">Amazing Fact!</div>
            <div class="fun-fact-text" id="funFact">
                The Y chromosome is the smallest human chromosome with only about 58 million DNA building blocks, while the X chromosome has about 155 million!
            </div>
        </div>

        <div class="info-card">
            <div class="info-card-title">
                <span>🎯</span> Learning Objectives
            </div>
            <div class="info-card-content" id="learningObjectives">
                Understand how chromosomes determine sex, explore the inheritance patterns, and discover how this system evolved across different species.
            </div>
        </div>
    </div>

    <!-- Voice Controls -->
    <div class="voice-controls">
        <button class="control-btn active" id="voiceToggle" onclick="toggleVoice()">
            🔊
            <span class="control-tooltip">Voice Narration</span>
        </button>
        <button class="control-btn" onclick="toggleAutoPlay()">
            ▶️
            <span class="control-tooltip">Auto Journey</span>
        </button>
        <button class="control-btn" onclick="toggleInfo()">
            ℹ️
            <span class="control-tooltip">Toggle Info</span>
        </button>
    </div>

    <!-- Quick Actions -->
    <div class="quick-actions">
        <button class="action-btn" onclick="startGuidedTour()">
            <span>🚀</span> Guided Tour
        </button>
        <button class="action-btn" onclick="showQuiz()">
            <span>🎯</span> Test Knowledge
        </button>
    </div>

    <!-- Voice Indicator -->
    <div class="voice-indicator" id="voiceIndicator">
        <div class="voice-waves">
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
        </div>
        <div class="narration-text" id="narrationText">Narrating...</div>
    </div>

    <script>
        // Journey Step Data with Complete Pedagogical Content
        const JOURNEY_DATA = {
            introduction: {
                title: "Welcome to Sex Determination",
                subtitle: "The genetic basis of biological sex",
                icon: "🌟",
                modelUrl: "https://sketchfab.com/models/cc33bb1ebe6141b08d0d06f1bbebc2b7/embed?autostart=1&internal=1&tracking=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_watermark=0",
                description: "Sex determination is one of biology's most fascinating processes. In humans, biological sex is determined by a pair of special chromosomes called sex chromosomes. This incredible system ensures roughly equal numbers of males and females in the population through a precise genetic mechanism.",
                concepts: [
                    "Sex chromosomes determine biological sex",
                    "Human males are XY, females are XX",
                    "Equal probability for male and female offspring",
                    "Different mechanisms exist across species"
                ],
                funFact: "The Y chromosome is the smallest human chromosome with only about 58 million DNA building blocks, while the X chromosome has about 155 million!",
                objectives: "Understand how chromosomes determine sex, explore the inheritance patterns, and discover how this system evolved across different species.",
                narration: "Welcome to the fascinating world of sex determination! You're looking at the structure of chromosomes - the thread-like structures that carry our genetic information. In humans, we have 23 pairs of chromosomes, and one very special pair determines whether a baby develops as male or female. This isn't just random chance - it's a precisely controlled genetic system that has evolved over millions of years. Throughout this journey, we'll explore how two tiny chromosomes called X and Y control one of the most fundamental aspects of life on Earth!"
            },
            chromosomes: {
                title: "Chromosome Structure",
                subtitle: "The carriers of genetic information",
                icon: "📚",
                modelUrl: "https://sketchfab.com/models/cc33bb1ebe6141b08d0d06f1bbebc2b7/embed?autostart=1&internal=1&tracking=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_watermark=0",
                description: "Chromosomes are tightly packed bundles of DNA and proteins found in the nucleus of every cell. They carry the instructions for life, including the genes that determine sex. In humans, chromosomes come in pairs, with one from each parent.",
                concepts: [
                    "23 pairs of chromosomes in human cells",
                    "22 pairs of autosomes + 1 pair of sex chromosomes",
                    "DNA wraps around histone proteins",
                    "Contains thousands of genes"
                ],
                funFact: "If you stretched out all the DNA in a single human cell, it would be about 6 feet long, but it's packed into a nucleus that's only 0.0002 inches across!",
                objectives: "Learn about chromosome structure and understand how genetic material is organized within cells.",
                narration: "Here we see the intricate structure of a chromosome! This X-shaped structure is actually two identical copies of DNA joined at the center by a region called the centromere. The DNA is tightly wound around proteins called histones, like thread wrapped around spools. This incredible packaging allows six feet of DNA to fit inside a cell nucleus that's smaller than the period at the end of this sentence! Each chromosome contains hundreds to thousands of genes - the instruction manuals for making proteins. Among these genes are special ones that control sex determination, making chromosomes the ultimate library of life!"
            },
            gametes: {
                title: "Gametes - Egg and Sperm Cells",
                subtitle: "The reproductive cells",
                icon: "🥚",
                modelUrl: "https://sketchfab.com/models/21c19e1b34dd4e4d9cfefa5c8163e8c6/embed?autostart=1&internal=1&tracking=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_watermark=0",
                description: "Gametes are special reproductive cells that carry only half the genetic material of regular body cells. Human egg cells always carry an X chromosome, while sperm cells carry either an X or Y chromosome - this is what determines the sex of offspring.",
                concepts: [
                    "Egg cells (ova) always have 22 + X chromosomes",
                    "Sperm cells have 22 + X or 22 + Y chromosomes",
                    "Produced through meiosis cell division",
                    "Each gamete is genetically unique"
                ],
                funFact: "A human egg cell is about the size of a grain of sand and is visible to the naked eye - it's the largest cell in the human body!",
                objectives: "Understand how gametes carry sex chromosomes and their role in determining offspring sex.",
                narration: "Behold the human egg cell - nature's ultimate treasure chest! This massive cell, about 0.1 millimeters across, is packed with nutrients and cellular machinery needed to support early development. Most importantly for sex determination, every egg cell carries exactly one X chromosome. The egg cell's job is to wait patiently for fertilization. When we look at sperm cells next, you'll see they're completely different - much smaller and faster, carrying either an X or Y chromosome. This difference in sex chromosome content between sperm cells is the key to sex determination. The egg doesn't choose - it's the sperm that determines whether the baby will be male or female!"
            },
            sperm: {
                title: "Sperm Cells - The Chromosome Carriers",
                subtitle: "Determining the sex of offspring",
                icon: "🏊",
                modelUrl: "https://sketchfab.com/models/267dc672834749b5b332d23ee013a00a/embed?autostart=1&internal=1&tracking=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_watermark=0",
                description: "Sperm cells are highly specialized for one purpose: delivering genetic material to the egg. About half carry an X chromosome and half carry a Y chromosome, making them the determining factor in offspring sex.",
                concepts: [
                    "50% carry X chromosome, 50% carry Y chromosome",
                    "Streamlined for swimming to the egg",
                    "Head contains tightly packed DNA",
                    "Tail provides propulsion"
                ],
                funFact: "Sperm cells can swim at speeds of up to 5 millimeters per minute - that may not sound fast, but relative to their size, it's like a human swimming at 2,000 mph!",
                objectives: "Explore sperm cell structure and understand their crucial role as the sex-determining gamete.",
                narration: "Here's the remarkable sperm cell - evolution's perfect delivery vehicle! Look at this streamlined design: a compact head containing tightly packed DNA, a midpiece full of energy-producing mitochondria, and a long tail that acts like a propeller. The head is where the magic happens for sex determination. Inside that tiny space are 23 chromosomes, including either an X or a Y sex chromosome. When millions of sperm are released, roughly half carry an X chromosome and half carry a Y. It's like a genetic coin flip happening at the cellular level! The sperm that reaches the egg first will determine the baby's sex - X for female, Y for male. This remarkable cell can survive for several days in the female reproductive tract, swimming tirelessly toward its destination."
            },
            fertilization: {
                title: "Fertilization - The Moment of Determination",
                subtitle: "When sex is decided",
                icon: "✨",
                modelUrl: "https://sketchfab.com/models/3bcbe06b08c444cc868d525d79d8ee4b/embed?autostart=1&internal=1&tracking=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "Fertilization is the moment when sperm and egg unite, combining their genetic material. The sex chromosome carried by the successful sperm determines whether the resulting embryo will develop as male or female.",
                concepts: [
                    "Sperm penetrates egg cell membrane",
                    "Genetic material combines",
                    "Sex determined at moment of fertilization",
                    "Either XX (female) or XY (male) is formed"
                ],
                funFact: "The moment a sperm penetrates an egg, the egg immediately changes its surface to prevent any other sperm from entering - it's like slamming the door shut!",
                objectives: "Witness the critical moment when sex is determined and understand the cellular events of fertilization.",
                narration: "Welcome to one of life's most crucial moments - fertilization! You're witnessing the exact instant when biological sex is determined. As the sperm approaches the egg, its head releases enzymes that help it penetrate the egg's protective coating. The moment the sperm makes contact and enters, the egg's surface immediately hardens to prevent other sperm from entering. Inside, the genetic material from both parents combines for the first time. The egg contributes its X chromosome, while the sperm contributes either an X or Y chromosome. If it's an X, the combination XX will develop into a female. If it's a Y, the combination XY will develop into a male. This single moment determines not just sex, but activates an entire cascade of genetic programs that will unfold over the next nine months of development."
            },
            xy_system: {
                title: "The XY Sex Determination System",
                subtitle: "How X and Y chromosomes work",
                icon: "🧬",
                modelUrl: "https://sketchfab.com/3d-models/chromosomes-7af1742648964bd19378999df13a384b/embed?autostart=1&internal=1&tracking=0&ui_ar=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "The XY system is the mechanism humans use for sex determination. Females have two X chromosomes (XX), while males have one X and one Y chromosome (XY). The Y chromosome carries the master switch gene that triggers male development.",
                concepts: [
                    "XX = female, XY = male",
                    "Y chromosome triggers male development",
                    "SRY gene is the 'master switch'",
                    "X chromosome carries many essential genes"
                ],
                funFact: "The SRY gene on the Y chromosome is only about 827 DNA letters long, yet this tiny stretch of genetic code is responsible for triggering all of male development!",
                objectives: "Understand how the XY system works and learn about the key genes involved in sex determination.",
                narration: "Here we see the X and Y chromosomes that make sex determination possible! The X chromosome is large and gene-rich, carrying over 1,000 genes that are essential for both males and females. The Y chromosome is much smaller but carries one critically important gene called SRY - the Sex-determining Region Y. When present, SRY acts like a master switch, turning on a cascade of male development genes. Without SRY, the default developmental pathway leads to female characteristics. This is why we say that female is the 'default' sex in mammals - you need the Y chromosome's special signal to develop as male. The beauty of this system is its simplicity: one small gene makes all the difference between male and female development!"
            },
            karyotype: {
                title: "Human Karyotypes - The Complete Picture",
                subtitle: "Visualizing chromosome pairs",
                icon: "📋",
                modelUrl: "https://sketchfab.com/models/caec92fcc43d4098888c981975558667/embed?autostart=1&internal=1&tracking=0&ui_ar=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "A karyotype is a picture of all the chromosomes in a cell, arranged in pairs by size and shape. This view clearly shows the difference between male (XY) and female (XX) chromosome sets, making sex determination visible at the genetic level.",
                concepts: [
                    "22 pairs of autosomes in both sexes",
                    "Sex chromosomes are the 23rd pair",
                    "Used to diagnose chromosomal disorders",
                    "Shows the complete genetic blueprint"
                ],
                funFact: "Creating a karyotype involves photographing chromosomes under a microscope and then cutting and pasting them into order - it's like making a genetic jigsaw puzzle!",
                objectives: "Learn to read karyotypes and understand how they reveal sex determination and genetic abnormalities.",
                narration: "This is a human karyotype - a complete inventory of all chromosomes in a cell! You're looking at the 46 chromosomes arranged in their 23 pairs, numbered from largest to smallest. Pairs 1 through 22 are called autosomes and are the same in both males and females. But look at pair 23 - the sex chromosomes! In a female karyotype, you'd see two X chromosomes that look nearly identical. In a male karyotype like this one, you see one large X chromosome and one much smaller Y chromosome. This visual difference makes sex determination clearly visible. Scientists use karyotypes to diagnose chromosomal conditions and understand genetic variations. It's remarkable that such a simple difference - the size and gene content of one chromosome pair - determines such a fundamental aspect of biology!"
            },
            cross_diagram: {
                title: "Inheritance Cross - Predicting Offspring",
                subtitle: "The genetics of sex determination",
                icon: "📊",
                modelUrl: "https://sketchfab.com/3d-models/chromosome-bd426b178dcb4dde8045f53128b5c376/embed?autostart=1&internal=1&tracking=0&ui_ar=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "A genetic cross diagram shows how sex chromosomes are inherited from parents to offspring. This simple model explains why there's always approximately a 50% chance of having a male or female baby with each pregnancy.",
                concepts: [
                    "Female parent: XX (produces only X gametes)",
                    "Male parent: XY (produces X and Y gametes)",
                    "50% chance of XX offspring (female)",
                    "50% chance of XY offspring (male)"
                ],
                funFact: "Despite the 50-50 probability, slightly more boys are born than girls worldwide - about 105 boys for every 100 girls, though scientists aren't entirely sure why!",
                objectives: "Learn to create and interpret genetic crosses for sex determination and understand probability in inheritance.",
                narration: "Let's work through the genetics of sex determination with a classic inheritance cross! Imagine we have a female parent with XX chromosomes and a male parent with XY chromosomes. When they produce gametes through meiosis, the female can only contribute X chromosomes - she has no choice! But the male produces two types of sperm: half carrying X chromosomes and half carrying Y chromosomes. When fertilization occurs, there are only two possible outcomes: X from mom plus X from dad equals XX - a female baby. Or X from mom plus Y from dad equals XY - a male baby. Since the male produces equal numbers of X and Y sperm, each pregnancy has exactly a 50% chance of producing a boy and 50% chance of producing a girl. This is why sex ratios stay roughly balanced in populations - it's basic probability at work!"
            },
            variations: {
                title: "Sex Determination Across Species",
                subtitle: "Nature's diverse solutions",
                icon: "🌍",
                modelUrl: "https://sketchfab.com/models/fff76f2ecadf4fe18eb40290938a5404/embed?autostart=1&internal=1&tracking=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_watermark=0",
                description: "While humans use the XY system, nature has evolved many different ways to determine sex. Some species use environmental factors like temperature, others have completely different chromosome systems, and some can even change sex during their lifetime!",
                concepts: [
                    "XY system (mammals): males XY, females XX",
                    "ZW system (birds): males ZZ, females ZW", 
                    "Temperature-dependent (reptiles): heat determines sex",
                    "Sequential hermaphroditism (some fish): can change sex"
                ],
                funFact: "In some reptiles, if eggs develop at 30°C they become female, but at 32°C they become male - just 2 degrees can completely change an animal's sex!",
                objectives: "Explore the diversity of sex determination mechanisms and understand why different systems evolved.",
                narration: "The world of sex determination is far more diverse than the human XY system! Let's take a tour of nature's creativity. Birds use a ZW system that's the reverse of mammals - males are ZZ and females are ZW. Many reptiles don't use chromosomes at all - instead, the temperature during egg incubation determines sex. Imagine if human babies' sex depended on the weather! Some fish are even more flexible - they can actually change sex during their lifetime based on social conditions. Clownfish, for example, can switch from male to female if the dominant female in their group dies. Even more amazingly, some animals like certain lizard species are all female and reproduce without males at all! These different systems show us that sex determination isn't just one solution - it's an evolutionary buffet of strategies, each perfectly adapted to its species' lifestyle and environment."
            }
        };

        // Global Variables
        let currentStep = 'introduction';
        let voiceEnabled = true;
        let autoPlayEnabled = false;
        let currentSpeech = null;
        let selectedVoice = null;
        let journeyProgress = 0;
        let guidedTourActive = false;

        // Initialize Voice System
        function initVoiceSystem() {
            if (!('speechSynthesis' in window)) {
                console.warn('Speech synthesis not supported');
                voiceEnabled = false;
                document.getElementById('voiceToggle').style.display = 'none';
                return;
            }

            function loadVoices() {
                const voices = speechSynthesis.getVoices();
                if (voices.length === 0) return;

                // Prefer natural-sounding voices
                const preferredVoices = [
                    'Google UK English Female',
                    'Microsoft Sonia',
                    'Microsoft Hazel',
                    'Samantha',
                    'Victoria'
                ];

                for (const name of preferredVoices) {
                    selectedVoice = voices.find(v => v.name.includes(name));
                    if (selectedVoice) break;
                }

                if (!selectedVoice) {
                    selectedVoice = voices.find(v => v.lang.startsWith('en'));
                }
            }

            loadVoices();
            if (speechSynthesis.onvoiceschanged !== undefined) {
                speechSynthesis.onvoiceschanged = loadVoices;
            }
        }

        // Load Journey Step
        function loadJourneyStep(stepId) {
            const stepData = JOURNEY_DATA[stepId];
            if (!stepData) return;

            currentStep = stepId;
            
            // Update model
            document.getElementById('api-frame').src = stepData.modelUrl;
            
            // Update info panel
            document.getElementById('stepIcon').textContent = stepData.icon;
            document.getElementById('stepTitle').textContent = stepData.title;
            document.getElementById('stepSubtitle').textContent = stepData.subtitle;
            document.getElementById('mainDescription').textContent = stepData.description;
            
            // Update key concepts
            const conceptsList = document.getElementById('keyConcepts');
            conceptsList.innerHTML = stepData.concepts.map(c => `<li>${c}</li>`).join('');
            
            // Update fun fact
            document.getElementById('funFact').textContent = stepData.funFact;
            
            // Update learning objectives
            document.getElementById('learningObjectives').textContent = stepData.objectives;
            
            // Update navigation buttons
            updateNavigationButtons(stepId);
            
            // Update progress
            updateProgress();
            
            // Play narration if enabled
            if (voiceEnabled) {
                speakText(stepData.narration);
            }
        }

        // Update Navigation Buttons
        function updateNavigationButtons(activeStep) {
            const buttons = document.querySelectorAll('.journey-btn');
            const steps = ['introduction', 'chromosomes', 'gametes', 'fertilization', 'xy_system', 'cross_diagram', 'variations'];
            const activeIndex = steps.indexOf(activeStep);
            
            buttons.forEach((btn, index) => {
                btn.classList.remove('active', 'completed');
                if (index < activeIndex) {
                    btn.classList.add('completed');
                } else if (index === activeIndex) {
                    btn.classList.add('active');
                }
            });
            
            // Update mini steps
            const miniSteps = document.querySelectorAll('.step-mini');
            miniSteps.forEach((step, index) => {
                step.classList.remove('active', 'completed');
                if (index < activeIndex) {
                    step.classList.add('completed');
                } else if (index === activeIndex) {
                    step.classList.add('active');
                }
            });
        }

        // Update Progress
        function updateProgress() {
            const steps = ['introduction', 'chromosomes', 'gametes', 'fertilization', 'xy_system', 'cross_diagram', 'variations'];
            const currentIndex = steps.indexOf(currentStep);
            const progress = ((currentIndex + 1) / steps.length) * 100;
            
            document.getElementById('progressPercent').textContent = Math.round(progress) + '%';
            document.getElementById('progressFill').style.width = progress + '%';
        }

        // Speech Functions
        function speakText(text) {
            if (!voiceEnabled || !text) return;
            
            stopSpeech();
            
            currentSpeech = new SpeechSynthesisUtterance(text);
            if (selectedVoice) {
                currentSpeech.voice = selectedVoice;
            }
            currentSpeech.rate = 0.9;
            currentSpeech.pitch = 1.0;
            currentSpeech.volume = 0.9;
            
            currentSpeech.onstart = () => {
                document.getElementById('voiceIndicator').classList.add('visible');
                document.getElementById('narrationText').textContent = 
                    text.substring(0, 50) + (text.length > 50 ? '...' : '');
            };
            
            currentSpeech.onend = () => {
                document.getElementById('voiceIndicator').classList.remove('visible');
                currentSpeech = null;
                
                // Auto-advance if guided tour is active
                if (guidedTourActive) {
                    setTimeout(nextStep, 2000);
                }
            };
            
            speechSynthesis.speak(currentSpeech);
        }

        function stopSpeech() {
            if (currentSpeech) {
                speechSynthesis.cancel();
                currentSpeech = null;
                document.getElementById('voiceIndicator').classList.remove('visible');
            }
        }

        // Control Functions
        function toggleVoice() {
            voiceEnabled = !voiceEnabled;
            const btn = document.getElementById('voiceToggle');
            btn.textContent = voiceEnabled ? '🔊' : '🔇';
            btn.classList.toggle('active', voiceEnabled);
            
            if (!voiceEnabled) {
                stopSpeech();
            }
        }

        function toggleAutoPlay() {
            autoPlayEnabled = !autoPlayEnabled;
            if (autoPlayEnabled) {
                startGuidedTour();
            } else {
                guidedTourActive = false;
            }
        }

        function toggleInfo() {
            const panel = document.getElementById('infoPanel');
            panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
        }

        // Guided Tour
        function startGuidedTour() {
            guidedTourActive = true;
            const steps = ['introduction', 'chromosomes', 'gametes', 'sperm', 'fertilization', 'xy_system', 'karyotype', 'cross_diagram', 'variations'];
            let stepIndex = 0;
            
            function tourStep() {
                if (stepIndex < steps.length && guidedTourActive) {
                    loadJourneyStep(steps[stepIndex]);
                    stepIndex++;
                } else {
                    guidedTourActive = false;
                    if (voiceEnabled) {
                        speakText("Congratulations! You've completed your journey through sex determination in humans. You now understand how chromosomes determine biological sex and how this system compares to other species. Feel free to explore any section again or test your knowledge!");
                    }
                }
            }
            
            tourStep();
            window.nextStep = tourStep;
        }

        // Quiz Function
        function showQuiz() {
            const questions = [
                "What chromosomes do human males have?",
                "Which parent determines the sex of offspring?",
                "What is the SRY gene responsible for?",
                "Why is the sex ratio approximately 50:50?",
                "How do birds' sex chromosomes differ from mammals?"
            ];
            
            const randomQ = questions[Math.floor(Math.random() * questions.length)];
            
            if (voiceEnabled) {
                speakText(`Here's a genetics question to test your knowledge: ${randomQ} Think about what you've learned about sex determination!`);
            }
        }

        // Initialize
        function init() {
            initVoiceSystem();
            
            // Hide loading screen
            setTimeout(() => {
                const loading = document.getElementById('loadingOverlay');
                loading.style.opacity = '0';
                setTimeout(() => {
                    loading.style.display = 'none';
                    
                    // Welcome message
                    if (voiceEnabled) {
                        speakText("Welcome to your journey through sex determination in humans! We'll explore how chromosomes determine biological sex, starting with the basic structure of these remarkable genetic libraries. Let's begin!");
                    }
                }, 1000);
            }, 3000);
            
            // Keyboard shortcuts
            document.addEventListener('keydown', (e) => {
                switch(e.key) {
                    case 'v': toggleVoice(); break;
                    case 'i': toggleInfo(); break;
                    case 'g': startGuidedTour(); break;
                    case 'Escape': stopSpeech(); guidedTourActive = false; break;
                    case 'ArrowRight': nextStep && nextStep(); break;
                }
            });
        }

        // Start the application
        init();
    </script>
</body>
</html>