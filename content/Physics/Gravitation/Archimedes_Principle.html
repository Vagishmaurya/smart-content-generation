<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Archimedes' Principle - Physics in Motion</title>
    <!-- GSAP for animations -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0c4a6e 0%, #075985 50%, #0369a1 100%);
            color: white;
            overflow-x: hidden;
            min-height: 100vh;
        }

        /* Audio Control */
        #audio-control {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
        }

        .control-btn {
            background: rgba(14, 165, 233, 0.9);
            border: none;
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .control-btn:hover {
            transform: scale(1.1);
            background: rgba(14, 165, 233, 1);
        }

        .control-btn.muted .unmute-icon { display: none; }
        .control-btn:not(.muted) .mute-icon { display: none; }

        /* Main Container */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 30px 20px;
        }

        /* Header */
        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .header h1 {
            font-size: 3rem;
            background: linear-gradient(45deg, #0ea5e9, #38bdf8, #7dd3fc);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 15px;
            font-weight: 700;
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.95;
            max-width: 800px;
            margin: 0 auto;
            line-height: 1.6;
        }

        /* Demo Stage */
        .demo-stage {
            background: linear-gradient(to bottom, #1e293b, #334155, #475569);
            border-radius: 25px;
            min-height: 500px;
            position: relative;
            margin: 40px 0;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
            overflow: hidden;
            border: 3px solid rgba(14, 165, 233, 0.4);
            padding: 40px;
        }

        /* Activity 9.7 Demo */
        .activity-demo {
            display: none;
            position: relative;
            width: 100%;
            height: 500px;
        }

        .activity-demo.active {
            display: block;
        }

        .experiment-container {
            display: flex;
            justify-content: space-around;
            align-items: flex-start;
            height: 100%;
            padding: 20px 0;
        }

        .experiment-setup {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            width: 300px;
            height: 450px;
        }

        .setup-label {
            background: rgba(14, 165, 233, 0.2);
            padding: 10px 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            font-weight: 600;
            border: 2px solid rgba(14, 165, 233, 0.4);
        }

        /* Spring Balance */
        .spring-balance {
            position: relative;
            width: 60px;
            height: 140px; /* Increased height to accommodate spring */
            background: linear-gradient(to bottom, #64748b, #475569);
            border-radius: 8px;
            border: 2px solid #334155;
            margin-bottom: 10px;
        }

        .balance-display {
            position: absolute;
            top: 15px;
            left: 50%;
            transform: translateX(-50%);
            background: #1e293b;
            color: #0ea5e9;
            padding: 5px 8px;
            border-radius: 5px;
            font-size: 0.8rem;
            font-weight: bold;
            border: 1px solid #0ea5e9;
            z-index: 15; /* Ensure it's always on top */
        }

        .balance-hook {
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 8px;
            height: 20px;
            background: #94a3b8;
            border-radius: 4px;
        }
        
        /* Spring inside balance */
        .spring {
            position: absolute;
            bottom: 10px; /* Positioned much lower to avoid any overlap with reading */
            left: 50%;
            transform: translateX(-50%);
            width: 20px;
            height: 30px; /* Made slightly shorter to fit better */
        }
        
        /* Regular spring for water setup - less stretched */
        #spring-water {
            background-image: repeating-linear-gradient(180deg, 
                #94a3b8 0px, 
                #94a3b8 2px, 
                transparent 2px, 
                transparent 6px);
            border: 1px solid transparent;
        }
        
        /* Stretched spring for air setup - more stretched */
        #spring-air {
            background-image: repeating-linear-gradient(180deg, 
                #94a3b8 0px, 
                #94a3b8 2px, 
                transparent 2px, 
                transparent 9px);
            border: 1px solid transparent;
        }

        /* String */
        .string {
            position: absolute;
            top: 150px; /* Adjusted to match the taller spring balance */
            left: 50%;
            transform: translateX(-50%);
            width: 3px;
            background: #fbbf24;
            border-radius: 2px;
            transform-origin: top center;
            transition: height 0.8s ease;
            z-index: 5;
        }

        .string-air {
            height: 80px;
        }

        .string-water {
            height: 150px;
        }

        /* Stone */
        .stone {
            position: absolute;
            width: 40px;
            height: 35px;
            background: linear-gradient(135deg, #6b7280, #4b5563);
            border-radius: 8px;
            left: 50%;
            transform: translateX(-50%);
            transition: all 0.8s ease;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            z-index: 10;
        }

        .stone-air {
            top: 210px;
        }

        /* Stone in water - used as the final position */
        .stone-water {
            top: 280px;
            z-index: 5;
        }
        
        /* Transitional stone for animation - exact copy of stone-air initially */
        #stone-transitional {
            top: 210px;
            opacity: 0; /* Hidden initially */
            z-index: 15;
        }

        /* Water Container */
        .water-container {
            position: absolute;
            top: 200px;
            left: 50%;
            transform: translateX(-50%);
            width: 200px;
            height: 150px;
            background: transparent;
            border: 4px solid #0ea5e9;
            border-radius: 10px;
            overflow: visible;
            z-index: 1;
        }

        .water-level {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 70%;
            background: linear-gradient(to bottom, rgba(14, 165, 233, 0.4), rgba(14, 165, 233, 0.8));
            animation: waterRipple 2s ease-in-out infinite;
            border-bottom-left-radius: 6px;
            border-bottom-right-radius: 6px;
        }

        @keyframes waterRipple {
            0%, 100% { 
                transform: scaleY(1) scaleX(1); 
                filter: hue-rotate(0deg);
            }
            50% { 
                transform: scaleY(1.02) scaleX(1.01); 
                filter: hue-rotate(10deg);
            }
        }

        /* Force Arrows */
        .force-arrow {
            position: absolute;
            opacity: 0;
            transition: all 0.5s ease;
            z-index: 10;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .force-arrow.visible {
            opacity: 1;
        }

        .arrow-line {
            background-color: currentColor;
            width: 4px;
            transform-origin: center;
        }

        .arrow-head {
            width: 0;
            height: 0;
            border-left: 8px solid transparent;
            border-right: 8px solid transparent;
        }

        .arrow-label {
            font-size: 11px;
            font-weight: bold;
            text-align: center;
            margin-top: 5px;
            text-shadow: 0 0 3px rgba(0, 0, 0, 0.5);
            white-space: nowrap;
        }

        /* Weight arrows (pointing down) */
        .weight-arrow {
            color: #ef4444;
        }
        
        /* Position specific to each setup */
        #weight-air {
            top: 260px; /* Below stone-air */
        }
        
        #weight-water {
            top: 330px; /* Below stone-water */
        }

        /* Position the force arrows directly below the stone */
        .experiment-setup .force-arrow {
            left: 50%;
            transform: translateX(-50%);
        }

        .weight-arrow .arrow-line {
            height: 50px; /* Standard size for 5.0N */
            order: 1;
        }

        .weight-arrow .arrow-head {
            border-top: 12px solid #ef4444;
            order: 2;
        }

        .weight-arrow .arrow-label {
            order: 0;
            margin-bottom: 5px;
            margin-top: 0;
        }

        /* Buoyant arrow (pointing up) */
        .buoyant-arrow {
            color: #10b981;
            top: 400px; /* Further position below weight arrow for better separation */
            left: 50%; /* Center it below stone */
        }

        .buoyant-arrow .arrow-line {
            height: 30px; /* Smaller size for 1.8N force (about 36% of weight) */
            order: 1;
        }

        .buoyant-arrow .arrow-head {
            border-bottom: 10px solid #10b981;
            order: 0;
        }

        .buoyant-arrow .arrow-label {
            order: 2;
            margin-top: 5px;
        }

        /* Principle Explanation Demo */
        .principle-demo {
            display: none;
            padding: 30px;
            text-align: center;
        }

        .principle-demo.active {
            display: block;
        }

        .principle-container {
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 40px 0;
            position: relative;
            gap: 80px;
        }

        .fluid-container {
            position: relative;
            width: 280px;
            height: 360px;
            background: linear-gradient(to bottom, #1e3a8a, #1e40af);
            border: 3px solid #0ea5e9;
            border-radius: 15px;
            overflow: hidden;
            z-index: 5;
        }
        
        /* Water area in blue */
        .water-area {
            position: absolute;
            top: 110px;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(to bottom, #0c4a6e, #0369a1);
            z-index: 1;
            transition: all 0.8s ease;
        }
        
        /* This is the risen water level that will appear above original level */
        .water-rise {
            position: absolute;
            width: 100%;
            height: 0; /* Start with 0 height */
            top: 110px; /* Same as original water level */
            transform: translateY(-100%); /* Position it above the water level */
            background: linear-gradient(to bottom, #0c4a6e, #0369a1);
            z-index: 1;
            transition: height 0.8s ease;
        }
        
        .water-surface {
            position: absolute;
            width: 100%;
            height: 4px;
            top: 110px;
            background: rgba(56, 189, 248, 0.8);
            z-index: 5;
            border-radius: 2px;
            transition: top 0.8s ease;
        }
        
        .water-level-marker {
            display: none; /* Simplified by removing these */
        }
        
        .water-level-text {
            display: none; /* Simplified by removing these */
        }

        .displaced-fluid {
            position: absolute;
            top: 110px; /* Start at water surface */
            left: 0;
            right: 0;
            background: linear-gradient(to bottom, rgba(16, 185, 129, 0.5), rgba(16, 185, 129, 0.8));
            border-top: 2px solid #10b981;
            border-bottom: 2px solid #10b981;
            height: 0;
            transition: height 0.8s ease;
            z-index: 2;
            box-shadow: 0 0 15px rgba(16, 185, 129, 0.5);
            animation: displacedGlow 2s ease-in-out infinite alternate;
        }
        
        @keyframes displacedGlow {
            from { box-shadow: 0 0 10px rgba(16, 185, 129, 0.4); }
            to { box-shadow: 0 0 20px rgba(16, 185, 129, 0.7); }
        }
        
        .displaced-volume-label {
            position: absolute;
            top: 120px;
            right: 55%;
            background: rgba(0, 0, 0, 0.9);
            color: #10b981;
            padding: 12px 20px;
            border-radius: 10px;
            font-size: 18px;
            font-weight: bold;
            opacity: 0;
            z-index: 20; /* Higher z-index to appear above everything */
            border: 2px solid rgba(16, 185, 129, 0.7);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.6);
            width: fit-content;
            white-space: nowrap;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
        }

        .immersed-object {
            position: absolute;
            width: 90px;
            height: 90px;
            background: #f59e0b;
            border: 3px solid #92400e;
            border-radius: 10px;
            left: 50%;
            transform: translateX(-50%);
            transition: all 1s ease;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
            z-index: 10;
        }
        
        .object-label {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-weight: bold;
            font-size: 16px;
            text-shadow: 0 0 3px rgba(0, 0, 0, 0.8);
        }

        .object-above {
            top: 20px;
        }

        .object-immersed {
            top: 160px;
        }
        
        /* Force vectors for principle demo */
        .principle-force-arrow {
            position: relative;
            opacity: 0;
            z-index: 10;
            pointer-events: none;
            width: 80px;
            height: 200px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        
        .principle-arrow-line {
            position: relative;
            width: 6px;
            background-color: currentColor;
            transform-origin: center;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.3);
        }
        
        .principle-arrow-head {
            position: relative;
            width: 0;
            height: 0;
            border-left: 12px solid transparent;
            border-right: 12px solid transparent;
            filter: drop-shadow(0 0 2px rgba(0, 0, 0, 0.3));
        }
        
        .principle-arrow-label {
            position: relative;
            font-size: 16px;
            font-weight: bold;
            text-align: center;
            white-space: nowrap;
            background: rgba(0, 0, 0, 0.8);
            padding: 8px 12px;
            border-radius: 6px;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.4);
            margin-top: 10px;
            width: 100%;
        }
        
        /* Weight vector (pointing down) */
        .principle-weight-arrow {
            color: #ef4444;
            margin-top: 60px; /* Align with the center of the block */
        }
        
        .principle-weight-arrow .principle-arrow-line {
            height: 60px;
            margin-top: 10px;
        }
        
        .principle-weight-arrow .principle-arrow-head {
            border-top: 14px solid #ef4444;
            margin-top: -1px;
        }
        
        .principle-weight-arrow .principle-arrow-label {
            border: 1px solid rgba(239, 68, 68, 0.4);
            order: -1; /* Place label above the arrow */
            margin-bottom: 10px;
            margin-top: 0;
        }
        
        /* Buoyant vector (pointing up) */
        .principle-buoyant-arrow {
            color: #10b981;
            margin-top: 60px; /* Align with the center of the block */
            display: flex;
            flex-direction: column; /* Normal order - arrowhead at top, label at bottom */
            align-items: center;
        }
        
        .principle-buoyant-arrow .principle-arrow-label {
            border: 2px solid rgba(16, 185, 129, 0.6);
            margin-top: 15px;
            order: 3; /* Label comes last (at bottom) */
            background: rgba(0, 0, 0, 0.9);
            padding: 10px 15px;
            width: auto;
            min-width: 120px;
            text-align: center;
        }
        
        .principle-buoyant-arrow .principle-arrow-head {
            border-bottom: 14px solid #10b981; /* Point downward for visual */
            margin-top: -1px; /* Connect with the line */
            order: 1; /* Arrow head comes first (at top) */
        }
        
        .principle-buoyant-arrow .principle-arrow-line {
            height: 0; /* Starts at 0, will grow during animation */
            transform-origin: top center;
            order: 2; /* Line comes in the middle */
            margin-top: 0;
        }

        /* Applications Demo */
        .applications-demo {
            display: none;
            padding: 20px;
        }

        .applications-demo.active {
            display: block;
        }

        .applications-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .application-card {
            background: rgba(14, 165, 233, 0.1);
            padding: 25px;
            border-radius: 15px;
            border: 2px solid rgba(14, 165, 233, 0.3);
            text-align: center;
            transition: all 0.3s ease;
        }

        .application-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(14, 165, 233, 0.3);
        }

        .app-icon {
            font-size: 3rem;
            margin-bottom: 15px;
        }

        .app-title {
            color: #0ea5e9;
            font-size: 1.3rem;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .app-description {
            line-height: 1.6;
            opacity: 0.9;
        }

        /* Questions Demo */
        .questions-demo {
            display: none;
            padding: 30px;
        }

        .questions-demo.active {
            display: block;
        }

        .question-card {
            background: rgba(0, 0, 0, 0.3);
            padding: 25px;
            border-radius: 15px;
            margin: 20px 0;
            border-left: 4px solid #0ea5e9;
            display: none; /* Hide all questions by default */
        }

        .question-card.active {
            display: block; /* Show only active question */
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .question-number {
            color: #0ea5e9;
            font-weight: bold;
            font-size: 1.2rem;
            margin-bottom: 10px;
        }

        .question-text {
            font-size: 1.1rem;
            line-height: 1.6;
            margin-bottom: 15px;
        }

        .answer-section {
            background: rgba(16, 185, 129, 0.1);
            padding: 15px;
            margin-top: 5px;
            border-radius: 10px;
            border: 1px solid rgba(16, 185, 129, 0.3);
            opacity: 0;
            transform: translateY(-10px);
            transition: all 0.5s ease;
        }

        .answer-section.show {
            opacity: 1;
            transform: translateY(0);
        }

        .show-answer-btn {
            background: linear-gradient(135deg, #0ea5e9, #0284c7);
            border: none;
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .show-answer-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(14, 165, 233, 0.4);
        }

        /* Question Navigation */
        .question-navigation {
            display: flex;
            justify-content: center;
            gap: 15%;
            margin-top: 30px;
        }

        .nav-button {
            background: linear-gradient(135deg, #0ea5e9, #0284c7);
            border: none;
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .nav-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(14, 165, 233, 0.4);
        }

        .nav-button:disabled {
            background: #64748b;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
            opacity: 0.7;
        }

        .question-indicator {
            font-size: 1rem;
            color: #e2e8f0;
            text-align: center;
            margin-top: 15px;
        }

        /* Controls */
        .controls {
            text-align: center;
            margin: 40px 0;
        }

        .controls-title {
            font-size: 1.8rem;
            margin-bottom: 25px;
            color: #0ea5e9;
            font-weight: 600;
        }

        .demo-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
            margin: 25px 0;
        }

        .demo-btn {
            background: linear-gradient(135deg, #0ea5e9, #0284c7);
            border: none;
            color: white;
            padding: 14px 24px;
            border-radius: 30px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 8px 20px rgba(14, 165, 233, 0.3);
            min-width: 150px;
        }

        .demo-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 25px rgba(14, 165, 233, 0.4);
        }

        .demo-btn.active {
            background: linear-gradient(135deg, #10b981, #059669);
            box-shadow: 0 8px 20px rgba(16, 185, 129, 0.4);
        }

        /* Theory Section */
        .theory-section {
            background: rgba(15, 23, 42, 0.9);
            border-radius: 25px;
            padding: 35px;
            margin: 35px 0;
            border: 3px solid rgba(14, 165, 233, 0.4);
            backdrop-filter: blur(15px);
        }

        .principle-statement {
            background: linear-gradient(135deg, rgba(14, 165, 233, 0.2), rgba(56, 189, 248, 0.2));
            padding: 25px;
            border-radius: 20px;
            margin: 20px 0;
            text-align: center;
            border: 1px solid rgba(14, 165, 233, 0.3);
        }

        .principle-title {
            font-size: 1.5rem;
            color: #0ea5e9;
            margin-bottom: 15px;
            font-weight: 600;
        }

        .principle-text {
            font-size: 1.2rem;
            line-height: 1.8;
            color: #e2e8f0;
            font-style: italic;
        }

        .archimedes-bio {
            background: rgba(16, 185, 129, 0.1);
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            border-left: 4px solid #10b981;
        }

        .bio-title {
            color: #10b981;
            font-size: 1.3rem;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .bio-content {
            line-height: 1.7;
            color: #e2e8f0;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .header h1 { font-size: 2.2rem; }
            .demo-stage { padding: 30px 20px; min-height: 400px; }
            .demo-buttons { flex-direction: column; align-items: center; }
            .experiment-container { flex-direction: column; gap: 30px; }
            .principle-container { flex-direction: column; gap: 30px; }
            .applications-grid { grid-template-columns: 1fr; }
        }

        @media (max-width: 480px) {
            .container { padding: 20px 15px; }
            .header h1 { font-size: 1.8rem; }
            .demo-stage { padding: 20px 15px; }
            .theory-section { padding: 20px; }
        }
    </style>
</head>
<body>
    <!-- Audio Control -->
    <div id="audio-control">
        <button id="mute-btn" class="control-btn">
            <span class="unmute-icon">üîä</span>
            <span class="mute-icon">üîá</span>
        </button>
    </div>

    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>Archimedes' Principle</h1>
            <p>Discover why objects feel lighter in water and how this principle revolutionized our understanding of buoyancy and fluid mechanics!</p>
        </div>

        <!-- Demo Stage -->
        <div class="demo-stage" id="stage">
            <!-- Activity 9.7 Demo -->
            <div class="activity-demo" id="activity-demo">
                <div class="experiment-container">
                    <!-- Setup A: Stone in Air -->
                    <div class="experiment-setup" id="setup-air">
                        <div class="setup-label">Setup A: Stone in Air</div>
                        
                        <div class="spring-balance">
                            <div class="balance-display" id="reading-air">5.0 N</div>
                            <div class="spring" id="spring-air"></div>
                            <div class="balance-hook"></div>
                        </div>
                        
                        <div class="string string-air" id="string-air"></div>
                        <div class="stone stone-air" id="stone-air"></div>
                        
                        <!-- Force arrows for air setup -->
                        <div class="force-arrow weight-arrow" id="weight-air">
                            <div class="arrow-label">Weight<br>5.0 N</div>
                            <div class="arrow-line"></div>
                            <div class="arrow-head"></div>
                        </div>
                    </div>

                    <!-- Setup B: Stone in Water -->
                    <div class="experiment-setup" id="setup-water">
                        <div class="setup-label">Setup B: Stone in Water</div>
                        
                        <div class="spring-balance">
                            <div class="balance-display" id="reading-water">3.2 N</div>
                            <div class="spring" id="spring-water"></div>
                            <div class="balance-hook"></div>
                        </div>
                        
                        <!-- Static string (visible at end) -->
                        <div class="string string-water" id="string-water"></div>
                        
                        <!-- Transitional string for animation -->
                        <div class="string" id="string-transitional" style="height: 80px; opacity: 0;"></div>
                        
                        <div class="water-container">
                            <div class="water-level"></div>
                        </div>
                        
                        <!-- Static stone at final position (will be hidden during animation) -->
                        <div class="stone stone-water" id="stone-water"></div>
                        
                        <!-- Transitional stone for animation (will be shown during animation) -->
                        <div class="stone" id="stone-transitional"></div>
                        
<!-- No transitional reading needed - we'll update the balance display directly -->
                        
                        <!-- Transitional buoyant force arrow that will grow -->
                        <div class="force-arrow buoyant-arrow" id="buoyant-transitional" style="opacity: 0;">
                            <div class="arrow-head"></div>
                            <div class="arrow-line" style="height: 0px;"></div>
                            <div class="arrow-label">Buoyant Force<br>0.0 N</div>
                        </div>
                        
                        <!-- Force arrows for water setup -->
                        <div class="force-arrow weight-arrow" id="weight-water">
                            <div class="arrow-label">Weight<br>5.0 N</div>
                            <div class="arrow-line"></div>
                            <div class="arrow-head"></div>
                        </div>
                        
                        <div class="force-arrow buoyant-arrow" id="buoyant-water">
                            <div class="arrow-head"></div>
                            <div class="arrow-line"></div>
                            <div class="arrow-label">Buoyant Force<br>1.8 N</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Principle Explanation Demo -->
            <div class="principle-demo" id="principle-demo">
                <h2 style="color: #0ea5e9; margin-bottom: 30px;">Understanding Archimedes' Principle</h2>
                
                <!-- Displaced volume label - now outside and above everything -->
                <div class="displaced-volume-label" id="displaced-volume-text">Displaced Volume = Block Volume</div>
                
                <div class="principle-container">
                    <!-- Left side - Weight force -->
                    <div class="principle-force-arrow principle-weight-arrow" id="principle-weight">
                        <div class="principle-arrow-label">Weight<br>5.0 N</div>
                        <div class="principle-arrow-line"></div>
                        <div class="principle-arrow-head"></div>
                    </div>
                    
                    <!-- Center - Fluid container -->
                    <div class="fluid-container" id="fluid-container">
                        <!-- Blue water area -->
                        <div class="water-area"></div>
                        <div class="water-rise" id="water-rise"></div>
                        <div class="water-surface" id="water-surface"></div>
                        
                        <!-- Displaced fluid (green) -->
                        <div class="displaced-fluid" id="displaced-fluid"></div>
                        
                        <!-- Object -->
                        <div class="immersed-object object-above" id="demo-object">
                            <div class="object-label">Block</div>
                        </div>
                    </div>
                    
                    <!-- Right side - Buoyant force -->
                    <div class="principle-force-arrow principle-buoyant-arrow" id="principle-buoyant">
                        <div class="principle-arrow-head"></div>
                        <div class="principle-arrow-line"></div>
                        <div class="principle-arrow-label">Buoyant Force<br>5.0 N</div>
                    </div>
                    
                    <div style="max-width: 400px;">
                        <h3 style="color: #0ea5e9; margin-bottom: 15px; font-size: 1.5rem; text-shadow: 0 1px 2px rgba(0,0,0,0.3);">Key Concept:</h3>
                        <p style="font-size: 1.15rem; line-height: 1.7; background: rgba(0,0,0,0.2); padding: 15px; border-radius: 10px; box-shadow: 0 3px 10px rgba(0,0,0,0.2);">
                            When an object is immersed in a fluid, it displaces a volume of fluid equal to its own volume. 
                            The buoyant force equals the weight of this displaced fluid.
                        </p>
                        <div style="margin-top: 20px; padding: 15px; background: rgba(16, 185, 129, 0.15); border-radius: 10px; border: 2px solid rgba(16, 185, 129, 0.4); box-shadow: 0 4px 12px rgba(0,0,0,0.2);">
                            <strong style="color: #10b981; font-size: 1.2rem; display: block; text-align: center; text-shadow: 0 1px 1px rgba(0,0,0,0.3);">Buoyant Force = Weight of Displaced Fluid</strong>
                        </div>
                        <div id="principle-explanation" style="margin-top: 20px; font-size: 1.1rem; line-height: 1.6; color: #e2e8f0; padding: 15px; background: rgba(14, 165, 233, 0.15); border-radius: 10px; opacity: 0; border: 1px solid rgba(14, 165, 233, 0.3); box-shadow: 0 4px 12px rgba(0,0,0,0.2);">
                            <p>The object displaces water equal to its own volume. This creates an upward buoyant force of 5.0 N.</p>
                            <p style="margin-top: 10px; font-weight: 500;">Since the buoyant force equals the weight, the object will float at equilibrium.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Applications Demo -->
            <div class="applications-demo" id="applications-demo">
                <h2 style="color: #0ea5e9; text-align: center; margin-bottom: 30px;">Applications of Archimedes' Principle</h2>
                
                <div class="applications-grid">
                    <div class="application-card">
                        <div class="app-icon">üö¢</div>
                        <div class="app-title">Ships & Boats</div>
                        <div class="app-description">
                            Ships float because they displace a large volume of water. The buoyant force equals the ship's weight, 
                            allowing massive vessels to stay afloat.
                        </div>
                    </div>
                    
                    <div class="application-card">
                        <div class="app-icon">üö§</div>
                        <div class="app-title">Submarines</div>
                        <div class="app-description">
                            Submarines control their buoyancy by filling or emptying ballast tanks with water, 
                            allowing them to dive or surface as needed.
                        </div>
                    </div>
                    
                    <div class="application-card">
                        <div class="app-icon">ü•õ</div>
                        <div class="app-title">Lactometer</div>
                        <div class="app-description">
                            Used to test milk purity. Pure milk has a specific density, and the lactometer 
                            floats at different levels based on the milk's composition.
                        </div>
                    </div>
                    
                    <div class="application-card">
                        <div class="app-icon">üå°Ô∏è</div>
                        <div class="app-title">Hydrometer</div>
                        <div class="app-description">
                            Measures liquid density by observing how deep it sinks in the liquid. 
                            Widely used in battery testing and brewing.
                        </div>
                    </div>
                    
                    <div class="application-card">
                        <div class="app-icon">üéà</div>
                        <div class="app-title">Hot Air Balloons</div>
                        <div class="app-description">
                            Float in air because hot air inside is less dense than cold air outside, 
                            creating a buoyant force that lifts the balloon.
                        </div>
                    </div>
                    
                    <div class="application-card">
                        <div class="app-icon">üëë</div>
                        <div class="app-title">Density Testing</div>
                        <div class="app-description">
                            Archimedes used this principle to test if the king's crown was pure gold 
                            by comparing its density with pure gold.
                        </div>
                    </div>
                </div>
            </div>

            <!-- Questions Demo -->
            <div class="questions-demo" id="questions-demo">
                <h2 style="color: #0ea5e9; text-align: center; margin-bottom: 30px;">Practice Questions</h2>
                
                <div class="question-card" id="question-1" data-question-id="q1">
                    <div class="question-number">Q1.</div>
                    <div class="question-text">
                        You find your mass to be 42 kg on a weighing machine. Is your mass more or less than 42 kg?
                    </div>
                    <button class="show-answer-btn" onclick="showAnswer(1)">Show Answer</button>
                    <div class="answer-section" id="answer-1">
                        <strong>Answer:</strong> Your actual mass is slightly more than 42 kg. This is because air exerts a buoyant force on your body, 
                        making you appear lighter on the weighing machine. The buoyant force reduces the apparent weight, so the actual mass is greater than the measured value.
                    </div>
                </div>
                
                <div class="question-card" id="question-2" data-question-id="q2">
                    <div class="question-number">Q2.</div>
                    <div class="question-text">
                        You have a bag of cotton and an iron bar, each indicating a mass of 100 kg when measured on a weighing machine. 
                        In reality, one is heavier than the other. Can you say which one is heavier and why?
                    </div>
                    <button class="show-answer-btn" onclick="showAnswer(2)">Show Answer</button>
                    <div class="answer-section" id="answer-2">
                        <strong>Answer:</strong> The bag of cotton is actually heavier than the iron bar. Cotton has a much larger volume than iron for the same apparent mass, 
                        so it displaces more air and experiences a greater buoyant force from air. This makes it appear lighter on the weighing machine. 
                        Therefore, the actual mass of cotton is greater than that of iron.
                    </div>
                </div>
                
                <div class="question-card" id="question-3" data-question-id="q3">
                    <div class="question-number">Q3.</div>
                    <div class="question-text">
                        Why was no further decrease in elongation observed once the stone was fully immersed in water in Activity 9.7?
                    </div>
                    <button class="show-answer-btn" onclick="showAnswer(3)">Show Answer</button>
                    <div class="answer-section" id="answer-3">
                        <strong>Answer:</strong> Once the stone is fully immersed, it displaces a constant volume of water. According to Archimedes' principle, 
                        the buoyant force depends only on the volume of fluid displaced. Since the displaced volume remains constant when fully immersed, 
                        the buoyant force remains constant, and no further change in elongation occurs.
                    </div>
                </div>
                
                <!-- Question Navigation -->
                <div class="question-navigation">
                    <button id="prev-question" class="nav-button" onclick="navigateQuestion(-1)">
                        <span>‚óÄ</span> Previous
                    </button>
                    <button id="next-question" class="nav-button" onclick="navigateQuestion(1)">
                        Next <span>‚ñ∂</span>
                    </button>
                </div>
                <div class="question-indicator" id="question-indicator">Question 1 of 3</div>
            </div>
        </div>

        <!-- Controls -->
        <div class="controls">
            <div class="controls-title" id="demo-title">Explore Archimedes' Principle</div>
            
            <div class="demo-buttons">
                <button class="demo-btn" onclick="playCompleteLesson()">üìö Complete Lesson</button>
                <button class="demo-btn" onclick="showActivity()">üî¨ Activity 9.7</button>
                <button class="demo-btn" onclick="showPrinciple()">‚öñÔ∏è Principle Demo</button>
                <button class="demo-btn" onclick="showApplications()">üö¢ Applications</button>
                <button class="demo-btn" onclick="showQuestions()">‚ùì Questions</button>
                <button class="demo-btn" onclick="resetAllClick()">üîÑ Reset</button>
            </div>
        </div>

        <!-- Theory Section -->
        <div class="theory-section">
            <div class="principle-statement">
                <div class="principle-title">Archimedes' Principle</div>
                <div class="principle-text">
                    "When a body is immersed fully or partially in a fluid, it experiences an upward force 
                    that is equal to the weight of the fluid displaced by it."
                </div>
            </div>

            <div class="archimedes-bio">
                <div class="bio-title">About Archimedes (287-212 BCE)</div>
                <div class="bio-content">
                    <p><strong>"Eureka!" - "I have found it!"</strong></p>
                    <p>Archimedes was a Greek scientist who discovered this principle after noticing that water in a bathtub overflowed when he stepped into it. 
                    He ran through the streets shouting "Eureka!" This knowledge helped him determine the purity of gold in the crown made for the king.</p>
                    <p>His work in Geometry and Mechanics made him famous. His understanding of levers, pulleys, and wheels-and-axle helped the Greek army in its war with the Roman army.</p>
                </div>
            </div>

            <div style="background: rgba(14, 165, 233, 0.1); padding: 20px; border-radius: 15px; margin: 20px 0; border-left: 4px solid #0ea5e9;">
                <h3 style="color: #0ea5e9; margin-bottom: 15px;">Key Points to Remember:</h3>
                <ul style="line-height: 1.8; padding-left: 20px;">
                    <li>Buoyant force acts upward on any object in a fluid</li>
                    <li>The magnitude equals the weight of displaced fluid</li>
                    <li>This principle explains why objects feel lighter in water</li>
                    <li>It's the basis for designing ships, submarines, and measuring instruments</li>
                    <li>The principle applies to all fluids - liquids and gases</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        // Voice Teacher System
        class PhysicsTeacher {
            constructor() {
                this.isEnabled = globalAudioEnabled;
                this.currentUtterance = null;
                this.settings = { rate: 0.9, pitch: 1.0, volume: 0.85 };
                this.isDestroyed = false;
            }

            async speak(text, delay = 0) {
                if (!this.isEnabled || !text || this.isDestroyed) return;
                
                return new Promise((resolve) => {
                    setTimeout(() => {
                        if (this.isDestroyed) {
                            resolve();
                            return;
                        }
                        this.stop();
                        const utterance = new SpeechSynthesisUtterance(text);
                        Object.assign(utterance, this.settings);
                        
                        utterance.onend = resolve;
                        utterance.onerror = resolve;
                        
                        this.currentUtterance = utterance;
                        speechSynthesis.speak(utterance);
                    }, delay);
                });
            }

            stop() {
                speechSynthesis.cancel();
                this.currentUtterance = null;
            }

            destroy() {
                this.isDestroyed = true;
                this.stop();
                this.currentUtterance = null;
                this.settings = null;
            }
        }

        // Global state management
        let globalAudioEnabled = true;
        let currentTeacher = null;
        let isPlaying = false;
        let animationTimeline = null;
        let currentDemoAborted = false;
        let activeAnimations = [];
        let currentRunId = 0;

        // State management functions
        function createNewTimeline() {
            if (animationTimeline) {
                animationTimeline.kill();
                animationTimeline = null;
            }
            activeAnimations.forEach(anim => {
                if (anim) anim.kill();
            });
            activeAnimations = [];
            gsap.killTweensOf("*");
            
            const newTimeline = gsap.timeline();
            animationTimeline = newTimeline;
            return newTimeline;
        }

        function trackAnimation(animation) {
            if (animation) {
                activeAnimations.push(animation);
            }
            return animation;
        }

        function stopCurrentDemo() {
            currentDemoAborted = true;
            currentRunId++;
            
            // Stop teacher
            if (currentTeacher) {
                currentTeacher.destroy();
                currentTeacher = null;
            }
            
            // Kill all animations
            if (animationTimeline) {
                animationTimeline.kill();
                animationTimeline = null;
            }
            
            activeAnimations.forEach(anim => {
                if (anim) anim.kill();
            });
            activeAnimations = [];
            
            gsap.killTweensOf("*");
            
            // Hide all demos
            document.querySelectorAll('.activity-demo, .principle-demo, .applications-demo, .questions-demo').forEach(demo => {
                demo.classList.remove('active');
            });
            
            isPlaying = false;
        }

        function shouldContinue() {
            return !currentDemoAborted;
        }

        function createNewTeacher() {
            if (currentTeacher) {
                currentTeacher.destroy();
                currentTeacher = null;
            }
            currentDemoAborted = false;
            currentTeacher = new PhysicsTeacher();
            return currentTeacher;
        }

        // Initialize
        window.addEventListener('load', () => {
            const teacher = createNewTeacher();
            teacher.speak("Welcome to Archimedes' Principle! Let's discover why objects feel lighter in water and how this principle changed our understanding of buoyancy!");
        });

        // Complete Lesson
        async function playCompleteLesson() {
            stopCurrentDemo();
            isPlaying = true;
            setActiveButton(0);
            
            const teacher = createNewTeacher();
            const currentRunIdAtStart = currentRunId; // Capture the run ID at start
            
            await resetAll();
            await wait(100);
            if (!shouldContinue() || currentRunId !== currentRunIdAtStart) return;
            
            updateTitle("üìö Complete Archimedes' Principle Lesson");
            
            await teacher.speak("Let's begin our complete lesson on Archimedes' Principle. We'll start with the famous Activity 9.7 from your NCERT textbook.");
            if (!shouldContinue() || currentRunId !== currentRunIdAtStart) return;
            
            // Start with Activity 9.7
            await showActivityInternal(teacher);
            if (!shouldContinue() || currentRunId !== currentRunIdAtStart) return;
            
            await wait(2000);
            if (!shouldContinue() || currentRunId !== currentRunIdAtStart) return;
            
            // Show principle explanation
            await teacher.speak("Now let's understand the principle behind what we observed.");
            if (!shouldContinue() || currentRunId !== currentRunIdAtStart) return;
            await showPrincipleInternal(teacher);
            if (!shouldContinue() || currentRunId !== currentRunIdAtStart) return;
            
            await wait(2000);
            if (!shouldContinue() || currentRunId !== currentRunIdAtStart) return;
            
            // Show applications
            await teacher.speak("This principle has many practical applications in our daily life.");
            if (!shouldContinue() || currentRunId !== currentRunIdAtStart) return;
            await showApplicationsInternal(teacher);
            if (!shouldContinue() || currentRunId !== currentRunIdAtStart) return;
            
            await wait(2000);
            if (!shouldContinue() || currentRunId !== currentRunIdAtStart) return;
            
            // Show questions
            await teacher.speak("Finally, let's test our understanding with some practice questions.");
            if (!shouldContinue() || currentRunId !== currentRunIdAtStart) return;
            await showQuestionsInternal(teacher);
            if (!shouldContinue() || currentRunId !== currentRunIdAtStart) return;
            
            await teacher.speak("Excellent! You now understand Archimedes' Principle - the foundation of buoyancy and many important technologies!");
            
            // Only set isPlaying to false if this is still the current run
            if (currentRunId === currentRunIdAtStart) {
                isPlaying = false;
            }
        }

        // Activity 9.7 Demo
        async function showActivity() {
            stopCurrentDemo();
            isPlaying = true;
            setActiveButton(1);
            
            const teacher = createNewTeacher();
            const currentRunIdAtStart = currentRunId;
            
            await showActivityInternal(teacher);
            
            // Only set isPlaying to false if this is still the current run
            if (currentRunId === currentRunIdAtStart) {
                isPlaying = false;
            }
        }

        async function showActivityInternal(teacher) {
            const runId = currentRunId; // Capture current run ID
            await resetAll();
            await wait(50);
            if (!shouldContinue() || currentRunId !== runId) return;
            
            updateTitle("üî¨ Activity 9.7: Stone and Spring Balance");
            
            document.getElementById('activity-demo').classList.add('active');
            await wait(50);
            if (!shouldContinue() || currentRunId !== runId) return;
            
            await teacher.speak("Let's perform Activity 9.7. We have a stone tied to a spring balance.");
            if (!shouldContinue() || currentRunId !== runId) return;
            
            await wait(1000);
            
            // Highlight spring balance in air - show that it's stretched
            trackAnimation(gsap.to('#spring-air', {
                duration: 0.5,
                opacity: 0.9,
                ease: "power2.out"
            }));
            
            await wait(500);
            
            // Show weight arrow for air setup
            trackAnimation(gsap.to('#weight-air', {
                duration: 0.8,
                opacity: 1,
                ease: "power2.out"
            }));
            
            await wait(1000);
            
            await teacher.speak("In air, the spring balance reads 5.0 Newtons. Notice how the spring is stretched due to the full weight of the stone pulling downward.");
            if (!shouldContinue() || currentRunId !== runId) return;
            
            await wait(2000);
            
            await teacher.speak("Now, let's slowly dip the stone into water and observe what happens as it gets gradually immersed.");
            if (!shouldContinue() || currentRunId !== runId) return;
            
            // Animate the transition - highlight the water setup
            trackAnimation(gsap.to('#setup-water', {
                duration: 0.5,
                scale: 1.05,
                ease: "power2.out"
            }));
            
            await wait(500);
            
            trackAnimation(gsap.to('#setup-water', {
                duration: 0.5,
                scale: 1,
                ease: "power2.out"
            }));
            
            // Hide static elements during animation
            gsap.set('#stone-water', { opacity: 0 });
            gsap.set('#string-water', { opacity: 0 });
            
            // Show transitional elements
            gsap.set(['#stone-transitional', '#string-transitional'], { opacity: 1 });
            gsap.set('#buoyant-transitional', { opacity: 1, top: '350px' });
            
            // Reset spring balance to initial value
            document.getElementById('reading-water').innerHTML = "5.0 N";
            
            // Create the immersion animation timeline
            const immersionTimeline = gsap.timeline();
            
            // First 25% immersion - stone barely touches water
            immersionTimeline.to('#stone-transitional', {
                duration: 1.5,
                top: '230px',
                ease: "power1.inOut",
                onUpdate: function() {
                    // Update string length as stone moves down
                    const stoneTop = gsap.getProperty('#stone-transitional', 'top');
                    const stringHeight = stoneTop - 150 + 35/2; // 150 is string top, 35/2 is half stone height
                    gsap.set('#string-transitional', { height: stringHeight });
                    
                    // Calculate progress (0 to 1)
                    const progress = this.progress();
                    
                    // Interpolate reading value from 5.0 to 4.8
                    const readingValue = 5.0 - (progress * 0.2);
                    document.getElementById('reading-water').innerHTML = readingValue.toFixed(1) + " N";
                    
                    // Interpolate buoyant force from 0.0 to 0.2
                    const buoyantValue = progress * 0.2;
                    document.getElementById('buoyant-transitional').querySelector('.arrow-label').innerHTML = 
                        "Buoyant Force<br>" + buoyantValue.toFixed(1) + " N";
                }
            })
            .to('#buoyant-transitional .arrow-line', {
                duration: 1.5,
                height: '5px',
                ease: "none"
            }, "<");
            
            await wait(2000);
            if (!shouldContinue() || currentRunId !== runId) return;
            
            await teacher.speak("As the stone begins to enter the water, a small buoyant force starts to act on it. Notice the spring balance reading starts to decrease.");
            if (!shouldContinue()) return;
            
            // 50% immersion
            immersionTimeline.to('#stone-transitional', {
                duration: 1.5,
                top: '245px',
                ease: "power1.inOut",
                onUpdate: function() {
                    // Update string length as stone moves down
                    const stoneTop = gsap.getProperty('#stone-transitional', 'top');
                    const stringHeight = stoneTop - 150 + 35/2;
                    gsap.set('#string-transitional', { height: stringHeight });
                    
                    // Calculate progress (0 to 1)
                    const progress = this.progress();
                    
                    // Interpolate reading value from 4.8 to 4.1
                    const readingValue = 4.8 - (progress * 0.7);
                    document.getElementById('reading-water').innerHTML = readingValue.toFixed(1) + " N";
                    
                    // Interpolate buoyant force from 0.2 to 0.9
                    const buoyantValue = 0.2 + (progress * 0.7);
                    document.getElementById('buoyant-transitional').querySelector('.arrow-label').innerHTML = 
                        "Buoyant Force<br>" + buoyantValue.toFixed(1) + " N";
                }
            })
            .to('#buoyant-transitional .arrow-line', {
                duration: 1.5,
                height: '15px',
                ease: "none"
            }, "<");
            
            await wait(2000);
            if (!shouldContinue()) return;
            
            await teacher.speak("As more of the stone gets submerged, the buoyant force increases proportionally to the volume of water displaced.");
            if (!shouldContinue()) return;
            
            // 75% immersion
            immersionTimeline.to('#stone-transitional', {
                duration: 1.5,
                top: '265px',
                ease: "power1.inOut",
                onUpdate: function() {
                    // Update string length as stone moves down
                    const stoneTop = gsap.getProperty('#stone-transitional', 'top');
                    const stringHeight = stoneTop - 150 + 35/2;
                    gsap.set('#string-transitional', { height: stringHeight });
                    
                    // Calculate progress (0 to 1)
                    const progress = this.progress();
                    
                    // Interpolate reading value from 4.1 to 3.6
                    const readingValue = 4.1 - (progress * 0.5);
                    document.getElementById('reading-water').innerHTML = readingValue.toFixed(1) + " N";
                    
                    // Interpolate buoyant force from 0.9 to 1.4
                    const buoyantValue = 0.9 + (progress * 0.5);
                    document.getElementById('buoyant-transitional').querySelector('.arrow-label').innerHTML = 
                        "Buoyant Force<br>" + buoyantValue.toFixed(1) + " N";
                }
            })
            .to('#buoyant-transitional .arrow-line', {
                duration: 1.5,
                height: '25px',
                ease: "none"
            }, "<");
            
            await wait(1800);
            if (!shouldContinue()) return;
            
            // 100% immersion - final position
            immersionTimeline.to('#stone-transitional', {
                duration: 1.5,
                top: '280px',
                ease: "power1.inOut",
                onUpdate: function() {
                    // Update string length as stone moves down
                    const stoneTop = gsap.getProperty('#stone-transitional', 'top');
                    const stringHeight = stoneTop - 150 + 35/2;
                    gsap.set('#string-transitional', { height: stringHeight });
                    
                    // Calculate progress (0 to 1)
                    const progress = this.progress();
                    
                    // Interpolate reading value from 3.6 to 3.2
                    const readingValue = 3.6 - (progress * 0.4);
                    document.getElementById('reading-water').innerHTML = readingValue.toFixed(1) + " N";
                    
                    // Interpolate buoyant force from 1.4 to 1.8
                    const buoyantValue = 1.4 + (progress * 0.4);
                    document.getElementById('buoyant-transitional').querySelector('.arrow-label').innerHTML = 
                        "Buoyant Force<br>" + buoyantValue.toFixed(1) + " N";
                }
            })
            .to('#buoyant-transitional .arrow-line', {
                duration: 1.5,
                height: '30px',
                ease: "none"
            }, "<");
            
            await wait(2000);
            if (!shouldContinue()) return;
            
            await teacher.speak("When fully immersed, the buoyant force reaches its maximum value of 1.8 Newtons. The reading stabilizes at 3.2 Newtons.");
            if (!shouldContinue()) return;
            
            await wait(1500);
            if (!shouldContinue()) return;
            
            // Hide transitional elements
            gsap.set(['#stone-transitional', '#string-transitional', '#buoyant-transitional'], { opacity: 0 });
            
            // Show static elements for final state
            gsap.set(['#stone-water', '#string-water'], { opacity: 1 });
            
            // Show forces in water setup
            trackAnimation(gsap.to('#weight-water', {
                duration: 0.8,
                opacity: 1,
                ease: "power2.out"
            }));
            
            await wait(500);
            
            trackAnimation(gsap.to('#buoyant-water', {
                duration: 0.8,
                opacity: 1,
                ease: "power2.out"
            }));
            
            // Highlight water spring - show it's less stretched
            trackAnimation(gsap.to('#spring-water', {
                duration: 0.5,
                opacity: 0.9,
                ease: "power2.out"
            }));
            
            await wait(1000);
            
            await teacher.speak("Amazing! The spring balance now reads only 3.2 Newtons. The spring is less stretched because water exerts an upward buoyant force of 1.8 Newtons on the stone.");
            if (!shouldContinue()) return;
            
            await wait(2000);
            
            await teacher.speak("The net downward force is now 5.0 minus 1.8 equals 3.2 Newtons. This is why objects feel lighter in water!");
            if (!shouldContinue()) return;
            
            await wait(1500);
            
            await teacher.speak("Once the stone is fully immersed, no further change occurs because the volume of displaced water remains constant.");
        }

        // Principle Demo
        async function showPrinciple() {
            stopCurrentDemo();
            isPlaying = true;
            setActiveButton(2);
            
            const teacher = createNewTeacher();
            const currentRunIdAtStart = currentRunId;
            
            await showPrincipleInternal(teacher);
            
            // Only set isPlaying to false if this is still the current run
            if (currentRunId === currentRunIdAtStart) {
                isPlaying = false;
            }
        }

        async function showPrincipleInternal(teacher) {
            const runId = currentRunId; // Capture current run ID
            await resetAll();
            await wait(50);
            if (!shouldContinue() || currentRunId !== runId) return;
            
            updateTitle("‚öñÔ∏è Understanding Archimedes' Principle");
            
            document.getElementById('principle-demo').classList.add('active');
            await wait(50);
            if (!shouldContinue() || currentRunId !== runId) return;
            
            await teacher.speak("Archimedes' Principle states that the buoyant force equals the weight of displaced fluid. Let me demonstrate this step by step.");
            if (!shouldContinue() || currentRunId !== runId) return;
            
            await wait(1000);
            
            // Show weight force first with animation
            trackAnimation(gsap.to('#principle-weight', {
                duration: 0.8,
                opacity: 1,
                ease: "power2.out"
            }));
            
            // Add a subtle animation to the weight arrow to draw attention
            trackAnimation(gsap.to('#principle-weight .principle-arrow-line', {
                duration: 0.5,
                scaleY: 1.1,
                ease: "power1.inOut",
                repeat: 1,
                yoyo: true
            }));
            
            await wait(1000);
            
            await teacher.speak("This block weighs 5.0 Newtons in air. Now, let's place it in water and observe what happens.");
            if (!shouldContinue()) return;
            
            await wait(1000);
            
            // Begin object immersion with improved animation
            const immersionTimeline = gsap.timeline();
            
            // First animate the block moving down
            immersionTimeline
                .to('#demo-object', {
                    duration: 2,
                    top: '160px', // Final immersed position
                    ease: "power2.inOut"
                })
                // Then animate the water level rising
                .to('#water-rise', {
                    duration: 1.5,
                    height: "30px", // Amount of water level rise
                    ease: "power2.inOut"
                }, "-=0.5") // Start slightly before block finishes
                .to('#water-surface', {
                    duration: 1.5,
                    top: "80px", // Move water surface up
                    ease: "power2.inOut"
                }, "<"); // Start at same time as water rise
            
            await wait(2500);
            
            await teacher.speak("As the block is fully immersed, it displaces a volume of water equal to its own volume. Notice how the water level rises.");
            if (!shouldContinue()) return;
            
            // Show the displaced fluid with animation
            trackAnimation(gsap.to('#displaced-fluid', {
                duration: 1.2,
                height: "90px", // Match the height of the block
                ease: "power2.inOut",
                top: "80px" // Match the new water surface level
            }));
            
            // Show the displaced volume label with animation
            trackAnimation(gsap.to('#displaced-volume-text', {
                duration: 0.8,
                opacity: 1,
                top: 120,
                right: "55%",
                ease: "power2.out",
                delay: 0.5
            }));
            
            await wait(2000);
            
            await teacher.speak("The volume of water displaced is equal to the volume of the block. This displaced water creates an upward buoyant force.");
            if (!shouldContinue()) return;
            
            await wait(1000);
            
            // Show the buoyant force arrow growing with improved animation
            const buoyantTimeline = gsap.timeline();
            
            buoyantTimeline
                .to('#principle-buoyant', {
                    duration: 0.5,
                    opacity: 1,
                    ease: "power2.out"
                })
                .to('#principle-buoyant .principle-arrow-line', {
                    duration: 1.5,
                    height: "60px", // Same as weight force
                    ease: "elastic.out(1, 0.5)" // Add elastic effect for emphasis
                })
                .to('#principle-buoyant .principle-arrow-label', {
                    duration: 0.5,
                    innerHTML: "Buoyant Force<br>5.0 N",
                    ease: "none"
                }, "-=1");
            
            await wait(2500);
            
            await teacher.speak("This buoyant force is exactly 5.0 Newtons - equal to the weight of the block. The forces are in equilibrium.");
            if (!shouldContinue()) return;
            
            // Highlight both forces to show equilibrium
            trackAnimation(gsap.to(['#principle-weight', '#principle-buoyant'], {
                duration: 0.5,
                scale: 1.1,
                ease: "power2.inOut",
                repeat: 1,
                yoyo: true
            }));
            
            await wait(1500);
            
            // Show the explanation with fade-in animation
            trackAnimation(gsap.to('#principle-explanation', {
                duration: 1,
                opacity: 1,
                ease: "power2.inOut"
            }));
            
            await wait(2000);
            
            await teacher.speak("When the buoyant force equals the weight, the object will float at equilibrium. If the buoyant force is less than the weight, the object will sink. This is the essence of Archimedes' Principle!");
            if (!shouldContinue()) return;
            
            await wait(1500);
            
            // Make the object bob to simulate floating with improved animation
            trackAnimation(gsap.to('#demo-object', {
                duration: 1.5,
                y: "-=8",
                ease: "sine.inOut",
                repeat: 3,
                yoyo: true
            }));
            
            // Simultaneously animate the water surface to react to the bobbing
            trackAnimation(gsap.to('#water-surface', {
                duration: 1.5,
                y: "+=3",
                ease: "sine.inOut",
                repeat: 3,
                yoyo: true,
                delay: 0.2 // Slight delay for realistic water reaction
            }));
        }

        // Applications Demo
        async function showApplications() {
            stopCurrentDemo();
            isPlaying = true;
            setActiveButton(3);
            
            const teacher = createNewTeacher();
            const currentRunIdAtStart = currentRunId;
            
            await showApplicationsInternal(teacher);
            
            // Only set isPlaying to false if this is still the current run
            if (currentRunId === currentRunIdAtStart) {
                isPlaying = false;
            }
        }

        async function showApplicationsInternal(teacher) {
            const runId = currentRunId; // Capture current run ID
            await resetAll();
            await wait(50);
            if (!shouldContinue() || currentRunId !== runId) return;
            
            updateTitle("üö¢ Applications of Archimedes' Principle");
            
            document.getElementById('applications-demo').classList.add('active');
            await wait(50);
            if (!shouldContinue() || currentRunId !== runId) return;
            
            await teacher.speak("Archimedes' Principle has revolutionized technology and science. Let's explore its amazing applications.");
            if (!shouldContinue() || currentRunId !== runId) return;
            
            await wait(1500);
            
            await teacher.speak("Ships float because they displace a huge volume of water. The buoyant force equals the ship's weight, keeping it afloat.");
            if (!shouldContinue()) return;
            
            await wait(2500);
            
            await teacher.speak("Submarines control their buoyancy by filling or emptying ballast tanks. This allows them to dive or surface at will.");
            if (!shouldContinue()) return;
            
            await wait(2500);
            
            await teacher.speak("Lactometers test milk purity, and hydrometers measure liquid density - both using Archimedes' Principle!");
            if (!shouldContinue()) return;
            
            await wait(2000);
            
            await teacher.speak("Even hot air balloons work on this principle - they float in air because hot air is less dense than cold air!");
        }

        // Questions Demo
        async function showQuestions() {
            stopCurrentDemo();
            isPlaying = true;
            setActiveButton(4);
            
            const teacher = createNewTeacher();
            const currentRunIdAtStart = currentRunId;
            
            await showQuestionsInternal(teacher);
            
            // Only set isPlaying to false if this is still the current run
            if (currentRunId === currentRunIdAtStart) {
                isPlaying = false;
            }
        }

        async function showQuestionsInternal(teacher) {
            const runId = currentRunId; // Capture current run ID
            await resetAll();
            await wait(50);
            if (!shouldContinue() || currentRunId !== runId) return;
            
            updateTitle("‚ùì Practice Questions");
            
            document.getElementById('questions-demo').classList.add('active');
            
            // Initialize question navigation
            currentQuestionIndex = 1;
            document.getElementById('question-1').classList.add('active');
            document.getElementById('question-indicator').textContent = `Question ${currentQuestionIndex} of ${totalQuestions}`;
            document.getElementById('prev-question').disabled = true;
            document.getElementById('next-question').disabled = false;
            
            await wait(50);
            if (!shouldContinue() || currentRunId !== runId) return;
            
            await teacher.speak("Let's test your understanding with some thought-provoking questions from your textbook.");
            if (!shouldContinue() || currentRunId !== runId) return;
            
            await wait(1500);
            
            await teacher.speak("These questions will help you apply Archimedes' Principle to real-world situations. Click 'Show Answer' to see the explanations.");
            
            // Narrate the first question after introduction
            await wait(1000);
            if (!shouldContinue()) return;
            
            // Use the question data to ensure consistency
            await teacher.speak(questionsData[currentQuestionIndex].text);
        }

        // Question navigation variables
        let currentQuestionIndex = 1;
        const totalQuestions = 3;
        
        // Questions data with unique IDs
        const questionsData = {
            1: {
                id: "q1",
                text: "Question 1: You find your mass to be 42 kg on a weighing machine. Is your mass more or less than 42 kg?"
            },
            2: {
                id: "q2",
                text: "Question 2: You have a bag of cotton and an iron bar, each indicating a mass of 100 kg when measured on a weighing machine. In reality, one is heavier than the other. Can you say which one is heavier and why?"
            },
            3: {
                id: "q3",
                text: "Question 3: Why was no further decrease in elongation observed once the stone was fully immersed in water in Activity 9.7?"
            }
        };
        
        // Navigate between questions
        function navigateQuestion(direction) {
            // Hide current question and reset its answer
            const currentQuestion = document.getElementById(`question-${currentQuestionIndex}`);
            currentQuestion.classList.remove('active');
            const currentAnswer = document.getElementById(`answer-${currentQuestionIndex}`);
            currentAnswer.classList.remove('show');
            
            // Calculate new question index
            currentQuestionIndex += direction;
            
            // Ensure it stays within bounds
            if (currentQuestionIndex < 1) currentQuestionIndex = 1;
            if (currentQuestionIndex > totalQuestions) currentQuestionIndex = totalQuestions;
            
            // Show new question
            const newQuestion = document.getElementById(`question-${currentQuestionIndex}`);
            newQuestion.classList.add('active');
            
            // Update indicator
            document.getElementById('question-indicator').textContent = `Question ${currentQuestionIndex} of ${totalQuestions}`;
            
            // Update button states
            document.getElementById('prev-question').disabled = (currentQuestionIndex === 1);
            document.getElementById('next-question').disabled = (currentQuestionIndex === totalQuestions);
            
            // Narrate the new question using its unique ID
            if (currentTeacher) {
                // Get the current question's text from its ID
                const questionText = questionsData[currentQuestionIndex].text;
                currentTeacher.speak(questionText);
            }
        }
        
        // Show answer function
        function showAnswer(questionNumber) {
            const answerSection = document.getElementById(`answer-${questionNumber}`);
            answerSection.classList.add('show');
            
            if (currentTeacher) {
                // Associate answers with the same IDs as questions for consistency
                const answers = {
                    1: {
                        id: "q1_answer",
                        text: "Your actual mass is slightly more than 42 kg because air exerts a buoyant force on your body."
                    },
                    2: {
                        id: "q2_answer",
                        text: "The cotton bag is actually heavier because it experiences more buoyant force from air due to its larger volume."
                    },
                    3: {
                        id: "q3_answer",
                        text: "No further change occurs because the displaced volume remains constant once fully immersed."
                    }
                };
                
                // Speak the answer text for the specific question number
                currentTeacher.speak(answers[questionNumber].text);
            }
        }

        // Helper Functions
        async function resetAll() {
            if (animationTimeline) {
                animationTimeline.kill();
                animationTimeline = null;
            }
            gsap.killTweensOf("*");
            
            activeAnimations.forEach(anim => {
                if (anim) anim.kill();
            });
            activeAnimations = [];
            
            if (currentTeacher) {
                currentTeacher.stop();
            }
            
            // Hide all demos
            document.querySelectorAll('.activity-demo, .principle-demo, .applications-demo, .questions-demo').forEach(demo => {
                demo.classList.remove('active');
            });
            
            updateTitle("Explore Archimedes' Principle");
            
            // Reset force arrows
            gsap.set(['.force-arrow'], { opacity: 0 });
            
            // Reset spring and setup elements
            gsap.set(['#spring-air', '#spring-water'], { opacity: 0 });
            gsap.set('#setup-water', { scale: 1 });
            
            // Reset transitional animation elements
            gsap.set(['#stone-transitional', '#string-transitional', '#buoyant-transitional'], { opacity: 0 });
            gsap.set('#stone-water', { opacity: 1 });
            gsap.set('#string-water', { opacity: 1 });
            gsap.set('#buoyant-transitional .arrow-line', { height: 0 });
            gsap.set('#buoyant-transitional .arrow-label', { innerHTML: 'Buoyant Force<br>0.0 N' });
            
            // Reset spring balance reading to final value
            document.getElementById('reading-water').innerHTML = "3.2 N";
            
            // Reset principle demo elements
            gsap.set('#demo-object', { className: "immersed-object object-above", top: 20, y: 0 });
            gsap.set('#water-rise', { height: 0 });
            gsap.set('#water-surface', { top: 110 });
            gsap.set('#displaced-fluid', { height: 0 });
            gsap.set('#displaced-volume-text', { opacity: 0, top: 165 });
            gsap.set(['#principle-weight', '#principle-buoyant'], { opacity: 0 });
            gsap.set('#principle-buoyant .principle-arrow-line', { height: 0 });
            gsap.set('#principle-buoyant .principle-arrow-label', { innerHTML: "Buoyant Force<br>0.0 N" });
            gsap.set('#principle-explanation', { opacity: 0 });
            
            // Reset answer sections
            document.querySelectorAll('.answer-section').forEach(section => {
                section.classList.remove('show');
            });
            
            // Reset question cards
            document.querySelectorAll('.question-card').forEach(card => {
                card.classList.remove('active');
            });
            
            await wait(500);
        }

        function updateTitle(title) {
            document.getElementById('demo-title').textContent = title;
        }

        function setActiveButton(index) {
            document.querySelectorAll('.demo-btn').forEach((btn, i) => {
                btn.classList.toggle('active', i === index);
            });
        }

        function wait(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        // Reset Button Handler
        async function resetAllClick() {
            stopCurrentDemo();
            isPlaying = false;
            await resetAll();
        }

        // Audio Control
        document.getElementById('mute-btn').addEventListener('click', () => {
            globalAudioEnabled = !globalAudioEnabled;
            document.getElementById('mute-btn').classList.toggle('muted', !globalAudioEnabled);
            
            if (!globalAudioEnabled && currentTeacher) {
                currentTeacher.stop();
            }
        });
    </script>
</body>
</html>