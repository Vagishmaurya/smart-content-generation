<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Atomic Number and Mass Number - Interactive Chemistry</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a40 25%, #2d2d5f 50%, #1a1a40 75%, #0f0f23 100%);
            color: white;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Animated Background */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(2px 2px at 20% 30%, white, transparent),
                radial-gradient(2px 2px at 60% 70%, white, transparent),
                radial-gradient(1px 1px at 50% 50%, white, transparent);
            background-size: 200px 200px;
            opacity: 0.3;
            animation: drift 60s linear infinite;
            pointer-events: none;
        }

        @keyframes drift {
            from { transform: translate(0, 0); }
            to { transform: translate(-200px, -200px); }
        }

        /* Audio Control */
        #audio-control {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
        }

        .control-btn {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            border: none;
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.3);
        }

        .control-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 12px 30px rgba(59, 130, 246, 0.5);
        }

        .control-btn.muted .unmute-icon { display: none; }
        .control-btn:not(.muted) .mute-icon { display: none; }

        /* Main Container */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 30px 20px;
        }

        /* Header */
        .header {
            text-align: center;
            margin-bottom: 40px;
            position: relative;
        }

        .header h1 {
            font-size: 3.5rem;
            background: linear-gradient(45deg, #60a5fa, #a78bfa, #f472b6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 15px;
            font-weight: 700;
            animation: glow 3s ease-in-out infinite;
        }

        @keyframes glow {
            0%, 100% { filter: brightness(1) drop-shadow(0 0 20px rgba(96, 165, 250, 0.5)); }
            50% { filter: brightness(1.2) drop-shadow(0 0 40px rgba(167, 139, 250, 0.7)); }
        }

        .header p {
            font-size: 1.3rem;
            opacity: 0.9;
            max-width: 800px;
            margin: 0 auto;
            line-height: 1.6;
        }

        /* Main Layout */
        .main-content {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 30px;
            margin-bottom: 40px;
        }

        /* Atomic Stage */
        .atomic-stage {
            background: linear-gradient(135deg, 
                rgba(15, 23, 42, 0.9) 0%,
                rgba(30, 41, 59, 0.9) 50%,
                rgba(15, 23, 42, 0.9) 100%);
            border-radius: 25px;
            height: 600px;
            position: relative;
            box-shadow: 
                0 25px 50px rgba(0, 0, 0, 0.5),
                inset 0 0 100px rgba(96, 165, 250, 0.1);
            overflow: hidden;
            border: 3px solid rgba(96, 165, 250, 0.3);
        }

        #atomCanvas {
            width: 100%;
            height: 100%;
            display: block;
            cursor: grab;
        }

        #atomCanvas:active {
            cursor: grabbing;
        }

        /* Stage Info */
        .stage-info {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 15px 20px;
            border: 2px solid rgba(96, 165, 250, 0.3);
            max-width: 300px;
        }

        .stage-info h3 {
            font-size: 1.2rem;
            color: #60a5fa;
            margin-bottom: 8px;
        }

        .stage-info p {
            font-size: 0.9rem;
            color: #e2e8f0;
            line-height: 1.4;
        }

        /* Data Panel */
        .data-panel {
            background: linear-gradient(135deg, 
                rgba(0, 0, 0, 0.6),
                rgba(30, 41, 59, 0.6));
            border-radius: 25px;
            padding: 30px;
            border: 3px solid rgba(96, 165, 250, 0.3);
            backdrop-filter: blur(15px);
        }

        .data-panel h2 {
            font-size: 1.8rem;
            background: linear-gradient(45deg, #60a5fa, #a78bfa);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 25px;
            text-align: center;
        }

        .element-display {
            text-align: center;
            margin-bottom: 30px;
        }

        .element-symbol {
            font-size: 4rem;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .element-name {
            font-size: 1.4rem;
            color: #94a3b8;
            margin-bottom: 20px;
        }

        .notation-display {
            font-size: 2rem;
            font-family: 'Courier New', monospace;
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 15px;
            margin-bottom: 20px;
            position: relative;
            display: inline-block;
        }

        .notation-display .mass-number {
            position: absolute;
            top: 5px;
            left: 10px;
            font-size: 1.2rem;
            color: #f472b6;
        }

        .notation-display .atomic-number {
            position: absolute;
            bottom: 5px;
            left: 10px;
            font-size: 1.2rem;
            color: #60a5fa;
        }

        .notation-display .symbol {
            margin-left: 40px;
            font-size: 2.5rem;
        }

        .particle-counts {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 20px;
        }

        .particle-count {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 15px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .particle-count .label {
            font-size: 0.9rem;
            color: #94a3b8;
            margin-bottom: 5px;
        }

        .particle-count .value {
            font-size: 1.8rem;
            font-weight: bold;
        }

        .proton-count { color: #ef4444; }
        .neutron-count { color: #94a3b8; }
        .electron-count { color: #3b82f6; }

        /* Controls */
        .controls {
            text-align: center;
            margin: 40px 0;
        }

        .controls-title {
            font-size: 2rem;
            margin-bottom: 25px;
            background: linear-gradient(45deg, #60a5fa, #a78bfa);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 600;
        }

        .demo-buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
            margin: 25px 0;
        }

        .demo-btn {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            border: none;
            color: white;
            padding: 16px 28px;
            border-radius: 35px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.3);
            min-width: 200px;
            position: relative;
            overflow: hidden;
        }

        .demo-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .demo-btn:hover::before {
            left: 100%;
        }

        .demo-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 30px rgba(59, 130, 246, 0.4);
        }

        .demo-btn.active {
            background: linear-gradient(135deg, #10b981, #059669);
            box-shadow: 0 8px 25px rgba(16, 185, 129, 0.4);
            animation: activePulse 2s ease-in-out infinite;
        }

        @keyframes activePulse {
            0%, 100% { 
                box-shadow: 0 8px 25px rgba(16, 185, 129, 0.4);
            }
            50% { 
                box-shadow: 0 12px 35px rgba(16, 185, 129, 0.6);
            }
        }

        /* Element Selector */
        .element-selector {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .element-btn {
            background: rgba(0, 0, 0, 0.5);
            border: 2px solid rgba(96, 165, 250, 0.3);
            color: white;
            padding: 12px 20px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .element-btn:hover {
            background: rgba(96, 165, 250, 0.2);
            border-color: #60a5fa;
            transform: scale(1.05);
        }

        .element-btn.selected {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            border-color: #60a5fa;
        }

        /* Explanation Panel */
        .explanation {
            background: linear-gradient(135deg, 
                rgba(0, 0, 0, 0.6),
                rgba(30, 41, 59, 0.6));
            border-radius: 25px;
            padding: 35px;
            margin: 35px 0;
            border: 3px solid rgba(96, 165, 250, 0.3);
            backdrop-filter: blur(15px);
        }

        .explanation h3 {
            font-size: 1.8rem;
            background: linear-gradient(45deg, #60a5fa, #a78bfa);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 20px;
        }

        .explanation p {
            font-size: 1.1rem;
            line-height: 1.6;
            color: #e2e8f0;
        }

        /* Progress Indicator */
        .progress-indicator {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            border-radius: 30px;
            padding: 10px 20px;
            display: flex;
            gap: 10px;
            z-index: 100;
        }

        .progress-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
        }

        .progress-dot.active {
            background: linear-gradient(135deg, #60a5fa, #a78bfa);
            transform: scale(1.3);
        }

        .progress-dot.completed {
            background: #10b981;
        }

        /* Responsive Design */
        @media (max-width: 1024px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .data-panel {
                order: 2;
            }
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2.5rem;
            }
            
            .atomic-stage {
                height: 400px;
            }
            
            .demo-buttons {
                flex-direction: column;
                align-items: center;
            }
        }
    </style>
</head>
<body>
    <!-- Audio Control -->
    <div id="audio-control">
        <button id="mute-btn" class="control-btn">
            <span class="unmute-icon">🔊</span>
            <span class="mute-icon">🔇</span>
        </button>
    </div>

    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>Atomic Number & Mass Number</h1>
            <p>Discover how protons define elements and how nucleons determine atomic mass</p>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Atomic Stage -->
            <div class="atomic-stage" id="stage">
                <canvas id="atomCanvas"></canvas>
                
                <div class="stage-info" id="stageInfo">
                    <h3 id="infoTitle">Ready to Begin</h3>
                    <p id="infoText">Select a demonstration to explore atomic structure</p>
                </div>
            </div>

            <!-- Data Panel -->
            <div class="data-panel">
                <h2>⚛️ Atomic Data</h2>
                
                <div class="element-display">
                    <div class="element-symbol" id="elementSymbol">H</div>
                    <div class="element-name" id="elementName">Hydrogen</div>
                    
                    <div class="notation-display">
                        <span class="mass-number" id="massNumberNotation">1</span>
                        <span class="atomic-number" id="atomicNumberNotation">1</span>
                        <span class="symbol" id="symbolNotation">H</span>
                    </div>
                </div>

                <div class="particle-counts">
                    <div class="particle-count">
                        <div class="label">Protons (Z)</div>
                        <div class="value proton-count" id="protonCount">1</div>
                    </div>
                    <div class="particle-count">
                        <div class="label">Neutrons</div>
                        <div class="value neutron-count" id="neutronCount">0</div>
                    </div>
                    <div class="particle-count">
                        <div class="label">Electrons</div>
                        <div class="value electron-count" id="electronCount">1</div>
                    </div>
                </div>

                <div style="margin-top: 20px; padding: 15px; background: rgba(255, 255, 255, 0.05); border-radius: 10px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                        <span>Atomic Number (Z):</span>
                        <span style="color: #60a5fa; font-weight: bold;" id="atomicNumber">1</span>
                    </div>
                    <div style="display: flex; justify-content: space-between;">
                        <span>Mass Number (A):</span>
                        <span style="color: #f472b6; font-weight: bold;" id="massNumber">1</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Controls -->
        <div class="controls">
            <div class="controls-title" id="lesson-title">Explore Atomic Structure</div>
            
            <div class="demo-buttons">
                <button class="demo-btn" id="btn-complete" onclick="playCompleteStory()">📖 Complete Story</button>
                <button class="demo-btn" id="btn-atomic" onclick="exploreAtomicNumber()">⚡ Atomic Number</button>
                <button class="demo-btn" id="btn-mass" onclick="exploreMassNumber()">⚖️ Mass Number</button>
                <button class="demo-btn" id="btn-compare" onclick="compareElements()">🔄 Compare Elements</button>
                <button class="demo-btn" id="btn-reset" onclick="resetAll()">🔄 Reset</button>
            </div>

            <div class="element-selector">
                <button class="element-btn selected" onclick="selectElement('H')">Hydrogen (H)</button>
                <button class="element-btn" onclick="selectElement('C')">Carbon (C)</button>
                <button class="element-btn" onclick="selectElement('O')">Oxygen (O)</button>
                <button class="element-btn" onclick="selectElement('Al')">Aluminum (Al)</button>
            </div>
        </div>

        <!-- Explanation Panel -->
        <div class="explanation">
            <h3>📚 Key Concepts</h3>
            <p id="explanationText">
                <strong>Atomic Number (Z):</strong> The number of protons in an atom's nucleus. This defines the element.<br><br>
                <strong>Mass Number (A):</strong> The sum of protons and neutrons (nucleons) in the nucleus. This determines the atom's mass.
            </p>
        </div>
    </div>

    <!-- Progress Indicator -->
    <div class="progress-indicator" id="progressIndicator" style="display: none;">
        <div class="progress-dot" data-step="1"></div>
        <div class="progress-dot" data-step="2"></div>
        <div class="progress-dot" data-step="3"></div>
        <div class="progress-dot" data-step="4"></div>
        <div class="progress-dot" data-step="5"></div>
    </div>

    <script>
        // Narrator System
        class AtomicNarrator {
            constructor() {
                this.isEnabled = globalAudioEnabled;
                this.currentUtterance = null;
                this.settings = { rate: 0.9, pitch: 1.0, volume: 0.85 };
                this.isDestroyed = false;
                this.isSpeaking = false;
            }

            async speak(text, delay = 0) {
                if (!this.isEnabled || !text || this.isDestroyed) return;
                
                return new Promise((resolve) => {
                    setTimeout(() => {
                        if (this.isDestroyed) {
                            resolve();
                            return;
                        }
                        this.stop();
                        const utterance = new SpeechSynthesisUtterance(text);
                        Object.assign(utterance, this.settings);
                        
                        this.isSpeaking = true;
                        utterance.onend = () => {
                            this.isSpeaking = false;
                            resolve();
                        };
                        utterance.onerror = () => {
                            this.isSpeaking = false;
                            resolve();
                        };
                        
                        this.currentUtterance = utterance;
                        speechSynthesis.speak(utterance);
                    }, delay);
                });
            }

            stop() {
                this.isSpeaking = false;
                speechSynthesis.cancel();
                this.currentUtterance = null;
            }

            destroy() {
                this.isDestroyed = true;
                this.stop();
                this.currentUtterance = null;
                this.settings = null;
            }
        }

        // Global State
        let globalAudioEnabled = true;
        let narrator = null;
        let currentElement = 'H';
        let isAnimating = false;
        let currentActiveButton = null;

        // Three.js variables
        let scene, camera, renderer;
        let atomGroup, nucleus, electronShells = [];
        let protons = [], neutrons = [], electrons = [];
        let animationId;

        // Element Data
        const elements = {
            'H': {
                symbol: 'H',
                name: 'Hydrogen',
                atomicNumber: 1,
                massNumber: 1,
                protons: 1,
                neutrons: 0,
                electrons: 1,
                color: 0xff6b6b
            },
            'C': {
                symbol: 'C',
                name: 'Carbon',
                atomicNumber: 6,
                massNumber: 12,
                protons: 6,
                neutrons: 6,
                electrons: 6,
                color: 0x4a4a4a
            },
            'O': {
                symbol: 'O',
                name: 'Oxygen',
                atomicNumber: 8,
                massNumber: 16,
                protons: 8,
                neutrons: 8,
                electrons: 8,
                color: 0x3b82f6
            },
            'Al': {
                symbol: 'Al',
                name: 'Aluminum',
                atomicNumber: 13,
                massNumber: 27,
                protons: 13,
                neutrons: 14,
                electrons: 13,
                color: 0x94a3b8
            }
        };

        // Button management functions
        function setActiveButton(buttonId) {
            // Remove active class from all buttons
            document.querySelectorAll('.demo-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Add active class to the specified button
            if (buttonId) {
                const btn = document.getElementById(buttonId);
                if (btn) {
                    btn.classList.add('active');
                    currentActiveButton = buttonId;
                }
            }
        }

        function stopAllAnimations() {
            // Stop current narrator
            if (narrator) {
                narrator.destroy();
                narrator = null;
            }
            
            // Set animation flag to false
            isAnimating = false;
            
            // Hide progress indicator
            hideProgress();
        }

        // Initialize Three.js
        function initThreeJS() {
            const canvas = document.getElementById('atomCanvas');
            const container = document.getElementById('stage');
            
            // Scene
            scene = new THREE.Scene();
            scene.background = null;
            
            // Camera
            const width = container.clientWidth;
            const height = container.clientHeight;
            camera = new THREE.PerspectiveCamera(60, width / height, 0.1, 1000);
            camera.position.set(0, 5, 20);
            camera.lookAt(0, 0, 0);
            
            // Renderer
            renderer = new THREE.WebGLRenderer({ 
                canvas: canvas, 
                antialias: true,
                alpha: true 
            });
            renderer.setSize(width, height);
            
            // Lighting
            const ambientLight = new THREE.AmbientLight(0x404040, 0.8);
            scene.add(ambientLight);
            
            const directionalLight = new THREE.DirectionalLight(0xffffff, 1);
            directionalLight.position.set(10, 10, 5);
            scene.add(directionalLight);
            
            const pointLight = new THREE.PointLight(0xffffff, 0.5);
            pointLight.position.set(-10, -10, -5);
            scene.add(pointLight);
            
            // Create atom
            createAtom(currentElement);
            
            // Setup controls
            setupMouseControls();
            
            // Start animation loop
            animate();
        }

        // Create atom model
        function createAtom(elementKey, animated = false) {
            // Clear existing atom
            if (atomGroup) {
                scene.remove(atomGroup);
            }
            
            protons = [];
            neutrons = [];
            electrons = [];
            electronShells = [];
            
            const element = elements[elementKey];
            atomGroup = new THREE.Group();
            
            // Create nucleus
            nucleus = new THREE.Group();
            
            // Add protons
            for (let i = 0; i < element.protons; i++) {
                const proton = createParticle(0xef4444, 0.3); // Red for protons
                const pos = getRandomNucleusPosition(element.protons + element.neutrons, i);
                proton.position.copy(pos);
                nucleus.add(proton);
                protons.push(proton);
                
                if (animated) {
                    proton.scale.set(0, 0, 0);
                    animateParticleAppear(proton, i * 100);
                }
            }
            
            // Add neutrons
            for (let i = 0; i < element.neutrons; i++) {
                const neutron = createParticle(0x94a3b8, 0.3); // Gray for neutrons
                const pos = getRandomNucleusPosition(element.protons + element.neutrons, element.protons + i);
                neutron.position.copy(pos);
                nucleus.add(neutron);
                neutrons.push(neutron);
                
                if (animated) {
                    neutron.scale.set(0, 0, 0);
                    animateParticleAppear(neutron, (element.protons + i) * 100);
                }
            }
            
            atomGroup.add(nucleus);
            
            // Create electron shells
            const shellConfig = getElectronShellConfig(element.electrons);
            let electronIndex = 0;
            
            shellConfig.forEach((electronsInShell, shellIndex) => {
                const shellRadius = 2 + shellIndex * 1.5;
                
                // Shell ring
                const ringGeometry = new THREE.TorusGeometry(shellRadius, 0.05, 8, 64);
                const ringMaterial = new THREE.MeshBasicMaterial({
                    color: 0x60a5fa,
                    opacity: 0.3,
                    transparent: true
                });
                const ring = new THREE.Mesh(ringGeometry, ringMaterial);
                ring.rotation.x = Math.PI / 2;
                atomGroup.add(ring);
                electronShells.push(ring);
                
                // Add electrons to shell
                for (let i = 0; i < electronsInShell; i++) {
                    const electron = createParticle(0x3b82f6, 0.15); // Blue for electrons
                    const angle = (i / electronsInShell) * Math.PI * 2;
                    
                    electron.userData = {
                        shellIndex: shellIndex,
                        angle: angle,
                        radius: shellRadius,
                        speed: 1 - shellIndex * 0.2
                    };
                    
                    electron.position.x = Math.cos(angle) * shellRadius;
                    electron.position.z = Math.sin(angle) * shellRadius;
                    
                    atomGroup.add(electron);
                    electrons.push(electron);
                    
                    if (animated) {
                        electron.scale.set(0, 0, 0);
                        animateParticleAppear(electron, electronIndex * 50 + 1000);
                    }
                    
                    electronIndex++;
                }
            });
            
            scene.add(atomGroup);
            updateDataPanel(element);
        }

        // Create particle (proton, neutron, or electron)
        function createParticle(color, size) {
            const geometry = new THREE.SphereGeometry(size, 32, 32);
            const material = new THREE.MeshPhongMaterial({
                color: color,
                emissive: color,
                emissiveIntensity: 0.3,
                shininess: 100
            });
            return new THREE.Mesh(geometry, material);
        }

        // Get random position in nucleus
        function getRandomNucleusPosition(totalParticles, index) {
            const radius = Math.cbrt(totalParticles) * 0.3;
            const phi = Math.acos(1 - 2 * (index + 0.5) / totalParticles);
            const theta = Math.PI * (1 + Math.sqrt(5)) * index;
            
            return new THREE.Vector3(
                radius * Math.sin(phi) * Math.cos(theta),
                radius * Math.sin(phi) * Math.sin(theta),
                radius * Math.cos(phi)
            );
        }

        // Get electron shell configuration
        function getElectronShellConfig(electronCount) {
            const shells = [];
            let remaining = electronCount;
            const maxPerShell = [2, 8, 8, 18, 18, 32];
            
            for (let i = 0; i < maxPerShell.length && remaining > 0; i++) {
                const electronsInShell = Math.min(remaining, maxPerShell[i]);
                shells.push(electronsInShell);
                remaining -= electronsInShell;
            }
            
            return shells;
        }

        // Animate particle appearance
        function animateParticleAppear(particle, delay) {
            setTimeout(() => {
                let scale = 0;
                const interval = setInterval(() => {
                    scale += 0.1;
                    if (scale >= 1) {
                        scale = 1;
                        clearInterval(interval);
                    }
                    particle.scale.set(scale, scale, scale);
                }, 20);
            }, delay);
        }

        // Update data panel
        function updateDataPanel(element) {
            document.getElementById('elementSymbol').textContent = element.symbol;
            document.getElementById('elementName').textContent = element.name;
            document.getElementById('massNumberNotation').textContent = element.massNumber;
            document.getElementById('atomicNumberNotation').textContent = element.atomicNumber;
            document.getElementById('symbolNotation').textContent = element.symbol;
            document.getElementById('protonCount').textContent = element.protons;
            document.getElementById('neutronCount').textContent = element.neutrons;
            document.getElementById('electronCount').textContent = element.electrons;
            document.getElementById('atomicNumber').textContent = element.atomicNumber;
            document.getElementById('massNumber').textContent = element.massNumber;
        }

        // Complete Story
        async function playCompleteStory() {
            // Stop any current animations/narration
            stopAllAnimations();
            
            // Set active button
            setActiveButton('btn-complete');
            
            isAnimating = true;
            narrator = new AtomicNarrator();
            
            showProgress();
            updateTitle("📖 The Complete Story of Atomic Structure");
            
            // Chapter 1: Introduction
            updateProgress(1);
            updateStageInfo("Chapter 1: The Atom", "Understanding atomic structure");
            createAtom('H', true);
            
            await narrator.speak("Welcome to the fascinating world of atoms! Today, we'll explore two fundamental properties that define every element: atomic number and mass number.");
            
            if (!isAnimating) return;
            await wait(2000);
            
            await narrator.speak("Let's start with hydrogen, the simplest atom. It has just one proton in its nucleus.");
            
            if (!isAnimating) return;
            await wait(2000);
            
            // Chapter 2: Atomic Number
            updateProgress(2);
            updateStageInfo("Chapter 2: Atomic Number", "The identity of elements");
            
            await narrator.speak("The atomic number, represented by Z, is the number of protons in an atom's nucleus. For hydrogen, Z equals 1 because it has one proton.");
            
            if (!isAnimating) return;
            await wait(2000);
            
            createAtom('C', true);
            await narrator.speak("Now let's look at carbon. Carbon has 6 protons, so its atomic number Z equals 6. This is what makes carbon different from hydrogen!");
            
            if (!isAnimating) return;
            await wait(3000);
            
            // Chapter 3: Mass Number
            updateProgress(3);
            updateStageInfo("Chapter 3: Mass Number", "The mass of atoms");
            
            await narrator.speak("The mass number, represented by A, is the sum of protons and neutrons in the nucleus. These particles are called nucleons.");
            
            if (!isAnimating) return;
            await wait(2000);
            
            await narrator.speak("Carbon has 6 protons and 6 neutrons. Therefore, its mass number A equals 12.");
            updateExplanation("Mass Number (A) = Protons + Neutrons<br>For Carbon: A = 6 + 6 = 12");
            
            if (!isAnimating) return;
            await wait(3000);
            
            // Chapter 4: Notation
            updateProgress(4);
            updateStageInfo("Chapter 4: Atomic Notation", "How we write atoms");
            
            await narrator.speak("We write atoms using a special notation. The mass number goes on top, the atomic number on bottom, and the element symbol to the right.");
            
            if (!isAnimating) return;
            await wait(2000);
            
            await narrator.speak("Carbon is written as 12 over 6, followed by C. This tells us everything about carbon's nucleus!");
            
            if (!isAnimating) return;
            await wait(3000);
            
            // Chapter 5: Comparison
            updateProgress(5);
            updateStageInfo("Chapter 5: Comparing Elements", "Different atoms, different properties");
            
            createAtom('Al', true);
            await narrator.speak("Let's look at aluminum. It has 13 protons and 14 neutrons, giving it an atomic number of 13 and a mass number of 27.");
            
            if (!isAnimating) return;
            await wait(3000);
            
            await narrator.speak("Remember: the atomic number defines the element, while the mass number tells us about its mass. Together, they give us the complete nuclear picture!");
            
            hideProgress();
            isAnimating = false;
            // Remove active state after completion
            setTimeout(() => setActiveButton(null), 2000);
        }

        // Explore Atomic Number
        async function exploreAtomicNumber() {
            // Stop any current animations/narration
            stopAllAnimations();
            
            // Set active button
            setActiveButton('btn-atomic');
            
            isAnimating = true;
            updateTitle("⚡ Exploring Atomic Number");
            updateStageInfo("Atomic Number (Z)", "The number of protons defines the element");
            
            narrator = new AtomicNarrator();
            
            // Show hydrogen
            createAtom('H', true);
            await narrator.speak("The atomic number Z is the number of protons. Hydrogen has 1 proton, so Z equals 1.");
            
            if (!isAnimating) return;
            await wait(2000);
            
            // Show carbon
            createAtom('C', true);
            await narrator.speak("Carbon has 6 protons, so its atomic number is 6. The atomic number is unique for each element!");
            
            if (!isAnimating) return;
            await wait(2000);
            
            // Show oxygen
            createAtom('O', true);
            await narrator.speak("Oxygen has 8 protons, giving it an atomic number of 8. This is what makes oxygen different from other elements.");
            
            updateExplanation("The atomic number (Z) is the defining characteristic of an element. All atoms of the same element have the same number of protons. Change the number of protons, and you change the element itself!");
            
            isAnimating = false;
        }

        // Explore Mass Number
        async function exploreMassNumber() {
            // Stop any current animations/narration
            stopAllAnimations();
            
            // Set active button
            setActiveButton('btn-mass');
            
            isAnimating = true;
            updateTitle("⚖️ Exploring Mass Number");
            updateStageInfo("Mass Number (A)", "Protons + Neutrons = Mass");
            
            narrator = new AtomicNarrator();
            
            // Show carbon
            createAtom('C', true);
            await narrator.speak("The mass number A is the sum of protons and neutrons. Carbon has 6 protons and 6 neutrons.");
            
            if (!isAnimating) return;
            await wait(2000);
            
            await narrator.speak("6 plus 6 equals 12, so carbon's mass number is 12. We write this as carbon-12.");
            
            if (!isAnimating) return;
            await wait(2000);
            
            // Show aluminum
            createAtom('Al', true);
            await narrator.speak("Aluminum has 13 protons and 14 neutrons. 13 plus 14 equals 27, so aluminum's mass number is 27.");
            
            updateExplanation("The mass number (A) represents the total number of nucleons (protons and neutrons) in the nucleus. Since electrons have negligible mass, the mass number gives us the approximate atomic mass in atomic mass units.");
            
            isAnimating = false;
        }

        // Compare Elements
        async function compareElements() {
            // Stop any current animations/narration
            stopAllAnimations();
            
            // Set active button
            setActiveButton('btn-compare');
            
            isAnimating = true;
            updateTitle("🔄 Comparing Elements");
            updateStageInfo("Element Comparison", "See how elements differ");
            
            narrator = new AtomicNarrator();
            
            // Cycle through elements
            const elementKeys = ['H', 'C', 'O', 'Al'];
            
            for (const key of elementKeys) {
                if (!isAnimating) return;
                
                createAtom(key, true);
                const element = elements[key];
                await narrator.speak(`${element.name}: ${element.protons} protons, ${element.neutrons} neutrons. Atomic number ${element.atomicNumber}, mass number ${element.massNumber}.`);
                await wait(3000);
            }
            
            updateExplanation("Each element has a unique atomic number (number of protons). Elements can have different numbers of neutrons (isotopes), which changes the mass number but not the element's identity.");
            
            isAnimating = false;
        }

        // Helper Functions
        function selectElement(elementKey) {
            currentElement = elementKey;
            createAtom(elementKey, true);
            
            document.querySelectorAll('.element-btn').forEach(btn => {
                btn.classList.toggle('selected', btn.textContent.includes(elements[elementKey].symbol));
            });
            
            if (narrator) narrator.destroy();
            narrator = new AtomicNarrator();
            narrator.speak(`Selected ${elements[elementKey].name}. Atomic number ${elements[elementKey].atomicNumber}, mass number ${elements[elementKey].massNumber}.`);
        }

        function resetAll() {
            // Stop all animations
            stopAllAnimations();
            
            // Remove active button state
            setActiveButton(null);
            
            createAtom('H', false);
            updateTitle("Explore Atomic Structure");
            updateStageInfo("Ready to Begin", "Select a demonstration to explore atomic structure");
            updateExplanation("<strong>Atomic Number (Z):</strong> The number of protons in an atom's nucleus. This defines the element.<br><br><strong>Mass Number (A):</strong> The sum of protons and neutrons (nucleons) in the nucleus. This determines the atom's mass.");
            hideProgress();
        }

        function updateTitle(title) {
            document.getElementById('lesson-title').textContent = title;
        }

        function updateStageInfo(title, text) {
            document.getElementById('infoTitle').textContent = title;
            document.getElementById('infoText').textContent = text;
        }

        function updateExplanation(html) {
            document.getElementById('explanationText').innerHTML = html;
        }

        function showProgress() {
            document.getElementById('progressIndicator').style.display = 'flex';
        }

        function hideProgress() {
            document.getElementById('progressIndicator').style.display = 'none';
        }

        function updateProgress(step) {
            document.querySelectorAll('.progress-dot').forEach((dot, index) => {
                if (index < step) {
                    dot.classList.add('completed');
                    dot.classList.remove('active');
                } else if (index === step - 1) {
                    dot.classList.add('active');
                } else {
                    dot.classList.remove('active', 'completed');
                }
            });
        }

        function wait(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        // Setup mouse controls
        function setupMouseControls() {
            const canvas = renderer.domElement;
            let isDragging = false;
            let previousMousePosition = { x: 0, y: 0 };
            
            canvas.addEventListener('mousedown', (e) => {
                isDragging = true;
                previousMousePosition = { x: e.clientX, y: e.clientY };
            });
            
            canvas.addEventListener('mouseup', () => {
                isDragging = false;
            });
            
            canvas.addEventListener('mousemove', (e) => {
                if (!isDragging) return;
                
                const deltaX = e.clientX - previousMousePosition.x;
                const deltaY = e.clientY - previousMousePosition.y;
                
                if (atomGroup) {
                    atomGroup.rotation.y += deltaX * 0.01;
                    atomGroup.rotation.x += deltaY * 0.01;
                }
                
                previousMousePosition = { x: e.clientX, y: e.clientY };
            });
            
            canvas.addEventListener('wheel', (e) => {
                e.preventDefault();
                camera.position.z += e.deltaY * 0.01;
                camera.position.z = Math.max(10, Math.min(40, camera.position.z));
            });
        }

        // Animation loop
        function animate() {
            animationId = requestAnimationFrame(animate);
            
            // Rotate nucleus slowly
            if (nucleus) {
                nucleus.rotation.y += 0.005;
                nucleus.rotation.x += 0.003;
            }
            
            // Animate electrons
            electrons.forEach(electron => {
                if (electron.userData) {
                    const userData = electron.userData;
                    const time = Date.now() * 0.001;
                    const angle = userData.angle + time * userData.speed;
                    electron.position.x = Math.cos(angle) * userData.radius;
                    electron.position.z = Math.sin(angle) * userData.radius;
                }
            });
            
            renderer.render(scene, camera);
        }

        // Audio Control
        document.getElementById('mute-btn').addEventListener('click', () => {
            globalAudioEnabled = !globalAudioEnabled;
            document.getElementById('mute-btn').classList.toggle('muted', !globalAudioEnabled);
            
            if (narrator) {
                narrator.isEnabled = globalAudioEnabled;
                if (!globalAudioEnabled) {
                    narrator.stop();
                }
            }
        });

        // Initialize
        window.addEventListener('DOMContentLoaded', () => {
            initThreeJS();
            narrator = new AtomicNarrator();
            narrator.speak("Welcome to Atomic Number and Mass Number! Discover how protons define elements and how nucleons determine atomic mass. Select a demonstration to begin!");
        });

        // Handle window resize
        window.addEventListener('resize', () => {
            const container = document.getElementById('stage');
            if (camera && renderer) {
                camera.aspect = container.clientWidth / container.clientHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(container.clientWidth, container.clientHeight);
            }
        });
    </script>
</body>
</html>