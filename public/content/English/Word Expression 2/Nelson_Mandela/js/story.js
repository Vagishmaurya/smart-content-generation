// Story content and related functionality for Nelson Mandela lesson

// Story parts
const storyParts = {
    part1: `
        <h3 class="part-title">The Inauguration</h3>
        
        <p><strong>TENTH</strong> May dawned bright and clear. For the past few days I had been pleasantly besieged by dignitaries and world leaders who were coming to pay their respects before the inauguration. The inauguration would be the largest gathering ever of international leaders on South African soil.</p>
        
        <p>The ceremonies took place in the lovely sandstone amphitheatre formed by the Union Buildings in Pretoria. For decades this had been the seat of white supremacy, and now it was the site of a rainbow gathering of different colours and nations for the installation of South Africa's first democratic, non-racial government.</p>
        
        <p>On that lovely autumn day I was accompanied by my daughter Zenani. On the podium, Mr de Klerk was first sworn in as second deputy president. Then Thabo Mbeki was sworn in as first deputy president. When it was my turn, I pledged to obey and uphold the Constitution and to devote myself to the wellbeing of the Republic and its people. To the assembled guests and the watching world, I said:</p>
        
        <blockquote>
        Today, all of us do, by our presence here... confer glory and hope to newborn liberty. Out of the experience of an extraordinary human disaster that lasted too long, must be born a society of which all humanity will be proud.
        <br><br>
        We, who were outlaws not so long ago, have today been given the rare privilege to be host to the nations of the world on our own soil. We thank all of our distinguished international guests for having come to take possession with the people of our country of what is, after all, a common victory for justice, for peace, for human dignity.
        <br><br>
        We have, at last, achieved our political emancipation. We pledge ourselves to liberate all our people from the continuing bondage of poverty, deprivation, suffering, gender and other discrimination.
        <br><br>
        Never, never, and never again shall it be that this beautiful land will again experience the oppression of one by another.
        <br><br>
        The sun shall never set on so glorious a human achievement.
        <br><br>
        Let freedom reign. God bless Africa!
        </blockquote>
    `,
    
    part2: `
        <h3 class="part-title">The Celebration</h3>
        
        <p>A few moments later we all lifted our eyes in awe as a spectacular array of South African jets, helicopters and troop carriers roared in perfect formation over the Union Buildings. It was not only a display of pinpoint precision and military force, but a demonstration of the military's loyalty to democracy, to a new government that had been freely and fairly elected. Only moments before, the highest generals of the South African defence force and police, their chests bedecked with ribbons and medals from days gone by, saluted me and pledged their loyalty. I was not unmindful of the fact that not so many years before they would not have saluted but arrested me. Finally a chevron of Impala jets left a smoke trail of the black, red, green, blue and gold of the new South African flag.</p>
        
        <p>The day was symbolised for me by the playing of our two national anthems, and the vision of whites singing 'Nkosi Sikelel –iAfrika' and blacks singing 'Die Stem', the old anthem of the Republic. Although that day neither group knew the lyrics of the anthem they once despised, they would soon know the words by heart.</p>
        
        <p>On the day of the inauguration, I was overwhelmed with a sense of history. In the first decade of the twentieth century, a few years after the bitter Anglo-Boer war and before my own birth, the white-skinned peoples of South Africa patched up their differences and erected a system of racial domination against the dark-skinned peoples of their own land. The structure they created formed the basis of one of the harshest, most inhumane, societies the world has ever known. Now, in the last decade of the twentieth century, and my own eighth decade as a man, that system had been overturned forever and replaced by one that recognised the rights and freedoms of all peoples, regardless of the colour of their skin.</p>
        
        <p>That day had come about through the unimaginable sacrifices of thousands of my people, people whose suffering and courage can never be counted or repaid. I felt that day, as I have on so many other days, that I was simply the sum of all those African patriots who had gone before me. That long and noble line ended and now began again with me. I was pained that I was not able to thank them and that they were not able to see what their sacrifices had wrought.</p>
        
        <p>The policy of apartheid created a deep and lasting wound in my country and my people. All of us will spend many years, if not generations, recovering from that profound hurt. But the decades of oppression and brutality had another, unintended, effect, and that was that it produced the Oliver Tambos, the Walter Sisulus, the Chief Luthulis, the Yusuf Dadoos, the Bram Fischers, the Robert Sobukwes of our time — men of such extraordinary courage, wisdom and generosity that their like may never be known again. Perhaps it requires such depths of oppression to create such heights of character. My country is rich in the minerals and gems that lie beneath its soil, but I have always known that its greatest wealth is its people, finer and truer than the purest diamonds.</p>
        
        <p>It is from these comrades in the struggle that I learned the meaning of courage. Time and again, I have seen men and women risk and give their lives for an idea. I have seen men stand up to attacks and torture without breaking, showing a strength and resilience that defies the imagination. I learned that courage was not the absence of fear, but the triumph over it. The brave man is not he who does not feel afraid, but he who conquers that fear.</p>
        
        <p>No one is born hating another person because of the colour of his skin, or his background, or his religion. People must learn to hate, and if they can learn to hate, they can be taught to love, for love comes more naturally to the human heart than its opposite. Even in the grimmest times in prison, when my comrades and I were pushed to our limits, I would see a glimmer of humanity in one of the guards, perhaps just for a second, but it was enough to reassure me and keep me going. Man's goodness is a flame that can be hidden but never extinguished.</p>
    `,
    
    part3: `
        <h3 class="part-title">The Twin Obligations</h3>
        
        <p>In life, every man has twin obligations — obligations to his family, to his parents, to his wife and children; and he has an obligation to his people, his community, his country. In a civil and humane society, each man is able to fulfil those obligations according to his own inclinations and abilities. But in a country like South Africa, it was almost impossible for a man of my birth and colour to fulfil both of those obligations. In South Africa, a man of colour who attempted to live as a human being was punished and isolated. In South Africa, a man who tried to fulfil his duty to his people was inevitably ripped from his family and his home and was forced to live a life apart, a twilight existence of secrecy and rebellion. I did not in the beginning choose to place my people above my family, but in attempting to serve my people, I found that I was prevented from fulfilling my obligations as a son, a brother, a father and a husband.</p>
        
        <p>I was not born with a hunger to be free. I was born free — free in every way that I could know. Free to run in the fields near my mother's hut, free to swim in the clear stream that ran through my village, free to roast mealies under the stars and ride the broad backs of slow-moving bulls. As long as I obeyed my father and abided by the customs of my tribe, I was not troubled by the laws of man or God.</p>
        
        <p>It was only when I began to learn that my boyhood freedom was an illusion, when I discovered as a young man that my freedom had already been taken from me, that I began to hunger for it. At first, as a student, I wanted freedom only for myself, the transitory freedoms of being able to stay out at night, read what I pleased and go where I chose. Later, as a young man in Johannesburg, I yearned for the basic and honourable freedoms of achieving my potential, of earning my keep, of marrying and having a family — the freedom not to be obstructed in a lawful life.</p>
        
        <p>But then I slowly saw that not only was I not free, but my brothers and sisters were not free. I saw that it was not just my freedom that was curtailed, but the freedom of everyone who looked like I did. That is when I joined the African National Congress, and that is when the hunger for my own freedom became the greater hunger for the freedom of my people. It was this desire for the freedom of my people to live their lives with dignity and self-respect that animated my life, that transformed a frightened young man into a bold one, that drove a law-abiding attorney to become a criminal, that turned a family-loving husband into a man without a home, that forced a life-loving man to live like a monk. I am no more virtuous or self-sacrificing than the next man, but I found that I could not even enjoy the poor and limited freedoms I was allowed when I knew my people were not free. Freedom is indivisible; the chains on anyone of my people were the chains on all of them, the chains on all of my people were the chains on me.</p>
        
        <p>I knew that the oppressor must be liberated just as surely as the oppressed. A man who takes away another man's freedom is a prisoner of hatred; he is locked behind the bars of prejudice and narrow-mindedness. I am not truly free if I am taking away someone else's freedom, just as surely as I am not free when my freedom is taken from me. The oppressed and the oppressor alike are robbed of their humanity.</p>
    `
};

// Comprehension questions for each part
const comprehensionChecks = {
    part1: `
        <h3>Oral Comprehension Check</h3>
        <div class="comprehension-questions">
            <div class="comprehension-question">
                <p>1. Where did the ceremonies take place? Can you name any public buildings in India that are made of sandstone?</p>
                <textarea class="answer-input" rows="2" placeholder="Write your answer here..."></textarea>
            </div>
            
            <div class="comprehension-question">
                <p>2. Can you say how 10 May is an 'autumn day' in South Africa?</p>
                <textarea class="answer-input" rows="2" placeholder="Write your answer here..."></textarea>
            </div>
            
            <div class="comprehension-question">
                <p>3. At the beginning of his speech, Mandela mentions "an extraordinary human disaster". What does he mean by this? What is the "glorious ... human achievement" he speaks of at the end?</p>
                <textarea class="answer-input" rows="2" placeholder="Write your answer here..."></textarea>
            </div>
            
            <div class="comprehension-question">
                <p>4. What does Mandela thank the international leaders for?</p>
                <textarea class="answer-input" rows="2" placeholder="Write your answer here..."></textarea>
            </div>
            
            <div class="comprehension-question">
                <p>5. What ideals does he set out for the future of South Africa?</p>
                <textarea class="answer-input" rows="2" placeholder="Write your answer here..."></textarea>
            </div>
        </div>
    `,
    
    part2: `
        <h3>Oral Comprehension Check</h3>
        <div class="comprehension-questions">
            <div class="comprehension-question">
                <p>1. What do the military generals do? How has their attitude changed, and why?</p>
                <textarea class="answer-input" rows="2" placeholder="Write your answer here..."></textarea>
            </div>
            
            <div class="comprehension-question">
                <p>2. Why were two national anthems sung?</p>
                <textarea class="answer-input" rows="2" placeholder="Write your answer here..."></textarea>
            </div>
            
            <div class="comprehension-question">
                <p>3. How does Mandela describe the systems of government in his country (i) in the first decade, and (ii) in the final decade, of the twentieth century?</p>
                <textarea class="answer-input" rows="2" placeholder="Write your answer here..."></textarea>
            </div>
            
            <div class="comprehension-question">
                <p>4. What does courage mean to Mandela?</p>
                <textarea class="answer-input" rows="2" placeholder="Write your answer here..."></textarea>
            </div>
            
            <div class="comprehension-question">
                <p>5. Which does he think is natural, to love or to hate?</p>
                <textarea class="answer-input" rows="2" placeholder="Write your answer here..."></textarea>
            </div>
        </div>
    `,
    
    part3: `
        <h3>Oral Comprehension Check</h3>
        <div class="comprehension-questions">
            <div class="comprehension-question">
                <p>1. What "twin obligations" does Mandela mention?</p>
                <textarea class="answer-input" rows="2" placeholder="Write your answer here..."></textarea>
            </div>
            
            <div class="comprehension-question">
                <p>2. What did being free mean to Mandela as a boy, and as a student? How does he contrast these "transitory freedoms" with "the basic and honourable freedoms"?</p>
                <textarea class="answer-input" rows="2" placeholder="Write your answer here..."></textarea>
            </div>
            
            <div class="comprehension-question">
                <p>3. Does Mandela think the oppressor is free? Why/Why not?</p>
                <textarea class="answer-input" rows="2" placeholder="Write your answer here..."></textarea>
            </div>
        </div>
    `
};

// Vocabulary words to highlight
const vocabularyWords = [
    {word: "besieged", meaning: "surrounded by people wanting attention"},
    {word: "dignitaries", meaning: "people with important official positions"},
    {word: "amphitheatre", meaning: "an outdoor venue with seats rising on all sides"},
    {word: "supremacy", meaning: "the state of being superior to all others"},
    {word: "emancipation", meaning: "freedom from restrictions or control"},
    {word: "bondage", meaning: "the state of being a slave"},
    {word: "deprivation", meaning: "lack of basic material benefits considered essential"},
    {word: "chevron", meaning: "a V-shaped pattern or marking"},
    {word: "bedecked", meaning: "decorated, adorned"},
    {word: "unmindful", meaning: "not conscious or aware"},
    {word: "despised", meaning: "regarded with deep dislike"},
    {word: "inhumane", meaning: "without compassion for misery or suffering"},
    {word: "wrought", meaning: "caused or brought about"},
    {word: "apartheid", meaning: "a policy of segregation and discrimination on racial grounds"},
    {word: "brutality", meaning: "savage physical violence"},
    {word: "resilience", meaning: "ability to recover quickly from difficulties"},
    {word: "defies", meaning: "resists or challenges"},
    {word: "grimmest", meaning: "very serious or gloomy"},
    {word: "glimmer", meaning: "faint or wavering light"},
    {word: "extinguished", meaning: "put an end to"},
    {word: "obligations", meaning: "duties or commitments"},
    {word: "inclinations", meaning: "natural tendencies to do something"},
    {word: "inevitably", meaning: "unavoidably"},
    {word: "twilight", meaning: "the soft glowing light before darkness"},
    {word: "abided by", meaning: "followed or complied with"},
    {word: "transitory", meaning: "not permanent"},
    {word: "yearned", meaning: "longed for"},
    {word: "curtailed", meaning: "reduced or restricted"},
    {word: "animated", meaning: "brought to life"},
    {word: "virtuous", meaning: "having high moral standards"},
    {word: "indivisible", meaning: "unable to be divided or separated"}
];

// Show specific part of the story
function showStoryPart(partNumber) {
    // Update navigation buttons
    document.querySelectorAll('.story-nav-btn').forEach(btn => {
        btn.classList.remove('active');
        btn.setAttribute('aria-pressed', 'false');
    });
    
    document.querySelector(`.story-nav-btn:nth-child(${partNumber})`).classList.add('active');
    document.querySelector(`.story-nav-btn:nth-child(${partNumber})`).setAttribute('aria-pressed', 'true');
    
    // Show story content
    const storyContent = document.getElementById('storyContent');
    const comprehensionCheck = document.getElementById('comprehensionCheck');
    
    switch(partNumber) {
        case 1:
            storyContent.innerHTML = storyParts.part1;
            comprehensionCheck.innerHTML = comprehensionChecks.part1;
            break;
        case 2:
            storyContent.innerHTML = storyParts.part2;
            comprehensionCheck.innerHTML = comprehensionChecks.part2;
            break;
        case 3:
            storyContent.innerHTML = storyParts.part3;
            comprehensionCheck.innerHTML = comprehensionChecks.part3;
            break;
    }
    
    // Track progress
    updateProgress('story', partNumber);
    
    // Reset any active features
    isVocabularyHighlighted = false;
}

// Toggle read aloud functionality
let isReadingAloud = false;
let speechUtterance = null;

function toggleReadAloud() {
    if (!isReadingAloud) {
        // Start reading
        const storyText = document.getElementById('storyContent').innerText;
        speechUtterance = new SpeechSynthesisUtterance(storyText);
        speechUtterance.rate = 0.9;
        speechUtterance.onend = () => {
            isReadingAloud = false;
            document.querySelector('[onclick="toggleReadAloud()"]').innerHTML = '🔊 Read Aloud';
        };
        
        window.speechSynthesis.speak(speechUtterance);
        isReadingAloud = true;
        document.querySelector('[onclick="toggleReadAloud()"]').innerHTML = '⏹️ Stop Reading';
    } else {
        // Stop reading
        window.speechSynthesis.cancel();
        isReadingAloud = false;
        document.querySelector('[onclick="toggleReadAloud()"]').innerHTML = '🔊 Read Aloud';
    }
}

// Highlight vocabulary words
let isVocabularyHighlighted = false;

function highlightVocabulary() {
    const storyContent = document.getElementById('storyContent');
    
    if (!isVocabularyHighlighted) {
        // Highlight vocabulary words
        let content = storyContent.innerHTML;
        
        vocabularyWords.forEach(item => {
            const regex = new RegExp(`\\b${item.word}\\b`, 'gi');
            content = content.replace(regex, `<span class="vocab-highlight" title="${item.meaning}">${item.word}</span>`);
        });
        
        storyContent.innerHTML = content;
        isVocabularyHighlighted = true;
        document.querySelector('[onclick="highlightVocabulary()"]').innerHTML = '❌ Remove Highlights';
    } else {
        // Remove highlights
        showStoryPart(parseInt(document.querySelector('.story-nav-btn.active').innerText.split(' ')[1]));
        isVocabularyHighlighted = false;
        document.querySelector('[onclick="highlightVocabulary()"]').innerHTML = '✨ Highlight Vocabulary';
    }
}

// Toggle print mode
function togglePrintMode() {
    document.body.classList.toggle('print-mode');
}

// Initialize story
window.addEventListener('DOMContentLoaded', () => {
    // Load the first part of the story
    showStoryPart(1);
    
    // Add event listeners for comprehension questions
    document.querySelectorAll('.answer-input').forEach(input => {
        input.addEventListener('change', () => {
            if (input.value.trim().length > 0) {
                updateScore(2); // Award 2 points for answering a question
            }
        });
    });
});

// Additional poem content for tiger poem section
const additionalPoems = {
    peter: `
        <h3>The Tiger</h3>
        <p class="poem-author">by Peter Niblett</p>
        <div class="poem-text">
            The tiger behind the bars of his cage growls,<br>
            The tiger behind the bars of his cage snarls,<br>
            The tiger behind the bars of his cage roars.<br>
            Then he thinks.<br>
            It would be nice not to be behind bars all<br>
            The time<br>
            Because they spoil my view<br>
            I wish I were wild, not on show.<br>
            But if I were wild, hunters might shoot me,<br>
            But if I were wild, food might poison me,<br>
            But if I were wild, water might drown me.<br>
            Then he stops thinking<br>
            And...<br>
            The tiger behind the bars of his cage growls,<br>
            The tiger behind the bars of his cage snarls,<br>
            The tiger behind the bars of his cage roars.
        </div>
    `,
    
    rilke: `
        <h3>The Panther</h3>
        <p class="poem-author">by Rainer Maria Rilke</p>
        <div class="poem-text">
            His vision, from the constantly passing bars,<br>
            has grown so weary that it cannot hold<br>
            anything else. It seems to him there are<br>
            a thousand bars; and behind the bars, no world.<br><br>
            
            As he paces in cramped circles, over and over,<br>
            the movement of his powerful soft strides<br>
            is like a ritual dance around a centre<br>
            in which a mighty will stands paralysed.<br><br>
            
            Only at times, the curtain of the pupils<br>
            lifts, quietly. An image enters in,<br>
            rushes down through the tensed, arrested muscles,<br>
            plunges into the heart and is gone.
        </div>
    `,
    
    victoria: `
        <h3>The Greater Cats</h3>
        <p class="poem-author">by Victoria Sackville-West</p>
        <div class="poem-text">
            The greater cats with golden eyes<br>
            Stare out between the bars.<br>
            Deserts are there, and different skies,<br>
            And night with different stars.
        </div>
    `
};

// Show additional poems
function toggleAdditionalPoem(poemId) {
    const poemText = document.getElementById('additionalPoemText');
    poemText.innerHTML = additionalPoems[poemId];
    
    // Update active state for poem buttons
    document.querySelectorAll('.poem-toggle').forEach(btn => {
        btn.classList.remove('active');
    });
    document.querySelector(`[onclick="toggleAdditionalPoem('${poemId}')"]`).classList.add('active');
}
