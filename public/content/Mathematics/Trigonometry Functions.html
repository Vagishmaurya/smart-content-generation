<!DOCTYPE html>
<html lang="en">
<head>
        <style>
        /* Full-screen overrides - No distortion */
        * {
            box-sizing: border-box !important;
        }
        
        html, body {
            margin: 0 !important;
            padding: 0 !important;
            width: 100vw !important;
            height: 100vh !important;
            overflow-x: hidden !important;
            overflow-y: auto !important;
        }
        
        /* Remove all width constraints */
        .illustration-container,
        .content-section,
        .container,
        .main-content,
        #main-content,
        .hero-content,
        .loading-content {
            max-width: none !important;
            width: 100% !important;
            margin: 0 !important;
            padding: 0 !important;
        }
        
        /* Ensure all sections take full width */
        section, .section, .hero-section, .narrative-section, .formula-section, 
        .visualization-section, .comparison-section, .interactive-section,
        .concept-section, .oersted-container, .wire-container {
            width: 100% !important;
            max-width: none !important;
            margin: 0 !important;
            padding: 2rem !important;
            box-sizing: border-box !important;
        }
        
        /* Make sure content flows properly without distortion */
        .section-content, .concept-section, .formula-box, .data-viz,
        .interactive-demo, .grid-layout, .grid-item {
            width: 100% !important;
            max-width: none !important;
            margin: 20px 0 !important;
            box-sizing: border-box !important;
        }
        
        /* Ensure proper aspect ratios and prevent distortion */
        .animation-container, .chart-container, .particle-container {
            width: 100% !important;
            max-width: none !important;
            aspect-ratio: auto !important;
        }
        
        /* Fix any fixed positioning issues */
        #loading-screen, #audio-control, .audio-indicator {
            position: fixed !important;
            z-index: 9999 !important;
        }
        
        /* Ensure text remains readable */
        h1, h2, h3, h4, h5, h6, p, span, div {
            max-width: none !important;
            word-wrap: break-word !important;
        }
        
        /* Prevent any horizontal scrolling */
        body {
            min-width: 100vw !important;
            max-width: 100vw !important;
        }
        </style>
        
        <script>
        // Listen for messages from parent to stop audio
        window.addEventListener('message', function(event) {
            if (event.data && event.data.type === 'STOP_AUDIO') {
                // Stop all audio elements
                const audioElements = document.querySelectorAll('audio, video');
                audioElements.forEach(audio => {
                    if (audio instanceof HTMLAudioElement || audio instanceof HTMLVideoElement) {
                        audio.pause();
                        audio.currentTime = 0;
                    }
                });
                
                // Stop any speech synthesis
                if (window.speechSynthesis) {
                    window.speechSynthesis.cancel();
                }
                
                // Stop any ongoing animations or timers
                if (window.humanVoice && typeof window.humanVoice.stop === 'function') {
                    window.humanVoice.stop();
                }
                
                // Clear any intervals
                if (window.audioIntervals) {
                    window.audioIntervals.forEach(interval => clearInterval(interval));
                    window.audioIntervals = [];
                }
            }
        });
        </script>
        
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trigonometry Functions - Mathematical Journey</title>
    <style>
        :root {
            --blue-light: #3b82f6;
            --purple-mid: #8b5cf6;
            --pink-hot: #ec4899;
            --green-ok: #10b981;
            --orange-warn: #f59e0b;
            --red-perp: #ef4444;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0f0c29 0%, #302b63 50%, #24243e 100%);
            color: white;
            overflow-x: hidden;
            min-height: 100vh;
        }

        /* Accessibility & Reduced Motion */
        @media (prefers-reduced-motion: reduce) {
          *, *::before, *::after {
            animation-duration: 0.01ms !important;
            animation-iteration-count: 1 !important;
            transition-duration: 0.01ms !important;
            scroll-behavior: auto !important;
          }
        }
        
        button:focus-visible,
        input[type="range"]:focus-visible::-webkit-slider-thumb {
            outline: 3px solid var(--purple-mid);
            outline-offset: 3px;
        }

        /* Audio Control */
        #audio-control {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
        }

        .control-btn {
            background: rgba(59, 130, 246, 0.9);
            border: none;
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .control-btn:hover {
            transform: scale(1.1);
            background: rgba(59, 130, 246, 1);
        }

        .control-btn.muted .unmute-icon { display: none; }
        .control-btn:not(.muted) .mute-icon { display: none; }

        /* Main Container */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 30px 20px;
        }

        /* Header */
        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .header h1 {
            font-size: clamp(2rem, 5vw, 3.5rem);
            background: linear-gradient(45deg, var(--blue-light), var(--purple-mid), var(--pink-hot));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 15px;
            font-weight: 700;
        }

        .header p {
            font-size: clamp(1rem, 2vw, 1.3rem);
            opacity: 0.9;
            max-width: 800px;
            margin: 0 auto;
            line-height: 1.6;
        }

        /* Canvas Stage */
        .canvas-stage {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            border-radius: 25px;
            padding: 20px;
            margin: 40px 0;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.4);
            border: 3px solid rgba(59, 130, 246, 0.4);
            position: relative;
        }

        #trigCanvas {
            width: 100%;
            height: 500px;
            border-radius: 15px;
            background: radial-gradient(circle at center, 
                rgba(59, 130, 246, 0.05) 0%, 
                rgba(139, 92, 246, 0.05) 50%, 
                transparent 70%);
            display: block;
        }

        /* Info Display */
        .info-display {
            position: absolute;
            top: 30px;
            left: 30px;
            background: rgba(0, 0, 0, 0.7);
            padding: 15px 20px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            border: 2px solid rgba(59, 130, 246, 0.3);
            max-width: 250px;
            z-index: 10;
        }

        .info-item {
            margin: 8px 0;
            font-size: clamp(0.9rem, 1.5vw, 0.95rem);
        }

        .info-label {
            color: var(--blue-light);
            font-weight: 600;
        }

        .info-value {
            color: var(--pink-hot);
            font-family: 'Courier New', monospace;
            font-weight: bold;
        }

        /* Controls */
        .controls {
            text-align: center;
            margin: 40px 0;
        }

        .controls-title {
            font-size: clamp(1.5rem, 3vw, 2rem);
            margin-bottom: 25px;
            color: var(--purple-mid);
            font-weight: 600;
        }

        .demo-buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
            margin: 25px 0;
        }

        .demo-btn {
            background: linear-gradient(135deg, var(--blue-light), #6366f1);
            border: none;
            color: white;
            padding: 16px 28px;
            border-radius: 35px;
            font-size: clamp(0.9rem, 1.5vw, 1.1rem);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.3);
            min-width: 180px;
        }

        .demo-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 30px rgba(59, 130, 246, 0.4);
        }

        .demo-btn:active {
            transform: translateY(-1px);
        }

        .demo-btn.active {
            background: linear-gradient(135deg, var(--pink-hot), #f43f5e);
            box-shadow: 0 8px 25px rgba(236, 72, 153, 0.4);
        }

        /* Triangle Basics Section */
        .triangle-basics {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(59, 130, 246, 0.1));
            border-radius: 25px;
            padding: 35px;
            margin: 35px 0;
            border: 3px solid rgba(16, 185, 129, 0.4);
        }

        .basics-title {
            font-size: clamp(1.3rem, 2.5vw, 1.8rem);
            color: var(--green-ok);
            margin-bottom: 25px;
            text-align: center;
            font-weight: 600;
        }

        .triangle-parts {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }

        .part-card {
            background: rgba(0, 0, 0, 0.3);
            padding: 20px;
            border-radius: 15px;
            border: 2px solid rgba(255, 255, 255, 0.1);
            text-align: center;
        }

        .part-name {
            font-size: 1.3rem;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .perpendicular { color: var(--red-perp); }
        .base { color: var(--orange-warn); }
        .hypotenuse { color: var(--pink-hot); }

        .part-description {
            font-size: 1rem;
            line-height: 1.5;
            opacity: 0.9;
        }

        /* Function Cards */
        .function-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .function-card {
            background: rgba(255, 255, 255, 0.08);
            padding: 20px;
            border-radius: 20px;
            text-align: center;
            border: 2px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .function-card:hover {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.12);
            border-color: rgba(59, 130, 246, 0.5);
        }

        .function-name {
            font-size: 1.5rem;
            color: var(--blue-light);
            font-weight: bold;
            margin-bottom: 10px;
        }

        .function-formula {
            font-size: 1.2rem;
            color: var(--pink-hot);
            font-family: 'Courier New', monospace;
            margin: 10px 0;
            word-wrap: break-word;
        }

        .function-description {
            font-size: 0.9rem;
            opacity: 0.8;
            line-height: 1.4;
        }

        /* Equation Section */
        .equation-section {
            background: rgba(0, 0, 0, 0.5);
            border-radius: 25px;
            padding: 35px;
            margin: 35px 0;
            border: 3px solid rgba(139, 92, 246, 0.4);
            backdrop-filter: blur(15px);
        }

        .equation-title {
            font-size: clamp(1.3rem, 2.5vw, 1.8rem);
            color: var(--purple-mid);
            margin-bottom: 25px;
            text-align: center;
            font-weight: 600;
        }

        /* Slider Controls */
        .slider-controls {
            background: rgba(0, 0, 0, 0.6);
            padding: 20px;
            border-radius: 20px;
            margin: 20px 0;
            backdrop-filter: blur(10px);
        }

        .slider-group {
            margin: 15px 0;
        }

        .slider-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 1rem;
        }

        .slider-name {
            color: var(--blue-light);
            font-weight: 600;
        }

        .slider-value {
            color: var(--pink-hot);
            font-family: 'Courier New', monospace;
            font-weight: bold;
        }

        input[type="range"] {
            width: 100%;
            height: 8px;
            background: linear-gradient(to right, var(--blue-light), var(--pink-hot));
            border-radius: 10px;
            outline: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 22px;
            height: 22px;
            background: white;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
            transition: transform 0.2s ease;
        }
        input[type="range"]::-webkit-slider-thumb:hover {
            transform: scale(1.1);
        }

        /* Mnemonic Section */
        .mnemonic-section {
            background: linear-gradient(135deg, rgba(236, 72, 153, 0.1), rgba(59, 130, 246, 0.1));
            border-radius: 25px;
            padding: 35px;
            margin: 35px 0;
            border: 3px solid rgba(236, 72, 153, 0.4);
            text-align: center;
        }

        .mnemonic-title {
            font-size: clamp(1.3rem, 2.5vw, 1.8rem);
            color: var(--pink-hot);
            margin-bottom: 20px;
            font-weight: 600;
        }

        .mnemonic-text {
            font-size: clamp(1.5rem, 3vw, 2rem);
            color: var(--blue-light);
            font-weight: bold;
            margin: 20px 0;
            letter-spacing: 2px;
        }

        .mnemonic-explanation {
            font-size: 1.1rem;
            line-height: 1.6;
            opacity: 0.9;
        }

        /* Value Table */
        .value-table {
            background: rgba(0, 0, 0, 0.5);
            border-radius: 20px;
            padding: 20px;
            margin: 20px 0;
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 12px 15px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        th {
            background: rgba(59, 130, 246, 0.3);
            font-weight: 600;
            color: var(--blue-light);
        }

        td {
            font-family: 'Courier New', monospace;
            color: var(--pink-hot);
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                padding: 20px 15px;
            }
            #trigCanvas {
                height: 400px;
            }
            
            .demo-buttons {
                flex-direction: column;
                align-items: center;
            }
            
            .function-cards {
                grid-template-columns: 1fr;
            }
            
            .info-display {
                position: relative;
                top: 0;
                left: 0;
                max-width: 100%;
                margin-bottom: 20px;
                padding: 10px 15px;
            }
        }

        @media (max-width: 480px) {
            #trigCanvas {
                height: 350px;
            }
            .slider-controls {
                padding: 15px;
            }
            .header p {
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body>
    <!-- Audio Control -->
    <div id="audio-control">
        <button id="mute-btn" class="control-btn" aria-label="Toggle sound">
            <span class="unmute-icon">🔊</span>
            <span class="mute-icon">🔇</span>
        </button>
    </div>

    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>Trigonometry Functions</h1>
            <p>Master the six fundamental trigonometric functions through interactive visualizations and discover how triangles unlock the secrets of waves, circles, and real-world applications!</p>
        </div>

        <!-- Triangle Basics Section -->
        <div class="triangle-basics">
            <div class="basics-title">📐 Understanding Right Triangle Parts</div>
            <div class="triangle-parts">
                <div class="part-card">
                    <div class="part-name perpendicular">Perpendicular (Opposite)</div>
                    <div class="part-description">
                        The side opposite to the angle we're measuring. It's perpendicular (90°) to the base. This side determines the height of the triangle.
                    </div>
                </div>
                <div class="part-card">
                    <div class="part-name base">Base (Adjacent)</div>
                    <div class="part-description">
                        The side next to (adjacent to) the angle we're measuring. This forms the bottom of our right triangle.
                    </div>
                </div>
                <div class="part-card">
                    <div class="part-name hypotenuse">Hypotenuse</div>
                    <div class="part-description">
                        The longest side of the triangle, opposite to the right angle (90°). It connects the perpendicular and base sides.
                    </div>
                </div>
            </div>
        </div>

        <!-- Canvas Stage -->
        <div class="canvas-stage">
            <canvas id="trigCanvas" role="img" aria-label="Interactive trigonometry visualization of a unit circle and its functions."></canvas>
            <div class="info-display" id="infoDisplay">
                <div class="info-item">
                    <span class="info-label">Angle (&theta;):</span>
                    <span class="info-value" id="angleValue">45°</span>
                </div>
                <div class="info-item">
                    <span class="info-label">sin(&theta;):</span>
                    <span class="info-value" id="sinValue">0.707</span>
                </div>
                <div class="info-item">
                    <span class="info-label">cos(&theta;):</span>
                    <span class="info-value" id="cosValue">0.707</span>
                </div>
                <div class="info-item">
                    <span class="info-label">tan(&theta;):</span>
                    <span class="info-value" id="tanValue">1.000</span>
                </div>
                <div class="info-item">
                    <span class="info-label">csc(&theta;):</span>
                    <span class="info-value" id="cscValue">1.414</span>
                </div>
                <div class="info-item">
                    <span class="info-label">sec(&theta;):</span>
                    <span class="info-value" id="secValue">1.414</span>
                </div>
                <div class="info-item">
                    <span class="info-label">cot(&theta;):</span>
                    <span class="info-value" id="cotValue">1.000</span>
                </div>
            </div>
        </div>

        <!-- Slider Controls -->
        <div class="slider-controls">
            <div class="slider-group">
                <div class="slider-label">
                    <span class="slider-name">Angle (degrees)</span>
                    <span class="slider-value" id="angleSliderValue">45°</span>
                </div>
                <input type="range" id="angleSlider" min="0" max="360" value="45" step="1" aria-label="Angle slider">
            </div>
        </div>

        <!-- Controls -->
        <div class="controls">
            <div class="controls-title">Interactive Demonstrations</div>
            
            <div class="demo-buttons">
                <button class="demo-btn" onclick="playCompleteStory()">📚 Complete Story</button>
                <button class="demo-btn" onclick="showUnitCircle()">⭕ Unit Circle</button>
                <button class="demo-btn" onclick="showTriangleMode()">📐 Right Triangle</button>
                <button class="demo-btn" onclick="showWaveMode()">〰️ Wave Graphs</button>
                <button class="demo-btn" onclick="showRealWorld()">🌍 Applications</button>
            </div>
        </div>

        <!-- Mnemonic Section -->
        <div class="mnemonic-section">
            <div class="mnemonic-title">🧠 Remember with SOH CAH TOA!</div>
            <div class="mnemonic-text">SOH CAH TOA</div>
            <div class="mnemonic-explanation">
                <strong>S</strong>ine = <strong>O</strong>pposite (Perpendicular) / <strong>H</strong>ypotenuse<br>
                <strong>C</strong>osine = <strong>A</strong>djacent (Base) / <strong>H</strong>ypotenuse<br>
                <strong>T</strong>angent = <strong>O</strong>pposite (Perpendicular) / <strong>A</strong>djacent (Base)
            </div>
        </div>

        <!-- Function Cards -->
        <div class="equation-section">
            <div class="equation-title">🔢 The Six Trigonometric Functions</div>
            
            <div class="function-cards">
                <div class="function-card">
                    <div class="function-name">Sine</div>
                    <div class="function-formula">sin(&theta;) = Perpendicular / Hypotenuse</div>
                    <div class="function-description">
                        Ratio of the side opposite the angle (perpendicular) to the hypotenuse. Represents the y-coordinate on the unit circle.
                    </div>
                </div>
                <div class="function-card">
                    <div class="function-name">Cosine</div>
                    <div class="function-formula">cos(&theta;) = Base / Hypotenuse</div>
                    <div class="function-description">
                        Ratio of the adjacent side (base) to the hypotenuse. Represents the x-coordinate on the unit circle.
                    </div>
                </div>
                <div class="function-card">
                    <div class="function-name">Tangent</div>
                    <div class="function-formula">tan(&theta;) = Perpendicular / Base</div>
                    <div class="function-description">
                        Ratio of the opposite side (perpendicular) to the adjacent side (base). This is also equal to sin(&theta;)/cos(&theta;).
                    </div>
                </div>
                <div class="function-card">
                    <div class="function-name">Cosecant</div>
                    <div class="function-formula">csc(&theta;) = Hypotenuse / Perpendicular</div>
                    <div class="function-description">
                        The reciprocal of sine. It's the ratio of hypotenuse to the opposite side (perpendicular). Undefined when sine is zero.
                    </div>
                </div>
                <div class="function-card">
                    <div class="function-name">Secant</div>
                    <div class="function-formula">sec(&theta;) = Hypotenuse / Base</div>
                    <div class="function-description">
                        The reciprocal of cosine. It's the ratio of hypotenuse to the adjacent side (base). Undefined when cosine is zero.
                    </div>
                </div>
                <div class="function-card">
                    <div class="function-name">Cotangent</div>
                    <div class="function-formula">cot(&theta;) = Base / Perpendicular</div>
                    <div class="function-description">
                        The reciprocal of tangent. It's the ratio of adjacent side (base) to the opposite side (perpendicular). Undefined when tangent is zero.
                    </div>
                </div>
            </div>
        </div>

        <!-- Value Table -->
        <div class="value-table">
            <div class="equation-title">📊 Standard Angle Values</div>
            <table>
                <thead>
                    <tr>
                        <th>Angle</th>
                        <th>0°</th>
                        <th>30°</th>
                        <th>45°</th>
                        <th>60°</th>
                        <th>90°</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>sin(&theta;)</strong></td>
                        <td>0</td>
                        <td>1/2</td>
                        <td>&radic;2/2</td>
                        <td>&radic;3/2</td>
                        <td>1</td>
                    </tr>
                    <tr>
                        <td><strong>cos(&theta;)</strong></td>
                        <td>1</td>
                        <td>&radic;3/2</td>
                        <td>&radic;2/2</td>
                        <td>1/2</td>
                        <td>0</td>
                    </tr>
                    <tr>
                        <td><strong>tan(&theta;)</strong></td>
                        <td>0</td>
                        <td>&radic;3/3</td>
                        <td>1</td>
                        <td>&radic;3</td>
                        <td>&infin;</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <script>
        // --- SETUP & STATE ---
        const canvas = document.getElementById('trigCanvas');
        const ctx = canvas.getContext('2d');
        const angleSlider = document.getElementById('angleSlider');
        const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;

        let animationId = null;
        let currentMode = 'unitCircle';
        let angle = Math.PI / 4; // 45 degrees in radians
        let animationAngle = 0;
        let isAnimating = false;

        // --- NARRATION SYSTEM ---
        class TrigNarrator {
            constructor() {
                this.isEnabled = true;
                this.currentUtterance = null;
                this.settings = { rate: 0.95, pitch: 1.0, volume: 0.85 };
            }
            async speak(text, delay = 0) {
                if (!this.isEnabled || !text || prefersReducedMotion) return;
                return new Promise((resolve) => {
                    setTimeout(() => {
                        this.stop();
                        const utterance = new SpeechSynthesisUtterance(text);
                        Object.assign(utterance, this.settings);
                        utterance.lang = 'en-US';
                        utterance.onend = resolve;
                        utterance.onerror = (e) => { console.error("Speech synthesis error:", e); resolve(); };
                        this.currentUtterance = utterance;
                        speechSynthesis.speak(utterance);
                    }, delay);
                });
            }
            stop() {
                if(speechSynthesis.speaking) speechSynthesis.cancel();
                this.currentUtterance = null;
            }
            toggle() {
                this.isEnabled = !this.isEnabled;
                if (!this.isEnabled) this.stop();
                return this.isEnabled;
            }
        }
        const narrator = new TrigNarrator();

        // --- CORE DRAWING & MATH ---
        function initCanvas() {
            const rect = canvas.getBoundingClientRect();
            const dpr = window.devicePixelRatio || 1;
            canvas.width = rect.width * dpr;
            canvas.height = rect.height * dpr;
            ctx.scale(dpr, dpr);
            canvas.style.width = `${rect.width}px`;
            canvas.style.height = `${rect.height}px`;
            drawCurrentScene();
        }

        function calculateTrigValues(angleRad) {
            const sin = Math.sin(angleRad);
            const cos = Math.cos(angleRad);
            const tan = Math.tan(angleRad);
            const csc = 1 / sin;
            const sec = 1 / cos;
            const cot = 1 / tan;
            return { sin, cos, tan, csc, sec, cot };
        }

        function updateDisplay(angleRad) {
            const degrees = (angleRad * 180 / Math.PI) % 360;
            const displayDegrees = (degrees < 0 ? degrees + 360 : degrees).toFixed(0);
            const values = calculateTrigValues(angleRad);
            
            document.getElementById('angleValue').textContent = `${displayDegrees}°`;
            document.getElementById('sinValue').textContent = values.sin.toFixed(3);
            document.getElementById('cosValue').textContent = values.cos.toFixed(3);
            document.getElementById('tanValue').textContent = Math.abs(values.tan) > 10000 ? '±∞' : values.tan.toFixed(3);
            document.getElementById('cscValue').textContent = Math.abs(values.csc) > 10000 ? '±∞' : values.csc.toFixed(3);
            document.getElementById('secValue').textContent = Math.abs(values.sec) > 10000 ? '±∞' : values.sec.toFixed(3);
            document.getElementById('cotValue').textContent = Math.abs(values.cot) > 10000 ? '±∞' : values.cot.toFixed(3);
        }

        function drawGrid(centerX, centerY, width, height) {
            ctx.strokeStyle = 'rgba(59, 130, 246, 0.1)';
            ctx.lineWidth = 1;
            for (let i = centerX; i < width; i += 40) { ctx.beginPath(); ctx.moveTo(i, 0); ctx.lineTo(i, height); ctx.stroke(); }
            for (let i = centerX; i > 0; i -= 40) { ctx.beginPath(); ctx.moveTo(i, 0); ctx.lineTo(i, height); ctx.stroke(); }
            for (let i = centerY; i < height; i += 40) { ctx.beginPath(); ctx.moveTo(0, i); ctx.lineTo(width, i); ctx.stroke(); }
            for (let i = centerY; i > 0; i -= 40) { ctx.beginPath(); ctx.moveTo(0, i); ctx.lineTo(width, i); ctx.stroke(); }
        }

        // --- DRAWING MODES ---
        function drawUnitCircle() {
            const rect = canvas.getBoundingClientRect();
            const centerX = rect.width / 2;
            const centerY = rect.height / 2;
            const radius = Math.min(rect.width, rect.height) * 0.35;
            
            ctx.clearRect(0, 0, rect.width, rect.height);
            drawGrid(centerX, centerY, rect.width, rect.height);
            
            // Axes
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.5)';
            ctx.lineWidth = 1.5;
            ctx.beginPath();
            ctx.moveTo(0, centerY); ctx.lineTo(rect.width, centerY);
            ctx.moveTo(centerX, 0); ctx.lineTo(centerX, rect.height);
            ctx.stroke();
            
            // Unit circle
            ctx.strokeStyle = '#3b82f6';
            ctx.lineWidth = 3;
            ctx.beginPath(); ctx.arc(centerX, centerY, radius, 0, 2 * Math.PI); ctx.stroke();
            
            const cosVal = Math.cos(angle);
            const sinVal = Math.sin(angle);
            const x = centerX + radius * cosVal;
            const y = centerY - radius * sinVal;
            
            // Triangle lines
            ctx.beginPath(); // Cosine line (horizontal)
            ctx.moveTo(centerX, centerY); ctx.lineTo(x, centerY);
            ctx.strokeStyle = '#f59e0b'; ctx.lineWidth = 2.5; ctx.stroke();
            
            ctx.beginPath(); // Sine line (vertical)
            ctx.moveTo(x, centerY); ctx.lineTo(x, y);
            ctx.strokeStyle = '#10b981'; ctx.lineWidth = 2.5; ctx.stroke();
            
            ctx.beginPath(); // Radius line
            ctx.moveTo(centerX, centerY); ctx.lineTo(x, y);
            ctx.strokeStyle = '#ec4899'; ctx.lineWidth = 3; ctx.stroke();
            
            // Point on circle
            ctx.fillStyle = '#ec4899';
            ctx.beginPath(); ctx.arc(x, y, 8, 0, 2 * Math.PI); ctx.fill();
            
            // Labels
            ctx.fillStyle = 'white'; ctx.font = 'bold 14px Segoe UI';
            ctx.fillText('1', centerX + radius + 8, centerY + 5);
            ctx.fillText('-1', centerX - radius - 20, centerY + 5);
            ctx.fillText('i', centerX + 4, centerY - radius - 8);
            ctx.fillText('-i', centerX + 4, centerY + radius + 15);

            ctx.font = 'italic bold 16px Segoe UI';
            const cosLabelX = (centerX + x) / 2;
            const sinLabelY = (centerY + y) / 2;
            ctx.fillStyle = '#f59e0b';
            ctx.fillText('cos θ', cosLabelX - 15, centerY + (sinVal > 0 ? 20 : -10));
            ctx.fillStyle = '#10b981';
            ctx.fillText('sin θ', x + (cosVal < 0 ? -45 : 10), sinLabelY);

            updateDisplay(angle);
        }

        function drawTriangle() {
            const rect = canvas.getBoundingClientRect();
            const centerX = rect.width / 2;
            const centerY = rect.height / 2;
            ctx.clearRect(0, 0, rect.width, rect.height);

            const limitedAngle = Math.max(0.05, Math.min(Math.PI / 2 - 0.05, angle));
            const scale = Math.min(rect.width, rect.height) * 0.3;
            const adj = scale;
            const opp = adj * Math.tan(limitedAngle);

            const pA = { x: centerX - adj / 2, y: centerY + opp / 2 };
            const pB = { x: pA.x + adj, y: pA.y };
            const pC = { x: pA.x, y: pA.y - opp };

            // Triangle fill and stroke
            ctx.beginPath(); ctx.moveTo(pA.x, pA.y); ctx.lineTo(pB.x, pB.y); ctx.lineTo(pC.x, pC.y); ctx.closePath();
            ctx.fillStyle = 'rgba(59, 130, 246, 0.2)'; ctx.fill();
            ctx.strokeStyle = '#3b82f6'; ctx.lineWidth = 3; ctx.stroke();

            // Right angle indicator
            const squareSize = 20;
            ctx.strokeStyle = '#ec4899'; ctx.lineWidth = 2;
            ctx.strokeRect(pA.x, pA.y - squareSize, squareSize, squareSize);

            // Angle arc
            ctx.strokeStyle = '#10b981'; ctx.lineWidth = 2;
            ctx.beginPath(); ctx.arc(pC.x, pC.y, 40, Math.PI / 2, Math.PI / 2 - limitedAngle, true); ctx.stroke();

            // Highlight triangle sides with proper colors
            ctx.lineWidth = 4;
            // Base (Adjacent) - Orange
            ctx.strokeStyle = '#f59e0b';
            ctx.beginPath(); ctx.moveTo(pA.x, pA.y); ctx.lineTo(pB.x, pB.y); ctx.stroke();
            
            // Perpendicular (Opposite) - Red
            ctx.strokeStyle = '#ef4444';
            ctx.beginPath(); ctx.moveTo(pA.x, pA.y); ctx.lineTo(pC.x, pC.y); ctx.stroke();
            
            // Hypotenuse - Pink
            ctx.strokeStyle = '#ec4899';
            ctx.beginPath(); ctx.moveTo(pB.x, pB.y); ctx.lineTo(pC.x, pC.y); ctx.stroke();

            // Labels with proper terminology
            ctx.font = 'bold 16px Segoe UI';
            ctx.fillStyle = '#f59e0b';
            ctx.fillText('Base (Adjacent)', (pA.x + pB.x) / 2 - 40, pA.y + 25);
            ctx.fillStyle = '#ef4444';
            ctx.fillText('Perpendicular', pA.x - 60, (pA.y + pC.y) / 2 + 5);
            ctx.fillText('(Opposite)', pA.x - 45, (pA.y + pC.y) / 2 + 20);
            
            ctx.save();
            ctx.translate((pB.x + pC.x) / 2, (pB.y + pC.y) / 2);
            ctx.rotate(-limitedAngle);
            ctx.fillStyle = '#ec4899';
            ctx.fillText('Hypotenuse', -50, -10);
            ctx.restore();
            
            ctx.fillStyle = 'white';
            ctx.fillText('θ', pC.x + 45, pC.y + 15);
            updateDisplay(limitedAngle);
        }

        function drawWaveGraphs() {
            const rect = canvas.getBoundingClientRect();
            const width = rect.width, height = rect.height;
            const graphHeight = height / 3;
            ctx.clearRect(0, 0, width, height);

            const functions = [
                { name: 'sin(x)', color: '#10b981', fn: Math.sin },
                { name: 'cos(x)', color: '#f59e0b', fn: Math.cos },
                { name: 'tan(x)', color: '#ec4899', fn: Math.tan }
            ];

            functions.forEach((func, index) => {
                const yOffset = graphHeight * index + graphHeight / 2;
                ctx.strokeStyle = 'rgba(255, 255, 255, 0.3)'; ctx.lineWidth = 1;
                ctx.beginPath(); ctx.moveTo(0, yOffset); ctx.lineTo(width, yOffset); ctx.stroke();
                
                ctx.strokeStyle = func.color; ctx.lineWidth = 2.5;
                ctx.beginPath();
                let lastY = 0;
                for (let i = 0; i <= width; i++) {
                    const x_angle = (i / width) * 4 * Math.PI - 2 * Math.PI;
                    let y_val = func.fn(x_angle);

                    if (func.name === 'tan(x)') {
                        if (Math.abs(Math.cos(x_angle)) < 0.01) { // Asymptote
                            ctx.stroke(); // End previous segment
                            ctx.beginPath(); // Start new one after jump
                            continue;
                        }
                    }
                    const plotY = yOffset - y_val * graphHeight * 0.3;
                    if (i === 0) ctx.moveTo(i, plotY); else ctx.lineTo(i, plotY);
                }
                ctx.stroke();

                // Asymptotes for tan
                if (func.name === 'tan(x)') {
                    ctx.strokeStyle = 'rgba(255, 255, 255, 0.25)'; ctx.lineWidth = 1; ctx.setLineDash([5, 5]);
                    for(let k = -1; k <= 1; k+=2) {
                        const asymptote_x = ( (k * Math.PI/2) / (4*Math.PI) + 0.5 ) * width;
                        ctx.beginPath(); ctx.moveTo(asymptote_x, yOffset - graphHeight/2); ctx.lineTo(asymptote_x, yOffset + graphHeight/2); ctx.stroke();
                    }
                    ctx.setLineDash([]);
                }

                const currentX = ((angle + 2 * Math.PI) / (4 * Math.PI)) * width;
                const plotCurrentY = yOffset - func.fn(angle) * graphHeight * 0.3;
                if(isFinite(plotCurrentY)) {
                    ctx.fillStyle = func.color;
                    ctx.beginPath(); ctx.arc(currentX, plotCurrentY, 6, 0, 2 * Math.PI); ctx.fill();
                }

                ctx.fillStyle = func.color; ctx.font = 'bold 16px Segoe UI';
                ctx.fillText(func.name, 15, yOffset - graphHeight * 0.4);
            });
            updateDisplay(angle);
        }

        // --- ANIMATION & CONTROL FLOW ---
        function animate() {
            if (!isAnimating) {
                cancelAnimationFrame(animationId);
                animationId = null;
                return;
            }
            animationAngle += 0.01;
            angle = animationAngle % (2 * Math.PI);
            angleSlider.value = (angle * 180 / Math.PI).toFixed(0);
            document.getElementById('angleSliderValue').textContent = `${angleSlider.value}°`;
            drawCurrentScene();
            animationId = requestAnimationFrame(animate);
        }

        function drawCurrentScene() {
             switch (currentMode) {
                case 'unitCircle': drawUnitCircle(); break;
                case 'triangle': drawTriangle(); break;
                case 'waves': drawWaveGraphs(); break;
                default: drawUnitCircle();
            }
        }
        
        async function playCompleteStory() {
            setActiveButton(0); resetDemo();
            await narrator.speak("Welcome! Let's explore trigonometry step by step. First, we need to understand the parts of a right triangle.", 100);
            
            await narrator.speak("In a right triangle, we have three sides: the perpendicular, also called opposite, which is the side opposite to our angle. The base, also called adjacent, which is next to our angle. And the hypotenuse, which is the longest side opposite to the right angle.", 500);
            
            showTriangleMode();
            await narrator.speak("Now let's see these in action. The triangle shows the perpendicular in red, the base in orange, and the hypotenuse in pink.", 500);
            await wait(3000);
            
            await narrator.speak("The trigonometric functions are simply ratios of these sides. Sine equals perpendicular divided by hypotenuse. Cosine equals base divided by hypotenuse. Tangent equals perpendicular divided by base.", 500);
            await wait(3000);
            
            showUnitCircle();
            await narrator.speak("On the unit circle with radius 1, these ratios become coordinates. Cosine is the horizontal distance, sine is the vertical distance.", 500);
            isAnimating = true; if(!prefersReducedMotion) animate();
            await wait(4000); isAnimating = false;
            
            showWaveMode();
            await narrator.speak("When plotted, these functions create beautiful waves that repeat every 360 degrees.", 500);
            isAnimating = true; if(!prefersReducedMotion) animate();
            await wait(4000); isAnimating = false;

            showRealWorld();
            await narrator.speak("These functions help engineers design bridges, programmers create animations, and scientists understand waves and vibrations.", 500);
        }

        function showUnitCircle() { setActiveButton(1); resetDemo(); currentMode = 'unitCircle'; angleSlider.max = 360; drawCurrentScene(); narrator.speak("This is the unit circle. The horizontal orange line shows cosine, the vertical green line shows sine."); }
        function showTriangleMode() { setActiveButton(2); resetDemo(); currentMode = 'triangle'; angleSlider.max = 90; drawCurrentScene(); narrator.speak("Here's a right triangle. See the perpendicular in red, base in orange, and hypotenuse in pink. These are the building blocks of all trigonometric ratios."); }
        function showWaveMode() { setActiveButton(3); resetDemo(); currentMode = 'waves'; angleSlider.max = 360; drawCurrentScene(); narrator.speak("These are the wave forms of sine, cosine, and tangent. Notice how they repeat in patterns."); }
        async function showRealWorld() { setActiveButton(4); resetDemo(); currentMode = 'unitCircle'; angleSlider.max = 360; drawCurrentScene(); await narrator.speak("Engineers use these principles to analyze forces and design structures. The ratios help break down complex problems into manageable parts."); isAnimating = true; if(!prefersReducedMotion) animate(); }
        
        // --- HELPERS & EVENT LISTENERS ---
        function resetDemo() { isAnimating = false; if (animationId) cancelAnimationFrame(animationId); animationId = null; narrator.stop(); }
        function setActiveButton(index) { document.querySelectorAll('.demo-btn').forEach((btn, i) => btn.classList.toggle('active', i === index)); }
        function wait(ms) { return new Promise(resolve => setTimeout(resolve, ms)); }
        function debounce(func, delay) { let timeout; return function(...args) { clearTimeout(timeout); timeout = setTimeout(() => func.apply(this, args), delay); }; }
        
        angleSlider.addEventListener('input', (e) => {
            isAnimating = false;
            const degrees = parseInt(e.target.value, 10);
            angle = (degrees * Math.PI) / 180;
            document.getElementById('angleSliderValue').textContent = `${degrees}°`;
            drawCurrentScene();
        });

        document.getElementById('mute-btn').addEventListener('click', () => {
            const isEnabled = narrator.toggle();
            document.getElementById('mute-btn').classList.toggle('muted', !isEnabled);
        });

        window.addEventListener('keydown', (e) => {
            let currentAngleDeg = parseInt(angleSlider.value, 10);
            let step = e.shiftKey ? 10 : 1;
            if (e.code === 'ArrowRight') {
                currentAngleDeg = Math.min(parseInt(angleSlider.max, 10), currentAngleDeg + step);
            } else if (e.code === 'ArrowLeft') {
                currentAngleDeg = Math.max(0, currentAngleDeg - step);
            } else if (e.code === 'Space') {
                e.preventDefault();
                if (prefersReducedMotion) return;
                isAnimating = !isAnimating;
                if (isAnimating) animate();
            } else {
                return;
            }
            angleSlider.value = currentAngleDeg;
            angleSlider.dispatchEvent(new Event('input'));
        });

        window.addEventListener('load', () => {
            initCanvas();
            validateLayout();
            narrator.speak("Welcome to the trigonometry explorer! First, let's understand the parts of a right triangle, then we'll explore how they create the trigonometric functions.");
        });

        window.addEventListener('resize', debounce(initCanvas, 150));

        // --- VALIDATION FUNCTIONS (as required) ---
        function validateSceneComponents() {
            const checks = {
                hasCanvas: !!canvas && canvas.width > 0 && canvas.height > 0,
                hasInfoDisplay: !!document.getElementById('infoDisplay'),
                hasAngleValue: !!document.getElementById('angleValue'),
                hasSinValue: !!document.getElementById('sinValue'),
                initialValuesAreNumeric: !isNaN(parseFloat(document.getElementById('sinValue').textContent))
            };
            const failedChecks = Object.entries(checks).filter(([key, value]) => !value);
            if (failedChecks.length > 0) {
                console.error('Scene validation failed:', failedChecks.map(f => f[0]));
            }
            return failedChecks.length === 0;
        }

        function validateLayout() {
            const rect = canvas.getBoundingClientRect();
            const checks = {
                noHorizontalScroll: document.body.scrollWidth <= window.innerWidth + 2,
                canvasHasReasonableAspectRatio: rect.width > 0 && rect.height > 0 && (rect.width / rect.height) < 4,
                infoBoxOnScreen: (document.getElementById('infoDisplay').getBoundingClientRect().right < window.innerWidth)
            };
            const failedChecks = Object.entries(checks).filter(([key, value]) => !value);
             if (failedChecks.length > 0) {
                console.error('Layout validation failed:', failedChecks.map(f => f[0]));
            }
            return failedChecks.length === 0;
        }
    </script>
</body>
</html>