 <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Introduction to Geometry - Interactive Journey</title>
    <style>
        :root {
            --ease-cubic: cubic-bezier(0.42, 0, 0.58, 1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #0f0c29 0%, #302b63 50%, #24243e 100%);
            color: white;
            overflow-x: hidden;
            min-height: 100vh;
        }

        /* Audio Control */
        #audio-control {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
        }

        .control-btn {
            background: rgba(99, 102, 241, 0.9);
            border: none;
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.3s var(--ease-cubic);
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .control-btn:hover {
            transform: scale(1.1);
            background: rgba(99, 102, 241, 1);
            box-shadow: 0 8px 25px rgba(99, 102, 241, 0.4);
        }

        .control-btn.muted .unmute-icon { display: none; }
        .control-btn:not(.muted) .mute-icon { display: none; }

        /* Main Container */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem 1.25rem;
        }

        /* Header */
        .header {
            text-align: center;
            margin-bottom: 3rem;
            animation: fadeInDown 1s ease-out;
        }

        .header h1 {
            font-size: clamp(2rem, 5vw, 3.5rem);
            background: linear-gradient(45deg, #6366f1, #8b5cf6, #ec4899);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 1rem;
            font-weight: 700;
        }

        .header p {
            font-size: clamp(1rem, 2vw, 1.3rem);
            opacity: 0.9;
            max-width: 800px;
            margin: 0 auto;
            line-height: 1.6;
        }

        /* Canvas Stage */
        .canvas-stage {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            border-radius: 25px;
            padding: 1.25rem;
            margin: 2.5rem 0;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.4);
            border: 3px solid rgba(99, 102, 241, 0.3);
            position: relative;
        }

        #geometryCanvas {
            width: 100%;
            height: clamp(350px, 50vh, 500px);
            border-radius: 15px;
            background: radial-gradient(circle at center, 
                rgba(99, 102, 241, 0.05) 0%, 
                rgba(139, 92, 246, 0.05) 50%, 
                transparent 70%);
            display: block;
        }

        /* Info Display */
        .info-display {
            position: absolute;
            top: 1.5rem;
            left: 1.5rem;
            background: rgba(0, 0, 0, 0.8);
            padding: 1rem 1.25rem;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            border: 2px solid rgba(99, 102, 241, 0.3);
            max-width: min(250px, 40%);
            z-index: 10;
        }

        .info-item {
            margin: 0.5rem 0;
            font-size: clamp(0.85rem, 1.5vw, 0.95rem);
        }

        .info-label {
            color: #8b5cf6;
            font-weight: 600;
        }

        .info-value {
            color: #60a5fa;
            font-family: 'Courier New', monospace;
            font-weight: bold;
        }

        /* Controls */
        .controls {
            text-align: center;
            margin: 2.5rem 0;
        }

        .controls-title {
            font-size: clamp(1.5rem, 3vw, 2rem);
            margin-bottom: 1.5rem;
            color: #8b5cf6;
            font-weight: 600;
        }

        .demo-buttons {
            display: flex;
            justify-content: center;
            gap: 1.25rem;
            flex-wrap: wrap;
            margin: 1.5rem 0;
        }

        .demo-btn {
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            border: none;
            color: white;
            padding: 1rem 1.75rem;
            border-radius: 35px;
            font-size: clamp(0.95rem, 1.5vw, 1.1rem);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s var(--ease-cubic);
            box-shadow: 0 8px 25px rgba(99, 102, 241, 0.3);
            min-width: 160px;
        }

        .demo-btn:hover, .demo-btn:focus-visible {
            transform: translateY(-3px);
            box-shadow: 0 12px 30px rgba(99, 102, 241, 0.4);
            outline: none;
        }

        .demo-btn:active {
            transform: translateY(-1px);
        }

        .demo-btn.active {
            background: linear-gradient(135deg, #ec4899, #f43f5e);
            box-shadow: 0 8px 25px rgba(236, 72, 153, 0.4);
        }

        /* Concept Cards */
        .concept-section {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 25px;
            padding: 2rem;
            margin: 2rem 0;
            border: 3px solid rgba(99, 102, 241, 0.3);
            backdrop-filter: blur(15px);
        }

        .concept-title {
            font-size: clamp(1.3rem, 2.5vw, 1.8rem);
            color: #8b5cf6;
            margin-bottom: 1.5rem;
            text-align: center;
            font-weight: 600;
        }

        .concept-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(min(100%, 250px), 1fr));
            gap: 1.25rem;
            margin: 1.5rem 0;
        }

        .concept-card {
            background: rgba(255, 255, 255, 0.08);
            padding: 1.25rem;
            border-radius: 20px;
            text-align: center;
            border: 2px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s var(--ease-cubic);
        }

        .concept-card:hover {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.12);
            border-color: rgba(99, 102, 241, 0.5);
        }

        .concept-icon {
            font-size: 2.5rem;
            margin-bottom: 0.625rem;
        }

        .concept-name {
            font-size: clamp(1.1rem, 2vw, 1.3rem);
            margin-bottom: 0.625rem;
            color: #60a5fa;
            font-weight: 600;
        }

        .concept-description {
            font-size: clamp(0.85rem, 1.5vw, 0.95rem);
            opacity: 0.9;
            line-height: 1.5;
        }

        /* Formulas Section */
        .formula-section {
            background: rgba(0, 0, 0, 0.5);
            border-radius: 25px;
            padding: 2rem;
            margin: 2rem 0;
            border: 3px solid rgba(139, 92, 246, 0.4);
        }

        .formula-box {
            text-align: center;
            padding: 1.5rem;
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.15), rgba(236, 72, 153, 0.15));
            border-radius: 20px;
            border: 3px solid rgba(99, 102, 241, 0.4);
            margin-bottom: 1.5rem;
        }

        .formula-text {
            font-size: clamp(1.2rem, 2.5vw, 1.8rem);
            font-weight: bold;
            margin-bottom: 0.75rem;
            font-family: 'Courier New', monospace;
            color: #60a5fa;
        }

        .formula-explanation {
            font-size: clamp(0.9rem, 1.5vw, 1rem);
            color: #e2e8f0;
            line-height: 1.6;
            margin-top: 0.75rem;
        }

        /* Tool Controls */
        .tool-controls {
            background: rgba(0, 0, 0, 0.6);
            padding: 1.25rem;
            border-radius: 20px;
            margin: 1.25rem 0;
            backdrop-filter: blur(10px);
        }

        .tool-buttons {
            display: flex;
            justify-content: center;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .tool-btn {
            background: rgba(99, 102, 241, 0.3);
            border: 2px solid rgba(99, 102, 241, 0.5);
            color: white;
            padding: 0.625rem 1.25rem;
            border-radius: 25px;
            font-size: clamp(0.85rem, 1.5vw, 0.95rem);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .tool-btn:hover, .tool-btn:focus-visible {
            background: rgba(99, 102, 241, 0.5);
            transform: translateY(-2px);
            outline: none;
        }

        .tool-btn.active {
            background: rgba(236, 72, 153, 0.5);
            border-color: rgba(236, 72, 153, 0.7);
        }

        /* Applications */
        .applications {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 25px;
            padding: 2rem;
            margin: 2rem 0;
            border: 3px solid rgba(236, 72, 153, 0.4);
        }

        .app-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(min(100%, 280px), 1fr));
            gap: 1.5rem;
        }

        .app-card {
            background: linear-gradient(135deg, rgba(236, 72, 153, 0.1), rgba(99, 102, 241, 0.1));
            padding: 1.5rem;
            border-radius: 20px;
            border: 2px solid rgba(236, 72, 153, 0.3);
        }

        .app-icon {
            font-size: 2rem;
            margin-bottom: 0.625rem;
        }

        .app-title {
            font-size: clamp(1.1rem, 2vw, 1.3rem);
            color: #ec4899;
            margin-bottom: 0.625rem;
            font-weight: 600;
        }

        .app-description {
            line-height: 1.5;
            opacity: 0.9;
            font-size: clamp(0.85rem, 1.5vw, 0.95rem);
        }

        /* Animations */
        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Reduced motion preferences */
        @media (prefers-reduced-motion: reduce) {
            *,
            *::before,
            *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
                scroll-behavior: auto !important;
            }
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .canvas-stage {
                display: flex;
                flex-direction: column;
            }
            .info-display {
                position: relative;
                order: -1; /* Places info box before the canvas */
                max-width: 100%;
                margin-bottom: 1rem;
                top: auto;
                left: auto;
            }
            
            .demo-buttons, .tool-buttons {
                flex-direction: column;
                align-items: center;
            }
            
            .tool-btn {
                width: 100%;
                max-width: 350px;
            }
        }

        @media (max-width: 480px) {
            .container {
                padding: 1rem 0.75rem;
            }
            
            .canvas-stage {
                padding: 0.75rem;
            }
            
            #geometryCanvas {
                height: 300px;
            }
        }
    </style>
</head>
<body>
    <!-- Audio Control -->
    <div id="audio-control">
        <button id="mute-btn" class="control-btn" aria-label="Toggle sound">
            <span class="unmute-icon">?</span>
            <span class="mute-icon">?</span>
        </button>
    </div>

    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>Introduction to Geometry</h1>
            <p>Discover the fundamental shapes and principles that form the foundation of mathematics and the world around us.</p>
        </div>

        <!-- Canvas Stage -->
        <div class="canvas-stage">
            <canvas id="geometryCanvas" tabindex="0" role="application" aria-label="Interactive geometry demonstration canvas"></canvas>
            <div class="info-display" id="infoDisplay" aria-live="polite">
                <div class="info-item">
                    <span class="info-label">Shape:</span>
                    <span class="info-value" id="currentShape">Point</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Elements:</span>
                    <span class="info-value" id="elementCount">1</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Properties:</span>
                    <span class="info-value" id="properties">Position</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Dimension:</span>
                    <span class="info-value" id="dimension">0D</span>
                </div>
            </div>
        </div>

        <!-- Tool Controls -->
        <div class="tool-controls">
            <div class="tool-buttons">
                <button class="tool-btn" onclick="setTool('point', this)">? Point</button>
                <button class="tool-btn" onclick="setTool('line', this)">? Line</button>
                <button class="tool-btn" onclick="setTool('angle', this)">? Angle</button>
                <button class="tool-btn" onclick="setTool('triangle', this)">? Triangle</button>
                <button class="tool-btn" onclick="setTool('circle', this)">? Circle</button>
                <button class="tool-btn" onclick="clearCanvas()">?? Clear</button>
            </div>
        </div>

        <!-- Controls -->
        <div class="controls">
            <div class="controls-title">Interactive Demonstrations</div>
            
            <div class="demo-buttons">
                <button class="demo-btn" onclick="playCompleteStory()">? Complete Journey</button>
                <button class="demo-btn" onclick="showBasicElements()">? Basic Elements</button>
                <button class="demo-btn" onclick="showShapeTransformations()">? Transformations</button>
                <button class="demo-btn" onclick="showAngleExploration()">? Angles & Lines</button>
                <button class="demo-btn" onclick="showShapeConstruction()">?? Construction</button>
            </div>
        </div>

        <!-- Concept Section -->
        <div class="concept-section">
            <div class="concept-title">? Fundamental Concepts</div>
            
            <div class="concept-grid">
                <div class="concept-card">
                    <div class="concept-icon">?</div>
                    <div class="concept-name">Point</div>
                    <div class="concept-description">
                        The most basic element in geometry. Has position but no size, length, width, or height.
                    </div>
                </div>
                <div class="concept-card">
                    <div class="concept-icon">?</div>
                    <div class="concept-name">Line</div>
                    <div class="concept-description">
                        Extends infinitely in both directions. Defined by any two points on it.
                    </div>
                </div>
                <div class="concept-card">
                    <div class="concept-icon">?</div>
                    <div class="concept-name">Angle</div>
                    <div class="concept-description">
                        Formed by two rays sharing a common endpoint called the vertex.
                    </div>
                </div>
                <div class="concept-card">
                    <div class="concept-icon">?</div>
                    <div class="concept-name">Plane</div>
                    <div class="concept-description">
                        A flat surface extending infinitely in all directions. Contains infinite lines and points.
                    </div>
                </div>
            </div>
        </div>

        <!-- Formula Section -->
        <div class="formula-section">
            <div class="concept-title">? Essential Formulas</div>
            
            <div class="formula-box">
                <div class="formula-text">Distance = &radic;[(x?&minus;x?)� + (y?&minus;y?)�]</div>
                <div class="formula-explanation">
                    The distance formula calculates the length between any two points in a plane.
                </div>
            </div>

            <div class="formula-box">
                <div class="formula-text">Perimeter = Sum of all sides</div>
                <div class="formula-explanation">
                    The total distance around the boundary of a shape.
                </div>
            </div>

            <div class="formula-box">
                <div class="formula-text">Area = Base &times; Height (Rectangle)</div>
                <div class="formula-explanation">
                    The amount of space inside a 2D shape, measured in square units.
                </div>
            </div>
        </div>

        <!-- Applications -->
        <div class="applications">
            <div class="concept-title">? Real-World Applications</div>
            
            <div class="app-grid">
                <div class="app-card">
                    <div class="app-icon">??</div>
                    <div class="app-title">Architecture</div>
                    <div class="app-description">
                        Geometry is essential for designing buildings, ensuring structural stability and aesthetic appeal.
                    </div>
                </div>
                <div class="app-card">
                    <div class="app-icon">?</div>
                    <div class="app-title">Computer Graphics</div>
                    <div class="app-description">
                        Video games and animations use geometry to create realistic 3D worlds and special effects.
                    </div>
                </div>
                <div class="app-card">
                    <div class="app-icon">??</div>
                    <div class="app-title">Navigation</div>
                    <div class="app-description">
                        GPS systems use geometric calculations to determine positions and find shortest paths.
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Canvas Setup
        const canvas = document.getElementById('geometryCanvas');
        const ctx = canvas.getContext('2d');
        let animationId = null;
        let currentTool = 'point';
        let shapes = [];
        let isDrawing = false;
        let startPoint = null;
        let prefersReducedMotion = false;

        // Voice System
        class GeometryNarrator {
            constructor() {
                this.isEnabled = true;
                this.currentUtterance = null;
                this.settings = { 
                    rate: 0.9, 
                    pitch: 1.1, 
                    volume: 0.8,
                    lang: 'en-GB'
                };
            }

            async speak(text, delay = 0) {
                if (!this.isEnabled || !text) return;
                
                return new Promise((resolve) => {
                    setTimeout(() => {
                        this.stop();
                        const utterance = new SpeechSynthesisUtterance(text);
                        Object.assign(utterance, this.settings);
                        
                        const voices = speechSynthesis.getVoices();
                        const femaleVoice = voices.find(v => 
                            (v.lang === 'en-GB' || v.lang.startsWith('en-')) && 
                            (v.name.toLowerCase().includes('female') || v.name.toLowerCase().includes('woman') || v.gender === 'female')
                        );
                        const enGBVoice = femaleVoice || voices.find(v => v.lang === 'en-GB' || v.lang.startsWith('en-'));
                        if (enGBVoice) utterance.voice = enGBVoice;
                        
                        utterance.onend = resolve;
                        utterance.onerror = (e) => {
                            console.error("Speech synthesis error:", e);
                            resolve();
                        };
                        
                        this.currentUtterance = utterance;
                        speechSynthesis.speak(utterance);
                    }, delay);
                });
            }

            stop() {
                if (speechSynthesis.speaking) {
                    speechSynthesis.cancel();
                }
                this.currentUtterance = null;
            }

            toggle() {
                this.isEnabled = !this.isEnabled;
                if (!this.isEnabled) this.stop();
                return this.isEnabled;
            }
        }

        const narrator = new GeometryNarrator();

        function initCanvas() {
            const container = canvas.parentElement;
            const rect = container.getBoundingClientRect();
            const dpr = window.devicePixelRatio || 1;
            
            canvas.width = rect.width * dpr;
            canvas.height = canvas.clientHeight * dpr;
            
            ctx.scale(dpr, dpr);
        }
        
        function drawGrid() {
            const width = canvas.clientWidth;
            const height = canvas.clientHeight;
            const gridSize = 40;
            
            ctx.strokeStyle = 'rgba(99, 102, 241, 0.1)';
            ctx.lineWidth = 0.5;
            
            for (let x = 0; x <= width; x += gridSize) {
                ctx.beginPath();
                ctx.moveTo(x, 0);
                ctx.lineTo(x, height);
                ctx.stroke();
            }
            
            for (let y = 0; y <= height; y += gridSize) {
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(width, y);
                ctx.stroke();
            }
            
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.2)';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(width / 2, 0);
            ctx.lineTo(width / 2, height);
            ctx.moveTo(0, height / 2);
            ctx.lineTo(width, height / 2);
            ctx.stroke();
        }

        function clearCanvas() {
            cancelAnimationFrame(animationId);
            animationId = null;
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            drawGrid();
            if (!isDrawing) {
                 shapes = [];
                 updateInfo('Canvas', '0', 'Empty', '2D');
            }
        }

        function updateInfo(shape, count, props, dim) {
            document.getElementById('currentShape').textContent = shape;
            document.getElementById('elementCount').textContent = count;
            document.getElementById('properties').textContent = props;
            document.getElementById('dimension').textContent = dim;
        }

        function setTool(tool, element) {
            currentTool = tool;
            document.querySelectorAll('.tool-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            if (element) element.classList.add('active');
        }

        function drawPoint(x, y, color = '#60a5fa', size = 8) {
            ctx.fillStyle = color;
            ctx.shadowColor = color;
            ctx.shadowBlur = 15;
            ctx.beginPath();
            ctx.arc(x, y, size, 0, 2 * Math.PI);
            ctx.fill();
            ctx.shadowBlur = 0;
        }

        function drawLine(x1, y1, x2, y2, color = '#8b5cf6', width = 3) {
            ctx.strokeStyle = color;
            ctx.lineWidth = width;
            ctx.beginPath();
            ctx.moveTo(x1, y1);
            ctx.lineTo(x2, y2);
            ctx.stroke();
        }

        function drawAngle(x, y, angle1, angle2, radius = 50) {
            ctx.lineWidth = 3;
            
            const x1 = x + radius * Math.cos(angle1);
            const y1 = y + radius * Math.sin(angle1);
            const x2 = x + radius * Math.cos(angle2);
            const y2 = y + radius * Math.sin(angle2);
            
            drawLine(x, y, x1, y1, '#ec4899');
            drawLine(x, y, x2, y2, '#ec4899');
            
            ctx.strokeStyle = '#60a5fa';
            ctx.beginPath();
            ctx.arc(x, y, radius / 3, angle1, angle2);
            ctx.stroke();
            
            drawPoint(x, y, '#fbbf24', 6);
        }

        function drawTriangle(x1, y1, x2, y2, x3, y3, fill = false) {
            ctx.strokeStyle = '#8b5cf6';
            ctx.fillStyle = 'rgba(139, 92, 246, 0.2)';
            ctx.lineWidth = 3;
            
            ctx.beginPath();
            ctx.moveTo(x1, y1);
            ctx.lineTo(x2, y2);
            ctx.lineTo(x3, y3);
            ctx.closePath();
            
            if (fill) ctx.fill();
            ctx.stroke();
            
            drawPoint(x1, y1); drawPoint(x2, y2); drawPoint(x3, y3);
        }

        function drawCircle(x, y, radius, fill = false) {
            ctx.strokeStyle = '#ec4899';
            ctx.fillStyle = 'rgba(236, 72, 153, 0.2)';
            ctx.lineWidth = 3;
            
            ctx.beginPath();
            ctx.arc(x, y, radius, 0, 2 * Math.PI);
            
            if (fill) ctx.fill();
            ctx.stroke();
            
            drawPoint(x, y, '#fbbf24', 6);
        }

        async function playCompleteStory() {
            setActiveButton(0);
            clearCanvas();
            
            const width = canvas.clientWidth;
            const height = canvas.clientHeight;
            const cx = width / 2, cy = height / 2;
            
            await narrator.speak("Welcome to the fascinating world of geometry! Let's begin our journey with the most fundamental building blocks.", 100);
            
            await narrator.speak("Everything starts with a point. It has position but no size.", 500);
            drawPoint(cx, cy); updateInfo('Point', '1', 'Position', '0D');
            await wait(1500);
            
            await narrator.speak("Connect two points and you create a line segment. A line extends infinitely.", 500);
            clearCanvas();
            drawLine(cx - 150, cy, cx + 150, cy); drawPoint(cx - 150, cy); drawPoint(cx + 150, cy);
            updateInfo('Line', '1', 'Length', '1D');
            await wait(2000);
            
            await narrator.speak("When two lines meet, they form an angle.", 500);
            clearCanvas();
            drawAngle(cx, cy, 0, Math.PI / 3, 100); updateInfo('Angle', '1', '60�', '2D');
            await wait(2000);
            
            await narrator.speak("Three points form a triangle, the simplest polygon.", 500);
            clearCanvas();
            drawTriangle(cx, cy - 80, cx - 100, cy + 60, cx + 100, cy + 60, true);
            updateInfo('Triangle', '1', '3 Sides', '2D');
            await wait(2000);
            
            await narrator.speak("A circle is all points equidistant from a centre.", 500);
            clearCanvas();
            drawCircle(cx, cy, 80, true); updateInfo('Circle', '1', 'Radius', '2D');
            await wait(2000);
            
            await narrator.speak("By combining these, we create complex shapes. Geometry is everywhere!", 500);
            clearCanvas();
            drawTriangle(cx, cy - 80, cx - 60, cy - 20, cx + 60, cy - 20, true);
            ctx.fillStyle = 'rgba(139, 92, 246, 0.2)'; ctx.fillRect(cx - 60, cy - 20, 120, 100);
            updateInfo('Composition', 'Multiple', 'Combined', '2D');
        }

        async function showBasicElements() {
            setActiveButton(1);
            clearCanvas();
            const w = canvas.clientWidth, h = canvas.clientHeight;
            await narrator.speak("Here are the basic elements of geometry.", 200);
            drawPoint(w*0.2, h*0.3, '#60a5fa', 10);
            drawLine(w*0.4, h*0.2, w*0.6, h*0.4);
            drawAngle(w*0.2, h*0.7, 0, Math.PI/2, 60);
            drawTriangle(w*0.5, h*0.6, w*0.4, h*0.8, w*0.6, h*0.8, true);
            drawCircle(w*0.8, h*0.7, 50, true);
            updateInfo('All Elements', 'Multiple', 'Various', 'Mixed');
        }

        async function showShapeTransformations() {
            setActiveButton(2);
            clearCanvas();
            
            const w = canvas.clientWidth, h = canvas.clientHeight;
            const cx = w / 2, cy = h / 2;
            
            await narrator.speak("Shapes can be transformed through translation, rotation, and scaling.", 200);

            if (prefersReducedMotion) {
                // Static snapshot for reduced motion
                clearCanvas();
                ctx.save();
                ctx.translate(cx - 150, cy); ctx.rotate(Math.PI / 4);
                drawTriangle(-40, -40, 40, -40, 0, 40, true);
                ctx.restore();
                ctx.save();
                ctx.translate(cx, cy); ctx.scale(1.2, 1.2);
                ctx.strokeStyle = '#8b5cf6'; ctx.fillStyle = 'rgba(139, 92, 246, 0.2)';
                ctx.fillRect(-40, -40, 80, 80); ctx.strokeRect(-40, -40, 80, 80);
                ctx.restore();
                drawCircle(cx + 150, cy, 40, true);
                updateInfo('Transformations', '3', 'Static', '2D');
                return;
            }

            let startTime = null;
            const duration = 12000; // 12 second loop

            const animate = (timestamp) => {
                if (!startTime) startTime = timestamp;
                const elapsed = timestamp - startTime;
                const progress = (elapsed % duration) / duration;

                clearCanvas();
                
                const angle = 2 * Math.PI * progress;
                const scale = 1.0 + 0.5 * Math.sin(progress * 2 * Math.PI);
                const circleX = cx + 150 + Math.sin(angle * 2) * 30;

                // Rotating triangle
                ctx.save();
                ctx.translate(cx - 150, cy); ctx.rotate(angle);
                drawTriangle(-40, -40, 40, -40, 0, 40, true);
                ctx.restore();
                
                // Scaling square
                ctx.save();
                ctx.translate(cx, cy); ctx.scale(scale, scale);
                ctx.strokeStyle = '#8b5cf6'; ctx.fillStyle = 'rgba(139, 92, 246, 0.2)';
                ctx.lineWidth = 3; ctx.fillRect(-40, -40, 80, 80); ctx.strokeRect(-40, -40, 80, 80);
                ctx.restore();
                
                // Translating circle
                drawCircle(circleX, cy, 40, true);
                
                updateInfo('Transformations', '3', 'Rotate, Scale, Move', '2D');
                animationId = requestAnimationFrame(animate);
            };
            
            startTime = null; // Reset time for new animation
            animationId = requestAnimationFrame(animate);
        }

        async function showAngleExploration() {
            setActiveButton(3);
            clearCanvas();
            const w = canvas.clientWidth, h = canvas.clientHeight;
            await narrator.speak("Let's explore different types of angles and lines.", 200);

            ctx.fillStyle = 'white'; ctx.font = '14px Segoe UI'; ctx.textAlign = 'center';
            drawAngle(w*0.2, h*0.3, 0, Math.PI/4, 60); ctx.fillText('Acute (<90�)', w*0.2, h*0.3 + 85);
            drawAngle(w*0.5, h*0.3, 0, Math.PI/2, 60); ctx.fillText('Right (90�)', w*0.5, h*0.3 + 85);
            drawAngle(w*0.8, h*0.3, 0, 3*Math.PI/4, 60); ctx.fillText('Obtuse (>90�)', w*0.8, h*0.3 + 85);
            
            drawLine(w*0.2, h*0.7, w*0.8, h*0.7); drawLine(w*0.2, h*0.8, w*0.8, h*0.8);
            ctx.fillText('Parallel Lines', w*0.5, h*0.75 - 8);
            
            updateInfo('Angles & Lines', 'Multiple', 'Types', '2D');
        }

        async function showShapeConstruction() {
            setActiveButton(4);
            clearCanvas();
            const w = canvas.clientWidth, h = canvas.clientHeight;
            const cx = w/2, cy = h/2;
            
            await narrator.speak("Watch how complex shapes are constructed step by step.", 200);
            
            if (prefersReducedMotion) {
                drawTriangle(cx, cy - 100, cx - 80, cy, cx + 80, cy, true);
                drawCircle(cx, cy + 50, 40, true);
                updateInfo('Construction', 'Static', 'Composite', '2D');
                return;
            }
            
            await wait(500); drawPoint(cx, cy - 100);
            await wait(500); drawPoint(cx-80, cy);
            await wait(500); drawPoint(cx+80, cy);
            
            await wait(500); drawLine(cx, cy - 100, cx - 80, cy);
            await wait(500); drawLine(cx-80, cy, cx+80, cy);
            await wait(500); drawLine(cx+80, cy, cx, cy - 100);
            
            await wait(500); drawCircle(cx, cy + 50, 40, true);
            
            updateInfo('Construction', 'Composite', 'House-like', '2D');
            await narrator.speak("A new shape from a triangle and a circle!");
        }

        function setActiveButton(index) {
            if (animationId) cancelAnimationFrame(animationId);
            animationId = null;
            document.querySelectorAll('.demo-btn').forEach((btn, i) => {
                btn.classList.toggle('active', i === index);
            });
        }

        function wait(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }
        
        function getCanvasMousePos(e) {
            const rect = canvas.getBoundingClientRect();
            return {
                x: e.clientX - rect.left,
                y: e.clientY - rect.top
            };
        }

        canvas.addEventListener('mousedown', (e) => {
            const pos = getCanvasMousePos(e);
            if (currentTool === 'point') {
                drawPoint(pos.x, pos.y);
                shapes.push({ type: 'point', x: pos.x, y: pos.y });
            } else if (['line', 'circle'].includes(currentTool)) {
                isDrawing = true;
                startPoint = pos;
            }
        });

        canvas.addEventListener('mousemove', (e) => {
            if (!isDrawing || !startPoint) return;
            const pos = getCanvasMousePos(e);
            
            clearCanvas();
            shapes.forEach(s => {
                if(s.type === 'point') drawPoint(s.x, s.y);
            });

            if (currentTool === 'line') {
                drawLine(startPoint.x, startPoint.y, pos.x, pos.y);
            } else if (currentTool === 'circle') {
                const radius = Math.hypot(pos.x - startPoint.x, pos.y - startPoint.y);
                drawCircle(startPoint.x, startPoint.y, radius);
            }
        });

        canvas.addEventListener('mouseup', (e) => {
            if (!isDrawing || !startPoint) return;
            const pos = getCanvasMousePos(e);
            
            if (currentTool === 'line') {
                shapes.push({ type: 'line', x1: startPoint.x, y1: startPoint.y, x2: pos.x, y2: pos.y });
            } else if (currentTool === 'circle') {
                const radius = Math.hypot(pos.x - startPoint.x, pos.y - startPoint.y);
                shapes.push({ type: 'circle', x: startPoint.x, y: startPoint.y, radius });
            }
            
            isDrawing = false;
            startPoint = null;
        });

        document.getElementById('mute-btn').addEventListener('click', () => {
            const isEnabled = narrator.toggle();
            document.getElementById('mute-btn').classList.toggle('muted', !isEnabled);
        });

        
        function validateSceneComponents() {
            const errors = [];
            if (!ctx) errors.push("Canvas 2D context couldn't be created.");
            const requiredIds = ['infoDisplay', 'currentShape', 'elementCount', 'properties', 'dimension'];
            requiredIds.forEach(id => {
                if (!document.getElementById(id)) errors.push(`Required element #${id} is missing.`);
            });

            if (errors.length) {
                console.error("Scene Validation Failed:", errors);
                return false;
            }
            return true;
        }

        function validateLayout() {
            const errors = [];
            if (document.body.scrollWidth > window.innerWidth) {
                errors.push("Horizontal overflow detected.");
            }
            document.querySelectorAll('.demo-btn, .tool-btn, .control-btn').forEach(el => {
                const rect = el.getBoundingClientRect();
                if (rect.width < 44 || rect.height < 44) {
                    errors.push(`Touch target too small (<44px) for element: ${el.outerHTML.slice(0, 60)}...`);
                }
            });

            if (errors.length) {
                console.warn("Layout Validation Warnings:", errors);
                return false;
            }
            return true;
        }

        function debounce(func, delay = 150) {
            let timeoutId;
            return (...args) => {
                clearTimeout(timeoutId);
                timeoutId = setTimeout(() => func.apply(this, args), delay);
            };
        }

        const handleResize = () => {
            initCanvas();
            clearCanvas(); // This also cancels any animation frame
            shapes = []; // Clear user drawings on resize for simplicity
            validateLayout();
        };

        window.addEventListener('load', () => {
            if (speechSynthesis.onvoiceschanged !== undefined) {
                speechSynthesis.onvoiceschanged = () => speechSynthesis.getVoices();
            }
            
            const motionQuery = window.matchMedia('(prefers-reduced-motion: reduce)');
            prefersReducedMotion = motionQuery.matches;
            motionQuery.addEventListener('change', () => {
                prefersReducedMotion = motionQuery.matches;
            });

            initCanvas();
            clearCanvas();
            setTool('point', document.querySelector('.tool-btn'));
            
            validateSceneComponents();
            validateLayout();
            
            narrator.speak("Welcome! Click a demonstration button to begin your journey into geometry.", 500);
        });

        window.addEventListener('resize', debounce(handleResize, 150));

        window.addEventListener('keydown', e => {
            if (e.code === 'Space' && document.activeElement === document.body) {
                e.preventDefault();
                const firstDemo = document.querySelector('.demo-btn');
                if (firstDemo) firstDemo.click();
            }
            if (e.code === 'KeyM') {
                document.getElementById('mute-btn').click();
            }
        });

    </script>
</body>
</html> 
