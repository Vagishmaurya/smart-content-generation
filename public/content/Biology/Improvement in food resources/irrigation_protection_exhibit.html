<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Irrigation and Crop Protection - Complete Water & Protection Journey</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tween.js/18.6.4/tween.umd.js"></script>

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #0277BD 0%, #0288D1 50%, #03A9F4 100%);
            color: white;
            overflow: hidden;
            position: relative;
            height: 100vh;
        }

        /* Animated Background */
        .bg-animation {
            position: fixed;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: 0;
            opacity: 0.1;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 320"><path fill="%23ffffff" fill-opacity="0.2" d="M0,224L48,240C96,256,192,288,288,282.7C384,277,480,235,576,224C672,213,768,235,864,250.7C960,267,1056,277,1152,261.3C1248,245,1344,203,1392,181.3L1440,160L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z"></path></svg>') repeat-x;
            animation: wave 22s linear infinite;
        }

        @keyframes wave {
            0% { background-position-x: 0; }
            100% { background-position-x: 1440px; }
        }

        /* Museum Interface - Compact Header */
        .museum-header {
            position: absolute;
            top: 10px;
            left: 20px;
            text-align: left;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            padding: 10px 18px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .museum-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 4px;
            background: linear-gradient(45deg, #03A9F4, #4CAF50);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: titleGlow 3s ease-in-out infinite;
        }

        @keyframes titleGlow {
            0%, 100% { filter: brightness(1); }
            50% { filter: brightness(1.2); }
        }

        .exhibit-subtitle {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.8);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .water-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            background: #03A9F4;
            border-radius: 50%;
            animation: water-pulse 2s ease-in-out infinite;
        }

        @keyframes water-pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.3); opacity: 0.7; }
        }

        /* Journey Navigation - Enhanced */
        .journey-navigation {
            position: absolute;
            bottom: 20px;
            left: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            padding: 15px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            max-width: 340px;
        }

        .journey-title {
            font-size: 14px;
            font-weight: 600;
            color: #03A9F4;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .journey-steps {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }

        .journey-btn {
            background: rgba(3, 169, 244, 0.2);
            border: 1px solid rgba(3, 169, 244, 0.4);
            color: white;
            padding: 6px 10px;
            border-radius: 20px;
            font-size: 11px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 4px;
            white-space: nowrap;
        }

        .journey-btn:hover {
            background: rgba(3, 169, 244, 0.3);
            border-color: #03A9F4;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(3, 169, 244, 0.3);
        }

        .journey-btn.active {
            background: linear-gradient(135deg, #FF5722, #F44336);
            border-color: #FF5722;
            box-shadow: 0 0 20px rgba(255, 87, 34, 0.5);
            animation: pulse 2s infinite;
        }

        .journey-btn.completed {
            background: rgba(76, 175, 80, 0.3);
            border-color: #4CAF50;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        /* 3D Model Container */
        .model-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 0;
            overflow: hidden;
            border: none;
            z-index: 100;
        }

        .sketchfab-embed-wrapper {
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #0277BD 0%, #0288D1 50%, #03A9F4 100%);
        }

        .sketchfab-embed-wrapper iframe {
            width: 100%;
            height: 100%;
            border: none;
            border-radius: 0;
        }

        /* Information Panel - Enhanced */
        .info-panel {
            position: absolute;
            top: 70px;
            right: 20px;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(25px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 16px;
            padding: 24px;
            width: 380px;
            max-height: calc(100vh - 140px);
            z-index: 800;
            overflow-y: auto;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }

        .info-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        }

        .info-icon {
            font-size: 28px;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        .info-title {
            flex: 1;
        }

        .info-title h2 {
            font-size: 18px;
            color: #03A9F4;
            margin-bottom: 4px;
        }

        .info-subtitle {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.7);
        }

        .info-content {
            color: rgba(255, 255, 255, 0.9);
            font-size: 14px;
            line-height: 1.6;
        }

        /* Progress Tracker */
        .progress-tracker {
            background: linear-gradient(135deg, rgba(3, 169, 244, 0.1), rgba(76, 175, 80, 0.1));
            border: 1px solid rgba(3, 169, 244, 0.3);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 20px;
        }

        .progress-header {
            font-size: 13px;
            font-weight: 600;
            color: #03A9F4;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .progress-percentage {
            font-size: 18px;
            color: #FF5722;
            font-weight: 700;
        }

        .progress-bar {
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 12px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #03A9F4, #FF5722);
            border-radius: 4px;
            transition: width 0.8s ease;
            box-shadow: 0 0 10px rgba(255, 87, 34, 0.5);
        }

        .progress-steps-mini {
            display: flex;
            justify-content: space-between;
            font-size: 10px;
            color: rgba(255, 255, 255, 0.6);
        }

        .step-mini {
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .step-mini.active {
            color: #FF5722;
            font-weight: 600;
        }

        .step-mini.completed {
            color: #4CAF50;
        }

        /* Information Cards */
        .info-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 14px;
            margin-bottom: 14px;
        }

        .info-card-title {
            color: #03A9F4;
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .info-card-content {
            color: rgba(255, 255, 255, 0.85);
            font-size: 12px;
            line-height: 1.5;
        }

        .info-list {
            list-style: none;
            padding: 0;
        }

        .info-list li {
            padding: 6px 0;
            padding-left: 20px;
            position: relative;
            font-size: 12px;
            color: rgba(255, 255, 255, 0.8);
        }

        .info-list li:before {
            content: "💧";
            position: absolute;
            left: 0;
            color: #03A9F4;
        }

        /* Fun Fact Box */
        .fun-fact {
            background: linear-gradient(135deg, rgba(255, 87, 34, 0.1), rgba(3, 169, 244, 0.1));
            border: 1px solid rgba(255, 87, 34, 0.3);
            border-radius: 12px;
            padding: 14px;
            margin: 16px 0;
            position: relative;
            overflow: hidden;
        }

        .fun-fact:before {
            content: "🚰";
            position: absolute;
            top: -20px;
            right: -20px;
            font-size: 60px;
            opacity: 0.1;
        }

        .fun-fact-title {
            color: #FF5722;
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 6px;
        }

        .fun-fact-text {
            color: rgba(255, 255, 255, 0.9);
            font-size: 12px;
            line-height: 1.5;
            position: relative;
            z-index: 1;
        }

        /* Voice Controls */
        .voice-controls {
            position: absolute;
            top: 10px;
            right: 20px;
            display: flex;
            gap: 8px;
            z-index: 1000;
        }

        .control-btn {
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            width: 44px;
            height: 44px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            position: relative;
        }

        .control-btn:hover {
            background: rgba(3, 169, 244, 0.3);
            border-color: #03A9F4;
            transform: scale(1.1);
        }

        .control-btn.active {
            background: rgba(3, 169, 244, 0.4);
            border-color: #03A9F4;
            box-shadow: 0 0 20px rgba(3, 169, 244, 0.5);
        }

        .control-tooltip {
            position: absolute;
            bottom: -30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9);
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 10px;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .control-btn:hover .control-tooltip {
            opacity: 1;
        }

        /* Loading Screen */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #0277BD 0%, #0288D1 50%, #03A9F4 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            transition: opacity 1s ease;
        }

        .loading-content {
            text-align: center;
        }

        .loading-heart {
            font-size: 60px;
            animation: water-pulse 1.5s ease-in-out infinite;
            margin-bottom: 20px;
        }

        .loading-text {
            color: white;
            font-size: 20px;
            margin-bottom: 20px;
        }

        .loading-progress {
            width: 200px;
            height: 4px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 2px;
            overflow: hidden;
        }

        .loading-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #03A9F4, #FF5722);
            animation: loading 2s ease-in-out infinite;
        }

        @keyframes loading {
            0% { width: 0%; }
            50% { width: 100%; }
            100% { width: 0%; }
        }

        /* Voice Indicator */
        .voice-indicator {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(3, 169, 244, 0.5);
            border-radius: 30px;
            padding: 14px 28px;
            display: flex;
            align-items: center;
            gap: 12px;
            z-index: 1000;
            opacity: 0;
            transition: all 0.3s ease;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }

        .voice-indicator.visible {
            opacity: 1;
            transform: translateX(-50%) translateY(-10px);
        }

        .voice-waves {
            display: flex;
            align-items: center;
            gap: 3px;
        }

        .voice-wave {
            width: 3px;
            height: 20px;
            background: linear-gradient(180deg, #03A9F4, #FF5722);
            border-radius: 2px;
            animation: voice-wave 1s ease-in-out infinite;
        }

        .voice-wave:nth-child(2) { animation-delay: 0.1s; }
        .voice-wave:nth-child(3) { animation-delay: 0.2s; }
        .voice-wave:nth-child(4) { animation-delay: 0.3s; }
        .voice-wave:nth-child(5) { animation-delay: 0.4s; }

        @keyframes voice-wave {
            0%, 100% { transform: scaleY(0.3); }
            50% { transform: scaleY(1); }
        }

        .narration-text {
            color: white;
            font-size: 13px;
            max-width: 300px;
        }

        /* Quick Actions */
        .quick-actions {
            position: absolute;
            bottom: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            z-index: 1000;
        }

        .action-btn {
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 10px 16px;
            border-radius: 25px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
        }

        .action-btn:hover {
            background: rgba(3, 169, 244, 0.3);
            border-color: #03A9F4;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(3, 169, 244, 0.3);
        }

        /* Custom Scrollbar */
        .info-panel::-webkit-scrollbar {
            width: 6px;
        }

        .info-panel::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 3px;
        }

        .info-panel::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, #03A9F4, #FF5722);
            border-radius: 3px;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .info-panel {
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                top: auto;
                width: 100%;
                max-height: 50vh;
                border-radius: 20px 20px 0 0;
            }
            
            .journey-navigation {
                bottom: 52vh;
                max-width: calc(100% - 40px);
            }
            
            .voice-controls {
                top: auto;
                bottom: 55vh;
                right: 10px;
            }
            
            .quick-actions {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="bg-animation"></div>

    <!-- Loading Screen -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-content">
            <div class="loading-heart">💧</div>
            <div class="loading-text">Preparing Your Irrigation Journey...</div>
            <div class="loading-progress">
                <div class="loading-progress-bar"></div>
            </div>
        </div>
    </div>

    <!-- Museum Header -->
    <div class="museum-header">
        <div class="museum-title">Irrigation and Crop Protection</div>
        <div class="exhibit-subtitle">
            <span class="water-indicator"></span>
            Water Management & Plant Protection
        </div>
    </div>

    <!-- Journey Navigation -->
    <div class="journey-navigation">
        <div class="journey-title">
            <span>🗺️</span>
            <span>Water & Protection Journey</span>
        </div>
        <div class="journey-steps">
            <button class="journey-btn active" onclick="loadJourneyStep('irrigation')">
                <span>💧</span> Irrigation
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('systems')">
                <span>🚰</span> Systems
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('patterns')">
                <span>🌱</span> Patterns
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('rotation')">
                <span>🔄</span> Rotation
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('weeds')">
                <span>🌿</span> Weeds
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('pests')">
                <span>🐛</span> Pests
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('diseases')">
                <span>🦠</span> Diseases
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('storage')">
                <span>📦</span> Storage
            </button>
        </div>
    </div>

    <!-- 3D Model Container -->
    <div class="model-container">
        <div class="sketchfab-embed-wrapper">
            <iframe id="api-frame"
                    title="Irrigation Model" 
                    frameborder="0" 
                    allowfullscreen 
                    mozallowfullscreen="true" 
                    webkitallowfullscreen="true" 
                    allow="autoplay; fullscreen; xr-spatial-tracking"
                    xr-spatial-tracking 
                    execution-while-out-of-viewport 
                    execution-while-not-rendered 
                    web-share 
                    src="https://sketchfab.com/models/5a92388c6f4e426cb5dda8f26b190eba/embed?autostart=1&internal=1&tracking=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_watermark=0">
            </iframe>
        </div>
    </div>

    <!-- Information Panel -->
    <div class="info-panel" id="infoPanel">
        <div class="info-header">
            <div class="info-icon" id="stepIcon">💧</div>
            <div class="info-title">
                <h2 id="stepTitle">Irrigation Fundamentals - Water for Life</h2>
                <div class="info-subtitle" id="stepSubtitle">Essential water management</div>
            </div>
        </div>

        <!-- Progress Tracker -->
        <div class="progress-tracker">
            <div class="progress-header">
                <span>Water Management Progress</span>
                <span class="progress-percentage" id="progressPercent">0%</span>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 0%"></div>
            </div>
            <div class="progress-steps-mini">
                <span class="step-mini active" onclick="loadJourneyStep('irrigation')">Irr</span>
                <span class="step-mini" onclick="loadJourneyStep('systems')">Sys</span>
                <span class="step-mini" onclick="loadJourneyStep('patterns')">Pat</span>
                <span class="step-mini" onclick="loadJourneyStep('rotation')">Rot</span>
                <span class="step-mini" onclick="loadJourneyStep('weeds')">Wee</span>
                <span class="step-mini" onclick="loadJourneyStep('pests')">Pes</span>
                <span class="step-mini" onclick="loadJourneyStep('diseases')">Dis</span>
                <span class="step-mini" onclick="loadJourneyStep('storage')">Sto</span>
            </div>
        </div>

        <div class="info-content" id="mainDescription">
            Irrigation is the artificial application of water to crops, essential for agriculture in areas with insufficient rainfall. This center pivot system represents modern precision irrigation, rotating around a central point to water large circular fields efficiently with minimal water waste.
        </div>

        <div class="info-card">
            <div class="info-card-title">
                <span>💧</span> Key Concepts
            </div>
            <div class="info-card-content">
                <ul class="info-list" id="keyConcepts">
                    <li>70% of world's freshwater used for irrigation</li>
                    <li>Center pivots can water 130-acre circles</li>
                    <li>Precision irrigation reduces water waste</li>
                    <li>Critical for food security in arid regions</li>
                </ul>
            </div>
        </div>

        <div class="fun-fact">
            <div class="fun-fact-title">Water Management Fact!</div>
            <div class="fun-fact-text" id="funFact">
                A single center pivot irrigation system can use GPS and sensors to apply exact amounts of water and fertilizer to different zones within the same field!
            </div>
        </div>

        <div class="info-card">
            <div class="info-card-title">
                <span>🎯</span> Learning Objectives
            </div>
            <div class="info-card-content" id="learningObjectives">
                Understanding irrigation principles and the importance of efficient water management for sustainable crop production.
            </div>
        </div>
    </div>

    <!-- Voice Controls -->
    <div class="voice-controls">
        <button class="control-btn active" id="voiceToggle" onclick="toggleVoice()">
            🔊
            <span class="control-tooltip">Voice Narration</span>
        </button>
        <button class="control-btn" onclick="toggleAutoPlay()">
            ▶️
            <span class="control-tooltip">Auto Journey</span>
        </button>
        <button class="control-btn" onclick="toggleInfo()">
            ℹ️
            <span class="control-tooltip">Toggle Info</span>
        </button>
    </div>

    <!-- Quick Actions -->
    <div class="quick-actions">
        <button class="action-btn" onclick="startGuidedTour()">
            <span>🚀</span> Guided Tour
        </button>
        <button class="action-btn" onclick="showQuiz()">
            <span>🎯</span> Test Knowledge
        </button>
    </div>

    <!-- Voice Indicator -->
    <div class="voice-indicator" id="voiceIndicator">
        <div class="voice-waves">
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
        </div>
        <div class="narration-text" id="narrationText">Narrating...</div>
    </div>

    <script>
        // Journey Step Data with Complete Irrigation and Protection Content
        const JOURNEY_DATA = {
            irrigation: {
                title: "Irrigation Fundamentals - Water for Life",
                subtitle: "Essential water management",
                icon: "💧",
                modelUrl: "https://sketchfab.com/models/5a92388c6f4e426cb5dda8f26b190eba/embed?autostart=1&internal=1&tracking=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_watermark=0",
                description: "Irrigation is the artificial application of water to crops, essential for agriculture in areas with insufficient rainfall. This center pivot system represents modern precision irrigation, rotating around a central point to water large circular fields efficiently with minimal water waste.",
                concepts: [
                    "70% of world's freshwater used for irrigation",
                    "Center pivots can water 130-acre circles",
                    "Precision irrigation reduces water waste",
                    "Critical for food security in arid regions"
                ],
                funFact: "A single center pivot irrigation system can use GPS and sensors to apply exact amounts of water and fertilizer to different zones within the same field!",
                objectives: "Understanding irrigation principles and the importance of efficient water management for sustainable crop production.",
                narration: "Welcome to the world of modern irrigation! You're looking at a center pivot irrigation system - one of agriculture's most efficient water delivery methods. This massive rotating arm can water a circular field of 130 acres or more, slowly rotating around a central pivot point. Agriculture uses about 70% of the world's freshwater, so efficient irrigation is crucial for both food security and water conservation. This system represents precision irrigation at its finest - equipped with GPS and sensors, it can apply different amounts of water and fertilizer to different zones within the same field based on soil conditions and crop needs. The sprinklers along the arm are positioned at different heights to match crop growth stages. As world population grows and climate change affects rainfall patterns, these efficient irrigation systems become increasingly important for feeding humanity while conserving our precious water resources."
            },
            systems: {
                title: "Irrigation Systems - Water Delivery Methods",
                subtitle: "Wells, canals, and modern technology",
                icon: "🚰",
                modelUrl: "https://sketchfab.com/models/9002a0158fa148aab14bccafffd942bf/embed?autostart=1&internal=1&tracking=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_watermark=0",
                description: "This irrigation canal represents one of humanity's oldest water delivery systems. Canals, along with wells and tanks, form the foundation of agricultural water supply, channeling water from rivers, lakes, and groundwater to thirsty crops across vast distances.",
                concepts: [
                    "Surface irrigation: canals, furrows, flooding",
                    "Sprinkler systems: overhead water application",
                    "Drip irrigation: water directly to root zones",
                    "Wells tap groundwater for consistent supply"
                ],
                funFact: "The oldest known irrigation canal system is 8,000 years old, found in Mesopotamia - the birthplace of agriculture!",
                objectives: "Learn about different irrigation systems and how they deliver water efficiently from source to crops.",
                narration: "This irrigation canal tells the story of human ingenuity in water management! Canals like this have been channeling water to crops for over 8,000 years, first developed in Mesopotamia where agriculture began. These engineered waterways can carry water from rivers and lakes across hundreds of miles to reach thirsty fields. Canal systems work by gravity flow, with carefully calculated slopes that allow water to flow steadily without eroding the channel. Modern irrigation includes several approaches: surface irrigation using canals and furrows, sprinkler systems that spray water overhead like artificial rain, and drip irrigation that delivers water directly to plant roots through networks of tubes and emitters. Wells provide access to groundwater - underground aquifers that store water in rock and soil layers. Each system has advantages: canals are low-cost but can lose water to evaporation and seepage, sprinklers provide uniform coverage, and drip irrigation achieves 90% efficiency by putting water exactly where plants need it."
            },
            patterns: {
                title: "Cropping Patterns - Smart Field Design",
                subtitle: "Mixed and intercropping strategies",
                icon: "🌱",
                modelUrl: "https://sketchfab.com/models/5a92388c6f4e426cb5dda8f26b190eba/embed?autostart=1&internal=1&tracking=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_watermark=0",
                description: "Smart cropping patterns maximize land and water use efficiency. Mixed cropping grows different crops together, intercropping alternates rows of different crops, while relay cropping plants new crops before harvesting the old ones - all designed to optimize resources.",
                concepts: [
                    "Mixed cropping: multiple crops in same field",
                    "Intercropping: systematic arrangement of different crops",
                    "Relay cropping: overlapping crop cycles",
                    "Companion planting: mutually beneficial crop combinations"
                ],
                funFact: "Indigenous 'Three Sisters' planting of corn, beans, and squash together can increase total yield by 30% compared to monocultures!",
                objectives: "Understand how different cropping patterns can improve resource efficiency and crop productivity.",
                narration: "Cropping patterns represent thousands of years of agricultural wisdom about growing multiple crops together efficiently! Mixed cropping means growing different crops randomly mixed in the same field - like growing corn scattered among beans and squash. Intercropping is more systematic, with organized rows or patterns of different crops. For example, you might plant corn in every third row with beans and onions in between. Relay cropping involves timing - planting a new crop before harvesting the old one to maximize land use. The famous 'Three Sisters' combination of corn, beans, and squash used by Native Americans is brilliant - corn provides support for beans to climb, beans fix nitrogen for corn and squash, and squash leaves shade the soil to retain moisture and suppress weeds. This combination can increase total yield by 30% compared to growing each crop separately! These patterns also reduce pest problems because pests that attack one crop often avoid others. Modern precision irrigation can be programmed to deliver different amounts of water to different crops within the same field, making these traditional patterns even more efficient."
            },
            rotation: {
                title: "Crop Rotation - Breaking the Cycle",
                subtitle: "Sequential cropping for soil health",
                icon: "🔄",
                modelUrl: "https://sketchfab.com/models/5a92388c6f4e426cb5dda8f26b190eba/embed?autostart=1&internal=1&tracking=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_watermark=0",
                description: "Crop rotation involves growing different types of crops in sequence on the same field over multiple seasons. This practice maintains soil fertility, breaks pest and disease cycles, and can reduce irrigation needs by including drought-tolerant crops in the rotation.",
                concepts: [
                    "Different crops have different nutrient needs",
                    "Legumes add nitrogen for following crops",
                    "Breaks pest and disease cycles naturally",
                    "Deep vs shallow rooted crops improve soil structure"
                ],
                funFact: "A well-planned 4-year crop rotation can reduce fertilizer needs by 50% and pesticide use by 75% while maintaining yields!",
                objectives: "Learn how crop rotation maintains soil health and reduces pest problems through natural cycling.",
                narration: "Crop rotation is like giving your soil a balanced diet over time! Instead of growing the same crop year after year, farmers rotate different types of crops in sequence on the same field. This practice has multiple benefits for both soil health and pest management. Different crops have different nutrient requirements - corn is a heavy nitrogen feeder, while legumes like soybeans actually add nitrogen to the soil through their root bacteria. Following corn with soybeans naturally replenishes soil nitrogen. Root diversity also matters - deep-rooted crops like alfalfa break up compacted soil layers and bring buried nutrients to the surface, while shallow-rooted crops like lettuce use nutrients near the surface. Rotation breaks pest cycles because many insects and diseases are specific to particular crops. If corn borers emerge to find soybeans instead of corn, their population crashes. A well-planned 4-year rotation can reduce fertilizer needs by 50% and pesticide use by 75%! Irrigation efficiency also improves because drought-tolerant crops like sorghum can be included in rotations, reducing overall water needs while maintaining farm productivity."
            },
            weeds: {
                title: "Weed Management - Unwanted Competition",
                subtitle: "Controlling plant invaders",
                icon: "🌿",
                modelUrl: "https://sketchfab.com/models/205c2214bf0d4671882eb0e568240708/embed?autostart=1&internal=1&tracking=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_watermark=0",
                description: "This Parthenium weed represents one of agriculture's most persistent challenges. Weeds compete with crops for water, nutrients, and sunlight, potentially reducing yields by 20-40%. Effective weed management combines cultural, mechanical, and chemical approaches.",
                concepts: [
                    "Weeds compete for water, nutrients, and light",
                    "Can reduce crop yields by 20-40%",
                    "Annual weeds complete lifecycle in one year",
                    "Perennial weeds persist for multiple years"
                ],
                funFact: "Parthenium weed can produce 25,000 seeds per plant and releases chemicals that inhibit the growth of other plants - a phenomenon called allelopathy!",
                objectives: "Understand how weeds impact crop production and learn integrated approaches to weed management.",
                narration: "Meet Parthenium, one of the world's most troublesome weeds! This aggressive invader can reduce crop yields by 40% or more through direct competition for water, nutrients, and sunlight. What makes Parthenium especially problematic is that each plant can produce up to 25,000 seeds that remain viable in soil for years. It also practices chemical warfare - releasing allelopathic compounds that actively inhibit the growth of nearby plants, giving it an unfair advantage over crops. Weeds are classified as annuals, which complete their lifecycle in one growing season, or perennials, which persist for multiple years through underground storage organs. Effective weed management uses integrated approaches: cultural methods like crop rotation and cover crops that outcompete weeds, mechanical control through cultivation and hand-weeding, and chemical control with herbicides when necessary. Prevention is key - keeping weed seeds from entering fields through clean equipment and quality seeds. Early detection and rapid response to new weed invasions can prevent small problems from becoming major infestations. Modern precision agriculture uses GPS-guided sprayers to apply herbicides only where weeds are present, reducing chemical use and environmental impact."
            },
            pests: {
                title: "Insect Pest Management - Tiny Destroyers",
                subtitle: "Protecting crops from insect damage",
                icon: "🐛",
                modelUrl: "https://sketchfab.com/models/956b32448d6747b39cb0b0071b29e145/embed?autostart=1&internal=1&tracking=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_watermark=0",
                description: "The Colorado potato beetle exemplifies insect pests that can devastate crops. These voracious feeders can defoliate entire potato fields, reducing yields dramatically. Integrated pest management combines biological controls, resistant varieties, and targeted treatments.",
                concepts: [
                    "Insects can destroy 20-40% of crop yields",
                    "Colorado beetle develops resistance quickly",
                    "Integrated Pest Management (IPM) uses multiple strategies",
                    "Beneficial insects can control pest populations"
                ],
                funFact: "Colorado potato beetles can develop resistance to new insecticides in just 2-3 years, making them one of agriculture's most adaptable pests!",
                objectives: "Learn how insect pests damage crops and understand integrated approaches to pest management.",
                narration: "This Colorado potato beetle is a perfect example of why insect pest management is crucial for crop protection! These striped beetles and their larvae are voracious feeders that can completely defoliate potato plants, reducing yields by 50% or more. What makes them particularly challenging is their incredible ability to develop resistance to insecticides - they can become resistant to new chemicals in just 2-3 years, faster than almost any other pest. Insect pests cause an estimated 20-40% of global crop losses annually, making them a major threat to food security. Colorado beetles overwinter as adults in the soil, emerge in spring to feed and lay eggs on potato plants, and can produce multiple generations per season. Effective management requires Integrated Pest Management (IPM) - combining multiple strategies rather than relying solely on pesticides. This includes using resistant potato varieties, encouraging beneficial insects like ladybugs and parasitic wasps that attack the beetles, crop rotation to disrupt their lifecycle, and careful timing of targeted insecticide applications only when necessary. Biological control is increasingly important - releasing natural enemies of pests or using pheromone traps to disrupt their mating. This sustainable approach reduces pesticide resistance and environmental impact."
            },
            diseases: {
                title: "Plant Disease Management - Fighting Pathogens",
                subtitle: "Protecting crops from disease organisms",
                icon: "🦠",
                modelUrl: "https://sketchfab.com/models/5a92388c6f4e426cb5dda8f26b190eba/embed?autostart=1&internal=1&tracking=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_watermark=0",
                description: "Plant diseases caused by fungi, bacteria, and viruses can devastate crops. Disease management requires understanding pathogen lifecycles, creating unfavorable conditions for disease development, and using resistant varieties and targeted treatments when necessary.",
                concepts: [
                    "Fungi, bacteria, and viruses cause plant diseases",
                    "Diseases thrive in warm, humid conditions",
                    "Crop rotation breaks disease cycles",
                    "Resistant varieties provide genetic protection"
                ],
                funFact: "The Irish Potato Famine of the 1840s, caused by potato blight disease, killed over 1 million people and changed world history!",
                objectives: "Understand how plant diseases develop and spread, and learn integrated approaches to disease prevention and control.",
                narration: "Plant diseases represent some of agriculture's most devastating threats - the Irish Potato Famine of the 1840s, caused by potato blight disease, killed over 1 million people and forced millions more to emigrate, literally changing world history! Plant diseases are caused by fungi, bacteria, and viruses that infect crops and disrupt normal plant functions. Most fungal diseases thrive in warm, humid conditions - spores spread through water droplets, wind, and contaminated tools. Bacterial diseases often enter through wounds or natural openings, while viruses are typically spread by insect vectors like aphids. Disease prevention focuses on creating unfavorable conditions for pathogens: proper plant spacing for air circulation, avoiding overhead irrigation that wets leaves, and removing infected plant debris. Crop rotation is crucial because many pathogens survive in soil or crop residues, waiting for their host crop to return. Resistant varieties provide genetic protection - plant breeders incorporate disease resistance genes into crop varieties, though pathogens can evolve to overcome these defenses over time. Fungicides, bactericides, and other treatments are used when necessary, but timing is critical - preventive applications before infection occurs are much more effective than trying to control established diseases. Modern precision agriculture uses weather monitoring and disease forecasting models to predict when conditions favor disease development."
            },
            storage: {
                title: "Storage and Post-Harvest - Preserving the Harvest",
                subtitle: "Reducing losses after harvest",
                icon: "📦",
                modelUrl: "https://sketchfab.com/models/5a92388c6f4e426cb5dda8f26b190eba/embed?autostart=1&internal=1&tracking=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_watermark=0",
                description: "Post-harvest losses from improper storage, pests, and diseases can waste 25-40% of crop production globally. Proper storage involves controlling moisture, temperature, and oxygen levels while protecting against insects, rodents, and fungal contamination.",
                concepts: [
                    "25-40% of crops lost after harvest globally",
                    "Moisture control prevents fungal growth",
                    "Temperature management slows deterioration",
                    "Proper packaging protects against pests"
                ],
                funFact: "In developing countries, post-harvest losses can reach 40% due to inadequate storage facilities, while developed countries lose only 2-3%!",
                objectives: "Learn about post-harvest losses and understand proper storage techniques to preserve crop quality and quantity.",
                narration: "The harvest is just the beginning of the challenge to get food from farm to table! Post-harvest losses represent one of agriculture's hidden crises - globally, 25-40% of crops are lost after harvest due to improper handling, storage, and transportation. These losses are particularly devastating in developing countries, where inadequate storage facilities can result in 40% losses, compared to just 2-3% in developed countries with modern storage systems. Proper storage requires controlling three key factors: moisture, temperature, and oxygen. High moisture levels encourage fungal growth and grain spoilage - most grains need to be dried to 12-14% moisture for safe storage. Temperature control slows chemical reactions and biological processes that cause deterioration. Cool, dry conditions also discourage insect pests like weevils and moths that can destroy stored grain. Airtight storage containers or controlled atmosphere storage with reduced oxygen levels can prevent both insect damage and oxidation. Physical protection against rodents requires secure containers and proper facility design. Modern storage facilities use sensors to monitor temperature and humidity, automated systems to maintain ideal conditions, and regular monitoring for pest problems. Reducing post-harvest losses is crucial for food security - it's often more cost-effective than increasing production."
            }
        };

        // Global Variables
        let currentStep = 'irrigation';
        let voiceEnabled = true;
        let autoPlayEnabled = false;
        let currentSpeech = null;
        let selectedVoice = null;
        let journeyProgress = 0;
        let guidedTourActive = false;

        // Initialize Voice System
        function initVoiceSystem() {
            if (!('speechSynthesis' in window)) {
                console.warn('Speech synthesis not supported');
                voiceEnabled = false;
                document.getElementById('voiceToggle').style.display = 'none';
                return;
            }

            function loadVoices() {
                const voices = speechSynthesis.getVoices();
                if (voices.length === 0) return;

                // Prefer natural-sounding voices
                const preferredVoices = [
                    'Google UK English Female',
                    'Microsoft Sonia',
                    'Microsoft Hazel',
                    'Samantha',
                    'Victoria'
                ];

                for (const name of preferredVoices) {
                    selectedVoice = voices.find(v => v.name.includes(name));
                    if (selectedVoice) break;
                }

                if (!selectedVoice) {
                    selectedVoice = voices.find(v => v.lang.startsWith('en'));
                }
            }

            loadVoices();
            if (speechSynthesis.onvoiceschanged !== undefined) {
                speechSynthesis.onvoiceschanged = loadVoices;
            }
        }

        // Load Journey Step
        function loadJourneyStep(stepId) {
            const stepData = JOURNEY_DATA[stepId];
            if (!stepData) return;

            currentStep = stepId;
            
            // Update model
            document.getElementById('api-frame').src = stepData.modelUrl;
            
            // Update info panel
            document.getElementById('stepIcon').textContent = stepData.icon;
            document.getElementById('stepTitle').textContent = stepData.title;
            document.getElementById('stepSubtitle').textContent = stepData.subtitle;
            document.getElementById('mainDescription').textContent = stepData.description;
            
            // Update key concepts
            const conceptsList = document.getElementById('keyConcepts');
            conceptsList.innerHTML = stepData.concepts.map(c => `<li>${c}</li>`).join('');
            
            // Update fun fact
            document.getElementById('funFact').textContent = stepData.funFact;
            
            // Update learning objectives
            document.getElementById('learningObjectives').textContent = stepData.objectives;
            
            // Update navigation buttons
            updateNavigationButtons(stepId);
            
            // Update progress
            updateProgress();
            
            // Play narration if enabled
            if (voiceEnabled) {
                speakText(stepData.narration);
            }
        }

        // Update Navigation Buttons
        function updateNavigationButtons(activeStep) {
            const buttons = document.querySelectorAll('.journey-btn');
            const steps = ['irrigation', 'systems', 'patterns', 'rotation', 'weeds', 'pests', 'diseases', 'storage'];
            const activeIndex = steps.indexOf(activeStep);
            
            buttons.forEach((btn, index) => {
                btn.classList.remove('active', 'completed');
                if (index < activeIndex) {
                    btn.classList.add('completed');
                } else if (index === activeIndex) {
                    btn.classList.add('active');
                }
            });
            
            // Update mini steps
            const miniSteps = document.querySelectorAll('.step-mini');
            miniSteps.forEach((step, index) => {
                step.classList.remove('active', 'completed');
                if (index < activeIndex) {
                    step.classList.add('completed');
                } else if (index === activeIndex) {
                    step.classList.add('active');
                }
            });
        }

        // Update Progress
        function updateProgress() {
            const steps = ['irrigation', 'systems', 'patterns', 'rotation', 'weeds', 'pests', 'diseases', 'storage'];
            const currentIndex = steps.indexOf(currentStep);
            const progress = ((currentIndex + 1) / steps.length) * 100;
            
            document.getElementById('progressPercent').textContent = Math.round(progress) + '%';
            document.getElementById('progressFill').style.width = progress + '%';
        }

        // Speech Functions
        function speakText(text) {
            if (!voiceEnabled || !text) return;
            
            stopSpeech();
            
            currentSpeech = new SpeechSynthesisUtterance(text);
            if (selectedVoice) {
                currentSpeech.voice = selectedVoice;
            }
            currentSpeech.rate = 0.9;
            currentSpeech.pitch = 1.0;
            currentSpeech.volume = 0.9;
            
            currentSpeech.onstart = () => {
                document.getElementById('voiceIndicator').classList.add('visible');
                document.getElementById('narrationText').textContent = 
                    text.substring(0, 50) + (text.length > 50 ? '...' : '');
            };
            
            currentSpeech.onend = () => {
                document.getElementById('voiceIndicator').classList.remove('visible');
                currentSpeech = null;
                
                // Auto-advance if guided tour is active
                if (guidedTourActive) {
                    setTimeout(nextStep, 2000);
                }
            };
            
            speechSynthesis.speak(currentSpeech);
        }

        function stopSpeech() {
            if (currentSpeech) {
                speechSynthesis.cancel();
                currentSpeech = null;
                document.getElementById('voiceIndicator').classList.remove('visible');
            }
        }

        // Control Functions
        function toggleVoice() {
            voiceEnabled = !voiceEnabled;
            const btn = document.getElementById('voiceToggle');
            btn.textContent = voiceEnabled ? '🔊' : '🔇';
            btn.classList.toggle('active', voiceEnabled);
            
            if (!voiceEnabled) {
                stopSpeech();
            }
        }

        function toggleAutoPlay() {
            autoPlayEnabled = !autoPlayEnabled;
            if (autoPlayEnabled) {
                startGuidedTour();
            } else {
                guidedTourActive = false;
            }
        }

        function toggleInfo() {
            const panel = document.getElementById('infoPanel');
            panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
        }

        // Guided Tour
        function startGuidedTour() {
            guidedTourActive = true;
            const steps = ['irrigation', 'systems', 'patterns', 'rotation', 'weeds', 'pests', 'diseases', 'storage'];
            let stepIndex = 0;
            
            function tourStep() {
                if (stepIndex < steps.length && guidedTourActive) {
                    loadJourneyStep(steps[stepIndex]);
                    stepIndex++;
                } else {
                    guidedTourActive = false;
                    if (voiceEnabled) {
                        speakText("Congratulations! You've completed your journey through irrigation and crop protection. You now understand water management systems, cropping patterns, and how to protect crops from weeds, pests, and diseases. You've also learned about preventing post-harvest losses. Feel free to explore any section again or test your knowledge!");
                    }
                }
            }
            
            tourStep();
            window.nextStep = tourStep;
        }

        // Quiz Function
        function showQuiz() {
            const questions = [
                "What are the advantages and disadvantages of different irrigation systems?",
                "How does crop rotation help break pest and disease cycles?",
                "What makes the Colorado potato beetle such a challenging pest?",
                "Why are post-harvest losses a major concern for food security?",
                "How do intercropping patterns improve resource efficiency?"
            ];
            
            const randomQ = questions[Math.floor(Math.random() * questions.length)];
            
            if (voiceEnabled) {
                speakText(`Here's a question to test your irrigation and crop protection knowledge: ${randomQ} Think about what you've learned about water management and protecting crops!`);
            }
        }

        // Initialize
        function init() {
            initVoiceSystem();
            
            // Hide loading screen
            setTimeout(() => {
                const loading = document.getElementById('loadingOverlay');
                loading.style.opacity = '0';
                setTimeout(() => {
                    loading.style.display = 'none';
                    
                    // Welcome message
                    if (voiceEnabled) {
                        speakText("Welcome to your irrigation and crop protection journey! Water is life for crops, and protecting them from pests and diseases is essential for food security. We'll explore modern irrigation systems, smart cropping patterns, and integrated approaches to pest management. Starting with irrigation fundamentals - how we deliver water efficiently to crops!");
                    }
                }, 1000);
            }, 3000);
            
            // Keyboard shortcuts
            document.addEventListener('keydown', (e) => {
                switch(e.key) {
                    case 'v': toggleVoice(); break;
                    case 'i': toggleInfo(); break;
                    case 'g': startGuidedTour(); break;
                    case 'Escape': stopSpeech(); guidedTourActive = false; break;
                    case 'ArrowRight': nextStep && nextStep(); break;
                }
            });
        }

        // Start the application
        init();
    </script>
</body>
</html>