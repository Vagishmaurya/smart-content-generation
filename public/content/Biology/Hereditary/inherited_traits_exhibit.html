<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inherited Traits & Human Variation - The Diversity of Life</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tween.js/18.6.4/tween.umd.js"></script>

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #34495e 0%, #16a085 50%, #f39c12 100%);
            color: white;
            overflow: hidden;
            position: relative;
            height: 100vh;
        }

        /* Animated Background */
        .bg-animation {
            position: fixed;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: 0;
            opacity: 0.1;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 320"><path fill="%23ffffff" fill-opacity="0.3" d="M0,64L48,85.3C96,107,192,149,288,165.3C384,181,480,171,576,144C672,117,768,75,864,69.3C960,64,1056,96,1152,122.7C1248,149,1344,171,1392,181.3L1440,192L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z"></path></svg>') repeat-x;
            animation: variationWave 12s linear infinite;
        }

        @keyframes variationWave {
            0% { background-position-x: 0; }
            100% { background-position-x: 1440px; }
        }

        /* Museum Interface - Compact Header */
        .museum-header {
            position: absolute;
            top: 10px;
            left: 20px;
            text-align: left;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            padding: 10px 18px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .museum-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 4px;
            background: linear-gradient(45deg, #f39c12, #16a085, #8e44ad);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: titleGlow 3s ease-in-out infinite;
        }

        @keyframes titleGlow {
            0%, 100% { filter: brightness(1); }
            50% { filter: brightness(1.2); }
        }

        .exhibit-subtitle {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.8);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .diversity-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            background: linear-gradient(45deg, #f39c12, #16a085);
            border-radius: 50%;
            animation: diversityPulse 2s ease-in-out infinite;
        }

        @keyframes diversityPulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.3); opacity: 0.7; }
        }

        /* Journey Navigation - Enhanced */
        .journey-navigation {
            position: absolute;
            bottom: 20px;
            left: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            padding: 15px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            max-width: 320px;
        }

        .journey-title {
            font-size: 14px;
            font-weight: 600;
            color: #16a085;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .journey-steps {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }

        .journey-btn {
            background: rgba(22, 160, 133, 0.2);
            border: 1px solid rgba(22, 160, 133, 0.4);
            color: white;
            padding: 6px 10px;
            border-radius: 20px;
            font-size: 11px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 4px;
            white-space: nowrap;
        }

        .journey-btn:hover {
            background: rgba(22, 160, 133, 0.3);
            border-color: #16a085;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(22, 160, 133, 0.3);
        }

        .journey-btn.active {
            background: linear-gradient(135deg, #f39c12, #e67e22);
            border-color: #f39c12;
            box-shadow: 0 0 20px rgba(243, 156, 18, 0.5);
            animation: pulse 2s infinite;
        }

        .journey-btn.completed {
            background: rgba(46, 204, 113, 0.3);
            border-color: #2ecc71;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        /* 3D Model Container */
        .model-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 0;
            overflow: hidden;
            border: none;
            z-index: 100;
        }

        .sketchfab-embed-wrapper {
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #34495e 0%, #16a085 50%, #f39c12 100%);
        }

        .sketchfab-embed-wrapper iframe {
            width: 100%;
            height: 100%;
            border: none;
            border-radius: 0;
        }

        /* Information Panel - Enhanced */
        .info-panel {
            position: absolute;
            top: 70px;
            right: 20px;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(25px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 16px;
            padding: 24px;
            width: 400px;
            max-height: calc(100vh - 140px);
            z-index: 800;
            overflow-y: auto;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }

        .info-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        }

        .info-icon {
            font-size: 28px;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        .info-title {
            flex: 1;
        }

        .info-title h2 {
            font-size: 18px;
            color: #f39c12;
            margin-bottom: 4px;
        }

        .info-subtitle {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.7);
        }

        .info-content {
            color: rgba(255, 255, 255, 0.9);
            font-size: 14px;
            line-height: 1.6;
        }

        /* Progress Tracker */
        .progress-tracker {
            background: linear-gradient(135deg, rgba(22, 160, 133, 0.1), rgba(243, 156, 18, 0.1));
            border: 1px solid rgba(22, 160, 133, 0.3);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 20px;
        }

        .progress-header {
            font-size: 13px;
            font-weight: 600;
            color: #16a085;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .progress-percentage {
            font-size: 18px;
            color: #f39c12;
            font-weight: 700;
        }

        .progress-bar {
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 12px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #16a085, #f39c12, #e74c3c);
            border-radius: 4px;
            transition: width 0.8s ease;
            box-shadow: 0 0 10px rgba(243, 156, 18, 0.5);
        }

        .progress-steps-mini {
            display: flex;
            justify-content: space-between;
            font-size: 10px;
            color: rgba(255, 255, 255, 0.6);
        }

        .step-mini {
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .step-mini.active {
            color: #f39c12;
            font-weight: 600;
        }

        .step-mini.completed {
            color: #2ecc71;
        }

        /* Information Cards */
        .info-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 14px;
            margin-bottom: 14px;
        }

        .info-card-title {
            color: #16a085;
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .info-card-content {
            color: rgba(255, 255, 255, 0.85);
            font-size: 12px;
            line-height: 1.5;
        }

        .info-list {
            list-style: none;
            padding: 0;
        }

        .info-list li {
            padding: 6px 0;
            padding-left: 20px;
            position: relative;
            font-size: 12px;
            color: rgba(255, 255, 255, 0.8);
        }

        .info-list li:before {
            content: "→";
            position: absolute;
            left: 0;
            color: #f39c12;
        }

        /* Activity Box */
        .activity-box {
            background: linear-gradient(135deg, rgba(52, 152, 219, 0.1), rgba(155, 89, 182, 0.1));
            border: 1px solid rgba(52, 152, 219, 0.3);
            border-radius: 12px;
            padding: 16px;
            margin: 16px 0;
            position: relative;
            overflow: hidden;
        }

        .activity-box:before {
            content: "🔬";
            position: absolute;
            top: -20px;
            right: -20px;
            font-size: 60px;
            opacity: 0.1;
        }

        .activity-title {
            color: #3498db;
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .activity-content {
            color: rgba(255, 255, 255, 0.9);
            font-size: 12px;
            line-height: 1.5;
            position: relative;
            z-index: 1;
        }

        /* Interactive Elements */
        .trait-selector {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin: 12px 0;
        }

        .trait-option {
            background: rgba(22, 160, 133, 0.3);
            border: 1px solid rgba(22, 160, 133, 0.5);
            color: white;
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 11px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .trait-option:hover {
            background: rgba(22, 160, 133, 0.5);
            transform: scale(1.05);
        }

        .trait-option.selected {
            background: rgba(243, 156, 18, 0.5);
            border-color: #f39c12;
        }

        /* Fun Fact Box */
        .fun-fact {
            background: linear-gradient(135deg, rgba(46, 204, 113, 0.1), rgba(52, 152, 219, 0.1));
            border: 1px solid rgba(46, 204, 113, 0.3);
            border-radius: 12px;
            padding: 14px;
            margin: 16px 0;
            position: relative;
            overflow: hidden;
        }

        .fun-fact:before {
            content: "👥";
            position: absolute;
            top: -20px;
            right: -20px;
            font-size: 60px;
            opacity: 0.1;
        }

        .fun-fact-title {
            color: #2ecc71;
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 6px;
        }

        .fun-fact-text {
            color: rgba(255, 255, 255, 0.9);
            font-size: 12px;
            line-height: 1.5;
            position: relative;
            z-index: 1;
        }

        /* Voice Controls */
        .voice-controls {
            position: absolute;
            top: 10px;
            right: 20px;
            display: flex;
            gap: 8px;
            z-index: 1000;
        }

        .control-btn {
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            width: 44px;
            height: 44px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            position: relative;
        }

        .control-btn:hover {
            background: rgba(243, 156, 18, 0.3);
            border-color: #f39c12;
            transform: scale(1.1);
        }

        .control-btn.active {
            background: rgba(243, 156, 18, 0.4);
            border-color: #f39c12;
            box-shadow: 0 0 20px rgba(243, 156, 18, 0.5);
        }

        .control-tooltip {
            position: absolute;
            bottom: -30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9);
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 10px;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .control-btn:hover .control-tooltip {
            opacity: 1;
        }

        /* Loading Screen */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #34495e 0%, #16a085 50%, #f39c12 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            transition: opacity 1s ease;
        }

        .loading-content {
            text-align: center;
        }

        .loading-diversity {
            font-size: 60px;
            animation: diversityPulse 1.5s ease-in-out infinite;
            margin-bottom: 20px;
        }

        .loading-text {
            color: white;
            font-size: 20px;
            margin-bottom: 20px;
        }

        .loading-progress {
            width: 200px;
            height: 4px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 2px;
            overflow: hidden;
        }

        .loading-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #16a085, #f39c12, #e74c3c);
            animation: loading 2s ease-in-out infinite;
        }

        @keyframes loading {
            0% { width: 0%; }
            50% { width: 100%; }
            100% { width: 0%; }
        }

        /* Voice Indicator */
        .voice-indicator {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(243, 156, 18, 0.5);
            border-radius: 30px;
            padding: 14px 28px;
            display: flex;
            align-items: center;
            gap: 12px;
            z-index: 1000;
            opacity: 0;
            transition: all 0.3s ease;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }

        .voice-indicator.visible {
            opacity: 1;
            transform: translateX(-50%) translateY(-10px);
        }

        .voice-waves {
            display: flex;
            align-items: center;
            gap: 3px;
        }

        .voice-wave {
            width: 3px;
            height: 20px;
            background: linear-gradient(180deg, #f39c12, #16a085);
            border-radius: 2px;
            animation: voice-wave 1s ease-in-out infinite;
        }

        .voice-wave:nth-child(2) { animation-delay: 0.1s; }
        .voice-wave:nth-child(3) { animation-delay: 0.2s; }
        .voice-wave:nth-child(4) { animation-delay: 0.3s; }
        .voice-wave:nth-child(5) { animation-delay: 0.4s; }

        @keyframes voice-wave {
            0%, 100% { transform: scaleY(0.3); }
            50% { transform: scaleY(1); }
        }

        .narration-text {
            color: white;
            font-size: 13px;
            max-width: 300px;
        }

        /* Quick Actions */
        .quick-actions {
            position: absolute;
            bottom: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            z-index: 1000;
        }

        .action-btn {
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 10px 16px;
            border-radius: 25px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
        }

        .action-btn:hover {
            background: rgba(22, 160, 133, 0.3);
            border-color: #16a085;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(22, 160, 133, 0.3);
        }

        /* Custom Scrollbar */
        .info-panel::-webkit-scrollbar {
            width: 6px;
        }

        .info-panel::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 3px;
        }

        .info-panel::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, #f39c12, #16a085);
            border-radius: 3px;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .info-panel {
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                top: auto;
                width: 100%;
                max-height: 50vh;
                border-radius: 20px 20px 0 0;
            }
            
            .journey-navigation {
                bottom: 52vh;
                max-width: calc(100% - 40px);
            }
            
            .voice-controls {
                top: auto;
                bottom: 55vh;
                right: 10px;
            }
            
            .quick-actions {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="bg-animation"></div>

    <!-- Loading Screen -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-content">
            <div class="loading-diversity">👥</div>
            <div class="loading-text">Exploring Human Diversity...</div>
            <div class="loading-progress">
                <div class="loading-progress-bar"></div>
            </div>
        </div>
    </div>

    <!-- Museum Header -->
    <div class="museum-header">
        <div class="museum-title">Inherited Traits & Human Variation</div>
        <div class="exhibit-subtitle">
            <span class="diversity-indicator"></span>
            The Diversity of Life
        </div>
    </div>

    <!-- Journey Navigation -->
    <div class="journey-navigation">
        <div class="journey-title">
            <span>👥</span>
            <span>Your Traits Journey</span>
        </div>
        <div class="journey-steps">
            <button class="journey-btn active" onclick="loadJourneyStep('ear_traits')">
                <span>👂</span> Ear Traits
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('facial_features')">
                <span>😊</span> Facial Features
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('hand_traits')">
                <span>🤚</span> Hand Traits
            </button>
        </div>
    </div>

    <!-- 3D Model Container -->
    <div class="model-container">
        <div class="sketchfab-embed-wrapper">
            <iframe id="api-frame"
                    title="Human Ear Model" 
                    frameborder="0" 
                    allowfullscreen 
                    mozallowfullscreen="true" 
                    webkitallowfullscreen="true" 
                    allow="autoplay; fullscreen; xr-spatial-tracking"
                    xr-spatial-tracking 
                    execution-while-out-of-viewport 
                    execution-while-not-rendered 
                    web-share 
                    src="https://sketchfab.com/models/4f5438fc9337454587ec4a2c30c8c42f/embed?autostart=1&internal=1&tracking=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0">
            </iframe>
        </div>
    </div>

    <!-- Information Panel -->
    <div class="info-panel" id="infoPanel">
        <div class="info-header">
            <div class="info-icon" id="stepIcon">👂</div>
            <div class="info-title">
                <h2 id="stepTitle">Ear Traits - Activity 8.1</h2>
                <div class="info-subtitle" id="stepSubtitle">Studying earlobe inheritance</div>
            </div>
        </div>

        <!-- Progress Tracker -->
        <div class="progress-tracker">
            <div class="progress-header">
                <span>Journey Progress</span>
                <span class="progress-percentage" id="progressPercent">0%</span>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 0%"></div>
            </div>
            <div class="progress-steps-mini">
                <span class="step-mini active" onclick="loadJourneyStep('ear_traits')">Ear</span>
                <span class="step-mini" onclick="loadJourneyStep('facial_features')">Face</span>
                <span class="step-mini" onclick="loadJourneyStep('hand_traits')">Hand</span>
            </div>
        </div>

        <div class="info-content" id="mainDescription">
            The shape of earlobes is one of the most easily observed inherited traits in humans. This simple trait demonstrates how genetic information passes from parents to children and shows the observable variation that exists within human populations.
        </div>

        <div class="info-card">
            <div class="info-card-title">
                <span>🔬</span> Key Concepts
            </div>
            <div class="info-card-content">
                <ul class="info-list" id="keyConcepts">
                    <li>Attached earlobes vs. free-hanging earlobes</li>
                    <li>Simple trait controlled by one gene</li>
                    <li>Observable variation in human populations</li>
                    <li>Inheritance patterns from parents to children</li>
                </ul>
            </div>
        </div>

        <div class="activity-box">
            <div class="activity-title">Activity 8.1: Earlobe Study</div>
            <div class="activity-content" id="activityContent">
                Observe the earlobe attachment in your family members. Record whether each person has attached or free-hanging earlobes. This simple observation helps demonstrate how traits are inherited from one generation to the next.
            </div>
            <div class="trait-selector" id="traitSelector">
                <div class="trait-option" onclick="selectTrait('attached')">Attached Earlobes</div>
                <div class="trait-option" onclick="selectTrait('free')">Free-hanging Earlobes</div>
            </div>
        </div>

        <div class="fun-fact">
            <div class="fun-fact-title">Human Diversity Fact!</div>
            <div class="fun-fact-text" id="funFact">
                About 75% of people worldwide have free-hanging earlobes, while 25% have attached earlobes. This variation shows how different populations have different frequencies of inherited traits!
            </div>
        </div>

        <div class="info-card">
            <div class="info-card-title">
                <span>🎯</span> Learning Objectives
            </div>
            <div class="info-card-content" id="learningObjectives">
                By studying earlobe inheritance, you'll understand how simple traits are passed from parents to children and recognize the natural variation that exists in human populations.
            </div>
        </div>
    </div>

    <!-- Voice Controls -->
    <div class="voice-controls">
        <button class="control-btn active" id="voiceToggle" onclick="toggleVoice()">
            🔊
            <span class="control-tooltip">Voice Narration</span>
        </button>
        <button class="control-btn" onclick="toggleAutoPlay()">
            ▶️
            <span class="control-tooltip">Auto Journey</span>
        </button>
        <button class="control-btn" onclick="toggleInfo()">
            ℹ️
            <span class="control-tooltip">Toggle Info</span>
        </button>
    </div>

    <!-- Quick Actions -->
    <div class="quick-actions">
        <button class="action-btn" onclick="startGuidedTour()">
            <span>🚀</span> Guided Tour
        </button>
        <button class="action-btn" onclick="showQuiz()">
            <span>🎯</span> Test Knowledge
        </button>
    </div>

    <!-- Voice Indicator -->
    <div class="voice-indicator" id="voiceIndicator">
        <div class="voice-waves">
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
        </div>
        <div class="narration-text" id="narrationText">Narrating...</div>
    </div>

    <script>
        // Journey Step Data with Complete Pedagogical Content
        const JOURNEY_DATA = {
            ear_traits: {
                title: "Ear Traits - Activity 8.1",
                subtitle: "Studying earlobe inheritance",
                icon: "👂",
                modelUrl: "https://sketchfab.com/models/4f5438fc9337454587ec4a2c30c8c42f/embed?autostart=1&internal=1&tracking=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "The shape of earlobes is one of the most easily observed inherited traits in humans. This simple trait demonstrates how genetic information passes from parents to children and shows the observable variation that exists within human populations.",
                concepts: [
                    "Attached earlobes vs. free-hanging earlobes",
                    "Simple trait controlled by one gene",
                    "Observable variation in human populations",
                    "Inheritance patterns from parents to children"
                ],
                funFact: "About 75% of people worldwide have free-hanging earlobes, while 25% have attached earlobes. This variation shows how different populations have different frequencies of inherited traits!",
                objectives: "By studying earlobe inheritance, you'll understand how simple traits are passed from parents to children and recognize the natural variation that exists in human populations.",
                activity: "Observe the earlobe attachment in your family members. Record whether each person has attached or free-hanging earlobes. This simple observation helps demonstrate how traits are inherited from one generation to the next.",
                narration: "Welcome to your exploration of inherited traits! You're looking at a detailed model of the human ear. Notice the earlobe at the bottom - this small feature demonstrates one of the clearest examples of human genetic variation. Earlobes come in two main types: attached, where the earlobe connects directly to the side of the head, or free-hanging, where there's a clear separation. This trait is controlled by a single gene, making it perfect for studying inheritance patterns. Look around at your family and friends - you'll notice that some have attached earlobes while others have free-hanging ones. This variation exists because we inherit different versions of genes from our parents. The earlobe trait follows simple inheritance patterns, where the free-hanging form is typically dominant over the attached form. This means if you inherit one gene for free-hanging earlobes from either parent, you'll likely have free-hanging earlobes yourself!"
            },
            facial_features: {
                title: "Facial Features - Complex Inheritance",
                subtitle: "Multiple traits working together",
                icon: "😊",
                modelUrl: "https://sketchfab.com/models/5e96a5ae764a48c79feede5c58bc98c3/embed?autostart=1&internal=1&tracking=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "Facial features represent complex inherited traits influenced by multiple genes. Eye color, nose shape, lip thickness, and facial structure all contribute to the unique appearance that makes each person recognizable and demonstrates the complexity of human genetic variation.",
                concepts: [
                    "Eye color determined by multiple genes",
                    "Nose shape influenced by genetic factors",
                    "Facial structure shows family resemblance",
                    "Complex traits involve gene interactions"
                ],
                funFact: "Your face is determined by the interaction of hundreds of genes! Even identical twins can have subtle facial differences due to environmental factors during development.",
                objectives: "Understand how complex traits like facial features result from the interaction of multiple genes and recognize patterns of family resemblance.",
                activity: "Compare facial features within your family. Look for similarities in eye color, nose shape, or facial structure. Notice how children may resemble one parent more than another for different features.",
                narration: "Explore the complexity of facial inheritance with this detailed human face model! Unlike the simple earlobe trait, facial features are examples of complex inheritance involving multiple genes working together. Look at the eyes - eye color alone involves at least eight different genes, with brown typically being dominant over blue or green. The nose shape you see is influenced by several genes affecting cartilage development and bone structure. Notice the overall facial proportions - these are also inherited traits that often show strong family resemblance. What makes facial inheritance fascinating is that children don't just look like one parent or the other; instead, they inherit a unique combination of features from both parents. This is why siblings can look quite different despite having the same parents, and why you might have your mother's eyes but your father's nose. The interaction of multiple genes creates the incredible diversity of human faces we see around us!"
            },
            hand_traits: {
                title: "Hand Traits - Functional Variations",
                subtitle: "Observable differences in hand features",
                icon: "🤚",
                modelUrl: "https://sketchfab.com/models/7304150ee9084c58b354ea173ca82f39/embed?autostart=1&internal=1&tracking=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "Hands show numerous inherited traits that are easily observable. From finger length ratios to the ability to bend the thumb backward, hand traits provide excellent examples of genetic variation that can be studied in classroom settings.",
                concepts: [
                    "Finger length ratios (2D:4D ratio)",
                    "Thumb flexibility and hitchhiker's thumb",
                    "Palm patterns and fingerprints",
                    "Hand dominance (left vs. right handed)"
                ],
                funFact: "Your fingerprints are completely unique - even identical twins have different fingerprint patterns! However, the general pattern types (loops, whorls, arches) are inherited traits.",
                objectives: "Identify various inherited hand traits and understand how these variations demonstrate the genetic diversity within human populations.",
                activity: "Examine your hands and those of family members. Compare finger length ratios, check for hitchhiker's thumb flexibility, and observe palm crease patterns to see inherited similarities and differences.",
                narration: "Examine this detailed hand model to discover the many inherited traits your hands carry! Your hands are like a genetic showcase, displaying multiple traits that vary between individuals and families. Look at the thumb - some people can bend their thumb backward at a sharp angle, creating what's called 'hitchhiker's thumb,' while others cannot. This is a simple inherited trait controlled by a single gene. Notice the finger lengths - the ratio between your index finger and ring finger is actually influenced by hormone exposure during development and shows inherited patterns. Your palm displays inherited crease patterns, though fingerprints themselves are unique to each individual due to random developmental factors. Hand dominance - whether you're left or right-handed - also shows genetic influence, though it's complex and not perfectly predictable from parents to children. Even the overall hand shape, finger thickness, and nail characteristics show family resemblance. These hand traits are particularly useful for studying inheritance because they're easily observable and don't change throughout your life!"
            }
        };

        // Global Variables
        let currentStep = 'ear_traits';
        let voiceEnabled = true;
        let autoPlayEnabled = false;
        let currentSpeech = null;
        let selectedVoice = null;
        let journeyProgress = 0;
        let guidedTourActive = false;
        let selectedTraits = new Set();

        // Initialize Voice System
        function initVoiceSystem() {
            if (!('speechSynthesis' in window)) {
                console.warn('Speech synthesis not supported');
                voiceEnabled = false;
                document.getElementById('voiceToggle').style.display = 'none';
                return;
            }

            function loadVoices() {
                const voices = speechSynthesis.getVoices();
                if (voices.length === 0) return;

                // Prefer natural-sounding voices
                const preferredVoices = [
                    'Google UK English Female',
                    'Microsoft Sonia',
                    'Microsoft Hazel',
                    'Samantha',
                    'Victoria'
                ];

                for (const name of preferredVoices) {
                    selectedVoice = voices.find(v => v.name.includes(name));
                    if (selectedVoice) break;
                }

                if (!selectedVoice) {
                    selectedVoice = voices.find(v => v.lang.startsWith('en'));
                }
            }

            loadVoices();
            if (speechSynthesis.onvoiceschanged !== undefined) {
                speechSynthesis.onvoiceschanged = loadVoices;
            }
        }

        // Load Journey Step
        function loadJourneyStep(stepId) {
            const stepData = JOURNEY_DATA[stepId];
            if (!stepData) return;

            currentStep = stepId;
            
            // Update model
            document.getElementById('api-frame').src = stepData.modelUrl;
            
            // Update info panel
            document.getElementById('stepIcon').textContent = stepData.icon;
            document.getElementById('stepTitle').textContent = stepData.title;
            document.getElementById('stepSubtitle').textContent = stepData.subtitle;
            document.getElementById('mainDescription').textContent = stepData.description;
            
            // Update key concepts
            const conceptsList = document.getElementById('keyConcepts');
            conceptsList.innerHTML = stepData.concepts.map(c => `<li>${c}</li>`).join('');
            
            // Update fun fact
            document.getElementById('funFact').textContent = stepData.funFact;
            
            // Update learning objectives
            document.getElementById('learningObjectives').textContent = stepData.objectives;
            
            // Update activity content
            if (stepData.activity) {
                document.getElementById('activityContent').textContent = stepData.activity;
            }
            
            // Update trait selector based on current step
            updateTraitSelector(stepId);
            
            // Update navigation buttons
            updateNavigationButtons(stepId);
            
            // Update progress
            updateProgress();
            
            // Play narration if enabled
            if (voiceEnabled) {
                speakText(stepData.narration);
            }
        }

        // Update Trait Selector
        function updateTraitSelector(stepId) {
            const selector = document.getElementById('traitSelector');
            selector.innerHTML = '';
            
            let options = [];
            switch(stepId) {
                case 'ear_traits':
                    options = ['Attached Earlobes', 'Free-hanging Earlobes'];
                    break;
                case 'facial_features':
                    options = ['Brown Eyes', 'Blue Eyes', 'Green Eyes', 'Straight Nose', 'Curved Nose'];
                    break;
                case 'hand_traits':
                    options = ['Hitchhiker\'s Thumb', 'Straight Thumb', 'Long Fingers', 'Short Fingers'];
                    break;
            }
            
            options.forEach(option => {
                const div = document.createElement('div');
                div.className = 'trait-option';
                div.textContent = option;
                div.onclick = () => selectTrait(option);
                selector.appendChild(div);
            });
        }

        // Select Trait
        function selectTrait(trait) {
            const options = document.querySelectorAll('.trait-option');
            options.forEach(option => {
                if (option.textContent === trait) {
                    option.classList.toggle('selected');
                    if (option.classList.contains('selected')) {
                        selectedTraits.add(trait);
                    } else {
                        selectedTraits.delete(trait);
                    }
                }
            });
        }

        // Update Navigation Buttons
        function updateNavigationButtons(activeStep) {
            const buttons = document.querySelectorAll('.journey-btn');
            const steps = ['ear_traits', 'facial_features', 'hand_traits'];
            const activeIndex = steps.indexOf(activeStep);
            
            buttons.forEach((btn, index) => {
                btn.classList.remove('active', 'completed');
                if (index < activeIndex) {
                    btn.classList.add('completed');
                } else if (index === activeIndex) {
                    btn.classList.add('active');
                }
            });
            
            // Update mini steps
            const miniSteps = document.querySelectorAll('.step-mini');
            miniSteps.forEach((step, index) => {
                step.classList.remove('active', 'completed');
                if (index < activeIndex) {
                    step.classList.add('completed');
                } else if (index === activeIndex) {
                    step.classList.add('active');
                }
            });
        }

        // Update Progress
        function updateProgress() {
            const steps = ['ear_traits', 'facial_features', 'hand_traits'];
            const currentIndex = steps.indexOf(currentStep);
            const progress = ((currentIndex + 1) / steps.length) * 100;
            
            document.getElementById('progressPercent').textContent = Math.round(progress) + '%';
            document.getElementById('progressFill').style.width = progress + '%';
        }

        // Speech Functions
        function speakText(text) {
            if (!voiceEnabled || !text) return;
            
            stopSpeech();
            
            currentSpeech = new SpeechSynthesisUtterance(text);
            if (selectedVoice) {
                currentSpeech.voice = selectedVoice;
            }
            currentSpeech.rate = 0.9;
            currentSpeech.pitch = 1.0;
            currentSpeech.volume = 0.9;
            
            currentSpeech.onstart = () => {
                document.getElementById('voiceIndicator').classList.add('visible');
                document.getElementById('narrationText').textContent = 
                    text.substring(0, 50) + (text.length > 50 ? '...' : '');
            };
            
            currentSpeech.onend = () => {
                document.getElementById('voiceIndicator').classList.remove('visible');
                currentSpeech = null;
                
                // Auto-advance if guided tour is active
                if (guidedTourActive) {
                    setTimeout(nextStep, 2000);
                }
            };
            
            speechSynthesis.speak(currentSpeech);
        }

        function stopSpeech() {
            if (currentSpeech) {
                speechSynthesis.cancel();
                currentSpeech = null;
                document.getElementById('voiceIndicator').classList.remove('visible');
            }
        }

        // Control Functions
        function toggleVoice() {
            voiceEnabled = !voiceEnabled;
            const btn = document.getElementById('voiceToggle');
            btn.textContent = voiceEnabled ? '🔊' : '🔇';
            btn.classList.toggle('active', voiceEnabled);
            
            if (!voiceEnabled) {
                stopSpeech();
            }
        }

        function toggleAutoPlay() {
            autoPlayEnabled = !autoPlayEnabled;
            if (autoPlayEnabled) {
                startGuidedTour();
            } else {
                guidedTourActive = false;
            }
        }

        function toggleInfo() {
            const panel = document.getElementById('infoPanel');
            panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
        }

        // Guided Tour
        function startGuidedTour() {
            guidedTourActive = true;
            const steps = ['ear_traits', 'facial_features', 'hand_traits'];
            let stepIndex = 0;
            
            function tourStep() {
                if (stepIndex < steps.length && guidedTourActive) {
                    loadJourneyStep(steps[stepIndex]);
                    stepIndex++;
                } else {
                    guidedTourActive = false;
                    if (voiceEnabled) {
                        speakText("Congratulations! You've explored the fascinating world of inherited human traits. You now understand how observable characteristics are passed from parents to children and contribute to human diversity. Try the trait selection activity to see what traits you've inherited!");
                    }
                }
            }
            
            tourStep();
            window.nextStep = tourStep;
        }

        // Quiz Function
        function showQuiz() {
            const questions = [
                "What are the two main types of earlobe attachment?",
                "How do facial features demonstrate complex inheritance?",
                "What hand traits can you easily observe in your family?",
                "Why do siblings often look different despite having the same parents?",
                "How do inherited traits contribute to human diversity?"
            ];
            
            const randomQ = questions[Math.floor(Math.random() * questions.length)];
            
            if (voiceEnabled) {
                speakText(`Here's a question to test your knowledge: ${randomQ} Think about what you've learned about inherited traits and human variation!`);
            }
        }

        // Initialize
        function init() {
            initVoiceSystem();
            
            // Hide loading screen
            setTimeout(() => {
                const loading = document.getElementById('loadingOverlay');
                loading.style.opacity = '0';
                setTimeout(() => {
                    loading.style.display = 'none';
                    
                    // Welcome message
                    if (voiceEnabled) {
                        speakText("Welcome to your exploration of inherited traits and human variation! We'll discover how the amazing diversity you see in people around you comes from genetic inheritance. Let's start with one of the simplest inherited traits - earlobe attachment!");
                    }
                }, 1000);
            }, 3000);
            
            // Keyboard shortcuts
            document.addEventListener('keydown', (e) => {
                switch(e.key) {
                    case 'v': toggleVoice(); break;
                    case 'i': toggleInfo(); break;
                    case 'g': startGuidedTour(); break;
                    case 'Escape': stopSpeech(); guidedTourActive = false; break;
                    case 'ArrowRight': nextStep && nextStep(); break;
                }
            });
        }

        // Start the application
        init();
    </script>
</body>
</html>