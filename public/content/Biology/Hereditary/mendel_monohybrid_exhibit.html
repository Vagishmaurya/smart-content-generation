<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mendel's Monohybrid Crosses - The Foundation of Genetics</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tween.js/18.6.4/tween.umd.js"></script>

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #27ae60 0%, #8e44ad 50%, #e74c3c 100%);
            color: white;
            overflow: hidden;
            position: relative;
            height: 100vh;
        }

        /* Animated Background */
        .bg-animation {
            position: fixed;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: 0;
            opacity: 0.1;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 320"><path fill="%23ffffff" fill-opacity="0.3" d="M0,96L48,112C96,128,192,160,288,186.7C384,213,480,235,576,213.3C672,192,768,128,864,128C960,128,1056,192,1152,197.3C1248,203,1344,149,1392,122.7L1440,96L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z"></path></svg>') repeat-x;
            animation: mendelWave 14s linear infinite;
        }

        @keyframes mendelWave {
            0% { background-position-x: 0; }
            100% { background-position-x: 1440px; }
        }

        /* Museum Interface - Compact Header */
        .museum-header {
            position: absolute;
            top: 10px;
            left: 20px;
            text-align: left;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            padding: 10px 18px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .museum-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 4px;
            background: linear-gradient(45deg, #27ae60, #8e44ad, #e74c3c);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: titleGlow 3s ease-in-out infinite;
        }

        @keyframes titleGlow {
            0%, 100% { filter: brightness(1); }
            50% { filter: brightness(1.2); }
        }

        .exhibit-subtitle {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.8);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .genetics-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            background: linear-gradient(45deg, #27ae60, #8e44ad);
            border-radius: 50%;
            animation: geneticsPulse 2s ease-in-out infinite;
        }

        @keyframes geneticsPulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.3); opacity: 0.7; }
        }

        /* Journey Navigation - Enhanced */
        .journey-navigation {
            position: absolute;
            bottom: 20px;
            left: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            padding: 15px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            max-width: 340px;
        }

        .journey-title {
            font-size: 14px;
            font-weight: 600;
            color: #27ae60;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .journey-steps {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }

        .journey-btn {
            background: rgba(39, 174, 96, 0.2);
            border: 1px solid rgba(39, 174, 96, 0.4);
            color: white;
            padding: 6px 10px;
            border-radius: 20px;
            font-size: 11px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 4px;
            white-space: nowrap;
        }

        .journey-btn:hover {
            background: rgba(39, 174, 96, 0.3);
            border-color: #27ae60;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(39, 174, 96, 0.3);
        }

        .journey-btn.active {
            background: linear-gradient(135deg, #8e44ad, #9b59b6);
            border-color: #8e44ad;
            box-shadow: 0 0 20px rgba(142, 68, 173, 0.5);
            animation: pulse 2s infinite;
        }

        .journey-btn.completed {
            background: rgba(46, 204, 113, 0.3);
            border-color: #2ecc71;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        /* 3D Model Container */
        .model-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 0;
            overflow: hidden;
            border: none;
            z-index: 100;
        }

        .sketchfab-embed-wrapper {
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #27ae60 0%, #8e44ad 50%, #e74c3c 100%);
        }

        .sketchfab-embed-wrapper iframe {
            width: 100%;
            height: 100%;
            border: none;
            border-radius: 0;
        }

        /* Information Panel - Enhanced */
        .info-panel {
            position: absolute;
            top: 70px;
            right: 20px;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(25px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 16px;
            padding: 24px;
            width: 420px;
            max-height: calc(100vh - 140px);
            z-index: 800;
            overflow-y: auto;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }

        .info-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        }

        .info-icon {
            font-size: 28px;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        .info-title {
            flex: 1;
        }

        .info-title h2 {
            font-size: 18px;
            color: #8e44ad;
            margin-bottom: 4px;
        }

        .info-subtitle {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.7);
        }

        .info-content {
            color: rgba(255, 255, 255, 0.9);
            font-size: 14px;
            line-height: 1.6;
        }

        /* Progress Tracker */
        .progress-tracker {
            background: linear-gradient(135deg, rgba(39, 174, 96, 0.1), rgba(142, 68, 173, 0.1));
            border: 1px solid rgba(39, 174, 96, 0.3);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 20px;
        }

        .progress-header {
            font-size: 13px;
            font-weight: 600;
            color: #27ae60;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .progress-percentage {
            font-size: 18px;
            color: #8e44ad;
            font-weight: 700;
        }

        .progress-bar {
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 12px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #27ae60, #8e44ad, #e74c3c);
            border-radius: 4px;
            transition: width 0.8s ease;
            box-shadow: 0 0 10px rgba(142, 68, 173, 0.5);
        }

        .progress-steps-mini {
            display: flex;
            justify-content: space-between;
            font-size: 9px;
            color: rgba(255, 255, 255, 0.6);
        }

        .step-mini {
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .step-mini.active {
            color: #8e44ad;
            font-weight: 600;
        }

        .step-mini.completed {
            color: #2ecc71;
        }

        /* Information Cards */
        .info-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 14px;
            margin-bottom: 14px;
        }

        .info-card-title {
            color: #27ae60;
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .info-card-content {
            color: rgba(255, 255, 255, 0.85);
            font-size: 12px;
            line-height: 1.5;
        }

        .info-list {
            list-style: none;
            padding: 0;
        }

        .info-list li {
            padding: 6px 0;
            padding-left: 20px;
            position: relative;
            font-size: 12px;
            color: rgba(255, 255, 255, 0.8);
        }

        .info-list li:before {
            content: "→";
            position: absolute;
            left: 0;
            color: #8e44ad;
        }

        /* Mendel's Ratio Display */
        .ratio-display {
            background: linear-gradient(135deg, rgba(142, 68, 173, 0.1), rgba(231, 76, 60, 0.1));
            border: 1px solid rgba(142, 68, 173, 0.3);
            border-radius: 12px;
            padding: 16px;
            margin: 16px 0;
            text-align: center;
        }

        .ratio-title {
            color: #8e44ad;
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 12px;
        }

        .ratio-visual {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
        }

        .ratio-square {
            width: 30px;
            height: 30px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
        }

        .dominant {
            background: #27ae60;
            color: white;
        }

        .recessive {
            background: #e74c3c;
            color: white;
        }

        .ratio-text {
            color: rgba(255, 255, 255, 0.9);
            font-size: 12px;
        }

        /* Cross Diagram */
        .cross-diagram {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 16px;
            margin: 16px 0;
        }

        .cross-title {
            color: #27ae60;
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 12px;
            text-align: center;
        }

        .punnett-square {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 2px;
            max-width: 120px;
            margin: 0 auto;
        }

        .punnett-cell {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 8px;
            text-align: center;
            font-size: 11px;
            min-height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .punnett-header {
            background: rgba(39, 174, 96, 0.3);
            font-weight: bold;
        }

        .punnett-result {
            background: rgba(142, 68, 173, 0.2);
        }

        /* Fun Fact Box */
        .fun-fact {
            background: linear-gradient(135deg, rgba(46, 204, 113, 0.1), rgba(52, 152, 219, 0.1));
            border: 1px solid rgba(46, 204, 113, 0.3);
            border-radius: 12px;
            padding: 14px;
            margin: 16px 0;
            position: relative;
            overflow: hidden;
        }

        .fun-fact:before {
            content: "🌱";
            position: absolute;
            top: -20px;
            right: -20px;
            font-size: 60px;
            opacity: 0.1;
        }

        .fun-fact-title {
            color: #2ecc71;
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 6px;
        }

        .fun-fact-text {
            color: rgba(255, 255, 255, 0.9);
            font-size: 12px;
            line-height: 1.5;
            position: relative;
            z-index: 1;
        }

        /* Voice Controls */
        .voice-controls {
            position: absolute;
            top: 10px;
            right: 20px;
            display: flex;
            gap: 8px;
            z-index: 1000;
        }

        .control-btn {
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            width: 44px;
            height: 44px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            position: relative;
        }

        .control-btn:hover {
            background: rgba(142, 68, 173, 0.3);
            border-color: #8e44ad;
            transform: scale(1.1);
        }

        .control-btn.active {
            background: rgba(142, 68, 173, 0.4);
            border-color: #8e44ad;
            box-shadow: 0 0 20px rgba(142, 68, 173, 0.5);
        }

        .control-tooltip {
            position: absolute;
            bottom: -30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9);
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 10px;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .control-btn:hover .control-tooltip {
            opacity: 1;
        }

        /* Loading Screen */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #27ae60 0%, #8e44ad 50%, #e74c3c 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            transition: opacity 1s ease;
        }

        .loading-content {
            text-align: center;
        }

        .loading-genetics {
            font-size: 60px;
            animation: geneticsPulse 1.5s ease-in-out infinite;
            margin-bottom: 20px;
        }

        .loading-text {
            color: white;
            font-size: 20px;
            margin-bottom: 20px;
        }

        .loading-progress {
            width: 200px;
            height: 4px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 2px;
            overflow: hidden;
        }

        .loading-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #27ae60, #8e44ad, #e74c3c);
            animation: loading 2s ease-in-out infinite;
        }

        @keyframes loading {
            0% { width: 0%; }
            50% { width: 100%; }
            100% { width: 0%; }
        }

        /* Voice Indicator */
        .voice-indicator {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(142, 68, 173, 0.5);
            border-radius: 30px;
            padding: 14px 28px;
            display: flex;
            align-items: center;
            gap: 12px;
            z-index: 1000;
            opacity: 0;
            transition: all 0.3s ease;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }

        .voice-indicator.visible {
            opacity: 1;
            transform: translateX(-50%) translateY(-10px);
        }

        .voice-waves {
            display: flex;
            align-items: center;
            gap: 3px;
        }

        .voice-wave {
            width: 3px;
            height: 20px;
            background: linear-gradient(180deg, #8e44ad, #27ae60);
            border-radius: 2px;
            animation: voice-wave 1s ease-in-out infinite;
        }

        .voice-wave:nth-child(2) { animation-delay: 0.1s; }
        .voice-wave:nth-child(3) { animation-delay: 0.2s; }
        .voice-wave:nth-child(4) { animation-delay: 0.3s; }
        .voice-wave:nth-child(5) { animation-delay: 0.4s; }

        @keyframes voice-wave {
            0%, 100% { transform: scaleY(0.3); }
            50% { transform: scaleY(1); }
        }

        .narration-text {
            color: white;
            font-size: 13px;
            max-width: 300px;
        }

        /* Quick Actions */
        .quick-actions {
            position: absolute;
            bottom: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            z-index: 1000;
        }

        .action-btn {
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 10px 16px;
            border-radius: 25px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
        }

        .action-btn:hover {
            background: rgba(39, 174, 96, 0.3);
            border-color: #27ae60;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(39, 174, 96, 0.3);
        }

        /* Custom Scrollbar */
        .info-panel::-webkit-scrollbar {
            width: 6px;
        }

        .info-panel::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 3px;
        }

        .info-panel::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, #8e44ad, #27ae60);
            border-radius: 3px;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .info-panel {
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                top: auto;
                width: 100%;
                max-height: 50vh;
                border-radius: 20px 20px 0 0;
            }
            
            .journey-navigation {
                bottom: 52vh;
                max-width: calc(100% - 40px);
            }
            
            .voice-controls {
                top: auto;
                bottom: 55vh;
                right: 10px;
            }
            
            .quick-actions {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="bg-animation"></div>

    <!-- Loading Screen -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-content">
            <div class="loading-genetics">🌱</div>
            <div class="loading-text">Exploring Mendel's Discoveries...</div>
            <div class="loading-progress">
                <div class="loading-progress-bar"></div>
            </div>
        </div>
    </div>

    <!-- Museum Header -->
    <div class="museum-header">
        <div class="museum-title">Mendel's Monohybrid Crosses</div>
        <div class="exhibit-subtitle">
            <span class="genetics-indicator"></span>
            The Foundation of Genetics
        </div>
    </div>

    <!-- Journey Navigation -->
    <div class="journey-navigation">
        <div class="journey-title">
            <span>🌱</span>
            <span>Your Genetics Journey</span>
        </div>
        <div class="journey-steps">
            <button class="journey-btn active" onclick="loadJourneyStep('pea_plant')">
                <span>🌱</span> Pea Plants
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('flower_anatomy')">
                <span>🌸</span> Flower Anatomy
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('chromosome')">
                <span>📊</span> Chromosomes
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('sperm_gamete')">
                <span>🏊</span> Male Gametes
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('egg_gamete')">
                <span>🥚</span> Female Gametes
            </button>
        </div>
    </div>

    <!-- 3D Model Container -->
    <div class="model-container">
        <div class="sketchfab-embed-wrapper">
            <iframe id="api-frame"
                    title="Pea Plant Model" 
                    frameborder="0" 
                    allowfullscreen 
                    mozallowfullscreen="true" 
                    webkitallowfullscreen="true" 
                    allow="autoplay; fullscreen; xr-spatial-tracking"
                    xr-spatial-tracking 
                    execution-while-out-of-viewport 
                    execution-while-not-rendered 
                    web-share 
                    src="https://sketchfab.com/models/782c72ae75934a6d8b437c81feee0855/embed">
            </iframe>
        </div>
    </div>

    <!-- Information Panel -->
    <div class="info-panel" id="infoPanel">
        <div class="info-header">
            <div class="info-icon" id="stepIcon">🌱</div>
            <div class="info-title">
                <h2 id="stepTitle">Mendel's Pea Plant Experiments</h2>
                <div class="info-subtitle" id="stepSubtitle">The birth of genetics</div>
            </div>
        </div>

        <!-- Progress Tracker -->
        <div class="progress-tracker">
            <div class="progress-header">
                <span>Journey Progress</span>
                <span class="progress-percentage" id="progressPercent">0%</span>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 0%"></div>
            </div>
            <div class="progress-steps-mini">
                <span class="step-mini active" onclick="loadJourneyStep('pea_plant')">Pea</span>
                <span class="step-mini" onclick="loadJourneyStep('flower_anatomy')">Flower</span>
                <span class="step-mini" onclick="loadJourneyStep('chromosome')">Chromosome</span>
                <span class="step-mini" onclick="loadJourneyStep('sperm_gamete')">Sperm</span>
                <span class="step-mini" onclick="loadJourneyStep('egg_gamete')">Egg</span>
            </div>
        </div>

        <div class="info-content" id="mainDescription">
            Gregor Mendel chose pea plants for his groundbreaking experiments because they had clear contrasting traits like tall versus short height. His careful study of how these traits were inherited laid the foundation for our understanding of genetics and established the principles of heredity.
        </div>

        <div class="info-card">
            <div class="info-card-title">
                <span>🔬</span> Key Concepts
            </div>
            <div class="info-card-content">
                <ul class="info-list" id="keyConcepts">
                    <li>Pea plants have easily observable contrasting traits</li>
                    <li>Self-fertilization allows controlled breeding</li>
                    <li>Tall vs short height controlled by single gene</li>
                    <li>Mendel studied inheritance patterns across generations</li>
                </ul>
            </div>
        </div>

        <div class="cross-diagram" id="crossDiagram">
            <div class="cross-title">Monohybrid Cross: Tall × Short</div>
            <div class="punnett-square">
                <div class="punnett-cell punnett-header"></div>
                <div class="punnett-cell punnett-header">T</div>
                <div class="punnett-cell punnett-header">T</div>
                <div class="punnett-cell punnett-header">t</div>
                <div class="punnett-cell punnett-result">Tt</div>
                <div class="punnett-cell punnett-result">Tt</div>
                <div class="punnett-cell punnett-header">t</div>
                <div class="punnett-cell punnett-result">Tt</div>
                <div class="punnett-cell punnett-result">Tt</div>
            </div>
        </div>

        <div class="ratio-display" id="ratioDisplay">
            <div class="ratio-title">F2 Generation Ratio</div>
            <div class="ratio-visual">
                <div class="ratio-square dominant">T</div>
                <div class="ratio-square dominant">T</div>
                <div class="ratio-square dominant">T</div>
                <div class="ratio-square recessive">t</div>
            </div>
            <div class="ratio-text">3 Tall : 1 Short (3:1 ratio)</div>
        </div>

        <div class="fun-fact">
            <div class="fun-fact-title">Mendel's Discovery!</div>
            <div class="fun-fact-text" id="funFact">
                Mendel counted over 8,000 pea plants across seven years of experiments! His mathematical approach to biology was revolutionary and established genetics as a quantitative science.
            </div>
        </div>

        <div class="info-card">
            <div class="info-card-title">
                <span>🎯</span> Learning Objectives
            </div>
            <div class="info-card-content" id="learningObjectives">
                Understand how Mendel's pea plant experiments revealed the basic principles of inheritance, including dominant and recessive traits and the 3:1 ratio in F2 generations.
            </div>
        </div>
    </div>

    <!-- Voice Controls -->
    <div class="voice-controls">
        <button class="control-btn active" id="voiceToggle" onclick="toggleVoice()">
            🔊
            <span class="control-tooltip">Voice Narration</span>
        </button>
        <button class="control-btn" onclick="toggleAutoPlay()">
            ▶️
            <span class="control-tooltip">Auto Journey</span>
        </button>
        <button class="control-btn" onclick="toggleInfo()">
            ℹ️
            <span class="control-tooltip">Toggle Info</span>
        </button>
    </div>

    <!-- Quick Actions -->
    <div class="quick-actions">
        <button class="action-btn" onclick="startGuidedTour()">
            <span>🚀</span> Guided Tour
        </button>
        <button class="action-btn" onclick="showQuiz()">
            <span>🎯</span> Test Knowledge
        </button>
    </div>

    <!-- Voice Indicator -->
    <div class="voice-indicator" id="voiceIndicator">
        <div class="voice-waves">
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
        </div>
        <div class="narration-text" id="narrationText">Narrating...</div>
    </div>

    <script>
        // Journey Step Data with Complete Pedagogical Content
        const JOURNEY_DATA = {
            pea_plant: {
                title: "Mendel's Pea Plant Experiments",
                subtitle: "The birth of genetics",
                icon: "🌱",
                modelUrl: "https://sketchfab.com/models/782c72ae75934a6d8b437c81feee0855/embed",
                description: "Gregor Mendel chose pea plants for his groundbreaking experiments because they had clear contrasting traits like tall versus short height. His careful study of how these traits were inherited laid the foundation for our understanding of genetics and established the principles of heredity.",
                concepts: [
                    "Pea plants have easily observable contrasting traits",
                    "Self-fertilization allows controlled breeding",
                    "Tall vs short height controlled by single gene",
                    "Mendel studied inheritance patterns across generations"
                ],
                funFact: "Mendel counted over 8,000 pea plants across seven years of experiments! His mathematical approach to biology was revolutionary and established genetics as a quantitative science.",
                objectives: "Understand how Mendel's pea plant experiments revealed the basic principles of inheritance, including dominant and recessive traits and the 3:1 ratio in F2 generations.",
                crossType: "P Generation: TT × tt",
                ratio: "All F1: Tall (Tt)",
                narration: "Welcome to Mendel's garden! You're looking at the pea plants that changed our understanding of life itself. Gregor Mendel, an Austrian monk, chose pea plants for his experiments because they had seven easily observable traits with clear contrasting forms - like tall versus short plants. What made pea plants perfect for genetic study was their ability to self-fertilize, allowing Mendel to control breeding carefully. In his monohybrid crosses, Mendel focused on one trait at a time. When he crossed a purebred tall plant with a purebred short plant, something remarkable happened: all the offspring in the F1 generation were tall! The short trait seemed to disappear completely. But Mendel didn't stop there. When he allowed these F1 plants to self-fertilize, the F2 generation showed both tall and short plants in a consistent 3:1 ratio. This led him to conclude that traits are controlled by discrete factors - what we now call genes - and that some factors are dominant over others."
            },
            flower_anatomy: {
                title: "Flower Anatomy - Reproduction Structure",
                subtitle: "How pea plants reproduce",
                icon: "🌸",
                modelUrl: "https://sketchfab.com/models/4ce0afd091d742e286a0de156e183d95/embed?autostart=1&internal=1&tracking=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "Understanding flower anatomy is crucial to comprehending how Mendel controlled his crosses. Pea flowers contain both male and female reproductive parts, allowing for both self-fertilization and controlled cross-fertilization in genetic experiments.",
                concepts: [
                    "Flowers contain both male (stamen) and female (pistil) parts",
                    "Pollen carries male gametes with genetic information",
                    "Ovules contain female gametes",
                    "Fertilization combines genetic material from both parents"
                ],
                funFact: "Pea flowers naturally self-fertilize before opening, which helped Mendel create pure breeding lines for his experiments!",
                objectives: "Learn how flower structure enables controlled genetic crosses and understand the role of gametes in inheritance.",
                crossType: "F1 × F1: Tt × Tt",
                ratio: "F2: 3 Tall : 1 Short",
                narration: "Explore the intricate structure of a pea flower - the key to Mendel's experimental success! This flower contains all the reproductive organs needed for sexual reproduction. The stamens are the male parts, consisting of anthers that produce pollen grains containing male gametes. The pistil is the female part, with the ovary containing ovules that house female gametes. What made pea flowers ideal for Mendel's work was their tendency to self-fertilize before the flower opens, ensuring genetic purity in his breeding lines. When Mendel wanted to perform controlled crosses, he would carefully remove the anthers from young flowers before they matured, preventing self-fertilization, then manually transfer pollen from a different plant. During fertilization, the genetic material from the pollen combines with genetic material in the ovule, creating seeds that carry traits from both parents. This process demonstrates how traits are passed from one generation to the next through the fusion of gametes."
            },
            chromosome: {
                title: "Chromosomes - The Physical Basis of Heredity",
                subtitle: "Where genes are located",
                icon: "📊",
                modelUrl: "https://sketchfab.com/models/cc33bb1ebe6141b08d0d06f1bbebc2b7/embed?autostart=1&internal=1&tracking=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "Chromosomes are the physical structures that carry genes. In Mendel's time, chromosomes weren't yet discovered, but we now know that the 'factors' he described are genes located on chromosomes, and their behavior during meiosis explains his inheritance patterns.",
                concepts: [
                    "Genes are located on chromosomes",
                    "Homologous chromosomes carry same genes",
                    "Alleles are different versions of the same gene",
                    "Chromosome separation during meiosis explains Mendel's ratios"
                ],
                funFact: "Mendel's laws were rediscovered in 1900, the same year chromosomes were first observed dividing during cell division!",
                objectives: "Connect Mendel's abstract 'factors' to the physical reality of genes on chromosomes and understand how chromosome behavior creates inheritance patterns.",
                crossType: "Meiosis: Chromosome separation",
                ratio: "Each gamete gets one allele",
                narration: "Here we see the physical basis of Mendel's discoveries - chromosomes! Although Mendel worked 50 years before chromosomes were discovered, his 'factors' are actually genes located on these thread-like structures. Each chromosome carries hundreds or thousands of genes, and in sexually reproducing organisms like pea plants, chromosomes come in pairs called homologous chromosomes. These pairs carry the same genes but may have different versions - called alleles. For Mendel's tall versus short trait, both chromosomes of the pair carry the height gene, but one might have the tall allele (T) while the other has the short allele (t). During meiosis, the process that creates gametes, homologous chromosomes separate so each gamete receives only one chromosome from each pair. This means each pollen grain or ovule gets only one allele for each gene. When fertilization occurs, the chromosome pairs are restored, and the offspring receives one allele from each parent. This chromosome behavior perfectly explains Mendel's observations and the mathematical ratios he discovered!"
            },
            sperm_gamete: {
                title: "Male Gametes - Pollen Power",
                subtitle: "Carrying genetic information",
                icon: "🏊",
                modelUrl: "https://sketchfab.com/models/267dc672834749b5b332d23ee013a00a/embed?autostart=1&internal=1&tracking=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "In plants, male gametes are contained within pollen grains. Each pollen grain carries genetic information from the parent plant and represents one possible combination of alleles that can be passed to offspring, explaining the genetic diversity seen in Mendel's crosses.",
                concepts: [
                    "Pollen grains contain male gametes",
                    "Each gamete carries one allele per gene",
                    "Meiosis creates genetic diversity in gametes",
                    "Random fertilization creates offspring variation"
                ],
                funFact: "A single pea plant can produce thousands of pollen grains, each genetically unique due to the random assortment of chromosomes during meiosis!",
                objectives: "Understand how male gametes contribute to genetic inheritance and explain the source of variation in Mendel's F2 generation.",
                crossType: "Gamete formation: Tt → T or t",
                ratio: "50% T gametes : 50% t gametes",
                narration: "Examine the male gamete - the microscopic carrier of genetic inheritance! In plants, male gametes are housed within pollen grains, each one a tiny vessel carrying half the genetic information needed to create a new plant. This model represents the structure that carries genetic material from the male parent. When a plant with the genotype Tt undergoes meiosis to produce gametes, something fascinating happens: each gamete receives only one allele for each gene. This means that a heterozygous tall plant (Tt) produces two types of pollen - half carrying the T allele for tallness, and half carrying the t allele for shortness. This 50:50 ratio of gametes is crucial to understanding Mendel's results. When these gametes fertilize eggs in random combinations, they create the characteristic 3:1 phenotypic ratio Mendel observed. The random nature of which sperm fertilizes which egg ensures that genetic traits are shuffled and reshuffled each generation, creating the variation that drives evolution and makes each individual unique."
            },
            egg_gamete: {
                title: "Female Gametes - The Genetic Foundation",
                subtitle: "Completing the inheritance puzzle",
                icon: "🥚",
                modelUrl: "https://sketchfab.com/models/21c19e1b34dd4e4d9cfefa5c8163e8c6/embed?autostart=1&internal=1&tracking=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "Female gametes in plants are contained within ovules and contribute equally to inheritance. When male and female gametes combine during fertilization, they restore the full chromosome number and create the genetic combinations that produce Mendel's famous ratios.",
                concepts: [
                    "Ovules contain female gametes",
                    "Female gametes also carry one allele per gene",
                    "Fertilization combines male and female genetic contributions",
                    "Random combination creates predictable ratios"
                ],
                funFact: "The moment of fertilization, when male and female gametes fuse, determines the genetic makeup of the offspring and whether it will be tall or short!",
                objectives: "Complete understanding of how both male and female gametes contribute to inheritance patterns and create the mathematical ratios Mendel observed.",
                crossType: "Fertilization: T×T, T×t, t×T, t×t",
                ratio: "TT:Tt:Tt:tt = 1:2:1 genotypic ratio",
                narration: "Meet the female gamete - the other half of the inheritance equation! Just like male gametes, female gametes carry exactly one allele for each gene, contributing equally to the genetic makeup of offspring. In Mendel's crosses, when a heterozygous plant (Tt) produces eggs through meiosis, half the eggs carry the T allele and half carry the t allele. The magic happens during fertilization when these female gametes randomly combine with male gametes. If we consider all possible combinations from a Tt × Tt cross, we get four equally likely outcomes: T egg with T pollen creates TT (tall), T egg with t pollen creates Tt (tall), t egg with T pollen creates Tt (tall), and t egg with t pollen creates tt (short). This gives us the famous 1:2:1 genotypic ratio, which translates to the 3:1 phenotypic ratio Mendel observed - three tall plants for every short plant. This elegant mathematical relationship revealed that inheritance follows predictable patterns, establishing genetics as a quantitative science and laying the groundwork for our modern understanding of heredity."
            }
        };

        // Global Variables
        let currentStep = 'pea_plant';
        let voiceEnabled = true;
        let autoPlayEnabled = false;
        let currentSpeech = null;
        let selectedVoice = null;
        let journeyProgress = 0;
        let guidedTourActive = false;

        // Initialize Voice System
        function initVoiceSystem() {
            if (!('speechSynthesis' in window)) {
                console.warn('Speech synthesis not supported');
                voiceEnabled = false;
                document.getElementById('voiceToggle').style.display = 'none';
                return;
            }

            function loadVoices() {
                const voices = speechSynthesis.getVoices();
                if (voices.length === 0) return;

                const preferredVoices = [
                    'Google UK English Female',
                    'Microsoft Sonia',
                    'Microsoft Hazel',
                    'Samantha',
                    'Victoria'
                ];

                for (const name of preferredVoices) {
                    selectedVoice = voices.find(v => v.name.includes(name));
                    if (selectedVoice) break;
                }

                if (!selectedVoice) {
                    selectedVoice = voices.find(v => v.lang.startsWith('en'));
                }
            }

            loadVoices();
            if (speechSynthesis.onvoiceschanged !== undefined) {
                speechSynthesis.onvoiceschanged = loadVoices;
            }
        }

        // Load Journey Step
        function loadJourneyStep(stepId) {
            const stepData = JOURNEY_DATA[stepId];
            if (!stepData) return;

            currentStep = stepId;
            
            // Update model
            document.getElementById('api-frame').src = stepData.modelUrl;
            
            // Update info panel
            document.getElementById('stepIcon').textContent = stepData.icon;
            document.getElementById('stepTitle').textContent = stepData.title;
            document.getElementById('stepSubtitle').textContent = stepData.subtitle;
            document.getElementById('mainDescription').textContent = stepData.description;
            
            // Update key concepts
            const conceptsList = document.getElementById('keyConcepts');
            conceptsList.innerHTML = stepData.concepts.map(c => `<li>${c}</li>`).join('');
            
            // Update fun fact
            document.getElementById('funFact').textContent = stepData.funFact;
            
            // Update learning objectives
            document.getElementById('learningObjectives').textContent = stepData.objectives;
            
            // Update cross diagram and ratio display based on step
            updateCrossDisplay(stepId, stepData);
            
            // Update navigation buttons
            updateNavigationButtons(stepId);
            
            // Update progress
            updateProgress();
            
            // Play narration if enabled
            if (voiceEnabled) {
                speakText(stepData.narration);
            }
        }

        // Update Cross Display
        function updateCrossDisplay(stepId, stepData) {
            const crossDiagram = document.getElementById('crossDiagram');
            const ratioDisplay = document.getElementById('ratioDisplay');
            
            // Update cross title
            crossDiagram.querySelector('.cross-title').textContent = stepData.crossType;
            
            // Update ratio display
            ratioDisplay.querySelector('.ratio-text').textContent = stepData.ratio;
            
            // Update Punnett square based on step
            const squares = crossDiagram.querySelectorAll('.punnett-result');
            switch(stepId) {
                case 'pea_plant':
                    squares.forEach(square => square.textContent = 'Tt');
                    break;
                case 'flower_anatomy':
                    squares[0].textContent = 'TT';
                    squares[1].textContent = 'Tt';
                    squares[2].textContent = 'Tt';
                    squares[3].textContent = 'tt';
                    break;
                default:
                    squares.forEach((square, index) => {
                        const combinations = ['TT', 'Tt', 'Tt', 'tt'];
                        square.textContent = combinations[index];
                    });
            }
        }

        // Update Navigation Buttons
        function updateNavigationButtons(activeStep) {
            const buttons = document.querySelectorAll('.journey-btn');
            const steps = ['pea_plant', 'flower_anatomy', 'chromosome', 'sperm_gamete', 'egg_gamete'];
            const activeIndex = steps.indexOf(activeStep);
            
            buttons.forEach((btn, index) => {
                btn.classList.remove('active', 'completed');
                if (index < activeIndex) {
                    btn.classList.add('completed');
                } else if (index === activeIndex) {
                    btn.classList.add('active');
                }
            });
            
            // Update mini steps
            const miniSteps = document.querySelectorAll('.step-mini');
            miniSteps.forEach((step, index) => {
                step.classList.remove('active', 'completed');
                if (index < activeIndex) {
                    step.classList.add('completed');
                } else if (index === activeIndex) {
                    step.classList.add('active');
                }
            });
        }

        // Update Progress
        function updateProgress() {
            const steps = ['pea_plant', 'flower_anatomy', 'chromosome', 'sperm_gamete', 'egg_gamete'];
            const currentIndex = steps.indexOf(currentStep);
            const progress = ((currentIndex + 1) / steps.length) * 100;
            
            document.getElementById('progressPercent').textContent = Math.round(progress) + '%';
            document.getElementById('progressFill').style.width = progress + '%';
        }

        // Speech Functions
        function speakText(text) {
            if (!voiceEnabled || !text) return;
            
            stopSpeech();
            
            currentSpeech = new SpeechSynthesisUtterance(text);
            if (selectedVoice) {
                currentSpeech.voice = selectedVoice;
            }
            currentSpeech.rate = 0.9;
            currentSpeech.pitch = 1.0;
            currentSpeech.volume = 0.9;
            
            currentSpeech.onstart = () => {
                document.getElementById('voiceIndicator').classList.add('visible');
                document.getElementById('narrationText').textContent = 
                    text.substring(0, 50) + (text.length > 50 ? '...' : '');
            };
            
            currentSpeech.onend = () => {
                document.getElementById('voiceIndicator').classList.remove('visible');
                currentSpeech = null;
                
                if (guidedTourActive) {
                    setTimeout(nextStep, 2000);
                }
            };
            
            speechSynthesis.speak(currentSpeech);
        }

        function stopSpeech() {
            if (currentSpeech) {
                speechSynthesis.cancel();
                currentSpeech = null;
                document.getElementById('voiceIndicator').classList.remove('visible');
            }
        }

        // Control Functions
        function toggleVoice() {
            voiceEnabled = !voiceEnabled;
            const btn = document.getElementById('voiceToggle');
            btn.textContent = voiceEnabled ? '🔊' : '🔇';
            btn.classList.toggle('active', voiceEnabled);
            
            if (!voiceEnabled) {
                stopSpeech();
            }
        }

        function toggleAutoPlay() {
            autoPlayEnabled = !autoPlayEnabled;
            if (autoPlayEnabled) {
                startGuidedTour();
            } else {
                guidedTourActive = false;
            }
        }

        function toggleInfo() {
            const panel = document.getElementById('infoPanel');
            panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
        }

        // Guided Tour
        function startGuidedTour() {
            guidedTourActive = true;
            const steps = ['pea_plant', 'flower_anatomy', 'chromosome', 'sperm_gamete', 'egg_gamete'];
            let stepIndex = 0;
            
            function tourStep() {
                if (stepIndex < steps.length && guidedTourActive) {
                    loadJourneyStep(steps[stepIndex]);
                    stepIndex++;
                } else {
                    guidedTourActive = false;
                    if (voiceEnabled) {
                        speakText("Congratulations! You've completed your journey through Mendel's groundbreaking discoveries. You now understand the fundamental principles of genetics: how traits are inherited, why some are dominant over others, and how the 3:1 ratio emerges from the behavior of chromosomes and gametes during reproduction!");
                    }
                }
            }
            
            tourStep();
            window.nextStep = tourStep;
        }

        // Quiz Function
        function showQuiz() {
            const questions = [
                "Why did Mendel choose pea plants for his experiments?",
                "What happens when you cross a tall pea plant (TT) with a short pea plant (tt)?",
                "What is the phenotypic ratio in Mendel's F2 generation?",
                "How do chromosomes explain Mendel's inheritance patterns?",
                "What role do gametes play in creating the 3:1 ratio?"
            ];
            
            const randomQ = questions[Math.floor(Math.random() * questions.length)];
            
            if (voiceEnabled) {
                speakText(`Here's a question to test your knowledge: ${randomQ} Think about what you've learned about Mendel's experiments and the principles of inheritance!`);
            }
        }

        // Initialize
        function init() {
            initVoiceSystem();
            
            // Hide loading screen
            setTimeout(() => {
                const loading = document.getElementById('loadingOverlay');
                loading.style.opacity = '0';
                setTimeout(() => {
                    loading.style.display = 'none';
                    
                    // Welcome message
                    if (voiceEnabled) {
                        speakText("Welcome to Mendel's revolutionary world of genetics! We'll explore how a humble monk's experiments with pea plants uncovered the fundamental laws of inheritance. Let's discover how Mendel's careful observations of tall and short plants led to our understanding of dominant and recessive traits!");
                    }
                }, 1000);
            }, 3000);
            
            // Keyboard shortcuts
            document.addEventListener('keydown', (e) => {
                switch(e.key) {
                    case 'v': toggleVoice(); break;
                    case 'i': toggleInfo(); break;
                    case 'g': startGuidedTour(); break;
                    case 'Escape': stopSpeech(); guidedTourActive = false; break;
                    case 'ArrowRight': nextStep && nextStep(); break;
                }
            });
        }

        // Start the application
        init();
    </script>
</body>
</html>