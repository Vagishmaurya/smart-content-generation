<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dihybrid Crosses & Independent Assortment - Advanced Genetics</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tween.js/18.6.4/tween.umd.js"></script>

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #2980b9 0%, #c0392b 50%, #f39c12 100%);
            color: white;
            overflow: hidden;
            position: relative;
            height: 100vh;
        }

        /* Animated Background */
        .bg-animation {
            position: fixed;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: 0;
            opacity: 0.1;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 320"><path fill="%23ffffff" fill-opacity="0.3" d="M0,128L48,138.7C96,149,192,171,288,165.3C384,160,480,128,576,122.7C672,117,768,139,864,138.7C960,139,1056,117,1152,112C1248,107,1344,117,1392,122.7L1440,128L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z"></path></svg>') repeat-x;
            animation: dihybridWave 16s linear infinite;
        }

        @keyframes dihybridWave {
            0% { background-position-x: 0; }
            100% { background-position-x: 1440px; }
        }

        /* Museum Interface - Compact Header */
        .museum-header {
            position: absolute;
            top: 10px;
            left: 20px;
            text-align: left;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            padding: 10px 18px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .museum-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 4px;
            background: linear-gradient(45deg, #2980b9, #c0392b, #f39c12);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: titleGlow 3s ease-in-out infinite;
        }

        @keyframes titleGlow {
            0%, 100% { filter: brightness(1); }
            50% { filter: brightness(1.2); }
        }

        .exhibit-subtitle {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.8);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .dihybrid-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            background: linear-gradient(45deg, #2980b9, #c0392b);
            border-radius: 50%;
            animation: dihybridPulse 2s ease-in-out infinite;
        }

        @keyframes dihybridPulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.3); opacity: 0.7; }
        }

        /* Journey Navigation - Enhanced */
        .journey-navigation {
            position: absolute;
            bottom: 20px;
            left: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            padding: 15px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            max-width: 360px;
        }

        .journey-title {
            font-size: 14px;
            font-weight: 600;
            color: #2980b9;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .journey-steps {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }

        .journey-btn {
            background: rgba(41, 128, 185, 0.2);
            border: 1px solid rgba(41, 128, 185, 0.4);
            color: white;
            padding: 6px 10px;
            border-radius: 20px;
            font-size: 11px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 4px;
            white-space: nowrap;
        }

        .journey-btn:hover {
            background: rgba(41, 128, 185, 0.3);
            border-color: #2980b9;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(41, 128, 185, 0.3);
        }

        .journey-btn.active {
            background: linear-gradient(135deg, #c0392b, #e74c3c);
            border-color: #c0392b;
            box-shadow: 0 0 20px rgba(192, 57, 43, 0.5);
            animation: pulse 2s infinite;
        }

        .journey-btn.completed {
            background: rgba(46, 204, 113, 0.3);
            border-color: #2ecc71;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        /* 3D Model Container */
        .model-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 0;
            overflow: hidden;
            border: none;
            z-index: 100;
        }

        .sketchfab-embed-wrapper {
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #2980b9 0%, #c0392b 50%, #f39c12 100%);
        }

        .sketchfab-embed-wrapper iframe {
            width: 100%;
            height: 100%;
            border: none;
            border-radius: 0;
        }

        /* Information Panel - Enhanced */
        .info-panel {
            position: absolute;
            top: 70px;
            right: 20px;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(25px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 16px;
            padding: 24px;
            width: 440px;
            max-height: calc(100vh - 140px);
            z-index: 800;
            overflow-y: auto;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }

        .info-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        }

        .info-icon {
            font-size: 28px;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        .info-title {
            flex: 1;
        }

        .info-title h2 {
            font-size: 18px;
            color: #c0392b;
            margin-bottom: 4px;
        }

        .info-subtitle {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.7);
        }

        .info-content {
            color: rgba(255, 255, 255, 0.9);
            font-size: 14px;
            line-height: 1.6;
        }

        /* Progress Tracker */
        .progress-tracker {
            background: linear-gradient(135deg, rgba(41, 128, 185, 0.1), rgba(192, 57, 43, 0.1));
            border: 1px solid rgba(41, 128, 185, 0.3);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 20px;
        }

        .progress-header {
            font-size: 13px;
            font-weight: 600;
            color: #2980b9;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .progress-percentage {
            font-size: 18px;
            color: #c0392b;
            font-weight: 700;
        }

        .progress-bar {
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 12px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #2980b9, #c0392b, #f39c12);
            border-radius: 4px;
            transition: width 0.8s ease;
            box-shadow: 0 0 10px rgba(192, 57, 43, 0.5);
        }

        .progress-steps-mini {
            display: flex;
            justify-content: space-between;
            font-size: 9px;
            color: rgba(255, 255, 255, 0.6);
        }

        .step-mini {
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .step-mini.active {
            color: #c0392b;
            font-weight: 600;
        }

        .step-mini.completed {
            color: #2ecc71;
        }

        /* Information Cards */
        .info-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 14px;
            margin-bottom: 14px;
        }

        .info-card-title {
            color: #2980b9;
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .info-card-content {
            color: rgba(255, 255, 255, 0.85);
            font-size: 12px;
            line-height: 1.5;
        }

        .info-list {
            list-style: none;
            padding: 0;
        }

        .info-list li {
            padding: 6px 0;
            padding-left: 20px;
            position: relative;
            font-size: 12px;
            color: rgba(255, 255, 255, 0.8);
        }

        .info-list li:before {
            content: "‚Üí";
            position: absolute;
            left: 0;
            color: #c0392b;
        }

        /* Dihybrid Ratio Display */
        .ratio-display {
            background: linear-gradient(135deg, rgba(192, 57, 43, 0.1), rgba(243, 156, 18, 0.1));
            border: 1px solid rgba(192, 57, 43, 0.3);
            border-radius: 12px;
            padding: 16px;
            margin: 16px 0;
            text-align: center;
        }

        .ratio-title {
            color: #c0392b;
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 12px;
        }

        .ratio-visual {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 4px;
            max-width: 200px;
            margin: 0 auto 12px;
        }

        .ratio-square {
            width: 40px;
            height: 30px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: bold;
        }

        .phenotype-1 { background: #27ae60; color: white; } /* Round Yellow */
        .phenotype-2 { background: #f39c12; color: white; } /* Round Green */
        .phenotype-3 { background: #8e44ad; color: white; } /* Wrinkled Yellow */
        .phenotype-4 { background: #e74c3c; color: white; } /* Wrinkled Green */

        .ratio-text {
            color: rgba(255, 255, 255, 0.9);
            font-size: 12px;
            line-height: 1.4;
        }

        /* Large Dihybrid Cross Diagram */
        .dihybrid-diagram {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 16px;
            margin: 16px 0;
        }

        .diagram-title {
            color: #2980b9;
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 12px;
            text-align: center;
        }

        .punnett-4x4 {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 1px;
            max-width: 250px;
            margin: 0 auto;
        }

        .punnett-cell-4x4 {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 4px;
            text-align: center;
            font-size: 9px;
            min-height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .punnett-header-4x4 {
            background: rgba(41, 128, 185, 0.3);
            font-weight: bold;
            font-size: 8px;
        }

        .punnett-result-4x4 {
            background: rgba(192, 57, 43, 0.2);
            font-size: 8px;
        }

        /* Gamete Formation Display */
        .gamete-display {
            background: linear-gradient(135deg, rgba(41, 128, 185, 0.1), rgba(142, 68, 173, 0.1));
            border: 1px solid rgba(41, 128, 185, 0.3);
            border-radius: 12px;
            padding: 16px;
            margin: 16px 0;
        }

        .gamete-title {
            color: #2980b9;
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 12px;
            text-align: center;
        }

        .gamete-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            margin-bottom: 8px;
        }

        .gamete-cell {
            background: rgba(41, 128, 185, 0.3);
            border: 1px solid rgba(41, 128, 185, 0.5);
            padding: 8px;
            text-align: center;
            border-radius: 6px;
            font-size: 11px;
            font-weight: bold;
        }

        /* Fun Fact Box */
        .fun-fact {
            background: linear-gradient(135deg, rgba(46, 204, 113, 0.1), rgba(52, 152, 219, 0.1));
            border: 1px solid rgba(46, 204, 113, 0.3);
            border-radius: 12px;
            padding: 14px;
            margin: 16px 0;
            position: relative;
            overflow: hidden;
        }

        .fun-fact:before {
            content: "üß¨";
            position: absolute;
            top: -20px;
            right: -20px;
            font-size: 60px;
            opacity: 0.1;
        }

        .fun-fact-title {
            color: #2ecc71;
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 6px;
        }

        .fun-fact-text {
            color: rgba(255, 255, 255, 0.9);
            font-size: 12px;
            line-height: 1.5;
            position: relative;
            z-index: 1;
        }

        /* Voice Controls */
        .voice-controls {
            position: absolute;
            top: 10px;
            right: 20px;
            display: flex;
            gap: 8px;
            z-index: 1000;
        }

        .control-btn {
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            width: 44px;
            height: 44px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            position: relative;
        }

        .control-btn:hover {
            background: rgba(192, 57, 43, 0.3);
            border-color: #c0392b;
            transform: scale(1.1);
        }

        .control-btn.active {
            background: rgba(192, 57, 43, 0.4);
            border-color: #c0392b;
            box-shadow: 0 0 20px rgba(192, 57, 43, 0.5);
        }

        .control-tooltip {
            position: absolute;
            bottom: -30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9);
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 10px;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .control-btn:hover .control-tooltip {
            opacity: 1;
        }

        /* Loading Screen */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #2980b9 0%, #c0392b 50%, #f39c12 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            transition: opacity 1s ease;
        }

        .loading-content {
            text-align: center;
        }

        .loading-dihybrid {
            font-size: 60px;
            animation: dihybridPulse 1.5s ease-in-out infinite;
            margin-bottom: 20px;
        }

        .loading-text {
            color: white;
            font-size: 20px;
            margin-bottom: 20px;
        }

        .loading-progress {
            width: 200px;
            height: 4px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 2px;
            overflow: hidden;
        }

        .loading-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #2980b9, #c0392b, #f39c12);
            animation: loading 2s ease-in-out infinite;
        }

        @keyframes loading {
            0% { width: 0%; }
            50% { width: 100%; }
            100% { width: 0%; }
        }

        /* Voice Indicator */
        .voice-indicator {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(192, 57, 43, 0.5);
            border-radius: 30px;
            padding: 14px 28px;
            display: flex;
            align-items: center;
            gap: 12px;
            z-index: 1000;
            opacity: 0;
            transition: all 0.3s ease;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }

        .voice-indicator.visible {
            opacity: 1;
            transform: translateX(-50%) translateY(-10px);
        }

        .voice-waves {
            display: flex;
            align-items: center;
            gap: 3px;
        }

        .voice-wave {
            width: 3px;
            height: 20px;
            background: linear-gradient(180deg, #c0392b, #2980b9);
            border-radius: 2px;
            animation: voice-wave 1s ease-in-out infinite;
        }

        .voice-wave:nth-child(2) { animation-delay: 0.1s; }
        .voice-wave:nth-child(3) { animation-delay: 0.2s; }
        .voice-wave:nth-child(4) { animation-delay: 0.3s; }
        .voice-wave:nth-child(5) { animation-delay: 0.4s; }

        @keyframes voice-wave {
            0%, 100% { transform: scaleY(0.3); }
            50% { transform: scaleY(1); }
        }

        .narration-text {
            color: white;
            font-size: 13px;
            max-width: 300px;
        }

        /* Quick Actions */
        .quick-actions {
            position: absolute;
            bottom: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            z-index: 1000;
        }

        .action-btn {
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 10px 16px;
            border-radius: 25px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
        }

        .action-btn:hover {
            background: rgba(41, 128, 185, 0.3);
            border-color: #2980b9;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(41, 128, 185, 0.3);
        }

        /* Custom Scrollbar */
        .info-panel::-webkit-scrollbar {
            width: 6px;
        }

        .info-panel::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 3px;
        }

        .info-panel::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, #c0392b, #2980b9);
            border-radius: 3px;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .info-panel {
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                top: auto;
                width: 100%;
                max-height: 50vh;
                border-radius: 20px 20px 0 0;
            }
            
            .journey-navigation {
                bottom: 52vh;
                max-width: calc(100% - 40px);
            }
            
            .voice-controls {
                top: auto;
                bottom: 55vh;
                right: 10px;
            }
            
            .quick-actions {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="bg-animation"></div>

    <!-- Loading Screen -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-content">
            <div class="loading-dihybrid">üß¨</div>
            <div class="loading-text">Exploring Two-Trait Inheritance...</div>
            <div class="loading-progress">
                <div class="loading-progress-bar"></div>
            </div>
        </div>
    </div>

    <!-- Museum Header -->
    <div class="museum-header">
        <div class="museum-title">Dihybrid Crosses & Independent Assortment</div>
        <div class="exhibit-subtitle">
            <span class="dihybrid-indicator"></span>
            Advanced Genetics
        </div>
    </div>

    <!-- Journey Navigation -->
    <div class="journey-navigation">
        <div class="journey-title">
            <span>üß¨</span>
            <span>Your Dihybrid Journey</span>
        </div>
        <div class="journey-steps">
            <button class="journey-btn active" onclick="loadJourneyStep('seed_traits')">
                <span>üå∞</span> Seed Traits
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('flower_reproduction')">
                <span>üå∏</span> Reproduction
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('chromosome_behavior')">
                <span>üìä</span> Chromosomes
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('meiosis_process')">
                <span>üîÑ</span> Meiosis
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('gamete_formation')">
                <span>üî¨</span> Gametes
            </button>
        </div>
    </div>

    <!-- 3D Model Container -->
    <div class="model-container">
        <div class="sketchfab-embed-wrapper">
            <iframe id="api-frame"
                    title="Pea Plant Model" 
                    frameborder="0" 
                    allowfullscreen 
                    mozallowfullscreen="true" 
                    webkitallowfullscreen="true" 
                    allow="autoplay; fullscreen; xr-spatial-tracking"
                    xr-spatial-tracking 
                    execution-while-out-of-viewport 
                    execution-while-not-rendered 
                    web-share 
                    src="https://sketchfab.com/models/782c72ae75934a6d8b437c81feee0855/embed">
            </iframe>
        </div>
    </div>

    <!-- Information Panel -->
    <div class="info-panel" id="infoPanel">
        <div class="info-header">
            <div class="info-icon" id="stepIcon">üå∞</div>
            <div class="info-title">
                <h2 id="stepTitle">Two-Trait Inheritance: Seed Shape & Color</h2>
                <div class="info-subtitle" id="stepSubtitle">Round/wrinkled and yellow/green combinations</div>
            </div>
        </div>

        <!-- Progress Tracker -->
        <div class="progress-tracker">
            <div class="progress-header">
                <span>Journey Progress</span>
                <span class="progress-percentage" id="progressPercent">0%</span>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 0%"></div>
            </div>
            <div class="progress-steps-mini">
                <span class="step-mini active" onclick="loadJourneyStep('seed_traits')">Seeds</span>
                <span class="step-mini" onclick="loadJourneyStep('flower_reproduction')">Flower</span>
                <span class="step-mini" onclick="loadJourneyStep('chromosome_behavior')">Chromosome</span>
                <span class="step-mini" onclick="loadJourneyStep('meiosis_process')">Meiosis</span>
                <span class="step-mini" onclick="loadJourneyStep('gamete_formation')">Gametes</span>
            </div>
        </div>

        <div class="info-content" id="mainDescription">
            Mendel's dihybrid crosses examined two traits simultaneously: seed shape (round vs wrinkled) and seed color (yellow vs green). The cross RR yy √ó rr YY produced F1 offspring (Rr Yy) that were all round and yellow, demonstrating dominance. The F2 generation showed a 9:3:3:1 ratio, revealing independent assortment.
        </div>

        <div class="info-card">
            <div class="info-card-title">
                <span>üî¨</span> Key Concepts
            </div>
            <div class="info-card-content">
                <ul class="info-list" id="keyConcepts">
                    <li>Two traits examined: shape (R/r) and color (Y/y)</li>
                    <li>P generation: RR yy √ó rr YY</li>
                    <li>F1 generation: All Rr Yy (round, yellow)</li>
                    <li>F2 shows 9:3:3:1 phenotypic ratio</li>
                </ul>
            </div>
        </div>

        <div class="dihybrid-diagram" id="dihybridDiagram">
            <div class="diagram-title">Dihybrid Cross: Rr Yy √ó Rr Yy</div>
            <div class="punnett-4x4">
                <div class="punnett-cell-4x4 punnett-header-4x4"></div>
                <div class="punnett-cell-4x4 punnett-header-4x4">RY</div>
                <div class="punnett-cell-4x4 punnett-header-4x4">Ry</div>
                <div class="punnett-cell-4x4 punnett-header-4x4">rY</div>
                <div class="punnett-cell-4x4 punnett-header-4x4">ry</div>
                <div class="punnett-cell-4x4 punnett-header-4x4">RY</div>
                <div class="punnett-cell-4x4 punnett-result-4x4">RRYY</div>
                <div class="punnett-cell-4x4 punnett-result-4x4">RRYy</div>
                <div class="punnett-cell-4x4 punnett-result-4x4">RrYY</div>
                <div class="punnett-cell-4x4 punnett-result-4x4">RrYy</div>
                <div class="punnett-cell-4x4 punnett-header-4x4">Ry</div>
                <div class="punnett-cell-4x4 punnett-result-4x4">RRYy</div>
                <div class="punnett-cell-4x4 punnett-result-4x4">RRyy</div>
                <div class="punnett-cell-4x4 punnett-result-4x4">RrYy</div>
                <div class="punnett-cell-4x4 punnett-result-4x4">Rryy</div>
                <div class="punnett-cell-4x4 punnett-header-4x4">rY</div>
                <div class="punnett-cell-4x4 punnett-result-4x4">RrYY</div>
                <div class="punnett-cell-4x4 punnett-result-4x4">RrYy</div>
                <div class="punnett-cell-4x4 punnett-result-4x4">rrYY</div>
                <div class="punnett-cell-4x4 punnett-result-4x4">rrYy</div>
                <div class="punnett-cell-4x4 punnett-header-4x4">ry</div>
                <div class="punnett-cell-4x4 punnett-result-4x4">RrYy</div>
                <div class="punnett-cell-4x4 punnett-result-4x4">Rryy</div>
                <div class="punnett-cell-4x4 punnett-result-4x4">rrYy</div>
                <div class="punnett-cell-4x4 punnett-result-4x4">rryy</div>
            </div>
        </div>

        <div class="ratio-display" id="ratioDisplay">
            <div class="ratio-title">F2 Generation 9:3:3:1 Ratio</div>
            <div class="ratio-visual">
                <div class="ratio-square phenotype-1">RY</div>
                <div class="ratio-square phenotype-1">RY</div>
                <div class="ratio-square phenotype-1">RY</div>
                <div class="ratio-square phenotype-1">RY</div>
                <div class="ratio-square phenotype-1">RY</div>
                <div class="ratio-square phenotype-1">RY</div>
                <div class="ratio-square phenotype-1">RY</div>
                <div class="ratio-square phenotype-1">RY</div>
                <div class="ratio-square phenotype-1">RY</div>
                <div class="ratio-square phenotype-2">Ry</div>
                <div class="ratio-square phenotype-2">Ry</div>
                <div class="ratio-square phenotype-2">Ry</div>
                <div class="ratio-square phenotype-3">rY</div>
                <div class="ratio-square phenotype-3">rY</div>
                <div class="ratio-square phenotype-3">rY</div>
                <div class="ratio-square phenotype-4">ry</div>
            </div>
            <div class="ratio-text">9 Round Yellow : 3 Round Green : 3 Wrinkled Yellow : 1 Wrinkled Green<br>
            Actual Mendel's results: 315:108:101:32</div>
        </div>

        <div class="gamete-display" id="gameteDisplay">
            <div class="gamete-title">Possible Gametes from Rr Yy</div>
            <div class="gamete-grid">
                <div class="gamete-cell">RY</div>
                <div class="gamete-cell">Ry</div>
                <div class="gamete-cell">rY</div>
                <div class="gamete-cell">ry</div>
            </div>
        </div>

        <div class="fun-fact">
            <div class="fun-fact-title">Independent Assortment Discovery!</div>
            <div class="fun-fact-text" id="funFact">
                Mendel's actual F2 results were 315:108:101:32, remarkably close to the predicted 9:3:3:1 ratio! This proved that genes for different traits are inherited independently.
            </div>
        </div>

        <div class="info-card">
            <div class="info-card-title">
                <span>üéØ</span> Learning Objectives
            </div>
            <div class="info-card-content" id="learningObjectives">
                Understand how two traits can be inherited independently, leading to new combinations in offspring and the mathematical 9:3:3:1 ratio that demonstrates independent assortment.
            </div>
        </div>
    </div>

    <!-- Voice Controls -->
    <div class="voice-controls">
        <button class="control-btn active" id="voiceToggle" onclick="toggleVoice()">
            üîä
            <span class="control-tooltip">Voice Narration</span>
        </button>
        <button class="control-btn" onclick="toggleAutoPlay()">
            ‚ñ∂Ô∏è
            <span class="control-tooltip">Auto Journey</span>
        </button>
        <button class="control-btn" onclick="toggleInfo()">
            ‚ÑπÔ∏è
            <span class="control-tooltip">Toggle Info</span>
        </button>
    </div>

    <!-- Quick Actions -->
    <div class="quick-actions">
        <button class="action-btn" onclick="startGuidedTour()">
            <span>üöÄ</span> Guided Tour
        </button>
        <button class="action-btn" onclick="showQuiz()">
            <span>üéØ</span> Test Knowledge
        </button>
    </div>

    <!-- Voice Indicator -->
    <div class="voice-indicator" id="voiceIndicator">
        <div class="voice-waves">
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
        </div>
        <div class="narration-text" id="narrationText">Narrating...</div>
    </div>

    <script>
        // Journey Step Data with Complete Pedagogical Content
        const JOURNEY_DATA = {
            seed_traits: {
                title: "Two-Trait Inheritance: Seed Shape & Color",
                subtitle: "Round/wrinkled and yellow/green combinations",
                icon: "üå∞",
                modelUrl: "https://sketchfab.com/models/782c72ae75934a6d8b437c81feee0855/embed",
                description: "Mendel's dihybrid crosses examined two traits simultaneously: seed shape (round vs wrinkled) and seed color (yellow vs green). The cross RR yy √ó rr YY produced F1 offspring (Rr Yy) that were all round and yellow, demonstrating dominance. The F2 generation showed a 9:3:3:1 ratio, revealing independent assortment.",
                concepts: [
                    "Two traits examined: shape (R/r) and color (Y/y)",
                    "P generation: RR yy √ó rr YY",
                    "F1 generation: All Rr Yy (round, yellow)",
                    "F2 shows 9:3:3:1 phenotypic ratio"
                ],
                funFact: "Mendel's actual F2 results were 315:108:101:32, remarkably close to the predicted 9:3:3:1 ratio! This proved that genes for different traits are inherited independently.",
                objectives: "Understand how two traits can be inherited independently, leading to new combinations in offspring and the mathematical 9:3:3:1 ratio that demonstrates independent assortment.",
                narration: "Welcome to Mendel's most complex experiments - dihybrid crosses! Here we see pea plants that Mendel used to study two traits at once: seed shape and seed color. Unlike his earlier monohybrid crosses that looked at just one trait, dihybrid crosses examine how two different traits are inherited together. Mendel chose seed shape - round versus wrinkled - and seed color - yellow versus green. When he crossed plants that were homozygous for round, green seeds (RR yy) with plants homozygous for wrinkled, yellow seeds (rr YY), something fascinating happened. All the F1 offspring had round, yellow seeds (Rr Yy), showing that round and yellow are dominant traits. But the real discovery came in the F2 generation. When F1 plants self-fertilized, the F2 offspring showed four different phenotypes in a very specific ratio: 9 round yellow, 3 round green, 3 wrinkled yellow, and 1 wrinkled green. This 9:3:3:1 ratio was revolutionary because it showed that the inheritance of seed shape was completely independent of seed color inheritance!"
            },
            flower_reproduction: {
                title: "Flower Reproduction in Dihybrid Crosses",
                subtitle: "How two traits combine during fertilization",
                icon: "üå∏",
                modelUrl: "https://sketchfab.com/models/4ce0afd091d742e286a0de156e183d95/embed?autostart=1&internal=1&tracking=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "In dihybrid crosses, flower reproduction becomes more complex as gametes must carry information for two traits. Each pollen grain and ovule contains one allele for each trait, creating four possible gamete types that combine randomly during fertilization.",
                concepts: [
                    "Each gamete carries one allele per trait",
                    "Four gamete types possible: RY, Ry, rY, ry",
                    "Random fertilization creates 16 combinations",
                    "Flower structure enables controlled crosses"
                ],
                funFact: "During dihybrid crosses, each flower can produce pollen with four different allele combinations, making the genetics much more complex than simple monohybrid crosses!",
                objectives: "Learn how flower reproduction facilitates the combination of two traits and understand why gamete formation is crucial for independent assortment.",
                narration: "Examine how flower reproduction enables Mendel's dihybrid crosses! In these more complex experiments, each pollen grain and each ovule must carry genetic information for two different traits simultaneously. When a plant with genotype Rr Yy produces gametes, the process becomes fascinating. Each gamete receives one allele for seed shape and one allele for seed color, but the combinations can vary. This single plant can produce four different types of gametes: RY (round, yellow alleles), Ry (round, green alleles), rY (wrinkled, yellow alleles), and ry (wrinkled, green alleles). During fertilization, any of these four pollen types can fertilize any of the four ovule types, creating 16 possible combinations. The flower's structure - with its anthers producing diverse pollen and its ovary containing varied ovules - makes this complex genetic shuffling possible. This random combination of gametes during fertilization is what creates the remarkable 9:3:3:1 ratio in the F2 generation!"
            },
            chromosome_behavior: {
                title: "Chromosome Behavior in Two-Trait Inheritance",
                subtitle: "Independent assortment at the chromosome level",
                icon: "üìä",
                modelUrl: "https://sketchfab.com/models/cc33bb1ebe6141b08d0d06f1bbebc2b7/embed?autostart=1&internal=1&tracking=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_watermark=0",
                description: "Independent assortment occurs because genes for different traits are located on different chromosomes or far apart on the same chromosome. During meiosis, chromosomes assort independently, creating the genetic diversity seen in dihybrid crosses.",
                concepts: [
                    "Genes on different chromosomes assort independently",
                    "Chromosome separation creates genetic diversity",
                    "Each trait behaves independently during meiosis",
                    "Physical basis of Mendel's laws"
                ],
                funFact: "If genes for seed shape and color were on the same chromosome very close together, Mendel would never have discovered independent assortment!",
                objectives: "Connect chromosome behavior during meiosis to the mathematical ratios observed in dihybrid crosses and understand the physical basis of independent assortment.",
                narration: "Discover the chromosomal basis of independent assortment! What Mendel observed mathematically, we can now explain through chromosome behavior. In dihybrid crosses, the genes for the two traits - let's say seed shape and seed color - are located on different chromosomes. During meiosis, when gametes are formed, homologous chromosomes separate independently of each other. This means that whether a particular gamete receives the R or r allele for seed shape has no influence on whether it receives the Y or y allele for seed color. Imagine if you have one pair of chromosomes carrying the R/r alleles and another pair carrying the Y/y alleles. During meiosis, these chromosome pairs orient themselves randomly at the cell's equator. The chromosome with R might go to the same gamete as the chromosome with Y, or it might go with the chromosome carrying y. All combinations are equally likely! This independent behavior of different chromosome pairs is what creates the four equally probable gamete types (RY, Ry, rY, ry) and ultimately produces the 9:3:3:1 ratio in the F2 generation."
            },
            meiosis_process: {
                title: "Meiosis in Dihybrid Inheritance",
                subtitle: "Cell division creating genetic diversity",
                icon: "üîÑ",
                modelUrl: "https://sketchfab.com/models/df93411c475c4e4eb450f71437b5ad0d/embed?autostart=1&internal=1&tracking=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_watermark=0",
                description: "Meiosis is the cellular process that creates the genetic diversity necessary for dihybrid inheritance patterns. Independent assortment occurs during metaphase I when chromosome pairs align randomly, and crossing over can create additional genetic combinations.",
                concepts: [
                    "Meiosis reduces chromosome number by half",
                    "Independent assortment occurs in metaphase I",
                    "Crossing over increases genetic diversity",
                    "Four genetically unique gametes produced"
                ],
                funFact: "In humans, independent assortment alone can create over 8 million different gamete types from just the random orientation of chromosomes during meiosis!",
                objectives: "Understand how meiosis creates the genetic diversity that makes dihybrid ratios possible and see how independent assortment works at the cellular level.",
                narration: "Watch meiosis in action - the cellular process that makes dihybrid inheritance possible! This animation shows how a single cell with two pairs of chromosomes divides to create four genetically unique gametes. The magic happens during metaphase I, when homologous chromosome pairs line up at the cell's center. Here's the crucial point: each pair orients itself independently of every other pair. For our dihybrid cross, imagine one pair carries the R and r alleles, while another pair carries Y and y alleles. During metaphase I, these pairs can align in two ways: R with Y on one side and r with y on the other, or R with y on one side and r with Y on the other. Both orientations are equally likely! This random orientation, combined with the separation that follows, ensures that each gamete receives one allele from each pair, but the combinations vary. The process also includes crossing over, where chromosome segments can be exchanged, creating even more genetic diversity. By the end of meiosis, one diploid cell has produced four haploid gametes, each genetically unique, providing the foundation for the complex inheritance patterns Mendel observed."
            },
            gamete_formation: {
                title: "Gamete Formation in Dihybrid Crosses",
                subtitle: "Creating all possible allele combinations",
                icon: "üî¨",
                modelUrl: "https://sketchfab.com/models/fff76f2ecadf4fe18eb40290938a5404/embed?autostart=1&internal=1&tracking=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "Gamete formation in dihybrid crosses produces four distinct types of reproductive cells, each carrying unique combinations of alleles. This process demonstrates how independent assortment creates the genetic diversity necessary for the 9:3:3:1 ratio.",
                concepts: [
                    "Rr Yy parent produces four gamete types",
                    "Equal probability: 25% each of RY, Ry, rY, ry",
                    "Random fertilization of diverse gametes",
                    "16 possible offspring combinations"
                ],
                funFact: "The beauty of dihybrid crosses is that they create new trait combinations never seen in the parent generation - like wrinkled yellow seeds from round green √ó wrinkled yellow parents!",
                objectives: "Master the concept of gamete formation in dihybrid crosses and understand how independent assortment creates new trait combinations in offspring.",
                narration: "Explore the final piece of the dihybrid puzzle - gamete formation! In this cellular view, we're witnessing how a heterozygous parent (Rr Yy) creates the four different types of gametes that make dihybrid ratios possible. Each gamete must receive exactly one allele for each trait, but independent assortment determines which alleles end up together. From an Rr Yy parent, we get four equally likely gamete types: RY gametes carry alleles for round seeds and yellow color, Ry gametes carry alleles for round seeds and green color, rY gametes carry alleles for wrinkled seeds and yellow color, and ry gametes carry alleles for wrinkled seeds and green color. Each type represents 25% of all gametes produced. When fertilization occurs, any of these four male gamete types can combine with any of the four female gamete types, creating 16 possible combinations. Nine of these combinations produce round, yellow offspring, three produce round, green, three produce wrinkled, yellow, and one produces wrinkled, green - giving us the famous 9:3:3:1 ratio! This process creates trait combinations that may never have existed in the parent generation, demonstrating how sexual reproduction generates biological diversity."
            }
        };

        // Global Variables
        let currentStep = 'seed_traits';
        let voiceEnabled = true;
        let autoPlayEnabled = false;
        let currentSpeech = null;
        let selectedVoice = null;
        let journeyProgress = 0;
        let guidedTourActive = false;

        // Initialize Voice System
        function initVoiceSystem() {
            if (!('speechSynthesis' in window)) {
                console.warn('Speech synthesis not supported');
                voiceEnabled = false;
                document.getElementById('voiceToggle').style.display = 'none';
                return;
            }

            function loadVoices() {
                const voices = speechSynthesis.getVoices();
                if (voices.length === 0) return;

                const preferredVoices = [
                    'Google UK English Female',
                    'Microsoft Sonia',
                    'Microsoft Hazel',
                    'Samantha',
                    'Victoria'
                ];

                for (const name of preferredVoices) {
                    selectedVoice = voices.find(v => v.name.includes(name));
                    if (selectedVoice) break;
                }

                if (!selectedVoice) {
                    selectedVoice = voices.find(v => v.lang.startsWith('en'));
                }
            }

            loadVoices();
            if (speechSynthesis.onvoiceschanged !== undefined) {
                speechSynthesis.onvoiceschanged = loadVoices;
            }
        }

        // Load Journey Step
        function loadJourneyStep(stepId) {
            const stepData = JOURNEY_DATA[stepId];
            if (!stepData) return;

            currentStep = stepId;
            
            // Update model
            document.getElementById('api-frame').src = stepData.modelUrl;
            
            // Update info panel
            document.getElementById('stepIcon').textContent = stepData.icon;
            document.getElementById('stepTitle').textContent = stepData.title;
            document.getElementById('stepSubtitle').textContent = stepData.subtitle;
            document.getElementById('mainDescription').textContent = stepData.description;
            
            // Update key concepts
            const conceptsList = document.getElementById('keyConcepts');
            conceptsList.innerHTML = stepData.concepts.map(c => `<li>${c}</li>`).join('');
            
            // Update fun fact
            document.getElementById('funFact').textContent = stepData.funFact;
            
            // Update learning objectives
            document.getElementById('learningObjectives').textContent = stepData.objectives;
            
            // Update displays based on step
            updateDisplays(stepId);
            
            // Update navigation buttons
            updateNavigationButtons(stepId);
            
            // Update progress
            updateProgress();
            
            // Play narration if enabled
            if (voiceEnabled) {
                speakText(stepData.narration);
            }
        }

        // Update Displays based on current step
        function updateDisplays(stepId) {
            const dihybridDiagram = document.getElementById('dihybridDiagram');
            const ratioDisplay = document.getElementById('ratioDisplay');
            const gameteDisplay = document.getElementById('gameteDisplay');
            
            // Show/hide relevant sections
            switch(stepId) {
                case 'seed_traits':
                    dihybridDiagram.style.display = 'block';
                    ratioDisplay.style.display = 'block';
                    gameteDisplay.style.display = 'none';
                    break;
                case 'flower_reproduction':
                    dihybridDiagram.style.display = 'none';
                    ratioDisplay.style.display = 'block';
                    gameteDisplay.style.display = 'block';
                    break;
                case 'chromosome_behavior':
                    dihybridDiagram.style.display = 'block';
                    ratioDisplay.style.display = 'none';
                    gameteDisplay.style.display = 'none';
                    break;
                case 'meiosis_process':
                    dihybridDiagram.style.display = 'none';
                    ratioDisplay.style.display = 'none';
                    gameteDisplay.style.display = 'block';
                    break;
                case 'gamete_formation':
                    dihybridDiagram.style.display = 'none';
                    ratioDisplay.style.display = 'block';
                    gameteDisplay.style.display = 'block';
                    break;
            }
        }

        // Update Navigation Buttons
        function updateNavigationButtons(activeStep) {
            const buttons = document.querySelectorAll('.journey-btn');
            const steps = ['seed_traits', 'flower_reproduction', 'chromosome_behavior', 'meiosis_process', 'gamete_formation'];
            const activeIndex = steps.indexOf(activeStep);
            
            buttons.forEach((btn, index) => {
                btn.classList.remove('active', 'completed');
                if (index < activeIndex) {
                    btn.classList.add('completed');
                } else if (index === activeIndex) {
                    btn.classList.add('active');
                }
            });
            
            // Update mini steps
            const miniSteps = document.querySelectorAll('.step-mini');
            miniSteps.forEach((step, index) => {
                step.classList.remove('active', 'completed');
                if (index < activeIndex) {
                    step.classList.add('completed');
                } else if (index === activeIndex) {
                    step.classList.add('active');
                }
            });
        }

        // Update Progress
        function updateProgress() {
            const steps = ['seed_traits', 'flower_reproduction', 'chromosome_behavior', 'meiosis_process', 'gamete_formation'];
            const currentIndex = steps.indexOf(currentStep);
            const progress = ((currentIndex + 1) / steps.length) * 100;
            
            document.getElementById('progressPercent').textContent = Math.round(progress) + '%';
            document.getElementById('progressFill').style.width = progress + '%';
        }

        // Speech Functions
        function speakText(text) {
            if (!voiceEnabled || !text) return;
            
            stopSpeech();
            
            currentSpeech = new SpeechSynthesisUtterance(text);
            if (selectedVoice) {
                currentSpeech.voice = selectedVoice;
            }
            currentSpeech.rate = 0.9;
            currentSpeech.pitch = 1.0;
            currentSpeech.volume = 0.9;
            
            currentSpeech.onstart = () => {
                document.getElementById('voiceIndicator').classList.add('visible');
                document.getElementById('narrationText').textContent = 
                    text.substring(0, 50) + (text.length > 50 ? '...' : '');
            };
            
            currentSpeech.onend = () => {
                document.getElementById('voiceIndicator').classList.remove('visible');
                currentSpeech = null;
                
                if (guidedTourActive) {
                    setTimeout(nextStep, 2000);
                }
            };
            
            speechSynthesis.speak(currentSpeech);
        }

        function stopSpeech() {
            if (currentSpeech) {
                speechSynthesis.cancel();
                currentSpeech = null;
                document.getElementById('voiceIndicator').classList.remove('visible');
            }
        }

        // Control Functions
        function toggleVoice() {
            voiceEnabled = !voiceEnabled;
            const btn = document.getElementById('voiceToggle');
            btn.textContent = voiceEnabled ? 'üîä' : 'üîá';
            btn.classList.toggle('active', voiceEnabled);
            
            if (!voiceEnabled) {
                stopSpeech();
            }
        }

        function toggleAutoPlay() {
            autoPlayEnabled = !autoPlayEnabled;
            if (autoPlayEnabled) {
                startGuidedTour();
            } else {
                guidedTourActive = false;
            }
        }

        function toggleInfo() {
            const panel = document.getElementById('infoPanel');
            panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
        }

        // Guided Tour
        function startGuidedTour() {
            guidedTourActive = true;
            const steps = ['seed_traits', 'flower_reproduction', 'chromosome_behavior', 'meiosis_process', 'gamete_formation'];
            let stepIndex = 0;
            
            function tourStep() {
                if (stepIndex < steps.length && guidedTourActive) {
                    loadJourneyStep(steps[stepIndex]);
                    stepIndex++;
                } else {
                    guidedTourActive = false;
                    if (voiceEnabled) {
                        speakText("Congratulations! You've mastered dihybrid crosses and independent assortment. You now understand how two traits can be inherited independently, creating new trait combinations and following the mathematical 9:3:3:1 ratio. This discovery was crucial for understanding that genes behave as discrete units and laid the foundation for modern genetics!");
                    }
                }
            }
            
            tourStep();
            window.nextStep = tourStep;
        }

        // Quiz Function
        function showQuiz() {
            const questions = [
                "What is the phenotypic ratio in a dihybrid F2 generation?",
                "How many different gamete types can an Rr Yy individual produce?",
                "What does independent assortment mean?",
                "Why did Mendel's actual results (315:108:101:32) support his hypothesis?",
                "How does chromosome behavior during meiosis explain independent assortment?"
            ];
            
            const randomQ = questions[Math.floor(Math.random() * questions.length)];
            
            if (voiceEnabled) {
                speakText(`Here's a question to test your knowledge: ${randomQ} Think about what you've learned about dihybrid crosses and independent assortment!`);
            }
        }

        // Initialize
        function init() {
            initVoiceSystem();
            
            // Hide loading screen
            setTimeout(() => {
                const loading = document.getElementById('loadingOverlay');
                loading.style.opacity = '0';
                setTimeout(() => {
                    loading.style.display = 'none';
                    
                    // Welcome message
                    if (voiceEnabled) {
                        speakText("Welcome to the world of dihybrid crosses! We're about to explore Mendel's most sophisticated experiments where he studied two traits simultaneously. You'll discover how seed shape and color are inherited together, learn about the famous 9:3:3:1 ratio, and understand the principle of independent assortment that revolutionized genetics!");
                    }
                }, 1000);
            }, 3000);
            
            // Keyboard shortcuts
            document.addEventListener('keydown', (e) => {
                switch(e.key) {
                    case 'v': toggleVoice(); break;
                    case 'i': toggleInfo(); break;
                    case 'g': startGuidedTour(); break;
                    case 'Escape': stopSpeech(); guidedTourActive = false; break;
                    case 'ArrowRight': nextStep && nextStep(); break;
                }
            });
        }

        // Start the application
        init();
    </script>
</body>
</html>