<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Variation & Heredity - The Story of Life's Diversity</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tween.js/18.6.4/tween.umd.js"></script>

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #2c3e50 0%, #3498db 50%, #9b59b6 100%);
            color: white;
            overflow: hidden;
            position: relative;
            height: 100vh;
        }

        /* Animated DNA Background */
        .bg-animation {
            position: fixed;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: 0;
            opacity: 0.1;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 320"><path fill="%23ffffff" fill-opacity="0.2" d="M0,160L48,144C96,128,192,96,288,90.7C384,85,480,107,576,128C672,149,768,171,864,165.3C960,160,1056,128,1152,117.3C1248,107,1344,117,1392,122.7L1440,128L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z"></path></svg>') repeat-x;
            animation: dnaWave 15s linear infinite;
        }

        @keyframes dnaWave {
            0% { background-position-x: 0; }
            100% { background-position-x: 1440px; }
        }

        /* Museum Interface - Compact Header */
        .museum-header {
            position: absolute;
            top: 10px;
            left: 20px;
            text-align: left;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            padding: 10px 18px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .museum-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 4px;
            background: linear-gradient(45deg, #9b59b6, #3498db, #2ecc71);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: titleGlow 3s ease-in-out infinite;
        }

        @keyframes titleGlow {
            0%, 100% { filter: brightness(1); }
            50% { filter: brightness(1.2); }
        }

        .exhibit-subtitle {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.8);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .dna-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            background: linear-gradient(45deg, #3498db, #9b59b6);
            border-radius: 50%;
            animation: dnaSpiral 2s ease-in-out infinite;
        }

        @keyframes dnaSpiral {
            0%, 100% { transform: scale(1) rotate(0deg); opacity: 1; }
            50% { transform: scale(1.3) rotate(180deg); opacity: 0.7; }
        }

        /* Journey Navigation - Enhanced */
        .journey-navigation {
            position: absolute;
            bottom: 20px;
            left: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            padding: 15px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            max-width: 320px;
        }

        .journey-title {
            font-size: 14px;
            font-weight: 600;
            color: #3498db;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .journey-steps {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }

        .journey-btn {
            background: rgba(52, 152, 219, 0.2);
            border: 1px solid rgba(52, 152, 219, 0.4);
            color: white;
            padding: 6px 10px;
            border-radius: 20px;
            font-size: 11px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 4px;
            white-space: nowrap;
        }

        .journey-btn:hover {
            background: rgba(52, 152, 219, 0.3);
            border-color: #3498db;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(52, 152, 219, 0.3);
        }

        .journey-btn.active {
            background: linear-gradient(135deg, #9b59b6, #8e44ad);
            border-color: #9b59b6;
            box-shadow: 0 0 20px rgba(155, 89, 182, 0.5);
            animation: pulse 2s infinite;
        }

        .journey-btn.completed {
            background: rgba(46, 204, 113, 0.3);
            border-color: #2ecc71;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        /* 3D Model Container */
        .model-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 0;
            overflow: hidden;
            border: none;
            z-index: 100;
        }

        .sketchfab-embed-wrapper {
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #2c3e50 0%, #3498db 50%, #9b59b6 100%);
        }

        .sketchfab-embed-wrapper iframe {
            width: 100%;
            height: 100%;
            border: none;
            border-radius: 0;
        }

        /* Information Panel - Enhanced */
        .info-panel {
            position: absolute;
            top: 70px;
            right: 20px;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(25px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 16px;
            padding: 24px;
            width: 380px;
            max-height: calc(100vh - 140px);
            z-index: 800;
            overflow-y: auto;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }

        .info-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        }

        .info-icon {
            font-size: 28px;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        .info-title {
            flex: 1;
        }

        .info-title h2 {
            font-size: 18px;
            color: #9b59b6;
            margin-bottom: 4px;
        }

        .info-subtitle {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.7);
        }

        .info-content {
            color: rgba(255, 255, 255, 0.9);
            font-size: 14px;
            line-height: 1.6;
        }

        /* Progress Tracker */
        .progress-tracker {
            background: linear-gradient(135deg, rgba(52, 152, 219, 0.1), rgba(155, 89, 182, 0.1));
            border: 1px solid rgba(52, 152, 219, 0.3);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 20px;
        }

        .progress-header {
            font-size: 13px;
            font-weight: 600;
            color: #3498db;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .progress-percentage {
            font-size: 18px;
            color: #9b59b6;
            font-weight: 700;
        }

        .progress-bar {
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 12px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #3498db, #9b59b6, #2ecc71);
            border-radius: 4px;
            transition: width 0.8s ease;
            box-shadow: 0 0 10px rgba(155, 89, 182, 0.5);
        }

        .progress-steps-mini {
            display: flex;
            justify-content: space-between;
            font-size: 10px;
            color: rgba(255, 255, 255, 0.6);
        }

        .step-mini {
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .step-mini.active {
            color: #9b59b6;
            font-weight: 600;
        }

        .step-mini.completed {
            color: #2ecc71;
        }

        /* Information Cards */
        .info-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 14px;
            margin-bottom: 14px;
        }

        .info-card-title {
            color: #3498db;
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .info-card-content {
            color: rgba(255, 255, 255, 0.85);
            font-size: 12px;
            line-height: 1.5;
        }

        .info-list {
            list-style: none;
            padding: 0;
        }

        .info-list li {
            padding: 6px 0;
            padding-left: 20px;
            position: relative;
            font-size: 12px;
            color: rgba(255, 255, 255, 0.8);
        }

        .info-list li:before {
            content: "→";
            position: absolute;
            left: 0;
            color: #9b59b6;
        }

        /* Fun Fact Box */
        .fun-fact {
            background: linear-gradient(135deg, rgba(46, 204, 113, 0.1), rgba(52, 152, 219, 0.1));
            border: 1px solid rgba(46, 204, 113, 0.3);
            border-radius: 12px;
            padding: 14px;
            margin: 16px 0;
            position: relative;
            overflow: hidden;
        }

        .fun-fact:before {
            content: "🧬";
            position: absolute;
            top: -20px;
            right: -20px;
            font-size: 60px;
            opacity: 0.1;
        }

        .fun-fact-title {
            color: #2ecc71;
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 6px;
        }

        .fun-fact-text {
            color: rgba(255, 255, 255, 0.9);
            font-size: 12px;
            line-height: 1.5;
            position: relative;
            z-index: 1;
        }

        /* Voice Controls */
        .voice-controls {
            position: absolute;
            top: 10px;
            right: 20px;
            display: flex;
            gap: 8px;
            z-index: 1000;
        }

        .control-btn {
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            width: 44px;
            height: 44px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            position: relative;
        }

        .control-btn:hover {
            background: rgba(155, 89, 182, 0.3);
            border-color: #9b59b6;
            transform: scale(1.1);
        }

        .control-btn.active {
            background: rgba(155, 89, 182, 0.4);
            border-color: #9b59b6;
            box-shadow: 0 0 20px rgba(155, 89, 182, 0.5);
        }

        .control-tooltip {
            position: absolute;
            bottom: -30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9);
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 10px;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .control-btn:hover .control-tooltip {
            opacity: 1;
        }

        /* Loading Screen */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #2c3e50 0%, #3498db 50%, #9b59b6 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            transition: opacity 1s ease;
        }

        .loading-content {
            text-align: center;
        }

        .loading-dna {
            font-size: 60px;
            animation: dnaSpiral 1.5s ease-in-out infinite;
            margin-bottom: 20px;
        }

        .loading-text {
            color: white;
            font-size: 20px;
            margin-bottom: 20px;
        }

        .loading-progress {
            width: 200px;
            height: 4px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 2px;
            overflow: hidden;
        }

        .loading-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #3498db, #9b59b6, #2ecc71);
            animation: loading 2s ease-in-out infinite;
        }

        @keyframes loading {
            0% { width: 0%; }
            50% { width: 100%; }
            100% { width: 0%; }
        }

        /* Voice Indicator */
        .voice-indicator {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(155, 89, 182, 0.5);
            border-radius: 30px;
            padding: 14px 28px;
            display: flex;
            align-items: center;
            gap: 12px;
            z-index: 1000;
            opacity: 0;
            transition: all 0.3s ease;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }

        .voice-indicator.visible {
            opacity: 1;
            transform: translateX(-50%) translateY(-10px);
        }

        .voice-waves {
            display: flex;
            align-items: center;
            gap: 3px;
        }

        .voice-wave {
            width: 3px;
            height: 20px;
            background: linear-gradient(180deg, #9b59b6, #3498db);
            border-radius: 2px;
            animation: voice-wave 1s ease-in-out infinite;
        }

        .voice-wave:nth-child(2) { animation-delay: 0.1s; }
        .voice-wave:nth-child(3) { animation-delay: 0.2s; }
        .voice-wave:nth-child(4) { animation-delay: 0.3s; }
        .voice-wave:nth-child(5) { animation-delay: 0.4s; }

        @keyframes voice-wave {
            0%, 100% { transform: scaleY(0.3); }
            50% { transform: scaleY(1); }
        }

        .narration-text {
            color: white;
            font-size: 13px;
            max-width: 300px;
        }

        /* Quick Actions */
        .quick-actions {
            position: absolute;
            bottom: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            z-index: 1000;
        }

        .action-btn {
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 10px 16px;
            border-radius: 25px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
        }

        .action-btn:hover {
            background: rgba(52, 152, 219, 0.3);
            border-color: #3498db;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(52, 152, 219, 0.3);
        }

        /* Custom Scrollbar */
        .info-panel::-webkit-scrollbar {
            width: 6px;
        }

        .info-panel::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 3px;
        }

        .info-panel::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, #9b59b6, #3498db);
            border-radius: 3px;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .info-panel {
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                top: auto;
                width: 100%;
                max-height: 50vh;
                border-radius: 20px 20px 0 0;
            }
            
            .journey-navigation {
                bottom: 52vh;
                max-width: calc(100% - 40px);
            }
            
            .voice-controls {
                top: auto;
                bottom: 55vh;
                right: 10px;
            }
            
            .quick-actions {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="bg-animation"></div>

    <!-- Loading Screen -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-content">
            <div class="loading-dna">🧬</div>
            <div class="loading-text">Preparing Your Heredity Journey...</div>
            <div class="loading-progress">
                <div class="loading-progress-bar"></div>
            </div>
        </div>
    </div>

    <!-- Museum Header -->
    <div class="museum-header">
        <div class="museum-title">Variation & Heredity</div>
        <div class="exhibit-subtitle">
            <span class="dna-indicator"></span>
            The Story of Life's Diversity
        </div>
    </div>

    <!-- Journey Navigation -->
    <div class="journey-navigation">
        <div class="journey-title">
            <span>🧬</span>
            <span>Your Heredity Journey</span>
        </div>
        <div class="journey-steps">
            <button class="journey-btn active" onclick="loadJourneyStep('dna')">
                <span>🧬</span> DNA Structure
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('bacterial')">
                <span>🦠</span> Bacterial Cell
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('human_cell')">
                <span>🔬</span> Human Cell
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('mitosis')">
                <span>🔄</span> Mitosis
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('sperm')">
                <span>🏊</span> Sperm Cell
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('egg')">
                <span>🥚</span> Egg Cell
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('chromosome')">
                <span>📊</span> Chromosomes
            </button>
        </div>
    </div>

    <!-- 3D Model Container -->
    <div class="model-container">
        <div class="sketchfab-embed-wrapper">
            <iframe id="api-frame"
                    title="DNA Double Helix Model" 
                    frameborder="0" 
                    allowfullscreen 
                    mozallowfullscreen="true" 
                    webkitallowfullscreen="true" 
                    allow="autoplay; fullscreen; xr-spatial-tracking"
                    xr-spatial-tracking 
                    execution-while-out-of-viewport 
                    execution-while-not-rendered 
                    web-share 
                    src="https://sketchfab.com/models/d01693952c5a4c9080e778c91080f93e/embed?autostart=1&internal=1&tracking=0&ui_ar=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0">
            </iframe>
        </div>
    </div>

    <!-- Information Panel -->
    <div class="info-panel" id="infoPanel">
        <div class="info-header">
            <div class="info-icon" id="stepIcon">🧬</div>
            <div class="info-title">
                <h2 id="stepTitle">DNA - The Blueprint of Life</h2>
                <div class="info-subtitle" id="stepSubtitle">Where variations begin</div>
            </div>
        </div>

        <!-- Progress Tracker -->
        <div class="progress-tracker">
            <div class="progress-header">
                <span>Journey Progress</span>
                <span class="progress-percentage" id="progressPercent">0%</span>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 0%"></div>
            </div>
            <div class="progress-steps-mini">
                <span class="step-mini active" onclick="loadJourneyStep('dna')">DNA</span>
                <span class="step-mini" onclick="loadJourneyStep('bacterial')">Bacterial</span>
                <span class="step-mini" onclick="loadJourneyStep('human_cell')">Human</span>
                <span class="step-mini" onclick="loadJourneyStep('mitosis')">Mitosis</span>
                <span class="step-mini" onclick="loadJourneyStep('sperm')">Sperm</span>
                <span class="step-mini" onclick="loadJourneyStep('egg')">Egg</span>
                <span class="step-mini" onclick="loadJourneyStep('chromosome')">Chromosome</span>
            </div>
        </div>

        <div class="info-content" id="mainDescription">
            DNA is the fundamental molecule of life that carries all genetic information. This double helix structure contains the instructions for building every protein in living organisms and determines all inherited traits. Understanding DNA is crucial to comprehending how variations arise during reproduction.
        </div>

        <div class="info-card">
            <div class="info-card-title">
                <span>🔬</span> Key Concepts
            </div>
            <div class="info-card-content">
                <ul class="info-list" id="keyConcepts">
                    <li>Double helix structure with complementary base pairs</li>
                    <li>Contains genetic information in sequence of bases</li>
                    <li>Found in nucleus of every cell</li>
                    <li>Basis for all hereditary variations</li>
                </ul>
            </div>
        </div>

        <div class="fun-fact">
            <div class="fun-fact-title">Amazing Fact!</div>
            <div class="fun-fact-text" id="funFact">
                If you unraveled all the DNA in your body and laid it end to end, it would stretch about 10 billion miles - enough to reach from Earth to Pluto and back!
            </div>
        </div>

        <div class="info-card">
            <div class="info-card-title">
                <span>🎯</span> Learning Objectives
            </div>
            <div class="info-card-content" id="learningObjectives">
                By exploring this section, you'll understand how DNA structure enables variation and inheritance, and why small changes in DNA can lead to significant differences in organisms.
            </div>
        </div>
    </div>

    <!-- Voice Controls -->
    <div class="voice-controls">
        <button class="control-btn active" id="voiceToggle" onclick="toggleVoice()">
            🔊
            <span class="control-tooltip">Voice Narration</span>
        </button>
        <button class="control-btn" onclick="toggleAutoPlay()">
            ▶️
            <span class="control-tooltip">Auto Journey</span>
        </button>
        <button class="control-btn" onclick="toggleInfo()">
            ℹ️
            <span class="control-tooltip">Toggle Info</span>
        </button>
    </div>

    <!-- Quick Actions -->
    <div class="quick-actions">
        <button class="action-btn" onclick="startGuidedTour()">
            <span>🚀</span> Guided Tour
        </button>
        <button class="action-btn" onclick="showQuiz()">
            <span>🎯</span> Test Knowledge
        </button>
    </div>

    <!-- Voice Indicator -->
    <div class="voice-indicator" id="voiceIndicator">
        <div class="voice-waves">
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
        </div>
        <div class="narration-text" id="narrationText">Narrating...</div>
    </div>

    <script>
        // Journey Step Data with Complete Pedagogical Content
        const JOURNEY_DATA = {
            dna: {
                title: "DNA - The Blueprint of Life",
                subtitle: "Where variations begin",
                icon: "🧬",
                modelUrl: "https://sketchfab.com/models/d01693952c5a4c9080e778c91080f93e/embed?autostart=1&internal=1&tracking=0&ui_ar=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "DNA is the fundamental molecule of life that carries all genetic information. This double helix structure contains the instructions for building every protein in living organisms and determines all inherited traits. Understanding DNA is crucial to comprehending how variations arise during reproduction.",
                concepts: [
                    "Double helix structure with complementary base pairs",
                    "Contains genetic information in sequence of bases",
                    "Found in nucleus of every cell",
                    "Basis for all hereditary variations"
                ],
                funFact: "If you unraveled all the DNA in your body and laid it end to end, it would stretch about 10 billion miles - enough to reach from Earth to Pluto and back!",
                objectives: "By exploring this section, you'll understand how DNA structure enables variation and inheritance, and why small changes in DNA can lead to significant differences in organisms.",
                narration: "Welcome to the molecular foundation of all life - DNA! You're looking at the famous double helix, discovered by Watson and Crick. This elegant twisted ladder structure holds the secret to heredity and variation. The sides of the ladder are made of sugar and phosphate molecules, while the rungs are made of four different bases: adenine, thymine, guanine, and cytosine. These bases pair specifically - A with T, and G with C. The sequence of these bases is like a genetic code that contains all the instructions needed to build and maintain a living organism. When this DNA is copied during reproduction, small changes or mutations can occur, creating the variations that make each individual unique!"
            },
            bacterial: {
                title: "Bacterial Cell - Simple Yet Diverse",
                subtitle: "Asexual reproduction and rapid variation",
                icon: "🦠",
                modelUrl: "https://sketchfab.com/models/42439edc90cd4d87b8ae322a4dcee8de/embed?autostart=1&internal=1&tracking=0&ui_ar=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "Bacterial cells demonstrate how variations can occur even in asexual reproduction. Although bacteria reproduce by simple division, mutations and horizontal gene transfer create remarkable diversity within bacterial populations.",
                concepts: [
                    "Single circular chromosome (no nucleus)",
                    "Reproduces through binary fission",
                    "Variations occur through mutations",
                    "Can exchange genetic material horizontally"
                ],
                funFact: "A single bacterium can produce over 16 million offspring in just 8 hours, with each generation potentially carrying new mutations!",
                objectives: "Learn how asexual reproduction in bacteria still creates variations and understand the mechanisms of rapid evolutionary change in simple organisms.",
                narration: "Here we see a bacterial cell - one of life's simplest yet most successful forms! Unlike human cells, bacteria don't have a nucleus. Their DNA floats freely in the cytoplasm as a single circular chromosome. When bacteria reproduce, they simply copy their DNA and split in two through a process called binary fission. You might think this would create identical copies, but that's not always the case! During DNA copying, occasional errors or mutations occur, creating variations in the offspring. Bacteria also have a unique trick - they can share genetic material directly with other bacteria through processes like conjugation, transformation, and transduction. This horizontal gene transfer allows favorable mutations to spread rapidly through bacterial populations, explaining how bacteria can quickly develop antibiotic resistance!"
            },
            human_cell: {
                title: "Human Cell - Complex Genetic Factory",
                subtitle: "The stage for sexual reproduction",
                icon: "🔬",
                modelUrl: "https://sketchfab.com/models/fff76f2ecadf4fe18eb40290938a5404/embed?autostart=1&internal=1&tracking=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_watermark=0",
                description: "Human cells are far more complex than bacterial cells, with DNA organized into chromosomes within a nucleus. This complexity allows for the sophisticated processes of sexual reproduction that greatly increase genetic variation.",
                concepts: [
                    "DNA organized into 46 chromosomes",
                    "Nucleus contains genetic material",
                    "Diploid cells have pairs of chromosomes",
                    "Mitochondria have their own DNA"
                ],
                funFact: "Each human cell contains about 3 billion base pairs of DNA, yet every cell (except gametes) contains identical genetic information!",
                objectives: "Compare the complexity of human cells to bacterial cells and understand how this complexity enables more sophisticated reproductive processes.",
                narration: "Step inside a human cell - a marvel of biological engineering! Unlike the simple bacterial cell, human cells are eukaryotic, meaning they have a membrane-bound nucleus that houses the DNA. Look at that large central nucleus - it contains 46 chromosomes arranged in 23 pairs. This diploid arrangement is crucial for sexual reproduction. Notice the other organelles: mitochondria that produce energy, ribosomes that make proteins, and the endoplasmic reticulum that processes materials. The mitochondria are particularly interesting because they have their own DNA, inherited only from the mother. This cellular complexity allows for the intricate processes of meiosis and fertilization that create enormous genetic diversity in sexually reproducing organisms like humans. Every cell in your body (except sperm and egg cells) contains this complete set of genetic instructions!"
            },
            mitosis: {
                title: "Mitosis - Identical Cell Division",
                subtitle: "How growth occurs without variation",
                icon: "🔄",
                modelUrl: "https://sketchfab.com/models/df93411c475c4e4eb450f71437b5ad0d/embed?autostart=1&internal=1&tracking=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_watermark=0",
                description: "Mitosis is the process by which somatic cells divide to produce two identical daughter cells. This process maintains the chromosome number and ensures that growth and repair occur without introducing genetic variations.",
                concepts: [
                    "Produces two genetically identical cells",
                    "Maintains diploid chromosome number (46)",
                    "Used for growth and repair",
                    "Involves precise chromosome separation"
                ],
                funFact: "Your body performs about 25 million mitotic divisions every second to replace old and damaged cells!",
                objectives: "Understand how mitosis ensures genetic consistency during growth and repair, and contrast this with the variation-producing process of meiosis.",
                narration: "Watch the incredible choreography of mitosis - the process that allows multicellular organisms to grow while maintaining genetic consistency! This animation shows the precise steps: first, the chromosomes condense and become visible. Each chromosome has already been duplicated, forming sister chromatids joined at the centromere. During metaphase, the chromosomes line up at the cell's equator, and spindle fibers attach to each chromatid. Then comes the crucial moment - anaphase - where sister chromatids separate and move to opposite poles of the cell. Finally, the cell divides, creating two daughter cells with identical genetic material. This process is essential for growth - every time you grow taller or heal a cut, mitosis is at work! Unlike meiosis, mitosis preserves the exact genetic makeup, ensuring that all your body cells contain the same DNA instructions."
            },
            sperm: {
                title: "Sperm Cell - The Mobile Gamete",
                subtitle: "Specialized for genetic delivery",
                icon: "🏊",
                modelUrl: "https://sketchfab.com/models/267dc672834749b5b332d23ee013a00a/embed?autostart=1&internal=1&tracking=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_watermark=0",
                description: "Sperm cells are highly specialized male gametes designed for one purpose: delivering genetic material to the egg. Each sperm carries exactly half the genetic information needed for a new organism.",
                concepts: [
                    "Haploid cell with 23 chromosomes",
                    "Streamlined for swimming to egg",
                    "Carries paternal genetic contribution",
                    "Produced continuously after puberty"
                ],
                funFact: "A single human male produces about 300 million sperm per day, and each one is genetically unique due to crossing over during meiosis!",
                objectives: "Understand how sperm structure relates to function and appreciate how meiosis creates genetic diversity in gametes.",
                narration: "Meet the sperm cell - evolution's solution for mobile genetic delivery! This remarkable cell is perfectly adapted for its mission. The large head contains the nucleus with 23 chromosomes - exactly half the genetic material needed for a new human. The head is covered by the acrosome, which contains enzymes that will help penetrate the egg's protective layers. The long tail, or flagellum, propels the sperm forward with a whip-like motion. The mitochondria in the midpiece provide the energy for this journey. What's truly amazing is that every sperm is genetically unique! During meiosis, the process that creates sperm, crossing over occurs between maternal and paternal chromosomes, shuffling genetic material. This means that each sperm carries a unique combination of genes, contributing to the incredible diversity possible in sexual reproduction."
            },
            egg: {
                title: "Egg Cell - The Genetic Sanctuary",
                subtitle: "Prepared for fertilization",
                icon: "🥚",
                modelUrl: "https://sketchfab.com/models/21c19e1b34dd4e4d9cfefa5c8163e8c6/embed?autostart=1&internal=1&tracking=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_watermark=0",
                description: "The egg cell is the largest cell in the human body, equipped with everything needed to support early development. Like sperm, it carries exactly half the genetic information, but it also provides the initial environment for the developing embryo.",
                concepts: [
                    "Haploid cell with 23 chromosomes",
                    "Largest human cell (visible to naked eye)",
                    "Contains nutrients and organelles",
                    "Surrounded by protective layers"
                ],
                funFact: "A human egg cell is about 10,000 times larger than a sperm cell and contains enough nutrients to support the first week of embryonic development!",
                objectives: "Compare the structure and function of egg cells to sperm cells and understand their complementary roles in sexual reproduction.",
                narration: "Behold the egg cell - the magnificent maternal gamete! This is the largest cell in the human body, about the size of a period at the end of a sentence, making it visible to the naked eye. The egg's impressive size isn't just for show - it's packed with everything needed to kickstart new life. The large nucleus contains 23 chromosomes, contributing the maternal genetic material. The abundant cytoplasm is filled with nutrients, proteins, and organelles, especially mitochondria that will power early development. Notice the protective layers surrounding the egg - the zona pellucida and corona radiata. These serve as quality control, ensuring only the fittest sperm can penetrate. Like sperm, each egg is genetically unique due to crossing over during meiosis. When sperm and egg unite, their combined 46 chromosomes create a genetically distinct individual, demonstrating the power of sexual reproduction to generate endless variation!"
            },
            chromosome: {
                title: "Chromosome Structure - Organized Genetics",
                subtitle: "How genes are packaged",
                icon: "📊",
                modelUrl: "https://sketchfab.com/models/cc33bb1ebe6141b08d0d06f1bbebc2b7/embed?autostart=1&internal=1&tracking=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_watermark=0",
                description: "Chromosomes are highly organized structures that package DNA efficiently while allowing access for replication and gene expression. Understanding chromosome structure helps explain how genetic information is inherited and how variations arise.",
                concepts: [
                    "DNA wrapped around histone proteins",
                    "23 pairs in human somatic cells",
                    "Homologous pairs carry same genes",
                    "Sex chromosomes determine gender"
                ],
                funFact: "If DNA is like a library, then chromosomes are like books, genes are like chapters, and individual bases are like letters - all perfectly organized for easy access!",
                objectives: "Understand how DNA is organized into chromosomes and how this organization facilitates inheritance and variation.",
                narration: "Explore the elegant architecture of a chromosome - nature's solution to organizing massive amounts of genetic information! You're seeing how DNA is packaged at multiple levels. First, the DNA double helix wraps around protein spools called histones, forming nucleosomes that look like beads on a string. This structure then coils and folds repeatedly until it forms the familiar X-shaped chromosome you see during cell division. Humans have 23 pairs of chromosomes - 22 pairs of autosomes and one pair of sex chromosomes. Each pair consists of homologous chromosomes - one from mom, one from dad - carrying the same genes but potentially different versions (alleles). This is where variation becomes visible! During meiosis, these homologous chromosomes can exchange segments through crossing over, creating new combinations of alleles. The sex chromosomes - XX for females, XY for males - not only determine gender but also demonstrate how chromosome differences create biological variation."
            }
        };

        // Global Variables
        let currentStep = 'dna';
        let voiceEnabled = true;
        let autoPlayEnabled = false;
        let currentSpeech = null;
        let selectedVoice = null;
        let journeyProgress = 0;
        let guidedTourActive = false;

        // Initialize Voice System
        function initVoiceSystem() {
            if (!('speechSynthesis' in window)) {
                console.warn('Speech synthesis not supported');
                voiceEnabled = false;
                document.getElementById('voiceToggle').style.display = 'none';
                return;
            }

            function loadVoices() {
                const voices = speechSynthesis.getVoices();
                if (voices.length === 0) return;

                // Prefer natural-sounding voices
                const preferredVoices = [
                    'Google UK English Female',
                    'Microsoft Sonia',
                    'Microsoft Hazel',
                    'Samantha',
                    'Victoria'
                ];

                for (const name of preferredVoices) {
                    selectedVoice = voices.find(v => v.name.includes(name));
                    if (selectedVoice) break;
                }

                if (!selectedVoice) {
                    selectedVoice = voices.find(v => v.lang.startsWith('en'));
                }
            }

            loadVoices();
            if (speechSynthesis.onvoiceschanged !== undefined) {
                speechSynthesis.onvoiceschanged = loadVoices;
            }
        }

        // Load Journey Step
        function loadJourneyStep(stepId) {
            const stepData = JOURNEY_DATA[stepId];
            if (!stepData) return;

            currentStep = stepId;
            
            // Update model
            document.getElementById('api-frame').src = stepData.modelUrl;
            
            // Update info panel
            document.getElementById('stepIcon').textContent = stepData.icon;
            document.getElementById('stepTitle').textContent = stepData.title;
            document.getElementById('stepSubtitle').textContent = stepData.subtitle;
            document.getElementById('mainDescription').textContent = stepData.description;
            
            // Update key concepts
            const conceptsList = document.getElementById('keyConcepts');
            conceptsList.innerHTML = stepData.concepts.map(c => `<li>${c}</li>`).join('');
            
            // Update fun fact
            document.getElementById('funFact').textContent = stepData.funFact;
            
            // Update learning objectives
            document.getElementById('learningObjectives').textContent = stepData.objectives;
            
            // Update navigation buttons
            updateNavigationButtons(stepId);
            
            // Update progress
            updateProgress();
            
            // Play narration if enabled
            if (voiceEnabled) {
                speakText(stepData.narration);
            }
        }

        // Update Navigation Buttons
        function updateNavigationButtons(activeStep) {
            const buttons = document.querySelectorAll('.journey-btn');
            const steps = ['dna', 'bacterial', 'human_cell', 'mitosis', 'sperm', 'egg', 'chromosome'];
            const activeIndex = steps.indexOf(activeStep);
            
            buttons.forEach((btn, index) => {
                btn.classList.remove('active', 'completed');
                if (index < activeIndex) {
                    btn.classList.add('completed');
                } else if (index === activeIndex) {
                    btn.classList.add('active');
                }
            });
            
            // Update mini steps
            const miniSteps = document.querySelectorAll('.step-mini');
            miniSteps.forEach((step, index) => {
                step.classList.remove('active', 'completed');
                if (index < activeIndex) {
                    step.classList.add('completed');
                } else if (index === activeIndex) {
                    step.classList.add('active');
                }
            });
        }

        // Update Progress
        function updateProgress() {
            const steps = ['dna', 'bacterial', 'human_cell', 'mitosis', 'sperm', 'egg', 'chromosome'];
            const currentIndex = steps.indexOf(currentStep);
            const progress = ((currentIndex + 1) / steps.length) * 100;
            
            document.getElementById('progressPercent').textContent = Math.round(progress) + '%';
            document.getElementById('progressFill').style.width = progress + '%';
        }

        // Speech Functions
        function speakText(text) {
            if (!voiceEnabled || !text) return;
            
            stopSpeech();
            
            currentSpeech = new SpeechSynthesisUtterance(text);
            if (selectedVoice) {
                currentSpeech.voice = selectedVoice;
            }
            currentSpeech.rate = 0.9;
            currentSpeech.pitch = 1.0;
            currentSpeech.volume = 0.9;
            
            currentSpeech.onstart = () => {
                document.getElementById('voiceIndicator').classList.add('visible');
                document.getElementById('narrationText').textContent = 
                    text.substring(0, 50) + (text.length > 50 ? '...' : '');
            };
            
            currentSpeech.onend = () => {
                document.getElementById('voiceIndicator').classList.remove('visible');
                currentSpeech = null;
                
                // Auto-advance if guided tour is active
                if (guidedTourActive) {
                    setTimeout(nextStep, 2000);
                }
            };
            
            speechSynthesis.speak(currentSpeech);
        }

        function stopSpeech() {
            if (currentSpeech) {
                speechSynthesis.cancel();
                currentSpeech = null;
                document.getElementById('voiceIndicator').classList.remove('visible');
            }
        }

        // Control Functions
        function toggleVoice() {
            voiceEnabled = !voiceEnabled;
            const btn = document.getElementById('voiceToggle');
            btn.textContent = voiceEnabled ? '🔊' : '🔇';
            btn.classList.toggle('active', voiceEnabled);
            
            if (!voiceEnabled) {
                stopSpeech();
            }
        }

        function toggleAutoPlay() {
            autoPlayEnabled = !autoPlayEnabled;
            if (autoPlayEnabled) {
                startGuidedTour();
            } else {
                guidedTourActive = false;
            }
        }

        function toggleInfo() {
            const panel = document.getElementById('infoPanel');
            panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
        }

        // Guided Tour
        function startGuidedTour() {
            guidedTourActive = true;
            const steps = ['dna', 'bacterial', 'human_cell', 'mitosis', 'sperm', 'egg', 'chromosome'];
            let stepIndex = 0;
            
            function tourStep() {
                if (stepIndex < steps.length && guidedTourActive) {
                    loadJourneyStep(steps[stepIndex]);
                    stepIndex++;
                } else {
                    guidedTourActive = false;
                    if (voiceEnabled) {
                        speakText("Congratulations! You've completed your journey through variation and heredity. You now understand how DNA creates the foundation for all biological diversity. Feel free to explore any section again or test your knowledge!");
                    }
                }
            }
            
            tourStep();
            window.nextStep = tourStep;
        }

        // Quiz Function
        function showQuiz() {
            const questions = [
                "What determines the genetic information in living organisms?",
                "How do bacterial cells create variations despite asexual reproduction?",
                "What's the difference between mitosis and meiosis?",
                "Why are sperm and egg cells genetically unique?",
                "How are chromosomes organized to store genetic information?"
            ];
            
            const randomQ = questions[Math.floor(Math.random() * questions.length)];
            
            if (voiceEnabled) {
                speakText(`Here's a question to test your knowledge: ${randomQ} Think about what you've learned about heredity and variation!`);
            }
        }

        // Initialize
        function init() {
            initVoiceSystem();
            
            // Hide loading screen
            setTimeout(() => {
                const loading = document.getElementById('loadingOverlay');
                loading.style.opacity = '0';
                setTimeout(() => {
                    loading.style.display = 'none';
                    
                    // Welcome message
                    if (voiceEnabled) {
                        speakText("Welcome to your journey through variation and heredity! We'll explore how life creates endless diversity, starting with the fundamental blueprint of all living things - DNA. Let's discover how this elegant molecule holds the secret to inheritance and variation!");
                    }
                }, 1000);
            }, 3000);
            
            // Keyboard shortcuts
            document.addEventListener('keydown', (e) => {
                switch(e.key) {
                    case 'v': toggleVoice(); break;
                    case 'i': toggleInfo(); break;
                    case 'g': startGuidedTour(); break;
                    case 'Escape': stopSpeech(); guidedTourActive = false; break;
                    case 'ArrowRight': nextStep && nextStep(); break;
                }
            });
        }

        // Start the application
        init();
    </script>
</body>
</html>