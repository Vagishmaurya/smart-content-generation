<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Respiratory Pathways - Metabolic Journey</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tween.js/18.6.4/tween.umd.js"></script>

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #9b59b6 0%, #e67e22 100%);
            color: white;
            overflow: hidden;
            position: relative;
            height: 100vh;
        }

        /* Animated Background */
        .bg-animation {
            position: fixed;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: 0;
            opacity: 0.1;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 320"><path fill="%23ffffff" fill-opacity="0.2" d="M0,96L48,112C96,128,192,160,288,186.7C384,213,480,235,576,213.3C672,192,768,128,864,128C960,128,1056,192,1152,197.3C1248,203,1344,149,1392,122.7L1440,96L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z"></path></svg>') repeat-x;
            animation: wave 10s linear infinite;
        }

        @keyframes wave {
            0% { background-position-x: 0; }
            100% { background-position-x: 1440px; }
        }

        /* Museum Interface - Compact Header */
        .museum-header {
            position: absolute;
            top: 10px;
            left: 20px;
            text-align: left;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            padding: 10px 18px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .museum-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 4px;
            background: linear-gradient(45deg, #9b59b6, #e67e22);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: titleGlow 3s ease-in-out infinite;
        }

        @keyframes titleGlow {
            0%, 100% { filter: brightness(1); }
            50% { filter: brightness(1.2); }
        }

        .exhibit-subtitle {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.8);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .pathway-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            background: #9b59b6;
            border-radius: 50%;
            animation: pathway-pulse 1.5s ease-in-out infinite;
        }

        @keyframes pathway-pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.3); opacity: 0.7; }
        }

        /* Journey Navigation - Enhanced */
        .journey-navigation {
            position: absolute;
            bottom: 20px;
            left: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            padding: 15px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            max-width: 320px;
        }

        .journey-title {
            font-size: 14px;
            font-weight: 600;
            color: #9b59b6;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .journey-steps {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }

        .journey-btn {
            background: rgba(155, 89, 182, 0.2);
            border: 1px solid rgba(155, 89, 182, 0.4);
            color: white;
            padding: 6px 10px;
            border-radius: 20px;
            font-size: 11px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 4px;
            white-space: nowrap;
        }

        .journey-btn:hover {
            background: rgba(155, 89, 182, 0.3);
            border-color: #9b59b6;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(155, 89, 182, 0.3);
        }

        .journey-btn.active {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            border-color: #e74c3c;
            box-shadow: 0 0 20px rgba(231, 76, 60, 0.5);
            animation: pulse 2s infinite;
        }

        .journey-btn.completed {
            background: rgba(52, 152, 219, 0.3);
            border-color: #3498db;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        /* 3D Model Container */
        .model-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 0;
            overflow: hidden;
            border: none;
            z-index: 100;
        }

        .sketchfab-embed-wrapper {
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #9b59b6 0%, #e67e22 100%);
        }

        .sketchfab-embed-wrapper iframe {
            width: 100%;
            height: 100%;
            border: none;
            border-radius: 0;
        }

        /* Information Panel - Enhanced */
        .info-panel {
            position: absolute;
            top: 70px;
            right: 20px;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(25px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 16px;
            padding: 24px;
            width: 380px;
            max-height: calc(100vh - 140px);
            z-index: 800;
            overflow-y: auto;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }

        .info-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        }

        .info-icon {
            font-size: 28px;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        .info-title {
            flex: 1;
        }

        .info-title h2 {
            font-size: 18px;
            color: #9b59b6;
            margin-bottom: 4px;
        }

        .info-subtitle {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.7);
        }

        .info-content {
            color: rgba(255, 255, 255, 0.9);
            font-size: 14px;
            line-height: 1.6;
        }

        /* Progress Tracker */
        .progress-tracker {
            background: linear-gradient(135deg, rgba(155, 89, 182, 0.1), rgba(230, 126, 34, 0.1));
            border: 1px solid rgba(155, 89, 182, 0.3);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 20px;
        }

        .progress-header {
            font-size: 13px;
            font-weight: 600;
            color: #9b59b6;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .progress-percentage {
            font-size: 18px;
            color: #e74c3c;
            font-weight: 700;
        }

        .progress-bar {
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 12px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #9b59b6, #e67e22);
            border-radius: 4px;
            transition: width 0.8s ease;
            box-shadow: 0 0 10px rgba(155, 89, 182, 0.5);
        }

        .progress-steps-mini {
            display: flex;
            justify-content: space-between;
            font-size: 10px;
            color: rgba(255, 255, 255, 0.6);
        }

        .step-mini {
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .step-mini.active {
            color: #e74c3c;
            font-weight: 600;
        }

        .step-mini.completed {
            color: #3498db;
        }

        /* Information Cards */
        .info-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 14px;
            margin-bottom: 14px;
        }

        .info-card-title {
            color: #9b59b6;
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .info-card-content {
            color: rgba(255, 255, 255, 0.85);
            font-size: 12px;
            line-height: 1.5;
        }

        .info-list {
            list-style: none;
            padding: 0;
        }

        .info-list li {
            padding: 6px 0;
            padding-left: 20px;
            position: relative;
            font-size: 12px;
            color: rgba(255, 255, 255, 0.8);
        }

        .info-list li:before {
            content: "→";
            position: absolute;
            left: 0;
            color: #9b59b6;
        }

        /* Fun Fact Box */
        .fun-fact {
            background: linear-gradient(135deg, rgba(230, 126, 34, 0.1), rgba(155, 89, 182, 0.1));
            border: 1px solid rgba(230, 126, 34, 0.3);
            border-radius: 12px;
            padding: 14px;
            margin: 16px 0;
            position: relative;
            overflow: hidden;
        }

        .fun-fact:before {
            content: "🔄";
            position: absolute;
            top: -20px;
            right: -20px;
            font-size: 60px;
            opacity: 0.1;
        }

        .fun-fact-title {
            color: #e67e22;
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 6px;
        }

        .fun-fact-text {
            color: rgba(255, 255, 255, 0.9);
            font-size: 12px;
            line-height: 1.5;
            position: relative;
            z-index: 1;
        }

        /* Voice Controls */
        .voice-controls {
            position: absolute;
            top: 10px;
            right: 20px;
            display: flex;
            gap: 8px;
            z-index: 1000;
        }

        .control-btn {
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            width: 44px;
            height: 44px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            position: relative;
        }

        .control-btn:hover {
            background: rgba(155, 89, 182, 0.3);
            border-color: #9b59b6;
            transform: scale(1.1);
        }

        .control-btn.active {
            background: rgba(155, 89, 182, 0.4);
            border-color: #9b59b6;
            box-shadow: 0 0 20px rgba(155, 89, 182, 0.5);
        }

        .control-tooltip {
            position: absolute;
            bottom: -30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9);
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 10px;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .control-btn:hover .control-tooltip {
            opacity: 1;
        }

        /* Loading Screen */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #9b59b6 0%, #e67e22 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            transition: opacity 1s ease;
        }

        .loading-content {
            text-align: center;
        }

        .loading-pathway {
            font-size: 60px;
            animation: pathway-cycle 3s ease-in-out infinite;
            margin-bottom: 20px;
        }

        @keyframes pathway-cycle {
            0%, 100% { transform: rotate(0deg) scale(1); }
            33% { transform: rotate(120deg) scale(1.1); }
            66% { transform: rotate(240deg) scale(0.9); }
        }

        .loading-text {
            color: white;
            font-size: 20px;
            margin-bottom: 20px;
        }

        .loading-progress {
            width: 200px;
            height: 4px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 2px;
            overflow: hidden;
        }

        .loading-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #9b59b6, #e67e22);
            animation: loading 2s ease-in-out infinite;
        }

        @keyframes loading {
            0% { width: 0%; }
            50% { width: 100%; }
            100% { width: 0%; }
        }

        /* Voice Indicator */
        .voice-indicator {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(155, 89, 182, 0.5);
            border-radius: 30px;
            padding: 14px 28px;
            display: flex;
            align-items: center;
            gap: 12px;
            z-index: 1000;
            opacity: 0;
            transition: all 0.3s ease;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }

        .voice-indicator.visible {
            opacity: 1;
            transform: translateX(-50%) translateY(-10px);
        }

        .voice-waves {
            display: flex;
            align-items: center;
            gap: 3px;
        }

        .voice-wave {
            width: 3px;
            height: 20px;
            background: linear-gradient(180deg, #9b59b6, #e67e22);
            border-radius: 2px;
            animation: voice-wave 1s ease-in-out infinite;
        }

        .voice-wave:nth-child(2) { animation-delay: 0.1s; }
        .voice-wave:nth-child(3) { animation-delay: 0.2s; }
        .voice-wave:nth-child(4) { animation-delay: 0.3s; }
        .voice-wave:nth-child(5) { animation-delay: 0.4s; }

        @keyframes voice-wave {
            0%, 100% { transform: scaleY(0.3); }
            50% { transform: scaleY(1); }
        }

        .narration-text {
            color: white;
            font-size: 13px;
            max-width: 300px;
        }

        /* Quick Actions */
        .quick-actions {
            position: absolute;
            bottom: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            z-index: 1000;
        }

        .action-btn {
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 10px 16px;
            border-radius: 25px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
        }

        .action-btn:hover {
            background: rgba(155, 89, 182, 0.3);
            border-color: #9b59b6;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(155, 89, 182, 0.3);
        }

        /* Custom Scrollbar */
        .info-panel::-webkit-scrollbar {
            width: 6px;
        }

        .info-panel::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 3px;
        }

        .info-panel::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, #9b59b6, #e67e22);
            border-radius: 3px;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .info-panel {
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                top: auto;
                width: 100%;
                max-height: 50vh;
                border-radius: 20px 20px 0 0;
            }
            
            .journey-navigation {
                bottom: 52vh;
                max-width: calc(100% - 40px);
            }
            
            .voice-controls {
                top: auto;
                bottom: 55vh;
                right: 10px;
            }
            
            .quick-actions {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="bg-animation"></div>

    <!-- Loading Screen -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-content">
            <div class="loading-pathway">🔄</div>
            <div class="loading-text">Exploring Metabolic Pathways...</div>
            <div class="loading-progress">
                <div class="loading-progress-bar"></div>
            </div>
        </div>
    </div>

    <!-- Museum Header -->
    <div class="museum-header">
        <div class="museum-title">Respiratory Pathways</div>
        <div class="exhibit-subtitle">
            <span class="pathway-indicator"></span>
            Different Routes to Energy
        </div>
    </div>

    <!-- Journey Navigation -->
    <div class="journey-navigation">
        <div class="journey-title">
            <span>🔄</span>
            <span>Metabolic Routes</span>
        </div>
        <div class="journey-steps">
            <button class="journey-btn active" onclick="loadJourneyStep('introduction')">
                <span>🌟</span> Overview
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('glucose_breakdown')">
                <span>🍯</span> Glucose
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('pyruvate_formation')">
                <span>⚗️</span> Pyruvate
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('energy_comparison')">
                <span>📊</span> Energy Yield
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('muscle_fatigue')">
                <span>💪</span> Muscle Fatigue
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('lactic_acid')">
                <span>🧪</span> Lactic Acid
            </button>
        </div>
    </div>

    <!-- 3D Model Container -->
    <div class="model-container">
        <div class="sketchfab-embed-wrapper">
            <iframe id="api-frame"
                    title="Respiratory Pathways Model" 
                    frameborder="0" 
                    allowfullscreen 
                    mozallowfullscreen="true" 
                    webkitallowfullscreen="true" 
                    allow="autoplay; fullscreen; xr-spatial-tracking"
                    xr-spatial-tracking 
                    execution-while-out-of-viewport 
                    execution-while-not-rendered 
                    web-share 
                    src="https://sketchfab.com/models/10659ca1502c4ade88abba6284bb50f2/embed?autostart=1&internal=1&tracking=0&ui_ar=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0">
            </iframe>
        </div>
    </div>

    <!-- Information Panel -->
    <div class="info-panel" id="infoPanel">
        <div class="info-header">
            <div class="info-icon" id="stepIcon">🌟</div>
            <div class="info-title">
                <h2 id="stepTitle">Respiratory Pathways Overview</h2>
                <div class="info-subtitle" id="stepSubtitle">Different routes for glucose breakdown</div>
            </div>
        </div>

        <!-- Progress Tracker -->
        <div class="progress-tracker">
            <div class="progress-header">
                <span>Pathway Progress</span>
                <span class="progress-percentage" id="progressPercent">0%</span>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 0%"></div>
            </div>
            <div class="progress-steps-mini">
                <span class="step-mini active" onclick="loadJourneyStep('introduction')">Intro</span>
                <span class="step-mini" onclick="loadJourneyStep('glucose_breakdown')">Glucose</span>
                <span class="step-mini" onclick="loadJourneyStep('pyruvate_formation')">Pyruvate</span>
                <span class="step-mini" onclick="loadJourneyStep('energy_comparison')">Energy</span>
                <span class="step-mini" onclick="loadJourneyStep('muscle_fatigue')">Fatigue</span>
                <span class="step-mini" onclick="loadJourneyStep('lactic_acid')">Lactate</span>
            </div>
        </div>

        <div class="info-content" id="mainDescription">
            Respiratory pathways are the different routes cells use to break down glucose and extract energy. These pathways determine how efficiently energy is produced and what waste products are formed, with important implications for muscle function and exercise performance.
        </div>

        <div class="info-card">
            <div class="info-card-title">
                <span>🔬</span> Key Pathways
            </div>
            <div class="info-card-content">
                <ul class="info-list" id="keyConcepts">
                    <li>Glycolysis breaks glucose into pyruvate</li>
                    <li>Aerobic pathway produces maximum ATP</li>
                    <li>Anaerobic pathway produces lactic acid</li>
                    <li>Pathway choice depends on oxygen availability</li>
                </ul>
            </div>
        </div>

        <div class="fun-fact">
            <div class="fun-fact-title">Pathway Fact!</div>
            <div class="fun-fact-text" id="funFact">
                Your muscles can switch between aerobic and anaerobic pathways in seconds, adapting to changing energy demands during exercise!
            </div>
        </div>

        <div class="info-card">
            <div class="info-card-title">
                <span>🎯</span> Learning Objectives
            </div>
            <div class="info-card-content" id="learningObjectives">
                Understand how glucose is broken down through different pathways, compare energy yields, and learn why muscle fatigue occurs during intense exercise.
            </div>
        </div>
    </div>

    <!-- Voice Controls -->
    <div class="voice-controls">
        <button class="control-btn active" id="voiceToggle" onclick="toggleVoice()">
            🔊
            <span class="control-tooltip">Voice Narration</span>
        </button>
        <button class="control-btn" onclick="toggleAutoPlay()">
            ▶️
            <span class="control-tooltip">Auto Journey</span>
        </button>
        <button class="control-btn" onclick="toggleInfo()">
            ℹ️
            <span class="control-tooltip">Toggle Info</span>
        </button>
    </div>

    <!-- Quick Actions -->
    <div class="quick-actions">
        <button class="action-btn" onclick="startGuidedTour()">
            <span>🚀</span> Guided Tour
        </button>
        <button class="action-btn" onclick="showQuiz()">
            <span>🎯</span> Test Knowledge
        </button>
    </div>

    <!-- Voice Indicator -->
    <div class="voice-indicator" id="voiceIndicator">
        <div class="voice-waves">
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
        </div>
        <div class="narration-text" id="narrationText">Narrating...</div>
    </div>

    <script>
        // Journey Step Data with Complete Pedagogical Content
        const JOURNEY_DATA = {
            introduction: {
                title: "Respiratory Pathways Overview",
                subtitle: "Different routes for glucose breakdown",
                icon: "🌟",
                modelUrl: "https://sketchfab.com/models/10659ca1502c4ade88abba6284bb50f2/embed?autostart=1&internal=1&tracking=0&ui_ar=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "Respiratory pathways are the different routes cells use to break down glucose and extract energy. These pathways determine how efficiently energy is produced and what waste products are formed, with important implications for muscle function and exercise performance.",
                concepts: [
                    "Glycolysis breaks glucose into pyruvate",
                    "Aerobic pathway produces maximum ATP",
                    "Anaerobic pathway produces lactic acid",
                    "Pathway choice depends on oxygen availability"
                ],
                funFact: "Your muscles can switch between aerobic and anaerobic pathways in seconds, adapting to changing energy demands during exercise!",
                objectives: "Understand how glucose is broken down through different pathways, compare energy yields, and learn why muscle fatigue occurs during intense exercise.",
                narration: "Welcome to the fascinating world of respiratory pathways! You're looking at a glucose molecule - the primary fuel that powers cellular respiration. But here's what makes this topic so interesting: there isn't just one way to break down glucose. Cells have evolved multiple pathways to extract energy from this simple sugar, and the pathway they choose has profound effects on energy production and waste products. Think of these pathways like different routes you could take to drive across town - some are faster but require certain conditions, while others are slower but always available. The aerobic pathway is like taking the highway when traffic is light - it's highly efficient and gets you the most energy. The anaerobic pathway is like taking side streets during rush hour - it's less efficient but still gets the job done when the main route isn't available. Understanding these pathways helps explain everything from why you get tired during exercise to how your muscles adapt to different types of activity."
            },
            glucose_breakdown: {
                title: "Glucose Breakdown Process",
                subtitle: "The starting point of cellular respiration",
                icon: "🍯",
                modelUrl: "https://sketchfab.com/models/10659ca1502c4ade88abba6284bb50f2/embed?autostart=1&internal=1&tracking=0&ui_ar=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "Glucose breakdown begins with glycolysis, a universal process that occurs in all living cells. This ancient metabolic pathway splits the six-carbon glucose molecule into two three-carbon pyruvate molecules, releasing energy and setting the stage for further processing.",
                concepts: [
                    "Glycolysis occurs in the cell cytoplasm",
                    "Glucose (C6H12O6) splits into two pyruvate molecules",
                    "Net yield of 2 ATP and 2 NADH molecules",
                    "Process works with or without oxygen"
                ],
                funFact: "Glycolysis is so ancient that it likely evolved over 3.5 billion years ago, before oxygen was even present in Earth's atmosphere!",
                objectives: "Learn how glucose is initially processed through glycolysis and understand why this pathway is universal to all life.",
                narration: "Here we see glucose in all its molecular glory - a simple sugar that serves as the universal fuel for life! Glucose breakdown begins with glycolysis, one of the most ancient and fundamental metabolic pathways on Earth. During glycolysis, this six-carbon sugar molecule is systematically broken apart through ten carefully orchestrated steps. Enzymes work like molecular scissors, cutting specific bonds and rearranging atoms until the single glucose molecule becomes two three-carbon molecules called pyruvate. This process happens in the cytoplasm of every living cell, from bacteria to brain cells. What's remarkable is that glycolysis produces energy even before oxygen gets involved - it nets 2 ATP molecules and 2 NADH electron carriers. The pyruvate molecules produced are like intermediate products in a factory - they can be processed further through different pathways depending on what the cell needs and what resources are available. This flexibility is what makes glucose such an excellent cellular fuel and glycolysis such a crucial metabolic foundation."
            },
            pyruvate_formation: {
                title: "Pyruvate Formation and Utilization",
                subtitle: "The metabolic crossroads",
                icon: "⚗️",
                modelUrl: "https://sketchfab.com/models/10659ca1502c4ade88abba6284bb50f2/embed?autostart=1&internal=1&tracking=0&ui_ar=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "Pyruvate represents a crucial metabolic crossroads where cells must choose between different energy-producing pathways. Depending on oxygen availability and cellular needs, pyruvate can enter aerobic respiration for maximum energy yield or be converted to lactate through anaerobic fermentation.",
                concepts: [
                    "Pyruvate is the end product of glycolysis",
                    "Can enter mitochondria for aerobic respiration",
                    "Can be converted to lactate in anaerobic conditions",
                    "Pathway choice affects energy yield and waste products"
                ],
                funFact: "The decision of what to do with pyruvate happens in milliseconds and can determine whether you can continue intense exercise or need to slow down!",
                objectives: "Understand how pyruvate serves as a metabolic decision point and learn the factors that determine which pathway is chosen.",
                narration: "Pyruvate formation marks one of the most important decision points in cellular metabolism! After glycolysis breaks down glucose, each cell faces a crucial choice about what to do with the pyruvate it has produced. This three-carbon molecule is like standing at a fork in the road - the cell can take one of two very different paths. If oxygen is plentiful, pyruvate can enter the mitochondria where it will be completely oxidized through the citric acid cycle and electron transport chain, yielding up to 36 additional ATP molecules. This is the aerobic pathway - highly efficient but oxygen-dependent. However, if oxygen is scarce or the cell needs energy quickly, pyruvate takes a different route. It gets converted directly to lactate in the cytoplasm through anaerobic fermentation. While this pathway only regenerates the NAD+ needed to keep glycolysis running, it allows energy production to continue even without oxygen. The cell's choice between these pathways depends on factors like oxygen availability, energy demands, and the type of cell involved. This metabolic flexibility is what allows your muscles to adapt to different exercise intensities."
            },
            energy_comparison: {
                title: "Energy Release Comparison",
                subtitle: "Aerobic vs anaerobic efficiency",
                icon: "📊",
                modelUrl: "https://sketchfab.com/models/bd84a4933a404842aa51af2024a83c79/embed?autostart=1&internal=1&tracking=0&ui_ar=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "The energy yield from glucose varies dramatically depending on which respiratory pathway is used. Aerobic respiration can produce up to 38 ATP molecules per glucose, while anaerobic fermentation yields only 2 ATP molecules, highlighting the efficiency advantage of oxygen-dependent metabolism.",
                concepts: [
                    "Aerobic respiration: up to 38 ATP per glucose",
                    "Anaerobic fermentation: only 2 ATP per glucose",
                    "Oxygen allows complete glucose oxidation",
                    "Trade-off between efficiency and speed"
                ],
                funFact: "Aerobic respiration is 19 times more efficient than anaerobic fermentation - this huge difference explains why oxygen is so crucial for complex life!",
                objectives: "Compare the energy yields of different respiratory pathways and understand why oxygen makes such a dramatic difference to energy production.",
                narration: "Looking at muscle fiber structure helps us understand why the choice between respiratory pathways matters so much! The difference in energy yield between aerobic and anaerobic respiration is absolutely dramatic. When glucose is completely oxidized through aerobic respiration, it can yield up to 38 ATP molecules. But when the same glucose is processed through anaerobic fermentation, it produces only 2 ATP molecules - that's a 19-fold difference in efficiency! This enormous gap explains why oxygen is so crucial for complex life forms. The aerobic pathway can extract so much more energy because it completely breaks down glucose to carbon dioxide and water, capturing energy at multiple steps. Anaerobic fermentation, on the other hand, only partially breaks down glucose, leaving most of its energy locked in the lactate molecule. However, anaerobic respiration has one key advantage - speed. It can produce ATP very quickly when oxygen runs low, which is crucial during intense exercise when muscles need immediate energy. The muscle fibers you see here contain both the mitochondria needed for aerobic respiration and the enzymes needed for anaerobic fermentation, allowing them to switch between pathways as needed."
            },
            muscle_fatigue: {
                title: "Muscle Fatigue Mechanisms",
                subtitle: "Why muscles tire during intense exercise",
                icon: "💪",
                modelUrl: "https://sketchfab.com/models/bd84a4933a404842aa51af2024a83c79/embed?autostart=1&internal=1&tracking=0&ui_ar=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "Muscle fatigue during intense exercise results from the accumulation of metabolic byproducts and the depletion of energy stores. When oxygen supply cannot meet demand, muscles switch to anaerobic metabolism, leading to lactate buildup and decreased pH that impairs muscle function.",
                concepts: [
                    "Oxygen demand exceeds supply during intense exercise",
                    "Shift to anaerobic metabolism produces lactate",
                    "pH decrease impairs enzyme function",
                    "Energy stores become depleted"
                ],
                funFact: "The burning sensation in your muscles during intense exercise isn't actually from lactic acid - it's from the hydrogen ions that acidify the muscle environment!",
                objectives: "Understand the biochemical basis of muscle fatigue and learn how metabolic changes affect muscle performance.",
                narration: "This cross-section of skeletal muscle fiber reveals the intricate structure where muscle fatigue develops during intense exercise! When you push your muscles hard, several interconnected processes lead to fatigue. First, oxygen demand skyrockets as muscle fibers work intensely, but oxygen delivery through the bloodstream has limits. When oxygen supply can't keep up with demand, muscle fibers must switch from efficient aerobic respiration to less efficient anaerobic fermentation. This metabolic shift has consequences - while it allows continued energy production, it also leads to the accumulation of lactate and hydrogen ions. The hydrogen ions lower the pH inside muscle cells, creating a more acidic environment that interferes with the proteins responsible for muscle contraction. Additionally, the rapid ATP consumption can deplete local energy stores faster than they can be replenished. The muscle fibers contain specialized organelles like mitochondria and sarcoplasmic reticulum that are affected by these pH changes. This biochemical disruption is what you feel as muscle fatigue - not damage to the muscle, but temporary impairment of its biochemical machinery. Understanding this process helps explain why high-intensity exercise can only be sustained for short periods."
            },
            lactic_acid: {
                title: "Lactic Acid and Recovery",
                subtitle: "The misunderstood metabolite",
                icon: "🧪",
                modelUrl: "https://sketchfab.com/models/b8a59698183047c6a81ee7a03f1810d6/embed?autostart=1&internal=1&tracking=0&ui_ar=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "Lactic acid, often blamed for muscle soreness, is actually a useful metabolic product that allows continued energy production when oxygen is limited. After exercise, lactate can be converted back to pyruvate and used for energy, or transported to the liver for glucose synthesis.",
                concepts: [
                    "Lactate allows continued ATP production without oxygen",
                    "Can be reconverted to pyruvate when oxygen returns",
                    "Transported to liver for glucose synthesis",
                    "Not the primary cause of delayed muscle soreness"
                ],
                funFact: "Lactate is actually a valuable fuel - your heart muscle preferentially uses lactate over glucose when both are available!",
                objectives: "Learn the true role of lactic acid in metabolism and understand how the body recovers from anaerobic exercise.",
                narration: "Here we see the lactic acid molecule - often misunderstood but actually a clever metabolic solution! Contrary to popular belief, lactic acid isn't just a waste product that causes muscle soreness. Instead, it's an important metabolic intermediate that serves several crucial functions. When muscles produce lactate during anaerobic exercise, they're essentially storing energy in a different form. The lactate molecule still contains significant chemical energy that can be harvested later. Once oxygen becomes available again, lactate can be converted back to pyruvate and fed into aerobic respiration for additional ATP production. This process, called the Cori cycle, allows the body to recover from oxygen debt. Some lactate is also transported through the bloodstream to the liver, where it can be converted back to glucose through gluconeogenesis. Interestingly, certain tissues like the heart actually prefer lactate as a fuel source when it's available! The lactate produced during exercise is typically cleared from muscles within 30-60 minutes after exercise ends. This means lactate isn't responsible for the delayed onset muscle soreness you might feel days after exercise - that's caused by microscopic muscle damage and inflammation, not lactate accumulation."
            }
        };

        // Global Variables
        let currentStep = 'introduction';
        let voiceEnabled = true;
        let autoPlayEnabled = false;
        let currentSpeech = null;
        let selectedVoice = null;
        let journeyProgress = 0;
        let guidedTourActive = false;

        // Initialize Voice System
        function initVoiceSystem() {
            if (!('speechSynthesis' in window)) {
                console.warn('Speech synthesis not supported');
                voiceEnabled = false;
                document.getElementById('voiceToggle').style.display = 'none';
                return;
            }

            function loadVoices() {
                const voices = speechSynthesis.getVoices();
                if (voices.length === 0) return;

                const preferredVoices = [
                    'Google UK English Female',
                    'Microsoft Sonia',
                    'Microsoft Hazel',
                    'Samantha',
                    'Victoria'
                ];

                for (const name of preferredVoices) {
                    selectedVoice = voices.find(v => v.name.includes(name));
                    if (selectedVoice) break;
                }

                if (!selectedVoice) {
                    selectedVoice = voices.find(v => v.lang.startsWith('en'));
                }
            }

            loadVoices();
            if (speechSynthesis.onvoiceschanged !== undefined) {
                speechSynthesis.onvoiceschanged = loadVoices;
            }
        }

        // Load Journey Step
        function loadJourneyStep(stepId) {
            const stepData = JOURNEY_DATA[stepId];
            if (!stepData) return;

            currentStep = stepId;
            
            document.getElementById('api-frame').src = stepData.modelUrl;
            document.getElementById('stepIcon').textContent = stepData.icon;
            document.getElementById('stepTitle').textContent = stepData.title;
            document.getElementById('stepSubtitle').textContent = stepData.subtitle;
            document.getElementById('mainDescription').textContent = stepData.description;
            
            const conceptsList = document.getElementById('keyConcepts');
            conceptsList.innerHTML = stepData.concepts.map(c => `<li>${c}</li>`).join('');
            
            document.getElementById('funFact').textContent = stepData.funFact;
            document.getElementById('learningObjectives').textContent = stepData.objectives;
            
            updateNavigationButtons(stepId);
            updateProgress();
            
            if (voiceEnabled) {
                speakText(stepData.narration);
            }
        }

        function updateNavigationButtons(activeStep) {
            const buttons = document.querySelectorAll('.journey-btn');
            const steps = ['introduction', 'glucose_breakdown', 'pyruvate_formation', 'energy_comparison', 'muscle_fatigue', 'lactic_acid'];
            const activeIndex = steps.indexOf(activeStep);
            
            buttons.forEach((btn, index) => {
                btn.classList.remove('active', 'completed');
                if (index < activeIndex) {
                    btn.classList.add('completed');
                } else if (index === activeIndex) {
                    btn.classList.add('active');
                }
            });
            
            const miniSteps = document.querySelectorAll('.step-mini');
            miniSteps.forEach((step, index) => {
                step.classList.remove('active', 'completed');
                if (index < activeIndex) {
                    step.classList.add('completed');
                } else if (index === activeIndex) {
                    step.classList.add('active');
                }
            });
        }

        function updateProgress() {
            const steps = ['introduction', 'glucose_breakdown', 'pyruvate_formation', 'energy_comparison', 'muscle_fatigue', 'lactic_acid'];
            const currentIndex = steps.indexOf(currentStep);
            const progress = ((currentIndex + 1) / steps.length) * 100;
            
            document.getElementById('progressPercent').textContent = Math.round(progress) + '%';
            document.getElementById('progressFill').style.width = progress + '%';
        }

        function speakText(text) {
            if (!voiceEnabled || !text) return;
            
            stopSpeech();
            
            currentSpeech = new SpeechSynthesisUtterance(text);
            if (selectedVoice) {
                currentSpeech.voice = selectedVoice;
            }
            currentSpeech.rate = 0.9;
            currentSpeech.pitch = 1.0;
            currentSpeech.volume = 0.9;
            
            currentSpeech.onstart = () => {
                document.getElementById('voiceIndicator').classList.add('visible');
                document.getElementById('narrationText').textContent = 
                    text.substring(0, 50) + (text.length > 50 ? '...' : '');
            };
            
            currentSpeech.onend = () => {
                document.getElementById('voiceIndicator').classList.remove('visible');
                currentSpeech = null;
                
                if (guidedTourActive) {
                    setTimeout(nextStep, 2000);
                }
            };
            
            speechSynthesis.speak(currentSpeech);
        }

        function stopSpeech() {
            if (currentSpeech) {
                speechSynthesis.cancel();
                currentSpeech = null;
                document.getElementById('voiceIndicator').classList.remove('visible');
            }
        }

        function toggleVoice() {
            voiceEnabled = !voiceEnabled;
            const btn = document.getElementById('voiceToggle');
            btn.textContent = voiceEnabled ? '🔊' : '🔇';
            btn.classList.toggle('active', voiceEnabled);
            
            if (!voiceEnabled) {
                stopSpeech();
            }
        }

        function toggleAutoPlay() {
            autoPlayEnabled = !autoPlayEnabled;
            if (autoPlayEnabled) {
                startGuidedTour();
            } else {
                guidedTourActive = false;
            }
        }

        function toggleInfo() {
            const panel = document.getElementById('infoPanel');
            panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
        }

        function startGuidedTour() {
            guidedTourActive = true;
            const steps = ['introduction', 'glucose_breakdown', 'pyruvate_formation', 'energy_comparison', 'muscle_fatigue', 'lactic_acid'];
            let stepIndex = 0;
            
            function tourStep() {
                if (stepIndex < steps.length && guidedTourActive) {
                    loadJourneyStep(steps[stepIndex]);
                    stepIndex++;
                } else {
                    guidedTourActive = false;
                    if (voiceEnabled) {
                        speakText("You've completed your journey through respiratory pathways! You now understand how cells break down glucose through different routes, why pathway choice matters for energy yield, and how this relates to muscle function during exercise.");
                    }
                }
            }
            
            tourStep();
            window.nextStep = tourStep;
        }

        function showQuiz() {
            const questions = [
                "What determines which respiratory pathway a cell uses?",
                "Why does aerobic respiration produce so much more ATP than anaerobic?",
                "What is the role of pyruvate in cellular respiration?",
                "What causes muscle fatigue during intense exercise?",
                "What happens to lactic acid after exercise?"
            ];
            
            const randomQ = questions[Math.floor(Math.random() * questions.length)];
            
            if (voiceEnabled) {
                speakText(`Here's a respiratory pathways question: ${randomQ} Think about the metabolic processes we've explored!`);
            }
        }

        function init() {
            initVoiceSystem();
            
            setTimeout(() => {
                const loading = document.getElementById('loadingOverlay');
                loading.style.opacity = '0';
                setTimeout(() => {
                    loading.style.display = 'none';
                    
                    if (voiceEnabled) {
                        speakText("Welcome to your journey through respiratory pathways! We'll explore the different routes cells use to break down glucose and extract energy. From understanding pyruvate formation to discovering why muscles fatigue, let's uncover the metabolic choices that power life!");
                    }
                }, 1000);
            }, 3000);
            
            document.addEventListener('keydown', (e) => {
                switch(e.key) {
                    case 'v': toggleVoice(); break;
                    case 'i': toggleInfo(); break;
                    case 'g': startGuidedTour(); break;
                    case 'Escape': stopSpeech(); guidedTourActive = false; break;
                    case 'ArrowRight': nextStep && nextStep(); break;
                }
            });
        }

        init();
    </script>
</body>
</html>