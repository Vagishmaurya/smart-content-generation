<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Human Excretory System - Interactive Journey</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tween.js/18.6.4/tween.umd.js"></script>

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #8b0000 0%, #dc143c 25%, #e67e22 50%, #f39c12 75%, #3498db 100%);
            color: white;
            overflow: hidden;
            position: relative;
            height: 100vh;
        }

        /* Animated Background */
        .bg-animation {
            position: fixed;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: 0;
            opacity: 0.08;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 320"><path fill="%23ffffff" fill-opacity="0.3" d="M0,96L48,112C96,128,192,160,288,186.7C384,213,480,235,576,213.3C672,192,768,128,864,128C960,128,1056,192,1152,197.3C1248,203,1344,149,1392,122.7L1440,96L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z"></path></svg>') repeat-x;
            animation: wave 22s linear infinite;
        }

        @keyframes wave {
            0% { background-position-x: 0; }
            100% { background-position-x: 1440px; }
        }

        /* Museum Interface */
        .museum-header {
            position: absolute;
            top: 10px;
            left: 20px;
            text-align: left;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            padding: 10px 18px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .museum-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 4px;
            background: linear-gradient(45deg, #dc143c, #f39c12);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: titleGlow 3s ease-in-out infinite;
        }

        @keyframes titleGlow {
            0%, 100% { filter: brightness(1); }
            50% { filter: brightness(1.4); }
        }

        .exhibit-subtitle {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.8);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .filtration-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            background: #3498db;
            border-radius: 50%;
            animation: filtration 3s ease-in-out infinite;
        }

        @keyframes filtration {
            0%, 100% { transform: scale(1) translateY(0); opacity: 1; background: #3498db; }
            25% { transform: scale(1.3) translateY(-2px); opacity: 0.8; background: #e67e22; }
            50% { transform: scale(1.5) translateY(-4px); opacity: 0.6; background: #f39c12; }
            75% { transform: scale(1.3) translateY(-2px); opacity: 0.8; background: #e67e22; }
        }

        /* Journey Navigation */
        .journey-navigation {
            position: absolute;
            bottom: 20px;
            left: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            padding: 15px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            max-width: 400px;
        }

        .journey-title {
            font-size: 14px;
            font-weight: 600;
            color: #dc143c;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .journey-steps {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }

        .journey-btn {
            background: rgba(220, 20, 60, 0.2);
            border: 1px solid rgba(220, 20, 60, 0.4);
            color: white;
            padding: 6px 10px;
            border-radius: 20px;
            font-size: 11px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 4px;
            white-space: nowrap;
        }

        .journey-btn:hover {
            background: rgba(220, 20, 60, 0.3);
            border-color: #dc143c;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(220, 20, 60, 0.3);
        }

        .journey-btn.active {
            background: linear-gradient(135deg, #dc143c, #8b0000);
            border-color: #dc143c;
            box-shadow: 0 0 20px rgba(220, 20, 60, 0.5);
            animation: pulse 2s infinite;
        }

        .journey-btn.completed {
            background: rgba(52, 152, 219, 0.3);
            border-color: #3498db;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        /* 3D Model Container */
        .model-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 0;
            overflow: hidden;
            border: none;
            z-index: 100;
        }

        .sketchfab-embed-wrapper {
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #8b0000 0%, #dc143c 25%, #e67e22 50%, #f39c12 75%, #3498db 100%);
        }

        .sketchfab-embed-wrapper iframe {
            width: 100%;
            height: 100%;
            border: none;
            border-radius: 0;
        }

        /* Information Panel */
        .info-panel {
            position: absolute;
            top: 70px;
            right: 20px;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(25px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 16px;
            padding: 24px;
            width: 500px;
            max-height: calc(100vh - 140px);
            z-index: 800;
            overflow-y: auto;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }

        .info-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        }

        .info-icon {
            font-size: 28px;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        .info-title {
            flex: 1;
        }

        .info-title h2 {
            font-size: 18px;
            color: #dc143c;
            margin-bottom: 4px;
        }

        .info-subtitle {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.7);
        }

        .info-content {
            color: rgba(255, 255, 255, 0.9);
            font-size: 14px;
            line-height: 1.6;
        }

        /* Progress Tracker */
        .progress-tracker {
            background: linear-gradient(135deg, rgba(220, 20, 60, 0.1), rgba(52, 152, 219, 0.1));
            border: 1px solid rgba(220, 20, 60, 0.3);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 20px;
        }

        .progress-header {
            font-size: 13px;
            font-weight: 600;
            color: #dc143c;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .progress-percentage {
            font-size: 18px;
            color: #3498db;
            font-weight: 700;
        }

        .progress-bar {
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 12px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #dc143c, #3498db);
            border-radius: 4px;
            transition: width 0.8s ease;
            box-shadow: 0 0 10px rgba(220, 20, 60, 0.5);
        }

        .progress-steps-mini {
            display: flex;
            justify-content: space-between;
            font-size: 9px;
            color: rgba(255, 255, 255, 0.6);
            flex-wrap: wrap;
            gap: 3px;
        }

        .step-mini {
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            flex: 1;
            min-width: 50px;
        }

        .step-mini.active {
            color: #dc143c;
            font-weight: 600;
        }

        .step-mini.completed {
            color: #3498db;
        }

        /* Information Cards */
        .info-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 14px;
            margin-bottom: 14px;
        }

        .info-card-title {
            color: #dc143c;
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .info-card-content {
            color: rgba(255, 255, 255, 0.85);
            font-size: 12px;
            line-height: 1.5;
        }

        .info-list {
            list-style: none;
            padding: 0;
        }

        .info-list li {
            padding: 6px 0;
            padding-left: 20px;
            position: relative;
            font-size: 12px;
            color: rgba(255, 255, 255, 0.8);
        }

        .info-list li:before {
            content: "🔬";
            position: absolute;
            left: 0;
            font-size: 10px;
        }

        /* Clinical Box */
        .clinical-box {
            background: linear-gradient(135deg, rgba(155, 89, 182, 0.1), rgba(52, 152, 219, 0.1));
            border: 1px solid rgba(155, 89, 182, 0.3);
            border-radius: 12px;
            padding: 14px;
            margin: 16px 0;
            position: relative;
            overflow: hidden;
        }

        .clinical-box:before {
            content: "🏥";
            position: absolute;
            top: -20px;
            right: -20px;
            font-size: 60px;
            opacity: 0.1;
        }

        .clinical-title {
            color: #9b59b6;
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 6px;
        }

        .clinical-text {
            color: rgba(255, 255, 255, 0.9);
            font-size: 12px;
            line-height: 1.5;
            position: relative;
            z-index: 1;
        }

        /* Fun Fact Box */
        .fun-fact {
            background: linear-gradient(135deg, rgba(243, 156, 18, 0.1), rgba(230, 126, 34, 0.1));
            border: 1px solid rgba(243, 156, 18, 0.3);
            border-radius: 12px;
            padding: 14px;
            margin: 16px 0;
            position: relative;
            overflow: hidden;
        }

        .fun-fact:before {
            content: "🧠";
            position: absolute;
            top: -20px;
            right: -20px;
            font-size: 60px;
            opacity: 0.1;
        }

        .fun-fact-title {
            color: #f39c12;
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 6px;
        }

        .fun-fact-text {
            color: rgba(255, 255, 255, 0.9);
            font-size: 12px;
            line-height: 1.5;
            position: relative;
            z-index: 1;
        }

        /* Voice Controls */
        .voice-controls {
            position: absolute;
            top: 10px;
            right: 20px;
            display: flex;
            gap: 8px;
            z-index: 1000;
        }

        .control-btn {
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            width: 44px;
            height: 44px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            position: relative;
        }

        .control-btn:hover {
            background: rgba(220, 20, 60, 0.3);
            border-color: #dc143c;
            transform: scale(1.1);
        }

        .control-btn.active {
            background: rgba(220, 20, 60, 0.4);
            border-color: #dc143c;
            box-shadow: 0 0 20px rgba(220, 20, 60, 0.5);
        }

        .control-tooltip {
            position: absolute;
            bottom: -30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9);
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 10px;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .control-btn:hover .control-tooltip {
            opacity: 1;
        }

        /* Loading Screen */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #8b0000 0%, #dc143c 25%, #e67e22 50%, #f39c12 75%, #3498db 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            transition: opacity 1s ease;
        }

        .loading-content {
            text-align: center;
        }

        .loading-icon {
            font-size: 60px;
            animation: filtration 1.5s ease-in-out infinite;
            margin-bottom: 20px;
        }

        .loading-text {
            color: white;
            font-size: 20px;
            margin-bottom: 20px;
        }

        .loading-progress {
            width: 200px;
            height: 4px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 2px;
            overflow: hidden;
        }

        .loading-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #dc143c, #3498db);
            animation: loading 2s ease-in-out infinite;
        }

        @keyframes loading {
            0% { width: 0%; }
            50% { width: 100%; }
            100% { width: 0%; }
        }

        /* Voice Indicator */
        .voice-indicator {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(220, 20, 60, 0.5);
            border-radius: 30px;
            padding: 14px 28px;
            display: flex;
            align-items: center;
            gap: 12px;
            z-index: 1000;
            opacity: 0;
            transition: all 0.3s ease;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }

        .voice-indicator.visible {
            opacity: 1;
            transform: translateX(-50%) translateY(-10px);
        }

        .voice-waves {
            display: flex;
            align-items: center;
            gap: 3px;
        }

        .voice-wave {
            width: 3px;
            height: 20px;
            background: linear-gradient(180deg, #dc143c, #3498db);
            border-radius: 2px;
            animation: voice-wave 1s ease-in-out infinite;
        }

        .voice-wave:nth-child(2) { animation-delay: 0.1s; }
        .voice-wave:nth-child(3) { animation-delay: 0.2s; }
        .voice-wave:nth-child(4) { animation-delay: 0.3s; }
        .voice-wave:nth-child(5) { animation-delay: 0.4s; }

        @keyframes voice-wave {
            0%, 100% { transform: scaleY(0.3); }
            50% { transform: scaleY(1); }
        }

        .narration-text {
            color: white;
            font-size: 13px;
            max-width: 300px;
        }

        /* Quick Actions */
        .quick-actions {
            position: absolute;
            bottom: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            z-index: 1000;
        }

        .action-btn {
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 10px 16px;
            border-radius: 25px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
        }

        .action-btn:hover {
            background: rgba(220, 20, 60, 0.3);
            border-color: #dc143c;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(220, 20, 60, 0.3);
        }

        /* Custom Scrollbar */
        .info-panel::-webkit-scrollbar {
            width: 6px;
        }

        .info-panel::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 3px;
        }

        .info-panel::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, #dc143c, #3498db);
            border-radius: 3px;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .info-panel {
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                top: auto;
                width: 100%;
                max-height: 50vh;
                border-radius: 20px 20px 0 0;
            }
            
            .journey-navigation {
                bottom: 52vh;
                max-width: calc(100% - 40px);
            }
            
            .voice-controls {
                top: auto;
                bottom: 55vh;
                right: 10px;
            }
            
            .quick-actions {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="bg-animation"></div>

    <!-- Loading Screen -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-content">
            <div class="loading-icon">🫘</div>
            <div class="loading-text">Preparing Excretory Journey...</div>
            <div class="loading-progress">
                <div class="loading-progress-bar"></div>
            </div>
        </div>
    </div>

    <!-- Museum Header -->
    <div class="museum-header">
        <div class="museum-title">Human Excretory System</div>
        <div class="exhibit-subtitle">
            <span class="filtration-indicator"></span>
            Body's Filtration & Waste Removal
        </div>
    </div>

    <!-- Journey Navigation -->
    <div class="journey-navigation">
        <div class="journey-title">
            <span>🫘</span>
            <span>Excretory System Journey</span>
        </div>
        <div class="journey-steps">
            <button class="journey-btn active" onclick="loadJourneyStep('kidney')">
                <span>🫘</span> Kidney Structure
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('nephron')">
                <span>🔬</span> Nephron Anatomy
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('glomerulus')">
                <span>🌐</span> Glomerulus
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('filtration')">
                <span>💧</span> Filtration
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('reabsorption')">
                <span>🔄</span> Reabsorption
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('urine')">
                <span>⚗️</span> Urine Formation
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('dialysis')">
                <span>🏥</span> Artificial Kidney
            </button>
        </div>
    </div>

    <!-- 3D Model Container -->
    <div class="model-container">
        <div class="sketchfab-embed-wrapper">
            <iframe id="api-frame"
                    title="Excretory System Model" 
                    frameborder="0" 
                    allowfullscreen 
                    mozallowfullscreen="true" 
                    webkitallowfullscreen="true" 
                    allow="autoplay; fullscreen; xr-spatial-tracking"
                    xr-spatial-tracking 
                    execution-while-out-of-viewport 
                    execution-while-not-rendered 
                    web-share 
                    src="https://sketchfab.com/models/d8c0652ddff4474585ccba155c490622/embed?autostart=1&internal=1&tracking=0&ui_ar=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0">
            </iframe>
        </div>
    </div>

    <!-- Information Panel -->
    <div class="info-panel" id="infoPanel">
        <div class="info-header">
            <div class="info-icon" id="stepIcon">🫘</div>
            <div class="info-title">
                <h2 id="stepTitle">Kidney Structure & Function</h2>
                <div class="info-subtitle" id="stepSubtitle">The body's sophisticated filtration organs</div>
            </div>
        </div>

        <!-- Progress Tracker -->
        <div class="progress-tracker">
            <div class="progress-header">
                <span>Excretory Knowledge Progress</span>
                <span class="progress-percentage" id="progressPercent">14%</span>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 14%"></div>
            </div>
            <div class="progress-steps-mini">
                <span class="step-mini active" onclick="loadJourneyStep('kidney')">Kidney</span>
                <span class="step-mini" onclick="loadJourneyStep('nephron')">Nephron</span>
                <span class="step-mini" onclick="loadJourneyStep('glomerulus')">Glom</span>
                <span class="step-mini" onclick="loadJourneyStep('filtration')">Filter</span>
                <span class="step-mini" onclick="loadJourneyStep('reabsorption')">Reabs</span>
                <span class="step-mini" onclick="loadJourneyStep('urine')">Urine</span>
                <span class="step-mini" onclick="loadJourneyStep('dialysis')">Dialysis</span>
            </div>
        </div>

        <div class="info-content" id="mainDescription">
            The kidneys are bean-shaped organs that filter blood to remove waste products and excess water, forming urine. Each kidney contains about 1 million functional units called nephrons that work continuously to maintain the body's chemical balance and fluid homeostasis.
        </div>

        <div class="info-card">
            <div class="info-card-title">
                <span>🏗️</span> Kidney Anatomy
            </div>
            <div class="info-card-content">
                <ul class="info-list" id="keyConcepts">
                    <li>Cortex: outer region containing glomeruli and convoluted tubules</li>
                    <li>Medulla: inner region with loops of Henle and collecting ducts</li>
                    <li>Renal pelvis: funnel-shaped cavity collecting urine</li>
                    <li>Renal artery: brings blood for filtration</li>
                    <li>Nephrons: 1 million functional filtering units per kidney</li>
                </ul>
            </div>
        </div>

        <div class="fun-fact">
            <div class="fun-fact-title">Kidney Facts!</div>
            <div class="fun-fact-text" id="funFact">
                Your kidneys filter your entire blood volume about 300 times per day, processing 180 liters of blood daily to produce just 1-2 liters of urine!
            </div>
        </div>

        <div class="info-card">
            <div class="info-card-title">
                <span>🎯</span> Learning Objectives
            </div>
            <div class="info-card-content" id="learningObjectives">
                Understand kidney anatomy, learn how nephrons filter blood, and appreciate the kidney's role in maintaining homeostasis.
            </div>
        </div>
    </div>

    <!-- Voice Controls -->
    <div class="voice-controls">
        <button class="control-btn active" id="voiceToggle" onclick="toggleVoice()">
            🔊
            <span class="control-tooltip">Voice Narration</span>
        </button>
        <button class="control-btn" onclick="toggleAutoPlay()">
            ▶️
            <span class="control-tooltip">Auto Journey</span>
        </button>
        <button class="control-btn" onclick="toggleInfo()">
            ℹ️
            <span class="control-tooltip">Toggle Info</span>
        </button>
    </div>

    <!-- Quick Actions -->
    <div class="quick-actions">
        <button class="action-btn" onclick="startGuidedTour()">
            <span>🚀</span> Guided Tour
        </button>
        <button class="action-btn" onclick="showQuiz()">
            <span>🎯</span> Test Knowledge
        </button>
    </div>

    <!-- Voice Indicator -->
    <div class="voice-indicator" id="voiceIndicator">
        <div class="voice-waves">
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
        </div>
        <div class="narration-text" id="narrationText">Narrating...</div>
    </div>

    <script>
        // Journey Step Data for Human Excretory System
        const JOURNEY_DATA = {
            kidney: {
                title: "Kidney Structure & Function",
                subtitle: "The body's sophisticated filtration organs",
                icon: "🫘",
                modelUrl: "https://sketchfab.com/models/d8c0652ddff4474585ccba155c490622/embed?autostart=1&internal=1&tracking=0&ui_ar=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "The kidneys are bean-shaped organs that filter blood to remove waste products and excess water, forming urine. Each kidney contains about 1 million functional units called nephrons that work continuously to maintain the body's chemical balance and fluid homeostasis.",
                concepts: [
                    "Cortex: outer region containing glomeruli and convoluted tubules",
                    "Medulla: inner region with loops of Henle and collecting ducts",
                    "Renal pelvis: funnel-shaped cavity collecting urine",
                    "Renal artery: brings blood for filtration",
                    "Nephrons: 1 million functional filtering units per kidney"
                ],
                funFact: "Your kidneys filter your entire blood volume about 300 times per day, processing 180 liters of blood daily to produce just 1-2 liters of urine!",
                objectives: "Understand kidney anatomy, learn how nephrons filter blood, and appreciate the kidney's role in maintaining homeostasis.",
                narration: "Welcome to the remarkable world of kidney anatomy! You're looking at one of the most sophisticated filtration systems in the human body. Each kidney is about the size of your fist but performs incredibly complex tasks. The outer cortex contains millions of tiny filtering units called glomeruli, along with the convoluted tubules that fine-tune the filtrate. The inner medulla houses the loops of Henle and collecting ducts, creating the concentrated urine. Notice the rich blood supply - the renal artery brings about 25% of your heart's output directly to the kidneys for filtering. The renal pelvis acts like a funnel, collecting the processed urine and directing it to the bladder. This cross-section reveals the intricate architecture that allows your kidneys to remove waste products, regulate blood pressure, maintain electrolyte balance, and produce hormones. Each kidney contains approximately one million nephrons working around the clock to keep your body's internal environment stable!"
            },
            nephron: {
                title: "Nephron Anatomy - The Functional Unit",
                subtitle: "Microscopic marvels of filtration",
                icon: "🔬",
                modelUrl: "https://sketchfab.com/models/30319ce9c5a441bdb6feeb9926c15284/embed?autostart=1&internal=1&tracking=0&ui_ar=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "Nephrons are the functional units of the kidney, each consisting of a renal corpuscle (glomerulus and Bowman's capsule) and a renal tubule. These microscopic structures perform the three main processes of urine formation: filtration, reabsorption, and secretion.",
                concepts: [
                    "Bowman's capsule: cup-shaped structure surrounding glomerulus",
                    "Proximal convoluted tubule: major site of reabsorption",
                    "Loop of Henle: creates concentration gradient for water reabsorption",
                    "Distal convoluted tubule: fine-tunes electrolyte balance",
                    "Collecting duct: final concentration of urine"
                ],
                funFact: "A single nephron is only 3cm long but if you laid out all nephrons from both kidneys end-to-end, they would stretch for 80 kilometers!",
                objectives: "Identify the parts of a nephron, understand the structure-function relationship, and learn how each segment contributes to urine formation.",
                narration: "Explore the incredible architecture of a nephron - the kidney's functional masterpiece! This single nephron represents one of a million similar units in each kidney. Starting at the top, we see Bowman's capsule, a cup-shaped structure that captures the initial filtrate from the glomerulus. The filtrate then flows into the proximal convoluted tubule, where about 65% of the filtered water, sodium, and virtually all glucose and amino acids are reabsorbed back into the blood. Next, the filtrate travels down the descending limb of the loop of Henle, which is permeable to water but not salt, concentrating the filtrate. The ascending limb actively pumps out sodium and chloride, creating the concentration gradient essential for concentrating urine. The distal convoluted tubule fine-tunes the final composition, responding to hormones like aldosterone and ADH. Finally, the collecting duct makes the final adjustments to urine concentration. Each part is perfectly designed for its specific role in transforming blood filtrate into concentrated urine!"
            },
            glomerulus: {
                title: "Glomerulus - The Filtration Cluster",
                subtitle: "Where blood filtration begins",
                icon: "🌐",
                modelUrl: "https://sketchfab.com/models/5006409cead5474cabb9e25f07f38b44/embed?autostart=1&internal=1&tracking=0&ui_ar=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "The glomerulus is a cluster of tiny capillaries where blood filtration occurs. Surrounded by Bowman's capsule, this structure acts as a sophisticated molecular sieve, allowing water and small molecules to pass while retaining blood cells and large proteins.",
                concepts: [
                    "Glomerular capillaries: fenestrated endothelium for filtration",
                    "Basement membrane: molecular sieve preventing protein loss",
                    "Podocytes: specialized cells with filtration slits",
                    "Mesangial cells: support structure and blood flow regulation",
                    "Filtration barrier: three-layer system ensuring selective filtration"
                ],
                funFact: "The glomerular filtration barrier is so precise it can distinguish between molecules that differ by just a few amino acids!",
                objectives: "Understand glomerular structure, learn about the filtration barrier, and appreciate how selective filtration works.",
                narration: "Welcome to the glomerulus - nature's most sophisticated biological filter! This cluster of capillaries is where the magic of kidney filtration begins. The glomerular capillaries have a unique fenestrated endothelium with tiny pores that allow water and small molecules to pass through easily. But the real precision comes from the three-layer filtration barrier. First, the fenestrated endothelium allows passage based on size. Second, the basement membrane acts like a molecular sieve, blocking larger proteins while allowing smaller molecules through. Third, the podocytes - specialized cells with foot processes - create filtration slits that provide the final barrier. These podocyte foot processes interdigitate like fingers, creating a precise filtration system. Mesangial cells provide structural support and can contract to regulate blood flow. This entire system filters about 120 milliliters of plasma every minute, removing waste products while carefully retaining essential proteins and blood cells. The precision of this filtration barrier is remarkable - damage to any layer can lead to protein loss in urine, a sign of kidney disease!"
            },
            filtration: {
                title: "Glomerular Filtration Process",
                subtitle: "The first step in urine formation",
                icon: "💧",
                modelUrl: "https://sketchfab.com/models/5006409cead5474cabb9e25f07f38b44/embed?autostart=1&internal=1&tracking=0&ui_ar=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "Glomerular filtration is the passive process where blood pressure forces water and dissolved substances through the glomerular filtration barrier into Bowman's capsule, forming the initial filtrate that will become urine.",
                concepts: [
                    "Filtration pressure: net pressure driving filtration (~10 mmHg)",
                    "GFR (Glomerular Filtration Rate): 120 mL/min normal rate",
                    "Filtrate composition: water, glucose, amino acids, urea, creatinine",
                    "Autoregulation: kidneys maintain steady GFR despite BP changes",
                    "Clearance: measure of kidney's ability to remove substances"
                ],
                funFact: "Your kidneys produce about 180 liters of initial filtrate daily, but 99% is reabsorbed, leaving only 1-2 liters as final urine!",
                objectives: "Understand the forces driving filtration, learn about GFR regulation, and appreciate the enormous volume of filtrate processed daily.",
                narration: "Let's explore the incredible process of glomerular filtration! Blood enters the glomerulus under pressure from the renal artery, and this pressure is the driving force for filtration. The net filtration pressure is about 10 mmHg - the difference between glomerular blood pressure pushing outward and the opposing forces of plasma protein osmotic pressure and capsular pressure pushing inward. This pressure forces water and dissolved substances smaller than 69,000 daltons through the filtration barrier. The result is an ultrafiltrate that contains water, glucose, amino acids, urea, creatinine, and electrolytes, but virtually no proteins or blood cells. The glomerular filtration rate, or GFR, is normally about 120 milliliters per minute - that means your kidneys filter about 7 liters of blood every hour! The kidneys have remarkable autoregulation mechanisms that maintain steady filtration even when blood pressure changes. This ensures consistent waste removal regardless of your activity level. The composition of this initial filtrate is essentially protein-free plasma, and it's this filtrate that will be modified as it travels through the nephron tubules!"
            },
            reabsorption: {
                title: "Tubular Reabsorption & Secretion",
                subtitle: "Reclaiming valuable substances",
                icon: "🔄",
                modelUrl: "https://sketchfab.com/models/30319ce9c5a441bdb6feeb9926c15284/embed?autostart=1&internal=1&tracking=0&ui_ar=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "Tubular reabsorption and secretion are the processes that modify the initial filtrate, reclaiming essential substances while adding waste products. This occurs throughout the nephron tubule and is both passive and active.",
                concepts: [
                    "Proximal tubule: reabsorbs 65% of filtrate, all glucose and amino acids",
                    "Loop of Henle: creates concentration gradient via countercurrent system",
                    "Distal tubule: hormone-regulated fine-tuning of electrolytes",
                    "Active transport: uses ATP to move substances against gradients",
                    "Passive transport: follows concentration and electrochemical gradients"
                ],
                funFact: "Your kidneys reabsorb 99% of the glucose that enters the filtrate - under normal conditions, no glucose appears in your urine!",
                objectives: "Learn the mechanisms of reabsorption and secretion, understand regional specialization, and appreciate hormonal regulation.",
                narration: "Now we'll explore the sophisticated processes of tubular reabsorption and secretion that transform the initial filtrate into concentrated urine! In the proximal convoluted tubule, the heavy lifting begins - about 65% of the filtered water and sodium are reabsorbed here, along with virtually all glucose, amino acids, and proteins. This occurs through both active and passive transport mechanisms. Glucose and amino acids are actively transported using sodium-coupled transporters, while water follows passively due to osmotic gradients. The loop of Henle creates a countercurrent multiplication system - the descending limb is permeable to water but not salt, concentrating the filtrate, while the ascending limb actively pumps out sodium and chloride without water, diluting the filtrate and creating the medullary concentration gradient. In the distal convoluted tubule and collecting duct, fine-tuning occurs under hormonal control. Aldosterone regulates sodium reabsorption, while ADH controls water permeability. Secretion also occurs throughout the tubules, adding waste products like creatinine, PAH, and excess hydrogen ions to the urine. This entire process reclaims about 99% of the filtered water and essential nutrients while concentrating waste products!"
            },
            urine: {
                title: "Urine Formation & Composition",
                subtitle: "The final product of kidney filtration",
                icon: "⚗️",
                modelUrl: "https://sketchfab.com/models/30319ce9c5a441bdb6feeb9926c15284/embed?autostart=1&internal=1&tracking=0&ui_ar=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "Urine formation is the result of three processes: glomerular filtration, tubular reabsorption, and tubular secretion. The final urine composition reflects the kidney's ability to maintain homeostasis while eliminating waste products.",
                concepts: [
                    "Normal urine: 95% water, 5% dissolved solutes",
                    "Urea: primary nitrogenous waste (50% of solutes)",
                    "Creatinine: marker of kidney function",
                    "Electrolytes: sodium, potassium, chloride in controlled amounts",
                    "Volume: 1-2 liters daily, varies with hydration and hormones"
                ],
                funFact: "Urine is normally sterile when it leaves the kidneys, and its yellow color comes from urochrome, a breakdown product of hemoglobin!",
                objectives: "Understand normal urine composition, learn how kidney diseases affect urine, and appreciate urine as a diagnostic tool.",
                narration: "Let's examine the final product of this remarkable filtration system - urine! Normal urine is about 95% water and 5% dissolved solutes, representing the kidney's precise work in maintaining homeostasis. The primary component is urea, accounting for about 50% of the dissolved solutes. Urea is the main nitrogenous waste product from protein metabolism, and its concentration in urine is about 1000 times higher than in blood! Creatinine is another important component - it's produced at a constant rate by muscle metabolism and is freely filtered but not reabsorbed, making it an excellent marker of kidney function. Normal urine also contains controlled amounts of electrolytes like sodium, potassium, and chloride, plus trace amounts of hormones, vitamins, and other metabolites. The daily urine volume typically ranges from 1-2 liters, but this varies greatly with fluid intake, environmental conditions, and hormonal status. The characteristic yellow color comes from urochrome, a pigment derived from the breakdown of hemoglobin. Changes in urine color, volume, or composition can indicate various health conditions, making urine analysis a valuable diagnostic tool. The kidney's ability to concentrate urine up to 1200 mOsm/kg allows us to conserve water while still eliminating metabolic wastes!"
            },
            dialysis: {
                title: "Artificial Kidney - Dialysis",
                subtitle: "Medical technology replacing kidney function",
                icon: "🏥",
                modelUrl: "https://sketchfab.com/models/d8c0652ddff4474585ccba155c490622/embed?autostart=1&internal=1&tracking=0&ui_ar=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "Dialysis is a medical procedure that artificially performs the kidney's filtration function for patients with kidney failure. Hemodialysis uses an external machine, while peritoneal dialysis uses the body's peritoneal membrane as a filter.",
                concepts: [
                    "Hemodialysis: blood filtered through artificial membrane 3x/week",
                    "Dialysate: specially formulated fluid for removing wastes",
                    "Diffusion: waste products move from blood to dialysate",
                    "Ultrafiltration: pressure removes excess fluid",
                    "Peritoneal dialysis: uses peritoneum as natural filter"
                ],
                funFact: "A dialysis machine can filter a patient's entire blood volume 3-4 times during a single 4-hour treatment session!",
                objectives: "Understand dialysis principles, compare hemodialysis and peritoneal dialysis, and appreciate this life-saving technology.",
                narration: "Welcome to the world of artificial kidneys - one of medicine's greatest technological achievements! When kidneys fail, dialysis machines can take over their life-sustaining functions. Hemodialysis, the most common type, works by pumping the patient's blood through hollow fiber tubes made of semi-permeable membrane, surrounded by a carefully formulated dialysate solution. The principle is simple but elegant: waste products and excess electrolytes diffuse from the blood (high concentration) to the dialysate (low concentration) across the membrane. Meanwhile, ultrafiltration uses pressure to remove excess fluid that healthy kidneys would normally eliminate. A typical hemodialysis session lasts 3-4 hours and must be repeated 3 times per week. The dialysate composition is precisely controlled - it contains no urea or creatinine (so wastes diffuse out), appropriate electrolyte concentrations, and glucose or bicarbonate as needed. Peritoneal dialysis offers an alternative, using the patient's own peritoneal membrane as the filter. Dialysate is introduced into the abdominal cavity, wastes diffuse across the peritoneum, and the fluid is then drained and replaced. While dialysis can't fully replace all kidney functions like hormone production, it successfully maintains life for hundreds of thousands of people worldwide with kidney failure!"
            }
        };

        // Global Variables
        let currentStep = 'kidney';
        let voiceEnabled = true;
        let autoPlayEnabled = false;
        let currentSpeech = null;
        let selectedVoice = null;
        let journeyProgress = 0;
        let guidedTourActive = false;

        // Initialize Voice System
        function initVoiceSystem() {
            if (!('speechSynthesis' in window)) {
                console.warn('Speech synthesis not supported');
                voiceEnabled = false;
                document.getElementById('voiceToggle').style.display = 'none';
                return;
            }

            function loadVoices() {
                const voices = speechSynthesis.getVoices();
                if (voices.length === 0) return;

                const preferredVoices = [
                    'Google UK English Female',
                    'Microsoft Sonia',
                    'Microsoft Hazel',
                    'Samantha',
                    'Victoria'
                ];

                for (const name of preferredVoices) {
                    selectedVoice = voices.find(v => v.name.includes(name));
                    if (selectedVoice) break;
                }

                if (!selectedVoice) {
                    selectedVoice = voices.find(v => v.lang.startsWith('en'));
                }
            }

            loadVoices();
            if (speechSynthesis.onvoiceschanged !== undefined) {
                speechSynthesis.onvoiceschanged = loadVoices;
            }
        }

        // Load Journey Step
        function loadJourneyStep(stepId) {
            const stepData = JOURNEY_DATA[stepId];
            if (!stepData) return;

            currentStep = stepId;
            
            // Update model
            document.getElementById('api-frame').src = stepData.modelUrl;
            
            // Update info panel
            document.getElementById('stepIcon').textContent = stepData.icon;
            document.getElementById('stepTitle').textContent = stepData.title;
            document.getElementById('stepSubtitle').textContent = stepData.subtitle;
            document.getElementById('mainDescription').textContent = stepData.description;
            
            // Update key concepts
            const conceptsList = document.getElementById('keyConcepts');
            conceptsList.innerHTML = stepData.concepts.map(c => `<li>${c}</li>`).join('');
            
            // Update fun fact
            document.getElementById('funFact').textContent = stepData.funFact;
            
            // Update learning objectives
            document.getElementById('learningObjectives').textContent = stepData.objectives;
            
            // Add clinical box if present
            const existingClinical = document.querySelector('.clinical-box');
            if (existingClinical) existingClinical.remove();
            
            if (stepData.clinical) {
                const clinicalBox = document.createElement('div');
                clinicalBox.className = 'clinical-box';
                clinicalBox.innerHTML = `
                    <div class="clinical-title">Clinical Significance</div>
                    <div class="clinical-text">${stepData.clinical}</div>
                `;
                document.querySelector('.fun-fact').parentNode.insertBefore(clinicalBox, document.querySelector('.fun-fact').nextSibling);
            }
            
            // Update navigation buttons
            updateNavigationButtons(stepId);
            
            // Update progress
            updateProgress();
            
            // Play narration if enabled
            if (voiceEnabled) {
                speakText(stepData.narration);
            }
        }

        // Update Navigation Buttons
        function updateNavigationButtons(activeStep) {
            const buttons = document.querySelectorAll('.journey-btn');
            const steps = ['kidney', 'nephron', 'glomerulus', 'filtration', 'reabsorption', 'urine', 'dialysis'];
            const activeIndex = steps.indexOf(activeStep);
            
            buttons.forEach((btn, index) => {
                btn.classList.remove('active', 'completed');
                if (index < activeIndex) {
                    btn.classList.add('completed');
                } else if (index === activeIndex) {
                    btn.classList.add('active');
                }
            });
            
            // Update mini steps
            const miniSteps = document.querySelectorAll('.step-mini');
            miniSteps.forEach((step, index) => {
                step.classList.remove('active', 'completed');
                if (index < activeIndex) {
                    step.classList.add('completed');
                } else if (index === activeIndex) {
                    step.classList.add('active');
                }
            });
        }

        // Update Progress
        function updateProgress() {
            const steps = ['kidney', 'nephron', 'glomerulus', 'filtration', 'reabsorption', 'urine', 'dialysis'];
            const currentIndex = steps.indexOf(currentStep);
            const progress = ((currentIndex + 1) / steps.length) * 100;
            
            document.getElementById('progressPercent').textContent = Math.round(progress) + '%';
            document.getElementById('progressFill').style.width = progress + '%';
        }

        // Speech Functions
        function speakText(text) {
            if (!voiceEnabled || !text) return;
            
            stopSpeech();
            
            currentSpeech = new SpeechSynthesisUtterance(text);
            if (selectedVoice) {
                currentSpeech.voice = selectedVoice;
            }
            currentSpeech.rate = 0.9;
            currentSpeech.pitch = 1.0;
            currentSpeech.volume = 0.9;
            
            currentSpeech.onstart = () => {
                document.getElementById('voiceIndicator').classList.add('visible');
                document.getElementById('narrationText').textContent = 
                    text.substring(0, 50) + (text.length > 50 ? '...' : '');
            };
            
            currentSpeech.onend = () => {
                document.getElementById('voiceIndicator').classList.remove('visible');
                currentSpeech = null;
                
                if (guidedTourActive) {
                    setTimeout(nextStep, 2000);
                }
            };
            
            speechSynthesis.speak(currentSpeech);
        }

        function stopSpeech() {
            if (currentSpeech) {
                speechSynthesis.cancel();
                currentSpeech = null;
                document.getElementById('voiceIndicator').classList.remove('visible');
            }
        }

        // Control Functions
        function toggleVoice() {
            voiceEnabled = !voiceEnabled;
            const btn = document.getElementById('voiceToggle');
            btn.textContent = voiceEnabled ? '🔊' : '🔇';
            btn.classList.toggle('active', voiceEnabled);
            
            if (!voiceEnabled) {
                stopSpeech();
            }
        }

        function toggleAutoPlay() {
            autoPlayEnabled = !autoPlayEnabled;
            if (autoPlayEnabled) {
                startGuidedTour();
            } else {
                guidedTourActive = false;
            }
        }

        function toggleInfo() {
            const panel = document.getElementById('infoPanel');
            panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
        }

        // Guided Tour
        function startGuidedTour() {
            guidedTourActive = true;
            const steps = ['kidney', 'nephron', 'glomerulus', 'filtration', 'reabsorption', 'urine', 'dialysis'];
            let stepIndex = 0;
            
            function tourStep() {
                if (stepIndex < steps.length && guidedTourActive) {
                    loadJourneyStep(steps[stepIndex]);
                    stepIndex++;
                } else {
                    guidedTourActive = false;
                    if (voiceEnabled) {
                        speakText("Congratulations! You've completed your journey through the human excretory system. You now understand how your kidneys filter blood and maintain the body's chemical balance!");
                    }
                }
            }
            
            tourStep();
            window.nextStep = tourStep;
        }

        // Quiz Function
        function showQuiz() {
            const questions = [
                "What are the main parts of a nephron?",
                "How much blood do kidneys filter daily?",
                "What drives glomerular filtration?",
                "Where does most reabsorption occur?",
                "How does dialysis replace kidney function?"
            ];
            
            const randomQ = questions[Math.floor(Math.random() * questions.length)];
            
            if (voiceEnabled) {
                speakText(`Here's a question to test your knowledge: ${randomQ} Think about what you've learned about the excretory system!`);
            }
        }

        // Initialize
        function init() {
            initVoiceSystem();
            
            // Hide loading screen
            setTimeout(() => {
                const loading = document.getElementById('loadingOverlay');
                loading.style.opacity = '0';
                setTimeout(() => {
                    loading.style.display = 'none';
                    
                    // Welcome message
                    if (voiceEnabled) {
                        speakText("Welcome to your journey through the human excretory system! We'll explore how your kidneys filter blood, form urine, and maintain your body's chemical balance. Let's start with kidney structure!");
                    }
                }, 1000);
            }, 3000);
            
            // Keyboard shortcuts
            document.addEventListener('keydown', (e) => {
                switch(e.key) {
                    case 'v': toggleVoice(); break;
                    case 'i': toggleInfo(); break;
                    case 'g': startGuidedTour(); break;
                    case 'Escape': stopSpeech(); guidedTourActive = false; break;
                    case 'ArrowRight': nextStep && nextStep(); break;
                }
            });
        }

        // Start the application
        init();
    </script>
</body>
</html>