<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cellular Respiration Basics - Energy Journey</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tween.js/18.6.4/tween.umd.js"></script>

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #e74c3c 0%, #f39c12 100%);
            color: white;
            overflow: hidden;
            position: relative;
            height: 100vh;
        }

        /* Animated Background */
        .bg-animation {
            position: fixed;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: 0;
            opacity: 0.1;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 320"><path fill="%23ffffff" fill-opacity="0.2" d="M0,96L48,112C96,128,192,160,288,186.7C384,213,480,235,576,213.3C672,192,768,128,864,128C960,128,1056,192,1152,197.3C1248,203,1344,149,1392,122.7L1440,96L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z"></path></svg>') repeat-x;
            animation: wave 10s linear infinite;
        }

        @keyframes wave {
            0% { background-position-x: 0; }
            100% { background-position-x: 1440px; }
        }

        /* Museum Interface - Compact Header */
        .museum-header {
            position: absolute;
            top: 10px;
            left: 20px;
            text-align: left;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            padding: 10px 18px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .museum-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 4px;
            background: linear-gradient(45deg, #e74c3c, #f39c12);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: titleGlow 3s ease-in-out infinite;
        }

        @keyframes titleGlow {
            0%, 100% { filter: brightness(1); }
            50% { filter: brightness(1.2); }
        }

        .exhibit-subtitle {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.8);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .energy-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            background: #f39c12;
            border-radius: 50%;
            animation: energy-pulse 1.5s ease-in-out infinite;
        }

        @keyframes energy-pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.3); opacity: 0.7; }
        }

        /* Journey Navigation - Enhanced */
        .journey-navigation {
            position: absolute;
            bottom: 20px;
            left: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            padding: 15px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            max-width: 320px;
        }

        .journey-title {
            font-size: 14px;
            font-weight: 600;
            color: #f39c12;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .journey-steps {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }

        .journey-btn {
            background: rgba(243, 156, 18, 0.2);
            border: 1px solid rgba(243, 156, 18, 0.4);
            color: white;
            padding: 6px 10px;
            border-radius: 20px;
            font-size: 11px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 4px;
            white-space: nowrap;
        }

        .journey-btn:hover {
            background: rgba(243, 156, 18, 0.3);
            border-color: #f39c12;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(243, 156, 18, 0.3);
        }

        .journey-btn.active {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            border-color: #e74c3c;
            box-shadow: 0 0 20px rgba(231, 76, 60, 0.5);
            animation: pulse 2s infinite;
        }

        .journey-btn.completed {
            background: rgba(52, 152, 219, 0.3);
            border-color: #3498db;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        /* 3D Model Container */
        .model-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 0;
            overflow: hidden;
            border: none;
            z-index: 100;
        }

        .sketchfab-embed-wrapper {
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #e74c3c 0%, #f39c12 100%);
        }

        .sketchfab-embed-wrapper iframe {
            width: 100%;
            height: 100%;
            border: none;
            border-radius: 0;
        }

        /* Information Panel - Enhanced */
        .info-panel {
            position: absolute;
            top: 70px;
            right: 20px;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(25px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 16px;
            padding: 24px;
            width: 380px;
            max-height: calc(100vh - 140px);
            z-index: 800;
            overflow-y: auto;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }

        .info-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        }

        .info-icon {
            font-size: 28px;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        .info-title {
            flex: 1;
        }

        .info-title h2 {
            font-size: 18px;
            color: #f39c12;
            margin-bottom: 4px;
        }

        .info-subtitle {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.7);
        }

        .info-content {
            color: rgba(255, 255, 255, 0.9);
            font-size: 14px;
            line-height: 1.6;
        }

        /* Progress Tracker */
        .progress-tracker {
            background: linear-gradient(135deg, rgba(243, 156, 18, 0.1), rgba(231, 76, 60, 0.1));
            border: 1px solid rgba(243, 156, 18, 0.3);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 20px;
        }

        .progress-header {
            font-size: 13px;
            font-weight: 600;
            color: #f39c12;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .progress-percentage {
            font-size: 18px;
            color: #e74c3c;
            font-weight: 700;
        }

        .progress-bar {
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 12px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #f39c12, #e74c3c);
            border-radius: 4px;
            transition: width 0.8s ease;
            box-shadow: 0 0 10px rgba(243, 156, 18, 0.5);
        }

        .progress-steps-mini {
            display: flex;
            justify-content: space-between;
            font-size: 10px;
            color: rgba(255, 255, 255, 0.6);
        }

        .step-mini {
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .step-mini.active {
            color: #e74c3c;
            font-weight: 600;
        }

        .step-mini.completed {
            color: #3498db;
        }

        /* Information Cards */
        .info-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 14px;
            margin-bottom: 14px;
        }

        .info-card-title {
            color: #f39c12;
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .info-card-content {
            color: rgba(255, 255, 255, 0.85);
            font-size: 12px;
            line-height: 1.5;
        }

        .info-list {
            list-style: none;
            padding: 0;
        }

        .info-list li {
            padding: 6px 0;
            padding-left: 20px;
            position: relative;
            font-size: 12px;
            color: rgba(255, 255, 255, 0.8);
        }

        .info-list li:before {
            content: "‚Üí";
            position: absolute;
            left: 0;
            color: #f39c12;
        }

        /* Fun Fact Box */
        .fun-fact {
            background: linear-gradient(135deg, rgba(231, 76, 60, 0.1), rgba(243, 156, 18, 0.1));
            border: 1px solid rgba(231, 76, 60, 0.3);
            border-radius: 12px;
            padding: 14px;
            margin: 16px 0;
            position: relative;
            overflow: hidden;
        }

        .fun-fact:before {
            content: "‚ö°";
            position: absolute;
            top: -20px;
            right: -20px;
            font-size: 60px;
            opacity: 0.1;
        }

        .fun-fact-title {
            color: #e74c3c;
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 6px;
        }

        .fun-fact-text {
            color: rgba(255, 255, 255, 0.9);
            font-size: 12px;
            line-height: 1.5;
            position: relative;
            z-index: 1;
        }

        /* Voice Controls */
        .voice-controls {
            position: absolute;
            top: 10px;
            right: 20px;
            display: flex;
            gap: 8px;
            z-index: 1000;
        }

        .control-btn {
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            width: 44px;
            height: 44px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            position: relative;
        }

        .control-btn:hover {
            background: rgba(243, 156, 18, 0.3);
            border-color: #f39c12;
            transform: scale(1.1);
        }

        .control-btn.active {
            background: rgba(243, 156, 18, 0.4);
            border-color: #f39c12;
            box-shadow: 0 0 20px rgba(243, 156, 18, 0.5);
        }

        .control-tooltip {
            position: absolute;
            bottom: -30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9);
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 10px;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .control-btn:hover .control-tooltip {
            opacity: 1;
        }

        /* Loading Screen */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #e74c3c 0%, #f39c12 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            transition: opacity 1s ease;
        }

        .loading-content {
            text-align: center;
        }

        .loading-energy {
            font-size: 60px;
            animation: energy-burst 2s ease-in-out infinite;
            margin-bottom: 20px;
        }

        @keyframes energy-burst {
            0%, 100% { transform: scale(1) rotate(0deg); }
            50% { transform: scale(1.2) rotate(90deg); }
        }

        .loading-text {
            color: white;
            font-size: 20px;
            margin-bottom: 20px;
        }

        .loading-progress {
            width: 200px;
            height: 4px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 2px;
            overflow: hidden;
        }

        .loading-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #f39c12, #e74c3c);
            animation: loading 2s ease-in-out infinite;
        }

        @keyframes loading {
            0% { width: 0%; }
            50% { width: 100%; }
            100% { width: 0%; }
        }

        /* Voice Indicator */
        .voice-indicator {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(243, 156, 18, 0.5);
            border-radius: 30px;
            padding: 14px 28px;
            display: flex;
            align-items: center;
            gap: 12px;
            z-index: 1000;
            opacity: 0;
            transition: all 0.3s ease;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }

        .voice-indicator.visible {
            opacity: 1;
            transform: translateX(-50%) translateY(-10px);
        }

        .voice-waves {
            display: flex;
            align-items: center;
            gap: 3px;
        }

        .voice-wave {
            width: 3px;
            height: 20px;
            background: linear-gradient(180deg, #f39c12, #e74c3c);
            border-radius: 2px;
            animation: voice-wave 1s ease-in-out infinite;
        }

        .voice-wave:nth-child(2) { animation-delay: 0.1s; }
        .voice-wave:nth-child(3) { animation-delay: 0.2s; }
        .voice-wave:nth-child(4) { animation-delay: 0.3s; }
        .voice-wave:nth-child(5) { animation-delay: 0.4s; }

        @keyframes voice-wave {
            0%, 100% { transform: scaleY(0.3); }
            50% { transform: scaleY(1); }
        }

        .narration-text {
            color: white;
            font-size: 13px;
            max-width: 300px;
        }

        /* Quick Actions */
        .quick-actions {
            position: absolute;
            bottom: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            z-index: 1000;
        }

        .action-btn {
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 10px 16px;
            border-radius: 25px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
        }

        .action-btn:hover {
            background: rgba(243, 156, 18, 0.3);
            border-color: #f39c12;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(243, 156, 18, 0.3);
        }

        /* Custom Scrollbar */
        .info-panel::-webkit-scrollbar {
            width: 6px;
        }

        .info-panel::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 3px;
        }

        .info-panel::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, #f39c12, #e74c3c);
            border-radius: 3px;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .info-panel {
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                top: auto;
                width: 100%;
                max-height: 50vh;
                border-radius: 20px 20px 0 0;
            }
            
            .journey-navigation {
                bottom: 52vh;
                max-width: calc(100% - 40px);
            }
            
            .voice-controls {
                top: auto;
                bottom: 55vh;
                right: 10px;
            }
            
            .quick-actions {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="bg-animation"></div>

    <!-- Loading Screen -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-content">
            <div class="loading-energy">‚ö°</div>
            <div class="loading-text">Exploring Cellular Energy Production...</div>
            <div class="loading-progress">
                <div class="loading-progress-bar"></div>
            </div>
        </div>
    </div>

    <!-- Museum Header -->
    <div class="museum-header">
        <div class="museum-title">Cellular Respiration Basics</div>
        <div class="exhibit-subtitle">
            <span class="energy-indicator"></span>
            How Cells Extract Energy from Food
        </div>
    </div>

    <!-- Journey Navigation -->
    <div class="journey-navigation">
        <div class="journey-title">
            <span>‚ö°</span>
            <span>Energy Production</span>
        </div>
        <div class="journey-steps">
            <button class="journey-btn active" onclick="loadJourneyStep('introduction')">
                <span>üåü</span> Overview
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('co2_exhaled_test')">
                <span>üí®</span> CO2 Test
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('fermentation_demo')">
                <span>üçû</span> Fermentation
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('aerobic_respiration')">
                <span>üî•</span> Aerobic
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('anaerobic_respiration')">
                <span>ü¶†</span> Anaerobic
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('atp_production')">
                <span>‚ö°</span> ATP Energy
            </button>
        </div>
    </div>

    <!-- 3D Model Container -->
    <div class="model-container">
        <div class="sketchfab-embed-wrapper">
            <iframe id="api-frame"
                    title="Cellular Respiration Model" 
                    frameborder="0" 
                    allowfullscreen 
                    mozallowfullscreen="true" 
                    webkitallowfullscreen="true" 
                    allow="autoplay; fullscreen; xr-spatial-tracking"
                    xr-spatial-tracking 
                    execution-while-out-of-viewport 
                    execution-while-not-rendered 
                    web-share 
                    src="https://sketchfab.com/models/7445a425050e49daa881070ca6917a91/embed?autostart=1&internal=1&tracking=0&ui_ar=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0">
            </iframe>
        </div>
    </div>

    <!-- Information Panel -->
    <div class="info-panel" id="infoPanel">
        <div class="info-header">
            <div class="info-icon" id="stepIcon">üåü</div>
            <div class="info-title">
                <h2 id="stepTitle">Cellular Respiration Overview</h2>
                <div class="info-subtitle" id="stepSubtitle">How cells extract energy from food</div>
            </div>
        </div>

        <!-- Progress Tracker -->
        <div class="progress-tracker">
            <div class="progress-header">
                <span>Energy Progress</span>
                <span class="progress-percentage" id="progressPercent">0%</span>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 0%"></div>
            </div>
            <div class="progress-steps-mini">
                <span class="step-mini active" onclick="loadJourneyStep('introduction')">Intro</span>
                <span class="step-mini" onclick="loadJourneyStep('co2_exhaled_test')">CO2</span>
                <span class="step-mini" onclick="loadJourneyStep('fermentation_demo')">Ferment</span>
                <span class="step-mini" onclick="loadJourneyStep('aerobic_respiration')">Aerobic</span>
                <span class="step-mini" onclick="loadJourneyStep('anaerobic_respiration')">Anaerobic</span>
                <span class="step-mini" onclick="loadJourneyStep('atp_production')">ATP</span>
            </div>
        </div>

        <div class="info-content" id="mainDescription">
            Cellular respiration is the process by which cells extract energy from food molecules to power all life activities. This fundamental process occurs in all living organisms and involves breaking down glucose and other nutrients to produce ATP, the universal energy currency of cells.
        </div>

        <div class="info-card">
            <div class="info-card-title">
                <span>üî¨</span> Key Concepts
            </div>
            <div class="info-card-content">
                <ul class="info-list" id="keyConcepts">
                    <li>Cells break down glucose to release energy</li>
                    <li>Aerobic respiration uses oxygen for maximum efficiency</li>
                    <li>Anaerobic respiration occurs without oxygen</li>
                    <li>ATP is the universal energy currency of cells</li>
                </ul>
            </div>
        </div>

        <div class="fun-fact">
            <div class="fun-fact-title">Energy Fact!</div>
            <div class="fun-fact-text" id="funFact">
                A single glucose molecule can yield up to 38 ATP molecules through aerobic respiration - enough energy to power thousands of cellular reactions!
            </div>
        </div>

        <div class="info-card">
            <div class="info-card-title">
                <span>üéØ</span> Learning Objectives
            </div>
            <div class="info-card-content" id="learningObjectives">
                Understand how cells extract energy from food, compare aerobic and anaerobic respiration, and explore ATP as the energy currency of life.
            </div>
        </div>
    </div>

    <!-- Voice Controls -->
    <div class="voice-controls">
        <button class="control-btn active" id="voiceToggle" onclick="toggleVoice()">
            üîä
            <span class="control-tooltip">Voice Narration</span>
        </button>
        <button class="control-btn" onclick="toggleAutoPlay()">
            ‚ñ∂Ô∏è
            <span class="control-tooltip">Auto Journey</span>
        </button>
        <button class="control-btn" onclick="toggleInfo()">
            ‚ÑπÔ∏è
            <span class="control-tooltip">Toggle Info</span>
        </button>
    </div>

    <!-- Quick Actions -->
    <div class="quick-actions">
        <button class="action-btn" onclick="startGuidedTour()">
            <span>üöÄ</span> Guided Tour
        </button>
        <button class="action-btn" onclick="showQuiz()">
            <span>üéØ</span> Test Knowledge
        </button>
    </div>

    <!-- Voice Indicator -->
    <div class="voice-indicator" id="voiceIndicator">
        <div class="voice-waves">
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
        </div>
        <div class="narration-text" id="narrationText">Narrating...</div>
    </div>

    <script>
        // Journey Step Data with Complete Pedagogical Content
        const JOURNEY_DATA = {
            introduction: {
                title: "Cellular Respiration Overview",
                subtitle: "How cells extract energy from food",
                icon: "üåü",
                modelUrl: "https://sketchfab.com/models/7445a425050e49daa881070ca6917a91/embed?autostart=1&internal=1&tracking=0&ui_ar=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "Cellular respiration is the process by which cells extract energy from food molecules to power all life activities. This fundamental process occurs in all living organisms and involves breaking down glucose and other nutrients to produce ATP, the universal energy currency of cells.",
                concepts: [
                    "Cells break down glucose to release energy",
                    "Aerobic respiration uses oxygen for maximum efficiency",
                    "Anaerobic respiration occurs without oxygen",
                    "ATP is the universal energy currency of cells"
                ],
                funFact: "A single glucose molecule can yield up to 38 ATP molecules through aerobic respiration - enough energy to power thousands of cellular reactions!",
                objectives: "Understand how cells extract energy from food, compare aerobic and anaerobic respiration, and explore ATP as the energy currency of life.",
                narration: "Welcome to the powerhouse of cellular energy production! You're looking at a mitochondrion, the cellular organelle where most of your body's energy is generated. Cellular respiration is one of the most important processes in biology - it's how every living cell, from bacteria to brain cells, extracts energy from food to power life activities. Think of it as cellular combustion, where glucose and other nutrients are carefully broken down to release the energy stored in their chemical bonds. This process is so fundamental that it happens in every cell of your body, millions of times per second. Unlike the explosive combustion of gasoline in a car engine, cellular respiration releases energy gradually and captures it in the form of ATP molecules, which serve as the universal energy currency for all cellular work."
            },
            co2_exhaled_test: {
                title: "Activity 5.4 - CO2 in Exhaled Air",
                subtitle: "Testing for respiration products",
                icon: "üí®",
                modelUrl: "https://sketchfab.com/models/6d87f6a52d79429ba8dfbc97732722c1/embed?autostart=1&internal=1&tracking=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_watermark=0",
                description: "This experiment demonstrates that cellular respiration produces carbon dioxide by testing exhaled air with lime water. When CO2 bubbles through lime water, it forms a white precipitate, proving that respiration occurs and produces carbon dioxide as a waste product.",
                concepts: [
                    "Lime water turns milky when CO2 is present",
                    "Exhaled air contains more CO2 than inhaled air",
                    "CO2 is a waste product of cellular respiration",
                    "Calcium carbonate precipitate forms in lime water"
                ],
                funFact: "You exhale about 400-500 liters of carbon dioxide every day - that's enough CO2 to fill a small closet!",
                objectives: "Conduct the lime water test to prove that cellular respiration produces carbon dioxide and understand how to detect respiration products.",
                narration: "Here we see a carbon dioxide molecule - the key product we're testing for in Activity 5.4! This simple experiment provides direct evidence that cellular respiration is happening in your body right now. When you breathe into lime water, an amazing chemical reaction occurs. The carbon dioxide in your exhaled air reacts with calcium hydroxide in the lime water to form calcium carbonate, which appears as a white, milky precipitate. This happens because your cells are constantly breaking down glucose and other nutrients, releasing CO2 as a waste product. The more active you are, the more CO2 you produce! This experiment proves that respiration isn't just breathing - it's a cellular process where cells consume oxygen and glucose while producing CO2 and water. The CO2 travels from your cells to your lungs via your bloodstream, where it's exhaled. This simple test connects the cellular process happening inside your body to something you can observe directly."
            },
            fermentation_demo: {
                title: "Activity 5.5 - Fermentation Demonstration",
                subtitle: "Anaerobic respiration in action",
                icon: "üçû",
                modelUrl: "https://sketchfab.com/3d-models/yeast-cells-c492cde0bc1d4530ba6d3e702da4ddcd/embed?autostart=1&internal=1&tracking=0&ui_ar=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "Fermentation is a type of anaerobic respiration where yeast cells break down sugar without oxygen, producing alcohol and carbon dioxide. This experiment demonstrates that respiration can occur without oxygen, though it's less efficient than aerobic respiration.",
                concepts: [
                    "Yeast performs alcoholic fermentation",
                    "Sugar is broken down without oxygen",
                    "CO2 and alcohol are produced",
                    "Less efficient than aerobic respiration"
                ],
                funFact: "Yeast fermentation is essential for making bread, beer, and wine - humans have been using this anaerobic respiration process for thousands of years!",
                objectives: "Observe fermentation in yeast to understand anaerobic respiration and compare it to aerobic processes.",
                narration: "Meet the amazing yeast cells that demonstrate anaerobic respiration in action! These single-celled fungi are masters of fermentation, a type of cellular respiration that doesn't require oxygen. In Activity 5.5, we observe how yeast cells break down sugar in the absence of oxygen. When yeast cells encounter sugar in an oxygen-free environment, they switch to fermentation mode. They break down the sugar molecules through a different pathway than aerobic respiration, producing ethyl alcohol and carbon dioxide as waste products instead of just CO2 and water. You can see the CO2 bubbling out of the solution - this is direct evidence of cellular respiration happening! While fermentation produces only 2 ATP molecules per glucose compared to 38 from aerobic respiration, it allows these cells to survive and function when oxygen isn't available. This process is identical to what happens in your muscle cells during intense exercise when oxygen runs low - they switch to fermentation, producing lactic acid instead of alcohol."
            },
            aerobic_respiration: {
                title: "Aerobic Respiration Process",
                subtitle: "Maximum energy extraction with oxygen",
                icon: "üî•",
                modelUrl: "https://sketchfab.com/models/7445a425050e49daa881070ca6917a91/embed?autostart=1&internal=1&tracking=0&ui_ar=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "Aerobic respiration is the most efficient form of cellular energy production, occurring in the mitochondria with oxygen present. This process completely breaks down glucose through glycolysis, the Krebs cycle, and electron transport, yielding up to 38 ATP molecules per glucose.",
                concepts: [
                    "Requires oxygen for complete glucose breakdown",
                    "Occurs primarily in mitochondria",
                    "Produces 36-38 ATP molecules per glucose",
                    "Complete oxidation to CO2 and water"
                ],
                funFact: "Aerobic respiration is about 19 times more efficient than anaerobic fermentation at extracting energy from glucose!",
                objectives: "Understand the complete aerobic respiration pathway and why oxygen makes energy production so much more efficient.",
                narration: "You're inside the powerhouse of the cell - the mitochondrion, where aerobic respiration reaches its peak efficiency! This remarkable organelle is where oxygen-dependent respiration occurs, and it's like a highly sophisticated energy factory. Aerobic respiration happens in three main stages: first, glycolysis breaks glucose into pyruvate in the cytoplasm. Then, in the mitochondria, the Krebs cycle completely disassembles the carbon skeleton, releasing CO2 and high-energy electrons. Finally, the electron transport chain uses oxygen as the final electron acceptor, creating a proton gradient that drives ATP synthesis. What makes aerobic respiration so efficient is that oxygen allows for the complete oxidation of glucose. Instead of the 2 ATP molecules produced by fermentation, aerobic respiration can yield up to 38 ATP molecules from a single glucose! The folded inner membrane of the mitochondrion, called cristae, provides enormous surface area for this energy production. This is why organisms with mitochondria can be so much larger and more complex than those relying only on fermentation."
            },
            anaerobic_respiration: {
                title: "Anaerobic Respiration Process",
                subtitle: "Energy production without oxygen",
                icon: "ü¶†",
                modelUrl: "https://sketchfab.com/3d-models/yeast-cells-c492cde0bc1d4530ba6d3e702da4ddcd/embed?autostart=1&internal=1&tracking=0&ui_ar=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "Anaerobic respiration occurs when oxygen is unavailable or in low supply. Cells use alternative pathways like fermentation to extract energy from glucose, though much less efficiently than aerobic respiration. This process is crucial for survival in oxygen-poor environments.",
                concepts: [
                    "Occurs without oxygen or in low-oxygen conditions",
                    "Produces only 2 ATP molecules per glucose",
                    "Results in fermentation products like alcohol or lactic acid",
                    "Essential for survival in oxygen-poor environments"
                ],
                funFact: "Your muscle cells switch to anaerobic respiration during intense exercise, producing lactic acid that causes muscle fatigue and soreness!",
                objectives: "Compare anaerobic and aerobic respiration and understand when cells use different energy production pathways.",
                narration: "These yeast cells demonstrate the remarkable ability of life to extract energy even without oxygen! Anaerobic respiration is like having a backup generator when the main power goes out. While less efficient than aerobic respiration, it's absolutely crucial for survival in many situations. When oxygen is scarce or unavailable, cells switch to fermentation pathways. In yeast, this produces alcohol and CO2. In your muscle cells during intense exercise, it produces lactic acid. The key difference is that anaerobic respiration can't completely break down glucose - it only goes through glycolysis and then converts the products to avoid toxic buildup. This yields just 2 ATP molecules instead of 38, but it's better than no energy at all! Many organisms live exclusively through anaerobic respiration. Some bacteria thrive in deep ocean vents or buried sediments where oxygen never reaches. Even in your own body, some cells in low-oxygen environments like parts of your intestines rely primarily on anaerobic respiration. This process represents one of the earliest forms of cellular energy production and is still essential for life on Earth."
            },
            atp_production: {
                title: "ATP - The Universal Energy Currency",
                subtitle: "How cells store and use energy",
                icon: "‚ö°",
                modelUrl: "https://sketchfab.com/models/83d48b9dda3d414c80b690d4651532d6/embed?autostart=1&internal=1&tracking=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_watermark=0",
                description: "ATP (Adenosine Triphosphate) is the universal energy currency used by all living cells. This molecule stores energy in its phosphate bonds and releases it when needed for cellular work like muscle contraction, active transport, and biosynthesis.",
                concepts: [
                    "ATP stores energy in phosphate bonds",
                    "Energy is released when ATP breaks down to ADP",
                    "Universal energy currency for all cellular work",
                    "Constantly recycled in living cells"
                ],
                funFact: "Your body produces and uses approximately your own body weight in ATP every single day - that's about 40-70 kg of this energy molecule!",
                objectives: "Understand the structure and function of ATP and how it serves as the energy currency for all cellular processes.",
                narration: "Behold ATP - the universal energy currency that powers every living cell on Earth! This remarkable molecule is like a rechargeable battery that stores energy in its chemical bonds and releases it on demand. ATP consists of adenine, ribose sugar, and three phosphate groups linked together. The magic happens in those phosphate bonds - when the terminal phosphate is removed, ATP becomes ADP plus a phosphate group, releasing a burst of energy that can power cellular work. What makes ATP so special is its versatility. Whether a cell needs to contract a muscle, transport materials across membranes, synthesize proteins, or perform any other energy-requiring task, ATP provides the power. It's the same energy currency whether you're a bacterium, a blade of grass, or a human being. The beauty of this system is that ATP is constantly recycled. The ADP produced when energy is used gets recharged back to ATP through cellular respiration. Your body maintains only about 250 grams of ATP at any time, but it recycles this molecule so rapidly that you produce and use roughly your own body weight in ATP every single day! This elegant system connects the energy released from food breakdown directly to the energy needed for all life processes."
            }
        };

        // Global Variables
        let currentStep = 'introduction';
        let voiceEnabled = true;
        let autoPlayEnabled = false;
        let currentSpeech = null;
        let selectedVoice = null;
        let journeyProgress = 0;
        let guidedTourActive = false;

        // Initialize Voice System
        function initVoiceSystem() {
            if (!('speechSynthesis' in window)) {
                console.warn('Speech synthesis not supported');
                voiceEnabled = false;
                document.getElementById('voiceToggle').style.display = 'none';
                return;
            }

            function loadVoices() {
                const voices = speechSynthesis.getVoices();
                if (voices.length === 0) return;

                const preferredVoices = [
                    'Google UK English Female',
                    'Microsoft Sonia',
                    'Microsoft Hazel',
                    'Samantha',
                    'Victoria'
                ];

                for (const name of preferredVoices) {
                    selectedVoice = voices.find(v => v.name.includes(name));
                    if (selectedVoice) break;
                }

                if (!selectedVoice) {
                    selectedVoice = voices.find(v => v.lang.startsWith('en'));
                }
            }

            loadVoices();
            if (speechSynthesis.onvoiceschanged !== undefined) {
                speechSynthesis.onvoiceschanged = loadVoices;
            }
        }

        // Load Journey Step
        function loadJourneyStep(stepId) {
            const stepData = JOURNEY_DATA[stepId];
            if (!stepData) return;

            currentStep = stepId;
            
            document.getElementById('api-frame').src = stepData.modelUrl;
            document.getElementById('stepIcon').textContent = stepData.icon;
            document.getElementById('stepTitle').textContent = stepData.title;
            document.getElementById('stepSubtitle').textContent = stepData.subtitle;
            document.getElementById('mainDescription').textContent = stepData.description;
            
            const conceptsList = document.getElementById('keyConcepts');
            conceptsList.innerHTML = stepData.concepts.map(c => `<li>${c}</li>`).join('');
            
            document.getElementById('funFact').textContent = stepData.funFact;
            document.getElementById('learningObjectives').textContent = stepData.objectives;
            
            updateNavigationButtons(stepId);
            updateProgress();
            
            if (voiceEnabled) {
                speakText(stepData.narration);
            }
        }

        function updateNavigationButtons(activeStep) {
            const buttons = document.querySelectorAll('.journey-btn');
            const steps = ['introduction', 'co2_exhaled_test', 'fermentation_demo', 'aerobic_respiration', 'anaerobic_respiration', 'atp_production'];
            const activeIndex = steps.indexOf(activeStep);
            
            buttons.forEach((btn, index) => {
                btn.classList.remove('active', 'completed');
                if (index < activeIndex) {
                    btn.classList.add('completed');
                } else if (index === activeIndex) {
                    btn.classList.add('active');
                }
            });
            
            const miniSteps = document.querySelectorAll('.step-mini');
            miniSteps.forEach((step, index) => {
                step.classList.remove('active', 'completed');
                if (index < activeIndex) {
                    step.classList.add('completed');
                } else if (index === activeIndex) {
                    step.classList.add('active');
                }
            });
        }

        function updateProgress() {
            const steps = ['introduction', 'co2_exhaled_test', 'fermentation_demo', 'aerobic_respiration', 'anaerobic_respiration', 'atp_production'];
            const currentIndex = steps.indexOf(currentStep);
            const progress = ((currentIndex + 1) / steps.length) * 100;
            
            document.getElementById('progressPercent').textContent = Math.round(progress) + '%';
            document.getElementById('progressFill').style.width = progress + '%';
        }

        function speakText(text) {
            if (!voiceEnabled || !text) return;
            
            stopSpeech();
            
            currentSpeech = new SpeechSynthesisUtterance(text);
            if (selectedVoice) {
                currentSpeech.voice = selectedVoice;
            }
            currentSpeech.rate = 0.9;
            currentSpeech.pitch = 1.0;
            currentSpeech.volume = 0.9;
            
            currentSpeech.onstart = () => {
                document.getElementById('voiceIndicator').classList.add('visible');
                document.getElementById('narrationText').textContent = 
                    text.substring(0, 50) + (text.length > 50 ? '...' : '');
            };
            
            currentSpeech.onend = () => {
                document.getElementById('voiceIndicator').classList.remove('visible');
                currentSpeech = null;
                
                if (guidedTourActive) {
                    setTimeout(nextStep, 2000);
                }
            };
            
            speechSynthesis.speak(currentSpeech);
        }

        function stopSpeech() {
            if (currentSpeech) {
                speechSynthesis.cancel();
                currentSpeech = null;
                document.getElementById('voiceIndicator').classList.remove('visible');
            }
        }

        function toggleVoice() {
            voiceEnabled = !voiceEnabled;
            const btn = document.getElementById('voiceToggle');
            btn.textContent = voiceEnabled ? 'üîä' : 'üîá';
            btn.classList.toggle('active', voiceEnabled);
            
            if (!voiceEnabled) {
                stopSpeech();
            }
        }

        function toggleAutoPlay() {
            autoPlayEnabled = !autoPlayEnabled;
            if (autoPlayEnabled) {
                startGuidedTour();
            } else {
                guidedTourActive = false;
            }
        }

        function toggleInfo() {
            const panel = document.getElementById('infoPanel');
            panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
        }

        function startGuidedTour() {
            guidedTourActive = true;
            const steps = ['introduction', 'co2_exhaled_test', 'fermentation_demo', 'aerobic_respiration', 'anaerobic_respiration', 'atp_production'];
            let stepIndex = 0;
            
            function tourStep() {
                if (stepIndex < steps.length && guidedTourActive) {
                    loadJourneyStep(steps[stepIndex]);
                    stepIndex++;
                } else {
                    guidedTourActive = false;
                    if (voiceEnabled) {
                        speakText("You've completed your journey through cellular respiration! You now understand how cells extract energy from food through both aerobic and anaerobic processes, and how ATP serves as the universal energy currency of life.");
                    }
                }
            }
            
            tourStep();
            window.nextStep = tourStep;
        }

        function showQuiz() {
            const questions = [
                "What does the lime water test prove about cellular respiration?",
                "How does fermentation differ from aerobic respiration?",
                "Why is aerobic respiration more efficient than anaerobic respiration?",
                "What role does ATP play in cellular energy?",
                "When do cells use anaerobic respiration instead of aerobic?"
            ];
            
            const randomQ = questions[Math.floor(Math.random() * questions.length)];
            
            if (voiceEnabled) {
                speakText(`Here's a cellular respiration question: ${randomQ} Think about the energy processes we've explored!`);
            }
        }

        function init() {
            initVoiceSystem();
            
            setTimeout(() => {
                const loading = document.getElementById('loadingOverlay');
                loading.style.opacity = '0';
                setTimeout(() => {
                    loading.style.display = 'none';
                    
                    if (voiceEnabled) {
                        speakText("Welcome to your journey through cellular respiration! We'll explore how cells extract energy from food through both experimental evidence and molecular processes. From testing exhaled gases to understanding ATP production, let's discover how life powers itself at the cellular level!");
                    }
                }, 1000);
            }, 3000);
            
            document.addEventListener('keydown', (e) => {
                switch(e.key) {
                    case 'v': toggleVoice(); break;
                    case 'i': toggleInfo(); break;
                    case 'g': startGuidedTour(); break;
                    case 'Escape': stopSpeech(); guidedTourActive = false; break;
                    case 'ArrowRight': nextStep && nextStep(); break;
                }
            });
        }

        init();
    </script>
</body>
</html>