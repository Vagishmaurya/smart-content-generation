<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Photosynthesis Experiments - Virtual Laboratory</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tween.js/18.6.4/tween.umd.js"></script>

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #27ae60 0%, #8e44ad 100%);
            color: white;
            overflow: hidden;
            position: relative;
            height: 100vh;
        }

        /* Animated Background */
        .bg-animation {
            position: fixed;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: 0;
            opacity: 0.1;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 320"><path fill="%23ffffff" fill-opacity="0.2" d="M0,96L48,112C96,128,192,160,288,186.7C384,213,480,235,576,213.3C672,192,768,128,864,128C960,128,1056,192,1152,197.3C1248,203,1344,149,1392,122.7L1440,96L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z"></path></svg>') repeat-x;
            animation: wave 10s linear infinite;
        }

        @keyframes wave {
            0% { background-position-x: 0; }
            100% { background-position-x: 1440px; }
        }

        /* Museum Interface - Compact Header */
        .museum-header {
            position: absolute;
            top: 10px;
            left: 20px;
            text-align: left;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            padding: 10px 18px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .museum-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 4px;
            background: linear-gradient(45deg, #27ae60, #8e44ad);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: titleGlow 3s ease-in-out infinite;
        }

        @keyframes titleGlow {
            0%, 100% { filter: brightness(1); }
            50% { filter: brightness(1.2); }
        }

        .exhibit-subtitle {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.8);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .experiment-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            background: #8e44ad;
            border-radius: 50%;
            animation: experiment-pulse 1.5s ease-in-out infinite;
        }

        @keyframes experiment-pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.3); opacity: 0.7; }
        }

        /* Journey Navigation - Enhanced */
        .journey-navigation {
            position: absolute;
            bottom: 20px;
            left: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            padding: 15px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            max-width: 320px;
        }

        .journey-title {
            font-size: 14px;
            font-weight: 600;
            color: #8e44ad;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .journey-steps {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }

        .journey-btn {
            background: rgba(142, 68, 173, 0.2);
            border: 1px solid rgba(142, 68, 173, 0.4);
            color: white;
            padding: 6px 10px;
            border-radius: 20px;
            font-size: 11px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 4px;
            white-space: nowrap;
        }

        .journey-btn:hover {
            background: rgba(142, 68, 173, 0.3);
            border-color: #8e44ad;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(142, 68, 173, 0.3);
        }

        .journey-btn.active {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            border-color: #e74c3c;
            box-shadow: 0 0 20px rgba(231, 76, 60, 0.5);
            animation: pulse 2s infinite;
        }

        .journey-btn.completed {
            background: rgba(52, 152, 219, 0.3);
            border-color: #3498db;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        /* 3D Model Container */
        .model-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 0;
            overflow: hidden;
            border: none;
            z-index: 100;
        }

        .sketchfab-embed-wrapper {
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #27ae60 0%, #8e44ad 100%);
        }

        .sketchfab-embed-wrapper iframe {
            width: 100%;
            height: 100%;
            border: none;
            border-radius: 0;
        }

        /* Information Panel - Enhanced */
        .info-panel {
            position: absolute;
            top: 70px;
            right: 20px;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(25px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 16px;
            padding: 24px;
            width: 380px;
            max-height: calc(100vh - 140px);
            z-index: 800;
            overflow-y: auto;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }

        .info-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        }

        .info-icon {
            font-size: 28px;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        .info-title {
            flex: 1;
        }

        .info-title h2 {
            font-size: 18px;
            color: #8e44ad;
            margin-bottom: 4px;
        }

        .info-subtitle {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.7);
        }

        .info-content {
            color: rgba(255, 255, 255, 0.9);
            font-size: 14px;
            line-height: 1.6;
        }

        /* Progress Tracker */
        .progress-tracker {
            background: linear-gradient(135deg, rgba(142, 68, 173, 0.1), rgba(39, 174, 96, 0.1));
            border: 1px solid rgba(142, 68, 173, 0.3);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 20px;
        }

        .progress-header {
            font-size: 13px;
            font-weight: 600;
            color: #8e44ad;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .progress-percentage {
            font-size: 18px;
            color: #e74c3c;
            font-weight: 700;
        }

        .progress-bar {
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 12px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #8e44ad, #27ae60);
            border-radius: 4px;
            transition: width 0.8s ease;
            box-shadow: 0 0 10px rgba(142, 68, 173, 0.5);
        }

        .progress-steps-mini {
            display: flex;
            justify-content: space-between;
            font-size: 10px;
            color: rgba(255, 255, 255, 0.6);
        }

        .step-mini {
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .step-mini.active {
            color: #e74c3c;
            font-weight: 600;
        }

        .step-mini.completed {
            color: #3498db;
        }

        /* Information Cards */
        .info-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 14px;
            margin-bottom: 14px;
        }

        .info-card-title {
            color: #8e44ad;
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .info-card-content {
            color: rgba(255, 255, 255, 0.85);
            font-size: 12px;
            line-height: 1.5;
        }

        .info-list {
            list-style: none;
            padding: 0;
        }

        .info-list li {
            padding: 6px 0;
            padding-left: 20px;
            position: relative;
            font-size: 12px;
            color: rgba(255, 255, 255, 0.8);
        }

        .info-list li:before {
            content: "→";
            position: absolute;
            left: 0;
            color: #8e44ad;
        }

        /* Fun Fact Box */
        .fun-fact {
            background: linear-gradient(135deg, rgba(39, 174, 96, 0.1), rgba(142, 68, 173, 0.1));
            border: 1px solid rgba(39, 174, 96, 0.3);
            border-radius: 12px;
            padding: 14px;
            margin: 16px 0;
            position: relative;
            overflow: hidden;
        }

        .fun-fact:before {
            content: "🔬";
            position: absolute;
            top: -20px;
            right: -20px;
            font-size: 60px;
            opacity: 0.1;
        }

        .fun-fact-title {
            color: #27ae60;
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 6px;
        }

        .fun-fact-text {
            color: rgba(255, 255, 255, 0.9);
            font-size: 12px;
            line-height: 1.5;
            position: relative;
            z-index: 1;
        }

        /* Voice Controls */
        .voice-controls {
            position: absolute;
            top: 10px;
            right: 20px;
            display: flex;
            gap: 8px;
            z-index: 1000;
        }

        .control-btn {
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            width: 44px;
            height: 44px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            position: relative;
        }

        .control-btn:hover {
            background: rgba(142, 68, 173, 0.3);
            border-color: #8e44ad;
            transform: scale(1.1);
        }

        .control-btn.active {
            background: rgba(142, 68, 173, 0.4);
            border-color: #8e44ad;
            box-shadow: 0 0 20px rgba(142, 68, 173, 0.5);
        }

        .control-tooltip {
            position: absolute;
            bottom: -30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9);
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 10px;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .control-btn:hover .control-tooltip {
            opacity: 1;
        }

        /* Loading Screen */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #27ae60 0%, #8e44ad 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            transition: opacity 1s ease;
        }

        .loading-content {
            text-align: center;
        }

        .loading-experiment {
            font-size: 60px;
            animation: experiment-bounce 2s ease-in-out infinite;
            margin-bottom: 20px;
        }

        @keyframes experiment-bounce {
            0%, 100% { transform: translateY(0) scale(1); }
            50% { transform: translateY(-10px) scale(1.1); }
        }

        .loading-text {
            color: white;
            font-size: 20px;
            margin-bottom: 20px;
        }

        .loading-progress {
            width: 200px;
            height: 4px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 2px;
            overflow: hidden;
        }

        .loading-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #8e44ad, #27ae60);
            animation: loading 2s ease-in-out infinite;
        }

        @keyframes loading {
            0% { width: 0%; }
            50% { width: 100%; }
            100% { width: 0%; }
        }

        /* Voice Indicator */
        .voice-indicator {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(142, 68, 173, 0.5);
            border-radius: 30px;
            padding: 14px 28px;
            display: flex;
            align-items: center;
            gap: 12px;
            z-index: 1000;
            opacity: 0;
            transition: all 0.3s ease;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }

        .voice-indicator.visible {
            opacity: 1;
            transform: translateX(-50%) translateY(-10px);
        }

        .voice-waves {
            display: flex;
            align-items: center;
            gap: 3px;
        }

        .voice-wave {
            width: 3px;
            height: 20px;
            background: linear-gradient(180deg, #8e44ad, #27ae60);
            border-radius: 2px;
            animation: voice-wave 1s ease-in-out infinite;
        }

        .voice-wave:nth-child(2) { animation-delay: 0.1s; }
        .voice-wave:nth-child(3) { animation-delay: 0.2s; }
        .voice-wave:nth-child(4) { animation-delay: 0.3s; }
        .voice-wave:nth-child(5) { animation-delay: 0.4s; }

        @keyframes voice-wave {
            0%, 100% { transform: scaleY(0.3); }
            50% { transform: scaleY(1); }
        }

        .narration-text {
            color: white;
            font-size: 13px;
            max-width: 300px;
        }

        /* Quick Actions */
        .quick-actions {
            position: absolute;
            bottom: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            z-index: 1000;
        }

        .action-btn {
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 10px 16px;
            border-radius: 25px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
        }

        .action-btn:hover {
            background: rgba(142, 68, 173, 0.3);
            border-color: #8e44ad;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(142, 68, 173, 0.3);
        }

        /* Custom Scrollbar */
        .info-panel::-webkit-scrollbar {
            width: 6px;
        }

        .info-panel::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 3px;
        }

        .info-panel::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, #8e44ad, #27ae60);
            border-radius: 3px;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .info-panel {
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                top: auto;
                width: 100%;
                max-height: 50vh;
                border-radius: 20px 20px 0 0;
            }
            
            .journey-navigation {
                bottom: 52vh;
                max-width: calc(100% - 40px);
            }
            
            .voice-controls {
                top: auto;
                bottom: 55vh;
                right: 10px;
            }
            
            .quick-actions {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="bg-animation"></div>

    <!-- Loading Screen -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-content">
            <div class="loading-experiment">🔬</div>
            <div class="loading-text">Setting Up Virtual Laboratory...</div>
            <div class="loading-progress">
                <div class="loading-progress-bar"></div>
            </div>
        </div>
    </div>

    <!-- Museum Header -->
    <div class="museum-header">
        <div class="museum-title">Photosynthesis Experiments</div>
        <div class="exhibit-subtitle">
            <span class="experiment-indicator"></span>
            Investigating How Plants Make Food
        </div>
    </div>

    <!-- Journey Navigation -->
    <div class="journey-navigation">
        <div class="journey-title">
            <span>🔬</span>
            <span>Laboratory Journey</span>
        </div>
        <div class="journey-steps">
            <button class="journey-btn active" onclick="loadJourneyStep('introduction')">
                <span>🌟</span> Introduction
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('variegated_leaf_test')">
                <span>🍃</span> Starch Test
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('co2_requirement_test')">
                <span>💨</span> CO2 Test
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('stomata_structure')">
                <span>🔍</span> Stomata
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('leaf_anatomy')">
                <span>📐</span> Leaf Structure
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('material_absorption')">
                <span>🌱</span> Absorption
            </button>
        </div>
    </div>

    <!-- 3D Model Container -->
    <div class="model-container">
        <div class="sketchfab-embed-wrapper">
            <iframe id="api-frame"
                    title="Photosynthesis Experiment Model" 
                    frameborder="0" 
                    allowfullscreen 
                    mozallowfullscreen="true" 
                    webkitallowfullscreen="true" 
                    allow="autoplay; fullscreen; xr-spatial-tracking"
                    xr-spatial-tracking 
                    execution-while-out-of-viewport 
                    execution-while-not-rendered 
                    web-share 
                    src="https://sketchfab.com/models/bc773c8d44cd412199a97fb16c36781c/embed?autostart=1&internal=1&tracking=0&ui_ar=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0">
            </iframe>
        </div>
    </div>

    <!-- Information Panel -->
    <div class="info-panel" id="infoPanel">
        <div class="info-header">
            <div class="info-icon" id="stepIcon">🌟</div>
            <div class="info-title">
                <h2 id="stepTitle">Welcome to the Lab</h2>
                <div class="info-subtitle" id="stepSubtitle">Investigating photosynthesis through experiments</div>
            </div>
        </div>

        <!-- Progress Tracker -->
        <div class="progress-tracker">
            <div class="progress-header">
                <span>Experiment Progress</span>
                <span class="progress-percentage" id="progressPercent">0%</span>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 0%"></div>
            </div>
            <div class="progress-steps-mini">
                <span class="step-mini active" onclick="loadJourneyStep('introduction')">Intro</span>
                <span class="step-mini" onclick="loadJourneyStep('variegated_leaf_test')">Starch</span>
                <span class="step-mini" onclick="loadJourneyStep('co2_requirement_test')">CO2</span>
                <span class="step-mini" onclick="loadJourneyStep('stomata_structure')">Stomata</span>
                <span class="step-mini" onclick="loadJourneyStep('leaf_anatomy')">Anatomy</span>
                <span class="step-mini" onclick="loadJourneyStep('material_absorption')">Absorb</span>
            </div>
        </div>

        <div class="info-content" id="mainDescription">
            Welcome to our virtual photosynthesis laboratory! Here we'll conduct classic experiments that prove how photosynthesis works. Through careful observation and scientific testing, we'll discover which parts of leaves perform photosynthesis, what materials plants need, and how leaf structure supports this vital process.
        </div>

        <div class="info-card">
            <div class="info-card-title">
                <span>🔬</span> Key Experiments
            </div>
            <div class="info-card-content">
                <ul class="info-list" id="keyConcepts">
                    <li>Variegated leaf starch test proves chlorophyll's role</li>
                    <li>CO2 requirement test shows gas dependency</li>
                    <li>Stomata examination reveals gas exchange</li>
                    <li>Leaf anatomy explains photosynthesis locations</li>
                </ul>
            </div>
        </div>

        <div class="fun-fact">
            <div class="fun-fact-title">Lab Discovery!</div>
            <div class="fun-fact-text" id="funFact">
                The iodine test for starch was first discovered in 1814 and is still used today to detect photosynthesis in plants!
            </div>
        </div>

        <div class="info-card">
            <div class="info-card-title">
                <span>🎯</span> Learning Objectives
            </div>
            <div class="info-card-content" id="learningObjectives">
                Conduct virtual experiments to understand photosynthesis requirements, examine leaf structures, and learn how plants absorb raw materials.
            </div>
        </div>
    </div>

    <!-- Voice Controls -->
    <div class="voice-controls">
        <button class="control-btn active" id="voiceToggle" onclick="toggleVoice()">
            🔊
            <span class="control-tooltip">Voice Narration</span>
        </button>
        <button class="control-btn" onclick="toggleAutoPlay()">
            ▶️
            <span class="control-tooltip">Auto Journey</span>
        </button>
        <button class="control-btn" onclick="toggleInfo()">
            ℹ️
            <span class="control-tooltip">Toggle Info</span>
        </button>
    </div>

    <!-- Quick Actions -->
    <div class="quick-actions">
        <button class="action-btn" onclick="startGuidedTour()">
            <span>🚀</span> Guided Tour
        </button>
        <button class="action-btn" onclick="showQuiz()">
            <span>🎯</span> Test Knowledge
        </button>
    </div>

    <!-- Voice Indicator -->
    <div class="voice-indicator" id="voiceIndicator">
        <div class="voice-waves">
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
        </div>
        <div class="narration-text" id="narrationText">Narrating...</div>
    </div>

    <script>
        // Journey Step Data with Complete Pedagogical Content
        const JOURNEY_DATA = {
            introduction: {
                title: "Welcome to the Lab",
                subtitle: "Investigating photosynthesis through experiments",
                icon: "🌟",
                modelUrl: "https://sketchfab.com/models/bc773c8d44cd412199a97fb16c36781c/embed?autostart=1&internal=1&tracking=0&ui_ar=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "Welcome to our virtual photosynthesis laboratory! Here we'll conduct classic experiments that prove how photosynthesis works. Through careful observation and scientific testing, we'll discover which parts of leaves perform photosynthesis, what materials plants need, and how leaf structure supports this vital process.",
                concepts: [
                    "Variegated leaf starch test proves chlorophyll's role",
                    "CO2 requirement test shows gas dependency", 
                    "Stomata examination reveals gas exchange",
                    "Leaf anatomy explains photosynthesis locations"
                ],
                funFact: "The iodine test for starch was first discovered in 1814 and is still used today to detect photosynthesis in plants!",
                objectives: "Conduct virtual experiments to understand photosynthesis requirements, examine leaf structures, and learn how plants absorb raw materials.",
                narration: "Welcome to our virtual photosynthesis laboratory! You're looking at a variegated leaf - a perfect specimen for our first experiment. This leaf has green and white patches, making it ideal for testing where photosynthesis actually occurs. In a real laboratory, scientists use careful experiments to understand how natural processes work, and today we'll follow in their footsteps. We'll conduct classic experiments that have been used for over a century to prove the requirements for photosynthesis. Through these investigations, you'll discover not just what happens during photosynthesis, but how we know it happens. Science is all about asking questions and finding evidence-based answers!"
            },
            variegated_leaf_test: {
                title: "Activity 5.1 - Variegated Leaf Starch Test",
                subtitle: "Proving chlorophyll is essential for photosynthesis",
                icon: "🍃",
                modelUrl: "https://sketchfab.com/models/bc773c8d44cd412199a97fb16c36781c/embed?autostart=1&internal=1&tracking=0&ui_ar=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "The variegated leaf starch test is a classic experiment that proves chlorophyll is essential for photosynthesis. We test for starch (the storage form of glucose) using iodine solution, which turns blue-black in the presence of starch. Only the green parts of the leaf will test positive for starch.",
                concepts: [
                    "Variegated leaves have green and white regions",
                    "Iodine solution detects starch presence",
                    "Only chlorophyll-containing areas make starch",
                    "White areas lack chlorophyll and cannot photosynthesize"
                ],
                funFact: "Variegated plants are often grown as decorative houseplants because their mixed green and white patterns are visually striking!",
                objectives: "Understand how to test for starch production and prove that chlorophyll is necessary for photosynthesis.",
                narration: "This variegated leaf is our key evidence in proving that chlorophyll is essential for photosynthesis! Notice the distinct green and white patches - the green areas contain chlorophyll while the white areas do not. In this experiment, we first place the leaf in sunlight for several hours to ensure photosynthesis has occurred. Then we remove the chlorophyll by boiling the leaf in alcohol, making it easier to see the iodine test results. When we apply iodine solution, something amazing happens - only the areas that were originally green turn blue-black, indicating starch presence. The white areas remain unchanged because they never had chlorophyll to carry out photosynthesis and therefore never produced glucose or stored it as starch. This elegant experiment provides clear visual proof that chlorophyll is absolutely necessary for photosynthesis to occur!"
            },
            co2_requirement_test: {
                title: "Activity 5.2 - Carbon Dioxide Requirement Test",
                subtitle: "Proving CO2 is needed for photosynthesis",
                icon: "💨",
                modelUrl: "https://sketchfab.com/models/0121ce17e38d4d919a2e9f9b98a69af7/embed?autostart=1&internal=1&tracking=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_watermark=0",
                description: "This experiment demonstrates that carbon dioxide is essential for photosynthesis. By placing a plant in a CO2-free environment using potassium hydroxide (which absorbs CO2), we can show that photosynthesis cannot occur without this crucial gas, even when light and water are present.",
                concepts: [
                    "Potassium hydroxide absorbs CO2 from air",
                    "Plants in CO2-free environment cannot photosynthesize",
                    "Control plant with CO2 continues photosynthesis normally",
                    "Starch test confirms results"
                ],
                funFact: "Plants actually use only about 0.04% of the carbon dioxide in the atmosphere, but this tiny amount is crucial for all life on Earth!",
                objectives: "Design controlled experiments to test the requirement of CO2 for photosynthesis and understand experimental controls.",
                narration: "This leaf cross-section helps us understand the CO2 requirement experiment at the cellular level! In this controlled experiment, we take two identical plants and place one in a sealed container with potassium hydroxide, which absorbs all the CO2 from the air. The second plant serves as our control and has access to normal air with CO2. Both plants receive the same amount of light and water. After several hours in bright light, we test both plants for starch using the iodine test. The results are striking - the plant with access to CO2 tests positive for starch, while the plant in the CO2-free environment shows no starch production, even though it had light and water! This proves that carbon dioxide is absolutely essential for photosynthesis. Without CO2, plants cannot make glucose, no matter how much light and water they have available."
            },
            stomata_structure: {
                title: "Stomata Structure and Function",
                subtitle: "Gas exchange portals in leaves",
                icon: "🔍",
                modelUrl: "https://sketchfab.com/models/00ffda2fc813426a9852abe6350332ca/embed?autostart=1&internal=1&tracking=0&ui_ar=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "Stomata are tiny pores in leaf surfaces surrounded by guard cells that control their opening and closing. These structures are crucial for photosynthesis as they allow CO2 to enter the leaf and oxygen to exit. They also regulate water loss through transpiration.",
                concepts: [
                    "Stomata are microscopic pores in leaves",
                    "Guard cells control stomatal opening",
                    "CO2 enters through stomata for photosynthesis",
                    "O2 and water vapor exit through stomata"
                ],
                funFact: "A single leaf can have between 100,000 to 1 million stomata, with most located on the underside of the leaf!",
                objectives: "Examine stomatal structure under magnification and understand how gas exchange supports photosynthesis.",
                narration: "You're looking at an incredible close-up view of a stoma - one of the most important structures for photosynthesis! This tiny pore, surrounded by two kidney-shaped guard cells, is like a smart door that opens and closes to control gas exchange. During photosynthesis, the guard cells swell with water and create an opening that allows CO2 to enter the leaf. The CO2 then travels to the chloroplast-containing cells where photosynthesis occurs. At the same time, oxygen produced by photosynthesis exits through these same pores. The guard cells are amazing because they can sense environmental conditions - they close the stomata during dry conditions to prevent water loss, and open them when the plant needs to take in CO2. Most stomata are found on the underside of leaves, which helps reduce water loss while still allowing gas exchange. Without these microscopic structures, photosynthesis simply couldn't happen!"
            },
            leaf_anatomy: {
                title: "Leaf Anatomy and Photosynthesis",
                subtitle: "Structural adaptations for light capture",
                icon: "📐",
                modelUrl: "https://sketchfab.com/models/0121ce17e38d4d919a2e9f9b98a69af7/embed?autostart=1&internal=1&tracking=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_watermark=0",
                description: "Leaf structure is perfectly adapted for photosynthesis. The upper epidermis is transparent to let light through, the palisade layer contains densely packed chloroplasts for maximum light absorption, and the spongy layer allows gas circulation. Veins transport water and nutrients throughout the leaf.",
                concepts: [
                    "Palisade layer contains most chloroplasts",
                    "Spongy layer allows gas circulation",
                    "Veins transport water and sugars",
                    "Epidermis protects and controls gas exchange"
                ],
                funFact: "The palisade layer cells are arranged like a fence (palisade) to maximize the surface area exposed to incoming sunlight!",
                objectives: "Identify leaf layers and understand how each contributes to efficient photosynthesis.",
                narration: "This cross-section reveals the incredible engineering of a leaf - every layer is perfectly designed for photosynthesis! Starting from the top, the upper epidermis is like a transparent window that lets sunlight through while protecting the inner layers. Just below is the palisade layer - notice how these elongated cells are packed tightly together like fence posts. This layer contains the highest concentration of chloroplasts and does most of the photosynthesis. The cells are arranged to capture maximum sunlight as it enters the leaf. Below that is the spongy layer, which has a completely different structure with loose, irregularly shaped cells and many air spaces. This design allows gases to circulate freely - CO2 can reach the photosynthesizing cells and oxygen can escape. The veins running through the leaf are like highways, bringing water from the roots and carrying away the glucose produced by photosynthesis. Finally, the lower epidermis contains most of the stomata for gas exchange. It's amazing how each layer has evolved to play a specific role in making photosynthesis as efficient as possible!"
            },
            material_absorption: {
                title: "Raw Material Absorption in Plants",
                subtitle: "How plants obtain photosynthesis ingredients",
                icon: "🌱",
                modelUrl: "https://sketchfab.com/models/bc773c8d44cd412199a97fb16c36781c/embed?autostart=1&internal=1&tracking=0&ui_ar=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "Plants must efficiently absorb the raw materials needed for photosynthesis. Water and minerals are absorbed by roots from soil, carbon dioxide enters through stomata in leaves, and light energy is captured by chlorophyll. The plant's transport system moves these materials to where they're needed.",
                concepts: [
                    "Roots absorb water and minerals from soil",
                    "Stomata allow CO2 to enter leaves",
                    "Chlorophyll captures light energy",
                    "Vascular system transports materials throughout plant"
                ],
                funFact: "A large tree can absorb over 100 gallons of water per day and transport it all the way from roots to leaves using only the power of evaporation!",
                objectives: "Understand how plants obtain and transport the raw materials necessary for photosynthesis.",
                narration: "This variegated leaf helps us understand how plants gather all the ingredients needed for photosynthesis! While we can see the leaf easily, remember that photosynthesis depends on materials from throughout the entire plant. Water begins its journey in the soil, where root hairs absorb it along with dissolved minerals. This water travels up through the stem via specialized tubes called xylem, eventually reaching every leaf cell. Carbon dioxide starts its journey in the atmosphere and enters the leaf through stomata - those tiny pores we examined earlier. Once inside, CO2 diffuses through the air spaces in the spongy layer to reach the photosynthesizing cells. Light energy is captured directly by chlorophyll molecules in the chloroplasts. The amazing thing is how all these materials from different sources - soil, air, and sun - come together in the chloroplasts to create glucose. Then the glucose travels back down through other tubes called phloem to feed the entire plant. It's like having a sophisticated supply chain that operates 24/7 to keep the photosynthesis factory running!"
            }
        };

        // Global Variables
        let currentStep = 'introduction';
        let voiceEnabled = true;
        let autoPlayEnabled = false;
        let currentSpeech = null;
        let selectedVoice = null;
        let journeyProgress = 0;
        let guidedTourActive = false;

        // Initialize Voice System
        function initVoiceSystem() {
            if (!('speechSynthesis' in window)) {
                console.warn('Speech synthesis not supported');
                voiceEnabled = false;
                document.getElementById('voiceToggle').style.display = 'none';
                return;
            }

            function loadVoices() {
                const voices = speechSynthesis.getVoices();
                if (voices.length === 0) return;

                const preferredVoices = [
                    'Google UK English Female',
                    'Microsoft Sonia',
                    'Microsoft Hazel',
                    'Samantha',
                    'Victoria'
                ];

                for (const name of preferredVoices) {
                    selectedVoice = voices.find(v => v.name.includes(name));
                    if (selectedVoice) break;
                }

                if (!selectedVoice) {
                    selectedVoice = voices.find(v => v.lang.startsWith('en'));
                }
            }

            loadVoices();
            if (speechSynthesis.onvoiceschanged !== undefined) {
                speechSynthesis.onvoiceschanged = loadVoices;
            }
        }

        // Load Journey Step
        function loadJourneyStep(stepId) {
            const stepData = JOURNEY_DATA[stepId];
            if (!stepData) return;

            currentStep = stepId;
            
            document.getElementById('api-frame').src = stepData.modelUrl;
            document.getElementById('stepIcon').textContent = stepData.icon;
            document.getElementById('stepTitle').textContent = stepData.title;
            document.getElementById('stepSubtitle').textContent = stepData.subtitle;
            document.getElementById('mainDescription').textContent = stepData.description;
            
            const conceptsList = document.getElementById('keyConcepts');
            conceptsList.innerHTML = stepData.concepts.map(c => `<li>${c}</li>`).join('');
            
            document.getElementById('funFact').textContent = stepData.funFact;
            document.getElementById('learningObjectives').textContent = stepData.objectives;
            
            updateNavigationButtons(stepId);
            updateProgress();
            
            if (voiceEnabled) {
                speakText(stepData.narration);
            }
        }

        function updateNavigationButtons(activeStep) {
            const buttons = document.querySelectorAll('.journey-btn');
            const steps = ['introduction', 'variegated_leaf_test', 'co2_requirement_test', 'stomata_structure', 'leaf_anatomy', 'material_absorption'];
            const activeIndex = steps.indexOf(activeStep);
            
            buttons.forEach((btn, index) => {
                btn.classList.remove('active', 'completed');
                if (index < activeIndex) {
                    btn.classList.add('completed');
                } else if (index === activeIndex) {
                    btn.classList.add('active');
                }
            });
            
            const miniSteps = document.querySelectorAll('.step-mini');
            miniSteps.forEach((step, index) => {
                step.classList.remove('active', 'completed');
                if (index < activeIndex) {
                    step.classList.add('completed');
                } else if (index === activeIndex) {
                    step.classList.add('active');
                }
            });
        }

        function updateProgress() {
            const steps = ['introduction', 'variegated_leaf_test', 'co2_requirement_test', 'stomata_structure', 'leaf_anatomy', 'material_absorption'];
            const currentIndex = steps.indexOf(currentStep);
            const progress = ((currentIndex + 1) / steps.length) * 100;
            
            document.getElementById('progressPercent').textContent = Math.round(progress) + '%';
            document.getElementById('progressFill').style.width = progress + '%';
        }

        function speakText(text) {
            if (!voiceEnabled || !text) return;
            
            stopSpeech();
            
            currentSpeech = new SpeechSynthesisUtterance(text);
            if (selectedVoice) {
                currentSpeech.voice = selectedVoice;
            }
            currentSpeech.rate = 0.9;
            currentSpeech.pitch = 1.0;
            currentSpeech.volume = 0.9;
            
            currentSpeech.onstart = () => {
                document.getElementById('voiceIndicator').classList.add('visible');
                document.getElementById('narrationText').textContent = 
                    text.substring(0, 50) + (text.length > 50 ? '...' : '');
            };
            
            currentSpeech.onend = () => {
                document.getElementById('voiceIndicator').classList.remove('visible');
                currentSpeech = null;
                
                if (guidedTourActive) {
                    setTimeout(nextStep, 2000);
                }
            };
            
            speechSynthesis.speak(currentSpeech);
        }

        function stopSpeech() {
            if (currentSpeech) {
                speechSynthesis.cancel();
                currentSpeech = null;
                document.getElementById('voiceIndicator').classList.remove('visible');
            }
        }

        function toggleVoice() {
            voiceEnabled = !voiceEnabled;
            const btn = document.getElementById('voiceToggle');
            btn.textContent = voiceEnabled ? '🔊' : '🔇';
            btn.classList.toggle('active', voiceEnabled);
            
            if (!voiceEnabled) {
                stopSpeech();
            }
        }

        function toggleAutoPlay() {
            autoPlayEnabled = !autoPlayEnabled;
            if (autoPlayEnabled) {
                startGuidedTour();
            } else {
                guidedTourActive = false;
            }
        }

        function toggleInfo() {
            const panel = document.getElementById('infoPanel');
            panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
        }

        function startGuidedTour() {
            guidedTourActive = true;
            const steps = ['introduction', 'variegated_leaf_test', 'co2_requirement_test', 'stomata_structure', 'leaf_anatomy', 'material_absorption'];
            let stepIndex = 0;
            
            function tourStep() {
                if (stepIndex < steps.length && guidedTourActive) {
                    loadJourneyStep(steps[stepIndex]);
                    stepIndex++;
                } else {
                    guidedTourActive = false;
                    if (voiceEnabled) {
                        speakText("Congratulations! You've completed all the photosynthesis experiments. You now understand how scientists prove the requirements for photosynthesis and how leaf structure supports this vital process!");
                    }
                }
            }
            
            tourStep();
            window.nextStep = tourStep;
        }

        function showQuiz() {
            const questions = [
                "What does the variegated leaf test prove about photosynthesis?",
                "Why do we use potassium hydroxide in the CO2 experiment?",
                "What is the function of stomata in photosynthesis?",
                "Which leaf layer contains the most chloroplasts?",
                "How do plants absorb the raw materials for photosynthesis?"
            ];
            
            const randomQ = questions[Math.floor(Math.random() * questions.length)];
            
            if (voiceEnabled) {
                speakText(`Here's an experimental question: ${randomQ} Think about the evidence from our experiments!`);
            }
        }

        function init() {
            initVoiceSystem();
            
            setTimeout(() => {
                const loading = document.getElementById('loadingOverlay');
                loading.style.opacity = '0';
                setTimeout(() => {
                    loading.style.display = 'none';
                    
                    if (voiceEnabled) {
                        speakText("Welcome to our virtual photosynthesis laboratory! We'll conduct classic experiments that reveal the secrets of how plants make their own food. Through careful observation and testing, you'll discover the scientific evidence behind photosynthesis. Let's start experimenting!");
                    }
                }, 1000);
            }, 3000);
            
            document.addEventListener('keydown', (e) => {
                switch(e.key) {
                    case 'v': toggleVoice(); break;
                    case 'i': toggleInfo(); break;
                    case 'g': startGuidedTour(); break;
                    case 'Escape': stopSpeech(); guidedTourActive = false; break;
                    case 'ArrowRight': nextStep && nextStep(); break;
                }
            });
        }

        init();
    </script>
</body>
</html>