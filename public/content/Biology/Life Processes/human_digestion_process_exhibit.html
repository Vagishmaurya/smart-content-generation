<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Human Digestion Process - Functional Journey</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tween.js/18.6.4/tween.umd.js"></script>

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #2980b9 0%, #8e44ad 100%);
            color: white;
            overflow: hidden;
            position: relative;
            height: 100vh;
        }

        /* Animated Background */
        .bg-animation {
            position: fixed;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: 0;
            opacity: 0.1;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 320"><path fill="%23ffffff" fill-opacity="0.2" d="M0,96L48,112C96,128,192,160,288,186.7C384,213,480,235,576,213.3C672,192,768,128,864,128C960,128,1056,192,1152,197.3C1248,203,1344,149,1392,122.7L1440,96L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z"></path></svg>') repeat-x;
            animation: wave 10s linear infinite;
        }

        @keyframes wave {
            0% { background-position-x: 0; }
            100% { background-position-x: 1440px; }
        }

        /* Museum Interface - Compact Header */
        .museum-header {
            position: absolute;
            top: 10px;
            left: 20px;
            text-align: left;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            padding: 10px 18px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .museum-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 4px;
            background: linear-gradient(45deg, #2980b9, #8e44ad);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: titleGlow 3s ease-in-out infinite;
        }

        @keyframes titleGlow {
            0%, 100% { filter: brightness(1); }
            50% { filter: brightness(1.2); }
        }

        .exhibit-subtitle {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.8);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .process-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            background: #2980b9;
            border-radius: 50%;
            animation: process-pulse 1.5s ease-in-out infinite;
        }

        @keyframes process-pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.3); opacity: 0.7; }
        }

        /* Journey Navigation - Enhanced */
        .journey-navigation {
            position: absolute;
            bottom: 20px;
            left: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            padding: 15px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            max-width: 320px;
        }

        .journey-title {
            font-size: 14px;
            font-weight: 600;
            color: #2980b9;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .journey-steps {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }

        .journey-btn {
            background: rgba(41, 128, 185, 0.2);
            border: 1px solid rgba(41, 128, 185, 0.4);
            color: white;
            padding: 6px 10px;
            border-radius: 20px;
            font-size: 11px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 4px;
            white-space: nowrap;
        }

        .journey-btn:hover {
            background: rgba(41, 128, 185, 0.3);
            border-color: #2980b9;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(41, 128, 185, 0.3);
        }

        .journey-btn.active {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            border-color: #e74c3c;
            box-shadow: 0 0 20px rgba(231, 76, 60, 0.5);
            animation: pulse 2s infinite;
        }

        .journey-btn.completed {
            background: rgba(52, 152, 219, 0.3);
            border-color: #3498db;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        /* 3D Model Container */
        .model-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 0;
            overflow: hidden;
            border: none;
            z-index: 100;
        }

        .sketchfab-embed-wrapper {
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #2980b9 0%, #8e44ad 100%);
        }

        .sketchfab-embed-wrapper iframe {
            width: 100%;
            height: 100%;
            border: none;
            border-radius: 0;
        }

        /* Information Panel - Enhanced */
        .info-panel {
            position: absolute;
            top: 70px;
            right: 20px;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(25px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 16px;
            padding: 24px;
            width: 380px;
            max-height: calc(100vh - 140px);
            z-index: 800;
            overflow-y: auto;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }

        .info-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        }

        .info-icon {
            font-size: 28px;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        .info-title {
            flex: 1;
        }

        .info-title h2 {
            font-size: 18px;
            color: #2980b9;
            margin-bottom: 4px;
        }

        .info-subtitle {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.7);
        }

        .info-content {
            color: rgba(255, 255, 255, 0.9);
            font-size: 14px;
            line-height: 1.6;
        }

        /* Progress Tracker */
        .progress-tracker {
            background: linear-gradient(135deg, rgba(41, 128, 185, 0.1), rgba(142, 68, 173, 0.1));
            border: 1px solid rgba(41, 128, 185, 0.3);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 20px;
        }

        .progress-header {
            font-size: 13px;
            font-weight: 600;
            color: #2980b9;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .progress-percentage {
            font-size: 18px;
            color: #e74c3c;
            font-weight: 700;
        }

        .progress-bar {
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 12px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #2980b9, #8e44ad);
            border-radius: 4px;
            transition: width 0.8s ease;
            box-shadow: 0 0 10px rgba(41, 128, 185, 0.5);
        }

        .progress-steps-mini {
            display: flex;
            justify-content: space-between;
            font-size: 10px;
            color: rgba(255, 255, 255, 0.6);
        }

        .step-mini {
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .step-mini.active {
            color: #e74c3c;
            font-weight: 600;
        }

        .step-mini.completed {
            color: #3498db;
        }

        /* Information Cards */
        .info-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 14px;
            margin-bottom: 14px;
        }

        .info-card-title {
            color: #2980b9;
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .info-card-content {
            color: rgba(255, 255, 255, 0.85);
            font-size: 12px;
            line-height: 1.5;
        }

        .info-list {
            list-style: none;
            padding: 0;
        }

        .info-list li {
            padding: 6px 0;
            padding-left: 20px;
            position: relative;
            font-size: 12px;
            color: rgba(255, 255, 255, 0.8);
        }

        .info-list li:before {
            content: "→";
            position: absolute;
            left: 0;
            color: #2980b9;
        }

        /* Fun Fact Box */
        .fun-fact {
            background: linear-gradient(135deg, rgba(142, 68, 173, 0.1), rgba(155, 89, 182, 0.1));
            border: 1px solid rgba(142, 68, 173, 0.3);
            border-radius: 12px;
            padding: 14px;
            margin: 16px 0;
            position: relative;
            overflow: hidden;
        }

        .fun-fact:before {
            content: "⚗️";
            position: absolute;
            top: -20px;
            right: -20px;
            font-size: 60px;
            opacity: 0.1;
        }

        .fun-fact-title {
            color: #8e44ad;
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 6px;
        }

        .fun-fact-text {
            color: rgba(255, 255, 255, 0.9);
            font-size: 12px;
            line-height: 1.5;
            position: relative;
            z-index: 1;
        }

        /* Voice Controls */
        .voice-controls {
            position: absolute;
            top: 10px;
            right: 20px;
            display: flex;
            gap: 8px;
            z-index: 1000;
        }

        .control-btn {
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            width: 44px;
            height: 44px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            position: relative;
        }

        .control-btn:hover {
            background: rgba(41, 128, 185, 0.3);
            border-color: #2980b9;
            transform: scale(1.1);
        }

        .control-btn.active {
            background: rgba(41, 128, 185, 0.4);
            border-color: #2980b9;
            box-shadow: 0 0 20px rgba(41, 128, 185, 0.5);
        }

        .control-tooltip {
            position: absolute;
            bottom: -30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9);
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 10px;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .control-btn:hover .control-tooltip {
            opacity: 1;
        }

        /* Loading Screen */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #2980b9 0%, #8e44ad 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            transition: opacity 1s ease;
        }

        .loading-content {
            text-align: center;
        }

        .loading-process {
            font-size: 60px;
            animation: process-rotation 2s ease-in-out infinite;
            margin-bottom: 20px;
        }

        @keyframes process-rotation {
            0%, 100% { transform: rotate(0deg) scale(1); }
            50% { transform: rotate(180deg) scale(1.1); }
        }

        .loading-text {
            color: white;
            font-size: 20px;
            margin-bottom: 20px;
        }

        .loading-progress {
            width: 200px;
            height: 4px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 2px;
            overflow: hidden;
        }

        .loading-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #2980b9, #8e44ad);
            animation: loading 2s ease-in-out infinite;
        }

        @keyframes loading {
            0% { width: 0%; }
            50% { width: 100%; }
            100% { width: 0%; }
        }

        /* Voice Indicator */
        .voice-indicator {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(41, 128, 185, 0.5);
            border-radius: 30px;
            padding: 14px 28px;
            display: flex;
            align-items: center;
            gap: 12px;
            z-index: 1000;
            opacity: 0;
            transition: all 0.3s ease;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }

        .voice-indicator.visible {
            opacity: 1;
            transform: translateX(-50%) translateY(-10px);
        }

        .voice-waves {
            display: flex;
            align-items: center;
            gap: 3px;
        }

        .voice-wave {
            width: 3px;
            height: 20px;
            background: linear-gradient(180deg, #2980b9, #8e44ad);
            border-radius: 2px;
            animation: voice-wave 1s ease-in-out infinite;
        }

        .voice-wave:nth-child(2) { animation-delay: 0.1s; }
        .voice-wave:nth-child(3) { animation-delay: 0.2s; }
        .voice-wave:nth-child(4) { animation-delay: 0.3s; }
        .voice-wave:nth-child(5) { animation-delay: 0.4s; }

        @keyframes voice-wave {
            0%, 100% { transform: scaleY(0.3); }
            50% { transform: scaleY(1); }
        }

        .narration-text {
            color: white;
            font-size: 13px;
            max-width: 300px;
        }

        /* Quick Actions */
        .quick-actions {
            position: absolute;
            bottom: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            z-index: 1000;
        }

        .action-btn {
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 10px 16px;
            border-radius: 25px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
        }

        .action-btn:hover {
            background: rgba(41, 128, 185, 0.3);
            border-color: #2980b9;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(41, 128, 185, 0.3);
        }

        /* Custom Scrollbar */
        .info-panel::-webkit-scrollbar {
            width: 6px;
        }

        .info-panel::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 3px;
        }

        .info-panel::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, #2980b9, #8e44ad);
            border-radius: 3px;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .info-panel {
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                top: auto;
                width: 100%;
                max-height: 50vh;
                border-radius: 20px 20px 0 0;
            }
            
            .journey-navigation {
                bottom: 52vh;
                max-width: calc(100% - 40px);
            }
            
            .voice-controls {
                top: auto;
                bottom: 55vh;
                right: 10px;
            }
            
            .quick-actions {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="bg-animation"></div>

    <!-- Loading Screen -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-content">
            <div class="loading-process">⚗️</div>
            <div class="loading-text">Exploring Digestive Processes...</div>
            <div class="loading-progress">
                <div class="loading-progress-bar"></div>
            </div>
        </div>
    </div>

    <!-- Museum Header -->
    <div class="museum-header">
        <div class="museum-title">Human Digestion Process</div>
        <div class="exhibit-subtitle">
            <span class="process-indicator"></span>
            From Food to Nutrients
        </div>
    </div>

    <!-- Journey Navigation -->
    <div class="journey-navigation">
        <div class="journey-title">
            <span>⚗️</span>
            <span>Digestive Process</span>
        </div>
        <div class="journey-steps">
            <button class="journey-btn active" onclick="loadJourneyStep('introduction')">
                <span>🌟</span> Overview
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('saliva_starch_test')">
                <span>🧪</span> Saliva Test
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('stomach_digestion')">
                <span>🫃</span> Stomach
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('pancreatic_enzymes')">
                <span>🫘</span> Pancreas
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('intestinal_absorption')">
                <span>🧬</span> Absorption
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('complete_journey')">
                <span>🔄</span> Journey
            </button>
        </div>
    </div>

    <!-- 3D Model Container -->
    <div class="model-container">
        <div class="sketchfab-embed-wrapper">
            <iframe id="api-frame"
                    title="Human Digestion Process Model" 
                    frameborder="0" 
                    allowfullscreen 
                    mozallowfullscreen="true" 
                    webkitallowfullscreen="true" 
                    allow="autoplay; fullscreen; xr-spatial-tracking"
                    xr-spatial-tracking 
                    execution-while-out-of-viewport 
                    execution-while-not-rendered 
                    web-share 
                    src="https://sketchfab.com/models/daeca5d88af14fa281f5a53b9cc4f4be/embed?autostart=1&internal=1&tracking=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0">
            </iframe>
        </div>
    </div>

    <!-- Information Panel -->
    <div class="info-panel" id="infoPanel">
        <div class="info-header">
            <div class="info-icon" id="stepIcon">🌟</div>
            <div class="info-title">
                <h2 id="stepTitle">Human Digestion Process Overview</h2>
                <div class="info-subtitle" id="stepSubtitle">Transforming food into nutrients</div>
            </div>
        </div>

        <!-- Progress Tracker -->
        <div class="progress-tracker">
            <div class="progress-header">
                <span>Process Progress</span>
                <span class="progress-percentage" id="progressPercent">0%</span>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 0%"></div>
            </div>
            <div class="progress-steps-mini">
                <span class="step-mini active" onclick="loadJourneyStep('introduction')">Intro</span>
                <span class="step-mini" onclick="loadJourneyStep('saliva_starch_test')">Saliva</span>
                <span class="step-mini" onclick="loadJourneyStep('stomach_digestion')">Stomach</span>
                <span class="step-mini" onclick="loadJourneyStep('pancreatic_enzymes')">Pancreas</span>
                <span class="step-mini" onclick="loadJourneyStep('intestinal_absorption')">Absorb</span>
                <span class="step-mini" onclick="loadJourneyStep('complete_journey')">Journey</span>
            </div>
        </div>

        <div class="info-content" id="mainDescription">
            Human digestion is a complex process that transforms food into nutrients your body can use. Through coordinated mechanical and chemical actions, the digestive system breaks down complex molecules into simple compounds that can be absorbed into the bloodstream and delivered to cells throughout the body.
        </div>

        <div class="info-card">
            <div class="info-card-title">
                <span>🔬</span> Key Processes
            </div>
            <div class="info-card-content">
                <ul class="info-list" id="keyConcepts">
                    <li>Mechanical digestion physically breaks food apart</li>
                    <li>Chemical digestion uses enzymes to break bonds</li>
                    <li>Different organs specialize in specific processes</li>
                    <li>Absorption occurs primarily in small intestine</li>
                </ul>
            </div>
        </div>

        <div class="fun-fact">
            <div class="fun-fact-title">Process Fact!</div>
            <div class="fun-fact-text" id="funFact">
                Your digestive system produces over 7 liters of digestive juices daily, containing dozens of different enzymes that work together to break down food!
            </div>
        </div>

        <div class="info-card">
            <div class="info-card-title">
                <span>🎯</span> Learning Objectives
            </div>
            <div class="info-card-content" id="learningObjectives">
                Understand how mechanical and chemical digestion work together, explore enzyme action in different regions, and learn how nutrients are absorbed.
            </div>
        </div>
    </div>

    <!-- Voice Controls -->
    <div class="voice-controls">
        <button class="control-btn active" id="voiceToggle" onclick="toggleVoice()">
            🔊
            <span class="control-tooltip">Voice Narration</span>
        </button>
        <button class="control-btn" onclick="toggleAutoPlay()">
            ▶️
            <span class="control-tooltip">Auto Journey</span>
        </button>
        <button class="control-btn" onclick="toggleInfo()">
            ℹ️
            <span class="control-tooltip">Toggle Info</span>
        </button>
    </div>

    <!-- Quick Actions -->
    <div class="quick-actions">
        <button class="action-btn" onclick="startGuidedTour()">
            <span>🚀</span> Guided Tour
        </button>
        <button class="action-btn" onclick="showQuiz()">
            <span>🎯</span> Test Knowledge
        </button>
    </div>

    <!-- Voice Indicator -->
    <div class="voice-indicator" id="voiceIndicator">
        <div class="voice-waves">
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
        </div>
        <div class="narration-text" id="narrationText">Narrating...</div>
    </div>

    <script>
        // Journey Step Data with Complete Pedagogical Content
        const JOURNEY_DATA = {
            introduction: {
                title: "Human Digestion Process Overview",
                subtitle: "Transforming food into nutrients",
                icon: "🌟",
                modelUrl: "https://sketchfab.com/models/daeca5d88af14fa281f5a53b9cc4f4be/embed?autostart=1&internal=1&tracking=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "Human digestion is a complex process that transforms food into nutrients your body can use. Through coordinated mechanical and chemical actions, the digestive system breaks down complex molecules into simple compounds that can be absorbed into the bloodstream and delivered to cells throughout the body.",
                concepts: [
                    "Mechanical digestion physically breaks food apart",
                    "Chemical digestion uses enzymes to break bonds",
                    "Different organs specialize in specific processes",
                    "Absorption occurs primarily in small intestine"
                ],
                funFact: "Your digestive system produces over 7 liters of digestive juices daily, containing dozens of different enzymes that work together to break down food!",
                objectives: "Understand how mechanical and chemical digestion work together, explore enzyme action in different regions, and learn how nutrients are absorbed.",
                narration: "Welcome to the incredible journey of human digestion! You're looking at the complete digestive system, a remarkable biological factory that transforms the food you eat into the nutrients your body needs to survive. Digestion involves two main processes working together: mechanical digestion, which physically breaks food into smaller pieces, and chemical digestion, which uses specialized enzymes to break the chemical bonds in food molecules. From the moment food enters your mouth until nutrients reach your cells, this system coordinates dozens of processes with incredible precision. Different regions specialize in breaking down specific nutrients - carbohydrates begin digestion in your mouth, proteins are attacked in your stomach, and fats are emulsified in your small intestine. Let's explore how this amazing biological assembly line works!"
            },
            saliva_starch_test: {
                title: "Activity 5.3 - Saliva Action on Starch",
                subtitle: "Testing enzyme activity in the mouth",
                icon: "🧪",
                modelUrl: "https://sketchfab.com/models/daeca5d88af14fa281f5a53b9cc4f4be/embed?autostart=1&internal=1&tracking=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "This classic experiment demonstrates how salivary amylase begins carbohydrate digestion in the mouth. By testing starch solutions with and without saliva using iodine indicator, we can observe how enzymes break down complex carbohydrates into simpler sugars, proving that chemical digestion begins before food even reaches the stomach.",
                concepts: [
                    "Salivary amylase breaks down starch into maltose",
                    "Iodine test detects presence of starch",
                    "Blue-black color indicates starch presence",
                    "Clear solution shows starch has been digested"
                ],
                funFact: "Salivary amylase is so efficient that it can begin breaking down starch within seconds of food entering your mouth, even before you swallow!",
                objectives: "Conduct the saliva-starch experiment to understand how enzymatic digestion begins in the mouth and learn to test for starch presence.",
                narration: "Let's conduct a fascinating experiment that proves digestion begins the moment food enters your mouth! In Activity 5.3, we test the action of saliva on starch to demonstrate enzymatic digestion. We start with two test tubes containing starch solution - to one we add saliva, and the other serves as our control. After allowing time for the enzyme to work, we test both solutions with iodine. The amazing result is that the tube with saliva shows no blue-black color, indicating the starch has been broken down, while the control tube remains blue-black, showing starch is still present. This happens because saliva contains amylase, an enzyme that specifically breaks the bonds in starch molecules, converting them into simpler sugars like maltose. This experiment proves that your mouth is not just for mechanical breakdown - it's also the first chemical processing station in your digestive system! The enzyme amylase is so effective that significant starch digestion occurs during the few seconds you chew and swallow food."
            },
            stomach_digestion: {
                title: "Stomach Digestion Process",
                subtitle: "Acid and enzyme action",
                icon: "🫃",
                modelUrl: "https://sketchfab.com/models/883a3c7db5df448bb88981e69ba9b7a1/embed?autostart=1&internal=1&tracking=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "The stomach creates a highly acidic environment where protein digestion begins. Hydrochloric acid denatures proteins while pepsin cleaves peptide bonds. The stomach's muscular contractions provide mechanical digestion, while its chemical environment initiates the breakdown of proteins into smaller peptides.",
                concepts: [
                    "Hydrochloric acid creates pH of 1.5-2.0",
                    "Pepsin is the main protein-digesting enzyme",
                    "Acid denatures proteins, unfolding their structure",
                    "Mucus protects stomach lining from acid damage"
                ],
                funFact: "Your stomach acid is so strong it could dissolve razor blades, yet the stomach lining replaces itself every 3-5 days to prevent damage!",
                objectives: "Understand how the stomach's acidic environment and enzymes work together to begin protein digestion.",
                narration: "Welcome to the stomach - your body's most powerful chemical processing chamber! This remarkable organ creates an environment so acidic that it could dissolve metal, yet it safely processes the food you eat every day. The stomach produces hydrochloric acid that creates a pH between 1.5 and 2.0, making it more acidic than lemon juice or vinegar. This extreme acidity serves two crucial purposes: it kills most harmful bacteria that might be in your food, and it denatures proteins by unfolding their complex three-dimensional structures. Once proteins are unfolded, the enzyme pepsin can access the peptide bonds and begin cutting the protein chains into smaller fragments called peptides. Meanwhile, the stomach's muscular walls create powerful churning motions that mechanically break food apart and mix it thoroughly with digestive juices. The stomach protects itself from this harsh environment with a thick mucus lining that's constantly renewed. After 1-4 hours of this treatment, food becomes a soupy mixture called chyme that's ready for the next stage of digestion."
            },
            pancreatic_enzymes: {
                title: "Pancreatic Enzyme Action",
                subtitle: "The digestive enzyme powerhouse",
                icon: "🫘",
                modelUrl: "https://sketchfab.com/models/8acf64dc315b49308b4fcbd47e48b92b/embed?autostart=1&internal=1&tracking=0&ui_ar=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "The pancreas produces the most comprehensive array of digestive enzymes in the body. Pancreatic juice contains enzymes for breaking down all major food components: trypsin and chymotrypsin for proteins, pancreatic amylase for carbohydrates, and lipase for fats. Bicarbonate ions neutralize stomach acid, creating the optimal pH for enzyme function.",
                concepts: [
                    "Trypsin and chymotrypsin digest proteins",
                    "Pancreatic amylase breaks down remaining starches",
                    "Lipase breaks fats into fatty acids and glycerol",
                    "Bicarbonate neutralizes stomach acid"
                ],
                funFact: "The pancreas produces over 20 different digestive enzymes, making it the most biochemically diverse organ in your digestive system!",
                objectives: "Explore how pancreatic enzymes complete the digestion of proteins, carbohydrates, and fats in the small intestine.",
                narration: "Meet the pancreas - the unsung hero of digestion and your body's most sophisticated enzyme factory! This organ produces the most comprehensive array of digestive enzymes in your entire body, with over 20 different enzymes working to break down every type of food molecule. When acidic chyme enters the small intestine from the stomach, the pancreas responds by releasing pancreatic juice containing three major types of enzymes. Trypsin and chymotrypsin continue the protein digestion that began in the stomach, breaking peptides into even smaller amino acid chains. Pancreatic amylase picks up where salivary amylase left off, completing the breakdown of starches that was interrupted by stomach acid. Most importantly, pancreatic lipase tackles fats - something no previous organ could effectively do. The pancreas also secretes bicarbonate ions that neutralize the stomach acid, creating the alkaline environment that these enzymes need to function properly. Without the pancreas, most of the food you eat would pass through your body undigested! This remarkable organ essentially completes the chemical breakdown that began in your mouth and stomach."
            },
            intestinal_absorption: {
                title: "Intestinal Absorption",
                subtitle: "Where nutrients enter the bloodstream",
                icon: "🧬",
                modelUrl: "https://sketchfab.com/models/d2c2a19dbc74493983779dd53855e338/embed?autostart=1&internal=1&tracking=0&ui_ar=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "The small intestine is the primary site of nutrient absorption, featuring specialized structures called villi and microvilli that create an enormous surface area. These finger-like projections are packed with blood vessels and lymphatic vessels that transport absorbed nutrients throughout the body.",
                concepts: [
                    "Villi increase surface area for absorption",
                    "Microvilli create the brush border",
                    "Blood vessels transport water-soluble nutrients",
                    "Lymphatic vessels transport fat-soluble nutrients"
                ],
                funFact: "The villi and microvilli in your small intestine create a surface area of about 250 square meters - roughly the size of a tennis court!",
                objectives: "Understand how the structure of intestinal villi maximizes nutrient absorption and how different nutrients enter the bloodstream.",
                narration: "You're looking at one of the most elegant examples of biological engineering - the intestinal villus! These tiny finger-like projections line the small intestine and transform it from a simple tube into an incredibly efficient absorption machine. Each villus is covered with even smaller projections called microvilli, creating what's known as the brush border. Together, these structures increase the surface area of the small intestine to about 250 square meters - roughly the size of a tennis court packed into a space about 20 feet long! Inside each villus is a network of blood capillaries and a central lymphatic vessel called a lacteal. This dual transport system is crucial because different nutrients need different routes into your body. Water-soluble nutrients like amino acids and simple sugars are absorbed directly into the blood capillaries and travel straight to the liver for processing. Fat-soluble nutrients and fat-soluble vitamins are absorbed into the lymphatic system and eventually enter the bloodstream through a different route. The entire surface of these villi is covered with specialized transport proteins that actively pump nutrients from the intestinal contents into your bloodstream, ensuring maximum absorption efficiency."
            },
            complete_journey: {
                title: "Complete Digestive Journey",
                subtitle: "From mouth to absorption",
                icon: "🔄",
                modelUrl: "https://sketchfab.com/models/daeca5d88af14fa281f5a53b9cc4f4be/embed?autostart=1&internal=1&tracking=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "The complete digestive process integrates mechanical and chemical breakdown across multiple organs. Food progresses through distinct stages: mechanical and enzymatic processing in the mouth, acid treatment in the stomach, comprehensive enzymatic digestion in the small intestine, and final absorption through the intestinal wall into the bloodstream.",
                concepts: [
                    "Each organ has specialized digestive functions",
                    "Mechanical and chemical processes work together",
                    "Enzymes are specific to different nutrients",
                    "Coordination ensures efficient nutrient extraction"
                ],
                funFact: "A meal can take 24-72 hours to complete the entire digestive journey, with most nutrients being absorbed within the first 8 hours!",
                objectives: "Integrate understanding of all digestive processes to see how the system works as a coordinated whole.",
                narration: "Now we can see the complete digestive journey as an integrated biological system! Starting in your mouth, mechanical breakdown by teeth combines with enzymatic action by salivary amylase to begin processing carbohydrates. In the stomach, powerful acid and pepsin attack proteins while muscular contractions provide continued mechanical processing. The partially digested food then enters the small intestine, where pancreatic enzymes complete the breakdown of all major nutrients - proteins, carbohydrates, and fats. Finally, the specialized absorption structures of the intestinal villi transport these nutrients into your bloodstream. What makes this system so remarkable is the coordination between all these processes. Each organ is perfectly timed and specialized for its role, and the entire system adapts to different types of food. The whole process is regulated by hormones and nerve signals that ensure digestive juices are released at exactly the right time and in the right amounts. From the moment you take a bite until nutrients reach your cells, this biological assembly line transforms complex food molecules into the simple compounds your body needs for energy, growth, and repair. It's one of the most sophisticated processing systems in the natural world!"
            }
        };

        // Global Variables
        let currentStep = 'introduction';
        let voiceEnabled = true;
        let autoPlayEnabled = false;
        let currentSpeech = null;
        let selectedVoice = null;
        let journeyProgress = 0;
        let guidedTourActive = false;

        // Initialize Voice System
        function initVoiceSystem() {
            if (!('speechSynthesis' in window)) {
                console.warn('Speech synthesis not supported');
                voiceEnabled = false;
                document.getElementById('voiceToggle').style.display = 'none';
                return;
            }

            function loadVoices() {
                const voices = speechSynthesis.getVoices();
                if (voices.length === 0) return;

                const preferredVoices = [
                    'Google UK English Female',
                    'Microsoft Sonia',
                    'Microsoft Hazel',
                    'Samantha',
                    'Victoria'
                ];

                for (const name of preferredVoices) {
                    selectedVoice = voices.find(v => v.name.includes(name));
                    if (selectedVoice) break;
                }

                if (!selectedVoice) {
                    selectedVoice = voices.find(v => v.lang.startsWith('en'));
                }
            }

            loadVoices();
            if (speechSynthesis.onvoiceschanged !== undefined) {
                speechSynthesis.onvoiceschanged = loadVoices;
            }
        }

        // Load Journey Step
        function loadJourneyStep(stepId) {
            const stepData = JOURNEY_DATA[stepId];
            if (!stepData) return;

            currentStep = stepId;
            
            document.getElementById('api-frame').src = stepData.modelUrl;
            document.getElementById('stepIcon').textContent = stepData.icon;
            document.getElementById('stepTitle').textContent = stepData.title;
            document.getElementById('stepSubtitle').textContent = stepData.subtitle;
            document.getElementById('mainDescription').textContent = stepData.description;
            
            const conceptsList = document.getElementById('keyConcepts');
            conceptsList.innerHTML = stepData.concepts.map(c => `<li>${c}</li>`).join('');
            
            document.getElementById('funFact').textContent = stepData.funFact;
            document.getElementById('learningObjectives').textContent = stepData.objectives;
            
            updateNavigationButtons(stepId);
            updateProgress();
            
            if (voiceEnabled) {
                speakText(stepData.narration);
            }
        }

        function updateNavigationButtons(activeStep) {
            const buttons = document.querySelectorAll('.journey-btn');
            const steps = ['introduction', 'saliva_starch_test', 'stomach_digestion', 'pancreatic_enzymes', 'intestinal_absorption', 'complete_journey'];
            const activeIndex = steps.indexOf(activeStep);
            
            buttons.forEach((btn, index) => {
                btn.classList.remove('active', 'completed');
                if (index < activeIndex) {
                    btn.classList.add('completed');
                } else if (index === activeIndex) {
                    btn.classList.add('active');
                }
            });
            
            const miniSteps = document.querySelectorAll('.step-mini');
            miniSteps.forEach((step, index) => {
                step.classList.remove('active', 'completed');
                if (index < activeIndex) {
                    step.classList.add('completed');
                } else if (index === activeIndex) {
                    step.classList.add('active');
                }
            });
        }

        function updateProgress() {
            const steps = ['introduction', 'saliva_starch_test', 'stomach_digestion', 'pancreatic_enzymes', 'intestinal_absorption', 'complete_journey'];
            const currentIndex = steps.indexOf(currentStep);
            const progress = ((currentIndex + 1) / steps.length) * 100;
            
            document.getElementById('progressPercent').textContent = Math.round(progress) + '%';
            document.getElementById('progressFill').style.width = progress + '%';
        }

        function speakText(text) {
            if (!voiceEnabled || !text) return;
            
            stopSpeech();
            
            currentSpeech = new SpeechSynthesisUtterance(text);
            if (selectedVoice) {
                currentSpeech.voice = selectedVoice;
            }
            currentSpeech.rate = 0.9;
            currentSpeech.pitch = 1.0;
            currentSpeech.volume = 0.9;
            
            currentSpeech.onstart = () => {
                document.getElementById('voiceIndicator').classList.add('visible');
                document.getElementById('narrationText').textContent = 
                    text.substring(0, 50) + (text.length > 50 ? '...' : '');
            };
            
            currentSpeech.onend = () => {
                document.getElementById('voiceIndicator').classList.remove('visible');
                currentSpeech = null;
                
                if (guidedTourActive) {
                    setTimeout(nextStep, 2000);
                }
            };
            
            speechSynthesis.speak(currentSpeech);
        }

        function stopSpeech() {
            if (currentSpeech) {
                speechSynthesis.cancel();
                currentSpeech = null;
                document.getElementById('voiceIndicator').classList.remove('visible');
            }
        }

        function toggleVoice() {
            voiceEnabled = !voiceEnabled;
            const btn = document.getElementById('voiceToggle');
            btn.textContent = voiceEnabled ? '🔊' : '🔇';
            btn.classList.toggle('active', voiceEnabled);
            
            if (!voiceEnabled) {
                stopSpeech();
            }
        }

        function toggleAutoPlay() {
            autoPlayEnabled = !autoPlayEnabled;
            if (autoPlayEnabled) {
                startGuidedTour();
            } else {
                guidedTourActive = false;
            }
        }

        function toggleInfo() {
            const panel = document.getElementById('infoPanel');
            panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
        }

        function startGuidedTour() {
            guidedTourActive = true;
            const steps = ['introduction', 'saliva_starch_test', 'stomach_digestion', 'pancreatic_enzymes', 'intestinal_absorption', 'complete_journey'];
            let stepIndex = 0;
            
            function tourStep() {
                if (stepIndex < steps.length && guidedTourActive) {
                    loadJourneyStep(steps[stepIndex]);
                    stepIndex++;
                } else {
                    guidedTourActive = false;
                    if (voiceEnabled) {
                        speakText("You've completed your journey through the human digestion process! You now understand how mechanical and chemical digestion work together to transform food into nutrients your body can use.");
                    }
                }
            }
            
            tourStep();
            window.nextStep = tourStep;
        }

        function showQuiz() {
            const questions = [
                "What does the saliva-starch test demonstrate about digestion?",
                "How does the stomach's acidic environment aid protein digestion?",
                "What role does the pancreas play in digestion?",
                "How do intestinal villi maximize nutrient absorption?",
                "How do mechanical and chemical digestion work together?"
            ];
            
            const randomQ = questions[Math.floor(Math.random() * questions.length)];
            
            if (voiceEnabled) {
                speakText(`Here's a digestion process question: ${randomQ} Think about the mechanisms we've explored!`);
            }
        }

        function init() {
            initVoiceSystem();
            
            setTimeout(() => {
                const loading = document.getElementById('loadingOverlay');
                loading.style.opacity = '0';
                setTimeout(() => {
                    loading.style.display = 'none';
                    
                    if (voiceEnabled) {
                        speakText("Welcome to your journey through the human digestion process! We'll explore how your body transforms food into nutrients through coordinated mechanical and chemical processes. From enzyme experiments to absorption mechanisms, let's discover how this biological factory works!");
                    }
                }, 1000);
            }, 3000);
            
            document.addEventListener('keydown', (e) => {
                switch(e.key) {
                    case 'v': toggleVoice(); break;
                    case 'i': toggleInfo(); break;
                    case 'g': startGuidedTour(); break;
                    case 'Escape': stopSpeech(); guidedTourActive = false; break;
                    case 'ArrowRight': nextStep && nextStep(); break;
                }
            });
        }

        init();
    </script>
</body>
</html>