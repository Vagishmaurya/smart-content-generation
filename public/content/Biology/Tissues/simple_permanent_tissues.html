<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Permanent Tissues - Structure and Function</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tween.js/18.6.4/tween.umd.js"></script>

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #8B4513 0%, #A0522D 100%);
            color: white;
            overflow: hidden;
            position: relative;
            height: 100vh;
        }

        /* Animated Background */
        .bg-animation {
            position: fixed;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: 0;
            opacity: 0.1;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 320"><path fill="%23ffffff" fill-opacity="0.2" d="M0,96L48,112C96,128,192,160,288,186.7C384,213,480,235,576,213.3C672,192,768,128,864,128C960,128,1056,192,1152,197.3C1248,203,1344,149,1392,122.7L1440,96L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z"></path></svg>') repeat-x;
            animation: wave 10s linear infinite;
        }

        @keyframes wave {
            0% { background-position-x: 0; }
            100% { background-position-x: 1440px; }
        }

        /* Museum Interface - Compact Header */
        .museum-header {
            position: absolute;
            top: 10px;
            left: 20px;
            text-align: left;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            padding: 10px 18px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .museum-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 4px;
            background: linear-gradient(45deg, #D2691E, #CD853F);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: titleGlow 3s ease-in-out infinite;
        }

        @keyframes titleGlow {
            0%, 100% { filter: brightness(1); }
            50% { filter: brightness(1.2); }
        }

        .exhibit-subtitle {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.8);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .structure-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            background: #D2691E;
            border-radius: 50%;
            animation: structure-pulse 2s ease-in-out infinite;
        }

        @keyframes structure-pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.3); opacity: 0.7; }
        }

        /* Journey Navigation - Enhanced */
        .journey-navigation {
            position: absolute;
            bottom: 20px;
            left: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            padding: 15px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            max-width: 280px;
        }

        .journey-title {
            font-size: 14px;
            font-weight: 600;
            color: #D2691E;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .journey-steps {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }

        .journey-btn {
            background: rgba(210, 105, 30, 0.2);
            border: 1px solid rgba(210, 105, 30, 0.4);
            color: white;
            padding: 6px 10px;
            border-radius: 20px;
            font-size: 11px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 4px;
            white-space: nowrap;
        }

        .journey-btn:hover {
            background: rgba(210, 105, 30, 0.3);
            border-color: #D2691E;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(210, 105, 30, 0.3);
        }

        .journey-btn.active {
            background: linear-gradient(135deg, #8B4513, #D2691E);
            border-color: #8B4513;
            box-shadow: 0 0 20px rgba(139, 69, 19, 0.5);
            animation: pulse 2s infinite;
        }

        .journey-btn.completed {
            background: rgba(46, 204, 113, 0.3);
            border-color: #2ecc71;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        /* 3D Model Container */
        .model-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 0;
            overflow: hidden;
            border: none;
            z-index: 100;
        }

        .sketchfab-embed-wrapper {
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #8B4513 0%, #A0522D 100%);
        }

        .sketchfab-embed-wrapper iframe {
            width: 100%;
            height: 100%;
            border: none;
            border-radius: 0;
        }

        /* Information Panel - Enhanced */
        .info-panel {
            position: absolute;
            top: 70px;
            right: 20px;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(25px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 16px;
            padding: 24px;
            width: 380px;
            max-height: calc(100vh - 140px);
            z-index: 800;
            overflow-y: auto;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }

        .info-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        }

        .info-icon {
            font-size: 28px;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        .info-title {
            flex: 1;
        }

        .info-title h2 {
            font-size: 18px;
            color: #D2691E;
            margin-bottom: 4px;
        }

        .info-subtitle {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.7);
        }

        .info-content {
            color: rgba(255, 255, 255, 0.9);
            font-size: 14px;
            line-height: 1.6;
        }

        /* Progress Tracker */
        .progress-tracker {
            background: linear-gradient(135deg, rgba(210, 105, 30, 0.1), rgba(139, 69, 19, 0.1));
            border: 1px solid rgba(210, 105, 30, 0.3);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 20px;
        }

        .progress-header {
            font-size: 13px;
            font-weight: 600;
            color: #D2691E;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .progress-percentage {
            font-size: 18px;
            color: #8B4513;
            font-weight: 700;
        }

        .progress-bar {
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 12px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #D2691E, #8B4513);
            border-radius: 4px;
            transition: width 0.8s ease;
            box-shadow: 0 0 10px rgba(139, 69, 19, 0.5);
        }

        .progress-steps-mini {
            display: flex;
            justify-content: space-between;
            font-size: 10px;
            color: rgba(255, 255, 255, 0.6);
        }

        .step-mini {
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .step-mini.active {
            color: #8B4513;
            font-weight: 600;
        }

        .step-mini.completed {
            color: #2ecc71;
        }

        /* Information Cards */
        .info-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 14px;
            margin-bottom: 14px;
        }

        .info-card-title {
            color: #D2691E;
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .info-card-content {
            color: rgba(255, 255, 255, 0.85);
            font-size: 12px;
            line-height: 1.5;
        }

        .info-list {
            list-style: none;
            padding: 0;
        }

        .info-list li {
            padding: 6px 0;
            padding-left: 20px;
            position: relative;
            font-size: 12px;
            color: rgba(255, 255, 255, 0.8);
        }

        .info-list li:before {
            content: "üî¨";
            position: absolute;
            left: 0;
            font-size: 10px;
        }

        /* Fun Fact Box */
        .fun-fact {
            background: linear-gradient(135deg, rgba(155, 89, 182, 0.1), rgba(142, 68, 173, 0.1));
            border: 1px solid rgba(155, 89, 182, 0.3);
            border-radius: 12px;
            padding: 14px;
            margin: 16px 0;
            position: relative;
            overflow: hidden;
        }

        .fun-fact:before {
            content: "üí°";
            position: absolute;
            top: -20px;
            right: -20px;
            font-size: 60px;
            opacity: 0.1;
        }

        .fun-fact-title {
            color: #9b59b6;
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 6px;
        }

        .fun-fact-text {
            color: rgba(255, 255, 255, 0.9);
            font-size: 12px;
            line-height: 1.5;
            position: relative;
            z-index: 1;
        }

        /* Voice Controls */
        .voice-controls {
            position: absolute;
            top: 10px;
            right: 20px;
            display: flex;
            gap: 8px;
            z-index: 1000;
        }

        .control-btn {
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            width: 44px;
            height: 44px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            position: relative;
        }

        .control-btn:hover {
            background: rgba(139, 69, 19, 0.3);
            border-color: #8B4513;
            transform: scale(1.1);
        }

        .control-btn.active {
            background: rgba(139, 69, 19, 0.4);
            border-color: #8B4513;
            box-shadow: 0 0 20px rgba(139, 69, 19, 0.5);
        }

        .control-tooltip {
            position: absolute;
            bottom: -30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9);
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 10px;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .control-btn:hover .control-tooltip {
            opacity: 1;
        }

        /* Loading Screen */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #8B4513 0%, #A0522D 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            transition: opacity 1s ease;
        }

        .loading-content {
            text-align: center;
        }

        .loading-structure {
            font-size: 60px;
            animation: structure-pulse 1.5s ease-in-out infinite;
            margin-bottom: 20px;
        }

        .loading-text {
            color: white;
            font-size: 20px;
            margin-bottom: 20px;
        }

        .loading-progress {
            width: 200px;
            height: 4px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 2px;
            overflow: hidden;
        }

        .loading-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #8B4513, #D2691E);
            animation: loading 2s ease-in-out infinite;
        }

        @keyframes loading {
            0% { width: 0%; }
            50% { width: 100%; }
            100% { width: 0%; }
        }

        /* Voice Indicator */
        .voice-indicator {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(139, 69, 19, 0.5);
            border-radius: 30px;
            padding: 14px 28px;
            display: flex;
            align-items: center;
            gap: 12px;
            z-index: 1000;
            opacity: 0;
            transition: all 0.3s ease;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }

        .voice-indicator.visible {
            opacity: 1;
            transform: translateX(-50%) translateY(-10px);
        }

        .voice-waves {
            display: flex;
            align-items: center;
            gap: 3px;
        }

        .voice-wave {
            width: 3px;
            height: 20px;
            background: linear-gradient(180deg, #8B4513, #D2691E);
            border-radius: 2px;
            animation: voice-wave 1s ease-in-out infinite;
        }

        .voice-wave:nth-child(2) { animation-delay: 0.1s; }
        .voice-wave:nth-child(3) { animation-delay: 0.2s; }
        .voice-wave:nth-child(4) { animation-delay: 0.3s; }
        .voice-wave:nth-child(5) { animation-delay: 0.4s; }

        @keyframes voice-wave {
            0%, 100% { transform: scaleY(0.3); }
            50% { transform: scaleY(1); }
        }

        .narration-text {
            color: white;
            font-size: 13px;
            max-width: 300px;
        }

        /* Quick Actions */
        .quick-actions {
            position: absolute;
            bottom: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            z-index: 1000;
        }

        .action-btn {
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 10px 16px;
            border-radius: 25px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
        }

        .action-btn:hover {
            background: rgba(210, 105, 30, 0.3);
            border-color: #D2691E;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(210, 105, 30, 0.3);
        }

        /* Custom Scrollbar */
        .info-panel::-webkit-scrollbar {
            width: 6px;
        }

        .info-panel::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 3px;
        }

        .info-panel::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, #8B4513, #D2691E);
            border-radius: 3px;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .info-panel {
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                top: auto;
                width: 100%;
                max-height: 50vh;
                border-radius: 20px 20px 0 0;
            }
            
            .journey-navigation {
                bottom: 52vh;
                max-width: calc(100% - 40px);
            }
            
            .voice-controls {
                top: auto;
                bottom: 55vh;
                right: 10px;
            }
            
            .quick-actions {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="bg-animation"></div>

    <!-- Loading Screen -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-content">
            <div class="loading-structure">üèóÔ∏è</div>
            <div class="loading-text">Building Your Tissue Structure Journey...</div>
            <div class="loading-progress">
                <div class="loading-progress-bar"></div>
            </div>
        </div>
    </div>

    <!-- Museum Header -->
    <div class="museum-header">
        <div class="museum-title">Simple Permanent Tissues</div>
        <div class="exhibit-subtitle">
            <span class="structure-indicator"></span>
            Structure Determines Function
        </div>
    </div>

    <!-- Journey Navigation -->
    <div class="journey-navigation">
        <div class="journey-title">
            <span>üî¨</span>
            <span>Tissue Exploration</span>
        </div>
        <div class="journey-steps">
            <button class="journey-btn active" onclick="loadJourneyStep('introduction')">
                <span>üìñ</span> Introduction
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('parenchyma')">
                <span>üß±</span> Parenchyma
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('collenchyma')">
                <span>üîÑ</span> Collenchyma
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('sclerenchyma')">
                <span>üí™</span> Sclerenchyma
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('comparison')">
                <span>‚öñÔ∏è</span> Compare
            </button>
        </div>
    </div>

    <!-- 3D Model Container -->
    <div class="model-container">
        <div class="sketchfab-embed-wrapper">
            <iframe id="api-frame"
                    title="Plant Tissue Structure" 
                    frameborder="0" 
                    allowfullscreen 
                    mozallowfullscreen="true" 
                    webkitallowfullscreen="true" 
                    allow="autoplay; fullscreen; xr-spatial-tracking"
                    xr-spatial-tracking 
                    execution-while-out-of-viewport 
                    execution-while-not-rendered 
                    web-share 
                    src="https://sketchfab.com/models/a8e93a28252c4717b50ff068a79f7c87/embed?autostart=1&internal=1&tracking=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_watermark=0">
            </iframe>
        </div>
    </div>

    <!-- Information Panel -->
    <div class="info-panel" id="infoPanel">
        <div class="info-header">
            <div class="info-icon" id="stepIcon">üìñ</div>
            <div class="info-title">
                <h2 id="stepTitle">Simple Permanent Tissues</h2>
                <div class="info-subtitle" id="stepSubtitle">From meristem to specialized function</div>
            </div>
        </div>

        <!-- Progress Tracker -->
        <div class="progress-tracker">
            <div class="progress-header">
                <span>Learning Progress</span>
                <span class="progress-percentage" id="progressPercent">0%</span>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 0%"></div>
            </div>
            <div class="progress-steps-mini">
                <span class="step-mini active" onclick="loadJourneyStep('introduction')">Intro</span>
                <span class="step-mini" onclick="loadJourneyStep('parenchyma')">Paren.</span>
                <span class="step-mini" onclick="loadJourneyStep('collenchyma')">Collen.</span>
                <span class="step-mini" onclick="loadJourneyStep('sclerenchyma')">Scleren.</span>
                <span class="step-mini" onclick="loadJourneyStep('comparison')">Compare</span>
            </div>
        </div>

        <div class="info-content" id="mainDescription">
            After meristematic cells divide and mature, they differentiate into permanent tissues. Simple permanent tissues are made of one cell type performing specific functions. The three main types - parenchyma, collenchyma, and sclerenchyma - show how structure perfectly matches function in plant biology.
        </div>

        <div class="info-card">
            <div class="info-card-title">
                <span>üî¨</span> Key Concepts
            </div>
            <div class="info-card-content">
                <ul class="info-list" id="keyConcepts">
                    <li>Permanent tissues are specialized and mature</li>
                    <li>Simple tissues have one cell type</li>
                    <li>Structure directly relates to function</li>
                    <li>Three main types with distinct roles</li>
                </ul>
            </div>
        </div>

        <div class="fun-fact">
            <div class="fun-fact-title">Structure-Function Principle</div>
            <div class="fun-fact-text" id="funFact">
                The relationship between structure and function is so fundamental in biology that you can predict a tissue's job just by looking at its cellular architecture!
            </div>
        </div>

        <div class="info-card">
            <div class="info-card-title">
                <span>üéØ</span> Learning Objectives
            </div>
            <div class="info-card-content" id="learningObjectives">
                Understand how permanent tissues develop from meristems and learn the structure-function relationships of the three simple permanent tissues.
            </div>
        </div>
    </div>

    <!-- Voice Controls -->
    <div class="voice-controls">
        <button class="control-btn active" id="voiceToggle" onclick="toggleVoice()">
            üîä
            <span class="control-tooltip">Voice Narration</span>
        </button>
        <button class="control-btn" onclick="toggleAutoPlay()">
            ‚ñ∂Ô∏è
            <span class="control-tooltip">Auto Journey</span>
        </button>
        <button class="control-btn" onclick="toggleInfo()">
            ‚ÑπÔ∏è
            <span class="control-tooltip">Toggle Info</span>
        </button>
    </div>

    <!-- Quick Actions -->
    <div class="quick-actions">
        <button class="action-btn" onclick="startGuidedTour()">
            <span>üöÄ</span> Guided Tour
        </button>
        <button class="action-btn" onclick="showQuiz()">
            <span>üéØ</span> Test Knowledge
        </button>
    </div>

    <!-- Voice Indicator -->
    <div class="voice-indicator" id="voiceIndicator">
        <div class="voice-waves">
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
        </div>
        <div class="narration-text" id="narrationText">Narrating...</div>
    </div>

    <script>
        // Journey Step Data with Complete Educational Content
        const JOURNEY_DATA = {
            introduction: {
                title: "Simple Permanent Tissues",
                subtitle: "From meristem to specialized function",
                icon: "üìñ",
                modelUrl: "https://sketchfab.com/models/a8e93a28252c4717b50ff068a79f7c87/embed?autostart=1&internal=1&tracking=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_watermark=0",
                description: "After meristematic cells divide and mature, they differentiate into permanent tissues. Simple permanent tissues are made of one cell type performing specific functions. The three main types - parenchyma, collenchyma, and sclerenchyma - show how structure perfectly matches function in plant biology.",
                concepts: [
                    "Permanent tissues are specialized and mature",
                    "Simple tissues have one cell type",
                    "Structure directly relates to function",
                    "Three main types with distinct roles"
                ],
                funFact: "The relationship between structure and function is so fundamental in biology that you can predict a tissue's job just by looking at its cellular architecture!",
                objectives: "Understand how permanent tissues develop from meristems and learn the structure-function relationships of the three simple permanent tissues.",
                narration: "Welcome to the world of simple permanent tissues! You're looking at a cross-section showing xylem and phloem tissues, which contain different types of permanent tissue cells. Once meristematic cells finish dividing, they begin a remarkable transformation - they differentiate into permanent tissues with specialized functions. Unlike meristematic cells that all look similar, permanent tissue cells develop unique structures that match their specific jobs. Simple permanent tissues are composed of just one cell type, making them easier to study and understand. The three main types - parenchyma, collenchyma, and sclerenchyma - each have distinct cellular structures that reveal their functions. This is biology's fundamental principle: structure determines function. Let's explore how each tissue type evolved the perfect cellular architecture for its role in plant survival!"
            },
            parenchyma: {
                title: "Parenchyma - The Versatile Foundation",
                subtitle: "Storage, photosynthesis, and basic functions",
                icon: "üß±",
                modelUrl: "https://sketchfab.com/models/a8e93a28252c4717b50ff068a79f7c87/embed?autostart=1&internal=1&tracking=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_watermark=0",
                description: "Parenchyma is the most abundant and versatile plant tissue. These living cells have thin walls and large vacuoles, making them perfect for storage, photosynthesis, and serving as the basic 'filling' tissue throughout the plant. They're like the plant's general-purpose workers.",
                concepts: [
                    "Thin cell walls allow flexibility",
                    "Large vacuoles for storage",
                    "Living cells that remain metabolically active",
                    "Found throughout the plant body"
                ],
                funFact: "Parenchyma cells can dedifferentiate back into meristematic cells, allowing plants to regenerate from cuttings - that's how you can grow a new plant from a leaf!",
                objectives: "Identify parenchyma structure and understand its multiple functions in plant survival and growth.",
                narration: "Meet parenchyma - the plant's swiss army knife tissue! In this xylem and phloem cross-section, you can see parenchyma cells scattered throughout, recognizable by their simple structure. Parenchyma cells are like the basic building blocks of plant tissue - they have thin, flexible cell walls and large central vacuoles that take up most of the cell space. This simple structure makes them incredibly versatile. In leaves, parenchyma cells contain chloroplasts and carry out photosynthesis. In roots and stems, they store starch, oils, and other nutrients. In fruits, they store sugars and water, making them juicy and nutritious. What's amazing about parenchyma is that these mature cells can actually reverse their development and become meristematic again - this is called dedifferentiation. This ability allows plants to heal wounds, grow new branches from cuttings, and even regenerate entire plants from small pieces. Parenchyma truly is the foundation tissue that makes plant flexibility and survival possible!"
            },
            collenchyma: {
                title: "Collenchyma - Flexible Support",
                subtitle: "Strength with flexibility for growing plants",
                icon: "üîÑ",
                modelUrl: "https://sketchfab.com/models/74ac69d9fba44d64a47f7213aaa31d61/embed?autostart=1&internal=1&tracking=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_watermark=0",
                description: "Collenchyma provides flexible support to growing plant parts. These elongated cells have unevenly thickened walls that provide strength while still allowing growth and bending. They're like plant tissue with built-in shock absorbers.",
                concepts: [
                    "Unevenly thickened cell walls",
                    "Provides flexible support",
                    "Living cells that can stretch",
                    "Common in stems and leaf veins"
                ],
                funFact: "Celery strings are actually collenchyma tissue - try pulling one and notice how it's strong but still flexible!",
                objectives: "Examine collenchyma structure and understand how it provides support while maintaining flexibility for growing plants.",
                narration: "Here's collenchyma tissue - the plant's flexible support system! Look closely at these elongated cells and notice their distinctive feature: unevenly thickened cell walls. Unlike the thin, uniform walls of parenchyma, collenchyma cells have extra cellulose deposited in patches, usually at the corners where cells meet. This uneven thickening is brilliant engineering - it provides strength and support while still allowing the tissue to stretch and bend as the plant grows. Collenchyma is found in areas where the plant needs support but must remain flexible - young stems, leaf veins, and the supports for leaves and flowers. These cells stay alive throughout their function, which means they can actively respond to the plant's changing needs. When you bend a young plant stem and it springs back instead of breaking, you're seeing collenchyma in action! The classic example is celery - those tough strings you sometimes get stuck in your teeth are collenchyma tissue providing flexible support to the celery stalk."
            },
            sclerenchyma: {
                title: "Sclerenchyma - Maximum Strength",
                subtitle: "Rigid support and protection",
                icon: "üí™",
                modelUrl: "https://sketchfab.com/models/0be9870545e847f1b1537daa15806d4d/embed?autostart=1&internal=1&tracking=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "Sclerenchyma provides maximum mechanical support with thick, lignified cell walls. These dead cells at maturity form the plant's strongest tissues, creating rigid structures like wood, bark, and the hard shells of nuts. They're the plant's reinforced concrete.",
                concepts: [
                    "Very thick, lignified cell walls",
                    "Dead at maturity for maximum strength",
                    "Forms wood, bark, and protective structures",
                    "Provides rigid, permanent support"
                ],
                funFact: "The wood in this tree trunk is mostly sclerenchyma - strong enough to support tons of weight and resist storms for decades!",
                objectives: "Analyze sclerenchyma structure and understand its role in providing maximum mechanical support and protection.",
                narration: "Welcome to sclerenchyma - the plant's ultimate strength training tissue! You're looking at a large tree stem where sclerenchyma tissue dominates the structure. Sclerenchyma cells have the thickest cell walls of any plant tissue, heavily reinforced with lignin - the same compound that makes wood hard. These cells make the ultimate sacrifice for the plant's benefit: they die at maturity, leaving behind their incredibly strong cell walls as permanent scaffolding. There are two main types of sclerenchyma: fibers, which are long and rope-like, providing tensile strength; and sclereids, which are shorter and provide compression strength. Together, they create the wood that allows trees to grow hundreds of feet tall and live for thousands of years. The lignified walls of sclerenchyma are so strong that they can support enormous weight - imagine the forces acting on a tree during a storm! This tissue also forms protective structures like the hard shells of nuts and the tough outer layers of seeds. While sclerenchyma cells can't grow or change once mature, their sacrifice creates the permanent framework that defines a plant's architecture."
            },
            comparison: {
                title: "Comparing the Three Tissues",
                subtitle: "Structure-function relationships",
                icon: "‚öñÔ∏è",
                modelUrl: "https://sketchfab.com/models/a8e93a28252c4717b50ff068a79f7c87/embed?autostart=1&internal=1&tracking=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_watermark=0",
                description: "The three simple permanent tissues represent a perfect spectrum of plant needs: parenchyma for basic functions and storage, collenchyma for flexible support during growth, and sclerenchyma for maximum strength and protection. Each evolved the ideal cellular structure for its role.",
                concepts: [
                    "Wall thickness increases from parenchyma to sclerenchyma",
                    "Flexibility decreases as strength increases",
                    "Living status relates to function",
                    "Location in plant reflects specific needs"
                ],
                funFact: "A single plant stem can contain all three tissue types working together - thin-walled parenchyma for storage, flexible collenchyma for support, and strong sclerenchyma for structure!",
                objectives: "Compare and contrast the three simple permanent tissues and understand how their structures reflect their specific functions in plant biology.",
                narration: "Now let's compare our three tissue types and see how beautifully they complement each other! Looking at this cross-section, you can see how different tissues work together in the same plant structure. Parenchyma, with its thin walls and large vacuoles, handles the basic life functions - storage, photosynthesis, and general metabolism. It's like the plant's general workforce. Collenchyma, with its unevenly thickened walls, provides the perfect compromise between strength and flexibility. It's the plant's engineering solution for growing structures that need support but must remain bendable. Sclerenchyma, with its massively thick, lignified walls, provides maximum strength and protection, though at the cost of losing cellular life. Think of these tissues as representing different life priorities: parenchyma prioritizes function and versatility, collenchyma balances support with growth, and sclerenchyma commits everything to strength and permanence. What's remarkable is that these three tissue types often work together in the same plant organ, each contributing its unique properties to create a structure that's simultaneously strong, flexible, and functional. This is tissue-level teamwork at its finest!"
            }
        };

        // Global Variables
        let currentStep = 'introduction';
        let voiceEnabled = true;
        let autoPlayEnabled = false;
        let currentSpeech = null;
        let selectedVoice = null;
        let journeyProgress = 0;
        let guidedTourActive = false;

        // Initialize Voice System
        function initVoiceSystem() {
            if (!('speechSynthesis' in window)) {
                console.warn('Speech synthesis not supported');
                voiceEnabled = false;
                document.getElementById('voiceToggle').style.display = 'none';
                return;
            }

            function loadVoices() {
                const voices = speechSynthesis.getVoices();
                if (voices.length === 0) return;

                // Prefer natural-sounding voices
                const preferredVoices = [
                    'Google UK English Female',
                    'Microsoft Sonia',
                    'Microsoft Hazel',
                    'Samantha',
                    'Victoria'
                ];

                for (const name of preferredVoices) {
                    selectedVoice = voices.find(v => v.name.includes(name));
                    if (selectedVoice) break;
                }

                if (!selectedVoice) {
                    selectedVoice = voices.find(v => v.lang.startsWith('en'));
                }
            }

            loadVoices();
            if (speechSynthesis.onvoiceschanged !== undefined) {
                speechSynthesis.onvoiceschanged = loadVoices;
            }
        }

        // Load Journey Step
        function loadJourneyStep(stepId) {
            const stepData = JOURNEY_DATA[stepId];
            if (!stepData) return;

            currentStep = stepId;
            
            // Update model
            document.getElementById('api-frame').src = stepData.modelUrl;
            
            // Update info panel
            document.getElementById('stepIcon').textContent = stepData.icon;
            document.getElementById('stepTitle').textContent = stepData.title;
            document.getElementById('stepSubtitle').textContent = stepData.subtitle;
            document.getElementById('mainDescription').textContent = stepData.description;
            
            // Update key concepts
            const conceptsList = document.getElementById('keyConcepts');
            conceptsList.innerHTML = stepData.concepts.map(c => `<li>${c}</li>`).join('');
            
            // Update fun fact
            document.getElementById('funFact').textContent = stepData.funFact;
            
            // Update learning objectives
            document.getElementById('learningObjectives').textContent = stepData.objectives;
            
            // Update navigation buttons
            updateNavigationButtons(stepId);
            
            // Update progress
            updateProgress();
            
            // Play narration if enabled
            if (voiceEnabled) {
                speakText(stepData.narration);
            }
        }

        // Update Navigation Buttons
        function updateNavigationButtons(activeStep) {
            const buttons = document.querySelectorAll('.journey-btn');
            const steps = ['introduction', 'parenchyma', 'collenchyma', 'sclerenchyma', 'comparison'];
            const activeIndex = steps.indexOf(activeStep);
            
            buttons.forEach((btn, index) => {
                btn.classList.remove('active', 'completed');
                if (index < activeIndex) {
                    btn.classList.add('completed');
                } else if (index === activeIndex) {
                    btn.classList.add('active');
                }
            });
            
            // Update mini steps
            const miniSteps = document.querySelectorAll('.step-mini');
            miniSteps.forEach((step, index) => {
                step.classList.remove('active', 'completed');
                if (index < activeIndex) {
                    step.classList.add('completed');
                } else if (index === activeIndex) {
                    step.classList.add('active');
                }
            });
        }

        // Update Progress
        function updateProgress() {
            const steps = ['introduction', 'parenchyma', 'collenchyma', 'sclerenchyma', 'comparison'];
            const currentIndex = steps.indexOf(currentStep);
            const progress = ((currentIndex + 1) / steps.length) * 100;
            
            document.getElementById('progressPercent').textContent = Math.round(progress) + '%';
            document.getElementById('progressFill').style.width = progress + '%';
        }

        // Speech Functions
        function speakText(text) {
            if (!voiceEnabled || !text) return;
            
            stopSpeech();
            
            currentSpeech = new SpeechSynthesisUtterance(text);
            if (selectedVoice) {
                currentSpeech.voice = selectedVoice;
            }
            currentSpeech.rate = 0.9;
            currentSpeech.pitch = 1.0;
            currentSpeech.volume = 0.9;
            
            currentSpeech.onstart = () => {
                document.getElementById('voiceIndicator').classList.add('visible');
                document.getElementById('narrationText').textContent = 
                    text.substring(0, 50) + (text.length > 50 ? '...' : '');
            };
            
            currentSpeech.onend = () => {
                document.getElementById('voiceIndicator').classList.remove('visible');
                currentSpeech = null;
                
                // Auto-advance if guided tour is active
                if (guidedTourActive) {
                    setTimeout(nextStep, 2000);
                }
            };
            
            speechSynthesis.speak(currentSpeech);
        }

        function stopSpeech() {
            if (currentSpeech) {
                speechSynthesis.cancel();
                currentSpeech = null;
                document.getElementById('voiceIndicator').classList.remove('visible');
            }
        }

        // Control Functions
        function toggleVoice() {
            voiceEnabled = !voiceEnabled;
            const btn = document.getElementById('voiceToggle');
            btn.textContent = voiceEnabled ? 'üîä' : 'üîá';
            btn.classList.toggle('active', voiceEnabled);
            
            if (!voiceEnabled) {
                stopSpeech();
            }
        }

        function toggleAutoPlay() {
            autoPlayEnabled = !autoPlayEnabled;
            if (autoPlayEnabled) {
                startGuidedTour();
            } else {
                guidedTourActive = false;
            }
        }

        function toggleInfo() {
            const panel = document.getElementById('infoPanel');
            panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
        }

        // Guided Tour
        function startGuidedTour() {
            guidedTourActive = true;
            const steps = ['introduction', 'parenchyma', 'collenchyma', 'sclerenchyma', 'comparison'];
            let stepIndex = 0;
            
            function tourStep() {
                if (stepIndex < steps.length && guidedTourActive) {
                    loadJourneyStep(steps[stepIndex]);
                    stepIndex++;
                } else {
                    guidedTourActive = false;
                    if (voiceEnabled) {
                        speakText("Perfect! You've mastered the three simple permanent tissues. You now understand how parenchyma provides versatility, collenchyma offers flexible support, and sclerenchyma delivers maximum strength. Structure truly determines function in plant biology!");
                    }
                }
            }
            
            tourStep();
            window.nextStep = tourStep;
        }

        // Quiz Function
        function showQuiz() {
            const questions = [
                "How does parenchyma cell structure relate to its storage function?",
                "Why do collenchyma cells have unevenly thickened walls?",
                "What advantage does sclerenchyma gain by cells dying at maturity?",
                "Which tissue would you find in a growing plant stem that needs support?",
                "How do the three simple permanent tissues work together in a plant?"
            ];
            
            const randomQ = questions[Math.floor(Math.random() * questions.length)];
            
            if (voiceEnabled) {
                speakText(`Let's test your tissue knowledge! Here's your question: ${randomQ} Think about the structure-function relationships you've learned!`);
            }
        }

        // Initialize
        function init() {
            initVoiceSystem();
            
            // Hide loading screen
            setTimeout(() => {
                const loading = document.getElementById('loadingOverlay');
                loading.style.opacity = '0';
                setTimeout(() => {
                    loading.style.display = 'none';
                    
                    // Welcome message
                    if (voiceEnabled) {
                        speakText("Welcome to your exploration of simple permanent tissues! We'll discover how parenchyma, collenchyma, and sclerenchyma each evolved perfect structures for their specific functions. Let's see how structure determines function in plant biology!");
                    }
                }, 1000);
            }, 3000);
            
            // Keyboard shortcuts
            document.addEventListener('keydown', (e) => {
                switch(e.key) {
                    case 'v': toggleVoice(); break;
                    case 'i': toggleInfo(); break;
                    case 'g': startGuidedTour(); break;
                    case 'Escape': stopSpeech(); guidedTourActive = false; break;
                    case 'ArrowRight': nextStep && nextStep(); break;
                }
            });
        }

        // Start the application
        init();
    </script>
</body>
</html>