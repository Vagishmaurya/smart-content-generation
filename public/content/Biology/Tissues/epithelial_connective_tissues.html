<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Epithelial and Connective Tissues</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tween.js/18.6.4/tween.umd.js"></script>

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #CD5C5C 0%, #F08080 100%);
            color: white;
            overflow: hidden;
            position: relative;
            height: 100vh;
        }

        /* Animated Background */
        .bg-animation {
            position: fixed;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: 0;
            opacity: 0.1;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 320"><path fill="%23ffffff" fill-opacity="0.2" d="M0,96L48,112C96,128,192,160,288,186.7C384,213,480,235,576,213.3C672,192,768,128,864,128C960,128,1056,192,1152,197.3C1248,203,1344,149,1392,122.7L1440,96L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z"></path></svg>') repeat-x;
            animation: wave 10s linear infinite;
        }

        @keyframes wave {
            0% { background-position-x: 0; }
            100% { background-position-x: 1440px; }
        }

        /* Museum Interface - Compact Header */
        .museum-header {
            position: absolute;
            top: 10px;
            left: 20px;
            text-align: left;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            padding: 10px 18px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .museum-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 4px;
            background: linear-gradient(45deg, #DC143C, #FF6347);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: titleGlow 3s ease-in-out infinite;
        }

        @keyframes titleGlow {
            0%, 100% { filter: brightness(1); }
            50% { filter: brightness(1.2); }
        }

        .exhibit-subtitle {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.8);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .tissue-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            background: #DC143C;
            border-radius: 50%;
            animation: tissue-pulse 2s ease-in-out infinite;
        }

        @keyframes tissue-pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.3); opacity: 0.7; }
        }

        /* Journey Navigation - Enhanced */
        .journey-navigation {
            position: absolute;
            bottom: 20px;
            left: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            padding: 15px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            max-width: 300px;
        }

        .journey-title {
            font-size: 14px;
            font-weight: 600;
            color: #DC143C;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .journey-steps {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }

        .journey-btn {
            background: rgba(220, 20, 60, 0.2);
            border: 1px solid rgba(220, 20, 60, 0.4);
            color: white;
            padding: 6px 10px;
            border-radius: 20px;
            font-size: 11px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 4px;
            white-space: nowrap;
        }

        .journey-btn:hover {
            background: rgba(220, 20, 60, 0.3);
            border-color: #DC143C;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(220, 20, 60, 0.3);
        }

        .journey-btn.active {
            background: linear-gradient(135deg, #CD5C5C, #DC143C);
            border-color: #CD5C5C;
            box-shadow: 0 0 20px rgba(205, 92, 92, 0.5);
            animation: pulse 2s infinite;
        }

        .journey-btn.completed {
            background: rgba(46, 204, 113, 0.3);
            border-color: #2ecc71;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        /* 3D Model Container */
        .model-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 0;
            overflow: hidden;
            border: none;
            z-index: 100;
        }

        .sketchfab-embed-wrapper {
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #CD5C5C 0%, #F08080 100%);
        }

        .sketchfab-embed-wrapper iframe {
            width: 100%;
            height: 100%;
            border: none;
            border-radius: 0;
        }

        /* Information Panel - Enhanced */
        .info-panel {
            position: absolute;
            top: 70px;
            right: 20px;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(25px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 16px;
            padding: 24px;
            width: 380px;
            max-height: calc(100vh - 140px);
            z-index: 800;
            overflow-y: auto;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }

        .info-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        }

        .info-icon {
            font-size: 28px;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        .info-title {
            flex: 1;
        }

        .info-title h2 {
            font-size: 18px;
            color: #DC143C;
            margin-bottom: 4px;
        }

        .info-subtitle {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.7);
        }

        .info-content {
            color: rgba(255, 255, 255, 0.9);
            font-size: 14px;
            line-height: 1.6;
        }

        /* Progress Tracker */
        .progress-tracker {
            background: linear-gradient(135deg, rgba(220, 20, 60, 0.1), rgba(205, 92, 92, 0.1));
            border: 1px solid rgba(220, 20, 60, 0.3);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 20px;
        }

        .progress-header {
            font-size: 13px;
            font-weight: 600;
            color: #DC143C;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .progress-percentage {
            font-size: 18px;
            color: #CD5C5C;
            font-weight: 700;
        }

        .progress-bar {
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 12px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #DC143C, #CD5C5C);
            border-radius: 4px;
            transition: width 0.8s ease;
            box-shadow: 0 0 10px rgba(205, 92, 92, 0.5);
        }

        .progress-steps-mini {
            display: flex;
            justify-content: space-between;
            font-size: 10px;
            color: rgba(255, 255, 255, 0.6);
        }

        .step-mini {
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .step-mini.active {
            color: #CD5C5C;
            font-weight: 600;
        }

        .step-mini.completed {
            color: #2ecc71;
        }

        /* Information Cards */
        .info-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 14px;
            margin-bottom: 14px;
        }

        .info-card-title {
            color: #DC143C;
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .info-card-content {
            color: rgba(255, 255, 255, 0.85);
            font-size: 12px;
            line-height: 1.5;
        }

        .info-list {
            list-style: none;
            padding: 0;
        }

        .info-list li {
            padding: 6px 0;
            padding-left: 20px;
            position: relative;
            font-size: 12px;
            color: rgba(255, 255, 255, 0.8);
        }

        .info-list li:before {
            content: "🧪";
            position: absolute;
            left: 0;
            font-size: 10px;
        }

        /* Fun Fact Box */
        .fun-fact {
            background: linear-gradient(135deg, rgba(255, 140, 0, 0.1), rgba(255, 165, 0, 0.1));
            border: 1px solid rgba(255, 140, 0, 0.3);
            border-radius: 12px;
            padding: 14px;
            margin: 16px 0;
            position: relative;
            overflow: hidden;
        }

        .fun-fact:before {
            content: "🔬";
            position: absolute;
            top: -20px;
            right: -20px;
            font-size: 60px;
            opacity: 0.1;
        }

        .fun-fact-title {
            color: #FF8C00;
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 6px;
        }

        .fun-fact-text {
            color: rgba(255, 255, 255, 0.9);
            font-size: 12px;
            line-height: 1.5;
            position: relative;
            z-index: 1;
        }

        /* Voice Controls */
        .voice-controls {
            position: absolute;
            top: 10px;
            right: 20px;
            display: flex;
            gap: 8px;
            z-index: 1000;
        }

        .control-btn {
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            width: 44px;
            height: 44px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            position: relative;
        }

        .control-btn:hover {
            background: rgba(205, 92, 92, 0.3);
            border-color: #CD5C5C;
            transform: scale(1.1);
        }

        .control-btn.active {
            background: rgba(205, 92, 92, 0.4);
            border-color: #CD5C5C;
            box-shadow: 0 0 20px rgba(205, 92, 92, 0.5);
        }

        .control-tooltip {
            position: absolute;
            bottom: -30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9);
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 10px;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .control-btn:hover .control-tooltip {
            opacity: 1;
        }

        /* Loading Screen */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #CD5C5C 0%, #F08080 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            transition: opacity 1s ease;
        }

        .loading-content {
            text-align: center;
        }

        .loading-tissue {
            font-size: 60px;
            animation: tissue-pulse 1.5s ease-in-out infinite;
            margin-bottom: 20px;
        }

        .loading-text {
            color: white;
            font-size: 20px;
            margin-bottom: 20px;
        }

        .loading-progress {
            width: 200px;
            height: 4px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 2px;
            overflow: hidden;
        }

        .loading-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #CD5C5C, #DC143C);
            animation: loading 2s ease-in-out infinite;
        }

        @keyframes loading {
            0% { width: 0%; }
            50% { width: 100%; }
            100% { width: 0%; }
        }

        /* Voice Indicator */
        .voice-indicator {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(205, 92, 92, 0.5);
            border-radius: 30px;
            padding: 14px 28px;
            display: flex;
            align-items: center;
            gap: 12px;
            z-index: 1000;
            opacity: 0;
            transition: all 0.3s ease;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }

        .voice-indicator.visible {
            opacity: 1;
            transform: translateX(-50%) translateY(-10px);
        }

        .voice-waves {
            display: flex;
            align-items: center;
            gap: 3px;
        }

        .voice-wave {
            width: 3px;
            height: 20px;
            background: linear-gradient(180deg, #CD5C5C, #DC143C);
            border-radius: 2px;
            animation: voice-wave 1s ease-in-out infinite;
        }

        .voice-wave:nth-child(2) { animation-delay: 0.1s; }
        .voice-wave:nth-child(3) { animation-delay: 0.2s; }
        .voice-wave:nth-child(4) { animation-delay: 0.3s; }
        .voice-wave:nth-child(5) { animation-delay: 0.4s; }

        @keyframes voice-wave {
            0%, 100% { transform: scaleY(0.3); }
            50% { transform: scaleY(1); }
        }

        .narration-text {
            color: white;
            font-size: 13px;
            max-width: 300px;
        }

        /* Quick Actions */
        .quick-actions {
            position: absolute;
            bottom: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            z-index: 1000;
        }

        .action-btn {
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 10px 16px;
            border-radius: 25px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
        }

        .action-btn:hover {
            background: rgba(220, 20, 60, 0.3);
            border-color: #DC143C;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(220, 20, 60, 0.3);
        }

        /* Custom Scrollbar */
        .info-panel::-webkit-scrollbar {
            width: 6px;
        }

        .info-panel::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 3px;
        }

        .info-panel::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, #CD5C5C, #DC143C);
            border-radius: 3px;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .info-panel {
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                top: auto;
                width: 100%;
                max-height: 50vh;
                border-radius: 20px 20px 0 0;
            }
            
            .journey-navigation {
                bottom: 52vh;
                max-width: calc(100% - 40px);
            }
            
            .voice-controls {
                top: auto;
                bottom: 55vh;
                right: 10px;
            }
            
            .quick-actions {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="bg-animation"></div>

    <!-- Loading Screen -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-content">
            <div class="loading-tissue">🧬</div>
            <div class="loading-text">Exploring Human Tissue Architecture...</div>
            <div class="loading-progress">
                <div class="loading-progress-bar"></div>
            </div>
        </div>
    </div>

    <!-- Museum Header -->
    <div class="museum-header">
        <div class="museum-title">Epithelial & Connective Tissues</div>
        <div class="exhibit-subtitle">
            <span class="tissue-indicator"></span>
            Covering, Lining, and Supporting Life
        </div>
    </div>

    <!-- Journey Navigation -->
    <div class="journey-navigation">
        <div class="journey-title">
            <span>🧬</span>
            <span>Tissue Exploration</span>
        </div>
        <div class="journey-steps">
            <button class="journey-btn active" onclick="loadJourneyStep('introduction')">
                <span>📖</span> Overview
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('squamous')">
                <span>⚪</span> Squamous
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('cuboidal')">
                <span>🟫</span> Cuboidal
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('columnar')">
                <span>📏</span> Columnar
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('connective')">
                <span>🕸️</span> Connective
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('bone')">
                <span>🦴</span> Bone
            </button>
        </div>
    </div>

    <!-- 3D Model Container -->
    <div class="model-container">
        <div class="sketchfab-embed-wrapper">
            <iframe id="api-frame"
                    title="Human Tissue Structure" 
                    frameborder="0" 
                    allowfullscreen 
                    mozallowfullscreen="true" 
                    webkitallowfullscreen="true" 
                    allow="autoplay; fullscreen; xr-spatial-tracking"
                    xr-spatial-tracking 
                    execution-while-out-of-viewport 
                    execution-while-not-rendered 
                    web-share 
                    src="https://sketchfab.com/models/285c366b121e45b99157c418eea6e7fc/embed?autostart=1&internal=1&tracking=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0">
            </iframe>
        </div>
    </div>

    <!-- Information Panel -->
    <div class="info-panel" id="infoPanel">
        <div class="info-header">
            <div class="info-icon" id="stepIcon">📖</div>
            <div class="info-title">
                <h2 id="stepTitle">Epithelial and Connective Tissues</h2>
                <div class="info-subtitle" id="stepSubtitle">The body's covering and supporting systems</div>
            </div>
        </div>

        <!-- Progress Tracker -->
        <div class="progress-tracker">
            <div class="progress-header">
                <span>Tissue Mastery</span>
                <span class="progress-percentage" id="progressPercent">0%</span>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 0%"></div>
            </div>
            <div class="progress-steps-mini">
                <span class="step-mini active" onclick="loadJourneyStep('introduction')">Intro</span>
                <span class="step-mini" onclick="loadJourneyStep('squamous')">Squam.</span>
                <span class="step-mini" onclick="loadJourneyStep('cuboidal')">Cuboid.</span>
                <span class="step-mini" onclick="loadJourneyStep('columnar')">Colum.</span>
                <span class="step-mini" onclick="loadJourneyStep('connective')">Connect.</span>
                <span class="step-mini" onclick="loadJourneyStep('bone')">Bone</span>
            </div>
        </div>

        <div class="info-content" id="mainDescription">
            Epithelial and connective tissues are fundamental building blocks of the human body. Epithelial tissues form protective barriers and line body surfaces, while connective tissues provide support, protection, and connection between other tissues. Together, they create the structural foundation for all body functions.
        </div>

        <div class="info-card">
            <div class="info-card-title">
                <span>🧪</span> Key Concepts
            </div>
            <div class="info-card-content">
                <ul class="info-list" id="keyConcepts">
                    <li>Epithelial tissues cover and line body surfaces</li>
                    <li>Shape determines function in epithelial cells</li>
                    <li>Connective tissues support and connect</li>
                    <li>Matrix composition defines connective properties</li>
                </ul>
            </div>
        </div>

        <div class="fun-fact">
            <div class="fun-fact-title">Body Architecture</div>
            <div class="fun-fact-text" id="funFact">
                Your body replaces its entire epithelial lining every few days to weeks, while some connective tissues like bone constantly remodel throughout your lifetime!
            </div>
        </div>

        <div class="info-card">
            <div class="info-card-title">
                <span>🎯</span> Learning Objectives
            </div>
            <div class="info-card-content" id="learningObjectives">
                Understand the structure and function of epithelial tissue types and learn how connective tissue components work together to support body functions.
            </div>
        </div>
    </div>

    <!-- Voice Controls -->
    <div class="voice-controls">
        <button class="control-btn active" id="voiceToggle" onclick="toggleVoice()">
            🔊
            <span class="control-tooltip">Voice Narration</span>
        </button>
        <button class="control-btn" onclick="toggleAutoPlay()">
            ▶️
            <span class="control-tooltip">Auto Journey</span>
        </button>
        <button class="control-btn" onclick="toggleInfo()">
            ℹ️
            <span class="control-tooltip">Toggle Info</span>
        </button>
    </div>

    <!-- Quick Actions -->
    <div class="quick-actions">
        <button class="action-btn" onclick="startGuidedTour()">
            <span>🚀</span> Guided Tour
        </button>
        <button class="action-btn" onclick="showQuiz()">
            <span>🎯</span> Test Knowledge
        </button>
    </div>

    <!-- Voice Indicator -->
    <div class="voice-indicator" id="voiceIndicator">
        <div class="voice-waves">
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
        </div>
        <div class="narration-text" id="narrationText">Narrating...</div>
    </div>

    <script>
        // Journey Step Data with Complete Educational Content
        const JOURNEY_DATA = {
            introduction: {
                title: "Epithelial and Connective Tissues",
                subtitle: "The body's covering and supporting systems",
                icon: "📖",
                modelUrl: "https://sketchfab.com/models/285c366b121e45b99157c418eea6e7fc/embed?autostart=1&internal=1&tracking=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "Epithelial and connective tissues are fundamental building blocks of the human body. Epithelial tissues form protective barriers and line body surfaces, while connective tissues provide support, protection, and connection between other tissues. Together, they create the structural foundation for all body functions.",
                concepts: [
                    "Epithelial tissues cover and line body surfaces",
                    "Shape determines function in epithelial cells",
                    "Connective tissues support and connect",
                    "Matrix composition defines connective properties"
                ],
                funFact: "Your body replaces its entire epithelial lining every few days to weeks, while some connective tissues like bone constantly remodel throughout your lifetime!",
                objectives: "Understand the structure and function of epithelial tissue types and learn how connective tissue components work together to support body functions.",
                narration: "Welcome to the foundational world of human tissues! You're viewing different types of epithelial tissues that form the body's protective barriers and internal linings. Epithelial tissues are like the body's wallpaper and flooring - they cover every surface, both inside and outside your body. From your skin protecting you from the environment to the delicate lining of your lungs allowing gas exchange, epithelial tissues are specialized for coverage, protection, secretion, and absorption. These tissues have no blood vessels of their own and must receive nutrients from underlying connective tissues. Connective tissues, in contrast, are the body's support network - they connect, support, and protect other tissues. Unlike epithelial tissues that form continuous sheets, connective tissues are characterized by having cells scattered within an extracellular matrix. This matrix, composed of fibers and ground substance, gives each connective tissue its unique properties. Together, these tissue types create the architectural framework that makes complex multicellular life possible."
            },
            squamous: {
                title: "Simple Squamous Epithelium",
                subtitle: "Thin and flat for efficient exchange",
                icon: "⚪",
                modelUrl: "https://sketchfab.com/models/285c366b121e45b99157c418eea6e7fc/embed?autostart=1&internal=1&tracking=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "Simple squamous epithelium consists of a single layer of flat, scale-like cells. This tissue is specialized for rapid diffusion and filtration, making it perfect for locations where substances need to pass through quickly, such as the alveoli of lungs and the filtration membranes of kidneys.",
                concepts: [
                    "Single layer of flat, scale-like cells",
                    "Nuclei appear flattened and oval",
                    "Specialized for diffusion and filtration",
                    "Found in lungs, blood vessels, and kidneys"
                ],
                funFact: "The alveoli in your lungs are lined with squamous epithelium so thin that oxygen and carbon dioxide can diffuse across in milliseconds!",
                objectives: "Identify simple squamous epithelium and understand how its flat structure enables rapid molecular exchange.",
                narration: "Here we see simple squamous epithelium - the body's specialist in rapid exchange! Look at these remarkably thin, flat cells that resemble fried eggs when viewed from above, or appear as thin lines in cross-section. The name 'squamous' comes from the Latin word for scale, because these cells look like fish scales overlapping each other. The thinness of these cells is their superpower - they're perfectly designed for situations where substances need to pass through quickly. In your lungs, squamous epithelium in the alveoli is so thin that it takes less than a second for oxygen to pass from the air into your blood. In your kidneys, this tissue forms the filtration barrier that allows waste products to be removed from your blood while keeping important proteins and cells inside. The flat shape also reduces the distance molecules must travel, making diffusion incredibly efficient. Blood vessel linings also use this tissue type to allow nutrients and waste products to easily pass between the blood and surrounding tissues."
            },
            cuboidal: {
                title: "Simple Cuboidal Epithelium",
                subtitle: "Cube-shaped cells for secretion and absorption",
                icon: "🟫",
                modelUrl: "https://sketchfab.com/models/285c366b121e45b99157c418eea6e7fc/embed?autostart=1&internal=1&tracking=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "Simple cuboidal epithelium features cube-shaped cells arranged in a single layer. These cells are workhorses of secretion and absorption, containing numerous organelles to support their metabolic activities. They line kidney tubules, glands, and other structures where active transport occurs.",
                concepts: [
                    "Cube-shaped cells in single layer",
                    "Round, centrally located nuclei",
                    "Rich in organelles for active functions",
                    "Specialized for secretion and absorption"
                ],
                funFact: "Cuboidal cells in your kidney tubules can completely reabsorb about 99% of the water that initially enters the filtrate!",
                objectives: "Examine cuboidal epithelium structure and understand its role in secretion and selective absorption processes.",
                narration: "Now we're examining simple cuboidal epithelium - the body's active transport specialists! These cube-shaped cells are like tiny factories, packed with organelles to power their demanding jobs. Notice how each cell is roughly as tall as it is wide, with a round nucleus positioned right in the center. This shape provides much more cytoplasm than the thin squamous cells, allowing space for all the organelles needed for active cellular work. Cuboidal epithelium is found wherever the body needs to actively move substances across tissue barriers. In your kidneys, these cells line the tubules where they selectively reabsorb important substances like glucose, amino acids, and most of the water from the initial filtrate, while allowing waste products to continue toward elimination. In glands like your thyroid, cuboidal cells manufacture and secrete hormones. The abundant cytoplasm houses mitochondria for energy, endoplasmic reticulum for protein synthesis, and Golgi apparatus for processing and packaging secretions. This tissue type represents the perfect balance between structural strength and functional versatility."
            },
            columnar: {
                title: "Simple Columnar Epithelium",
                subtitle: "Tall cells for absorption and secretion",
                icon: "📏",
                modelUrl: "https://sketchfab.com/models/285c366b121e45b99157c418eea6e7fc/embed?autostart=1&internal=1&tracking=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "Simple columnar epithelium consists of tall, column-like cells that are taller than they are wide. Often featuring microvilli or cilia, these cells excel at absorption and secretion. They line the digestive tract and respiratory passages where maximum surface area and specialized functions are needed.",
                concepts: [
                    "Tall, column-like cells in single layer",
                    "Often have microvilli or cilia",
                    "Oval nuclei near cell base",
                    "Maximum surface area for absorption"
                ],
                funFact: "The microvilli on columnar cells in your small intestine increase the absorptive surface area by about 600 times!",
                objectives: "Analyze columnar epithelium and understand how cell height and surface modifications enhance absorption and secretion.",
                narration: "Here's simple columnar epithelium - the body's absorption and secretion champions! These tall, rectangular cells are like skyscrapers in the tissue world, providing maximum surface area for their specialized functions. Notice how these cells are much taller than they are wide, with their oval-shaped nuclei typically positioned near the base of the cell. This arrangement leaves the upper portion of the cell free for specialized structures and functions. Many columnar cells feature microvilli - tiny projections that look like bristles on a brush - which dramatically increase the surface area available for absorption. In your small intestine, these microvilli are so numerous they're called the 'brush border,' and they're essential for absorbing nutrients from your food. Some columnar cells have cilia instead of microvilli - these are longer, hair-like projections that beat in coordinated waves to move substances along. In your respiratory tract, ciliated columnar epithelium moves mucus upward to clear particles and pathogens from your lungs. The tall shape of these cells also provides plenty of space for organelles involved in secretion, making them perfect for producing digestive enzymes and protective mucus."
            },
            connective: {
                title: "Connective Tissue Elements",
                subtitle: "Matrix fibers and cellular components",
                icon: "🕸️",
                modelUrl: "https://sketchfab.com/models/d1395e3520864214852df08a0daaa338/embed?autostart=1&internal=1&tracking=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "Connective tissue consists of cells scattered within an extracellular matrix containing collagen, elastin, and reticulin fibers. This matrix composition determines the tissue's properties - from the flexibility of loose connective tissue to the strength of tendons and the elasticity of blood vessel walls.",
                concepts: [
                    "Cells scattered in extracellular matrix",
                    "Collagen provides tensile strength",
                    "Elastin allows stretch and recoil",
                    "Reticulin forms delicate support networks"
                ],
                funFact: "Collagen is the most abundant protein in your body, making up about 30% of all your body's proteins and providing strength to everything from skin to bones!",
                objectives: "Identify connective tissue components and understand how matrix composition determines tissue properties and function.",
                narration: "Welcome to the intricate world of connective tissue components! You're viewing the complex architecture that gives connective tissues their remarkable properties. Unlike epithelial tissues where cells are tightly packed together, connective tissues feature cells scattered throughout an extracellular matrix - and it's this matrix that really defines what the tissue can do. The three main fiber types each contribute unique properties: Collagen fibers are like steel cables, providing incredible tensile strength and resistance to stretching. These thick, rope-like fibers are what make your skin tough and help your tendons transfer muscle force to bones. Elastin fibers are like rubber bands, allowing tissues to stretch and then snap back to their original shape. They're crucial in blood vessels that must expand with each heartbeat, and in lungs that stretch with each breath. Reticulin fibers are the delicate scaffolding, forming fine networks that support cells in organs like the liver and spleen. The cells you see scattered throughout include fibroblasts that produce the matrix, immune cells that defend against invaders, and specialized cells depending on the tissue type. The proportion and arrangement of these components determine whether you get the soft flexibility of loose connective tissue or the incredible strength of dense connective tissue like tendons."
            },
            bone: {
                title: "Bone Tissue Structure",
                subtitle: "Living tissue with mineral matrix",
                icon: "🦴",
                modelUrl: "https://sketchfab.com/models/852a5dd1c3ca45adaa5fdc566c06bb5c/embed?autostart=1&internal=1&tracking=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "Bone is a specialized connective tissue with a mineralized matrix that provides both strength and flexibility. Osteocytes live in lacunae connected by canaliculi, while osteoblasts build bone and osteoclasts break it down. This dynamic tissue constantly remodels throughout life.",
                concepts: [
                    "Living cells within mineralized matrix",
                    "Osteocytes maintain bone tissue",
                    "Haversian systems organize compact bone",
                    "Continuous remodeling throughout life"
                ],
                funFact: "Your skeleton is completely replaced about every 10 years through the constant activity of bone-building osteoblasts and bone-dissolving osteoclasts!",
                objectives: "Examine bone tissue organization and understand how cellular activity maintains this dynamic living tissue.",
                narration: "You're now exploring bone tissue - one of the most remarkable connective tissues in the human body! Despite appearing solid and unchanging, bone is actually a vibrant, living tissue that's constantly being rebuilt throughout your life. The bone matrix you see is unique because it's mineralized with calcium phosphate crystals, giving bone its incredible strength while remaining lighter than solid rock. The dark spots you observe are called lacunae - these are small spaces where bone cells called osteocytes live. Each osteocyte sits in its own little cave, connected to neighboring cells through tiny channels called canaliculi that allow communication and nutrient exchange. The organized, concentric rings you see are called Haversian systems or osteons - these are the structural units of compact bone. At the center of each osteon is a central canal containing blood vessels and nerves that keep the bone tissue alive. What makes bone truly amazing is its constant remodeling: osteoblast cells continuously lay down new bone matrix while osteoclast cells dissolve old bone, allowing your skeleton to adapt to mechanical stress, repair microscopic damage, and maintain calcium balance in your body. This living architecture provides the perfect combination of strength, lightness, and adaptability that allows you to move through the world."
            }
        };

        // Global Variables
        let currentStep = 'introduction';
        let voiceEnabled = true;
        let autoPlayEnabled = false;
        let currentSpeech = null;
        let selectedVoice = null;
        let journeyProgress = 0;
        let guidedTourActive = false;

        // Initialize Voice System
        function initVoiceSystem() {
            if (!('speechSynthesis' in window)) {
                console.warn('Speech synthesis not supported');
                voiceEnabled = false;
                document.getElementById('voiceToggle').style.display = 'none';
                return;
            }

            function loadVoices() {
                const voices = speechSynthesis.getVoices();
                if (voices.length === 0) return;

                const preferredVoices = [
                    'Google UK English Female',
                    'Microsoft Sonia',
                    'Microsoft Hazel',
                    'Samantha',
                    'Victoria'
                ];

                for (const name of preferredVoices) {
                    selectedVoice = voices.find(v => v.name.includes(name));
                    if (selectedVoice) break;
                }

                if (!selectedVoice) {
                    selectedVoice = voices.find(v => v.lang.startsWith('en'));
                }
            }

            loadVoices();
            if (speechSynthesis.onvoiceschanged !== undefined) {
                speechSynthesis.onvoiceschanged = loadVoices;
            }
        }

        // Load Journey Step
        function loadJourneyStep(stepId) {
            const stepData = JOURNEY_DATA[stepId];
            if (!stepData) return;

            currentStep = stepId;
            
            document.getElementById('api-frame').src = stepData.modelUrl;
            
            document.getElementById('stepIcon').textContent = stepData.icon;
            document.getElementById('stepTitle').textContent = stepData.title;
            document.getElementById('stepSubtitle').textContent = stepData.subtitle;
            document.getElementById('mainDescription').textContent = stepData.description;
            
            const conceptsList = document.getElementById('keyConcepts');
            conceptsList.innerHTML = stepData.concepts.map(c => `<li>${c}</li>`).join('');
            
            document.getElementById('funFact').textContent = stepData.funFact;
            document.getElementById('learningObjectives').textContent = stepData.objectives;
            
            updateNavigationButtons(stepId);
            updateProgress();
            
            if (voiceEnabled) {
                speakText(stepData.narration);
            }
        }

        // Update Navigation Buttons
        function updateNavigationButtons(activeStep) {
            const buttons = document.querySelectorAll('.journey-btn');
            const steps = ['introduction', 'squamous', 'cuboidal', 'columnar', 'connective', 'bone'];
            const activeIndex = steps.indexOf(activeStep);
            
            buttons.forEach((btn, index) => {
                btn.classList.remove('active', 'completed');
                if (index < activeIndex) {
                    btn.classList.add('completed');
                } else if (index === activeIndex) {
                    btn.classList.add('active');
                }
            });
            
            const miniSteps = document.querySelectorAll('.step-mini');
            miniSteps.forEach((step, index) => {
                step.classList.remove('active', 'completed');
                if (index < activeIndex) {
                    step.classList.add('completed');
                } else if (index === activeIndex) {
                    step.classList.add('active');
                }
            });
        }

        // Update Progress
        function updateProgress() {
            const steps = ['introduction', 'squamous', 'cuboidal', 'columnar', 'connective', 'bone'];
            const currentIndex = steps.indexOf(currentStep);
            const progress = ((currentIndex + 1) / steps.length) * 100;
            
            document.getElementById('progressPercent').textContent = Math.round(progress) + '%';
            document.getElementById('progressFill').style.width = progress + '%';
        }

        // Speech Functions
        function speakText(text) {
            if (!voiceEnabled || !text) return;
            
            stopSpeech();
            
            currentSpeech = new SpeechSynthesisUtterance(text);
            if (selectedVoice) {
                currentSpeech.voice = selectedVoice;
            }
            currentSpeech.rate = 0.9;
            currentSpeech.pitch = 1.0;
            currentSpeech.volume = 0.9;
            
            currentSpeech.onstart = () => {
                document.getElementById('voiceIndicator').classList.add('visible');
                document.getElementById('narrationText').textContent = 
                    text.substring(0, 50) + (text.length > 50 ? '...' : '');
            };
            
            currentSpeech.onend = () => {
                document.getElementById('voiceIndicator').classList.remove('visible');
                currentSpeech = null;
                
                if (guidedTourActive) {
                    setTimeout(nextStep, 2000);
                }
            };
            
            speechSynthesis.speak(currentSpeech);
        }

        function stopSpeech() {
            if (currentSpeech) {
                speechSynthesis.cancel();
                currentSpeech = null;
                document.getElementById('voiceIndicator').classList.remove('visible');
            }
        }

        // Control Functions
        function toggleVoice() {
            voiceEnabled = !voiceEnabled;
            const btn = document.getElementById('voiceToggle');
            btn.textContent = voiceEnabled ? '🔊' : '🔇';
            btn.classList.toggle('active', voiceEnabled);
            
            if (!voiceEnabled) {
                stopSpeech();
            }
        }

        function toggleAutoPlay() {
            autoPlayEnabled = !autoPlayEnabled;
            if (autoPlayEnabled) {
                startGuidedTour();
            } else {
                guidedTourActive = false;
            }
        }

        function toggleInfo() {
            const panel = document.getElementById('infoPanel');
            panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
        }

        // Guided Tour
        function startGuidedTour() {
            guidedTourActive = true;
            const steps = ['introduction', 'squamous', 'cuboidal', 'columnar', 'connective', 'bone'];
            let stepIndex = 0;
            
            function tourStep() {
                if (stepIndex < steps.length && guidedTourActive) {
                    loadJourneyStep(steps[stepIndex]);
                    stepIndex++;
                } else {
                    guidedTourActive = false;
                    if (voiceEnabled) {
                        speakText("Excellent work! You've mastered the fundamentals of epithelial and connective tissues. You now understand how cell shape determines epithelial function and how matrix composition gives connective tissues their unique properties. This knowledge forms the foundation for understanding all human anatomy and physiology!");
                    }
                }
            }
            
            tourStep();
            window.nextStep = tourStep;
        }

        // Quiz Function
        function showQuiz() {
            const questions = [
                "Why are squamous epithelial cells so thin and flat?",
                "How does the shape of cuboidal cells relate to their function?",
                "What advantage do microvilli provide to columnar epithelium?",
                "How do collagen and elastin fibers differ in function?",
                "Why is bone tissue considered a living, dynamic tissue?"
            ];
            
            const randomQ = questions[Math.floor(Math.random() * questions.length)];
            
            if (voiceEnabled) {
                speakText(`Time to test your tissue knowledge! Here's your question: ${randomQ} Think about the structure-function relationships you've learned!`);
            }
        }

        // Initialize
        function init() {
            initVoiceSystem();
            
            setTimeout(() => {
                const loading = document.getElementById('loadingOverlay');
                loading.style.opacity = '0';
                setTimeout(() => {
                    loading.style.display = 'none';
                    
                    if (voiceEnabled) {
                        speakText("Welcome to your exploration of epithelial and connective tissues! We'll discover how cell shape determines function in epithelial tissues and how matrix composition gives connective tissues their remarkable properties. Let's explore the architectural foundations of the human body!");
                    }
                }, 1000);
            }, 3000);
            
            document.addEventListener('keydown', (e) => {
                switch(e.key) {
                    case 'v': toggleVoice(); break;
                    case 'i': toggleInfo(); break;
                    case 'g': startGuidedTour(); break;
                    case 'Escape': stopSpeech(); guidedTourActive = false; break;
                    case 'ArrowRight': nextStep && nextStep(); break;
                }
            });
        }

        init();
    </script>
</body>
</html>