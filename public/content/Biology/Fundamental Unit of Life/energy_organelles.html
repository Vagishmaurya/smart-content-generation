<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Energy Organelles and Plant Structures - Complete Cellular Journey</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tween.js/18.6.4/tween.umd.js"></script>

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #27ae60 0%, #f39c12 100%);
            color: white;
            overflow: hidden;
            position: relative;
            height: 100vh;
        }

        /* Animated Background */
        .bg-animation {
            position: fixed;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: 0;
            opacity: 0.1;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 320"><path fill="%23ffffff" fill-opacity="0.2" d="M0,96L48,112C96,128,192,160,288,186.7C384,213,480,235,576,213.3C672,192,768,128,864,128C960,128,1056,192,1152,197.3C1248,203,1344,149,1392,122.7L1440,96L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z"></path></svg>') repeat-x;
            animation: wave 10s linear infinite;
        }

        @keyframes wave {
            0% { background-position-x: 0; }
            100% { background-position-x: 1440px; }
        }

        /* Museum Interface - Compact Header */
        .museum-header {
            position: absolute;
            top: 10px;
            left: 20px;
            text-align: left;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            padding: 10px 18px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .museum-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 4px;
            background: linear-gradient(45deg, #27ae60, #f39c12);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: titleGlow 3s ease-in-out infinite;
        }

        @keyframes titleGlow {
            0%, 100% { filter: brightness(1); }
            50% { filter: brightness(1.2); }
        }

        .exhibit-subtitle {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.8);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .energy-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            background: #f39c12;
            border-radius: 50%;
            animation: energyPulse 1.5s ease-in-out infinite;
        }

        @keyframes energyPulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.4); opacity: 0.6; }
        }

        /* Journey Navigation - Enhanced */
        .journey-navigation {
            position: absolute;
            bottom: 20px;
            left: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            padding: 15px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            max-width: 300px;
        }

        .journey-title {
            font-size: 14px;
            font-weight: 600;
            color: #f39c12;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .journey-steps {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }

        .journey-btn {
            background: rgba(243, 156, 18, 0.2);
            border: 1px solid rgba(243, 156, 18, 0.4);
            color: white;
            padding: 6px 10px;
            border-radius: 20px;
            font-size: 11px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 4px;
            white-space: nowrap;
        }

        .journey-btn:hover {
            background: rgba(243, 156, 18, 0.3);
            border-color: #f39c12;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(243, 156, 18, 0.3);
        }

        .journey-btn.active {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            border-color: #27ae60;
            box-shadow: 0 0 20px rgba(39, 174, 96, 0.5);
            animation: energyActive 2s infinite;
        }

        .journey-btn.completed {
            background: rgba(46, 204, 113, 0.3);
            border-color: #2ecc71;
        }

        @keyframes energyActive {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        /* 3D Model Container */
        .model-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 0;
            overflow: hidden;
            border: none;
            z-index: 100;
        }

        .sketchfab-embed-wrapper {
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #27ae60 0%, #f39c12 100%);
        }

        .sketchfab-embed-wrapper iframe {
            width: 100%;
            height: 100%;
            border: none;
            border-radius: 0;
        }

        /* Information Panel - Enhanced */
        .info-panel {
            position: absolute;
            top: 70px;
            right: 20px;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(25px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 16px;
            padding: 24px;
            width: 380px;
            max-height: calc(100vh - 140px);
            z-index: 800;
            overflow-y: auto;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }

        .info-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        }

        .info-icon {
            font-size: 28px;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        .info-title {
            flex: 1;
        }

        .info-title h2 {
            font-size: 18px;
            color: #27ae60;
            margin-bottom: 4px;
        }

        .info-subtitle {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.7);
        }

        .info-content {
            color: rgba(255, 255, 255, 0.9);
            font-size: 14px;
            line-height: 1.6;
        }

        /* Progress Tracker */
        .progress-tracker {
            background: linear-gradient(135deg, rgba(243, 156, 18, 0.1), rgba(39, 174, 96, 0.1));
            border: 1px solid rgba(243, 156, 18, 0.3);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 20px;
        }

        .progress-header {
            font-size: 13px;
            font-weight: 600;
            color: #f39c12;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .progress-percentage {
            font-size: 18px;
            color: #27ae60;
            font-weight: 700;
        }

        .progress-bar {
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 12px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #f39c12, #27ae60);
            border-radius: 4px;
            transition: width 0.8s ease;
            box-shadow: 0 0 10px rgba(39, 174, 96, 0.5);
        }

        .progress-steps-mini {
            display: flex;
            justify-content: space-between;
            font-size: 9px;
            color: rgba(255, 255, 255, 0.6);
        }

        .step-mini {
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .step-mini.active {
            color: #27ae60;
            font-weight: 600;
        }

        .step-mini.completed {
            color: #2ecc71;
        }

        /* Information Cards */
        .info-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 14px;
            margin-bottom: 14px;
        }

        .info-card-title {
            color: #f39c12;
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .info-card-content {
            color: rgba(255, 255, 255, 0.85);
            font-size: 12px;
            line-height: 1.5;
        }

        .info-list {
            list-style: none;
            padding: 0;
        }

        .info-list li {
            padding: 6px 0;
            padding-left: 20px;
            position: relative;
            font-size: 12px;
            color: rgba(255, 255, 255, 0.8);
        }

        .info-list li:before {
            content: "‚ö°";
            position: absolute;
            left: 0;
            color: #f39c12;
        }

        /* Fun Fact Box */
        .fun-fact {
            background: linear-gradient(135deg, rgba(46, 204, 113, 0.1), rgba(243, 156, 18, 0.1));
            border: 1px solid rgba(46, 204, 113, 0.3);
            border-radius: 12px;
            padding: 14px;
            margin: 16px 0;
            position: relative;
            overflow: hidden;
        }

        .fun-fact:before {
            content: "‚ö°";
            position: absolute;
            top: -20px;
            right: -20px;
            font-size: 60px;
            opacity: 0.1;
        }

        .fun-fact-title {
            color: #2ecc71;
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 6px;
        }

        .fun-fact-text {
            color: rgba(255, 255, 255, 0.9);
            font-size: 12px;
            line-height: 1.5;
            position: relative;
            z-index: 1;
        }

        /* Voice Controls */
        .voice-controls {
            position: absolute;
            top: 10px;
            right: 20px;
            display: flex;
            gap: 8px;
            z-index: 1000;
        }

        .control-btn {
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            width: 44px;
            height: 44px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            position: relative;
        }

        .control-btn:hover {
            background: rgba(39, 174, 96, 0.3);
            border-color: #27ae60;
            transform: scale(1.1);
        }

        .control-btn.active {
            background: rgba(39, 174, 96, 0.4);
            border-color: #27ae60;
            box-shadow: 0 0 20px rgba(39, 174, 96, 0.5);
        }

        .control-tooltip {
            position: absolute;
            bottom: -30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9);
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 10px;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .control-btn:hover .control-tooltip {
            opacity: 1;
        }

        /* Loading Screen */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #27ae60 0%, #f39c12 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            transition: opacity 1s ease;
        }

        .loading-content {
            text-align: center;
        }

        .loading-energy {
            font-size: 60px;
            animation: energySpin 2s linear infinite;
            margin-bottom: 20px;
        }

        @keyframes energySpin {
            0% { transform: rotate(0deg) scale(1); }
            50% { transform: rotate(180deg) scale(1.1); }
            100% { transform: rotate(360deg) scale(1); }
        }

        .loading-text {
            color: white;
            font-size: 20px;
            margin-bottom: 20px;
        }

        .loading-progress {
            width: 200px;
            height: 4px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 2px;
            overflow: hidden;
        }

        .loading-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #27ae60, #f39c12);
            animation: loading 2s ease-in-out infinite;
        }

        @keyframes loading {
            0% { width: 0%; }
            50% { width: 100%; }
            100% { width: 0%; }
        }

        /* Voice Indicator */
        .voice-indicator {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(39, 174, 96, 0.5);
            border-radius: 30px;
            padding: 14px 28px;
            display: flex;
            align-items: center;
            gap: 12px;
            z-index: 1000;
            opacity: 0;
            transition: all 0.3s ease;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }

        .voice-indicator.visible {
            opacity: 1;
            transform: translateX(-50%) translateY(-10px);
        }

        .voice-waves {
            display: flex;
            align-items: center;
            gap: 3px;
        }

        .voice-wave {
            width: 3px;
            height: 20px;
            background: linear-gradient(180deg, #27ae60, #f39c12);
            border-radius: 2px;
            animation: voice-wave 1s ease-in-out infinite;
        }

        .voice-wave:nth-child(2) { animation-delay: 0.1s; }
        .voice-wave:nth-child(3) { animation-delay: 0.2s; }
        .voice-wave:nth-child(4) { animation-delay: 0.3s; }
        .voice-wave:nth-child(5) { animation-delay: 0.4s; }

        @keyframes voice-wave {
            0%, 100% { transform: scaleY(0.3); }
            50% { transform: scaleY(1); }
        }

        .narration-text {
            color: white;
            font-size: 13px;
            max-width: 300px;
        }

        /* Quick Actions */
        .quick-actions {
            position: absolute;
            bottom: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            z-index: 1000;
        }

        .action-btn {
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 10px 16px;
            border-radius: 25px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
        }

        .action-btn:hover {
            background: rgba(243, 156, 18, 0.3);
            border-color: #f39c12;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(243, 156, 18, 0.3);
        }

        /* Custom Scrollbar */
        .info-panel::-webkit-scrollbar {
            width: 6px;
        }

        .info-panel::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 3px;
        }

        .info-panel::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, #27ae60, #f39c12);
            border-radius: 3px;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .info-panel {
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                top: auto;
                width: 100%;
                max-height: 50vh;
                border-radius: 20px 20px 0 0;
            }
            
            .journey-navigation {
                bottom: 52vh;
                max-width: calc(100% - 40px);
            }
            
            .voice-controls {
                top: auto;
                bottom: 55vh;
                right: 10px;
            }
            
            .quick-actions {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="bg-animation"></div>

    <!-- Loading Screen -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-content">
            <div class="loading-energy">‚ö°</div>
            <div class="loading-text">Charging Your Energy Journey...</div>
            <div class="loading-progress">
                <div class="loading-progress-bar"></div>
            </div>
        </div>
    </div>

    <!-- Museum Header -->
    <div class="museum-header">
        <div class="museum-title">Energy Organelles and Plant Structures</div>
        <div class="exhibit-subtitle">
            <span class="energy-indicator"></span>
            Powerhouses of Cellular Life
        </div>
    </div>

    <!-- Journey Navigation -->
    <div class="journey-navigation">
        <div class="journey-title">
            <span>‚ö°</span>
            <span>Your Energy Journey</span>
        </div>
        <div class="journey-steps">
            <button class="journey-btn active" onclick="loadJourneyStep('mitochondria')">
                <span>üîã</span> Mitochondria
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('atp')">
                <span>üíé</span> ATP
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('chloroplasts')">
                <span>üå±</span> Chloroplasts
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('plastids')">
                <span>üé®</span> Plastids
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('vacuoles')">
                <span>üíß</span> Vacuoles
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('integration')">
                <span>üîÑ</span> Energy Flow
            </button>
        </div>
    </div>

    <!-- 3D Model Container -->
    <div class="model-container">
        <div class="sketchfab-embed-wrapper">
            <iframe id="api-frame"
                    title="Mitochondria Structure Model" 
                    frameborder="0" 
                    allowfullscreen 
                    mozallowfullscreen="true" 
                    webkitallowfullscreen="true" 
                    allow="autoplay; fullscreen; xr-spatial-tracking"
                    xr-spatial-tracking 
                    execution-while-out-of-viewport 
                    execution-while-not-rendered 
                    web-share 
                    src="https://sketchfab.com/3d-models/mitochondria-cross-section-anatomy-acc7d71759a1441e8409ebb31e3c3c0d/embed?autostart=1&internal=1&tracking=0&ui_ar=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0">
            </iframe>
        </div>
    </div>

    <!-- Information Panel -->
    <div class="info-panel" id="infoPanel">
        <div class="info-header">
            <div class="info-icon" id="stepIcon">üîã</div>
            <div class="info-title">
                <h2 id="stepTitle">Mitochondria - The Powerhouse</h2>
                <div class="info-subtitle" id="stepSubtitle">Where cellular energy is generated</div>
            </div>
        </div>

        <!-- Progress Tracker -->
        <div class="progress-tracker">
            <div class="progress-header">
                <span>Journey Progress</span>
                <span class="progress-percentage" id="progressPercent">0%</span>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 0%"></div>
            </div>
            <div class="progress-steps-mini">
                <span class="step-mini active" onclick="loadJourneyStep('mitochondria')">Mitochondria</span>
                <span class="step-mini" onclick="loadJourneyStep('atp')">ATP</span>
                <span class="step-mini" onclick="loadJourneyStep('chloroplasts')">Chloroplasts</span>
                <span class="step-mini" onclick="loadJourneyStep('plastids')">Plastids</span>
                <span class="step-mini" onclick="loadJourneyStep('vacuoles')">Vacuoles</span>
                <span class="step-mini" onclick="loadJourneyStep('integration')">Energy Flow</span>
            </div>
        </div>

        <div class="info-content" id="mainDescription">
            Welcome to the mitochondria - the powerhouse of the cell! These remarkable double-membraned organelles are where cellular respiration transforms nutrients into usable energy. Like tiny power plants, they generate ATP, the universal energy currency that powers all cellular activities.
        </div>

        <div class="info-card">
            <div class="info-card-title">
                <span>üî¨</span> Key Features
            </div>
            <div class="info-card-content">
                <ul class="info-list" id="keyConcepts">
                    <li>Double membrane structure with cristae</li>
                    <li>Own circular DNA and ribosomes</li>
                    <li>Site of cellular respiration and ATP production</li>
                    <li>Matrix contains enzymes for energy conversion</li>
                </ul>
            </div>
        </div>

        <div class="fun-fact">
            <div class="fun-fact-title">Amazing Fact!</div>
            <div class="fun-fact-text" id="funFact">
                Mitochondria have their own DNA, suggesting they were once free-living bacteria that formed a symbiotic relationship with early cells over 1.5 billion years ago!
            </div>
        </div>

        <div class="info-card">
            <div class="info-card-title">
                <span>üéØ</span> Learning Objectives
            </div>
            <div class="info-card-content" id="learningObjectives">
                By exploring this section, you'll understand how mitochondria convert food molecules into cellular energy and why they're essential for life.
            </div>
        </div>
    </div>

    <!-- Voice Controls -->
    <div class="voice-controls">
        <button class="control-btn active" id="voiceToggle" onclick="toggleVoice()">
            üîä
            <span class="control-tooltip">Voice Narration</span>
        </button>
        <button class="control-btn" onclick="toggleAutoPlay()">
            ‚ñ∂Ô∏è
            <span class="control-tooltip">Auto Journey</span>
        </button>
        <button class="control-btn" onclick="toggleInfo()">
            ‚ÑπÔ∏è
            <span class="control-tooltip">Toggle Info</span>
        </button>
    </div>

    <!-- Quick Actions -->
    <div class="quick-actions">
        <button class="action-btn" onclick="startGuidedTour()">
            <span>üöÄ</span> Guided Tour
        </button>
        <button class="action-btn" onclick="showQuiz()">
            <span>üéØ</span> Test Knowledge
        </button>
    </div>

    <!-- Voice Indicator -->
    <div class="voice-indicator" id="voiceIndicator">
        <div class="voice-waves">
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
        </div>
        <div class="narration-text" id="narrationText">Narrating...</div>
    </div>

    <script>
        // Journey Step Data with Complete Pedagogical Content
        const JOURNEY_DATA = {
            mitochondria: {
                title: "Mitochondria - The Powerhouse",
                subtitle: "Where cellular energy is generated",
                icon: "üîã",
                modelUrl: "https://sketchfab.com/3d-models/mitochondria-cross-section-anatomy-acc7d71759a1441e8409ebb31e3c3c0d/embed?autostart=1&internal=1&tracking=0&ui_ar=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "Welcome to the mitochondria - the powerhouse of the cell! These remarkable double-membraned organelles are where cellular respiration transforms nutrients into usable energy. Like tiny power plants, they generate ATP, the universal energy currency that powers all cellular activities.",
                concepts: [
                    "Double membrane structure with cristae",
                    "Own circular DNA and ribosomes", 
                    "Site of cellular respiration and ATP production",
                    "Matrix contains enzymes for energy conversion"
                ],
                funFact: "Mitochondria have their own DNA, suggesting they were once free-living bacteria that formed a symbiotic relationship with early cells over 1.5 billion years ago!",
                objectives: "By exploring this section, you'll understand how mitochondria convert food molecules into cellular energy and why they're essential for life.",
                narration: "Welcome to the mitochondria - the cellular powerhouse that literally keeps you alive! This cross-section reveals the sophisticated architecture that makes energy production possible. The mitochondria has two membranes: the smooth outer membrane and the highly folded inner membrane with structures called cristae. These folds dramatically increase surface area, providing more space for the energy-generating machinery. Inside the inner membrane is the matrix, filled with enzymes that break down nutrients from food. The most remarkable feature? Mitochondria have their own circular DNA and ribosomes, just like bacteria! This supports the endosymbiotic theory - that mitochondria were once free-living bacteria that entered early cells and formed a beneficial partnership. Today, they're essential organelles that use oxygen to convert glucose into ATP through cellular respiration. Each cell can contain hundreds of mitochondria, and they're most abundant in energy-demanding tissues like muscle and brain cells."
            },
            atp: {
                title: "ATP - The Energy Currency",
                subtitle: "Life's universal power source",
                icon: "üíé",
                modelUrl: "https://sketchfab.com/models/fc4496961b3947499ec3dc0d878d5b05/embed?autostart=1&internal=1&tracking=0&ui_ar=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "ATP (Adenosine Triphosphate) is life's universal energy currency! This remarkable molecule stores and transfers energy in every living cell. When ATP loses a phosphate group to become ADP, it releases energy that powers everything from muscle contractions to protein synthesis.",
                concepts: [
                    "Adenosine with three phosphate groups",
                    "High-energy bonds between phosphates",
                    "Hydrolysis releases energy for cellular work",
                    "Constantly recycled between ATP and ADP"
                ],
                funFact: "Your body recycles your entire body weight in ATP every single day - that's about 40 kg of ATP being made and broken down continuously!",
                objectives: "Learn how ATP's molecular structure enables energy storage and transfer, and understand its central role in cellular metabolism.",
                narration: "Behold ATP - adenosine triphosphate - the most important molecule you've probably never thought about! This elegant molecule consists of adenosine (adenine plus ribose sugar) connected to three phosphate groups. The magic lies in the high-energy bonds between these phosphate groups, especially the last two. When cellular processes need energy, ATP is hydrolyzed - it reacts with water to break the bond holding the terminal phosphate group. This releases about 7.3 kilocalories of energy per mole, along with ADP (adenosine diphosphate) and a free phosphate group. This energy powers virtually everything in your cells: muscle contractions, nerve impulses, protein synthesis, DNA replication, and active transport across membranes. But here's what's truly amazing - ATP doesn't just get used up. The ADP and phosphate are recycled back into ATP by mitochondria and chloroplasts, creating an endless cycle of energy storage and release. Your cells maintain only a few seconds' worth of ATP at any time, but they're constantly regenerating it!"
            },
            chloroplasts: {
                title: "Chloroplasts - Photosynthesis Powerhouses",
                subtitle: "Converting sunlight into chemical energy",
                icon: "üå±",
                modelUrl: "https://sketchfab.com/3d-models/chloroplast-9a244f04a73d46cd8801fd3d9d40726b/embed?autostart=1&internal=1&tracking=0&ui_ar=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "Chloroplasts are the solar panels of the plant kingdom! These green organelles capture sunlight and convert it into chemical energy through photosynthesis. With their elaborate system of thylakoids and chlorophyll, they transform carbon dioxide and water into glucose and oxygen.",
                concepts: [
                    "Double membrane with thylakoid system",
                    "Chlorophyll captures light energy",
                    "Grana stacks house light reactions",
                    "Stroma contains Calvin cycle enzymes"
                ],
                funFact: "Chloroplasts produce all the oxygen you breathe! A single large tree can produce enough oxygen for two people for an entire year through photosynthesis.",
                objectives: "Understand how chloroplasts capture solar energy and convert it into chemical energy that fuels most life on Earth.",
                narration: "Welcome to the chloroplast - nature's solar panel and the reason you can breathe! This remarkable organelle is found in plant cells and some algae, and it's responsible for one of the most important processes on Earth: photosynthesis. Like mitochondria, chloroplasts have a double membrane structure, but inside they contain an elaborate system of flattened sacs called thylakoids. These thylakoids are stacked into structures called grana, like coins in a roll. The thylakoid membranes contain chlorophyll, the green pigment that captures light energy. When sunlight hits chlorophyll, it excites electrons and starts the amazing process of converting light energy into chemical energy. The light reactions occur in the thylakoids, producing ATP and NADPH. Meanwhile, in the fluid-filled stroma surrounding the thylakoids, the Calvin cycle uses this energy to convert carbon dioxide into glucose. Chloroplasts also have their own DNA and ribosomes, supporting the theory that they too were once free-living bacteria that joined plant cells in a beneficial partnership."
            },
            plastids: {
                title: "Plastids - Colorful Storage Specialists",
                subtitle: "Chromoplasts and leucoplasts",
                icon: "üé®",
                modelUrl: "https://sketchfab.com/3d-models/eukaryotic-plant-cell-f258c65762e5435c9d58c1aa136b557a/embed?autostart=1&internal=1&tracking=0&ui_ar=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "Plastids are a diverse family of organelles in plant cells! While chloroplasts get the spotlight, chromoplasts create the vibrant colors in fruits and flowers, while leucoplasts serve as storage centers for starch, oils, and proteins throughout the plant.",
                concepts: [
                    "Chromoplasts contain colorful pigments",
                    "Leucoplasts store starch, oils, and proteins",
                    "All plastids develop from proplastids",
                    "Can interconvert based on cell needs"
                ],
                funFact: "The brilliant red of tomatoes, orange of carrots, and yellow of daffodils all come from chromoplasts packed with carotenoid pigments!",
                objectives: "Explore the diversity of plastids and understand their specialized roles in plant metabolism and development.",
                narration: "Meet the plastid family - a diverse group of organelles that do much more than just photosynthesis! In this plant cell model, you can see various types of plastids working together. Chloroplasts are the green members we've met, but chromoplasts are the artists of the plant world. These plastids contain colorful pigments like carotenoids that create the reds, oranges, and yellows in fruits, flowers, and autumn leaves. They're what make tomatoes red, carrots orange, and daffodils yellow! Then there are leucoplasts - the storage specialists that accumulate starch in potato tubers, oils in seeds, and proteins in legumes. What's fascinating is that all plastids develop from small, undifferentiated organelles called proplastids, and they can actually change their identity based on the plant's needs. A chloroplast can become a chromoplast when a fruit ripens, or a leucoplast can become a chloroplast when a potato sprouts in light. This plasticity - hence the name 'plastid' - allows plants to adapt their cellular machinery to different developmental stages and environmental conditions."
            },
            vacuoles: {
                title: "Vacuoles - The Cellular Storage Units",
                subtitle: "Plant and animal storage systems",
                icon: "üíß",
                modelUrl: "https://sketchfab.com/3d-models/eukaryotic-plant-cell-f258c65762e5435c9d58c1aa136b557a/embed?autostart=1&internal=1&tracking=0&ui_ar=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "Vacuoles are the storage warehouses of cells! In plants, the large central vacuole maintains turgor pressure and stores water, ions, and nutrients. Animal cells have smaller vacuoles with specialized functions like waste storage and transport.",
                concepts: [
                    "Large central vacuole in plant cells",
                    "Maintains turgor pressure for structure",
                    "Stores water, ions, and nutrients",
                    "Contains cell sap with dissolved substances"
                ],
                funFact: "A plant cell's central vacuole can occupy up to 90% of the cell's volume, making it like a giant water balloon that gives plants their rigid structure!",
                objectives: "Understand how vacuoles maintain cell structure and store essential materials in both plant and animal cells.",
                narration: "Behold the central vacuole - the giant water tank that dominates this plant cell! This massive, membrane-bound organelle can occupy up to 90% of a mature plant cell's volume, making it one of the largest cellular structures. The vacuole is surrounded by a membrane called the tonoplast, which controls what enters and exits this aquatic environment. Inside, the vacuole contains cell sap - an aqueous solution of water, ions, sugars, organic acids, and various dissolved substances. The vacuole serves multiple crucial functions: it maintains turgor pressure by pushing against the cell wall to keep the plant rigid and upright, stores excess water and nutrients, and can even contain toxic compounds that protect the plant from herbivores. When plants wilt, it's because their vacuoles have lost water and can no longer maintain turgor pressure. In contrast, animal cells have much smaller, more specialized vacuoles that might store specific substances or transport materials within the cell. The vacuole is truly the plant's internal plumbing and storage system combined!"
            },
            integration: {
                title: "Energy Flow - The Cellular Power Grid",
                subtitle: "How energy systems work together",
                icon: "üîÑ",
                modelUrl: "https://sketchfab.com/3d-models/eukaryotic-plant-cell-f258c65762e5435c9d58c1aa136b557a/embed?autostart=1&internal=1&tracking=0&ui_ar=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "Now see how all energy organelles work together in the cellular power grid! In plant cells, chloroplasts capture solar energy to make glucose, mitochondria break down glucose to make ATP, plastids store energy reserves, and vacuoles maintain the cellular environment for optimal energy flow.",
                concepts: [
                    "Chloroplasts produce glucose from sunlight",
                    "Mitochondria convert glucose to ATP",
                    "Plastids store energy as starch and oils",
                    "Vacuoles maintain optimal cellular conditions"
                ],
                funFact: "In a single day, a plant cell's energy organelles can convert sunlight into enough chemical energy to power the entire cell's activities for weeks!",
                objectives: "Synthesize understanding of how energy organelles coordinate to capture, convert, store, and utilize energy for cellular life.",
                narration: "Welcome to the grand finale - understanding how all energy organelles work together in perfect harmony! This plant cell shows the complete energy ecosystem in action. It all starts with chloroplasts capturing photons from sunlight and using that energy to combine carbon dioxide and water into glucose molecules. This process, photosynthesis, not only feeds the plant but produces the oxygen that most life on Earth depends on. The glucose created by chloroplasts becomes fuel for mitochondria, which break it down through cellular respiration to produce ATP - the immediate energy source for cellular work. Meanwhile, leucoplasts act as energy storage units, converting excess glucose into starch granules that can be broken down later when energy is needed. Chromoplasts store energy-rich carotenoids and attract pollinators with their colors. The central vacuole maintains the water balance and ionic environment needed for all these processes to work efficiently. Together, these organelles create a sophisticated energy economy where solar energy is captured, converted, stored, and utilized with remarkable efficiency. This integration of energy systems is what makes complex life possible and sustainable!"
            }
        };

        // Global Variables
        let currentStep = 'mitochondria';
        let voiceEnabled = true;
        let autoPlayEnabled = false;
        let currentSpeech = null;
        let selectedVoice = null;
        let journeyProgress = 0;
        let guidedTourActive = false;

        // Initialize Voice System
        function initVoiceSystem() {
            if (!('speechSynthesis' in window)) {
                console.warn('Speech synthesis not supported');
                voiceEnabled = false;
                document.getElementById('voiceToggle').style.display = 'none';
                return;
            }

            function loadVoices() {
                const voices = speechSynthesis.getVoices();
                if (voices.length === 0) return;

                // Prefer natural-sounding voices
                const preferredVoices = [
                    'Google UK English Female',
                    'Microsoft Sonia',
                    'Microsoft Hazel',
                    'Samantha',
                    'Victoria'
                ];

                for (const name of preferredVoices) {
                    selectedVoice = voices.find(v => v.name.includes(name));
                    if (selectedVoice) break;
                }

                if (!selectedVoice) {
                    selectedVoice = voices.find(v => v.lang.startsWith('en'));
                }
            }

            loadVoices();
            if (speechSynthesis.onvoiceschanged !== undefined) {
                speechSynthesis.onvoiceschanged = loadVoices;
            }
        }

        // Load Journey Step
        function loadJourneyStep(stepId) {
            const stepData = JOURNEY_DATA[stepId];
            if (!stepData) return;

            currentStep = stepId;
            
            // Update model
            document.getElementById('api-frame').src = stepData.modelUrl;
            
            // Update info panel
            document.getElementById('stepIcon').textContent = stepData.icon;
            document.getElementById('stepTitle').textContent = stepData.title;
            document.getElementById('stepSubtitle').textContent = stepData.subtitle;
            document.getElementById('mainDescription').textContent = stepData.description;
            
            // Update key concepts
            const conceptsList = document.getElementById('keyConcepts');
            conceptsList.innerHTML = stepData.concepts.map(c => `<li>${c}</li>`).join('');
            
            // Update fun fact
            document.getElementById('funFact').textContent = stepData.funFact;
            
            // Update learning objectives
            document.getElementById('learningObjectives').textContent = stepData.objectives;
            
            // Update navigation buttons
            updateNavigationButtons(stepId);
            
            // Update progress
            updateProgress();
            
            // Play narration if enabled
            if (voiceEnabled) {
                speakText(stepData.narration);
            }
        }

        // Update Navigation Buttons
        function updateNavigationButtons(activeStep) {
            const buttons = document.querySelectorAll('.journey-btn');
            const steps = ['mitochondria', 'atp', 'chloroplasts', 'plastids', 'vacuoles', 'integration'];
            const activeIndex = steps.indexOf(activeStep);
            
            buttons.forEach((btn, index) => {
                btn.classList.remove('active', 'completed');
                if (index < activeIndex) {
                    btn.classList.add('completed');
                } else if (index === activeIndex) {
                    btn.classList.add('active');
                }
            });
            
            // Update mini steps
            const miniSteps = document.querySelectorAll('.step-mini');
            miniSteps.forEach((step, index) => {
                step.classList.remove('active', 'completed');
                if (index < activeIndex) {
                    step.classList.add('completed');
                } else if (index === activeIndex) {
                    step.classList.add('active');
                }
            });
        }

        // Update Progress
        function updateProgress() {
            const steps = ['mitochondria', 'atp', 'chloroplasts', 'plastids', 'vacuoles', 'integration'];
            const currentIndex = steps.indexOf(currentStep);
            const progress = ((currentIndex + 1) / steps.length) * 100;
            
            document.getElementById('progressPercent').textContent = Math.round(progress) + '%';
            document.getElementById('progressFill').style.width = progress + '%';
        }

        // Speech Functions
        function speakText(text) {
            if (!voiceEnabled || !text) return;
            
            stopSpeech();
            
            currentSpeech = new SpeechSynthesisUtterance(text);
            if (selectedVoice) {
                currentSpeech.voice = selectedVoice;
            }
            currentSpeech.rate = 0.9;
            currentSpeech.pitch = 1.0;
            currentSpeech.volume = 0.9;
            
            currentSpeech.onstart = () => {
                document.getElementById('voiceIndicator').classList.add('visible');
                document.getElementById('narrationText').textContent = 
                    text.substring(0, 50) + (text.length > 50 ? '...' : '');
            };
            
            currentSpeech.onend = () => {
                document.getElementById('voiceIndicator').classList.remove('visible');
                currentSpeech = null;
                
                // Auto-advance if guided tour is active
                if (guidedTourActive) {
                    setTimeout(nextStep, 2000);
                }
            };
            
            speechSynthesis.speak(currentSpeech);
        }

        function stopSpeech() {
            if (currentSpeech) {
                speechSynthesis.cancel();
                currentSpeech = null;
                document.getElementById('voiceIndicator').classList.remove('visible');
            }
        }

        // Control Functions
        function toggleVoice() {
            voiceEnabled = !voiceEnabled;
            const btn = document.getElementById('voiceToggle');
            btn.textContent = voiceEnabled ? 'üîä' : 'üîá';
            btn.classList.toggle('active', voiceEnabled);
            
            if (!voiceEnabled) {
                stopSpeech();
            }
        }

        function toggleAutoPlay() {
            autoPlayEnabled = !autoPlayEnabled;
            if (autoPlayEnabled) {
                startGuidedTour();
            } else {
                guidedTourActive = false;
            }
        }

        function toggleInfo() {
            const panel = document.getElementById('infoPanel');
            panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
        }

        // Guided Tour
        function startGuidedTour() {
            guidedTourActive = true;
            const steps = ['mitochondria', 'atp', 'chloroplasts', 'plastids', 'vacuoles', 'integration'];
            let stepIndex = 0;
            
            function tourStep() {
                if (stepIndex < steps.length && guidedTourActive) {
                    loadJourneyStep(steps[stepIndex]);
                    stepIndex++;
                } else {
                    guidedTourActive = false;
                    if (voiceEnabled) {
                        speakText("Congratulations! You've completed your journey through energy organelles and plant structures. You now understand how cells capture, convert, and store energy to power life!");
                    }
                }
            }
            
            tourStep();
            window.nextStep = tourStep;
        }

        // Quiz Function
        function showQuiz() {
            const questions = [
                "What makes mitochondria the powerhouse of the cell?",
                "How does ATP store and release energy?",
                "What's the main difference between chloroplasts and mitochondria?",
                "Why do plants have different types of plastids?",
                "How do vacuoles help maintain plant structure?"
            ];
            
            const randomQ = questions[Math.floor(Math.random() * questions.length)];
            
            if (voiceEnabled) {
                speakText(`Here's a question to test your knowledge: ${randomQ} Think about what you've learned in this energy journey!`);
            }
        }

        // Initialize
        function init() {
            initVoiceSystem();
            
            // Hide loading screen
            setTimeout(() => {
                const loading = document.getElementById('loadingOverlay');
                loading.style.opacity = '0';
                setTimeout(() => {
                    loading.style.display = 'none';
                    
                    // Welcome message
                    if (voiceEnabled) {
                        speakText("Welcome to your journey through energy organelles and plant structures! We'll explore how cells capture sunlight, convert nutrients into energy, and store resources for the future. Let's start with mitochondria - the powerhouse of every cell!");
                    }
                }, 1000);
            }, 3000);
            
            // Keyboard shortcuts
            document.addEventListener('keydown', (e) => {
                switch(e.key) {
                    case 'v': toggleVoice(); break;
                    case 'i': toggleInfo(); break;
                    case 'g': startGuidedTour(); break;
                    case 'Escape': stopSpeech(); guidedTourActive = false; break;
                    case 'ArrowRight': nextStep && nextStep(); break;
                }
            });
        }

        // Start the application
        init();
    </script>
</body>
</html>