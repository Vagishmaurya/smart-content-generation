<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nucleus and Genetic Material - Complete Cellular Journey</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tween.js/18.6.4/tween.umd.js"></script>

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #4a90e2 0%, #7b68ee 100%);
            color: white;
            overflow: hidden;
            position: relative;
            height: 100vh;
        }

        /* Animated Background */
        .bg-animation {
            position: fixed;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: 0;
            opacity: 0.1;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 320"><path fill="%23ffffff" fill-opacity="0.2" d="M0,96L48,112C96,128,192,160,288,186.7C384,213,480,235,576,213.3C672,192,768,128,864,128C960,128,1056,192,1152,197.3C1248,203,1344,149,1392,122.7L1440,96L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z"></path></svg>') repeat-x;
            animation: wave 10s linear infinite;
        }

        @keyframes wave {
            0% { background-position-x: 0; }
            100% { background-position-x: 1440px; }
        }

        /* Museum Interface - Compact Header */
        .museum-header {
            position: absolute;
            top: 10px;
            left: 20px;
            text-align: left;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            padding: 10px 18px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .museum-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 4px;
            background: linear-gradient(45deg, #9b59b6, #3498db);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: titleGlow 3s ease-in-out infinite;
        }

        @keyframes titleGlow {
            0%, 100% { filter: brightness(1); }
            50% { filter: brightness(1.2); }
        }

        .exhibit-subtitle {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.8);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .dna-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            background: #9b59b6;
            border-radius: 50%;
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.3); opacity: 0.7; }
        }

        /* Journey Navigation - Enhanced */
        .journey-navigation {
            position: absolute;
            bottom: 20px;
            left: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            padding: 15px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            max-width: 280px;
        }

        .journey-title {
            font-size: 14px;
            font-weight: 600;
            color: #3498db;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .journey-steps {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }

        .journey-btn {
            background: rgba(52, 152, 219, 0.2);
            border: 1px solid rgba(52, 152, 219, 0.4);
            color: white;
            padding: 6px 10px;
            border-radius: 20px;
            font-size: 11px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 4px;
            white-space: nowrap;
        }

        .journey-btn:hover {
            background: rgba(52, 152, 219, 0.3);
            border-color: #3498db;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(52, 152, 219, 0.3);
        }

        .journey-btn.active {
            background: linear-gradient(135deg, #9b59b6, #8e44ad);
            border-color: #9b59b6;
            box-shadow: 0 0 20px rgba(155, 89, 182, 0.5);
            animation: pulseActive 2s infinite;
        }

        .journey-btn.completed {
            background: rgba(46, 204, 113, 0.3);
            border-color: #2ecc71;
        }

        @keyframes pulseActive {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        /* 3D Model Container */
        .model-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 0;
            overflow: hidden;
            border: none;
            z-index: 100;
        }

        .sketchfab-embed-wrapper {
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #4a90e2 0%, #7b68ee 100%);
        }

        .sketchfab-embed-wrapper iframe {
            width: 100%;
            height: 100%;
            border: none;
            border-radius: 0;
        }

        /* Information Panel - Enhanced */
        .info-panel {
            position: absolute;
            top: 70px;
            right: 20px;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(25px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 16px;
            padding: 24px;
            width: 380px;
            max-height: calc(100vh - 140px);
            z-index: 800;
            overflow-y: auto;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }

        .info-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        }

        .info-icon {
            font-size: 28px;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        .info-title {
            flex: 1;
        }

        .info-title h2 {
            font-size: 18px;
            color: #9b59b6;
            margin-bottom: 4px;
        }

        .info-subtitle {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.7);
        }

        .info-content {
            color: rgba(255, 255, 255, 0.9);
            font-size: 14px;
            line-height: 1.6;
        }

        /* Progress Tracker */
        .progress-tracker {
            background: linear-gradient(135deg, rgba(52, 152, 219, 0.1), rgba(155, 89, 182, 0.1));
            border: 1px solid rgba(52, 152, 219, 0.3);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 20px;
        }

        .progress-header {
            font-size: 13px;
            font-weight: 600;
            color: #3498db;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .progress-percentage {
            font-size: 18px;
            color: #9b59b6;
            font-weight: 700;
        }

        .progress-bar {
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 12px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #3498db, #9b59b6);
            border-radius: 4px;
            transition: width 0.8s ease;
            box-shadow: 0 0 10px rgba(155, 89, 182, 0.5);
        }

        .progress-steps-mini {
            display: flex;
            justify-content: space-between;
            font-size: 10px;
            color: rgba(255, 255, 255, 0.6);
        }

        .step-mini {
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .step-mini.active {
            color: #9b59b6;
            font-weight: 600;
        }

        .step-mini.completed {
            color: #2ecc71;
        }

        /* Information Cards */
        .info-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 14px;
            margin-bottom: 14px;
        }

        .info-card-title {
            color: #3498db;
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .info-card-content {
            color: rgba(255, 255, 255, 0.85);
            font-size: 12px;
            line-height: 1.5;
        }

        .info-list {
            list-style: none;
            padding: 0;
        }

        .info-list li {
            padding: 6px 0;
            padding-left: 20px;
            position: relative;
            font-size: 12px;
            color: rgba(255, 255, 255, 0.8);
        }

        .info-list li:before {
            content: "→";
            position: absolute;
            left: 0;
            color: #9b59b6;
        }

        /* Fun Fact Box */
        .fun-fact {
            background: linear-gradient(135deg, rgba(46, 204, 113, 0.1), rgba(52, 152, 219, 0.1));
            border: 1px solid rgba(46, 204, 113, 0.3);
            border-radius: 12px;
            padding: 14px;
            margin: 16px 0;
            position: relative;
            overflow: hidden;
        }

        .fun-fact:before {
            content: "🧬";
            position: absolute;
            top: -20px;
            right: -20px;
            font-size: 60px;
            opacity: 0.1;
        }

        .fun-fact-title {
            color: #2ecc71;
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 6px;
        }

        .fun-fact-text {
            color: rgba(255, 255, 255, 0.9);
            font-size: 12px;
            line-height: 1.5;
            position: relative;
            z-index: 1;
        }

        /* Voice Controls */
        .voice-controls {
            position: absolute;
            top: 10px;
            right: 20px;
            display: flex;
            gap: 8px;
            z-index: 1000;
        }

        .control-btn {
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            width: 44px;
            height: 44px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            position: relative;
        }

        .control-btn:hover {
            background: rgba(155, 89, 182, 0.3);
            border-color: #9b59b6;
            transform: scale(1.1);
        }

        .control-btn.active {
            background: rgba(155, 89, 182, 0.4);
            border-color: #9b59b6;
            box-shadow: 0 0 20px rgba(155, 89, 182, 0.5);
        }

        .control-tooltip {
            position: absolute;
            bottom: -30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9);
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 10px;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .control-btn:hover .control-tooltip {
            opacity: 1;
        }

        /* Loading Screen */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #4a90e2 0%, #7b68ee 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            transition: opacity 1s ease;
        }

        .loading-content {
            text-align: center;
        }

        .loading-dna {
            font-size: 60px;
            animation: spin 2s linear infinite;
            margin-bottom: 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            color: white;
            font-size: 20px;
            margin-bottom: 20px;
        }

        .loading-progress {
            width: 200px;
            height: 4px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 2px;
            overflow: hidden;
        }

        .loading-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #9b59b6, #3498db);
            animation: loading 2s ease-in-out infinite;
        }

        @keyframes loading {
            0% { width: 0%; }
            50% { width: 100%; }
            100% { width: 0%; }
        }

        /* Voice Indicator */
        .voice-indicator {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(155, 89, 182, 0.5);
            border-radius: 30px;
            padding: 14px 28px;
            display: flex;
            align-items: center;
            gap: 12px;
            z-index: 1000;
            opacity: 0;
            transition: all 0.3s ease;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }

        .voice-indicator.visible {
            opacity: 1;
            transform: translateX(-50%) translateY(-10px);
        }

        .voice-waves {
            display: flex;
            align-items: center;
            gap: 3px;
        }

        .voice-wave {
            width: 3px;
            height: 20px;
            background: linear-gradient(180deg, #9b59b6, #3498db);
            border-radius: 2px;
            animation: voice-wave 1s ease-in-out infinite;
        }

        .voice-wave:nth-child(2) { animation-delay: 0.1s; }
        .voice-wave:nth-child(3) { animation-delay: 0.2s; }
        .voice-wave:nth-child(4) { animation-delay: 0.3s; }
        .voice-wave:nth-child(5) { animation-delay: 0.4s; }

        @keyframes voice-wave {
            0%, 100% { transform: scaleY(0.3); }
            50% { transform: scaleY(1); }
        }

        .narration-text {
            color: white;
            font-size: 13px;
            max-width: 300px;
        }

        /* Quick Actions */
        .quick-actions {
            position: absolute;
            bottom: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            z-index: 1000;
        }

        .action-btn {
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 10px 16px;
            border-radius: 25px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
        }

        .action-btn:hover {
            background: rgba(52, 152, 219, 0.3);
            border-color: #3498db;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(52, 152, 219, 0.3);
        }

        /* Custom Scrollbar */
        .info-panel::-webkit-scrollbar {
            width: 6px;
        }

        .info-panel::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 3px;
        }

        .info-panel::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, #9b59b6, #3498db);
            border-radius: 3px;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .info-panel {
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                top: auto;
                width: 100%;
                max-height: 50vh;
                border-radius: 20px 20px 0 0;
            }
            
            .journey-navigation {
                bottom: 52vh;
                max-width: calc(100% - 40px);
            }
            
            .voice-controls {
                top: auto;
                bottom: 55vh;
                right: 10px;
            }
            
            .quick-actions {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="bg-animation"></div>

    <!-- Loading Screen -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-content">
            <div class="loading-dna">🧬</div>
            <div class="loading-text">Preparing Your Genetic Journey...</div>
            <div class="loading-progress">
                <div class="loading-progress-bar"></div>
            </div>
        </div>
    </div>

    <!-- Museum Header -->
    <div class="museum-header">
        <div class="museum-title">Nucleus and Genetic Material</div>
        <div class="exhibit-subtitle">
            <span class="dna-indicator"></span>
            The Command Center of Life
        </div>
    </div>

    <!-- Journey Navigation -->
    <div class="journey-navigation">
        <div class="journey-title">
            <span>🧬</span>
            <span>Your Genetic Journey</span>
        </div>
        <div class="journey-steps">
            <button class="journey-btn active" onclick="loadJourneyStep('nucleus')">
                <span>🏛️</span> Nucleus
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('chromosome')">
                <span>🧬</span> Chromosomes
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('eukaryotic')">
                <span>🔬</span> Eukaryotic
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('prokaryotic')">
                <span>🦠</span> Prokaryotic
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('virus')">
                <span>🦠</span> Virus
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('comparison')">
                <span>⚖️</span> Compare
            </button>
        </div>
    </div>

    <!-- 3D Model Container -->
    <div class="model-container">
        <div class="sketchfab-embed-wrapper">
            <iframe id="api-frame"
                    title="Nucleus Structure Model" 
                    frameborder="0" 
                    allowfullscreen 
                    mozallowfullscreen="true" 
                    webkitallowfullscreen="true" 
                    allow="autoplay; fullscreen; xr-spatial-tracking"
                    xr-spatial-tracking 
                    execution-while-out-of-viewport 
                    execution-while-not-rendered 
                    web-share 
                    src="https://sketchfab.com/3d-models/nucleus-cell-organelles-7e01bff42b2d47fab640503bcef071e6/embed?autostart=1&internal=1&tracking=0&ui_ar=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0">
            </iframe>
        </div>
    </div>

    <!-- Information Panel -->
    <div class="info-panel" id="infoPanel">
        <div class="info-header">
            <div class="info-icon" id="stepIcon">🏛️</div>
            <div class="info-title">
                <h2 id="stepTitle">The Nucleus - Control Center</h2>
                <div class="info-subtitle" id="stepSubtitle">Where genetic material resides</div>
            </div>
        </div>

        <!-- Progress Tracker -->
        <div class="progress-tracker">
            <div class="progress-header">
                <span>Journey Progress</span>
                <span class="progress-percentage" id="progressPercent">0%</span>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 0%"></div>
            </div>
            <div class="progress-steps-mini">
                <span class="step-mini active" onclick="loadJourneyStep('nucleus')">Nucleus</span>
                <span class="step-mini" onclick="loadJourneyStep('chromosome')">Chromosomes</span>
                <span class="step-mini" onclick="loadJourneyStep('eukaryotic')">Eukaryotic</span>
                <span class="step-mini" onclick="loadJourneyStep('prokaryotic')">Prokaryotic</span>
                <span class="step-mini" onclick="loadJourneyStep('virus')">Virus</span>
                <span class="step-mini" onclick="loadJourneyStep('comparison')">Compare</span>
            </div>
        </div>

        <div class="info-content" id="mainDescription">
            Welcome to the nucleus - the command center of eukaryotic cells! This membrane-bound organelle houses the cell's precious genetic material and controls all cellular activities. Like a secure vault, the nuclear membrane protects DNA while nuclear pores allow controlled communication with the rest of the cell.
        </div>

        <div class="info-card">
            <div class="info-card-title">
                <span>🔬</span> Key Features
            </div>
            <div class="info-card-content">
                <ul class="info-list" id="keyConcepts">
                    <li>Double membrane (nuclear envelope)</li>
                    <li>Nuclear pores for transport</li>
                    <li>Nucleolus for ribosome assembly</li>
                    <li>Chromatin containing DNA and proteins</li>
                </ul>
            </div>
        </div>

        <div class="fun-fact">
            <div class="fun-fact-title">Amazing Fact!</div>
            <div class="fun-fact-text" id="funFact">
                The nucleus contains about 2 meters of DNA packed into a space smaller than a period at the end of this sentence!
            </div>
        </div>

        <div class="info-card">
            <div class="info-card-title">
                <span>🎯</span> Learning Objectives
            </div>
            <div class="info-card-content" id="learningObjectives">
                By exploring this section, you'll understand how the nucleus controls cellular activities and protects genetic information.
            </div>
        </div>
    </div>

    <!-- Voice Controls -->
    <div class="voice-controls">
        <button class="control-btn active" id="voiceToggle" onclick="toggleVoice()">
            🔊
            <span class="control-tooltip">Voice Narration</span>
        </button>
        <button class="control-btn" onclick="toggleAutoPlay()">
            ▶️
            <span class="control-tooltip">Auto Journey</span>
        </button>
        <button class="control-btn" onclick="toggleInfo()">
            ℹ️
            <span class="control-tooltip">Toggle Info</span>
        </button>
    </div>

    <!-- Quick Actions -->
    <div class="quick-actions">
        <button class="action-btn" onclick="startGuidedTour()">
            <span>🚀</span> Guided Tour
        </button>
        <button class="action-btn" onclick="showQuiz()">
            <span>🎯</span> Test Knowledge
        </button>
    </div>

    <!-- Voice Indicator -->
    <div class="voice-indicator" id="voiceIndicator">
        <div class="voice-waves">
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
        </div>
        <div class="narration-text" id="narrationText">Narrating...</div>
    </div>

    <script>
        // Journey Step Data with Complete Pedagogical Content
        const JOURNEY_DATA = {
            nucleus: {
                title: "The Nucleus - Control Center",
                subtitle: "Where genetic material resides",
                icon: "🏛️",
                modelUrl: "https://sketchfab.com/3d-models/nucleus-cell-organelles-7e01bff42b2d47fab640503bcef071e6/embed?autostart=1&internal=1&tracking=0&ui_ar=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "Welcome to the nucleus - the command center of eukaryotic cells! This membrane-bound organelle houses the cell's precious genetic material and controls all cellular activities. Like a secure vault, the nuclear membrane protects DNA while nuclear pores allow controlled communication with the rest of the cell.",
                concepts: [
                    "Double membrane (nuclear envelope)",
                    "Nuclear pores for transport",
                    "Nucleolus for ribosome assembly", 
                    "Chromatin containing DNA and proteins"
                ],
                funFact: "The nucleus contains about 2 meters of DNA packed into a space smaller than a period at the end of this sentence!",
                objectives: "By exploring this section, you'll understand how the nucleus controls cellular activities and protects genetic information.",
                narration: "Welcome to the nucleus, the brain of the eukaryotic cell! This remarkable structure is surrounded by a double membrane called the nuclear envelope, which acts like a security barrier protecting the cell's most valuable possession - its DNA. Notice the tiny holes scattered across the nuclear membrane? These are nuclear pores, sophisticated gateways that control what enters and exits the nucleus. Inside, you can see the nucleolus, a dense region where ribosomes are assembled. The rest of the nucleus is filled with chromatin - a complex of DNA and proteins that contains all the instructions needed to run the cell. When a cell divides, this chromatin condenses into visible chromosomes. The nucleus is like a library and control room combined, storing genetic information and coordinating all cellular activities!"
            },
            chromosome: {
                title: "Chromosomes - Genetic Packages",
                subtitle: "DNA organization at its finest",
                icon: "🧬",
                modelUrl: "https://sketchfab.com/models/cc33bb1ebe6141b08d0d06f1bbebc2b7/embed?autostart=1&internal=1&tracking=0&ui_ar=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "Chromosomes are the ultimate storage solution for genetic information! These X-shaped structures appear when cells divide, representing DNA at its most organized and compact form. Each chromosome contains hundreds to thousands of genes wrapped around histone proteins.",
                concepts: [
                    "Condensed chromatin structure",
                    "Sister chromatids joined at centromere",
                    "Histone proteins organize DNA",
                    "Contains genes for specific traits"
                ],
                funFact: "Human cells have 46 chromosomes, and if you unraveled all the DNA from just one cell, it would stretch about 2 meters!",
                objectives: "Learn how DNA is packaged into chromosomes and understand the relationship between chromatin and chromosome states.",
                narration: "Behold the chromosome - DNA's most organized form! This iconic X-shaped structure represents the peak of genetic packaging efficiency. What you're seeing are actually two identical copies called sister chromatids, held together at the narrow waist called the centromere. Notice how tightly coiled the DNA appears? This is thanks to special proteins called histones that act like molecular spools, wrapping DNA around them like thread. This incredible compaction allows 2 meters of DNA to fit into a nucleus that's only 10 micrometers across! Each chromosome carries hundreds or thousands of genes - specific DNA sequences that code for proteins. Humans have 23 pairs of chromosomes, with one set inherited from each parent. During most of the cell's life, chromosomes exist as loose, uncoiled chromatin, but they condense into this tight structure only when the cell is ready to divide."
            },
            eukaryotic: {
                title: "Eukaryotic Cell - Complex Organization",
                subtitle: "Membrane-bound nucleus and organelles",
                icon: "🔬",
                modelUrl: "https://sketchfab.com/3d-models/eukaryotic-cell-cross-section-74f714127a8c4211bb1a2cac7195fb1a/embed?autostart=1&internal=1&tracking=0&ui_ar=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "Step inside a eukaryotic cell and discover the sophisticated compartmentalization that makes complex life possible! The membrane-bound nucleus is just one of many specialized organelles working together in this cellular city.",
                concepts: [
                    "Membrane-bound nucleus",
                    "Specialized organelles (mitochondria, ER, Golgi)",
                    "Complex internal organization",
                    "Found in plants, animals, fungi, protists"
                ],
                funFact: "Eukaryotic cells can be 1000 times larger than prokaryotic cells because their organized structure allows for more efficient transport!",
                objectives: "Explore the complex organization of eukaryotic cells and understand how compartmentalization enables cellular complexity.",
                narration: "Welcome to the sophisticated world of eukaryotic cells! This cross-section reveals the intricate organization that makes complex life possible. At the center sits the nucleus, safely housing the cell's DNA behind its protective double membrane. But that's just the beginning of this cellular metropolis! Notice the mitochondria - the cell's powerhouses that generate energy. See the endoplasmic reticulum extending from the nuclear membrane, serving as a highway for protein and lipid synthesis. The Golgi apparatus processes and packages proteins like a cellular post office. Ribosomes, either free-floating or attached to the ER, manufacture proteins following DNA's instructions. This compartmentalization is the key to eukaryotic success - by separating different cellular functions into specialized organelles, these cells can perform multiple complex tasks simultaneously. It's like having different departments in a company, each with its own specialized role but all working toward the same goal - keeping the cell alive and functioning!"
            },
            prokaryotic: {
                title: "Prokaryotic Cell - Simple Yet Successful",
                subtitle: "No nucleus, nucleoid region",
                icon: "🦠",
                modelUrl: "https://sketchfab.com/3d-models/prokaryotic-cell-5473818c62724028b5883d02f36b7153/embed?autostart=1&internal=1&tracking=0&ui_ar=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "Prokaryotic cells prove that sometimes simple is better! These ancient cellular designs lack a membrane-bound nucleus but compensate with remarkable efficiency and adaptability. Their genetic material floats freely in the nucleoid region.",
                concepts: [
                    "No membrane-bound nucleus",
                    "Nucleoid region contains DNA",
                    "Simpler internal structure",
                    "Includes bacteria and archaea"
                ],
                funFact: "Prokaryotes have been on Earth for 3.5 billion years and can survive in extreme environments where eukaryotes cannot!",
                objectives: "Compare prokaryotic organization with eukaryotic cells and understand how genetic material is organized without a nucleus.",
                narration: "Meet the prokaryotic cell - proof that you don't need complexity to be successful! This ancient cellular design has been thriving on Earth for over 3.5 billion years. Unlike eukaryotic cells, there's no nucleus here. Instead, the genetic material - usually a single circular chromosome - floats freely in a region called the nucleoid. Notice how much simpler the internal structure appears? There are no membrane-bound organelles, just ribosomes scattered throughout the cytoplasm for protein synthesis. The cell wall provides structure and protection, while the cell membrane controls what enters and exits. Some prokaryotes have flagella for movement, like tiny molecular motors. This simplicity is actually a superpower - prokaryotes can reproduce incredibly quickly, adapt to harsh environments, and survive conditions that would kill eukaryotic cells. They're found everywhere from deep ocean vents to frozen tundra, making them the most abundant and diverse life forms on our planet!"
            },
            virus: {
                title: "Viruses - Not Quite Alive",
                subtitle: "Genetic material in a protein coat",
                icon: "🦠",
                modelUrl: "https://sketchfab.com/3d-models/influenza-virus-96e6b4e7f609491fb59843adda6ab3ca/embed?autostart=1&internal=1&tracking=0&ui_ar=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "Viruses challenge our definition of life! These microscopic entities consist of genetic material (DNA or RNA) wrapped in a protein coat called a capsid. They lack membranes, organelles, and the ability to reproduce independently.",
                concepts: [
                    "Genetic material (DNA or RNA)",
                    "Protein capsid coating",
                    "No cellular membranes",
                    "Cannot reproduce independently"
                ],
                funFact: "Viruses are so small that hundreds of them could fit inside a single bacterial cell, yet they can hijack entire organisms!",
                objectives: "Understand viral structure and learn why viruses are considered non-living entities that require host cells.",
                narration: "Enter the mysterious world of viruses - entities that exist at the boundary between living and non-living! This influenza virus shows the elegant simplicity of viral design. At the center lies genetic material - either DNA or RNA containing just a few essential genes. This genetic core is wrapped in a protein shell called a capsid, made of repeating protein units that form geometric patterns. Some viruses, like this one, have an additional outer envelope stolen from host cell membranes, studded with proteins that help the virus recognize and enter target cells. Viruses are molecular pirates - they have no cellular machinery of their own, no membranes, no organelles, and cannot reproduce independently. Instead, they hijack living cells, injecting their genetic material and forcing the host cell to become a virus factory. It's like a computer virus that takes over your computer's operating system! Despite their simplicity, viruses are incredibly successful, found everywhere life exists, and they play crucial roles in evolution and ecosystem balance."
            },
            comparison: {
                title: "The Great Comparison",
                subtitle: "Understanding cellular diversity",
                icon: "⚖️",
                modelUrl: "https://sketchfab.com/3d-models/eukaryotic-cell-cross-section-74f714127a8c4211bb1a2cac7195fb1a/embed?autostart=1&internal=1&tracking=0&ui_ar=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "Now that we've explored different forms of genetic organization, let's compare and contrast how life has evolved different strategies for storing and protecting genetic material. From simple viruses to complex eukaryotic cells!",
                concepts: [
                    "Membrane-bound vs free genetic material",
                    "Complexity vs efficiency trade-offs",
                    "Evolution of cellular organization",
                    "Advantages of each system"
                ],
                funFact: "All three types - prokaryotes, eukaryotes, and viruses - use the same genetic code, suggesting a common evolutionary origin!",
                objectives: "Synthesize knowledge about different cellular organizations and understand the evolutionary advantages of each system.",
                narration: "Let's bring together everything we've learned about genetic organization! We've journeyed from the sophisticated eukaryotic nucleus with its double membrane protection, to the simple but effective prokaryotic nucleoid, to the minimal virus with just genetic material in a protein coat. Each represents a different evolutionary solution to the same fundamental problem: how to store, protect, and transmit genetic information. Eukaryotes chose compartmentalization - separating functions into specialized organelles allows for complexity but requires more energy. Prokaryotes opted for simplicity - free-floating DNA means faster reproduction and adaptation but limits cell size and complexity. Viruses took minimalism to the extreme - just the essential genetic information needed to hijack host cells. Remarkably, all three use the same genetic code, suggesting they share a common ancestor. This diversity shows us that there's no single 'best' way to organize life - each system has evolved advantages for different environmental challenges and evolutionary pressures!"
            }
        };

        // Global Variables
        let currentStep = 'nucleus';
        let voiceEnabled = true;
        let autoPlayEnabled = false;
        let currentSpeech = null;
        let selectedVoice = null;
        let journeyProgress = 0;
        let guidedTourActive = false;

        // Initialize Voice System
        function initVoiceSystem() {
            if (!('speechSynthesis' in window)) {
                console.warn('Speech synthesis not supported');
                voiceEnabled = false;
                document.getElementById('voiceToggle').style.display = 'none';
                return;
            }

            function loadVoices() {
                const voices = speechSynthesis.getVoices();
                if (voices.length === 0) return;

                // Prefer natural-sounding voices
                const preferredVoices = [
                    'Google UK English Female',
                    'Microsoft Sonia',
                    'Microsoft Hazel',
                    'Samantha',
                    'Victoria'
                ];

                for (const name of preferredVoices) {
                    selectedVoice = voices.find(v => v.name.includes(name));
                    if (selectedVoice) break;
                }

                if (!selectedVoice) {
                    selectedVoice = voices.find(v => v.lang.startsWith('en'));
                }
            }

            loadVoices();
            if (speechSynthesis.onvoiceschanged !== undefined) {
                speechSynthesis.onvoiceschanged = loadVoices;
            }
        }

        // Load Journey Step
        function loadJourneyStep(stepId) {
            const stepData = JOURNEY_DATA[stepId];
            if (!stepData) return;

            currentStep = stepId;
            
            // Update model
            document.getElementById('api-frame').src = stepData.modelUrl;
            
            // Update info panel
            document.getElementById('stepIcon').textContent = stepData.icon;
            document.getElementById('stepTitle').textContent = stepData.title;
            document.getElementById('stepSubtitle').textContent = stepData.subtitle;
            document.getElementById('mainDescription').textContent = stepData.description;
            
            // Update key concepts
            const conceptsList = document.getElementById('keyConcepts');
            conceptsList.innerHTML = stepData.concepts.map(c => `<li>${c}</li>`).join('');
            
            // Update fun fact
            document.getElementById('funFact').textContent = stepData.funFact;
            
            // Update learning objectives
            document.getElementById('learningObjectives').textContent = stepData.objectives;
            
            // Update navigation buttons
            updateNavigationButtons(stepId);
            
            // Update progress
            updateProgress();
            
            // Play narration if enabled
            if (voiceEnabled) {
                speakText(stepData.narration);
            }
        }

        // Update Navigation Buttons
        function updateNavigationButtons(activeStep) {
            const buttons = document.querySelectorAll('.journey-btn');
            const steps = ['nucleus', 'chromosome', 'eukaryotic', 'prokaryotic', 'virus', 'comparison'];
            const activeIndex = steps.indexOf(activeStep);
            
            buttons.forEach((btn, index) => {
                btn.classList.remove('active', 'completed');
                if (index < activeIndex) {
                    btn.classList.add('completed');
                } else if (index === activeIndex) {
                    btn.classList.add('active');
                }
            });
            
            // Update mini steps
            const miniSteps = document.querySelectorAll('.step-mini');
            miniSteps.forEach((step, index) => {
                step.classList.remove('active', 'completed');
                if (index < activeIndex) {
                    step.classList.add('completed');
                } else if (index === activeIndex) {
                    step.classList.add('active');
                }
            });
        }

        // Update Progress
        function updateProgress() {
            const steps = ['nucleus', 'chromosome', 'eukaryotic', 'prokaryotic', 'virus', 'comparison'];
            const currentIndex = steps.indexOf(currentStep);
            const progress = ((currentIndex + 1) / steps.length) * 100;
            
            document.getElementById('progressPercent').textContent = Math.round(progress) + '%';
            document.getElementById('progressFill').style.width = progress + '%';
        }

        // Speech Functions
        function speakText(text) {
            if (!voiceEnabled || !text) return;
            
            stopSpeech();
            
            currentSpeech = new SpeechSynthesisUtterance(text);
            if (selectedVoice) {
                currentSpeech.voice = selectedVoice;
            }
            currentSpeech.rate = 0.9;
            currentSpeech.pitch = 1.0;
            currentSpeech.volume = 0.9;
            
            currentSpeech.onstart = () => {
                document.getElementById('voiceIndicator').classList.add('visible');
                document.getElementById('narrationText').textContent = 
                    text.substring(0, 50) + (text.length > 50 ? '...' : '');
            };
            
            currentSpeech.onend = () => {
                document.getElementById('voiceIndicator').classList.remove('visible');
                currentSpeech = null;
                
                // Auto-advance if guided tour is active
                if (guidedTourActive) {
                    setTimeout(nextStep, 2000);
                }
            };
            
            speechSynthesis.speak(currentSpeech);
        }

        function stopSpeech() {
            if (currentSpeech) {
                speechSynthesis.cancel();
                currentSpeech = null;
                document.getElementById('voiceIndicator').classList.remove('visible');
            }
        }

        // Control Functions
        function toggleVoice() {
            voiceEnabled = !voiceEnabled;
            const btn = document.getElementById('voiceToggle');
            btn.textContent = voiceEnabled ? '🔊' : '🔇';
            btn.classList.toggle('active', voiceEnabled);
            
            if (!voiceEnabled) {
                stopSpeech();
            }
        }

        function toggleAutoPlay() {
            autoPlayEnabled = !autoPlayEnabled;
            if (autoPlayEnabled) {
                startGuidedTour();
            } else {
                guidedTourActive = false;
            }
        }

        function toggleInfo() {
            const panel = document.getElementById('infoPanel');
            panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
        }

        // Guided Tour
        function startGuidedTour() {
            guidedTourActive = true;
            const steps = ['nucleus', 'chromosome', 'eukaryotic', 'prokaryotic', 'virus', 'comparison'];
            let stepIndex = 0;
            
            function tourStep() {
                if (stepIndex < steps.length && guidedTourActive) {
                    loadJourneyStep(steps[stepIndex]);
                    stepIndex++;
                } else {
                    guidedTourActive = false;
                    if (voiceEnabled) {
                        speakText("Congratulations! You've completed your journey through genetic organization and cellular diversity. You now understand how different forms of life store and protect their genetic information!");
                    }
                }
            }
            
            tourStep();
            window.nextStep = tourStep;
        }

        // Quiz Function
        function showQuiz() {
            const questions = [
                "What protects the genetic material in eukaryotic cells?",
                "Where is DNA located in prokaryotic cells?",
                "What is the protein coat of a virus called?",
                "How are chromosomes different from chromatin?",
                "Why are viruses considered non-living?"
            ];
            
            const randomQ = questions[Math.floor(Math.random() * questions.length)];
            
            if (voiceEnabled) {
                speakText(`Here's a question to test your knowledge: ${randomQ} Think about what you've learned in this genetic journey!`);
            }
        }

        // Initialize
        function init() {
            initVoiceSystem();
            
            // Hide loading screen
            setTimeout(() => {
                const loading = document.getElementById('loadingOverlay');
                loading.style.opacity = '0';
                setTimeout(() => {
                    loading.style.display = 'none';
                    
                    // Welcome message
                    if (voiceEnabled) {
                        speakText("Welcome to your journey through the nucleus and genetic material! We'll explore how different forms of life organize and protect their genetic information. Let's start with the nucleus - the command center of eukaryotic cells!");
                    }
                }, 1000);
            }, 3000);
            
            // Keyboard shortcuts
            document.addEventListener('keydown', (e) => {
                switch(e.key) {
                    case 'v': toggleVoice(); break;
                    case 'i': toggleInfo(); break;
                    case 'g': startGuidedTour(); break;
                    case 'Escape': stopSpeech(); guidedTourActive = false; break;
                    case 'ArrowRight': nextStep && nextStep(); break;
                }
            });
        }

        // Start the application
        init();
    </script>
</body>
</html>