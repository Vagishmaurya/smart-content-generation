<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cell Membrane and Transport Processes</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tween.js/18.6.4/tween.umd.js"></script>

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #0891b2 0%, #06b6d4 100%);
            color: white;
            overflow: hidden;
            position: relative;
            height: 100vh;
        }

        /* Animated Background */
        .bg-animation {
            position: fixed;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: 0;
            opacity: 0.1;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 320"><path fill="%23ffffff" fill-opacity="0.2" d="M0,96L48,112C96,128,192,160,288,186.7C384,213,480,235,576,213.3C672,192,768,128,864,128C960,128,1056,192,1152,197.3C1248,203,1344,149,1392,122.7L1440,96L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z"></path></svg>') repeat-x;
            animation: wave 10s linear infinite;
        }

        @keyframes wave {
            0% { background-position-x: 0; }
            100% { background-position-x: 1440px; }
        }

        /* Museum Interface - Compact Header */
        .museum-header {
            position: absolute;
            top: 10px;
            left: 20px;
            text-align: left;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            padding: 10px 18px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .museum-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 4px;
            background: linear-gradient(45deg, #67e8f9, #22d3ee);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: titleGlow 3s ease-in-out infinite;
        }

        @keyframes titleGlow {
            0%, 100% { filter: brightness(1); }
            50% { filter: brightness(1.2); }
        }

        .exhibit-subtitle {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.8);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .transport-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            background: #67e8f9;
            border-radius: 50%;
            animation: transport-flow 2s ease-in-out infinite;
        }

        @keyframes transport-flow {
            0%, 100% { transform: scale(1) translateX(0); opacity: 1; }
            50% { transform: scale(1.2) translateX(3px); opacity: 0.8; }
        }

        /* Journey Navigation - Enhanced */
        .journey-navigation {
            position: absolute;
            bottom: 20px;
            left: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            padding: 15px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            max-width: 320px;
        }

        .journey-title {
            font-size: 14px;
            font-weight: 600;
            color: #67e8f9;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .journey-steps {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }

        .journey-btn {
            background: rgba(103, 232, 249, 0.2);
            border: 1px solid rgba(103, 232, 249, 0.4);
            color: white;
            padding: 6px 10px;
            border-radius: 20px;
            font-size: 11px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 4px;
            white-space: nowrap;
        }

        .journey-btn:hover {
            background: rgba(103, 232, 249, 0.3);
            border-color: #67e8f9;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(103, 232, 249, 0.3);
        }

        .journey-btn.active {
            background: linear-gradient(135deg, #0891b2, #67e8f9);
            border-color: #0891b2;
            box-shadow: 0 0 20px rgba(8, 145, 178, 0.5);
            animation: pulse 2s infinite;
        }

        .journey-btn.completed {
            background: rgba(46, 204, 113, 0.3);
            border-color: #2ecc71;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        /* 3D Model Container */
        .model-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 0;
            overflow: hidden;
            border: none;
            z-index: 100;
        }

        .sketchfab-embed-wrapper {
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #0891b2 0%, #06b6d4 100%);
        }

        .sketchfab-embed-wrapper iframe {
            width: 100%;
            height: 100%;
            border: none;
            border-radius: 0;
        }

        /* Information Panel - Enhanced */
        .info-panel {
            position: absolute;
            top: 70px;
            right: 20px;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(25px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 16px;
            padding: 24px;
            width: 380px;
            max-height: calc(100vh - 140px);
            z-index: 800;
            overflow-y: auto;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }

        .info-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        }

        .info-icon {
            font-size: 28px;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        .info-title {
            flex: 1;
        }

        .info-title h2 {
            font-size: 18px;
            color: #67e8f9;
            margin-bottom: 4px;
        }

        .info-subtitle {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.7);
        }

        .info-content {
            color: rgba(255, 255, 255, 0.9);
            font-size: 14px;
            line-height: 1.6;
        }

        /* Progress Tracker */
        .progress-tracker {
            background: linear-gradient(135deg, rgba(103, 232, 249, 0.1), rgba(8, 145, 178, 0.1));
            border: 1px solid rgba(103, 232, 249, 0.3);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 20px;
        }

        .progress-header {
            font-size: 13px;
            font-weight: 600;
            color: #67e8f9;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .progress-percentage {
            font-size: 18px;
            color: #0891b2;
            font-weight: 700;
        }

        .progress-bar {
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 12px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #67e8f9, #0891b2);
            border-radius: 4px;
            transition: width 0.8s ease;
            box-shadow: 0 0 10px rgba(8, 145, 178, 0.5);
        }

        .progress-steps-mini {
            display: flex;
            justify-content: space-between;
            font-size: 10px;
            color: rgba(255, 255, 255, 0.6);
        }

        .step-mini {
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .step-mini.active {
            color: #0891b2;
            font-weight: 600;
        }

        .step-mini.completed {
            color: #2ecc71;
        }

        /* Information Cards */
        .info-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 14px;
            margin-bottom: 14px;
        }

        .info-card-title {
            color: #67e8f9;
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .info-card-content {
            color: rgba(255, 255, 255, 0.85);
            font-size: 12px;
            line-height: 1.5;
        }

        .info-list {
            list-style: none;
            padding: 0;
        }

        .info-list li {
            padding: 6px 0;
            padding-left: 20px;
            position: relative;
            font-size: 12px;
            color: rgba(255, 255, 255, 0.8);
        }

        .info-list li:before {
            content: "💧";
            position: absolute;
            left: 0;
            font-size: 10px;
        }

        /* Fun Fact Box */
        .fun-fact {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(37, 99, 235, 0.1));
            border: 1px solid rgba(59, 130, 246, 0.3);
            border-radius: 12px;
            padding: 14px;
            margin: 16px 0;
            position: relative;
            overflow: hidden;
        }

        .fun-fact:before {
            content: "🌊";
            position: absolute;
            top: -20px;
            right: -20px;
            font-size: 60px;
            opacity: 0.1;
        }

        .fun-fact-title {
            color: #3b82f6;
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 6px;
        }

        .fun-fact-text {
            color: rgba(255, 255, 255, 0.9);
            font-size: 12px;
            line-height: 1.5;
            position: relative;
            z-index: 1;
        }

        /* Voice Controls */
        .voice-controls {
            position: absolute;
            top: 10px;
            right: 20px;
            display: flex;
            gap: 8px;
            z-index: 1000;
        }

        .control-btn {
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            width: 44px;
            height: 44px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            position: relative;
        }

        .control-btn:hover {
            background: rgba(8, 145, 178, 0.3);
            border-color: #0891b2;
            transform: scale(1.1);
        }

        .control-btn.active {
            background: rgba(8, 145, 178, 0.4);
            border-color: #0891b2;
            box-shadow: 0 0 20px rgba(8, 145, 178, 0.5);
        }

        .control-tooltip {
            position: absolute;
            bottom: -30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9);
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 10px;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .control-btn:hover .control-tooltip {
            opacity: 1;
        }

        /* Loading Screen */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #0891b2 0%, #06b6d4 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            transition: opacity 1s ease;
        }

        .loading-content {
            text-align: center;
        }

        .loading-transport {
            font-size: 60px;
            animation: transport-flow 1.5s ease-in-out infinite;
            margin-bottom: 20px;
        }

        .loading-text {
            color: white;
            font-size: 20px;
            margin-bottom: 20px;
        }

        .loading-progress {
            width: 200px;
            height: 4px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 2px;
            overflow: hidden;
        }

        .loading-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #0891b2, #67e8f9);
            animation: loading 2s ease-in-out infinite;
        }

        @keyframes loading {
            0% { width: 0%; }
            50% { width: 100%; }
            100% { width: 0%; }
        }

        /* Voice Indicator */
        .voice-indicator {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(8, 145, 178, 0.5);
            border-radius: 30px;
            padding: 14px 28px;
            display: flex;
            align-items: center;
            gap: 12px;
            z-index: 1000;
            opacity: 0;
            transition: all 0.3s ease;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }

        .voice-indicator.visible {
            opacity: 1;
            transform: translateX(-50%) translateY(-10px);
        }

        .voice-waves {
            display: flex;
            align-items: center;
            gap: 3px;
        }

        .voice-wave {
            width: 3px;
            height: 20px;
            background: linear-gradient(180deg, #0891b2, #67e8f9);
            border-radius: 2px;
            animation: voice-wave 1s ease-in-out infinite;
        }

        .voice-wave:nth-child(2) { animation-delay: 0.1s; }
        .voice-wave:nth-child(3) { animation-delay: 0.2s; }
        .voice-wave:nth-child(4) { animation-delay: 0.3s; }
        .voice-wave:nth-child(5) { animation-delay: 0.4s; }

        @keyframes voice-wave {
            0%, 100% { transform: scaleY(0.3); }
            50% { transform: scaleY(1); }
        }

        .narration-text {
            color: white;
            font-size: 13px;
            max-width: 300px;
        }

        /* Quick Actions */
        .quick-actions {
            position: absolute;
            bottom: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            z-index: 1000;
        }

        .action-btn {
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 10px 16px;
            border-radius: 25px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
        }

        .action-btn:hover {
            background: rgba(103, 232, 249, 0.3);
            border-color: #67e8f9;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(103, 232, 249, 0.3);
        }

        /* Custom Scrollbar */
        .info-panel::-webkit-scrollbar {
            width: 6px;
        }

        .info-panel::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 3px;
        }

        .info-panel::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, #0891b2, #67e8f9);
            border-radius: 3px;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .info-panel {
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                top: auto;
                width: 100%;
                max-height: 50vh;
                border-radius: 20px 20px 0 0;
            }
            
            .journey-navigation {
                bottom: 52vh;
                max-width: calc(100% - 40px);
            }
            
            .voice-controls {
                top: auto;
                bottom: 55vh;
                right: 10px;
            }
            
            .quick-actions {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="bg-animation"></div>

    <!-- Loading Screen -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-content">
            <div class="loading-transport">🧬</div>
            <div class="loading-text">Loading Membrane Transport Systems...</div>
            <div class="loading-progress">
                <div class="loading-progress-bar"></div>
            </div>
        </div>
    </div>

    <!-- Museum Header -->
    <div class="museum-header">
        <div class="museum-title">Cell Membrane & Transport</div>
        <div class="exhibit-subtitle">
            <span class="transport-indicator"></span>
            Controlling Cellular Traffic
        </div>
    </div>

    <!-- Journey Navigation -->
    <div class="journey-navigation">
        <div class="journey-title">
            <span>🧬</span>
            <span>Transport Journey</span>
        </div>
        <div class="journey-steps">
            <button class="journey-btn active" onclick="loadJourneyStep('introduction')">
                <span>🏠</span> Introduction
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('structure')">
                <span>🧱</span> Structure
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('permeability')">
                <span>🚪</span> Permeability
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('diffusion')">
                <span>💨</span> Diffusion
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('osmosis')">
                <span>💧</span> Osmosis
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('endocytosis')">
                <span>🍽️</span> Endocytosis
            </button>
        </div>
    </div>

    <!-- 3D Model Container -->
    <div class="model-container">
        <div class="sketchfab-embed-wrapper">
            <iframe id="api-frame"
                    title="Membrane Transport" 
                    frameborder="0" 
                    allowfullscreen 
                    mozallowfullscreen="true" 
                    webkitallowfullscreen="true" 
                    allow="autoplay; fullscreen; xr-spatial-tracking"
                    xr-spatial-tracking 
                    execution-while-out-of-viewport 
                    execution-while-not-rendered 
                    web-share 
                    src="https://sketchfab.com/3d-models/plasma-membrane-53304c29aa2c41479488f06d3470c796/embed?autostart=1&internal=1&tracking=0&ui_ar=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0">
            </iframe>
        </div>
    </div>

    <!-- Information Panel -->
    <div class="info-panel" id="infoPanel">
        <div class="info-header">
            <div class="info-icon" id="stepIcon">🏠</div>
            <div class="info-title">
                <h2 id="stepTitle">Cell Membrane and Transport</h2>
                <div class="info-subtitle" id="stepSubtitle">The gateway controlling cellular life</div>
            </div>
        </div>

        <!-- Progress Tracker -->
        <div class="progress-tracker">
            <div class="progress-header">
                <span>Transport Mastery</span>
                <span class="progress-percentage" id="progressPercent">0%</span>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 0%"></div>
            </div>
            <div class="progress-steps-mini">
                <span class="step-mini active" onclick="loadJourneyStep('introduction')">Intro</span>
                <span class="step-mini" onclick="loadJourneyStep('structure')">Struct.</span>
                <span class="step-mini" onclick="loadJourneyStep('permeability')">Perm.</span>
                <span class="step-mini" onclick="loadJourneyStep('diffusion')">Diffus.</span>
                <span class="step-mini" onclick="loadJourneyStep('osmosis')">Osmos.</span>
                <span class="step-mini" onclick="loadJourneyStep('endocytosis')">Endocy.</span>
            </div>
        </div>

        <div class="info-content" id="mainDescription">
            The cell membrane is a selective barrier that controls all molecular traffic entering and leaving the cell. Through various transport processes including diffusion, osmosis, and endocytosis, the membrane maintains cellular homeostasis while allowing essential exchanges with the environment.
        </div>

        <div class="info-card">
            <div class="info-card-title">
                <span>💧</span> Key Transport Concepts
            </div>
            <div class="info-card-content">
                <ul class="info-list" id="keyConcepts">
                    <li>Membrane controls what enters and exits cells</li>
                    <li>Selective permeability maintains cell function</li>
                    <li>Transport occurs via multiple mechanisms</li>
                    <li>Water balance is critical for cell survival</li>
                </ul>
            </div>
        </div>

        <div class="fun-fact">
            <div class="fun-fact-title">Membrane Magic</div>
            <div class="fun-fact-text" id="funFact">
                Cell membranes are only about 7 nanometers thick - if you could stack 10,000 membranes, they would be thinner than a human hair!
            </div>
        </div>

        <div class="info-card">
            <div class="info-card-title">
                <span>🎯</span> Learning Objectives
            </div>
            <div class="info-card-content" id="learningObjectives">
                Understand membrane structure, explore transport mechanisms, and learn how cells maintain proper water balance through osmotic regulation.
            </div>
        </div>
    </div>

    <!-- Voice Controls -->
    <div class="voice-controls">
        <button class="control-btn active" id="voiceToggle" onclick="toggleVoice()">
            🔊
            <span class="control-tooltip">Voice Narration</span>
        </button>
        <button class="control-btn" onclick="toggleAutoPlay()">
            ▶️
            <span class="control-tooltip">Auto Journey</span>
        </button>
        <button class="control-btn" onclick="toggleInfo()">
            ℹ️
            <span class="control-tooltip">Toggle Info</span>
        </button>
    </div>

    <!-- Quick Actions -->
    <div class="quick-actions">
        <button class="action-btn" onclick="startGuidedTour()">
            <span>🚀</span> Guided Tour
        </button>
        <button class="action-btn" onclick="showQuiz()">
            <span>🎯</span> Test Knowledge
        </button>
    </div>

    <!-- Voice Indicator -->
    <div class="voice-indicator" id="voiceIndicator">
        <div class="voice-waves">
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
        </div>
        <div class="narration-text" id="narrationText">Narrating...</div>
    </div>

    <script>
        // Journey Step Data with Complete Educational Content
        const JOURNEY_DATA = {
            introduction: {
                title: "Cell Membrane and Transport",
                subtitle: "The gateway controlling cellular life",
                icon: "🏠",
                modelUrl: "https://sketchfab.com/3d-models/plasma-membrane-53304c29aa2c41479488f06d3470c796/embed?autostart=1&internal=1&tracking=0&ui_ar=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "The cell membrane is a selective barrier that controls all molecular traffic entering and leaving the cell. Through various transport processes including diffusion, osmosis, and endocytosis, the membrane maintains cellular homeostasis while allowing essential exchanges with the environment.",
                concepts: [
                    "Membrane controls what enters and exits cells",
                    "Selective permeability maintains cell function",
                    "Transport occurs via multiple mechanisms",
                    "Water balance is critical for cell survival"
                ],
                funFact: "Cell membranes are only about 7 nanometers thick - if you could stack 10,000 membranes, they would be thinner than a human hair!",
                objectives: "Understand membrane structure, explore transport mechanisms, and learn how cells maintain proper water balance through osmotic regulation.",
                narration: "Welcome to the world of cell membranes and transport processes! You're looking at a plasma membrane - one of the most important structures in all of biology. This thin barrier surrounds every living cell and acts like a sophisticated security system, controlling everything that enters and leaves the cell. The membrane isn't just a simple wall - it's a dynamic, selective barrier that can distinguish between different molecules and allow only certain substances to pass through. This selective permeability is what keeps cells alive and functioning properly. Without proper membrane function, cells would either flood with harmful substances or lose essential molecules, leading to cell death. The membrane accomplishes this remarkable feat through various transport mechanisms, from simple diffusion that requires no energy, to complex processes like endocytosis that actively transport large materials. Understanding how membranes work helps us understand how cells maintain the delicate balance necessary for life, how they respond to their environment, and how they can malfunction in disease."
            },
            structure: {
                title: "Plasma Membrane Structure",
                subtitle: "Lipids and proteins in perfect harmony",
                icon: "🧱",
                modelUrl: "https://sketchfab.com/3d-models/plasma-membrane-53304c29aa2c41479488f06d3470c796/embed?autostart=1&internal=1&tracking=0&ui_ar=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "The plasma membrane consists of a phospholipid bilayer with embedded proteins. This fluid mosaic model shows how lipids provide the basic barrier while proteins enable specific transport and communication functions.",
                concepts: [
                    "Phospholipid bilayer forms the basic structure",
                    "Hydrophobic tails face inward, hydrophilic heads outward",
                    "Membrane proteins enable specific functions",
                    "Fluid mosaic model describes dynamic nature"
                ],
                funFact: "Membrane lipids can flip from one side to the other about once per month, but proteins almost never flip - they maintain their orientation throughout the membrane's lifetime!",
                objectives: "Examine the molecular architecture of cell membranes and understand how structure enables selective permeability.",
                narration: "Here's the incredible architecture of the plasma membrane! You're seeing the famous fluid mosaic model - a phospholipid bilayer with embedded proteins that work together like a sophisticated molecular machine. The phospholipids are the main structural components, arranged in two layers with their water-loving (hydrophilic) heads facing outward toward the watery environments inside and outside the cell, and their water-hating (hydrophobic) fatty acid tails facing inward, away from water. This arrangement creates a barrier that water-soluble molecules can't easily cross, but allows fat-soluble molecules to pass through. The proteins you see embedded in this lipid sea are the functional specialists - some act as channels for specific ions, others as carriers for larger molecules, and still others as receptors for chemical signals. Some proteins span the entire membrane, while others are anchored to just one side. The membrane is described as 'fluid' because the lipids can move laterally, giving the membrane flexibility and allowing it to bend and flex as the cell moves and changes shape. This dynamic structure is essential for many cellular processes, from simple transport to complex cell signaling."
            },
            permeability: {
                title: "Selective Permeability",
                subtitle: "Choosing what passes through",
                icon: "🚪",
                modelUrl: "https://sketchfab.com/3d-models/plasma-membrane-53304c29aa2c41479488f06d3470c796/embed?autostart=1&internal=1&tracking=0&ui_ar=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "Selective permeability means the membrane allows some substances to pass while blocking others. This selectivity is based on size, charge, and chemical properties, enabling cells to maintain their internal environment.",
                concepts: [
                    "Membrane permits some substances, blocks others",
                    "Small, nonpolar molecules pass easily",
                    "Large or charged molecules need assistance",
                    "Selectivity maintains cellular homeostasis"
                ],
                funFact: "Oxygen and carbon dioxide can cross membranes freely, but sodium ions need special protein channels - the difference in permeability can be millions of times greater!",
                objectives: "Understand how membrane selectivity works and why different molecules have different abilities to cross membranes.",
                narration: "Selective permeability is the membrane's superpower - its ability to act like a smart security gate that knows exactly what to let through and what to keep out! This selectivity isn't random; it follows specific rules based on the properties of both the membrane and the molecules trying to cross. Small, nonpolar molecules like oxygen, carbon dioxide, and water can slip through the lipid bilayer relatively easily. They're small enough to squeeze between the lipid molecules and don't interact strongly with the hydrophobic membrane interior. However, larger molecules and anything with an electrical charge faces much greater difficulty. Ions like sodium and potassium, despite being tiny, are blocked by the hydrophobic membrane core because they're charged and surrounded by water molecules. Large molecules like glucose and amino acids also can't pass through on their own, even though cells desperately need them. This is where membrane proteins become essential - they provide specific pathways for these important but membrane-impermeable substances. This selective permeability allows cells to accumulate nutrients, exclude toxins, maintain proper ion concentrations, and control their water content. It's the foundation of cellular homeostasis and the reason cells can exist as distinct entities separate from their environment."
            },
            diffusion: {
                title: "Diffusion and Simple Transport",
                subtitle: "Movement down concentration gradients",
                icon: "💨",
                modelUrl: "https://sketchfab.com/3d-models/plasma-membrane-53304c29aa2c41479488f06d3470c796/embed?autostart=1&internal=1&tracking=0&ui_ar=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "Diffusion is the passive movement of molecules from areas of high concentration to low concentration. This process requires no energy and continues until equilibrium is reached across the membrane.",
                concepts: [
                    "Molecules move from high to low concentration",
                    "No energy required - passive transport",
                    "Continues until equilibrium is reached",
                    "Rate depends on concentration gradient"
                ],
                funFact: "A molecule of oxygen can cross a cell membrane and travel from your lungs to your tissues in less than a minute, all through simple diffusion!",
                objectives: "Learn how concentration gradients drive molecular movement and understand the principles of passive transport.",
                narration: "Diffusion is nature's way of spreading things out evenly - it's the passive movement of molecules from where they're concentrated to where they're scarce. Imagine dropping food coloring into water and watching it spread until the color is uniform throughout. That's diffusion in action! In biological systems, diffusion drives the movement of many essential molecules across cell membranes. When there's a higher concentration of a substance on one side of the membrane than the other, molecules naturally move down this concentration gradient. No energy is required because the molecules are simply following the laws of physics - they move randomly, but statistically, more will move from the crowded side to the less crowded side. This process is crucial for gas exchange in your lungs, where oxygen diffuses from the air into your blood, and carbon dioxide diffuses from your blood into the air you exhale. The rate of diffusion depends on several factors: the steepness of the concentration gradient (bigger differences mean faster movement), the temperature (warmer means faster), and the properties of both the membrane and the diffusing molecule. Diffusion continues until equilibrium is reached - when concentrations are equal on both sides and there's no net movement in either direction."
            },
            osmosis: {
                title: "Osmosis and Water Balance",
                subtitle: "Water movement and cell survival",
                icon: "💧",
                modelUrl: "https://sketchfab.com/models/ccced2ebf03946f493896c202d809709/embed?autostart=1&internal=1&tracking=0&ui_ar=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "Osmosis is the diffusion of water across a membrane toward areas of higher solute concentration. Understanding hypotonic, isotonic, and hypertonic solutions is crucial for cell survival and medical applications.",
                concepts: [
                    "Water moves toward higher solute concentrations",
                    "Hypotonic: cell gains water and may burst",
                    "Isotonic: no net water movement",
                    "Hypertonic: cell loses water and shrinks"
                ],
                funFact: "Red blood cells placed in pure water will burst from osmotic pressure, while those in saltwater will shrivel up - that's why IV fluids must be carefully balanced!",
                objectives: "Understand osmotic principles and learn how different solutions affect cell shape and survival.",
                narration: "Welcome to the world of osmosis - the movement of water that can make the difference between life and death for cells! You're looking at red blood cells in different osmotic conditions, demonstrating how water balance affects cell survival. Osmosis is simply the diffusion of water across a membrane, but it follows special rules. Water always moves toward areas with higher concentrations of dissolved particles (solutes). Think of it this way: water is trying to dilute concentrated solutions to achieve balance. In a hypotonic solution (lower solute concentration outside), water rushes into the cell, causing it to swell and potentially burst like an overfilled balloon. This is why drinking too much pure water can actually be dangerous - it can cause your cells to swell. In an isotonic solution (equal solute concentrations), there's no net water movement, and cells maintain their normal shape. This is the goal for IV fluids in hospitals - they match your blood's solute concentration. In a hypertonic solution (higher solute concentration outside), water leaves the cell, causing it to shrink and wrinkle. This is what happens to cells in saltwater. Understanding osmosis is crucial not just for biology, but for medicine, agriculture, and even food preservation. It explains why plants wilt without water, why salting roads melts ice, and why proper hydration is essential for health."
            },
            endocytosis: {
                title: "Endocytosis - Cellular Eating",
                subtitle: "How cells engulf large materials",
                icon: "🍽️",
                modelUrl: "https://sketchfab.com/models/171a16a37c4347799e4838853fd84ffe/embed?autostart=1&internal=1&tracking=0&ui_ar=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "Endocytosis allows cells to take in large particles by wrapping membrane around them. Amoebas demonstrate this process when feeding, showing how cells can actively transport materials too large for normal membrane channels.",
                concepts: [
                    "Membrane wraps around large particles",
                    "Active process requiring energy",
                    "Types include phagocytosis and pinocytosis",
                    "Essential for nutrition and immune function"
                ],
                funFact: "An amoeba can engulf food particles larger than half its own size - imagine eating a hamburger bigger than your torso in one gulp!",
                objectives: "Observe endocytosis in action and understand how cells transport large materials across membranes.",
                narration: "Here's endocytosis in action - cellular eating at its finest! You're watching an amoeba, a single-celled organism that demonstrates one of the most fascinating transport processes in biology. When an amoeba encounters food - perhaps a bacterium or organic particle - it doesn't wait for the food to dissolve and diffuse across its membrane. Instead, it actively reaches out with extensions of its cell membrane and cytoplasm, called pseudopodia, and literally engulfs its meal! The membrane wraps around the food particle, forming a pocket that eventually pinches off inside the cell, creating a food vacuole. This process is called phagocytosis, or 'cell eating.' It's an energy-requiring, active process that allows cells to take in particles much larger than could ever pass through membrane pores or channels. There's also pinocytosis, or 'cell drinking,' where cells take in droplets of fluid and dissolved substances. Endocytosis isn't just for single-celled organisms - your immune cells use phagocytosis to engulf and destroy bacteria and viruses, and many of your cells use endocytosis to take in nutrients and other large molecules. This process shows how membranes aren't just passive barriers but can actively participate in transport, bending and reshaping to accomplish tasks impossible through simple diffusion."
            }
        };

        // Global Variables
        let currentStep = 'introduction';
        let voiceEnabled = true;
        let autoPlayEnabled = false;
        let currentSpeech = null;
        let selectedVoice = null;
        let journeyProgress = 0;
        let guidedTourActive = false;

        // Initialize Voice System
        function initVoiceSystem() {
            if (!('speechSynthesis' in window)) {
                console.warn('Speech synthesis not supported');
                voiceEnabled = false;
                document.getElementById('voiceToggle').style.display = 'none';
                return;
            }

            function loadVoices() {
                const voices = speechSynthesis.getVoices();
                if (voices.length === 0) return;

                const preferredVoices = [
                    'Google UK English Female',
                    'Microsoft Sonia',
                    'Microsoft Hazel',
                    'Samantha',
                    'Victoria'
                ];

                for (const name of preferredVoices) {
                    selectedVoice = voices.find(v => v.name.includes(name));
                    if (selectedVoice) break;
                }

                if (!selectedVoice) {
                    selectedVoice = voices.find(v => v.lang.startsWith('en'));
                }
            }

            loadVoices();
            if (speechSynthesis.onvoiceschanged !== undefined) {
                speechSynthesis.onvoiceschanged = loadVoices;
            }
        }

        // Load Journey Step
        function loadJourneyStep(stepId) {
            const stepData = JOURNEY_DATA[stepId];
            if (!stepData) return;

            currentStep = stepId;
            
            document.getElementById('api-frame').src = stepData.modelUrl;
            
            document.getElementById('stepIcon').textContent = stepData.icon;
            document.getElementById('stepTitle').textContent = stepData.title;
            document.getElementById('stepSubtitle').textContent = stepData.subtitle;
            document.getElementById('mainDescription').textContent = stepData.description;
            
            const conceptsList = document.getElementById('keyConcepts');
            conceptsList.innerHTML = stepData.concepts.map(c => `<li>${c}</li>`).join('');
            
            document.getElementById('funFact').textContent = stepData.funFact;
            document.getElementById('learningObjectives').textContent = stepData.objectives;
            
            updateNavigationButtons(stepId);
            updateProgress();
            
            if (voiceEnabled) {
                speakText(stepData.narration);
            }
        }

        // Update Navigation Buttons
        function updateNavigationButtons(activeStep) {
            const buttons = document.querySelectorAll('.journey-btn');
            const steps = ['introduction', 'structure', 'permeability', 'diffusion', 'osmosis', 'endocytosis'];
            const activeIndex = steps.indexOf(activeStep);
            
            buttons.forEach((btn, index) => {
                btn.classList.remove('active', 'completed');
                if (index < activeIndex) {
                    btn.classList.add('completed');
                } else if (index === activeIndex) {
                    btn.classList.add('active');
                }
            });
            
            const miniSteps = document.querySelectorAll('.step-mini');
            miniSteps.forEach((step, index) => {
                step.classList.remove('active', 'completed');
                if (index < activeIndex) {
                    step.classList.add('completed');
                } else if (index === activeIndex) {
                    step.classList.add('active');
                }
            });
        }

        // Update Progress
        function updateProgress() {
            const steps = ['introduction', 'structure', 'permeability', 'diffusion', 'osmosis', 'endocytosis'];
            const currentIndex = steps.indexOf(currentStep);
            const progress = ((currentIndex + 1) / steps.length) * 100;
            
            document.getElementById('progressPercent').textContent = Math.round(progress) + '%';
            document.getElementById('progressFill').style.width = progress + '%';
        }

        // Speech Functions
        function speakText(text) {
            if (!voiceEnabled || !text) return;
            
            stopSpeech();
            
            currentSpeech = new SpeechSynthesisUtterance(text);
            if (selectedVoice) {
                currentSpeech.voice = selectedVoice;
            }
            currentSpeech.rate = 0.9;
            currentSpeech.pitch = 1.0;
            currentSpeech.volume = 0.9;
            
            currentSpeech.onstart = () => {
                document.getElementById('voiceIndicator').classList.add('visible');
                document.getElementById('narrationText').textContent = 
                    text.substring(0, 50) + (text.length > 50 ? '...' : '');
            };
            
            currentSpeech.onend = () => {
                document.getElementById('voiceIndicator').classList.remove('visible');
                currentSpeech = null;
                
                if (guidedTourActive) {
                    setTimeout(nextStep, 2000);
                }
            };
            
            speechSynthesis.speak(currentSpeech);
        }

        function stopSpeech() {
            if (currentSpeech) {
                speechSynthesis.cancel();
                currentSpeech = null;
                document.getElementById('voiceIndicator').classList.remove('visible');
            }
        }

        // Control Functions
        function toggleVoice() {
            voiceEnabled = !voiceEnabled;
            const btn = document.getElementById('voiceToggle');
            btn.textContent = voiceEnabled ? '🔊' : '🔇';
            btn.classList.toggle('active', voiceEnabled);
            
            if (!voiceEnabled) {
                stopSpeech();
            }
        }

        function toggleAutoPlay() {
            autoPlayEnabled = !autoPlayEnabled;
            if (autoPlayEnabled) {
                startGuidedTour();
            } else {
                guidedTourActive = false;
            }
        }

        function toggleInfo() {
            const panel = document.getElementById('infoPanel');
            panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
        }

        // Guided Tour
        function startGuidedTour() {
            guidedTourActive = true;
            const steps = ['introduction', 'structure', 'permeability', 'diffusion', 'osmosis', 'endocytosis'];
            let stepIndex = 0;
            
            function tourStep() {
                if (stepIndex < steps.length && guidedTourActive) {
                    loadJourneyStep(steps[stepIndex]);
                    stepIndex++;
                } else {
                    guidedTourActive = false;
                    if (voiceEnabled) {
                        speakText("Outstanding! You've mastered cell membrane structure and transport processes. You now understand how membranes maintain selective permeability, control molecular traffic through diffusion and osmosis, and actively transport large materials through endocytosis. These processes are fundamental to all cellular life!");
                    }
                }
            }
            
            tourStep();
            window.nextStep = tourStep;
        }

        // Quiz Function
        function showQuiz() {
            const questions = [
                "How does the phospholipid bilayer structure enable selective permeability?",
                "What determines whether a molecule can freely cross the membrane?",
                "Why do cells swell in hypotonic solutions?",
                "How does diffusion differ from osmosis?",
                "When would a cell use endocytosis instead of simple transport?"
            ];
            
            const randomQ = questions[Math.floor(Math.random() * questions.length)];
            
            if (voiceEnabled) {
                speakText(`Time to test your membrane transport knowledge! Here's your question: ${randomQ} Think about how structure and function work together in cellular transport!`);
            }
        }

        // Initialize
        function init() {
            initVoiceSystem();
            
            setTimeout(() => {
                const loading = document.getElementById('loadingOverlay');
                loading.style.opacity = '0';
                setTimeout(() => {
                    loading.style.display = 'none';
                    
                    if (voiceEnabled) {
                        speakText("Welcome to your exploration of cell membranes and transport processes! We'll discover how the plasma membrane controls cellular traffic through selective permeability, learn about diffusion and osmosis, and observe how cells actively transport large materials. Let's dive into the fascinating world of cellular transport!");
                    }
                }, 1000);
            }, 3000);
            
            document.addEventListener('keydown', (e) => {
                switch(e.key) {
                    case 'v': toggleVoice(); break;
                    case 'i': toggleInfo(); break;
                    case 'g': startGuidedTour(); break;
                    case 'Escape': stopSpeech(); guidedTourActive = false; break;
                    case 'ArrowRight': nextStep && nextStep(); break;
                }
            });
        }

        init();
    </script>
</body>
</html>