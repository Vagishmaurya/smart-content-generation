<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reflex Actions and Reflex Arc - The Biology of Rapid Response</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tween.js/18.6.4/tween.umd.js"></script>

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 50%, #e74c3c 100%);
            color: white;
            overflow: hidden;
            position: relative;
            height: 100vh;
        }

        /* Animated Background */
        .bg-animation {
            position: fixed;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: 0;
            opacity: 0.1;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 320"><path fill="%23ffffff" fill-opacity="0.2" d="M0,96L48,112C96,128,192,160,288,186.7C384,213,480,235,576,213.3C672,192,768,128,864,128C960,128,1056,192,1152,197.3C1248,203,1344,149,1392,122.7L1440,96L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z"></path></svg>') repeat-x;
            animation: wave 18s linear infinite;
        }

        @keyframes wave {
            0% { background-position-x: 0; }
            100% { background-position-x: 1440px; }
        }

        /* Museum Interface - Compact Header */
        .museum-header {
            position: absolute;
            top: 10px;
            left: 20px;
            text-align: left;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            padding: 10px 18px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .museum-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 4px;
            background: linear-gradient(45deg, #e74c3c, #f39c12);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: titleGlow 3s ease-in-out infinite;
        }

        @keyframes titleGlow {
            0%, 100% { filter: brightness(1); }
            50% { filter: brightness(1.2); }
        }

        .exhibit-subtitle {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.8);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .reflex-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            background: #f39c12;
            border-radius: 50%;
            animation: reflex-pulse 0.8s ease-in-out infinite;
        }

        @keyframes reflex-pulse {
            0%, 100% { transform: scale(1); opacity: 1; box-shadow: 0 0 0 0 rgba(243, 156, 18, 0.7); }
            50% { transform: scale(1.3); opacity: 0.7; box-shadow: 0 0 0 8px rgba(243, 156, 18, 0); }
        }

        /* Journey Navigation - Enhanced */
        .journey-navigation {
            position: absolute;
            bottom: 20px;
            left: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            padding: 15px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            max-width: 320px;
        }

        .journey-title {
            font-size: 14px;
            font-weight: 600;
            color: #e74c3c;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .journey-steps {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }

        .journey-btn {
            background: rgba(231, 76, 60, 0.2);
            border: 1px solid rgba(231, 76, 60, 0.4);
            color: white;
            padding: 6px 10px;
            border-radius: 20px;
            font-size: 11px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 4px;
            white-space: nowrap;
        }

        .journey-btn:hover {
            background: rgba(231, 76, 60, 0.3);
            border-color: #e74c3c;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(231, 76, 60, 0.3);
        }

        .journey-btn.active {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            border-color: #e74c3c;
            box-shadow: 0 0 20px rgba(231, 76, 60, 0.5);
            animation: pulse 2s infinite;
        }

        .journey-btn.completed {
            background: rgba(243, 156, 18, 0.3);
            border-color: #f39c12;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        /* 3D Model Container */
        .model-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 0;
            overflow: hidden;
            border: none;
            z-index: 100;
        }

        .sketchfab-embed-wrapper {
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 50%, #e74c3c 100%);
        }

        .sketchfab-embed-wrapper iframe {
            width: 100%;
            height: 100%;
            border: none;
            border-radius: 0;
        }

        /* Information Panel - Enhanced */
        .info-panel {
            position: absolute;
            top: 70px;
            right: 20px;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(25px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 16px;
            padding: 24px;
            width: 380px;
            max-height: calc(100vh - 140px);
            z-index: 800;
            overflow-y: auto;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }

        .info-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        }

        .info-icon {
            font-size: 28px;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        .info-title {
            flex: 1;
        }

        .info-title h2 {
            font-size: 18px;
            color: #e74c3c;
            margin-bottom: 4px;
        }

        .info-subtitle {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.7);
        }

        .info-content {
            color: rgba(255, 255, 255, 0.9);
            font-size: 14px;
            line-height: 1.6;
        }

        /* Progress Tracker */
        .progress-tracker {
            background: linear-gradient(135deg, rgba(231, 76, 60, 0.1), rgba(243, 156, 18, 0.1));
            border: 1px solid rgba(231, 76, 60, 0.3);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 20px;
        }

        .progress-header {
            font-size: 13px;
            font-weight: 600;
            color: #e74c3c;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .progress-percentage {
            font-size: 18px;
            color: #f39c12;
            font-weight: 700;
        }

        .progress-bar {
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 12px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #e74c3c, #f39c12);
            border-radius: 4px;
            transition: width 0.8s ease;
            box-shadow: 0 0 10px rgba(231, 76, 60, 0.5);
        }

        .progress-steps-mini {
            display: flex;
            justify-content: space-between;
            font-size: 9px;
            color: rgba(255, 255, 255, 0.6);
        }

        .step-mini {
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .step-mini.active {
            color: #e74c3c;
            font-weight: 600;
        }

        .step-mini.completed {
            color: #f39c12;
        }

        /* Information Cards */
        .info-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 14px;
            margin-bottom: 14px;
        }

        .info-card-title {
            color: #e74c3c;
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .info-card-content {
            color: rgba(255, 255, 255, 0.85);
            font-size: 12px;
            line-height: 1.5;
        }

        .info-list {
            list-style: none;
            padding: 0;
        }

        .info-list li {
            padding: 6px 0;
            padding-left: 20px;
            position: relative;
            font-size: 12px;
            color: rgba(255, 255, 255, 0.8);
        }

        .info-list li:before {
            content: "‚ö°";
            position: absolute;
            left: 0;
            font-size: 10px;
            color: #e74c3c;
        }

        /* Reflex Fact Box */
        .reflex-fact {
            background: linear-gradient(135deg, rgba(243, 156, 18, 0.1), rgba(231, 76, 60, 0.1));
            border: 1px solid rgba(243, 156, 18, 0.3);
            border-radius: 12px;
            padding: 14px;
            margin: 16px 0;
            position: relative;
            overflow: hidden;
        }

        .reflex-fact:before {
            content: "‚ö°";
            position: absolute;
            top: -20px;
            right: -20px;
            font-size: 60px;
            opacity: 0.1;
        }

        .reflex-fact-title {
            color: #f39c12;
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 6px;
        }

        .reflex-fact-text {
            color: rgba(255, 255, 255, 0.9);
            font-size: 12px;
            line-height: 1.5;
            position: relative;
            z-index: 1;
        }

        /* Voice Controls */
        .voice-controls {
            position: absolute;
            top: 10px;
            right: 20px;
            display: flex;
            gap: 8px;
            z-index: 1000;
        }

        .control-btn {
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            width: 44px;
            height: 44px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            position: relative;
        }

        .control-btn:hover {
            background: rgba(231, 76, 60, 0.3);
            border-color: #e74c3c;
            transform: scale(1.1);
        }

        .control-btn.active {
            background: rgba(231, 76, 60, 0.4);
            border-color: #e74c3c;
            box-shadow: 0 0 20px rgba(231, 76, 60, 0.5);
        }

        .control-tooltip {
            position: absolute;
            bottom: -30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9);
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 10px;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .control-btn:hover .control-tooltip {
            opacity: 1;
        }

        /* Loading Screen */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 50%, #e74c3c 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            transition: opacity 1s ease;
        }

        .loading-content {
            text-align: center;
        }

        .loading-reflex {
            font-size: 60px;
            animation: reflex-spark 1.5s ease-in-out infinite;
            margin-bottom: 20px;
        }

        @keyframes reflex-spark {
            0%, 100% { transform: scale(1) rotate(0deg); filter: brightness(1); }
            50% { transform: scale(1.15) rotate(5deg); filter: brightness(1.5); }
        }

        .loading-text {
            color: white;
            font-size: 20px;
            margin-bottom: 20px;
        }

        .loading-progress {
            width: 200px;
            height: 4px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 2px;
            overflow: hidden;
        }

        .loading-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #e74c3c, #f39c12);
            animation: loading 2s ease-in-out infinite;
        }

        @keyframes loading {
            0% { width: 0%; }
            50% { width: 100%; }
            100% { width: 0%; }
        }

        /* Voice Indicator */
        .voice-indicator {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(231, 76, 60, 0.5);
            border-radius: 30px;
            padding: 14px 28px;
            display: flex;
            align-items: center;
            gap: 12px;
            z-index: 1000;
            opacity: 0;
            transition: all 0.3s ease;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }

        .voice-indicator.visible {
            opacity: 1;
            transform: translateX(-50%) translateY(-10px);
        }

        .voice-waves {
            display: flex;
            align-items: center;
            gap: 3px;
        }

        .voice-wave {
            width: 3px;
            height: 20px;
            background: linear-gradient(180deg, #e74c3c, #f39c12);
            border-radius: 2px;
            animation: voice-wave 1s ease-in-out infinite;
        }

        .voice-wave:nth-child(2) { animation-delay: 0.1s; }
        .voice-wave:nth-child(3) { animation-delay: 0.2s; }
        .voice-wave:nth-child(4) { animation-delay: 0.3s; }
        .voice-wave:nth-child(5) { animation-delay: 0.4s; }

        @keyframes voice-wave {
            0%, 100% { transform: scaleY(0.3); }
            50% { transform: scaleY(1); }
        }

        .narration-text {
            color: white;
            font-size: 13px;
            max-width: 300px;
        }

        /* Quick Actions */
        .quick-actions {
            position: absolute;
            bottom: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            z-index: 1000;
        }

        .action-btn {
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 10px 16px;
            border-radius: 25px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
        }

        .action-btn:hover {
            background: rgba(231, 76, 60, 0.3);
            border-color: #e74c3c;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(231, 76, 60, 0.3);
        }

        /* Custom Scrollbar */
        .info-panel::-webkit-scrollbar {
            width: 6px;
        }

        .info-panel::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 3px;
        }

        .info-panel::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, #e74c3c, #f39c12);
            border-radius: 3px;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .info-panel {
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                top: auto;
                width: 100%;
                max-height: 50vh;
                border-radius: 20px 20px 0 0;
            }
            
            .journey-navigation {
                bottom: 52vh;
                max-width: calc(100% - 40px);
            }
            
            .voice-controls {
                top: auto;
                bottom: 55vh;
                right: 10px;
            }
            
            .quick-actions {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="bg-animation"></div>

    <!-- Loading Screen -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-content">
            <div class="loading-reflex">‚ö°</div>
            <div class="loading-text">Preparing Your Reflex Journey...</div>
            <div class="loading-progress">
                <div class="loading-progress-bar"></div>
            </div>
        </div>
    </div>

    <!-- Museum Header -->
    <div class="museum-header">
        <div class="museum-title">Reflex Actions and Reflex Arc</div>
        <div class="exhibit-subtitle">
            <span class="reflex-indicator"></span>
            The Biology of Rapid Response
        </div>
    </div>

    <!-- Journey Navigation -->
    <div class="journey-navigation">
        <div class="journey-title">
            <span>‚ö°</span>
            <span>Your Reflex Journey</span>
        </div>
        <div class="journey-steps">
            <button class="journey-btn active" onclick="loadJourneyStep('reflex_arc')">
                <span>üîÑ</span> Reflex Arc
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('spinal_cord')">
                <span>üß†</span> Spinal Cord
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('sensory_neuron')">
                <span>üëÅÔ∏è</span> Sensory Neuron
            </button>
        </div>
    </div>

    <!-- 3D Model Container -->
    <div class="model-container">
        <div class="sketchfab-embed-wrapper">
            <iframe id="api-frame"
                    title="Reflex Arc Model" 
                    frameborder="0" 
                    allowfullscreen 
                    mozallowfullscreen="true" 
                    webkitallowfullscreen="true" 
                    allow="autoplay; fullscreen; xr-spatial-tracking"
                    xr-spatial-tracking 
                    execution-while-out-of-viewport 
                    execution-while-not-rendered 
                    web-share 
                    src="https://sketchfab.com/models/0e4fb49ec0cd4754a7aec8aea145a36b/embed?autostart=1&internal=1&tracking=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_watermark=0">
            </iframe>
        </div>
    </div>

    <!-- Information Panel -->
    <div class="info-panel" id="infoPanel">
        <div class="info-header">
            <div class="info-icon" id="stepIcon">üîÑ</div>
            <div class="info-title">
                <h2 id="stepTitle">Reflex Arc - The Survival Circuit</h2>
                <div class="info-subtitle" id="stepSubtitle">Automatic protective responses</div>
            </div>
        </div>

        <!-- Progress Tracker -->
        <div class="progress-tracker">
            <div class="progress-header">
                <span>Reflex Learning Progress</span>
                <span class="progress-percentage" id="progressPercent">33%</span>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 33%"></div>
            </div>
            <div class="progress-steps-mini">
                <span class="step-mini active" onclick="loadJourneyStep('reflex_arc')">Arc</span>
                <span class="step-mini" onclick="loadJourneyStep('spinal_cord')">Spinal</span>
                <span class="step-mini" onclick="loadJourneyStep('sensory_neuron')">Sensory</span>
            </div>
        </div>

        <div class="info-content" id="mainDescription">
            The reflex arc is a neural pathway that controls reflex actions - rapid, automatic responses to stimuli that occur without conscious thought. This survival mechanism enables organisms to respond to danger or maintain body functions faster than conscious brain processing would allow.
        </div>

        <div class="info-card">
            <div class="info-card-title">
                <span>üî¨</span> Reflex Arc Components
            </div>
            <div class="info-card-content">
                <ul class="info-list" id="keyConcepts">
                    <li>Receptor detects stimulus and generates signal</li>
                    <li>Sensory neuron carries signal to spinal cord</li>
                    <li>Interneuron processes signal in spinal cord</li>
                    <li>Motor neuron carries response signal to effector</li>
                    <li>Effector produces rapid protective response</li>
                </ul>
            </div>
        </div>

        <div class="reflex-fact">
            <div class="reflex-fact-title">Lightning Fast Response</div>
            <div class="reflex-fact-text" id="reflexFact">
                Reflex responses can occur in as little as 50 milliseconds - faster than the blink of an eye! This speed advantage can mean the difference between injury and safety in dangerous situations.
            </div>
        </div>

        <div class="info-card">
            <div class="info-card-title">
                <span>üéØ</span> Learning Objectives
            </div>
            <div class="info-card-content" id="learningObjectives">
                Understand the components and pathway of reflex arcs, and appreciate how these automatic responses provide rapid protection without requiring conscious brain involvement.
            </div>
        </div>
    </div>

    <!-- Voice Controls -->
    <div class="voice-controls">
        <button class="control-btn active" id="voiceToggle" onclick="toggleVoice()">
            üîä
            <span class="control-tooltip">Voice Narration</span>
        </button>
        <button class="control-btn" onclick="toggleAutoPlay()">
            ‚ñ∂Ô∏è
            <span class="control-tooltip">Auto Journey</span>
        </button>
        <button class="control-btn" onclick="toggleInfo()">
            ‚ÑπÔ∏è
            <span class="control-tooltip">Toggle Info</span>
        </button>
    </div>

    <!-- Quick Actions -->
    <div class="quick-actions">
        <button class="action-btn" onclick="startGuidedTour()">
            <span>üöÄ</span> Guided Tour
        </button>
        <button class="action-btn" onclick="showQuiz()">
            <span>üéØ</span> Test Knowledge
        </button>
    </div>

    <!-- Voice Indicator -->
    <div class="voice-indicator" id="voiceIndicator">
        <div class="voice-waves">
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
        </div>
        <div class="narration-text" id="narrationText">Narrating...</div>
    </div>

    <script>
        // Journey Step Data with Complete Educational Content
        const JOURNEY_DATA = {
            reflex_arc: {
                title: "Reflex Arc - The Survival Circuit",
                subtitle: "Automatic protective responses",
                icon: "üîÑ",
                modelUrl: "https://sketchfab.com/models/0e4fb49ec0cd4754a7aec8aea145a36b/embed?autostart=1&internal=1&tracking=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_watermark=0",
                description: "The reflex arc is a neural pathway that controls reflex actions - rapid, automatic responses to stimuli that occur without conscious thought. This survival mechanism enables organisms to respond to danger or maintain body functions faster than conscious brain processing would allow.",
                concepts: [
                    "Receptor detects stimulus and generates signal",
                    "Sensory neuron carries signal to spinal cord",
                    "Interneuron processes signal in spinal cord",
                    "Motor neuron carries response signal to effector",
                    "Effector produces rapid protective response"
                ],
                reflexFact: "Reflex responses can occur in as little as 50 milliseconds - faster than the blink of an eye! This speed advantage can mean the difference between injury and safety in dangerous situations.",
                objectives: "Understand the components and pathway of reflex arcs, and appreciate how these automatic responses provide rapid protection without requiring conscious brain involvement.",
                narration: "Welcome to the reflex arc - your body's lightning-fast survival system! This model shows the complete pathway of a reflex response, designed to protect you from harm faster than you can even think. The journey begins with a receptor, which might be pain receptors in your skin detecting something hot or sharp. This receptor immediately converts the physical stimulus into an electrical signal. The signal then travels along a sensory neuron toward your spinal cord - this is the afferent pathway, carrying information toward the central nervous system. In the spinal cord, the signal reaches an interneuron, a connecting neuron that processes the information locally without involving the brain. This interneuron immediately activates a motor neuron, which carries the response signal back out through the efferent pathway to an effector - usually a muscle that produces the protective response. The entire circuit bypasses the brain completely, allowing you to pull your hand away from a hot stove or step back from danger before you're even consciously aware of the threat. This elegant system demonstrates how evolution has optimized our nervous system for survival."
            },
            spinal_cord: {
                title: "Spinal Cord - The Reflex Processing Center",
                subtitle: "Integration without brain involvement",
                icon: "üß†",
                modelUrl: "https://sketchfab.com/models/fab2a2dcbb0143e7a6dfa0406043b3a4/embed?autostart=1&internal=1&tracking=0&ui_ar=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "The spinal cord serves as the central processing unit for reflex actions. This cross-section reveals the gray and white matter organization that enables rapid reflex processing while maintaining connections to the brain for conscious awareness of reflex events.",
                concepts: [
                    "Gray matter contains neuron cell bodies and synapses",
                    "White matter contains myelinated axon tracts",
                    "Dorsal horn receives sensory input",
                    "Ventral horn contains motor neuron cell bodies",
                    "Interneurons connect sensory and motor pathways"
                ],
                reflexFact: "The spinal cord can process reflexes independently of the brain, but it simultaneously sends copies of sensory information upward so the brain becomes aware of what happened moments later.",
                objectives: "Explore spinal cord anatomy and understand how its organization enables rapid reflex processing while maintaining communication with the brain.",
                narration: "Dive into the spinal cord - the remarkable neural highway that serves as mission control for your reflexes! This cross-section reveals the beautiful organization that makes lightning-fast responses possible. The butterfly-shaped gray matter in the center contains the cell bodies of neurons and is where the actual processing happens. The dorsal horn, at the back, is where sensory neurons enter and make their first synaptic connections. The ventral horn, at the front, houses the cell bodies of motor neurons that will carry response signals out to muscles. Between them, interneurons create the critical connections that allow reflexes to occur without brain involvement. The white matter surrounding the gray matter contains myelinated axon tracts - these are like expressways carrying information up to the brain and down from the brain. But here's the remarkable thing: while these pathways to the brain exist, the reflex can complete its entire circuit within the spinal cord itself. The sensory signal comes in through the dorsal horn, synapses with interneurons in the gray matter, which then activate motor neurons in the ventral horn. Meanwhile, branches of the sensory signal travel up to the brain, which is why you become consciously aware of the reflex after it has already occurred. This dual system provides both immediate protection and conscious awareness."
            },
            sensory_neuron: {
                title: "Sensory Neuron - The Alert System",
                subtitle: "Detecting and transmitting danger signals",
                icon: "üëÅÔ∏è",
                modelUrl: "https://sketchfab.com/models/72049352d6b642d7b625bceadfc76987/embed?autostart=1&internal=1&tracking=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_watermark=0",
                description: "Sensory neurons are specialized to detect environmental stimuli and convert them into electrical signals. In reflex arcs, these neurons serve as the critical first link, rapidly transmitting danger signals from receptors to the spinal cord for immediate processing.",
                concepts: [
                    "Specialized endings detect specific stimuli",
                    "Pseudounipolar structure optimizes signal speed",
                    "Myelinated axons enable rapid transmission",
                    "Direct connections to spinal cord interneurons",
                    "Multiple receptor types detect different dangers"
                ],
                reflexFact: "Some sensory neurons have specialized endings that can detect incredibly small changes - pain receptors can respond to tissue damage, while stretch receptors can detect tiny changes in muscle length.",
                objectives: "Understand sensory neuron structure and function, and appreciate their crucial role as the detection and alarm system in reflex responses.",
                narration: "Meet the sensory neuron - your body's sophisticated early warning system! This specialized cell is perfectly designed to detect danger and sound the alarm faster than you can think. Sensory neurons have a unique pseudounipolar structure - instead of having separate dendrites and an axon like most neurons, they have one long projection that splits into two branches. One branch extends to the periphery where it has specialized endings that can detect different types of stimuli - heat, cold, pressure, pain, or chemical changes. The other branch extends into the spinal cord where it synapses with interneurons. This unusual structure eliminates the delay that would occur if the signal had to travel through a cell body, making transmission incredibly fast. When a receptor detects a harmful stimulus, it generates an electrical signal that races along the sensory neuron's myelinated axon at speeds up to 120 meters per second. Different types of sensory neurons are specialized for different dangers - nociceptors detect tissue damage and pain, mechanoreceptors detect harmful pressure or stretch, and thermoreceptors detect dangerous temperatures. The moment these neurons fire, they set the entire reflex arc in motion, often saving you from injury before you even realize you're in danger. This rapid detection and transmission system represents millions of years of evolution fine-tuning our survival mechanisms."
            }
        };

        // Global Variables
        let currentStep = 'reflex_arc';
        let voiceEnabled = true;
        let autoPlayEnabled = false;
        let currentSpeech = null;
        let selectedVoice = null;
        let journeyProgress = 0;
        let guidedTourActive = false;

        // Initialize Voice System
        function initVoiceSystem() {
            if (!('speechSynthesis' in window)) {
                console.warn('Speech synthesis not supported');
                voiceEnabled = false;
                document.getElementById('voiceToggle').style.display = 'none';
                return;
            }

            function loadVoices() {
                const voices = speechSynthesis.getVoices();
                if (voices.length === 0) return;

                // Prefer natural-sounding voices
                const preferredVoices = [
                    'Google UK English Female',
                    'Microsoft Sonia',
                    'Microsoft Hazel',
                    'Samantha',
                    'Victoria'
                ];

                for (const name of preferredVoices) {
                    selectedVoice = voices.find(v => v.name.includes(name));
                    if (selectedVoice) break;
                }

                if (!selectedVoice) {
                    selectedVoice = voices.find(v => v.lang.startsWith('en'));
                }
            }

            loadVoices();
            if (speechSynthesis.onvoiceschanged !== undefined) {
                speechSynthesis.onvoiceschanged = loadVoices;
            }
        }

        // Load Journey Step
        function loadJourneyStep(stepId) {
            const stepData = JOURNEY_DATA[stepId];
            if (!stepData) return;

            currentStep = stepId;
            
            // Update model
            document.getElementById('api-frame').src = stepData.modelUrl;
            
            // Update info panel
            document.getElementById('stepIcon').textContent = stepData.icon;
            document.getElementById('stepTitle').textContent = stepData.title;
            document.getElementById('stepSubtitle').textContent = stepData.subtitle;
            document.getElementById('mainDescription').textContent = stepData.description;
            
            // Update key concepts
            const conceptsList = document.getElementById('keyConcepts');
            conceptsList.innerHTML = stepData.concepts.map(c => `<li>${c}</li>`).join('');
            
            // Update reflex fact
            document.getElementById('reflexFact').textContent = stepData.reflexFact;
            
            // Update learning objectives
            document.getElementById('learningObjectives').textContent = stepData.objectives;
            
            // Update navigation buttons
            updateNavigationButtons(stepId);
            
            // Update progress
            updateProgress();
            
            // Play narration if enabled
            if (voiceEnabled) {
                speakText(stepData.narration);
            }
        }

        // Update Navigation Buttons
        function updateNavigationButtons(activeStep) {
            const buttons = document.querySelectorAll('.journey-btn');
            const steps = ['reflex_arc', 'spinal_cord', 'sensory_neuron'];
            const activeIndex = steps.indexOf(activeStep);
            
            buttons.forEach((btn, index) => {
                btn.classList.remove('active', 'completed');
                if (index < activeIndex) {
                    btn.classList.add('completed');
                } else if (index === activeIndex) {
                    btn.classList.add('active');
                }
            });
            
            // Update mini steps
            const miniSteps = document.querySelectorAll('.step-mini');
            miniSteps.forEach((step, index) => {
                step.classList.remove('active', 'completed');
                if (index < activeIndex) {
                    step.classList.add('completed');
                } else if (index === activeIndex) {
                    step.classList.add('active');
                }
            });
        }

        // Update Progress
        function updateProgress() {
            const steps = ['reflex_arc', 'spinal_cord', 'sensory_neuron'];
            const currentIndex = steps.indexOf(currentStep);
            const progress = ((currentIndex + 1) / steps.length) * 100;
            
            document.getElementById('progressPercent').textContent = Math.round(progress) + '%';
            document.getElementById('progressFill').style.width = progress + '%';
        }

        // Speech Functions
        function speakText(text) {
            if (!voiceEnabled || !text) return;
            
            stopSpeech();
            
            currentSpeech = new SpeechSynthesisUtterance(text);
            if (selectedVoice) {
                currentSpeech.voice = selectedVoice;
            }
            currentSpeech.rate = 0.9;
            currentSpeech.pitch = 1.0;
            currentSpeech.volume = 0.9;
            
            currentSpeech.onstart = () => {
                document.getElementById('voiceIndicator').classList.add('visible');
                document.getElementById('narrationText').textContent = 
                    text.substring(0, 50) + (text.length > 50 ? '...' : '');
            };
            
            currentSpeech.onend = () => {
                document.getElementById('voiceIndicator').classList.remove('visible');
                currentSpeech = null;
                
                // Auto-advance if guided tour is active
                if (guidedTourActive) {
                    setTimeout(nextStep, 2000);
                }
            };
            
            speechSynthesis.speak(currentSpeech);
        }

        function stopSpeech() {
            if (currentSpeech) {
                speechSynthesis.cancel();
                currentSpeech = null;
                document.getElementById('voiceIndicator').classList.remove('visible');
            }
        }

        // Control Functions
        function toggleVoice() {
            voiceEnabled = !voiceEnabled;
            const btn = document.getElementById('voiceToggle');
            btn.textContent = voiceEnabled ? 'üîä' : 'üîá';
            btn.classList.toggle('active', voiceEnabled);
            
            if (!voiceEnabled) {
                stopSpeech();
            }
        }

        function toggleAutoPlay() {
            autoPlayEnabled = !autoPlayEnabled;
            if (autoPlayEnabled) {
                startGuidedTour();
            } else {
                guidedTourActive = false;
            }
        }

        function toggleInfo() {
            const panel = document.getElementById('infoPanel');
            panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
        }

        // Guided Tour
        function startGuidedTour() {
            guidedTourActive = true;
            const steps = ['reflex_arc', 'spinal_cord', 'sensory_neuron'];
            let stepIndex = 0;
            
            function tourStep() {
                if (stepIndex < steps.length && guidedTourActive) {
                    loadJourneyStep(steps[stepIndex]);
                    stepIndex++;
                } else {
                    guidedTourActive = false;
                    if (voiceEnabled) {
                        speakText("You have completed your journey through reflex actions and the reflex arc! You now understand how these lightning-fast protective responses work to keep organisms safe through automatic neural circuits that bypass conscious thought for immediate action.");
                    }
                }
            }
            
            tourStep();
            window.nextStep = tourStep;
        }

        // Quiz Function
        function showQuiz() {
            const questions = [
                "What are the five components of a reflex arc?",
                "Why are reflex responses faster than conscious responses?",
                "What role does the spinal cord play in reflex actions?",
                "How do sensory neurons detect and transmit danger signals?",
                "What are some examples of common reflex actions and their survival value?"
            ];
            
            const randomQ = questions[Math.floor(Math.random() * questions.length)];
            
            if (voiceEnabled) {
                speakText(`Here's a question about reflex actions: ${randomQ} Think about what you've learned about these rapid protective responses.`);
            }
        }

        // Initialize
        function init() {
            initVoiceSystem();
            
            // Hide loading screen
            setTimeout(() => {
                const loading = document.getElementById('loadingOverlay');
                loading.style.opacity = '0';
                setTimeout(() => {
                    loading.style.display = 'none';
                    
                    // Welcome message
                    if (voiceEnabled) {
                        speakText("Welcome to your exploration of reflex actions and the reflex arc! We'll discover how these automatic protective responses enable lightning-fast reactions to danger without conscious thought. Let's begin by examining the complete reflex pathway!");
                    }
                }, 1000);
            }, 3000);
            
            // Keyboard shortcuts
            document.addEventListener('keydown', (e) => {
                switch(e.key) {
                    case 'v': toggleVoice(); break;
                    case 'i': toggleInfo(); break;
                    case 'g': startGuidedTour(); break;
                    case 'Escape': stopSpeech(); guidedTourActive = false; break;
                    case 'ArrowRight': nextStep && nextStep(); break;
                }
            });
        }

        // Start the application
        init();
    </script>
</body>
</html>