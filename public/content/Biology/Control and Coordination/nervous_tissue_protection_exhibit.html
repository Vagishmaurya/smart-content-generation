<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Protection of Nervous Tissue - Safeguarding the Command Center</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tween.js/18.6.4/tween.umd.js"></script>

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #2c3e50 0%, #bdc3c7 50%, #ecf0f1 100%);
            color: white;
            overflow: hidden;
            position: relative;
            height: 100vh;
        }

        /* Animated Background */
        .bg-animation {
            position: fixed;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: 0;
            opacity: 0.1;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 320"><path fill="%23ffffff" fill-opacity="0.2" d="M0,96L48,112C96,128,192,160,288,186.7C384,213,480,235,576,213.3C672,192,768,128,864,128C960,128,1056,192,1152,197.3C1248,203,1344,149,1392,122.7L1440,96L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z"></path></svg>') repeat-x;
            animation: wave 20s linear infinite;
        }

        @keyframes wave {
            0% { background-position-x: 0; }
            100% { background-position-x: 1440px; }
        }

        /* Museum Interface - Compact Header */
        .museum-header {
            position: absolute;
            top: 10px;
            left: 20px;
            text-align: left;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            padding: 10px 18px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .museum-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 4px;
            background: linear-gradient(45deg, #2c3e50, #95a5a6);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: titleGlow 3s ease-in-out infinite;
        }

        @keyframes titleGlow {
            0%, 100% { filter: brightness(1); }
            50% { filter: brightness(1.2); }
        }

        .exhibit-subtitle {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.8);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .shield-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            background: #95a5a6;
            border-radius: 50%;
            animation: shield-pulse 2s ease-in-out infinite;
        }

        @keyframes shield-pulse {
            0%, 100% { transform: scale(1); opacity: 1; box-shadow: 0 0 0 0 rgba(149, 165, 166, 0.7); }
            50% { transform: scale(1.2); opacity: 0.8; box-shadow: 0 0 0 8px rgba(149, 165, 166, 0); }
        }

        /* Journey Navigation - Enhanced */
        .journey-navigation {
            position: absolute;
            bottom: 20px;
            left: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            padding: 15px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            max-width: 320px;
        }

        .journey-title {
            font-size: 14px;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .journey-steps {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }

        .journey-btn {
            background: rgba(44, 62, 80, 0.2);
            border: 1px solid rgba(44, 62, 80, 0.4);
            color: white;
            padding: 6px 10px;
            border-radius: 20px;
            font-size: 11px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 4px;
            white-space: nowrap;
        }

        .journey-btn:hover {
            background: rgba(44, 62, 80, 0.3);
            border-color: #2c3e50;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(44, 62, 80, 0.3);
        }

        .journey-btn.active {
            background: linear-gradient(135deg, #2c3e50, #34495e);
            border-color: #2c3e50;
            box-shadow: 0 0 20px rgba(44, 62, 80, 0.5);
            animation: pulse 2s infinite;
        }

        .journey-btn.completed {
            background: rgba(149, 165, 166, 0.3);
            border-color: #95a5a6;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        /* 3D Model Container */
        .model-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 0;
            overflow: hidden;
            border: none;
            z-index: 100;
        }

        .sketchfab-embed-wrapper {
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #2c3e50 0%, #bdc3c7 50%, #ecf0f1 100%);
        }

        .sketchfab-embed-wrapper iframe {
            width: 100%;
            height: 100%;
            border: none;
            border-radius: 0;
        }

        /* Information Panel - Enhanced */
        .info-panel {
            position: absolute;
            top: 70px;
            right: 20px;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(25px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 16px;
            padding: 24px;
            width: 380px;
            max-height: calc(100vh - 140px);
            z-index: 800;
            overflow-y: auto;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }

        .info-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        }

        .info-icon {
            font-size: 28px;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        .info-title {
            flex: 1;
        }

        .info-title h2 {
            font-size: 18px;
            color: #2c3e50;
            margin-bottom: 4px;
        }

        .info-subtitle {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.7);
        }

        .info-content {
            color: rgba(255, 255, 255, 0.9);
            font-size: 14px;
            line-height: 1.6;
        }

        /* Progress Tracker */
        .progress-tracker {
            background: linear-gradient(135deg, rgba(44, 62, 80, 0.1), rgba(149, 165, 166, 0.1));
            border: 1px solid rgba(44, 62, 80, 0.3);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 20px;
        }

        .progress-header {
            font-size: 13px;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .progress-percentage {
            font-size: 18px;
            color: #95a5a6;
            font-weight: 700;
        }

        .progress-bar {
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 12px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #2c3e50, #95a5a6);
            border-radius: 4px;
            transition: width 0.8s ease;
            box-shadow: 0 0 10px rgba(44, 62, 80, 0.5);
        }

        .progress-steps-mini {
            display: flex;
            justify-content: space-between;
            font-size: 9px;
            color: rgba(255, 255, 255, 0.6);
        }

        .step-mini {
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .step-mini.active {
            color: #2c3e50;
            font-weight: 600;
        }

        .step-mini.completed {
            color: #95a5a6;
        }

        /* Information Cards */
        .info-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 14px;
            margin-bottom: 14px;
        }

        .info-card-title {
            color: #2c3e50;
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .info-card-content {
            color: rgba(255, 255, 255, 0.85);
            font-size: 12px;
            line-height: 1.5;
        }

        .info-list {
            list-style: none;
            padding: 0;
        }

        .info-list li {
            padding: 6px 0;
            padding-left: 20px;
            position: relative;
            font-size: 12px;
            color: rgba(255, 255, 255, 0.8);
        }

        .info-list li:before {
            content: "🛡️";
            position: absolute;
            left: 0;
            font-size: 10px;
        }

        /* Protection Fact Box */
        .protection-fact {
            background: linear-gradient(135deg, rgba(149, 165, 166, 0.1), rgba(44, 62, 80, 0.1));
            border: 1px solid rgba(149, 165, 166, 0.3);
            border-radius: 12px;
            padding: 14px;
            margin: 16px 0;
            position: relative;
            overflow: hidden;
        }

        .protection-fact:before {
            content: "🛡️";
            position: absolute;
            top: -20px;
            right: -20px;
            font-size: 60px;
            opacity: 0.1;
        }

        .protection-fact-title {
            color: #95a5a6;
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 6px;
        }

        .protection-fact-text {
            color: rgba(255, 255, 255, 0.9);
            font-size: 12px;
            line-height: 1.5;
            position: relative;
            z-index: 1;
        }

        /* Voice Controls */
        .voice-controls {
            position: absolute;
            top: 10px;
            right: 20px;
            display: flex;
            gap: 8px;
            z-index: 1000;
        }

        .control-btn {
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            width: 44px;
            height: 44px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            position: relative;
        }

        .control-btn:hover {
            background: rgba(44, 62, 80, 0.3);
            border-color: #2c3e50;
            transform: scale(1.1);
        }

        .control-btn.active {
            background: rgba(44, 62, 80, 0.4);
            border-color: #2c3e50;
            box-shadow: 0 0 20px rgba(44, 62, 80, 0.5);
        }

        .control-tooltip {
            position: absolute;
            bottom: -30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9);
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 10px;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .control-btn:hover .control-tooltip {
            opacity: 1;
        }

        /* Loading Screen */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #2c3e50 0%, #bdc3c7 50%, #ecf0f1 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            transition: opacity 1s ease;
        }

        .loading-content {
            text-align: center;
        }

        .loading-shield {
            font-size: 60px;
            animation: shield-protect 2.5s ease-in-out infinite;
            margin-bottom: 20px;
        }

        @keyframes shield-protect {
            0%, 100% { transform: scale(1) rotate(0deg); filter: brightness(1); }
            50% { transform: scale(1.1) rotate(5deg); filter: brightness(1.3); }
        }

        .loading-text {
            color: white;
            font-size: 20px;
            margin-bottom: 20px;
        }

        .loading-progress {
            width: 200px;
            height: 4px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 2px;
            overflow: hidden;
        }

        .loading-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #2c3e50, #95a5a6);
            animation: loading 2s ease-in-out infinite;
        }

        @keyframes loading {
            0% { width: 0%; }
            50% { width: 100%; }
            100% { width: 0%; }
        }

        /* Voice Indicator */
        .voice-indicator {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(44, 62, 80, 0.5);
            border-radius: 30px;
            padding: 14px 28px;
            display: flex;
            align-items: center;
            gap: 12px;
            z-index: 1000;
            opacity: 0;
            transition: all 0.3s ease;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }

        .voice-indicator.visible {
            opacity: 1;
            transform: translateX(-50%) translateY(-10px);
        }

        .voice-waves {
            display: flex;
            align-items: center;
            gap: 3px;
        }

        .voice-wave {
            width: 3px;
            height: 20px;
            background: linear-gradient(180deg, #2c3e50, #95a5a6);
            border-radius: 2px;
            animation: voice-wave 1s ease-in-out infinite;
        }

        .voice-wave:nth-child(2) { animation-delay: 0.1s; }
        .voice-wave:nth-child(3) { animation-delay: 0.2s; }
        .voice-wave:nth-child(4) { animation-delay: 0.3s; }
        .voice-wave:nth-child(5) { animation-delay: 0.4s; }

        @keyframes voice-wave {
            0%, 100% { transform: scaleY(0.3); }
            50% { transform: scaleY(1); }
        }

        .narration-text {
            color: white;
            font-size: 13px;
            max-width: 300px;
        }

        /* Quick Actions */
        .quick-actions {
            position: absolute;
            bottom: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            z-index: 1000;
        }

        .action-btn {
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 10px 16px;
            border-radius: 25px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
        }

        .action-btn:hover {
            background: rgba(44, 62, 80, 0.3);
            border-color: #2c3e50;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(44, 62, 80, 0.3);
        }

        /* Custom Scrollbar */
        .info-panel::-webkit-scrollbar {
            width: 6px;
        }

        .info-panel::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 3px;
        }

        .info-panel::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, #2c3e50, #95a5a6);
            border-radius: 3px;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .info-panel {
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                top: auto;
                width: 100%;
                max-height: 50vh;
                border-radius: 20px 20px 0 0;
            }
            
            .journey-navigation {
                bottom: 52vh;
                max-width: calc(100% - 40px);
            }
            
            .voice-controls {
                top: auto;
                bottom: 55vh;
                right: 10px;
            }
            
            .quick-actions {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="bg-animation"></div>

    <!-- Loading Screen -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-content">
            <div class="loading-shield">🛡️</div>
            <div class="loading-text">Preparing Your Protection Journey...</div>
            <div class="loading-progress">
                <div class="loading-progress-bar"></div>
            </div>
        </div>
    </div>

    <!-- Museum Header -->
    <div class="museum-header">
        <div class="museum-title">Protection of Nervous Tissue</div>
        <div class="exhibit-subtitle">
            <span class="shield-indicator"></span>
            Safeguarding the Command Center
        </div>
    </div>

    <!-- Journey Navigation -->
    <div class="journey-navigation">
        <div class="journey-title">
            <span>🛡️</span>
            <span>Your Protection Journey</span>
        </div>
        <div class="journey-steps">
            <button class="journey-btn active" onclick="loadJourneyStep('skull')">
                <span>💀</span> Skull Protection
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('vertebral')">
                <span>🦴</span> Vertebral Column
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('brain_layers')">
                <span>🧠</span> Brain Layers
            </button>
        </div>
    </div>

    <!-- 3D Model Container -->
    <div class="model-container">
        <div class="sketchfab-embed-wrapper">
            <iframe id="api-frame"
                    title="Human Skull Model" 
                    frameborder="0" 
                    allowfullscreen 
                    mozallowfullscreen="true" 
                    webkitallowfullscreen="true" 
                    allow="autoplay; fullscreen; xr-spatial-tracking"
                    xr-spatial-tracking 
                    execution-while-out-of-viewport 
                    execution-while-not-rendered 
                    web-share 
                    src="https://sketchfab.com/models/baf6ac7b781a46218dca2b59dee58817/embed?autostart=1&internal=1&tracking=0&ui_ar=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0">
            </iframe>
        </div>
    </div>

    <!-- Information Panel -->
    <div class="info-panel" id="infoPanel">
        <div class="info-header">
            <div class="info-icon" id="stepIcon">💀</div>
            <div class="info-title">
                <h2 id="stepTitle">Skull Protection - The Brain's Fortress</h2>
                <div class="info-subtitle" id="stepSubtitle">Bony armor for the most vital organ</div>
            </div>
        </div>

        <!-- Progress Tracker -->
        <div class="progress-tracker">
            <div class="progress-header">
                <span>Protection Learning Progress</span>
                <span class="progress-percentage" id="progressPercent">33%</span>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 33%"></div>
            </div>
            <div class="progress-steps-mini">
                <span class="step-mini active" onclick="loadJourneyStep('skull')">Skull</span>
                <span class="step-mini" onclick="loadJourneyStep('vertebral')">Vertebral</span>
                <span class="step-mini" onclick="loadJourneyStep('brain_layers')">Layers</span>
            </div>
        </div>

        <div class="info-content" id="mainDescription">
            The skull serves as the brain's protective fortress, consisting of multiple fused bones that form a rigid enclosure around the most vital organ in the human body. This bony armor shields the delicate neural tissue from physical trauma while providing attachment points for muscles and maintaining the brain's shape.
        </div>

        <div class="info-card">
            <div class="info-card-title">
                <span>🔬</span> Skull Protection Features
            </div>
            <div class="info-card-content">
                <ul class="info-list" id="keyConcepts">
                    <li>Multiple fused bones create rigid protective chamber</li>
                    <li>Thick cranial bones absorb and distribute impact forces</li>
                    <li>Smooth inner surface prevents tissue abrasion</li>
                    <li>Foramina allow nerves and vessels while maintaining protection</li>
                </ul>
            </div>
        </div>

        <div class="protection-fact">
            <div class="protection-fact-title">Protection Insight</div>
            <div class="protection-fact-text" id="protectionFact">
                The human skull is remarkably strong - it can withstand forces up to 2,300 pounds per square inch before fracturing, making it one of the body's most effective protective structures.
            </div>
        </div>

        <div class="info-card">
            <div class="info-card-title">
                <span>🎯</span> Learning Objectives
            </div>
            <div class="info-card-content" id="learningObjectives">
                Understand how the skull's structure and composition provide essential protection for the brain and appreciate why nervous tissue requires such robust defensive mechanisms.
            </div>
        </div>
    </div>

    <!-- Voice Controls -->
    <div class="voice-controls">
        <button class="control-btn active" id="voiceToggle" onclick="toggleVoice()">
            🔊
            <span class="control-tooltip">Voice Narration</span>
        </button>
        <button class="control-btn" onclick="toggleAutoPlay()">
            ▶️
            <span class="control-tooltip">Auto Journey</span>
        </button>
        <button class="control-btn" onclick="toggleInfo()">
            ℹ️
            <span class="control-tooltip">Toggle Info</span>
        </button>
    </div>

    <!-- Quick Actions -->
    <div class="quick-actions">
        <button class="action-btn" onclick="startGuidedTour()">
            <span>🚀</span> Guided Tour
        </button>
        <button class="action-btn" onclick="showQuiz()">
            <span>🎯</span> Test Knowledge
        </button>
    </div>

    <!-- Voice Indicator -->
    <div class="voice-indicator" id="voiceIndicator">
        <div class="voice-waves">
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
        </div>
        <div class="narration-text" id="narrationText">Narrating...</div>
    </div>

    <script>
        // Journey Step Data with Complete Educational Content
        const JOURNEY_DATA = {
            skull: {
                title: "Skull Protection - The Brain's Fortress",
                subtitle: "Bony armor for the most vital organ",
                icon: "💀",
                modelUrl: "https://sketchfab.com/models/baf6ac7b781a46218dca2b59dee58817/embed?autostart=1&internal=1&tracking=0&ui_ar=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "The skull serves as the brain's protective fortress, consisting of multiple fused bones that form a rigid enclosure around the most vital organ in the human body. This bony armor shields the delicate neural tissue from physical trauma while providing attachment points for muscles and maintaining the brain's shape.",
                concepts: [
                    "Multiple fused bones create rigid protective chamber",
                    "Thick cranial bones absorb and distribute impact forces",
                    "Smooth inner surface prevents tissue abrasion",
                    "Foramina allow nerves and vessels while maintaining protection"
                ],
                protectionFact: "The human skull is remarkably strong - it can withstand forces up to 2,300 pounds per square inch before fracturing, making it one of the body's most effective protective structures.",
                objectives: "Understand how the skull's structure and composition provide essential protection for the brain and appreciate why nervous tissue requires such robust defensive mechanisms.",
                narration: "Behold the human skull - nature's ultimate protective helmet designed to safeguard your most precious organ! This remarkable structure consists of 22 fused bones that form an incredibly strong yet lightweight protective chamber. The cranial bones, including the frontal, parietal, temporal, and occipital bones, are composed of dense cortical bone on the outside and spongy cancellous bone on the inside, creating a structure that can absorb tremendous impact forces. The skull's design is engineering perfection - the curved dome shape distributes forces evenly, preventing concentration of stress at any single point. The inner surface of the skull is smooth and polished, ensuring that the delicate brain tissue doesn't suffer abrasion during normal head movements. Strategic openings called foramina allow essential nerves and blood vessels to pass through while maintaining structural integrity. The thickness of skull bones varies by location - areas like the forehead and back of the head are thicker where impacts are more likely, while the temporal regions are thinner but protected by muscle and positioned to avoid direct trauma. This bony fortress is so crucial because nervous tissue, unlike other body tissues, cannot regenerate effectively when damaged, making protection absolutely essential for survival."
            },
            vertebral: {
                title: "Vertebral Column - Spinal Cord's Guardian",
                subtitle: "Flexible protection for the neural highway",
                icon: "🦴",
                modelUrl: "https://sketchfab.com/models/473c3b4bcd3e45f691ff2cc772a27930/embed?autostart=1&internal=1&tracking=0&ui_ar=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "The vertebral column provides both protection and flexibility for the spinal cord, consisting of 33 vertebrae that form a moveable tube of bone around the neural highway. This structure must balance the competing demands of protecting delicate nerve tissue while allowing for complex body movements.",
                concepts: [
                    "33 vertebrae form protective canal around spinal cord",
                    "Intervertebral discs cushion impacts and allow movement",
                    "Vertebral arches create continuous protective tunnel",
                    "Natural curves distribute weight and absorb shock"
                ],
                protectionFact: "The vertebral column's S-shaped curves act like a spring, reducing the impact forces transmitted to the spinal cord by up to 10 times compared to a straight column.",
                objectives: "Explore how the vertebral column's unique design provides both protection and mobility for the spinal cord, demonstrating the importance of flexible yet secure nervous tissue protection.",
                narration: "Marvel at the vertebral column - an engineering masterpiece that protects your spinal cord while enabling incredible flexibility! This remarkable structure consists of 33 individual vertebrae stacked to form a flexible protective tube around the spinal cord. Each vertebra has a body for weight-bearing and a neural arch that forms the protective canal called the vertebral foramen. When stacked together, these foramina create a continuous tunnel that shields the spinal cord from damage. The column's ingenious design includes four natural curves - cervical and lumbar curves that bend forward, and thoracic and sacral curves that bend backward. These S-shaped curves act like a spring, absorbing and distributing forces that could otherwise damage the delicate spinal cord. Between each vertebra are intervertebral discs made of tough fibrocartilage that act as shock absorbers and allow for movement between adjacent bones. The vertebral column must solve a unique engineering challenge - providing rigid protection for the spinal cord while allowing the flexibility needed for bending, twisting, and turning movements. Unlike the skull's solid protection, the spine uses segmented armor that can move while maintaining continuous protection. This design ensures that whether you're running, jumping, or simply turning your head, your spinal cord remains safely enclosed within its bony guardian."
            },
            brain_layers: {
                title: "Brain Protection Layers - Multiple Defensive Systems",
                subtitle: "Meninges and cerebrospinal fluid cushioning",
                icon: "🧠",
                modelUrl: "https://sketchfab.com/models/36870e0970f044a8957b0af3a180a7eb/embed?autostart=1&internal=1&tracking=0&ui_ar=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "Beyond bony protection, the brain has multiple additional defensive layers including the meninges and cerebrospinal fluid. This model shows how these protective systems work together to cushion the brain against impacts and maintain optimal conditions for neural function.",
                concepts: [
                    "Three meningeal layers provide tissue protection",
                    "Cerebrospinal fluid acts as liquid shock absorber",
                    "Blood-brain barrier filters harmful substances",
                    "Multiple protection systems work together"
                ],
                protectionFact: "Cerebrospinal fluid is continuously produced and renewed every 6-8 hours, providing fresh protection and removing waste products from brain tissue throughout your entire life.",
                objectives: "Understand the layered protection systems beyond bone and appreciate how multiple mechanisms work together to maintain optimal conditions for nervous tissue function.",
                narration: "Discover the brain's sophisticated multi-layered protection system that goes far beyond the skull's bony armor! This model reveals three protective membranes called meninges that wrap around the brain and spinal cord. The tough outer dura mater is like leather armor, providing a strong barrier against physical damage. The delicate arachnoid mater beneath it looks like a spider web and contains blood vessels that nourish the nervous tissue. The innermost pia mater clings directly to the brain's surface, following every fold and groove. Between the arachnoid and pia mater flows cerebrospinal fluid - a clear, colorless liquid that acts as the brain's personal shock absorption system. This fluid is constantly circulating, cushioning the brain against impacts and maintaining optimal pressure within the skull. The cerebrospinal fluid also serves as the brain's waste removal system, carrying away metabolic products and toxins. Additionally, the blood-brain barrier acts as a highly selective filter, allowing beneficial nutrients to reach brain tissue while blocking potentially harmful substances from the bloodstream. This multi-layered defense system demonstrates why nervous tissue is so well-protected - the brain and spinal cord cannot heal or regenerate like other tissues, so preventing damage in the first place is absolutely critical. The combination of bony protection, meningeal barriers, fluid cushioning, and chemical filtering creates one of the most comprehensive protective systems in the human body."
            }
        };

        // Global Variables
        let currentStep = 'skull';
        let voiceEnabled = true;
        let autoPlayEnabled = false;
        let currentSpeech = null;
        let selectedVoice = null;
        let journeyProgress = 0;
        let guidedTourActive = false;

        // Initialize Voice System
        function initVoiceSystem() {
            if (!('speechSynthesis' in window)) {
                console.warn('Speech synthesis not supported');
                voiceEnabled = false;
                document.getElementById('voiceToggle').style.display = 'none';
                return;
            }

            function loadVoices() {
                const voices = speechSynthesis.getVoices();
                if (voices.length === 0) return;

                // Prefer natural-sounding voices
                const preferredVoices = [
                    'Google UK English Female',
                    'Microsoft Sonia',
                    'Microsoft Hazel',
                    'Samantha',
                    'Victoria'
                ];

                for (const name of preferredVoices) {
                    selectedVoice = voices.find(v => v.name.includes(name));
                    if (selectedVoice) break;
                }

                if (!selectedVoice) {
                    selectedVoice = voices.find(v => v.lang.startsWith('en'));
                }
            }

            loadVoices();
            if (speechSynthesis.onvoiceschanged !== undefined) {
                speechSynthesis.onvoiceschanged = loadVoices;
            }
        }

        // Load Journey Step
        function loadJourneyStep(stepId) {
            const stepData = JOURNEY_DATA[stepId];
            if (!stepData) return;

            currentStep = stepId;
            
            // Update model
            document.getElementById('api-frame').src = stepData.modelUrl;
            
            // Update info panel
            document.getElementById('stepIcon').textContent = stepData.icon;
            document.getElementById('stepTitle').textContent = stepData.title;
            document.getElementById('stepSubtitle').textContent = stepData.subtitle;
            document.getElementById('mainDescription').textContent = stepData.description;
            
            // Update key concepts
            const conceptsList = document.getElementById('keyConcepts');
            conceptsList.innerHTML = stepData.concepts.map(c => `<li>${c}</li>`).join('');
            
            // Update protection fact
            document.getElementById('protectionFact').textContent = stepData.protectionFact;
            
            // Update learning objectives
            document.getElementById('learningObjectives').textContent = stepData.objectives;
            
            // Update navigation buttons
            updateNavigationButtons(stepId);
            
            // Update progress
            updateProgress();
            
            // Play narration if enabled
            if (voiceEnabled) {
                speakText(stepData.narration);
            }
        }

        // Update Navigation Buttons
        function updateNavigationButtons(activeStep) {
            const buttons = document.querySelectorAll('.journey-btn');
            const steps = ['skull', 'vertebral', 'brain_layers'];
            const activeIndex = steps.indexOf(activeStep);
            
            buttons.forEach((btn, index) => {
                btn.classList.remove('active', 'completed');
                if (index < activeIndex) {
                    btn.classList.add('completed');
                } else if (index === activeIndex) {
                    btn.classList.add('active');
                }
            });
            
            // Update mini steps
            const miniSteps = document.querySelectorAll('.step-mini');
            miniSteps.forEach((step, index) => {
                step.classList.remove('active', 'completed');
                if (index < activeIndex) {
                    step.classList.add('completed');
                } else if (index === activeIndex) {
                    step.classList.add('active');
                }
            });
        }

        // Update Progress
        function updateProgress() {
            const steps = ['skull', 'vertebral', 'brain_layers'];
            const currentIndex = steps.indexOf(currentStep);
            const progress = ((currentIndex + 1) / steps.length) * 100;
            
            document.getElementById('progressPercent').textContent = Math.round(progress) + '%';
            document.getElementById('progressFill').style.width = progress + '%';
        }

        // Speech Functions
        function speakText(text) {
            if (!voiceEnabled || !text) return;
            
            stopSpeech();
            
            currentSpeech = new SpeechSynthesisUtterance(text);
            if (selectedVoice) {
                currentSpeech.voice = selectedVoice;
            }
            currentSpeech.rate = 0.9;
            currentSpeech.pitch = 1.0;
            currentSpeech.volume = 0.9;
            
            currentSpeech.onstart = () => {
                document.getElementById('voiceIndicator').classList.add('visible');
                document.getElementById('narrationText').textContent = 
                    text.substring(0, 50) + (text.length > 50 ? '...' : '');
            };
            
            currentSpeech.onend = () => {
                document.getElementById('voiceIndicator').classList.remove('visible');
                currentSpeech = null;
                
                // Auto-advance if guided tour is active
                if (guidedTourActive) {
                    setTimeout(nextStep, 2000);
                }
            };
            
            speechSynthesis.speak(currentSpeech);
        }

        function stopSpeech() {
            if (currentSpeech) {
                speechSynthesis.cancel();
                currentSpeech = null;
                document.getElementById('voiceIndicator').classList.remove('visible');
            }
        }

        // Control Functions
        function toggleVoice() {
            voiceEnabled = !voiceEnabled;
            const btn = document.getElementById('voiceToggle');
            btn.textContent = voiceEnabled ? '🔊' : '🔇';
            btn.classList.toggle('active', voiceEnabled);
            
            if (!voiceEnabled) {
                stopSpeech();
            }
        }

        function toggleAutoPlay() {
            autoPlayEnabled = !autoPlayEnabled;
            if (autoPlayEnabled) {
                startGuidedTour();
            } else {
                guidedTourActive = false;
            }
        }

        function toggleInfo() {
            const panel = document.getElementById('infoPanel');
            panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
        }

        // Guided Tour
        function startGuidedTour() {
            guidedTourActive = true;
            const steps = ['skull', 'vertebral', 'brain_layers'];
            let stepIndex = 0;
            
            function tourStep() {
                if (stepIndex < steps.length && guidedTourActive) {
                    loadJourneyStep(steps[stepIndex]);
                    stepIndex++;
                } else {
                    guidedTourActive = false;
                    if (voiceEnabled) {
                        speakText("You have completed your journey through nervous tissue protection! You now understand how the skull, vertebral column, and multiple protective layers work together to safeguard the irreplaceable neural tissue that controls every aspect of life.");
                    }
                }
            }
            
            tourStep();
            window.nextStep = tourStep;
        }

        // Quiz Function
        function showQuiz() {
            const questions = [
                "How does the skull's structure provide protection for the brain?",
                "What makes the vertebral column both protective and flexible?",
                "What are the different layers of protection around the brain?",
                "Why is cerebrospinal fluid important for brain protection?",
                "Why does nervous tissue require such extensive protective mechanisms?"
            ];
            
            const randomQ = questions[Math.floor(Math.random() * questions.length)];
            
            if (voiceEnabled) {
                speakText(`Here's a question about nervous tissue protection: ${randomQ} Think about what you've learned about the multiple defensive systems that safeguard the brain and spinal cord.`);
            }
        }

        // Initialize
        function init() {
            initVoiceSystem();
            
            // Hide loading screen
            setTimeout(() => {
                const loading = document.getElementById('loadingOverlay');
                loading.style.opacity = '0';
                setTimeout(() => {
                    loading.style.display = 'none';
                    
                    // Welcome message
                    if (voiceEnabled) {
                        speakText("Welcome to your exploration of nervous tissue protection! We'll discover the sophisticated defensive systems that safeguard the brain and spinal cord - from the skull's bony armor to the vertebral column's flexible protection and the brain's multiple protective layers. Let's begin with the skull's remarkable protective design!");
                    }
                }, 1000);
            }, 3000);
            
            // Keyboard shortcuts
            document.addEventListener('keydown', (e) => {
                switch(e.key) {
                    case 'v': toggleVoice(); break;
                    case 'i': toggleInfo(); break;
                    case 'g': startGuidedTour(); break;
                    case 'Escape': stopSpeech(); guidedTourActive = false; break;
                    case 'ArrowRight': nextStep && nextStep(); break;
                }
            });
        }

        // Start the application
        init();
    </script>
</body>
</html>