<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Neuron Structure and Function - The Electrical Architecture of the Nervous System</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tween.js/18.6.4/tween.umd.js"></script>

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            color: white;
            overflow: hidden;
            position: relative;
            height: 100vh;
        }

        /* Animated Background */
        .bg-animation {
            position: fixed;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: 0;
            opacity: 0.1;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 320"><path fill="%23ffffff" fill-opacity="0.2" d="M0,96L48,112C96,128,192,160,288,186.7C384,213,480,235,576,213.3C672,192,768,128,864,128C960,128,1056,192,1152,197.3C1248,203,1344,149,1392,122.7L1440,96L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z"></path></svg>') repeat-x;
            animation: wave 25s linear infinite;
        }

        @keyframes wave {
            0% { background-position-x: 0; }
            100% { background-position-x: 1440px; }
        }

        /* Museum Interface - Compact Header */
        .museum-header {
            position: absolute;
            top: 10px;
            left: 20px;
            text-align: left;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            padding: 10px 18px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .museum-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 4px;
            background: linear-gradient(45deg, #00d4ff, #ff6b6b);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: titleGlow 3s ease-in-out infinite;
        }

        @keyframes titleGlow {
            0%, 100% { filter: brightness(1); }
            50% { filter: brightness(1.2); }
        }

        .exhibit-subtitle {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.8);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .electrical-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            background: #00d4ff;
            border-radius: 50%;
            animation: electrical-pulse 1s ease-in-out infinite;
        }

        @keyframes electrical-pulse {
            0%, 100% { transform: scale(1); opacity: 1; box-shadow: 0 0 0 0 rgba(0, 212, 255, 0.7); }
            50% { transform: scale(1.2); opacity: 0.8; box-shadow: 0 0 0 10px rgba(0, 212, 255, 0); }
        }

        /* Journey Navigation - Enhanced */
        .journey-navigation {
            position: absolute;
            bottom: 20px;
            left: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            padding: 15px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            max-width: 340px;
        }

        .journey-title {
            font-size: 14px;
            font-weight: 600;
            color: #00d4ff;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .journey-steps {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }

        .journey-btn {
            background: rgba(0, 212, 255, 0.2);
            border: 1px solid rgba(0, 212, 255, 0.4);
            color: white;
            padding: 6px 10px;
            border-radius: 20px;
            font-size: 11px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 4px;
            white-space: nowrap;
        }

        .journey-btn:hover {
            background: rgba(0, 212, 255, 0.3);
            border-color: #00d4ff;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 212, 255, 0.3);
        }

        .journey-btn.active {
            background: linear-gradient(135deg, #00d4ff, #0984e3);
            border-color: #00d4ff;
            box-shadow: 0 0 20px rgba(0, 212, 255, 0.5);
            animation: pulse 2s infinite;
        }

        .journey-btn.completed {
            background: rgba(255, 107, 107, 0.3);
            border-color: #ff6b6b;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        /* 3D Model Container */
        .model-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 0;
            overflow: hidden;
            border: none;
            z-index: 100;
        }

        .sketchfab-embed-wrapper {
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
        }

        .sketchfab-embed-wrapper iframe {
            width: 100%;
            height: 100%;
            border: none;
            border-radius: 0;
        }

        /* Information Panel - Enhanced */
        .info-panel {
            position: absolute;
            top: 70px;
            right: 20px;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(25px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 16px;
            padding: 24px;
            width: 380px;
            max-height: calc(100vh - 140px);
            z-index: 800;
            overflow-y: auto;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }

        .info-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        }

        .info-icon {
            font-size: 28px;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        .info-title {
            flex: 1;
        }

        .info-title h2 {
            font-size: 18px;
            color: #00d4ff;
            margin-bottom: 4px;
        }

        .info-subtitle {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.7);
        }

        .info-content {
            color: rgba(255, 255, 255, 0.9);
            font-size: 14px;
            line-height: 1.6;
        }

        /* Progress Tracker */
        .progress-tracker {
            background: linear-gradient(135deg, rgba(0, 212, 255, 0.1), rgba(255, 107, 107, 0.1));
            border: 1px solid rgba(0, 212, 255, 0.3);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 20px;
        }

        .progress-header {
            font-size: 13px;
            font-weight: 600;
            color: #00d4ff;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .progress-percentage {
            font-size: 18px;
            color: #ff6b6b;
            font-weight: 700;
        }

        .progress-bar {
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 12px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #00d4ff, #ff6b6b);
            border-radius: 4px;
            transition: width 0.8s ease;
            box-shadow: 0 0 10px rgba(0, 212, 255, 0.5);
        }

        .progress-steps-mini {
            display: flex;
            justify-content: space-between;
            font-size: 8px;
            color: rgba(255, 255, 255, 0.6);
        }

        .step-mini {
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .step-mini.active {
            color: #00d4ff;
            font-weight: 600;
        }

        .step-mini.completed {
            color: #ff6b6b;
        }

        /* Information Cards */
        .info-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 14px;
            margin-bottom: 14px;
        }

        .info-card-title {
            color: #00d4ff;
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .info-card-content {
            color: rgba(255, 255, 255, 0.85);
            font-size: 12px;
            line-height: 1.5;
        }

        .info-list {
            list-style: none;
            padding: 0;
        }

        .info-list li {
            padding: 6px 0;
            padding-left: 20px;
            position: relative;
            font-size: 12px;
            color: rgba(255, 255, 255, 0.8);
        }

        .info-list li:before {
            content: "⚡";
            position: absolute;
            left: 0;
            font-size: 10px;
            color: #00d4ff;
        }

        /* Neural Fact Box */
        .neural-fact {
            background: linear-gradient(135deg, rgba(255, 107, 107, 0.1), rgba(0, 212, 255, 0.1));
            border: 1px solid rgba(255, 107, 107, 0.3);
            border-radius: 12px;
            padding: 14px;
            margin: 16px 0;
            position: relative;
            overflow: hidden;
        }

        .neural-fact:before {
            content: "🧠";
            position: absolute;
            top: -20px;
            right: -20px;
            font-size: 60px;
            opacity: 0.1;
        }

        .neural-fact-title {
            color: #ff6b6b;
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 6px;
        }

        .neural-fact-text {
            color: rgba(255, 255, 255, 0.9);
            font-size: 12px;
            line-height: 1.5;
            position: relative;
            z-index: 1;
        }

        /* Voice Controls */
        .voice-controls {
            position: absolute;
            top: 10px;
            right: 20px;
            display: flex;
            gap: 8px;
            z-index: 1000;
        }

        .control-btn {
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            width: 44px;
            height: 44px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            position: relative;
        }

        .control-btn:hover {
            background: rgba(0, 212, 255, 0.3);
            border-color: #00d4ff;
            transform: scale(1.1);
        }

        .control-btn.active {
            background: rgba(0, 212, 255, 0.4);
            border-color: #00d4ff;
            box-shadow: 0 0 20px rgba(0, 212, 255, 0.5);
        }

        .control-tooltip {
            position: absolute;
            bottom: -30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9);
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 10px;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .control-btn:hover .control-tooltip {
            opacity: 1;
        }

        /* Loading Screen */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            transition: opacity 1s ease;
        }

        .loading-content {
            text-align: center;
        }

        .loading-neuron {
            font-size: 60px;
            animation: neuron-fire 2s ease-in-out infinite;
            margin-bottom: 20px;
        }

        @keyframes neuron-fire {
            0%, 100% { transform: scale(1); filter: brightness(1); }
            50% { transform: scale(1.1); filter: brightness(1.5); }
        }

        .loading-text {
            color: white;
            font-size: 20px;
            margin-bottom: 20px;
        }

        .loading-progress {
            width: 200px;
            height: 4px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 2px;
            overflow: hidden;
        }

        .loading-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #00d4ff, #ff6b6b);
            animation: loading 2s ease-in-out infinite;
        }

        @keyframes loading {
            0% { width: 0%; }
            50% { width: 100%; }
            100% { width: 0%; }
        }

        /* Voice Indicator */
        .voice-indicator {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(0, 212, 255, 0.5);
            border-radius: 30px;
            padding: 14px 28px;
            display: flex;
            align-items: center;
            gap: 12px;
            z-index: 1000;
            opacity: 0;
            transition: all 0.3s ease;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }

        .voice-indicator.visible {
            opacity: 1;
            transform: translateX(-50%) translateY(-10px);
        }

        .voice-waves {
            display: flex;
            align-items: center;
            gap: 3px;
        }

        .voice-wave {
            width: 3px;
            height: 20px;
            background: linear-gradient(180deg, #00d4ff, #ff6b6b);
            border-radius: 2px;
            animation: voice-wave 1s ease-in-out infinite;
        }

        .voice-wave:nth-child(2) { animation-delay: 0.1s; }
        .voice-wave:nth-child(3) { animation-delay: 0.2s; }
        .voice-wave:nth-child(4) { animation-delay: 0.3s; }
        .voice-wave:nth-child(5) { animation-delay: 0.4s; }

        @keyframes voice-wave {
            0%, 100% { transform: scaleY(0.3); }
            50% { transform: scaleY(1); }
        }

        .narration-text {
            color: white;
            font-size: 13px;
            max-width: 300px;
        }

        /* Quick Actions */
        .quick-actions {
            position: absolute;
            bottom: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            z-index: 1000;
        }

        .action-btn {
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 10px 16px;
            border-radius: 25px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
        }

        .action-btn:hover {
            background: rgba(0, 212, 255, 0.3);
            border-color: #00d4ff;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 212, 255, 0.3);
        }

        /* Custom Scrollbar */
        .info-panel::-webkit-scrollbar {
            width: 6px;
        }

        .info-panel::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 3px;
        }

        .info-panel::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, #00d4ff, #ff6b6b);
            border-radius: 3px;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .info-panel {
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                top: auto;
                width: 100%;
                max-height: 50vh;
                border-radius: 20px 20px 0 0;
            }
            
            .journey-navigation {
                bottom: 52vh;
                max-width: calc(100% - 40px);
            }
            
            .voice-controls {
                top: auto;
                bottom: 55vh;
                right: 10px;
            }
            
            .quick-actions {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="bg-animation"></div>

    <!-- Loading Screen -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-content">
            <div class="loading-neuron">🧠</div>
            <div class="loading-text">Preparing Your Neural Journey...</div>
            <div class="loading-progress">
                <div class="loading-progress-bar"></div>
            </div>
        </div>
    </div>

    <!-- Museum Header -->
    <div class="museum-header">
        <div class="museum-title">Neuron Structure and Function</div>
        <div class="exhibit-subtitle">
            <span class="electrical-indicator"></span>
            The Electrical Architecture of the Nervous System
        </div>
    </div>

    <!-- Journey Navigation -->
    <div class="journey-navigation">
        <div class="journey-title">
            <span>🧠</span>
            <span>Your Neural Journey</span>
        </div>
        <div class="journey-steps">
            <button class="journey-btn active" onclick="loadJourneyStep('neuron_structure')">
                <span>🔬</span> Neuron Structure
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('action_potential')">
                <span>⚡</span> Action Potential
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('synapse')">
                <span>🔗</span> Synapse
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('neuromuscular')">
                <span>💪</span> Neuromuscular
            </button>
        </div>
    </div>

    <!-- 3D Model Container -->
    <div class="model-container">
        <div class="sketchfab-embed-wrapper">
            <iframe id="api-frame"
                    title="Neuron Structure Model" 
                    frameborder="0" 
                    allowfullscreen 
                    mozallowfullscreen="true" 
                    webkitallowfullscreen="true" 
                    allow="autoplay; fullscreen; xr-spatial-tracking"
                    xr-spatial-tracking 
                    execution-while-out-of-viewport 
                    execution-while-not-rendered 
                    web-share 
                    src="https://sketchfab.com/models/f33ea01f8e674578b55ac51d110b1721/embed?autostart=1&internal=1&tracking=0&ui_ar=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0">
            </iframe>
        </div>
    </div>

    <!-- Information Panel -->
    <div class="info-panel" id="infoPanel">
        <div class="info-header">
            <div class="info-icon" id="stepIcon">🔬</div>
            <div class="info-title">
                <h2 id="stepTitle">Neuron Structure - The Communication Cell</h2>
                <div class="info-subtitle" id="stepSubtitle">Architecture for signal transmission</div>
            </div>
        </div>

        <!-- Progress Tracker -->
        <div class="progress-tracker">
            <div class="progress-header">
                <span>Neural Learning Progress</span>
                <span class="progress-percentage" id="progressPercent">25%</span>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 25%"></div>
            </div>
            <div class="progress-steps-mini">
                <span class="step-mini active" onclick="loadJourneyStep('neuron_structure')">Structure</span>
                <span class="step-mini" onclick="loadJourneyStep('action_potential')">Impulse</span>
                <span class="step-mini" onclick="loadJourneyStep('synapse')">Synapse</span>
                <span class="step-mini" onclick="loadJourneyStep('neuromuscular')">Junction</span>
            </div>
        </div>

        <div class="info-content" id="mainDescription">
            Neurons are highly specialized cells designed for rapid communication throughout the nervous system. Each component of a neuron has evolved to optimize signal reception, integration, and transmission, making them the most efficient communication cells in biology.
        </div>

        <div class="info-card">
            <div class="info-card-title">
                <span>🔬</span> Key Structures
            </div>
            <div class="info-card-content">
                <ul class="info-list" id="keyConcepts">
                    <li>Dendrites receive signals from other neurons</li>
                    <li>Cell body integrates incoming information</li>
                    <li>Axon conducts electrical impulses away from cell body</li>
                    <li>Axon terminals release neurotransmitters</li>
                </ul>
            </div>
        </div>

        <div class="neural-fact">
            <div class="neural-fact-title">Neural Insight</div>
            <div class="neural-fact-text" id="neuralFact">
                A single neuron can receive input from up to 10,000 other neurons through its dendrites, yet it produces just one output signal - demonstrating incredible computational power in signal integration.
            </div>
        </div>

        <div class="info-card">
            <div class="info-card-title">
                <span>🎯</span> Learning Objectives
            </div>
            <div class="info-card-content" id="learningObjectives">
                Identify the major components of a neuron and understand how each structure contributes to the cell's ability to receive, process, and transmit electrical and chemical signals.
            </div>
        </div>
    </div>

    <!-- Voice Controls -->
    <div class="voice-controls">
        <button class="control-btn active" id="voiceToggle" onclick="toggleVoice()">
            🔊
            <span class="control-tooltip">Voice Narration</span>
        </button>
        <button class="control-btn" onclick="toggleAutoPlay()">
            ▶️
            <span class="control-tooltip">Auto Journey</span>
        </button>
        <button class="control-btn" onclick="toggleInfo()">
            ℹ️
            <span class="control-tooltip">Toggle Info</span>
        </button>
    </div>

    <!-- Quick Actions -->
    <div class="quick-actions">
        <button class="action-btn" onclick="startGuidedTour()">
            <span>🚀</span> Guided Tour
        </button>
        <button class="action-btn" onclick="showQuiz()">
            <span>🎯</span> Test Knowledge
        </button>
    </div>

    <!-- Voice Indicator -->
    <div class="voice-indicator" id="voiceIndicator">
        <div class="voice-waves">
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
        </div>
        <div class="narration-text" id="narrationText">Narrating...</div>
    </div>

    <script>
        // Journey Step Data with Complete Educational Content
        const JOURNEY_DATA = {
            neuron_structure: {
                title: "Neuron Structure - The Communication Cell",
                subtitle: "Architecture for signal transmission",
                icon: "🔬",
                modelUrl: "https://sketchfab.com/models/f33ea01f8e674578b55ac51d110b1721/embed?autostart=1&internal=1&tracking=0&ui_ar=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "Neurons are highly specialized cells designed for rapid communication throughout the nervous system. Each component of a neuron has evolved to optimize signal reception, integration, and transmission, making them the most efficient communication cells in biology.",
                concepts: [
                    "Dendrites receive signals from other neurons",
                    "Cell body integrates incoming information",
                    "Axon conducts electrical impulses away from cell body",
                    "Axon terminals release neurotransmitters"
                ],
                neuralFact: "A single neuron can receive input from up to 10,000 other neurons through its dendrites, yet it produces just one output signal - demonstrating incredible computational power in signal integration.",
                objectives: "Identify the major components of a neuron and understand how each structure contributes to the cell's ability to receive, process, and transmit electrical and chemical signals.",
                narration: "Welcome to the intricate world of neuron structure! This model shows a typical neuron with its specialized components perfectly designed for communication. Starting from the top, the dendrites are branched extensions that act like antennae, receiving chemical signals from thousands of other neurons. These tree-like structures maximize surface area for receiving inputs. The cell body, or soma, contains the nucleus and most organelles, and serves as the neuron's control center where incoming signals are integrated and processed. If the combined signals reach a critical threshold, an electrical impulse is generated. This impulse travels down the axon, a long projection that can extend up to a meter in some neurons. The axon is often wrapped in myelin, a fatty insulation that speeds up signal transmission. At the end of the axon are terminals that release chemical messengers called neurotransmitters. This elegant design allows neurons to receive multiple inputs, integrate them, and produce a single output - the fundamental basis of all nervous system function."
            },
            action_potential: {
                title: "Action Potential - The Electrical Impulse",
                subtitle: "How nerve signals propagate",
                icon: "⚡",
                modelUrl: "https://sketchfab.com/models/c7ca6da31f5848748f7ba7ccb2508266/embed?autostart=1&internal=1&tracking=0&ui_ar=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "The action potential is a rapid electrical impulse that travels along the neuron's axon. This all-or-nothing event involves precise changes in membrane permeability to sodium and potassium ions, creating a wave of electrical activity that can travel at speeds up to 120 meters per second.",
                concepts: [
                    "Resting potential maintained by sodium-potassium pump",
                    "Depolarization opens voltage-gated sodium channels",
                    "Repolarization restores negative membrane potential",
                    "Refractory period prevents signal from traveling backward"
                ],
                neuralFact: "Action potentials are all-or-nothing events - they either occur completely or not at all. This digital nature of neural signaling ensures reliable communication over long distances without signal degradation.",
                objectives: "Understand the ionic basis of action potentials and how these electrical impulses propagate along axons to enable rapid communication in the nervous system.",
                narration: "Witness the action potential - one of biology's most precise electrical events! This animation shows how a nerve impulse propagates along an axon through a carefully orchestrated sequence of ion movements. At rest, the neuron maintains a negative interior relative to the outside, typically around -70 millivolts, through the action of the sodium-potassium pump. When stimulated sufficiently, voltage-gated sodium channels open rapidly, allowing sodium ions to rush into the cell. This influx of positive charge depolarizes the membrane, creating the rising phase of the action potential. The depolarization spreads to adjacent areas of the membrane, opening more sodium channels and propagating the signal forward. Almost immediately, the sodium channels close and voltage-gated potassium channels open, allowing potassium to flow out and restore the negative membrane potential during repolarization. The sodium-potassium pump then works to restore the original ion concentrations. This entire process takes just a few milliseconds but creates a reliable electrical signal that can travel vast distances without losing strength - enabling your brain to control muscles in your toes almost instantaneously."
            },
            synapse: {
                title: "Synapse - Chemical Communication",
                subtitle: "Where neurons meet and transmit signals",
                icon: "🔗",
                modelUrl: "https://sketchfab.com/models/d3be9054e57b4104b3f029cb8c6f19a9/embed?autostart=1&internal=1&tracking=0&ui_ar=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "Synapses are specialized junctions where neurons communicate with each other through chemical neurotransmitters. These microscopic gaps convert electrical signals into chemical messages and back to electrical signals, allowing for complex information processing and modulation.",
                concepts: [
                    "Presynaptic terminal releases neurotransmitters",
                    "Synaptic cleft is the gap between neurons",
                    "Postsynaptic receptors bind neurotransmitters",
                    "Signal can be excitatory or inhibitory"
                ],
                neuralFact: "A typical synapse is only 20-40 nanometers wide - about 1000 times thinner than a human hair - yet neurotransmitters can cross this gap in less than a millisecond through simple diffusion.",
                objectives: "Explore synaptic structure and function, understanding how chemical neurotransmission enables complex neural communication and information processing.",
                narration: "Enter the synaptic cleft - the remarkable microscopic space where neural communication transforms from electrical to chemical and back to electrical! This model shows the intricate structure of a synapse where two neurons meet but don't actually touch. When an action potential reaches the presynaptic terminal, it triggers voltage-gated calcium channels to open. The influx of calcium ions causes synaptic vesicles filled with neurotransmitters to fuse with the presynaptic membrane and release their contents into the synaptic cleft. These chemical messengers diffuse across the tiny gap - a journey measured in nanometers but crucial for brain function. On the other side, neurotransmitters bind to specific receptors on the postsynaptic membrane, causing ion channels to open or close. This can either excite the postsynaptic neuron, making it more likely to fire an action potential, or inhibit it, making firing less likely. The strength and type of synaptic transmission can be modified, forming the basis of learning and memory. After transmission, neurotransmitters are either broken down by enzymes or taken back up by the presynaptic terminal for reuse, terminating the signal."
            },
            neuromuscular: {
                title: "Neuromuscular Junction - Neural Control of Movement",
                subtitle: "Where nerve meets muscle",
                icon: "💪",
                modelUrl: "https://sketchfab.com/models/5dabfc25875448459c460a07b9c68343/embed?autostart=1&internal=1&tracking=0&ui_ar=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "The neuromuscular junction is a specialized synapse between motor neurons and skeletal muscle fibers. This critical interface translates neural commands into mechanical force, enabling all voluntary movement through the release of acetylcholine neurotransmitter.",
                concepts: [
                    "Motor neuron terminals innervate muscle fibers",
                    "Acetylcholine is the key neurotransmitter",
                    "Motor end plate contains acetylcholine receptors",
                    "Muscle contraction follows neural stimulation"
                ],
                neuralFact: "Each motor neuron can control multiple muscle fibers - from just a few in precise muscles like those controlling eye movement, to over 1000 in powerful muscles like those in your thigh.",
                objectives: "Understand how the nervous system controls skeletal muscle contraction through neuromuscular junctions and appreciate the precision of motor control.",
                narration: "Discover the neuromuscular junction - the critical interface where your nervous system's commands become physical movement! This specialized synapse represents the final link in the chain from thought to action. When a motor neuron fires an action potential, it travels down the axon to the neuromuscular junction. Here, the nerve terminal forms an intricate connection with the muscle fiber at a region called the motor end plate. The arrival of the action potential triggers the release of acetylcholine, the primary neurotransmitter at neuromuscular junctions. This chemical messenger floods the synaptic cleft and binds to acetylcholine receptors densely packed on the muscle membrane. The binding opens sodium channels, depolarizing the muscle fiber and triggering a muscle action potential that spreads across the entire fiber. This electrical event initiates the molecular machinery of muscle contraction - the sliding of actin and myosin filaments that generates force. The precision of this system is remarkable: the time from neural command to muscle response is just a few milliseconds, and the strength of contraction can be precisely controlled by varying the frequency of neural stimulation. This elegant system enables everything from the delicate movements required for writing to the powerful contractions needed for jumping."
            }
        };

        // Global Variables
        let currentStep = 'neuron_structure';
        let voiceEnabled = true;
        let autoPlayEnabled = false;
        let currentSpeech = null;
        let selectedVoice = null;
        let journeyProgress = 0;
        let guidedTourActive = false;

        // Initialize Voice System
        function initVoiceSystem() {
            if (!('speechSynthesis' in window)) {
                console.warn('Speech synthesis not supported');
                voiceEnabled = false;
                document.getElementById('voiceToggle').style.display = 'none';
                return;
            }

            function loadVoices() {
                const voices = speechSynthesis.getVoices();
                if (voices.length === 0) return;

                // Prefer natural-sounding voices
                const preferredVoices = [
                    'Google UK English Female',
                    'Microsoft Sonia',
                    'Microsoft Hazel',
                    'Samantha',
                    'Victoria'
                ];

                for (const name of preferredVoices) {
                    selectedVoice = voices.find(v => v.name.includes(name));
                    if (selectedVoice) break;
                }

                if (!selectedVoice) {
                    selectedVoice = voices.find(v => v.lang.startsWith('en'));
                }
            }

            loadVoices();
            if (speechSynthesis.onvoiceschanged !== undefined) {
                speechSynthesis.onvoiceschanged = loadVoices;
            }
        }

        // Load Journey Step
        function loadJourneyStep(stepId) {
            const stepData = JOURNEY_DATA[stepId];
            if (!stepData) return;

            currentStep = stepId;
            
            // Update model
            document.getElementById('api-frame').src = stepData.modelUrl;
            
            // Update info panel
            document.getElementById('stepIcon').textContent = stepData.icon;
            document.getElementById('stepTitle').textContent = stepData.title;
            document.getElementById('stepSubtitle').textContent = stepData.subtitle;
            document.getElementById('mainDescription').textContent = stepData.description;
            
            // Update key concepts
            const conceptsList = document.getElementById('keyConcepts');
            conceptsList.innerHTML = stepData.concepts.map(c => `<li>${c}</li>`).join('');
            
            // Update neural fact
            document.getElementById('neuralFact').textContent = stepData.neuralFact;
            
            // Update learning objectives
            document.getElementById('learningObjectives').textContent = stepData.objectives;
            
            // Update navigation buttons
            updateNavigationButtons(stepId);
            
            // Update progress
            updateProgress();
            
            // Play narration if enabled
            if (voiceEnabled) {
                speakText(stepData.narration);
            }
        }

        // Update Navigation Buttons
        function updateNavigationButtons(activeStep) {
            const buttons = document.querySelectorAll('.journey-btn');
            const steps = ['neuron_structure', 'action_potential', 'synapse', 'neuromuscular'];
            const activeIndex = steps.indexOf(activeStep);
            
            buttons.forEach((btn, index) => {
                btn.classList.remove('active', 'completed');
                if (index < activeIndex) {
                    btn.classList.add('completed');
                } else if (index === activeIndex) {
                    btn.classList.add('active');
                }
            });
            
            // Update mini steps
            const miniSteps = document.querySelectorAll('.step-mini');
            miniSteps.forEach((step, index) => {
                step.classList.remove('active', 'completed');
                if (index < activeIndex) {
                    step.classList.add('completed');
                } else if (index === activeIndex) {
                    step.classList.add('active');
                }
            });
        }

        // Update Progress
        function updateProgress() {
            const steps = ['neuron_structure', 'action_potential', 'synapse', 'neuromuscular'];
            const currentIndex = steps.indexOf(currentStep);
            const progress = ((currentIndex + 1) / steps.length) * 100;
            
            document.getElementById('progressPercent').textContent = Math.round(progress) + '%';
            document.getElementById('progressFill').style.width = progress + '%';
        }

        // Speech Functions
        function speakText(text) {
            if (!voiceEnabled || !text) return;
            
            stopSpeech();
            
            currentSpeech = new SpeechSynthesisUtterance(text);
            if (selectedVoice) {
                currentSpeech.voice = selectedVoice;
            }
            currentSpeech.rate = 0.9;
            currentSpeech.pitch = 1.0;
            currentSpeech.volume = 0.9;
            
            currentSpeech.onstart = () => {
                document.getElementById('voiceIndicator').classList.add('visible');
                document.getElementById('narrationText').textContent = 
                    text.substring(0, 50) + (text.length > 50 ? '...' : '');
            };
            
            currentSpeech.onend = () => {
                document.getElementById('voiceIndicator').classList.remove('visible');
                currentSpeech = null;
                
                // Auto-advance if guided tour is active
                if (guidedTourActive) {
                    setTimeout(nextStep, 2000);
                }
            };
            
            speechSynthesis.speak(currentSpeech);
        }

        function stopSpeech() {
            if (currentSpeech) {
                speechSynthesis.cancel();
                currentSpeech = null;
                document.getElementById('voiceIndicator').classList.remove('visible');
            }
        }

        // Control Functions
        function toggleVoice() {
            voiceEnabled = !voiceEnabled;
            const btn = document.getElementById('voiceToggle');
            btn.textContent = voiceEnabled ? '🔊' : '🔇';
            btn.classList.toggle('active', voiceEnabled);
            
            if (!voiceEnabled) {
                stopSpeech();
            }
        }

        function toggleAutoPlay() {
            autoPlayEnabled = !autoPlayEnabled;
            if (autoPlayEnabled) {
                startGuidedTour();
            } else {
                guidedTourActive = false;
            }
        }

        function toggleInfo() {
            const panel = document.getElementById('infoPanel');
            panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
        }

        // Guided Tour
        function startGuidedTour() {
            guidedTourActive = true;
            const steps = ['neuron_structure', 'action_potential', 'synapse', 'neuromuscular'];
            let stepIndex = 0;
            
            function tourStep() {
                if (stepIndex < steps.length && guidedTourActive) {
                    loadJourneyStep(steps[stepIndex]);
                    stepIndex++;
                } else {
                    guidedTourActive = false;
                    if (voiceEnabled) {
                        speakText("You have completed your journey through neuron structure and function! You now understand how these remarkable cells enable rapid communication throughout the nervous system, from electrical impulses to chemical transmission and motor control.");
                    }
                }
            }
            
            tourStep();
            window.nextStep = tourStep;
        }

        // Quiz Function
        function showQuiz() {
            const questions = [
                "What are the main components of a neuron and their functions?",
                "How do action potentials propagate along axons?",
                "What happens at synapses during neural transmission?",
                "How does the neuromuscular junction control muscle contraction?",
                "Why are neurons so efficient at long-distance communication?"
            ];
            
            const randomQ = questions[Math.floor(Math.random() * questions.length)];
            
            if (voiceEnabled) {
                speakText(`Here's a question about neural function: ${randomQ} Think about what you've learned about how neurons transmit signals.`);
            }
        }

        // Initialize
        function init() {
            initVoiceSystem();
            
            // Hide loading screen
            setTimeout(() => {
                const loading = document.getElementById('loadingOverlay');
                loading.style.opacity = '0';
                setTimeout(() => {
                    loading.style.display = 'none';
                    
                    // Welcome message
                    if (voiceEnabled) {
                        speakText("Welcome to your exploration of neuron structure and function! We'll journey through the remarkable architecture of these communication cells, from their specialized structures to the electrical and chemical processes that enable rapid signal transmission throughout the nervous system.");
                    }
                }, 1000);
            }, 3000);
            
            // Keyboard shortcuts
            document.addEventListener('keydown', (e) => {
                switch(e.key) {
                    case 'v': toggleVoice(); break;
                    case 'i': toggleInfo(); break;
                    case 'g': startGuidedTour(); break;
                    case 'Escape': stopSpeech(); guidedTourActive = false; break;
                    case 'ArrowRight': nextStep && nextStep(); break;
                }
            });
        }

        // Start the application
        init();
    </script>
</body>
</html>