<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Food Chains, Food Webs and Energy Flow - Complete Energy Journey</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tween.js/18.6.4/tween.umd.js"></script>

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #8B4513 0%, #DAA520 50%, #228B22 100%);
            color: white;
            overflow: hidden;
            position: relative;
            height: 100vh;
        }

        /* Animated Background */
        .bg-animation {
            position: fixed;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: 0;
            opacity: 0.1;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 320"><path fill="%23ffffff" fill-opacity="0.2" d="M0,96L48,112C96,128,192,160,288,186.7C384,213,480,235,576,213.3C672,192,768,128,864,128C960,128,1056,192,1152,197.3C1248,203,1344,149,1392,122.7L1440,96L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z"></path></svg>') repeat-x;
            animation: energyWave 12s linear infinite;
        }

        @keyframes energyWave {
            0% { background-position-x: 0; }
            100% { background-position-x: 1440px; }
        }

        /* Museum Interface - Compact Header */
        .museum-header {
            position: absolute;
            top: 10px;
            left: 20px;
            text-align: left;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            padding: 10px 18px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .museum-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 4px;
            background: linear-gradient(45deg, #FF6B35, #F7931E, #FFD23F);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: energyGlow 3s ease-in-out infinite;
        }

        @keyframes energyGlow {
            0%, 100% { filter: brightness(1); }
            50% { filter: brightness(1.3); }
        }

        .exhibit-subtitle {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.8);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .energy-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            background: #FFD23F;
            border-radius: 50%;
            animation: energyPulse 1.5s ease-in-out infinite;
        }

        @keyframes energyPulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.4); opacity: 0.6; }
        }

        /* Journey Navigation - Enhanced */
        .journey-navigation {
            position: absolute;
            bottom: 20px;
            left: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            padding: 15px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            max-width: 320px;
        }

        .journey-title {
            font-size: 14px;
            font-weight: 600;
            color: #FFD23F;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .journey-steps {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }

        .journey-btn {
            background: rgba(255, 210, 63, 0.2);
            border: 1px solid rgba(255, 210, 63, 0.4);
            color: white;
            padding: 6px 10px;
            border-radius: 20px;
            font-size: 11px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 4px;
            white-space: nowrap;
        }

        .journey-btn:hover {
            background: rgba(255, 210, 63, 0.3);
            border-color: #FFD23F;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(255, 210, 63, 0.3);
        }

        .journey-btn.active {
            background: linear-gradient(135deg, #FF6B35, #F7931E);
            border-color: #FF6B35;
            box-shadow: 0 0 20px rgba(255, 107, 53, 0.5);
            animation: energyActive 2s infinite;
        }

        .journey-btn.completed {
            background: rgba(34, 139, 34, 0.3);
            border-color: #228B22;
        }

        @keyframes energyActive {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        /* 3D Model Container */
        .model-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 0;
            overflow: hidden;
            border: none;
            z-index: 100;
        }

        .sketchfab-embed-wrapper {
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #8B4513 0%, #DAA520 50%, #228B22 100%);
        }

        .sketchfab-embed-wrapper iframe {
            width: 100%;
            height: 100%;
            border: none;
            border-radius: 0;
        }

        /* Information Panel - Enhanced */
        .info-panel {
            position: absolute;
            top: 70px;
            right: 20px;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(25px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 16px;
            padding: 24px;
            width: 380px;
            max-height: calc(100vh - 140px);
            z-index: 800;
            overflow-y: auto;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }

        .info-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        }

        .info-icon {
            font-size: 28px;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        .info-title {
            flex: 1;
        }

        .info-title h2 {
            font-size: 18px;
            color: #FFD23F;
            margin-bottom: 4px;
        }

        .info-subtitle {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.7);
        }

        .info-content {
            color: rgba(255, 255, 255, 0.9);
            font-size: 14px;
            line-height: 1.6;
        }

        /* Progress Tracker */
        .progress-tracker {
            background: linear-gradient(135deg, rgba(255, 210, 63, 0.1), rgba(247, 147, 30, 0.1));
            border: 1px solid rgba(255, 210, 63, 0.3);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 20px;
        }

        .progress-header {
            font-size: 13px;
            font-weight: 600;
            color: #FFD23F;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .progress-percentage {
            font-size: 18px;
            color: #FF6B35;
            font-weight: 700;
        }

        .progress-bar {
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 12px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #FF6B35, #FFD23F);
            border-radius: 4px;
            transition: width 0.8s ease;
            box-shadow: 0 0 10px rgba(255, 210, 63, 0.5);
        }

        .progress-steps-mini {
            display: flex;
            justify-content: space-between;
            font-size: 10px;
            color: rgba(255, 255, 255, 0.6);
        }

        .step-mini {
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .step-mini.active {
            color: #FFD23F;
            font-weight: 600;
        }

        .step-mini.completed {
            color: #228B22;
        }

        /* Information Cards */
        .info-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 14px;
            margin-bottom: 14px;
        }

        .info-card-title {
            color: #FFD23F;
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .info-card-content {
            color: rgba(255, 255, 255, 0.85);
            font-size: 12px;
            line-height: 1.5;
        }

        .info-list {
            list-style: none;
            padding: 0;
        }

        .info-list li {
            padding: 6px 0;
            padding-left: 20px;
            position: relative;
            font-size: 12px;
            color: rgba(255, 255, 255, 0.8);
        }

        .info-list li:before {
            content: "‚Üí";
            position: absolute;
            left: 0;
            color: #FFD23F;
        }

        /* Fun Fact Box */
        .fun-fact {
            background: linear-gradient(135deg, rgba(255, 107, 53, 0.1), rgba(255, 210, 63, 0.1));
            border: 1px solid rgba(255, 107, 53, 0.3);
            border-radius: 12px;
            padding: 14px;
            margin: 16px 0;
            position: relative;
            overflow: hidden;
        }

        .fun-fact:before {
            content: "‚ö°";
            position: absolute;
            top: -20px;
            right: -20px;
            font-size: 60px;
            opacity: 0.1;
        }

        .fun-fact-title {
            color: #FF6B35;
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 6px;
        }

        .fun-fact-text {
            color: rgba(255, 255, 255, 0.9);
            font-size: 12px;
            line-height: 1.5;
            position: relative;
            z-index: 1;
        }

        /* Voice Controls */
        .voice-controls {
            position: absolute;
            top: 10px;
            right: 20px;
            display: flex;
            gap: 8px;
            z-index: 1000;
        }

        .control-btn {
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            width: 44px;
            height: 44px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            position: relative;
        }

        .control-btn:hover {
            background: rgba(255, 107, 53, 0.3);
            border-color: #FF6B35;
            transform: scale(1.1);
        }

        .control-btn.active {
            background: rgba(255, 107, 53, 0.4);
            border-color: #FF6B35;
            box-shadow: 0 0 20px rgba(255, 107, 53, 0.5);
        }

        .control-tooltip {
            position: absolute;
            bottom: -30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9);
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 10px;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .control-btn:hover .control-tooltip {
            opacity: 1;
        }

        /* Loading Screen */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #8B4513 0%, #DAA520 50%, #228B22 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            transition: opacity 1s ease;
        }

        .loading-content {
            text-align: center;
        }

        .loading-energy {
            font-size: 60px;
            animation: energyPulse 1.5s ease-in-out infinite;
            margin-bottom: 20px;
        }

        .loading-text {
            color: white;
            font-size: 20px;
            margin-bottom: 20px;
        }

        .loading-progress {
            width: 200px;
            height: 4px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 2px;
            overflow: hidden;
        }

        .loading-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #FF6B35, #FFD23F);
            animation: loading 2s ease-in-out infinite;
        }

        @keyframes loading {
            0% { width: 0%; }
            50% { width: 100%; }
            100% { width: 0%; }
        }

        /* Voice Indicator */
        .voice-indicator {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 107, 53, 0.5);
            border-radius: 30px;
            padding: 14px 28px;
            display: flex;
            align-items: center;
            gap: 12px;
            z-index: 1000;
            opacity: 0;
            transition: all 0.3s ease;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }

        .voice-indicator.visible {
            opacity: 1;
            transform: translateX(-50%) translateY(-10px);
        }

        .voice-waves {
            display: flex;
            align-items: center;
            gap: 3px;
        }

        .voice-wave {
            width: 3px;
            height: 20px;
            background: linear-gradient(180deg, #FF6B35, #FFD23F);
            border-radius: 2px;
            animation: voice-wave 1s ease-in-out infinite;
        }

        .voice-wave:nth-child(2) { animation-delay: 0.1s; }
        .voice-wave:nth-child(3) { animation-delay: 0.2s; }
        .voice-wave:nth-child(4) { animation-delay: 0.3s; }
        .voice-wave:nth-child(5) { animation-delay: 0.4s; }

        @keyframes voice-wave {
            0%, 100% { transform: scaleY(0.3); }
            50% { transform: scaleY(1); }
        }

        .narration-text {
            color: white;
            font-size: 13px;
            max-width: 300px;
        }

        /* Quick Actions */
        .quick-actions {
            position: absolute;
            bottom: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            z-index: 1000;
        }

        .action-btn {
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 10px 16px;
            border-radius: 25px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
        }

        .action-btn:hover {
            background: rgba(255, 107, 53, 0.3);
            border-color: #FF6B35;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(255, 107, 53, 0.3);
        }

        /* Custom Scrollbar */
        .info-panel::-webkit-scrollbar {
            width: 6px;
        }

        .info-panel::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 3px;
        }

        .info-panel::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, #FF6B35, #FFD23F);
            border-radius: 3px;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .info-panel {
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                top: auto;
                width: 100%;
                max-height: 50vh;
                border-radius: 20px 20px 0 0;
            }
            
            .journey-navigation {
                bottom: 52vh;
                max-width: calc(100% - 40px);
            }
            
            .voice-controls {
                top: auto;
                bottom: 55vh;
                right: 10px;
            }
            
            .quick-actions {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="bg-animation"></div>

    <!-- Loading Screen -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-content">
            <div class="loading-energy">‚ö°</div>
            <div class="loading-text">Preparing Your Energy Flow Journey...</div>
            <div class="loading-progress">
                <div class="loading-progress-bar"></div>
            </div>
        </div>
    </div>

    <!-- Museum Header -->
    <div class="museum-header">
        <div class="museum-title">Food Chains, Food Webs and Energy Flow</div>
        <div class="exhibit-subtitle">
            <span class="energy-indicator"></span>
            Tracing Nature's Energy Pathways
        </div>
    </div>

    <!-- Journey Navigation -->
    <div class="journey-navigation">
        <div class="journey-title">
            <span>üîã</span>
            <span>Energy Flow Explorer</span>
        </div>
        <div class="journey-steps">
            <button class="journey-btn active" onclick="loadJourneyStep('producers')">
                <span>üå±</span> Producers
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('primary')">
                <span>üê∞</span> Primary
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('secondary')">
                <span>üêç</span> Secondary
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('decomposers')">
                <span>ü¶†</span> Decomposers
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('trophic')">
                <span>üìä</span> Trophic
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('foodwebs')">
                <span>üï∏Ô∏è</span> Food Webs
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('energy')">
                <span>‚ö°</span> Energy Rule
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('magnification')">
                <span>‚ò†Ô∏è</span> Magnification
            </button>
        </div>
    </div>

    <!-- 3D Model Container -->
    <div class="model-container">
        <div class="sketchfab-embed-wrapper">
            <iframe id="api-frame"
                    title="Food Chain Model" 
                    frameborder="0" 
                    allowfullscreen 
                    mozallowfullscreen="true" 
                    webkitallowfullscreen="true" 
                    allow="autoplay; fullscreen; xr-spatial-tracking"
                    xr-spatial-tracking 
                    execution-while-out-of-viewport 
                    execution-while-not-rendered 
                    web-share 
                    src="https://sketchfab.com/models/eb4f6dc9d4e3455ea3435385faf58b60/embed?autostart=1&internal=1&tracking=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0">
            </iframe>
        </div>
    </div>

    <!-- Information Panel -->
    <div class="info-panel" id="infoPanel">
        <div class="info-header">
            <div class="info-icon" id="stepIcon">üå±</div>
            <div class="info-title">
                <h2 id="stepTitle">Producers - The Energy Capturers</h2>
                <div class="info-subtitle" id="stepSubtitle">First trophic level and foundation of all food chains</div>
            </div>
        </div>

        <!-- Progress Tracker -->
        <div class="progress-tracker">
            <div class="progress-header">
                <span>Energy Journey Progress</span>
                <span class="progress-percentage" id="progressPercent">0%</span>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 0%"></div>
            </div>
            <div class="progress-steps-mini">
                <span class="step-mini active" onclick="loadJourneyStep('producers')">Prod</span>
                <span class="step-mini" onclick="loadJourneyStep('primary')">1¬∞</span>
                <span class="step-mini" onclick="loadJourneyStep('secondary')">2¬∞</span>
                <span class="step-mini" onclick="loadJourneyStep('decomposers')">Dec</span>
                <span class="step-mini" onclick="loadJourneyStep('trophic')">Trop</span>
                <span class="step-mini" onclick="loadJourneyStep('foodwebs')">Web</span>
                <span class="step-mini" onclick="loadJourneyStep('energy')">10%</span>
                <span class="step-mini" onclick="loadJourneyStep('magnification')">Mag</span>
            </div>
        </div>

        <div class="info-content" id="mainDescription">
            Producers are the foundation of all food chains and the entry point for energy into ecosystems. These grass chunks represent the primary producers that capture solar energy through photosynthesis and convert it into chemical energy stored in organic compounds. Without producers, no other life would be possible on Earth.
        </div>

        <div class="info-card">
            <div class="info-card-title">
                <span>üî¨</span> Key Concepts
            </div>
            <div class="info-card-content">
                <ul class="info-list" id="keyConcepts">
                    <li>Convert solar energy into chemical energy</li>
                    <li>Form the first trophic level</li>
                    <li>Support all other organisms directly or indirectly</li>
                    <li>Create organic compounds from simple molecules</li>
                </ul>
            </div>
        </div>

        <div class="fun-fact">
            <div class="fun-fact-title">Energy Fact!</div>
            <div class="fun-fact-text" id="funFact">
                Plants capture only about 1% of the solar energy that hits Earth, but this tiny fraction powers nearly all life on our planet!
            </div>
        </div>

        <div class="info-card">
            <div class="info-card-title">
                <span>üéØ</span> Learning Objectives
            </div>
            <div class="info-card-content" id="learningObjectives">
                Understand how producers capture and store energy, forming the foundation that supports all other trophic levels in food chains.
            </div>
        </div>
    </div>

    <!-- Voice Controls -->
    <div class="voice-controls">
        <button class="control-btn active" id="voiceToggle" onclick="toggleVoice()">
            üîä
            <span class="control-tooltip">Voice Narration</span>
        </button>
        <button class="control-btn" onclick="toggleAutoPlay()">
            ‚ñ∂Ô∏è
            <span class="control-tooltip">Auto Journey</span>
        </button>
        <button class="control-btn" onclick="toggleInfo()">
            ‚ÑπÔ∏è
            <span class="control-tooltip">Toggle Info</span>
        </button>
    </div>

    <!-- Quick Actions -->
    <div class="quick-actions">
        <button class="action-btn" onclick="startGuidedTour()">
            <span>üöÄ</span> Guided Tour
        </button>
        <button class="action-btn" onclick="showQuiz()">
            <span>üéØ</span> Test Knowledge
        </button>
    </div>

    <!-- Voice Indicator -->
    <div class="voice-indicator" id="voiceIndicator">
        <div class="voice-waves">
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
        </div>
        <div class="narration-text" id="narrationText">Narrating...</div>
    </div>

    <script>
        // Journey Step Data with Complete Food Chain Content
        const JOURNEY_DATA = {
            producers: {
                title: "Producers - The Energy Capturers",
                subtitle: "First trophic level and foundation of all food chains",
                icon: "üå±",
                modelUrl: "https://sketchfab.com/models/eb4f6dc9d4e3455ea3435385faf58b60/embed?autostart=1&internal=1&tracking=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "Producers are the foundation of all food chains and the entry point for energy into ecosystems. These grass chunks represent the primary producers that capture solar energy through photosynthesis and convert it into chemical energy stored in organic compounds. Without producers, no other life would be possible on Earth.",
                concepts: [
                    "Convert solar energy into chemical energy",
                    "Form the first trophic level",
                    "Support all other organisms directly or indirectly",
                    "Create organic compounds from simple molecules"
                ],
                funFact: "Plants capture only about 1% of the solar energy that hits Earth, but this tiny fraction powers nearly all life on our planet!",
                objectives: "Understand how producers capture and store energy, forming the foundation that supports all other trophic levels in food chains.",
                narration: "Welcome to the start of every food chain - the producers! You're looking at grass, one of the most important primary producers on Earth. These green blades are nature's solar panels, capturing sunlight and converting it into chemical energy through photosynthesis. Every molecule of glucose these plants create represents captured solar energy that will fuel the entire food chain above them. In the process of photosynthesis, these grass plants take in carbon dioxide from the air and water from the soil, using chlorophyll to harness sunlight's energy. The result? Glucose for energy storage and oxygen as a life-giving byproduct. These producers form the first trophic level - they literally produce food from nothing but sunlight, water, and carbon dioxide. Everything else in the ecosystem depends on this green foundation!"
            },
            primary: {
                title: "Primary Consumers - The Herbivores",
                subtitle: "Second trophic level, feeding directly on producers",
                icon: "üê∞",
                modelUrl: "https://sketchfab.com/models/5185aef0a1dd4f9f85a8a5679fe64039/embed?autostart=1&internal=1&tracking=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "Primary consumers are herbivores that feed directly on producers, forming the second trophic level. This rabbit represents millions of herbivorous species that have evolved specialized digestive systems to extract energy from plant matter. They are the vital link that transfers energy from plants to higher trophic levels.",
                concepts: [
                    "Feed directly on producers (plants)",
                    "Form the second trophic level",
                    "Have specialized digestive systems",
                    "Convert plant energy into animal biomass"
                ],
                funFact: "A single rabbit can eat up to 2 pounds of vegetation per day - that's like a human eating 40 pounds of salad daily!",
                objectives: "Learn how primary consumers transfer energy from producers to higher trophic levels and their adaptations for herbivory.",
                narration: "Meet the primary consumers - the herbivores that form the crucial second link in food chains! This rabbit is perfectly adapted for its role as a primary consumer. Look at those large front teeth, called incisors, designed for cutting through tough plant fibers. Its powerful jaw muscles and flat back teeth, called molars, grind plant material into digestible pieces. But the real magic happens in the rabbit's specialized digestive system. Like many herbivores, rabbits have a large cecum where beneficial bacteria help break down cellulose - a complex carbohydrate that humans can't digest. These primary consumers face a unique challenge: plant matter is much harder to digest than meat, and provides less concentrated energy. That's why this rabbit must spend most of its day eating, constantly converting plant energy into animal biomass that can support carnivores higher up the food chain."
            },
            secondary: {
                title: "Secondary Consumers - The Carnivores",
                subtitle: "Third trophic level, feeding on primary consumers",
                icon: "üêç",
                modelUrl: "https://sketchfab.com/models/88d57c4b19fc480f9787c18f2f3731a3/embed?autostart=1&internal=1&tracking=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "Secondary consumers are carnivores that feed on primary consumers, occupying the third trophic level. This snake demonstrates the predator adaptations necessary to capture and consume other animals. Secondary consumers play crucial roles in controlling herbivore populations and maintaining ecosystem balance.",
                concepts: [
                    "Feed on primary consumers (herbivores)",
                    "Form the third trophic level",
                    "Have hunting and predatory adaptations",
                    "Help control herbivore populations"
                ],
                funFact: "A snake can unhinge its jaw and swallow prey up to 3 times wider than its own head - imagine eating a pizza larger than your entire body!",
                objectives: "Understand the role of secondary consumers in energy transfer and population control within ecosystems.",
                narration: "Enter the secondary consumers - the predators that occupy the third trophic level! This snake is a perfect example of how evolution has crafted efficient carnivores. Unlike the rabbit's grinding teeth, this snake has sharp, backward-curved fangs designed to inject venom and prevent prey from escaping. Snakes have remarkable adaptations: heat-sensing organs that detect warm-blooded prey, incredibly flexible jaws that can unhinge to swallow large animals, and powerful digestive acids that can break down bones. As a secondary consumer, this snake feeds on primary consumers like our rabbit. This represents another energy transfer up the food chain, but notice something important - there are far fewer snakes than rabbits in any ecosystem. That's because energy is lost at each transfer, so each trophic level can support fewer individuals than the level below it. Secondary consumers like this snake play a vital role in controlling herbivore populations, preventing overgrazing that could destroy plant communities."
            },
            decomposers: {
                title: "Decomposers - The Recyclers",
                subtitle: "Breaking down organic matter and cycling nutrients",
                icon: "ü¶†",
                modelUrl: "https://sketchfab.com/models/16c5cf584be54892a6705825e3fb1c67/embed?autostart=1&internal=1&tracking=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "Decomposers like these rod-shaped bacteria are the unsung heroes of every ecosystem. They break down dead organic matter from all trophic levels, recycling nutrients back into the environment where producers can use them again. Without decomposers, ecosystems would collapse under piles of dead material.",
                concepts: [
                    "Break down dead organic matter",
                    "Recycle nutrients back to environment",
                    "Include bacteria, fungi, and detritivores",
                    "Essential for ecosystem sustainability"
                ],
                funFact: "Bacteria are so efficient at decomposition that they can break down a fallen tree in just a few years, recycling tons of organic matter back into the soil!",
                objectives: "Appreciate the crucial role of decomposers in nutrient cycling and ecosystem sustainability.",
                narration: "Meet the decomposers - the essential recyclers that complete the circle of life! These rod-shaped bacteria might look simple, but they perform one of the most important functions in any ecosystem. When our grass dies, when the rabbit reaches the end of its life, when the snake eventually perishes - these bacteria and their countless microbial relatives get to work. They secrete powerful enzymes that break down complex organic molecules into simpler compounds. Proteins are broken down into amino acids, carbohydrates into simple sugars, and fats into fatty acids. These simpler molecules are then released back into the soil and water, where they become nutrients that plants can absorb and use to grow. Without decomposers, dead organic matter would just pile up, and essential nutrients like nitrogen, phosphorus, and carbon would become locked away, unavailable to living organisms. Decomposers ensure that the atoms and molecules that make up living things are constantly recycled, making new life possible. They're nature's ultimate recycling system!"
            },
            trophic: {
                title: "Trophic Levels - The Energy Pyramid",
                subtitle: "Understanding the hierarchy of feeding relationships",
                icon: "üìä",
                modelUrl: "https://sketchfab.com/models/eb4f6dc9d4e3455ea3435385faf58b60/embed?autostart=1&internal=1&tracking=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "Trophic levels organize organisms by their feeding relationships and energy sources. From the grass at the producer level through multiple consumer levels, each step represents a transfer of energy up the ecological pyramid. Understanding trophic levels helps us predict energy flow and population dynamics.",
                concepts: [
                    "Organize organisms by feeding relationships",
                    "Form pyramid structure with energy flow",
                    "Include producers, primary, secondary, tertiary consumers",
                    "Determine ecosystem structure and function"
                ],
                funFact: "An energy pyramid shows that it takes about 1,000 pounds of grass to support 100 pounds of rabbits, which in turn support only 10 pounds of snakes!",
                objectives: "Learn to identify trophic levels and understand how they determine ecosystem structure and energy flow.",
                narration: "Now let's understand trophic levels - the feeding hierarchy that structures all ecosystems! Looking at this grass, imagine it as the foundation of an energy pyramid. This represents the first trophic level - the producers. Above them would be the primary consumers like rabbits - the second trophic level. Then come secondary consumers like snakes - the third trophic level. Some ecosystems even have tertiary consumers - the fourth level with top predators like eagles or wolves. Each level has a specific role and gets its energy from the level below. The fascinating thing about trophic levels is their pyramid structure. There's always much more biomass at the bottom than at the top. Why? Because energy is lost as heat with every transfer. It takes many plants to support a few herbivores, and many herbivores to support even fewer carnivores. This pyramid structure explains why there are millions of grass plants, thousands of rabbits, hundreds of snakes, but only a few top predators in any given area. Understanding trophic levels helps ecologists predict what happens when species are added or removed from ecosystems."
            },
            foodwebs: {
                title: "Food Webs - Complex Feeding Networks",
                subtitle: "Real ecosystems have interconnected feeding relationships",
                icon: "üï∏Ô∏è",
                modelUrl: "https://sketchfab.com/models/5185aef0a1dd4f9f85a8a5679fe64039/embed?autostart=1&internal=1&tracking=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "Real ecosystems don't have simple linear food chains - they have complex food webs with multiple interconnected feeding relationships. This rabbit doesn't just eat one type of plant, and it's not eaten by just one type of predator. Food webs show the true complexity of energy flow in nature.",
                concepts: [
                    "Multiple interconnected food chains",
                    "Organisms often eat many different species",
                    "Provide ecosystem stability through redundancy",
                    "Show realistic feeding relationships"
                ],
                funFact: "A single rabbit might eat 20 different plant species and be hunted by 10 different predators - that's 30 connections in the food web from just one species!",
                objectives: "Understand how food webs create stability and complexity in real ecosystems compared to simple food chains.",
                narration: "Real ecosystems don't have simple food chains - they have complex food webs! This rabbit illustrates this beautifully. In nature, this rabbit doesn't eat just one type of grass. It might munch on dozens of different plants - grasses, herbs, bark, leaves, even fruits and seeds. And it's not hunted by just one predator. Snakes, foxes, hawks, owls, weasels, and many other carnivores might all consider this rabbit a potential meal. Each of these predators also has multiple prey species, and many of the plants this rabbit eats are also consumed by deer, insects, and other herbivores. When you map out all these feeding relationships, you get a complex web rather than a simple chain. This complexity is actually what makes ecosystems stable! If one species disappears, there are often alternative food sources or prey species that can fill the gap. Food webs show us that nature rarely puts all its eggs in one basket. The interconnectedness provides resilience - if one strand of the web breaks, the whole structure doesn't collapse because there are multiple pathways for energy to flow through the ecosystem."
            },
            energy: {
                title: "Energy Flow and the 10% Rule",
                subtitle: "Understanding energy transfer efficiency",
                icon: "‚ö°",
                modelUrl: "https://sketchfab.com/models/88d57c4b19fc480f9787c18f2f3731a3/embed?autostart=1&internal=1&tracking=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "Energy flow through ecosystems follows the 10% rule - only about 10% of energy is transferred from one trophic level to the next. This snake represents the dramatic energy loss that occurs with each step up the food chain, explaining why food chains rarely exceed 4-5 levels.",
                concepts: [
                    "Only ~10% of energy transfers between levels",
                    "90% of energy lost as heat and metabolism",
                    "Limits length of food chains",
                    "Explains pyramid structure of ecosystems"
                ],
                funFact: "If a plant captures 1000 units of solar energy, a rabbit gets only 100 units, and a snake gets just 10 units - that's why top predators are so rare!",
                objectives: "Understand why energy transfer is inefficient and how this limits ecosystem structure.",
                narration: "Let's explore one of ecology's most important principles - the 10% rule of energy transfer! This snake perfectly illustrates why energy flow is so inefficient in ecosystems. When the rabbit ate grass, it didn't get 100% of the energy stored in those plants. Much of the plant material passed through the rabbit undigested, some energy was lost as heat during digestion, and a lot was used for the rabbit's daily activities - hopping, breathing, maintaining body temperature. Only about 10% of the energy from the grass actually became rabbit biomass. Now, when this snake eats the rabbit, the same thing happens again! The snake uses energy to hunt, digest, move, and maintain its body functions. Again, only about 10% of the rabbit's energy becomes snake biomass. This dramatic energy loss at each step is why food chains are short - usually only 4 or 5 levels long. It's also why there are so many more producers than top predators. Imagine if this pattern continued: if the grass had 10,000 energy units, the rabbit would have 1,000, the snake would have 100, and an eagle that ate the snake would have only 10! This inefficiency might seem wasteful, but it's actually fundamental to how ecosystems work."
            },
            magnification: {
                title: "Biological Magnification - Activity 13.3",
                subtitle: "How toxins concentrate up food chains",
                icon: "‚ò†Ô∏è",
                modelUrl: "https://sketchfab.com/models/16c5cf584be54892a6705825e3fb1c67/embed?autostart=1&internal=1&tracking=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "Biological magnification occurs when toxic substances like pesticides become concentrated as they move up food chains. Even small amounts of pesticides in the environment can reach dangerous levels in top predators. This process demonstrates the interconnectedness of ecosystems and the far-reaching effects of pollution.",
                concepts: [
                    "Toxins concentrate up food chains",
                    "Persistent chemicals accumulate in fat",
                    "Top predators suffer most from pollution",
                    "Small environmental contamination has large effects"
                ],
                funFact: "DDT concentrations in bald eagles reached 25 million times higher than in the water they drank, nearly driving the species extinct!",
                objectives: "Understand how biological magnification affects ecosystems and why top predators are vulnerable to pollution.",
                narration: "Now let's examine one of the most sobering consequences of food chains - biological magnification. These bacteria represent where it all begins. When pesticides are sprayed on crops, some chemicals persist in the environment instead of breaking down. Bacteria and other decomposers in the soil absorb these chemicals, but can't eliminate them completely. When plants grow in contaminated soil, they absorb these persistent chemicals. A rabbit eating contaminated plants accumulates all the pesticides from the many plants it consumes. Since the rabbit can't break down these chemicals, they build up in its fatty tissues. Now comes the frightening part: when a snake eats that rabbit, it gets all the accumulated pesticides from the rabbit's entire lifetime of eating contaminated plants. If the snake eats many rabbits over its lifetime, the concentration builds up even more. At each step up the food chain, the concentration of toxins increases dramatically. Top predators like eagles can have pesticide concentrations millions of times higher than the original environmental levels! This process nearly drove bald eagles extinct in the 1960s and 70s when DDT caused their eggshells to become so thin they broke before hatching. Biological magnification shows us that even 'small' amounts of pollution can have devastating effects on ecosystems, especially affecting the top predators that we often care most about protecting."
            }
        };

        // Global Variables
        let currentStep = 'producers';
        let voiceEnabled = true;
        let autoPlayEnabled = false;
        let currentSpeech = null;
        let selectedVoice = null;
        let journeyProgress = 0;
        let guidedTourActive = false;

        // Initialize Voice System
        function initVoiceSystem() {
            if (!('speechSynthesis' in window)) {
                console.warn('Speech synthesis not supported');
                voiceEnabled = false;
                document.getElementById('voiceToggle').style.display = 'none';
                return;
            }

            function loadVoices() {
                const voices = speechSynthesis.getVoices();
                if (voices.length === 0) return;

                // Prefer natural-sounding voices
                const preferredVoices = [
                    'Google UK English Female',
                    'Microsoft Sonia',
                    'Microsoft Hazel',
                    'Samantha',
                    'Victoria'
                ];

                for (const name of preferredVoices) {
                    selectedVoice = voices.find(v => v.name.includes(name));
                    if (selectedVoice) break;
                }

                if (!selectedVoice) {
                    selectedVoice = voices.find(v => v.lang.startsWith('en'));
                }
            }

            loadVoices();
            if (speechSynthesis.onvoiceschanged !== undefined) {
                speechSynthesis.onvoiceschanged = loadVoices;
            }
        }

        // Load Journey Step
        function loadJourneyStep(stepId) {
            const stepData = JOURNEY_DATA[stepId];
            if (!stepData) return;

            currentStep = stepId;
            
            // Update model
            document.getElementById('api-frame').src = stepData.modelUrl;
            
            // Update info panel
            document.getElementById('stepIcon').textContent = stepData.icon;
            document.getElementById('stepTitle').textContent = stepData.title;
            document.getElementById('stepSubtitle').textContent = stepData.subtitle;
            document.getElementById('mainDescription').textContent = stepData.description;
            
            // Update key concepts
            const conceptsList = document.getElementById('keyConcepts');
            conceptsList.innerHTML = stepData.concepts.map(c => `<li>${c}</li>`).join('');
            
            // Update fun fact
            document.getElementById('funFact').textContent = stepData.funFact;
            
            // Update learning objectives
            document.getElementById('learningObjectives').textContent = stepData.objectives;
            
            // Update navigation buttons
            updateNavigationButtons(stepId);
            
            // Update progress
            updateProgress();
            
            // Play narration if enabled
            if (voiceEnabled) {
                speakText(stepData.narration);
            }
        }

        // Update Navigation Buttons
        function updateNavigationButtons(activeStep) {
            const buttons = document.querySelectorAll('.journey-btn');
            const steps = ['producers', 'primary', 'secondary', 'decomposers', 'trophic', 'foodwebs', 'energy', 'magnification'];
            const activeIndex = steps.indexOf(activeStep);
            
            buttons.forEach((btn, index) => {
                btn.classList.remove('active', 'completed');
                if (index < activeIndex) {
                    btn.classList.add('completed');
                } else if (index === activeIndex) {
                    btn.classList.add('active');
                }
            });
            
            // Update mini steps
            const miniSteps = document.querySelectorAll('.step-mini');
            miniSteps.forEach((step, index) => {
                step.classList.remove('active', 'completed');
                if (index < activeIndex) {
                    step.classList.add('completed');
                } else if (index === activeIndex) {
                    step.classList.add('active');
                }
            });
        }

        // Update Progress
        function updateProgress() {
            const steps = ['producers', 'primary', 'secondary', 'decomposers', 'trophic', 'foodwebs', 'energy', 'magnification'];
            const currentIndex = steps.indexOf(currentStep);
            const progress = ((currentIndex + 1) / steps.length) * 100;
            
            document.getElementById('progressPercent').textContent = Math.round(progress) + '%';
            document.getElementById('progressFill').style.width = progress + '%';
        }

        // Speech Functions
        function speakText(text) {
            if (!voiceEnabled || !text) return;
            
            stopSpeech();
            
            currentSpeech = new SpeechSynthesisUtterance(text);
            if (selectedVoice) {
                currentSpeech.voice = selectedVoice;
            }
            currentSpeech.rate = 0.9;
            currentSpeech.pitch = 1.0;
            currentSpeech.volume = 0.9;
            
            currentSpeech.onstart = () => {
                document.getElementById('voiceIndicator').classList.add('visible');
                document.getElementById('narrationText').textContent = 
                    text.substring(0, 50) + (text.length > 50 ? '...' : '');
            };
            
            currentSpeech.onend = () => {
                document.getElementById('voiceIndicator').classList.remove('visible');
                currentSpeech = null;
                
                // Auto-advance if guided tour is active
                if (guidedTourActive) {
                    setTimeout(nextStep, 2000);
                }
            };
            
            speechSynthesis.speak(currentSpeech);
        }

        function stopSpeech() {
            if (currentSpeech) {
                speechSynthesis.cancel();
                currentSpeech = null;
                document.getElementById('voiceIndicator').classList.remove('visible');
            }
        }

        // Control Functions
        function toggleVoice() {
            voiceEnabled = !voiceEnabled;
            const btn = document.getElementById('voiceToggle');
            btn.textContent = voiceEnabled ? 'üîä' : 'üîá';
            btn.classList.toggle('active', voiceEnabled);
            
            if (!voiceEnabled) {
                stopSpeech();
            }
        }

        function toggleAutoPlay() {
            autoPlayEnabled = !autoPlayEnabled;
            if (autoPlayEnabled) {
                startGuidedTour();
            } else {
                guidedTourActive = false;
            }
        }

        function toggleInfo() {
            const panel = document.getElementById('infoPanel');
            panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
        }

        // Guided Tour
        function startGuidedTour() {
            guidedTourActive = true;
            const steps = ['producers', 'primary', 'secondary', 'decomposers', 'trophic', 'foodwebs', 'energy', 'magnification'];
            let stepIndex = 0;
            
            function tourStep() {
                if (stepIndex < steps.length && guidedTourActive) {
                    loadJourneyStep(steps[stepIndex]);
                    stepIndex++;
                } else {
                    guidedTourActive = false;
                    if (voiceEnabled) {
                        speakText("You've completed your journey through food chains, food webs, and energy flow! You now understand how energy moves through ecosystems and the important consequences of biological magnification.");
                    }
                }
            }
            
            tourStep();
            window.nextStep = tourStep;
        }

        // Quiz Function
        function showQuiz() {
            const questions = [
                "Why do food chains rarely exceed 4-5 trophic levels?",
                "How does the 10% rule explain ecosystem structure?",
                "What is biological magnification and why is it dangerous?",
                "How do food webs differ from simple food chains?",
                "Why are there always more producers than top predators?"
            ];
            
            const randomQ = questions[Math.floor(Math.random() * questions.length)];
            
            if (voiceEnabled) {
                speakText(`Here's a question about energy flow: ${randomQ} Think about the energy transfers and trophic relationships you've learned about!`);
            }
        }

        // Initialize
        function init() {
            initVoiceSystem();
            
            // Hide loading screen
            setTimeout(() => {
                const loading = document.getElementById('loadingOverlay');
                loading.style.opacity = '0';
                setTimeout(() => {
                    loading.style.display = 'none';
                    
                    // Welcome message
                    if (voiceEnabled) {
                        speakText("Welcome to your energy flow journey! We'll trace how energy moves through food chains and webs, from producers to top predators. Let's start with the foundation - the energy-capturing producers!");
                    }
                }, 1000);
            }, 3000);
            
            // Keyboard shortcuts
            document.addEventListener('keydown', (e) => {
                switch(e.key) {
                    case 'v': toggleVoice(); break;
                    case 'i': toggleInfo(); break;
                    case 'g': startGuidedTour(); break;
                    case 'Escape': stopSpeech(); guidedTourActive = false; break;
                    case 'ArrowRight': nextStep && nextStep(); break;
                }
            });
        }

        // Start the application
        init();
    </script>
</body>
</html>