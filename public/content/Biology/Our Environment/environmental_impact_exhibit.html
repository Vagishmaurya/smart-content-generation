<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Human Environmental Impact - Complete Atmospheric Journey</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tween.js/18.6.4/tween.umd.js"></script>

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 50%, #87ceeb 100%);
            color: white;
            overflow: hidden;
            position: relative;
            height: 100vh;
        }

        /* Animated Background */
        .bg-animation {
            position: fixed;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: 0;
            opacity: 0.1;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 320"><path fill="%23ffffff" fill-opacity="0.2" d="M0,96L48,112C96,128,192,160,288,186.7C384,213,480,235,576,213.3C672,192,768,128,864,128C960,128,1056,192,1152,197.3C1248,203,1344,149,1392,122.7L1440,96L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z"></path></svg>') repeat-x;
            animation: atmosphericWave 15s linear infinite;
        }

        @keyframes atmosphericWave {
            0% { background-position-x: 0; }
            100% { background-position-x: 1440px; }
        }

        /* Museum Interface - Compact Header */
        .museum-header {
            position: absolute;
            top: 10px;
            left: 20px;
            text-align: left;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            padding: 10px 18px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .museum-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 4px;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4, #45b7d1);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: enviroGlow 3s ease-in-out infinite;
        }

        @keyframes enviroGlow {
            0%, 100% { filter: brightness(1); }
            50% { filter: brightness(1.3); }
        }

        .exhibit-subtitle {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.8);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .ozone-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            background: #4ecdc4;
            border-radius: 50%;
            animation: ozoneProtection 2s ease-in-out infinite;
        }

        @keyframes ozoneProtection {
            0%, 100% { transform: scale(1); opacity: 1; box-shadow: 0 0 5px #4ecdc4; }
            50% { transform: scale(1.2); opacity: 0.8; box-shadow: 0 0 15px #4ecdc4; }
        }

        /* Journey Navigation - Enhanced */
        .journey-navigation {
            position: absolute;
            bottom: 20px;
            left: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            padding: 15px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            max-width: 320px;
        }

        .journey-title {
            font-size: 14px;
            font-weight: 600;
            color: #4ecdc4;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .journey-steps {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }

        .journey-btn {
            background: rgba(78, 205, 196, 0.2);
            border: 1px solid rgba(78, 205, 196, 0.4);
            color: white;
            padding: 6px 10px;
            border-radius: 20px;
            font-size: 11px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 4px;
            white-space: nowrap;
        }

        .journey-btn:hover {
            background: rgba(78, 205, 196, 0.3);
            border-color: #4ecdc4;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(78, 205, 196, 0.3);
        }

        .journey-btn.active {
            background: linear-gradient(135deg, #ff6b6b, #4ecdc4);
            border-color: #4ecdc4;
            box-shadow: 0 0 20px rgba(78, 205, 196, 0.5);
            animation: enviroActive 2s infinite;
        }

        .journey-btn.completed {
            background: rgba(69, 183, 209, 0.3);
            border-color: #45b7d1;
        }

        @keyframes enviroActive {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        /* 3D Model Container */
        .model-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 0;
            overflow: hidden;
            border: none;
            z-index: 100;
        }

        .sketchfab-embed-wrapper {
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 50%, #87ceeb 100%);
        }

        .sketchfab-embed-wrapper iframe {
            width: 100%;
            height: 100%;
            border: none;
            border-radius: 0;
        }

        /* Information Panel - Enhanced */
        .info-panel {
            position: absolute;
            top: 70px;
            right: 20px;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(25px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 16px;
            padding: 24px;
            width: 380px;
            max-height: calc(100vh - 140px);
            z-index: 800;
            overflow-y: auto;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }

        .info-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        }

        .info-icon {
            font-size: 28px;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        .info-title {
            flex: 1;
        }

        .info-title h2 {
            font-size: 18px;
            color: #4ecdc4;
            margin-bottom: 4px;
        }

        .info-subtitle {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.7);
        }

        .info-content {
            color: rgba(255, 255, 255, 0.9);
            font-size: 14px;
            line-height: 1.6;
        }

        /* Progress Tracker */
        .progress-tracker {
            background: linear-gradient(135deg, rgba(78, 205, 196, 0.1), rgba(69, 183, 209, 0.1));
            border: 1px solid rgba(78, 205, 196, 0.3);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 20px;
        }

        .progress-header {
            font-size: 13px;
            font-weight: 600;
            color: #4ecdc4;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .progress-percentage {
            font-size: 18px;
            color: #ff6b6b;
            font-weight: 700;
        }

        .progress-bar {
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 12px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff6b6b, #4ecdc4);
            border-radius: 4px;
            transition: width 0.8s ease;
            box-shadow: 0 0 10px rgba(78, 205, 196, 0.5);
        }

        .progress-steps-mini {
            display: flex;
            justify-content: space-between;
            font-size: 10px;
            color: rgba(255, 255, 255, 0.6);
        }

        .step-mini {
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .step-mini.active {
            color: #4ecdc4;
            font-weight: 600;
        }

        .step-mini.completed {
            color: #45b7d1;
        }

        /* Information Cards */
        .info-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 14px;
            margin-bottom: 14px;
        }

        .info-card-title {
            color: #4ecdc4;
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .info-card-content {
            color: rgba(255, 255, 255, 0.85);
            font-size: 12px;
            line-height: 1.5;
        }

        .info-list {
            list-style: none;
            padding: 0;
        }

        .info-list li {
            padding: 6px 0;
            padding-left: 20px;
            position: relative;
            font-size: 12px;
            color: rgba(255, 255, 255, 0.8);
        }

        .info-list li:before {
            content: "→";
            position: absolute;
            left: 0;
            color: #4ecdc4;
        }

        /* Fun Fact Box */
        .fun-fact {
            background: linear-gradient(135deg, rgba(255, 107, 107, 0.1), rgba(78, 205, 196, 0.1));
            border: 1px solid rgba(255, 107, 107, 0.3);
            border-radius: 12px;
            padding: 14px;
            margin: 16px 0;
            position: relative;
            overflow: hidden;
        }

        .fun-fact:before {
            content: "🌍";
            position: absolute;
            top: -20px;
            right: -20px;
            font-size: 60px;
            opacity: 0.1;
        }

        .fun-fact-title {
            color: #ff6b6b;
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 6px;
        }

        .fun-fact-text {
            color: rgba(255, 255, 255, 0.9);
            font-size: 12px;
            line-height: 1.5;
            position: relative;
            z-index: 1;
        }

        /* Voice Controls */
        .voice-controls {
            position: absolute;
            top: 10px;
            right: 20px;
            display: flex;
            gap: 8px;
            z-index: 1000;
        }

        .control-btn {
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            width: 44px;
            height: 44px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            position: relative;
        }

        .control-btn:hover {
            background: rgba(78, 205, 196, 0.3);
            border-color: #4ecdc4;
            transform: scale(1.1);
        }

        .control-btn.active {
            background: rgba(78, 205, 196, 0.4);
            border-color: #4ecdc4;
            box-shadow: 0 0 20px rgba(78, 205, 196, 0.5);
        }

        .control-tooltip {
            position: absolute;
            bottom: -30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9);
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 10px;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .control-btn:hover .control-tooltip {
            opacity: 1;
        }

        /* Loading Screen */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 50%, #87ceeb 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            transition: opacity 1s ease;
        }

        .loading-content {
            text-align: center;
        }

        .loading-ozone {
            font-size: 60px;
            animation: ozoneProtection 1.5s ease-in-out infinite;
            margin-bottom: 20px;
        }

        .loading-text {
            color: white;
            font-size: 20px;
            margin-bottom: 20px;
        }

        .loading-progress {
            width: 200px;
            height: 4px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 2px;
            overflow: hidden;
        }

        .loading-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #ff6b6b, #4ecdc4);
            animation: loading 2s ease-in-out infinite;
        }

        @keyframes loading {
            0% { width: 0%; }
            50% { width: 100%; }
            100% { width: 0%; }
        }

        /* Voice Indicator */
        .voice-indicator {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(78, 205, 196, 0.5);
            border-radius: 30px;
            padding: 14px 28px;
            display: flex;
            align-items: center;
            gap: 12px;
            z-index: 1000;
            opacity: 0;
            transition: all 0.3s ease;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }

        .voice-indicator.visible {
            opacity: 1;
            transform: translateX(-50%) translateY(-10px);
        }

        .voice-waves {
            display: flex;
            align-items: center;
            gap: 3px;
        }

        .voice-wave {
            width: 3px;
            height: 20px;
            background: linear-gradient(180deg, #4ecdc4, #45b7d1);
            border-radius: 2px;
            animation: voice-wave 1s ease-in-out infinite;
        }

        .voice-wave:nth-child(2) { animation-delay: 0.1s; }
        .voice-wave:nth-child(3) { animation-delay: 0.2s; }
        .voice-wave:nth-child(4) { animation-delay: 0.3s; }
        .voice-wave:nth-child(5) { animation-delay: 0.4s; }

        @keyframes voice-wave {
            0%, 100% { transform: scaleY(0.3); }
            50% { transform: scaleY(1); }
        }

        .narration-text {
            color: white;
            font-size: 13px;
            max-width: 300px;
        }

        /* Quick Actions */
        .quick-actions {
            position: absolute;
            bottom: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            z-index: 1000;
        }

        .action-btn {
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 10px 16px;
            border-radius: 25px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
        }

        .action-btn:hover {
            background: rgba(78, 205, 196, 0.3);
            border-color: #4ecdc4;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(78, 205, 196, 0.3);
        }

        /* Custom Scrollbar */
        .info-panel::-webkit-scrollbar {
            width: 6px;
        }

        .info-panel::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 3px;
        }

        .info-panel::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, #4ecdc4, #45b7d1);
            border-radius: 3px;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .info-panel {
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                top: auto;
                width: 100%;
                max-height: 50vh;
                border-radius: 20px 20px 0 0;
            }
            
            .journey-navigation {
                bottom: 52vh;
                max-width: calc(100% - 40px);
            }
            
            .voice-controls {
                top: auto;
                bottom: 55vh;
                right: 10px;
            }
            
            .quick-actions {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="bg-animation"></div>

    <!-- Loading Screen -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-content">
            <div class="loading-ozone">🛡️</div>
            <div class="loading-text">Preparing Your Atmospheric Journey...</div>
            <div class="loading-progress">
                <div class="loading-progress-bar"></div>
            </div>
        </div>
    </div>

    <!-- Museum Header -->
    <div class="museum-header">
        <div class="museum-title">Human Environmental Impact</div>
        <div class="exhibit-subtitle">
            <span class="ozone-indicator"></span>
            Protecting Earth's Atmospheric Shield
        </div>
    </div>

    <!-- Journey Navigation -->
    <div class="journey-navigation">
        <div class="journey-title">
            <span>🌍</span>
            <span>Atmospheric Protection</span>
        </div>
        <div class="journey-steps">
            <button class="journey-btn active" onclick="loadJourneyStep('introduction')">
                <span>🌍</span> Introduction
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('molecule')">
                <span>⚛️</span> O3 Molecule
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('protection')">
                <span>🛡️</span> UV Protection
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('cfcs')">
                <span>🏭</span> CFCs
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('depletion')">
                <span>💥</span> Depletion
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('consequences')">
                <span>⚠️</span> Effects
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('solutions')">
                <span>📜</span> Solutions
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('research')">
                <span>🔬</span> Research
            </button>
        </div>
    </div>

    <!-- 3D Model Container -->
    <div class="model-container">
        <div class="sketchfab-embed-wrapper">
            <iframe id="api-frame"
                    title="Ozone Layer Model" 
                    frameborder="0" 
                    allowfullscreen 
                    mozallowfullscreen="true" 
                    webkitallowfullscreen="true" 
                    allow="autoplay; fullscreen; xr-spatial-tracking"
                    xr-spatial-tracking 
                    execution-while-out-of-viewport 
                    execution-while-not-rendered 
                    web-share 
                    src="https://sketchfab.com/models/195a23b32a8a4f2dafdf88fdc6abb7d5/embed?autostart=1&internal=1&tracking=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0">
            </iframe>
        </div>
    </div>

    <!-- Information Panel -->
    <div class="info-panel" id="infoPanel">
        <div class="info-header">
            <div class="info-icon" id="stepIcon">🌍</div>
            <div class="info-title">
                <h2 id="stepTitle">The Ozone Layer - Our Atmospheric Shield</h2>
                <div class="info-subtitle" id="stepSubtitle">Earth's natural protection against harmful radiation</div>
            </div>
        </div>

        <!-- Progress Tracker -->
        <div class="progress-tracker">
            <div class="progress-header">
                <span>Environmental Awareness</span>
                <span class="progress-percentage" id="progressPercent">0%</span>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 0%"></div>
            </div>
            <div class="progress-steps-mini">
                <span class="step-mini active" onclick="loadJourneyStep('introduction')">Intro</span>
                <span class="step-mini" onclick="loadJourneyStep('molecule')">O3</span>
                <span class="step-mini" onclick="loadJourneyStep('protection')">UV</span>
                <span class="step-mini" onclick="loadJourneyStep('cfcs')">CFC</span>
                <span class="step-mini" onclick="loadJourneyStep('depletion')">Hole</span>
                <span class="step-mini" onclick="loadJourneyStep('consequences')">Effect</span>
                <span class="step-mini" onclick="loadJourneyStep('solutions')">Fix</span>
                <span class="step-mini" onclick="loadJourneyStep('research')">Study</span>
            </div>
        </div>

        <div class="info-content" id="mainDescription">
            The ozone layer is a region of Earth's stratosphere that contains high concentrations of ozone (O3) molecules. Located 10-30 miles above Earth's surface, this invisible shield absorbs most of the Sun's harmful ultraviolet radiation, making life on Earth possible. Without this protection, UV radiation would sterilize the planet's surface.
        </div>

        <div class="info-card">
            <div class="info-card-title">
                <span>🔬</span> Key Concepts
            </div>
            <div class="info-card-content">
                <ul class="info-list" id="keyConcepts">
                    <li>Located in the stratosphere (10-30 miles up)</li>
                    <li>Contains concentrated ozone (O3) molecules</li>
                    <li>Absorbs 97-99% of harmful UV radiation</li>
                    <li>Essential for protecting life on Earth</li>
                </ul>
            </div>
        </div>

        <div class="fun-fact">
            <div class="fun-fact-title">Environmental Fact!</div>
            <div class="fun-fact-text" id="funFact">
                If you could compress all the ozone in the atmosphere into a layer at sea level, it would only be about 3 millimeters thick - thinner than a coin!
            </div>
        </div>

        <div class="info-card">
            <div class="info-card-title">
                <span>🎯</span> Learning Objectives
            </div>
            <div class="info-card-content" id="learningObjectives">
                Understand the critical role of the ozone layer in protecting Earth and how human activities have threatened this natural shield.
            </div>
        </div>
    </div>

    <!-- Voice Controls -->
    <div class="voice-controls">
        <button class="control-btn active" id="voiceToggle" onclick="toggleVoice()">
            🔊
            <span class="control-tooltip">Voice Narration</span>
        </button>
        <button class="control-btn" onclick="toggleAutoPlay()">
            ▶️
            <span class="control-tooltip">Auto Journey</span>
        </button>
        <button class="control-btn" onclick="toggleInfo()">
            ℹ️
            <span class="control-tooltip">Toggle Info</span>
        </button>
    </div>

    <!-- Quick Actions -->
    <div class="quick-actions">
        <button class="action-btn" onclick="startGuidedTour()">
            <span>🚀</span> Guided Tour
        </button>
        <button class="action-btn" onclick="showQuiz()">
            <span>🎯</span> Test Knowledge
        </button>
    </div>

    <!-- Voice Indicator -->
    <div class="voice-indicator" id="voiceIndicator">
        <div class="voice-waves">
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
        </div>
        <div class="narration-text" id="narrationText">Narrating...</div>
    </div>

    <script>
        // Journey Step Data with Complete Environmental Content
        const JOURNEY_DATA = {
            introduction: {
                title: "The Ozone Layer - Our Atmospheric Shield",
                subtitle: "Earth's natural protection against harmful radiation",
                icon: "🌍",
                modelUrl: "https://sketchfab.com/models/195a23b32a8a4f2dafdf88fdc6abb7d5/embed?autostart=1&internal=1&tracking=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "The ozone layer is a region of Earth's stratosphere that contains high concentrations of ozone (O3) molecules. Located 10-30 miles above Earth's surface, this invisible shield absorbs most of the Sun's harmful ultraviolet radiation, making life on Earth possible. Without this protection, UV radiation would sterilize the planet's surface.",
                concepts: [
                    "Located in the stratosphere (10-30 miles up)",
                    "Contains concentrated ozone (O3) molecules",
                    "Absorbs 97-99% of harmful UV radiation",
                    "Essential for protecting life on Earth"
                ],
                funFact: "If you could compress all the ozone in the atmosphere into a layer at sea level, it would only be about 3 millimeters thick - thinner than a coin!",
                objectives: "Understand the critical role of the ozone layer in protecting Earth and how human activities have threatened this natural shield.",
                narration: "Welcome to one of the most important environmental stories of our time! You're looking at a visualization of ozone layer depletion - the hole that human activities created in Earth's protective shield. The ozone layer sits high in the stratosphere, between 10 and 30 miles above your head. It might seem far away, but it's absolutely essential for life on Earth. This thin layer of ozone molecules acts like Earth's sunscreen, absorbing 97 to 99 percent of the Sun's harmful ultraviolet radiation. Without it, that UV radiation would reach Earth's surface at levels that would be lethal to most living things. The ozone layer formed naturally over millions of years, but in just a few decades, human activities began destroying it faster than nature could replace it."
            },
            molecule: {
                title: "Ozone Molecule Structure",
                subtitle: "The chemistry behind atmospheric protection",
                icon: "⚛️",
                modelUrl: "https://sketchfab.com/models/143b03daaf5445849a902544084f49b0/embed?autostart=1&internal=1&tracking=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "An ozone molecule consists of three oxygen atoms (O3) bonded together in a bent shape. This molecular structure gives ozone its unique ability to absorb ultraviolet radiation. The molecule is unstable and reactive, which allows it to break apart when hit by UV light, absorbing the energy that would otherwise reach Earth's surface.",
                concepts: [
                    "Three oxygen atoms bonded together (O3)",
                    "Bent molecular shape creates instability",
                    "Absorbs UV light by breaking apart",
                    "Reforms naturally in the stratosphere"
                ],
                funFact: "Ozone molecules are constantly being created and destroyed in the stratosphere - each molecule lasts only about 3 days before breaking apart and reforming!",
                objectives: "Learn how the molecular structure of ozone enables it to protect Earth from harmful radiation.",
                narration: "Here's the molecular hero of our story - the ozone molecule! This simple but powerful molecule consists of three oxygen atoms bonded together in a bent shape. The normal oxygen we breathe has only two atoms - O2 - but ozone has three - O3. This extra oxygen atom makes ozone unstable and reactive, which is exactly what makes it so effective at protecting us. When high-energy ultraviolet light from the Sun hits an ozone molecule, the molecule absorbs that energy and breaks apart. This process converts the dangerous UV radiation into harmless heat. The broken pieces then recombine to form new ozone molecules, ready to absorb more UV radiation. It's like having millions of tiny shields constantly sacrificing themselves to protect us, then reassembling to continue the protection. This process happens naturally when oxygen molecules are split by UV light, creating free oxygen atoms that combine with other oxygen molecules to form ozone."
            },
            protection: {
                title: "UV Protection Mechanism",
                subtitle: "How ozone shields Earth from harmful radiation",
                icon: "🛡️",
                modelUrl: "https://sketchfab.com/models/195a23b32a8a4f2dafdf88fdc6abb7d5/embed?autostart=1&internal=1&tracking=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "The ozone layer protects Earth by absorbing three types of ultraviolet radiation: UV-A, UV-B, and UV-C. UV-C is completely blocked, UV-B is mostly absorbed, and some UV-A reaches the surface. This filtering process prevents DNA damage, skin cancer, cataracts, and ecosystem disruption that would occur with unfiltered solar radiation.",
                concepts: [
                    "Blocks UV-C radiation completely",
                    "Absorbs most harmful UV-B radiation", 
                    "Allows some UV-A to reach surface",
                    "Prevents DNA damage and ecosystem collapse"
                ],
                funFact: "Without the ozone layer, you would get a severe sunburn in just 10 minutes on a sunny day, even in winter!",
                objectives: "Understand how the ozone layer filters different types of UV radiation and protects life on Earth.",
                narration: "Let's see how our atmospheric shield actually works! The Sun bombards Earth with three types of ultraviolet radiation: UV-A, UV-B, and UV-C. The ozone layer acts like a sophisticated filter, treating each type differently. UV-C radiation is the most dangerous - it can kill bacteria and damage DNA instantly. Fortunately, the ozone layer blocks 100% of UV-C radiation. UV-B radiation is also harmful, causing sunburn, skin cancer, and cataracts. The ozone layer absorbs about 95% of UV-B radiation, allowing only small amounts to reach Earth's surface. UV-A radiation is less harmful and mostly passes through, giving us the ability to synthesize vitamin D. This natural filtering system took millions of years to develop and has allowed complex life to evolve on Earth's surface. When we damage the ozone layer, more UV-B radiation reaches the surface, increasing skin cancer rates, damaging crops, and harming marine ecosystems that form the base of the food chain."
            },
            cfcs: {
                title: "Chlorofluorocarbons - The Ozone Destroyers",
                subtitle: "Human-made chemicals that attack the ozone layer",
                icon: "🏭",
                modelUrl: "https://sketchfab.com/models/195a23b32a8a4f2dafdf88fdc6abb7d5/embed?autostart=1&internal=1&tracking=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "Chlorofluorocarbons (CFCs) were invented in the 1930s as safe alternatives to toxic refrigerants. Used in refrigerators, air conditioners, aerosol sprays, and foam products, CFCs seemed perfect - non-toxic, non-flammable, and chemically stable. However, this stability allowed them to reach the stratosphere unchanged, where they began destroying ozone molecules.",
                concepts: [
                    "Invented as safe refrigerants in 1930s",
                    "Used in cooling systems and aerosols",
                    "Chemically stable at ground level",
                    "Persist in atmosphere for 50-100 years"
                ],
                funFact: "One CFC molecule can destroy up to 100,000 ozone molecules before it's finally broken down - a tiny amount can cause massive damage!",
                objectives: "Learn how CFCs were developed and why their beneficial properties at ground level made them so destructive in the stratosphere.",
                narration: "Meet the villains of our story - chlorofluorocarbons, or CFCs. These chemicals seemed like a miracle when they were invented in the 1930s. Before CFCs, refrigerators used toxic gases like ammonia and sulfur dioxide that could kill people if they leaked. CFCs were non-toxic, non-flammable, and incredibly stable - they seemed perfect for refrigeration, air conditioning, and aerosol sprays. For decades, CFCs made our lives better and safer. The problem was that the same stability that made CFCs safe at ground level also meant they didn't break down in the lower atmosphere. Instead, they slowly drifted upward, taking 5 to 10 years to reach the stratosphere. Once there, the intense UV radiation that the ozone layer normally blocks finally had enough energy to break apart the CFC molecules, releasing chlorine atoms. These chlorine atoms became ozone destroyers, each one capable of breaking apart thousands of ozone molecules in a chain reaction that could continue for decades."
            },
            depletion: {
                title: "Ozone Depletion Process",
                subtitle: "How CFCs create the ozone hole",
                icon: "💥",
                modelUrl: "https://sketchfab.com/models/195a23b32a8a4f2dafdf88fdc6abb7d5/embed?autostart=1&internal=1&tracking=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "When CFCs reach the stratosphere, UV radiation breaks them apart, releasing chlorine atoms. Each chlorine atom can destroy thousands of ozone molecules through catalytic destruction. The process is most severe over Antarctica, where special atmospheric conditions create the 'ozone hole' - an area where ozone levels drop by 90% each spring.",
                concepts: [
                    "UV radiation breaks apart CFC molecules",
                    "Chlorine atoms destroy ozone catalytically",
                    "One chlorine atom destroys many ozone molecules",
                    "Antarctic conditions create the 'ozone hole'"
                ],
                funFact: "The Antarctic ozone hole can cover an area larger than North America and be deeper than Mount Everest is tall!",
                objectives: "Understand the chemical process behind ozone destruction and why the ozone hole forms over Antarctica.",
                narration: "Here's where the destruction happens - the process that creates the ozone hole you're seeing in this model. When CFC molecules finally reach the stratosphere, the intense UV radiation breaks them apart, releasing chlorine atoms. These chlorine atoms are incredibly destructive to ozone. Here's how it works: a chlorine atom collides with an ozone molecule, stealing one oxygen atom to form chlorine monoxide and leaving behind a regular oxygen molecule. Then the chlorine monoxide collides with another ozone molecule, releasing the oxygen and freeing the chlorine atom to destroy more ozone. This process repeats thousands of times - each chlorine atom can destroy 100,000 ozone molecules before it's finally neutralized. The destruction is most severe over Antarctica because of unique atmospheric conditions there. During the dark Antarctic winter, special ice clouds form that concentrate the destructive chemicals. When spring arrives and sunlight returns, these chemicals are activated all at once, creating the massive ozone hole you see here."
            },
            consequences: {
                title: "Environmental and Health Effects",
                subtitle: "The impact of ozone depletion on Earth",
                icon: "⚠️",
                modelUrl: "https://sketchfab.com/models/195a23b32a8a4f2dafdf88fdc6abb7d5/embed?autostart=1&internal=1&tracking=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "Ozone depletion leads to increased UV radiation reaching Earth's surface, causing higher rates of skin cancer, cataracts, and immune system suppression in humans. It also damages crops, reduces phytoplankton populations in oceans, and disrupts entire ecosystems. The effects are most severe in regions under the ozone hole.",
                concepts: [
                    "Increased skin cancer and cataracts",
                    "Weakened immune systems",
                    "Reduced crop yields and food security",
                    "Marine ecosystem disruption"
                ],
                funFact: "In southern Chile and Argentina, people need to wear sunglasses and sunscreen even on cloudy days because of the extra UV radiation from the nearby ozone hole!",
                objectives: "Recognize the serious consequences of ozone depletion for human health and environmental systems.",
                narration: "The ozone hole you're seeing isn't just a scientific curiosity - it has real, serious consequences for life on Earth. As more UV-B radiation reaches the surface, human health suffers dramatically. Skin cancer rates increase, particularly in countries like Australia and New Zealand that lie under the ozone hole's influence. People develop cataracts at younger ages, and their immune systems become suppressed, making them more vulnerable to diseases. But humans aren't the only ones affected. Increased UV radiation reduces crop yields, threatening food security. It penetrates ocean water, killing phytoplankton - the microscopic marine plants that form the base of ocean food webs and produce much of our oxygen. When phytoplankton populations crash, fish populations follow, affecting both marine ecosystems and human food supplies. In areas directly under the ozone hole, the effects are so severe that people must wear sunscreen on cloudy days, and sheep in Patagonia have developed cataracts from the excessive UV exposure."
            },
            solutions: {
                title: "International Response - The Montreal Protocol",
                subtitle: "How the world came together to heal the ozone layer",
                icon: "📜",
                modelUrl: "https://sketchfab.com/models/195a23b32a8a4f2dafdf88fdc6abb7d5/embed?autostart=1&internal=1&tracking=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "The Montreal Protocol, signed in 1987, is one of the most successful environmental agreements in history. It phased out the production and use of ozone-depleting substances like CFCs. Nearly every country on Earth signed the agreement, and by working together, we've begun healing the ozone layer.",
                concepts: [
                    "Montreal Protocol signed in 1987",
                    "Phased out CFC production globally",
                    "Nearly universal participation by countries",
                    "Ozone layer is slowly recovering"
                ],
                funFact: "The Montreal Protocol is the only UN treaty to achieve universal ratification - every single country on Earth has signed it!",
                objectives: "Learn how international cooperation successfully addressed the ozone depletion crisis.",
                narration: "Here's the hopeful part of our story - proof that humanity can solve environmental problems when we work together! In 1987, countries around the world signed the Montreal Protocol, an agreement to phase out ozone-depleting substances. This treaty is remarkable for several reasons. First, it achieved something almost impossible in international politics - universal participation. Every single country on Earth has signed it. Second, it worked! The protocol didn't just ban CFCs immediately, which would have been economically devastating. Instead, it created a timeline for phasing them out while helping industries develop safer alternatives like hydrofluorocarbons for refrigeration. Third, richer countries helped poorer countries transition to ozone-safe technologies, recognizing that environmental protection is a shared responsibility. The result? CFC production has been virtually eliminated, and the ozone layer has begun to recover. Scientists predict that the ozone hole will fully heal by around 2070. The Montreal Protocol proves that when we understand an environmental threat and commit to addressing it together, we can succeed!"
            },
            research: {
                title: "Activity 13.4 - Current Ozone Research",
                subtitle: "Monitoring recovery and ongoing challenges",
                icon: "🔬",
                modelUrl: "https://sketchfab.com/models/143b03daaf5445849a902544084f49b0/embed?autostart=1&internal=1&tracking=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "Scientists continue monitoring the ozone layer using satellites, ground-based instruments, and computer models. Current research focuses on tracking recovery progress, understanding climate change interactions, and detecting new threats like illegal CFC emissions. Student research projects can analyze real ozone data and explore current environmental challenges.",
                concepts: [
                    "Satellite monitoring of ozone levels",
                    "Tracking recovery progress since 1987",
                    "Climate change interactions with ozone",
                    "Detecting new environmental threats"
                ],
                funFact: "NASA's ozone monitoring satellites can detect changes in atmospheric ozone that are smaller than 1% - incredibly precise measurements from space!",
                objectives: "Engage with current ozone research and understand how scientific monitoring helps track environmental recovery.",
                narration: "Now it's time for you to become an ozone researcher! Scientists around the world continue studying the ozone layer using sophisticated instruments on satellites, aircraft, and ground stations. This ozone molecule represents the focus of ongoing research into how our atmospheric shield is recovering. Current research addresses several important questions: How fast is the ozone layer healing? Are there unexpected interactions between ozone recovery and climate change? Are there new threats we need to watch for? In your own research project, you can access real ozone data from NASA and other agencies to track changes over time. You might compare ozone levels from different decades, analyze seasonal patterns, or investigate how the ozone hole size changes from year to year. Recent research has discovered some concerning developments, like illegal CFC emissions from unknown sources that scientists are working to identify and stop. The story of ozone depletion and recovery shows how scientific research, international cooperation, and public awareness can address global environmental challenges. Your generation will inherit both the success of ozone recovery and new environmental challenges that will require the same level of commitment and cooperation."
            }
        };

        // Global Variables
        let currentStep = 'introduction';
        let voiceEnabled = true;
        let autoPlayEnabled = false;
        let currentSpeech = null;
        let selectedVoice = null;
        let journeyProgress = 0;
        let guidedTourActive = false;

        // Initialize Voice System
        function initVoiceSystem() {
            if (!('speechSynthesis' in window)) {
                console.warn('Speech synthesis not supported');
                voiceEnabled = false;
                document.getElementById('voiceToggle').style.display = 'none';
                return;
            }

            function loadVoices() {
                const voices = speechSynthesis.getVoices();
                if (voices.length === 0) return;

                // Prefer natural-sounding voices
                const preferredVoices = [
                    'Google UK English Female',
                    'Microsoft Sonia',
                    'Microsoft Hazel',
                    'Samantha',
                    'Victoria'
                ];

                for (const name of preferredVoices) {
                    selectedVoice = voices.find(v => v.name.includes(name));
                    if (selectedVoice) break;
                }

                if (!selectedVoice) {
                    selectedVoice = voices.find(v => v.lang.startsWith('en'));
                }
            }

            loadVoices();
            if (speechSynthesis.onvoiceschanged !== undefined) {
                speechSynthesis.onvoiceschanged = loadVoices;
            }
        }

        // Load Journey Step
        function loadJourneyStep(stepId) {
            const stepData = JOURNEY_DATA[stepId];
            if (!stepData) return;

            currentStep = stepId;
            
            // Update model
            document.getElementById('api-frame').src = stepData.modelUrl;
            
            // Update info panel
            document.getElementById('stepIcon').textContent = stepData.icon;
            document.getElementById('stepTitle').textContent = stepData.title;
            document.getElementById('stepSubtitle').textContent = stepData.subtitle;
            document.getElementById('mainDescription').textContent = stepData.description;
            
            // Update key concepts
            const conceptsList = document.getElementById('keyConcepts');
            conceptsList.innerHTML = stepData.concepts.map(c => `<li>${c}</li>`).join('');
            
            // Update fun fact
            document.getElementById('funFact').textContent = stepData.funFact;
            
            // Update learning objectives
            document.getElementById('learningObjectives').textContent = stepData.objectives;
            
            // Update navigation buttons
            updateNavigationButtons(stepId);
            
            // Update progress
            updateProgress();
            
            // Play narration if enabled
            if (voiceEnabled) {
                speakText(stepData.narration);
            }
        }

        // Update Navigation Buttons
        function updateNavigationButtons(activeStep) {
            const buttons = document.querySelectorAll('.journey-btn');
            const steps = ['introduction', 'molecule', 'protection', 'cfcs', 'depletion', 'consequences', 'solutions', 'research'];
            const activeIndex = steps.indexOf(activeStep);
            
            buttons.forEach((btn, index) => {
                btn.classList.remove('active', 'completed');
                if (index < activeIndex) {
                    btn.classList.add('completed');
                } else if (index === activeIndex) {
                    btn.classList.add('active');
                }
            });
            
            // Update mini steps
            const miniSteps = document.querySelectorAll('.step-mini');
            miniSteps.forEach((step, index) => {
                step.classList.remove('active', 'completed');
                if (index < activeIndex) {
                    step.classList.add('completed');
                } else if (index === activeIndex) {
                    step.classList.add('active');
                }
            });
        }

        // Update Progress
        function updateProgress() {
            const steps = ['introduction', 'molecule', 'protection', 'cfcs', 'depletion', 'consequences', 'solutions', 'research'];
            const currentIndex = steps.indexOf(currentStep);
            const progress = ((currentIndex + 1) / steps.length) * 100;
            
            document.getElementById('progressPercent').textContent = Math.round(progress) + '%';
            document.getElementById('progressFill').style.width = progress + '%';
        }

        // Speech Functions
        function speakText(text) {
            if (!voiceEnabled || !text) return;
            
            stopSpeech();
            
            currentSpeech = new SpeechSynthesisUtterance(text);
            if (selectedVoice) {
                currentSpeech.voice = selectedVoice;
            }
            currentSpeech.rate = 0.9;
            currentSpeech.pitch = 1.0;
            currentSpeech.volume = 0.9;
            
            currentSpeech.onstart = () => {
                document.getElementById('voiceIndicator').classList.add('visible');
                document.getElementById('narrationText').textContent = 
                    text.substring(0, 50) + (text.length > 50 ? '...' : '');
            };
            
            currentSpeech.onend = () => {
                document.getElementById('voiceIndicator').classList.remove('visible');
                currentSpeech = null;
                
                // Auto-advance if guided tour is active
                if (guidedTourActive) {
                    setTimeout(nextStep, 2000);
                }
            };
            
            speechSynthesis.speak(currentSpeech);
        }

        function stopSpeech() {
            if (currentSpeech) {
                speechSynthesis.cancel();
                currentSpeech = null;
                document.getElementById('voiceIndicator').classList.remove('visible');
            }
        }

        // Control Functions
        function toggleVoice() {
            voiceEnabled = !voiceEnabled;
            const btn = document.getElementById('voiceToggle');
            btn.textContent = voiceEnabled ? '🔊' : '🔇';
            btn.classList.toggle('active', voiceEnabled);
            
            if (!voiceEnabled) {
                stopSpeech();
            }
        }

        function toggleAutoPlay() {
            autoPlayEnabled = !autoPlayEnabled;
            if (autoPlayEnabled) {
                startGuidedTour();
            } else {
                guidedTourActive = false;
            }
        }

        function toggleInfo() {
            const panel = document.getElementById('infoPanel');
            panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
        }

        // Guided Tour
        function startGuidedTour() {
            guidedTourActive = true;
            const steps = ['introduction', 'molecule', 'protection', 'cfcs', 'depletion', 'consequences', 'solutions', 'research'];
            let stepIndex = 0;
            
            function tourStep() {
                if (stepIndex < steps.length && guidedTourActive) {
                    loadJourneyStep(steps[stepIndex]);
                    stepIndex++;
                } else {
                    guidedTourActive = false;
                    if (voiceEnabled) {
                        speakText("You've completed your journey through human environmental impact and ozone layer protection. You now understand how global cooperation can solve environmental challenges!");
                    }
                }
            }
            
            tourStep();
            window.nextStep = tourStep;
        }

        // Quiz Function
        function showQuiz() {
            const questions = [
                "How do CFCs destroy ozone molecules in the stratosphere?",
                "Why did the Montreal Protocol succeed where other environmental agreements failed?",
                "What would happen to life on Earth without the ozone layer?",
                "How do scientists monitor ozone layer recovery?",
                "What lessons can we learn from the ozone depletion story for other environmental challenges?"
            ];
            
            const randomQ = questions[Math.floor(Math.random() * questions.length)];
            
            if (voiceEnabled) {
                speakText(`Here's an environmental question: ${randomQ} Think about the atmospheric processes and international cooperation you've learned about!`);
            }
        }

        // Initialize
        function init() {
            initVoiceSystem();
            
            // Hide loading screen
            setTimeout(() => {
                const loading = document.getElementById('loadingOverlay');
                loading.style.opacity = '0';
                setTimeout(() => {
                    loading.style.display = 'none';
                    
                    // Welcome message
                    if (voiceEnabled) {
                        speakText("Welcome to your atmospheric protection journey! We'll explore how human activities damaged Earth's ozone layer and how international cooperation is healing our planet's natural shield. Let's start by understanding what the ozone layer does for us!");
                    }
                }, 1000);
            }, 3000);
            
            // Keyboard shortcuts
            document.addEventListener('keydown', (e) => {
                switch(e.key) {
                    case 'v': toggleVoice(); break;
                    case 'i': toggleInfo(); break;
                    case 'g': startGuidedTour(); break;
                    case 'Escape': stopSpeech(); guidedTourActive = false; break;
                    case 'ArrowRight': nextStep && nextStep(); break;
                }
            });
        }

        // Start the application
        init();
    </script>
</body>
</html>