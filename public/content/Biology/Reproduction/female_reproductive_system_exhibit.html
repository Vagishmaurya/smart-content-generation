<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Female Reproductive System - The Biology of Human Reproduction</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tween.js/18.6.4/tween.umd.js"></script>

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #e91e63 0%, #ad1457 100%);
            color: white;
            overflow: hidden;
            position: relative;
            height: 100vh;
        }

        /* Animated Background */
        .bg-animation {
            position: fixed;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: 0;
            opacity: 0.1;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 320"><path fill="%23ffffff" fill-opacity="0.2" d="M0,96L48,112C96,128,192,160,288,186.7C384,213,480,235,576,213.3C672,192,768,128,864,128C960,128,1056,192,1152,197.3C1248,203,1344,149,1392,122.7L1440,96L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z"></path></svg>') repeat-x;
            animation: wave 16s linear infinite;
        }

        @keyframes wave {
            0% { background-position-x: 0; }
            100% { background-position-x: 1440px; }
        }

        /* Museum Interface - Compact Header */
        .museum-header {
            position: absolute;
            top: 10px;
            left: 20px;
            text-align: left;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            padding: 10px 18px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .museum-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 4px;
            background: linear-gradient(45deg, #e91e63, #9c27b0);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: titleGlow 3s ease-in-out infinite;
        }

        @keyframes titleGlow {
            0%, 100% { filter: brightness(1); }
            50% { filter: brightness(1.2); }
        }

        .exhibit-subtitle {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.8);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .bio-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            background: #ff4081;
            border-radius: 50%;
            animation: bio-pulse 2s ease-in-out infinite;
        }

        @keyframes bio-pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.3); opacity: 0.7; }
        }

        /* Journey Navigation - Enhanced */
        .journey-navigation {
            position: absolute;
            bottom: 20px;
            left: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            padding: 15px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            max-width: 320px;
        }

        .journey-title {
            font-size: 14px;
            font-weight: 600;
            color: #e91e63;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .journey-steps {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }

        .journey-btn {
            background: rgba(233, 30, 99, 0.2);
            border: 1px solid rgba(233, 30, 99, 0.4);
            color: white;
            padding: 6px 10px;
            border-radius: 20px;
            font-size: 11px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 4px;
            white-space: nowrap;
        }

        .journey-btn:hover {
            background: rgba(233, 30, 99, 0.3);
            border-color: #e91e63;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(233, 30, 99, 0.3);
        }

        .journey-btn.active {
            background: linear-gradient(135deg, #e91e63, #ad1457);
            border-color: #e91e63;
            box-shadow: 0 0 20px rgba(233, 30, 99, 0.5);
            animation: pulse 2s infinite;
        }

        .journey-btn.completed {
            background: rgba(156, 39, 176, 0.3);
            border-color: #9c27b0;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        /* 3D Model Container */
        .model-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 0;
            overflow: hidden;
            border: none;
            z-index: 100;
        }

        .sketchfab-embed-wrapper {
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #e91e63 0%, #ad1457 100%);
        }

        .sketchfab-embed-wrapper iframe {
            width: 100%;
            height: 100%;
            border: none;
            border-radius: 0;
        }

        /* Information Panel - Enhanced */
        .info-panel {
            position: absolute;
            top: 70px;
            right: 20px;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(25px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 16px;
            padding: 24px;
            width: 380px;
            max-height: calc(100vh - 140px);
            z-index: 800;
            overflow-y: auto;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }

        .info-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        }

        .info-icon {
            font-size: 28px;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        .info-title {
            flex: 1;
        }

        .info-title h2 {
            font-size: 18px;
            color: #e91e63;
            margin-bottom: 4px;
        }

        .info-subtitle {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.7);
        }

        .info-content {
            color: rgba(255, 255, 255, 0.9);
            font-size: 14px;
            line-height: 1.6;
        }

        /* Progress Tracker */
        .progress-tracker {
            background: linear-gradient(135deg, rgba(233, 30, 99, 0.1), rgba(156, 39, 176, 0.1));
            border: 1px solid rgba(233, 30, 99, 0.3);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 20px;
        }

        .progress-header {
            font-size: 13px;
            font-weight: 600;
            color: #e91e63;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .progress-percentage {
            font-size: 18px;
            color: #9c27b0;
            font-weight: 700;
        }

        .progress-bar {
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 12px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #e91e63, #9c27b0);
            border-radius: 4px;
            transition: width 0.8s ease;
            box-shadow: 0 0 10px rgba(233, 30, 99, 0.5);
        }

        .progress-steps-mini {
            display: flex;
            justify-content: space-between;
            font-size: 9px;
            color: rgba(255, 255, 255, 0.6);
        }

        .step-mini {
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .step-mini.active {
            color: #e91e63;
            font-weight: 600;
        }

        .step-mini.completed {
            color: #9c27b0;
        }

        /* Information Cards */
        .info-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 14px;
            margin-bottom: 14px;
        }

        .info-card-title {
            color: #e91e63;
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .info-card-content {
            color: rgba(255, 255, 255, 0.85);
            font-size: 12px;
            line-height: 1.5;
        }

        .info-list {
            list-style: none;
            padding: 0;
        }

        .info-list li {
            padding: 6px 0;
            padding-left: 20px;
            position: relative;
            font-size: 12px;
            color: rgba(255, 255, 255, 0.8);
        }

        .info-list li:before {
            content: "→";
            position: absolute;
            left: 0;
            color: #e91e63;
        }

        /* Fun Fact Box */
        .fun-fact {
            background: linear-gradient(135deg, rgba(156, 39, 176, 0.1), rgba(233, 30, 99, 0.1));
            border: 1px solid rgba(156, 39, 176, 0.3);
            border-radius: 12px;
            padding: 14px;
            margin: 16px 0;
            position: relative;
            overflow: hidden;
        }

        .fun-fact:before {
            content: "🔬";
            position: absolute;
            top: -20px;
            right: -20px;
            font-size: 60px;
            opacity: 0.1;
        }

        .fun-fact-title {
            color: #9c27b0;
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 6px;
        }

        .fun-fact-text {
            color: rgba(255, 255, 255, 0.9);
            font-size: 12px;
            line-height: 1.5;
            position: relative;
            z-index: 1;
        }

        /* Voice Controls */
        .voice-controls {
            position: absolute;
            top: 10px;
            right: 20px;
            display: flex;
            gap: 8px;
            z-index: 1000;
        }

        .control-btn {
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            width: 44px;
            height: 44px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            position: relative;
        }

        .control-btn:hover {
            background: rgba(233, 30, 99, 0.3);
            border-color: #e91e63;
            transform: scale(1.1);
        }

        .control-btn.active {
            background: rgba(233, 30, 99, 0.4);
            border-color: #e91e63;
            box-shadow: 0 0 20px rgba(233, 30, 99, 0.5);
        }

        .control-tooltip {
            position: absolute;
            bottom: -30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9);
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 10px;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .control-btn:hover .control-tooltip {
            opacity: 1;
        }

        /* Loading Screen */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #e91e63 0%, #ad1457 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            transition: opacity 1s ease;
        }

        .loading-content {
            text-align: center;
        }

        .loading-biology {
            font-size: 60px;
            animation: bio-rotate 3s linear infinite;
            margin-bottom: 20px;
        }

        @keyframes bio-rotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            color: white;
            font-size: 20px;
            margin-bottom: 20px;
        }

        .loading-progress {
            width: 200px;
            height: 4px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 2px;
            overflow: hidden;
        }

        .loading-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #e91e63, #9c27b0);
            animation: loading 2s ease-in-out infinite;
        }

        @keyframes loading {
            0% { width: 0%; }
            50% { width: 100%; }
            100% { width: 0%; }
        }

        /* Voice Indicator */
        .voice-indicator {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(233, 30, 99, 0.5);
            border-radius: 30px;
            padding: 14px 28px;
            display: flex;
            align-items: center;
            gap: 12px;
            z-index: 1000;
            opacity: 0;
            transition: all 0.3s ease;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }

        .voice-indicator.visible {
            opacity: 1;
            transform: translateX(-50%) translateY(-10px);
        }

        .voice-waves {
            display: flex;
            align-items: center;
            gap: 3px;
        }

        .voice-wave {
            width: 3px;
            height: 20px;
            background: linear-gradient(180deg, #e91e63, #9c27b0);
            border-radius: 2px;
            animation: voice-wave 1s ease-in-out infinite;
        }

        .voice-wave:nth-child(2) { animation-delay: 0.1s; }
        .voice-wave:nth-child(3) { animation-delay: 0.2s; }
        .voice-wave:nth-child(4) { animation-delay: 0.3s; }
        .voice-wave:nth-child(5) { animation-delay: 0.4s; }

        @keyframes voice-wave {
            0%, 100% { transform: scaleY(0.3); }
            50% { transform: scaleY(1); }
        }

        .narration-text {
            color: white;
            font-size: 13px;
            max-width: 300px;
        }

        /* Quick Actions */
        .quick-actions {
            position: absolute;
            bottom: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            z-index: 1000;
        }

        .action-btn {
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 10px 16px;
            border-radius: 25px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
        }

        .action-btn:hover {
            background: rgba(233, 30, 99, 0.3);
            border-color: #e91e63;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(233, 30, 99, 0.3);
        }

        /* Custom Scrollbar */
        .info-panel::-webkit-scrollbar {
            width: 6px;
        }

        .info-panel::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 3px;
        }

        .info-panel::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, #e91e63, #9c27b0);
            border-radius: 3px;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .info-panel {
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                top: auto;
                width: 100%;
                max-height: 50vh;
                border-radius: 20px 20px 0 0;
            }
            
            .journey-navigation {
                bottom: 52vh;
                max-width: calc(100% - 40px);
            }
            
            .voice-controls {
                top: auto;
                bottom: 55vh;
                right: 10px;
            }
            
            .quick-actions {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="bg-animation"></div>

    <!-- Loading Screen -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-content">
            <div class="loading-biology">⚕️</div>
            <div class="loading-text">Preparing Your Biology Journey...</div>
            <div class="loading-progress">
                <div class="loading-progress-bar"></div>
            </div>
        </div>
    </div>

    <!-- Museum Header -->
    <div class="museum-header">
        <div class="museum-title">Female Reproductive System</div>
        <div class="exhibit-subtitle">
            <span class="bio-indicator"></span>
            The Biology of Human Reproduction
        </div>
    </div>

    <!-- Journey Navigation -->
    <div class="journey-navigation">
        <div class="journey-title">
            <span>⚕️</span>
            <span>Your Biology Journey</span>
        </div>
        <div class="journey-steps">
            <button class="journey-btn active" onclick="loadJourneyStep('anatomy')">
                <span>📋</span> Anatomy
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('ovary')">
                <span>🔬</span> Ovary
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('ovum')">
                <span>🥚</span> Ovum
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('uterus')">
                <span>🏠</span> Uterus
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('hormones')">
                <span>⚗️</span> Hormones
            </button>
        </div>
    </div>

    <!-- 3D Model Container -->
    <div class="model-container">
        <div class="sketchfab-embed-wrapper">
            <iframe id="api-frame"
                    title="Female Reproductive System Anatomy" 
                    frameborder="0" 
                    allowfullscreen 
                    mozallowfullscreen="true" 
                    webkitallowfullscreen="true" 
                    allow="autoplay; fullscreen; xr-spatial-tracking"
                    xr-spatial-tracking 
                    execution-while-out-of-viewport 
                    execution-while-not-rendered 
                    web-share 
                    src="https://sketchfab.com/models/445e5d3977d848419253a4058137555f/embed?autostart=1&internal=1&tracking=0&ui_ar=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0">
            </iframe>
        </div>
    </div>

    <!-- Information Panel -->
    <div class="info-panel" id="infoPanel">
        <div class="info-header">
            <div class="info-icon" id="stepIcon">📋</div>
            <div class="info-title">
                <h2 id="stepTitle">Female Reproductive Anatomy - System Overview</h2>
                <div class="info-subtitle" id="stepSubtitle">Understanding the structural organization</div>
            </div>
        </div>

        <!-- Progress Tracker -->
        <div class="progress-tracker">
            <div class="progress-header">
                <span>Learning Progress</span>
                <span class="progress-percentage" id="progressPercent">20%</span>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 20%"></div>
            </div>
            <div class="progress-steps-mini">
                <span class="step-mini active" onclick="loadJourneyStep('anatomy')">Anatomy</span>
                <span class="step-mini" onclick="loadJourneyStep('ovary')">Ovary</span>
                <span class="step-mini" onclick="loadJourneyStep('ovum')">Ovum</span>
                <span class="step-mini" onclick="loadJourneyStep('uterus')">Uterus</span>
                <span class="step-mini" onclick="loadJourneyStep('hormones')">Hormones</span>
            </div>
        </div>

        <div class="info-content" id="mainDescription">
            The female reproductive system is a sophisticated network of organs designed for producing eggs, supporting fertilization, and nurturing developing offspring. This anatomical overview reveals the complex interactions between hormones and structures that enable reproduction and regulate monthly cycles.
        </div>

        <div class="info-card">
            <div class="info-card-title">
                <span>🔬</span> Key Structures
            </div>
            <div class="info-card-content">
                <ul class="info-list" id="keyConcepts">
                    <li>Ovaries produce eggs and reproductive hormones</li>
                    <li>Fallopian tubes transport eggs and enable fertilization</li>
                    <li>Uterus provides environment for fetal development</li>
                    <li>Vagina serves as birth canal and reproductive tract</li>
                </ul>
            </div>
        </div>

        <div class="fun-fact">
            <div class="fun-fact-title">Scientific Fact!</div>
            <div class="fun-fact-text" id="funFact">
                A female is born with all the eggs she will ever have - approximately 1-2 million at birth, though only about 400,000 remain at puberty and only 400 will be ovulated during her reproductive years!
            </div>
        </div>

        <div class="info-card">
            <div class="info-card-title">
                <span>🎯</span> Learning Objectives
            </div>
            <div class="info-card-content" id="learningObjectives">
                Identify the major organs of the female reproductive system and understand their roles in egg production, fertilization, and supporting pregnancy.
            </div>
        </div>
    </div>

    <!-- Voice Controls -->
    <div class="voice-controls">
        <button class="control-btn active" id="voiceToggle" onclick="toggleVoice()">
            🔊
            <span class="control-tooltip">Voice Narration</span>
        </button>
        <button class="control-btn" onclick="toggleAutoPlay()">
            ▶️
            <span class="control-tooltip">Auto Journey</span>
        </button>
        <button class="control-btn" onclick="toggleInfo()">
            ℹ️
            <span class="control-tooltip">Toggle Info</span>
        </button>
    </div>

    <!-- Quick Actions -->
    <div class="quick-actions">
        <button class="action-btn" onclick="startGuidedTour()">
            <span>🚀</span> Guided Tour
        </button>
        <button class="action-btn" onclick="showQuiz()">
            <span>🎯</span> Test Knowledge
        </button>
    </div>

    <!-- Voice Indicator -->
    <div class="voice-indicator" id="voiceIndicator">
        <div class="voice-waves">
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
        </div>
        <div class="narration-text" id="narrationText">Narrating...</div>
    </div>

    <script>
        // Journey Step Data with Complete Pedagogical Content
        const JOURNEY_DATA = {
            anatomy: {
                title: "Female Reproductive Anatomy - System Overview",
                subtitle: "Understanding the structural organization",
                icon: "📋",
                modelUrl: "https://sketchfab.com/models/445e5d3977d848419253a4058137555f/embed?autostart=1&internal=1&tracking=0&ui_ar=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "The female reproductive system is a sophisticated network of organs designed for producing eggs, supporting fertilization, and nurturing developing offspring. This anatomical overview reveals the complex interactions between hormones and structures that enable reproduction and regulate monthly cycles.",
                concepts: [
                    "Ovaries produce eggs and reproductive hormones",
                    "Fallopian tubes transport eggs and enable fertilization",
                    "Uterus provides environment for fetal development",
                    "Vagina serves as birth canal and reproductive tract"
                ],
                funFact: "A female is born with all the eggs she will ever have - approximately 1-2 million at birth, though only about 400,000 remain at puberty and only 400 will be ovulated during her reproductive years!",
                objectives: "Identify the major organs of the female reproductive system and understand their roles in egg production, fertilization, and supporting pregnancy.",
                narration: "Welcome to the study of the female reproductive system! This anatomical model showcases the remarkable organization of organs that enable reproduction and support new life. The ovaries are the primary reproductive organs, containing thousands of developing eggs and producing essential hormones like estrogen and progesterone. The fallopian tubes extend from the ovaries toward the uterus, with finger-like projections called fimbriae that capture released eggs during ovulation. These tubes are where fertilization typically occurs if sperm are present. The uterus is a muscular organ with a thick lining called the endometrium that prepares monthly to receive a fertilized egg. If pregnancy occurs, the uterus expands dramatically to accommodate the growing fetus. The cervix acts as a gateway between the uterus and vagina, and the vagina serves multiple functions as the birth canal, menstrual flow pathway, and reproductive tract. This system demonstrates incredible biological complexity, with precise hormonal regulation coordinating monthly cycles and preparing for potential pregnancy."
            },
            ovary: {
                title: "Ovary Cross-Section - The Egg Production Center",
                subtitle: "Follicle development and ovulation",
                icon: "🔬",
                modelUrl: "https://sketchfab.com/models/4cf07df443874ff5989dd262f18c96e7/embed?autostart=1&internal=1&tracking=0&ui_ar=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "The ovary contains follicles at various stages of development, each housing an egg cell. This cross-section reveals the complex process of folliculogenesis and ovulation that occurs in monthly cycles throughout a woman's reproductive years.",
                concepts: [
                    "Primordial follicles contain immature eggs",
                    "Follicles develop through several maturation stages",
                    "Dominant follicle releases egg during ovulation",
                    "Corpus luteum forms after ovulation"
                ],
                funFact: "Each ovary is only about the size of an almond, yet it contains thousands of microscopic follicles, each with the potential to develop into a mature egg!",
                objectives: "Understand follicle development stages and the cyclical process of ovulation that characterizes female reproductive cycles.",
                narration: "Explore the intricate world inside the ovary - a remarkable organ that orchestrates egg development and hormone production! This cross-section reveals follicles at different stages of maturation. Starting with primordial follicles containing dormant eggs surrounded by a single layer of cells, development progresses through primary and secondary follicle stages as the egg grows and surrounding cells multiply. Each month, several follicles begin developing, but typically only one becomes the dominant follicle that will ovulate. The mature follicle, called a Graafian follicle, contains a fluid-filled space with the egg ready for release. During ovulation, the follicle ruptures, releasing the egg into the fallopian tube. The remaining follicle tissue transforms into the corpus luteum, which produces progesterone to support potential pregnancy. If pregnancy doesn't occur, the corpus luteum degenerates, hormone levels drop, and the cycle begins anew. This cyclical process demonstrates the ovary's dual role as both an egg bank and hormone factory, precisely timed to optimize chances for successful reproduction."
            },
            ovum: {
                title: "Ovum Structure - The Female Gamete",
                subtitle: "The largest human cell",
                icon: "🥚",
                modelUrl: "https://sketchfab.com/models/ba9d6e8282274de0b102ac4bfadc119e/embed?autostart=1&internal=1&tracking=0&ui_ar=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "The ovum, or egg cell, is the female gamete containing half the genetic material needed for reproduction. This remarkable cell is equipped with everything necessary to support early embryonic development if fertilization occurs.",
                concepts: [
                    "Contains 23 chromosomes (haploid nucleus)",
                    "Surrounded by protective zona pellucida",
                    "Corona radiata provides additional protection",
                    "Cytoplasm rich in nutrients and organelles"
                ],
                funFact: "The human egg is the largest cell in the human body - about 0.1mm in diameter, which is just barely visible to the naked eye and about 16 times larger than a sperm cell!",
                objectives: "Examine ovum structure and understand how this cell is specialized for reproduction and early embryonic support.",
                narration: "Behold the ovum - the magnificent female gamete that represents half of the genetic equation for new life! This spherical cell is truly remarkable, being the largest cell in the human body. The nucleus contains 23 chromosomes, each carrying unique genetic combinations created through meiosis, ensuring genetic diversity in potential offspring. The egg is surrounded by a transparent protective layer called the zona pellucida, which prevents multiple sperm from fertilizing the same egg and helps guide sperm binding during fertilization. Outside this is the corona radiata, a layer of follicle cells that nourish and protect the egg. The egg's cytoplasm is packed with nutrients, proteins, organelles, and chemical signals that will support the earliest stages of embryonic development. Unlike sperm, which are built for mobility, eggs are designed as nutrient-rich cellular environments. When fertilization occurs, the egg contributes not only genetic material but also the cellular machinery and energy stores needed to begin the incredible journey of creating a new organism. This cellular specialization demonstrates evolution's solution for providing the optimal environment for reproduction and early development."
            },
            uterus: {
                title: "Uterus Cross-Section - The Nurturing Environment",
                subtitle: "Menstrual cycle and pregnancy support",
                icon: "🏠",
                modelUrl: "https://sketchfab.com/models/1442e6028f894db79eb4f3820177c69e/embed?autostart=1&internal=1&tracking=0&ui_ar=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "The uterus is a muscular organ with a dynamic lining that changes throughout the menstrual cycle. This cross-section shows the endometrium's layers and demonstrates how the uterus prepares monthly for potential pregnancy.",
                concepts: [
                    "Endometrium thickens during menstrual cycle",
                    "Myometrium provides muscular contractions",
                    "Three layers: perimetrium, myometrium, endometrium",
                    "Cervix connects uterus to vagina"
                ],
                funFact: "During pregnancy, the uterus expands from the size of a pear to accommodate a full-term baby - increasing in volume by about 500 times while the muscle fibers stretch to 10 times their original length!",
                objectives: "Understand uterine structure and function, including the menstrual cycle and adaptations for pregnancy.",
                narration: "Discover the uterus - nature's most adaptable organ, designed to nurture new life! This cross-section reveals the uterus's three distinct layers, each with specialized functions. The outer perimetrium provides protective covering, while the thick middle layer, the myometrium, consists of smooth muscle that will contract during labor to deliver a baby. The inner endometrium is where the magic happens - this lining undergoes dramatic monthly changes during the menstrual cycle. Under the influence of estrogen, the endometrium thickens with blood vessels, glands, and nutrients, preparing a hospitable environment for a fertilized egg. If pregnancy occurs, the endometrium supports the developing embryo and contributes to placenta formation. If pregnancy doesn't happen, hormone levels drop, causing the endometrium to shed during menstruation, and the cycle begins anew. The cervix at the bottom of the uterus acts as a selective barrier, remaining tightly closed except during ovulation when it opens slightly to allow sperm passage, and during childbirth when it dilates completely. This remarkable organ demonstrates the female body's incredible ability to cyclically prepare for reproduction while maintaining the flexibility to support nine months of fetal development."
            },
            hormones: {
                title: "Estrogen - The Female Hormone",
                subtitle: "Hormonal regulation of reproduction",
                icon: "⚗️",
                modelUrl: "https://sketchfab.com/models/c4d9a91436854b78b3a0c017fb639bd8/embed?autostart=1&internal=1&tracking=0&ui_ar=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "Estrogen is the primary female sex hormone responsible for developing and maintaining female characteristics, regulating the menstrual cycle, and coordinating reproductive function through complex interactions with other hormones.",
                concepts: [
                    "Produced primarily by ovarian follicles",
                    "Regulates menstrual cycle and ovulation",
                    "Develops secondary sexual characteristics",
                    "Works with progesterone in reproductive cycles"
                ],
                funFact: "Estrogen levels can fluctuate dramatically during the menstrual cycle - rising 10-fold from the lowest point just after menstruation to peak levels just before ovulation!",
                objectives: "Understand estrogen's molecular structure and its central role in female reproductive physiology and development.",
                narration: "Welcome to the molecular world of estrogen - the hormone that orchestrates female reproductive function! This steroid hormone, produced mainly by developing follicles in the ovaries, plays a central role in virtually every aspect of female reproductive biology. Estrogen's molecular structure allows it to easily enter target cells and bind to estrogen receptors, where it regulates the expression of hundreds of genes. During puberty, rising estrogen levels trigger the development of secondary sexual characteristics and establish regular menstrual cycles. Throughout the reproductive years, estrogen levels rise and fall in monthly patterns, stimulating endometrial growth in the first half of the menstrual cycle and working with progesterone in the second half. Estrogen also affects bone density, cardiovascular health, and brain function. The hormone's production is controlled by the hypothalamic-pituitary-ovarian axis, creating feedback loops that maintain hormonal balance. When estrogen levels peak just before ovulation, they trigger the release of luteinizing hormone, which causes ovulation. This precise hormonal choreography ensures that reproductive processes are perfectly timed and coordinated, demonstrating the elegant complexity of female reproductive endocrinology."
            }
        };

        // Global Variables
        let currentStep = 'anatomy';
        let voiceEnabled = true;
        let autoPlayEnabled = false;
        let currentSpeech = null;
        let selectedVoice = null;
        let journeyProgress = 0;
        let guidedTourActive = false;

        // Initialize Voice System
        function initVoiceSystem() {
            if (!('speechSynthesis' in window)) {
                console.warn('Speech synthesis not supported');
                voiceEnabled = false;
                document.getElementById('voiceToggle').style.display = 'none';
                return;
            }

            function loadVoices() {
                const voices = speechSynthesis.getVoices();
                if (voices.length === 0) return;

                // Prefer natural-sounding voices
                const preferredVoices = [
                    'Google UK English Female',
                    'Microsoft Sonia',
                    'Microsoft Hazel',
                    'Samantha',
                    'Victoria'
                ];

                for (const name of preferredVoices) {
                    selectedVoice = voices.find(v => v.name.includes(name));
                    if (selectedVoice) break;
                }

                if (!selectedVoice) {
                    selectedVoice = voices.find(v => v.lang.startsWith('en'));
                }
            }

            loadVoices();
            if (speechSynthesis.onvoiceschanged !== undefined) {
                speechSynthesis.onvoiceschanged = loadVoices;
            }
        }

        // Load Journey Step
        function loadJourneyStep(stepId) {
            const stepData = JOURNEY_DATA[stepId];
            if (!stepData) return;

            currentStep = stepId;
            
            // Update model
            document.getElementById('api-frame').src = stepData.modelUrl;
            
            // Update info panel
            document.getElementById('stepIcon').textContent = stepData.icon;
            document.getElementById('stepTitle').textContent = stepData.title;
            document.getElementById('stepSubtitle').textContent = stepData.subtitle;
            document.getElementById('mainDescription').textContent = stepData.description;
            
            // Update key concepts
            const conceptsList = document.getElementById('keyConcepts');
            conceptsList.innerHTML = stepData.concepts.map(c => `<li>${c}</li>`).join('');
            
            // Update fun fact
            document.getElementById('funFact').textContent = stepData.funFact;
            
            // Update learning objectives
            document.getElementById('learningObjectives').textContent = stepData.objectives;
            
            // Update navigation buttons
            updateNavigationButtons(stepId);
            
            // Update progress
            updateProgress();
            
            // Play narration if enabled
            if (voiceEnabled) {
                speakText(stepData.narration);
            }
        }

        // Update Navigation Buttons
        function updateNavigationButtons(activeStep) {
            const buttons = document.querySelectorAll('.journey-btn');
            const steps = ['anatomy', 'ovary', 'ovum', 'uterus', 'hormones'];
            const activeIndex = steps.indexOf(activeStep);
            
            buttons.forEach((btn, index) => {
                btn.classList.remove('active', 'completed');
                if (index < activeIndex) {
                    btn.classList.add('completed');
                } else if (index === activeIndex) {
                    btn.classList.add('active');
                }
            });
            
            // Update mini steps
            const miniSteps = document.querySelectorAll('.step-mini');
            miniSteps.forEach((step, index) => {
                step.classList.remove('active', 'completed');
                if (index < activeIndex) {
                    step.classList.add('completed');
                } else if (index === activeIndex) {
                    step.classList.add('active');
                }
            });
        }

        // Update Progress
        function updateProgress() {
            const steps = ['anatomy', 'ovary', 'ovum', 'uterus', 'hormones'];
            const currentIndex = steps.indexOf(currentStep);
            const progress = ((currentIndex + 1) / steps.length) * 100;
            
            document.getElementById('progressPercent').textContent = Math.round(progress) + '%';
            document.getElementById('progressFill').style.width = progress + '%';
        }

        // Speech Functions
        function speakText(text) {
            if (!voiceEnabled || !text) return;
            
            stopSpeech();
            
            currentSpeech = new SpeechSynthesisUtterance(text);
            if (selectedVoice) {
                currentSpeech.voice = selectedVoice;
            }
            currentSpeech.rate = 0.9;
            currentSpeech.pitch = 1.0;
            currentSpeech.volume = 0.9;
            
            currentSpeech.onstart = () => {
                document.getElementById('voiceIndicator').classList.add('visible');
                document.getElementById('narrationText').textContent = 
                    text.substring(0, 50) + (text.length > 50 ? '...' : '');
            };
            
            currentSpeech.onend = () => {
                document.getElementById('voiceIndicator').classList.remove('visible');
                currentSpeech = null;
                
                // Auto-advance if guided tour is active
                if (guidedTourActive) {
                    setTimeout(nextStep, 2000);
                }
            };
            
            speechSynthesis.speak(currentSpeech);
        }

        function stopSpeech() {
            if (currentSpeech) {
                speechSynthesis.cancel();
                currentSpeech = null;
                document.getElementById('voiceIndicator').classList.remove('visible');
            }
        }

        // Control Functions
        function toggleVoice() {
            voiceEnabled = !voiceEnabled;
            const btn = document.getElementById('voiceToggle');
            btn.textContent = voiceEnabled ? '🔊' : '🔇';
            btn.classList.toggle('active', voiceEnabled);
            
            if (!voiceEnabled) {
                stopSpeech();
            }
        }

        function toggleAutoPlay() {
            autoPlayEnabled = !autoPlayEnabled;
            if (autoPlayEnabled) {
                startGuidedTour();
            } else {
                guidedTourActive = false;
            }
        }

        function toggleInfo() {
            const panel = document.getElementById('infoPanel');
            panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
        }

        // Guided Tour
        function startGuidedTour() {
            guidedTourActive = true;
            const steps = ['anatomy', 'ovary', 'ovum', 'uterus', 'hormones'];
            let stepIndex = 0;
            
            function tourStep() {
                if (stepIndex < steps.length && guidedTourActive) {
                    loadJourneyStep(steps[stepIndex]);
                    stepIndex++;
                } else {
                    guidedTourActive = false;
                    if (voiceEnabled) {
                        speakText("You have completed your educational journey through the female reproductive system. You now understand the anatomy, cyclical processes, and hormonal regulation that enable human reproduction and support new life!");
                    }
                }
            }
            
            tourStep();
            window.nextStep = tourStep;
        }

        // Quiz Function
        function showQuiz() {
            const questions = [
                "What are the main functions of the ovaries in reproduction?",
                "How does the menstrual cycle prepare the body for pregnancy?",
                "What role do hormones play in female reproductive cycles?",
                "How is the egg cell specialized for reproduction?",
                "What changes occur in the uterus during the menstrual cycle?"
            ];
            
            const randomQ = questions[Math.floor(Math.random() * questions.length)];
            
            if (voiceEnabled) {
                speakText(`Here's a question to test your biological knowledge: ${randomQ} Consider what you've learned about female reproductive biology!`);
            }
        }

        // Initialize
        function init() {
            initVoiceSystem();
            
            // Hide loading screen
            setTimeout(() => {
                const loading = document.getElementById('loadingOverlay');
                loading.style.opacity = '0';
                setTimeout(() => {
                    loading.style.display = 'none';
                    
                    // Welcome message
                    if (voiceEnabled) {
                        speakText("Welcome to your educational journey through the female reproductive system! We'll explore the anatomy, cyclical processes, and hormonal mechanisms that enable reproduction and support new life. Let's begin with an overview of the system's organization!");
                    }
                }, 1000);
            }, 3000);
            
            // Keyboard shortcuts
            document.addEventListener('keydown', (e) => {
                switch(e.key) {
                    case 'v': toggleVoice(); break;
                    case 'i': toggleInfo(); break;
                    case 'g': startGuidedTour(); break;
                    case 'Escape': stopSpeech(); guidedTourActive = false; break;
                    case 'ArrowRight': nextStep && nextStep(); break;
                }
            });
        }

        // Start the application
        init();
    </script>
</body>
</html>