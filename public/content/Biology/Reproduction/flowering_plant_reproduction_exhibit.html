<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sexual Reproduction in Flowering Plants - The Botanical Journey</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tween.js/18.6.4/tween.umd.js"></script>

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
            color: white;
            overflow: hidden;
            position: relative;
            height: 100vh;
        }

        /* Animated Background */
        .bg-animation {
            position: fixed;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: 0;
            opacity: 0.1;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 320"><path fill="%23ffffff" fill-opacity="0.2" d="M0,96L48,112C96,128,192,160,288,186.7C384,213,480,235,576,213.3C672,192,768,128,864,128C960,128,1056,192,1152,197.3C1248,203,1344,149,1392,122.7L1440,96L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z"></path></svg>') repeat-x;
            animation: wave 12s linear infinite;
        }

        @keyframes wave {
            0% { background-position-x: 0; }
            100% { background-position-x: 1440px; }
        }

        /* Museum Interface - Compact Header */
        .museum-header {
            position: absolute;
            top: 10px;
            left: 20px;
            text-align: left;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            padding: 10px 18px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .museum-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 4px;
            background: linear-gradient(45deg, #27ae60, #f39c12);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: titleGlow 3s ease-in-out infinite;
        }

        @keyframes titleGlow {
            0%, 100% { filter: brightness(1); }
            50% { filter: brightness(1.2); }
        }

        .exhibit-subtitle {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.8);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .flower-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            background: #f39c12;
            border-radius: 50%;
            animation: bloom-pulse 2s ease-in-out infinite;
        }

        @keyframes bloom-pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.3); opacity: 0.7; }
        }

        /* Journey Navigation - Enhanced */
        .journey-navigation {
            position: absolute;
            bottom: 20px;
            left: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            padding: 15px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            max-width: 300px;
        }

        .journey-title {
            font-size: 14px;
            font-weight: 600;
            color: #27ae60;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .journey-steps {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }

        .journey-btn {
            background: rgba(39, 174, 96, 0.2);
            border: 1px solid rgba(39, 174, 96, 0.4);
            color: white;
            padding: 6px 10px;
            border-radius: 20px;
            font-size: 11px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 4px;
            white-space: nowrap;
        }

        .journey-btn:hover {
            background: rgba(39, 174, 96, 0.3);
            border-color: #27ae60;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(39, 174, 96, 0.3);
        }

        .journey-btn.active {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            border-color: #27ae60;
            box-shadow: 0 0 20px rgba(39, 174, 96, 0.5);
            animation: pulse 2s infinite;
        }

        .journey-btn.completed {
            background: rgba(243, 156, 18, 0.3);
            border-color: #f39c12;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        /* 3D Model Container */
        .model-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 0;
            overflow: hidden;
            border: none;
            z-index: 100;
        }

        .sketchfab-embed-wrapper {
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
        }

        .sketchfab-embed-wrapper iframe {
            width: 100%;
            height: 100%;
            border: none;
            border-radius: 0;
        }

        /* Information Panel - Enhanced */
        .info-panel {
            position: absolute;
            top: 70px;
            right: 20px;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(25px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 16px;
            padding: 24px;
            width: 380px;
            max-height: calc(100vh - 140px);
            z-index: 800;
            overflow-y: auto;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }

        .info-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        }

        .info-icon {
            font-size: 28px;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        .info-title {
            flex: 1;
        }

        .info-title h2 {
            font-size: 18px;
            color: #27ae60;
            margin-bottom: 4px;
        }

        .info-subtitle {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.7);
        }

        .info-content {
            color: rgba(255, 255, 255, 0.9);
            font-size: 14px;
            line-height: 1.6;
        }

        /* Progress Tracker */
        .progress-tracker {
            background: linear-gradient(135deg, rgba(39, 174, 96, 0.1), rgba(243, 156, 18, 0.1));
            border: 1px solid rgba(39, 174, 96, 0.3);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 20px;
        }

        .progress-header {
            font-size: 13px;
            font-weight: 600;
            color: #27ae60;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .progress-percentage {
            font-size: 18px;
            color: #f39c12;
            font-weight: 700;
        }

        .progress-bar {
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 12px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #27ae60, #f39c12);
            border-radius: 4px;
            transition: width 0.8s ease;
            box-shadow: 0 0 10px rgba(39, 174, 96, 0.5);
        }

        .progress-steps-mini {
            display: flex;
            justify-content: space-between;
            font-size: 9px;
            color: rgba(255, 255, 255, 0.6);
        }

        .step-mini {
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .step-mini.active {
            color: #27ae60;
            font-weight: 600;
        }

        .step-mini.completed {
            color: #f39c12;
        }

        /* Information Cards */
        .info-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 14px;
            margin-bottom: 14px;
        }

        .info-card-title {
            color: #27ae60;
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .info-card-content {
            color: rgba(255, 255, 255, 0.85);
            font-size: 12px;
            line-height: 1.5;
        }

        .info-list {
            list-style: none;
            padding: 0;
        }

        .info-list li {
            padding: 6px 0;
            padding-left: 20px;
            position: relative;
            font-size: 12px;
            color: rgba(255, 255, 255, 0.8);
        }

        .info-list li:before {
            content: "🌱";
            position: absolute;
            left: 0;
            font-size: 10px;
        }

        /* Fun Fact Box */
        .fun-fact {
            background: linear-gradient(135deg, rgba(243, 156, 18, 0.1), rgba(39, 174, 96, 0.1));
            border: 1px solid rgba(243, 156, 18, 0.3);
            border-radius: 12px;
            padding: 14px;
            margin: 16px 0;
            position: relative;
            overflow: hidden;
        }

        .fun-fact:before {
            content: "🌻";
            position: absolute;
            top: -20px;
            right: -20px;
            font-size: 60px;
            opacity: 0.1;
        }

        .fun-fact-title {
            color: #f39c12;
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 6px;
        }

        .fun-fact-text {
            color: rgba(255, 255, 255, 0.9);
            font-size: 12px;
            line-height: 1.5;
            position: relative;
            z-index: 1;
        }

        /* Voice Controls */
        .voice-controls {
            position: absolute;
            top: 10px;
            right: 20px;
            display: flex;
            gap: 8px;
            z-index: 1000;
        }

        .control-btn {
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            width: 44px;
            height: 44px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            position: relative;
        }

        .control-btn:hover {
            background: rgba(39, 174, 96, 0.3);
            border-color: #27ae60;
            transform: scale(1.1);
        }

        .control-btn.active {
            background: rgba(39, 174, 96, 0.4);
            border-color: #27ae60;
            box-shadow: 0 0 20px rgba(39, 174, 96, 0.5);
        }

        .control-tooltip {
            position: absolute;
            bottom: -30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9);
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 10px;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .control-btn:hover .control-tooltip {
            opacity: 1;
        }

        /* Loading Screen */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            transition: opacity 1s ease;
        }

        .loading-content {
            text-align: center;
        }

        .loading-flower {
            font-size: 60px;
            animation: bloom 3s ease-in-out infinite;
            margin-bottom: 20px;
        }

        @keyframes bloom {
            0%, 100% { transform: scale(1) rotate(0deg); }
            50% { transform: scale(1.2) rotate(180deg); }
        }

        .loading-text {
            color: white;
            font-size: 20px;
            margin-bottom: 20px;
        }

        .loading-progress {
            width: 200px;
            height: 4px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 2px;
            overflow: hidden;
        }

        .loading-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #27ae60, #f39c12);
            animation: loading 2s ease-in-out infinite;
        }

        @keyframes loading {
            0% { width: 0%; }
            50% { width: 100%; }
            100% { width: 0%; }
        }

        /* Voice Indicator */
        .voice-indicator {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(39, 174, 96, 0.5);
            border-radius: 30px;
            padding: 14px 28px;
            display: flex;
            align-items: center;
            gap: 12px;
            z-index: 1000;
            opacity: 0;
            transition: all 0.3s ease;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }

        .voice-indicator.visible {
            opacity: 1;
            transform: translateX(-50%) translateY(-10px);
        }

        .voice-waves {
            display: flex;
            align-items: center;
            gap: 3px;
        }

        .voice-wave {
            width: 3px;
            height: 20px;
            background: linear-gradient(180deg, #27ae60, #f39c12);
            border-radius: 2px;
            animation: voice-wave 1s ease-in-out infinite;
        }

        .voice-wave:nth-child(2) { animation-delay: 0.1s; }
        .voice-wave:nth-child(3) { animation-delay: 0.2s; }
        .voice-wave:nth-child(4) { animation-delay: 0.3s; }
        .voice-wave:nth-child(5) { animation-delay: 0.4s; }

        @keyframes voice-wave {
            0%, 100% { transform: scaleY(0.3); }
            50% { transform: scaleY(1); }
        }

        .narration-text {
            color: white;
            font-size: 13px;
            max-width: 300px;
        }

        /* Quick Actions */
        .quick-actions {
            position: absolute;
            bottom: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            z-index: 1000;
        }

        .action-btn {
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 10px 16px;
            border-radius: 25px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
        }

        .action-btn:hover {
            background: rgba(39, 174, 96, 0.3);
            border-color: #27ae60;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(39, 174, 96, 0.3);
        }

        /* Custom Scrollbar */
        .info-panel::-webkit-scrollbar {
            width: 6px;
        }

        .info-panel::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 3px;
        }

        .info-panel::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, #27ae60, #f39c12);
            border-radius: 3px;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .info-panel {
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                top: auto;
                width: 100%;
                max-height: 50vh;
                border-radius: 20px 20px 0 0;
            }
            
            .journey-navigation {
                bottom: 52vh;
                max-width: calc(100% - 40px);
            }
            
            .voice-controls {
                top: auto;
                bottom: 55vh;
                right: 10px;
            }
            
            .quick-actions {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="bg-animation"></div>

    <!-- Loading Screen -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-content">
            <div class="loading-flower">🌸</div>
            <div class="loading-text">Preparing Your Botanical Journey...</div>
            <div class="loading-progress">
                <div class="loading-progress-bar"></div>
            </div>
        </div>
    </div>

    <!-- Museum Header -->
    <div class="museum-header">
        <div class="museum-title">Sexual Reproduction in Plants</div>
        <div class="exhibit-subtitle">
            <span class="flower-indicator"></span>
            The Botanical Reproduction Story
        </div>
    </div>

    <!-- Journey Navigation -->
    <div class="journey-navigation">
        <div class="journey-title">
            <span>🌺</span>
            <span>Your Botanical Journey</span>
        </div>
        <div class="journey-steps">
            <button class="journey-btn active" onclick="loadJourneyStep('flower')">
                <span>🌸</span> Flower Structure
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('plant')">
                <span>🌿</span> Flowering Plant
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('pollen')">
                <span>✨</span> Pollen
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('seed')">
                <span>🌱</span> Seed Formation
            </button>
            <button class="journey-btn" onclick="loadJourneyStep('varieties')">
                <span>🌺</span> Flower Varieties
            </button>
        </div>
    </div>

    <!-- 3D Model Container -->
    <div class="model-container">
        <div class="sketchfab-embed-wrapper">
            <iframe id="api-frame"
                    title="Flower Anatomy Model" 
                    frameborder="0" 
                    allowfullscreen 
                    mozallowfullscreen="true" 
                    webkitallowfullscreen="true" 
                    allow="autoplay; fullscreen; xr-spatial-tracking"
                    xr-spatial-tracking 
                    execution-while-out-of-viewport 
                    execution-while-not-rendered 
                    web-share 
                    src="https://sketchfab.com/3d-models/anatomy-of-a-flower-4ce0afd091d742e286a0de156e183d95/embed?autostart=1&internal=1&tracking=0&ui_ar=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0">
            </iframe>
        </div>
    </div>

    <!-- Information Panel -->
    <div class="info-panel" id="infoPanel">
        <div class="info-header">
            <div class="info-icon" id="stepIcon">🌸</div>
            <div class="info-title">
                <h2 id="stepTitle">Flower Structure - Nature's Reproductive Engine</h2>
                <div class="info-subtitle" id="stepSubtitle">Understanding floral anatomy</div>
            </div>
        </div>

        <!-- Progress Tracker -->
        <div class="progress-tracker">
            <div class="progress-header">
                <span>Journey Progress</span>
                <span class="progress-percentage" id="progressPercent">20%</span>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 20%"></div>
            </div>
            <div class="progress-steps-mini">
                <span class="step-mini active" onclick="loadJourneyStep('flower')">Flower</span>
                <span class="step-mini" onclick="loadJourneyStep('plant')">Plant</span>
                <span class="step-mini" onclick="loadJourneyStep('pollen')">Pollen</span>
                <span class="step-mini" onclick="loadJourneyStep('seed')">Seed</span>
                <span class="step-mini" onclick="loadJourneyStep('varieties')">Varieties</span>
            </div>
        </div>

        <div class="info-content" id="mainDescription">
            Flowers are nature's most sophisticated reproductive structures, perfectly designed to ensure successful pollination and fertilization. This longitudinal section reveals the intricate arrangement of male and female reproductive organs working together to create the next generation of plants.
        </div>

        <div class="info-card">
            <div class="info-card-title">
                <span>🔬</span> Key Components
            </div>
            <div class="info-card-content">
                <ul class="info-list" id="keyConcepts">
                    <li>Sepals protect the developing flower bud</li>
                    <li>Petals attract pollinators with color and scent</li>
                    <li>Stamens produce pollen (male gametes)</li>
                    <li>Pistil contains ovules (female gametes)</li>
                </ul>
            </div>
        </div>

        <div class="fun-fact">
            <div class="fun-fact-title">Botanical Wonder!</div>
            <div class="fun-fact-text" id="funFact">
                Some flowers can live for just one day, while others can bloom for several months. The corpse flower blooms only once every 7-10 years and can grow up to 10 feet tall!
            </div>
        </div>

        <div class="info-card">
            <div class="info-card-title">
                <span>🎯</span> Learning Objectives
            </div>
            <div class="info-card-content" id="learningObjectives">
                Identify the parts of a flower and understand how each component contributes to successful sexual reproduction in flowering plants.
            </div>
        </div>
    </div>

    <!-- Voice Controls -->
    <div class="voice-controls">
        <button class="control-btn active" id="voiceToggle" onclick="toggleVoice()">
            🔊
            <span class="control-tooltip">Voice Narration</span>
        </button>
        <button class="control-btn" onclick="toggleAutoPlay()">
            ▶️
            <span class="control-tooltip">Auto Journey</span>
        </button>
        <button class="control-btn" onclick="toggleInfo()">
            ℹ️
            <span class="control-tooltip">Toggle Info</span>
        </button>
    </div>

    <!-- Quick Actions -->
    <div class="quick-actions">
        <button class="action-btn" onclick="startGuidedTour()">
            <span>🚀</span> Guided Tour
        </button>
        <button class="action-btn" onclick="showQuiz()">
            <span>🎯</span> Test Knowledge
        </button>
    </div>

    <!-- Voice Indicator -->
    <div class="voice-indicator" id="voiceIndicator">
        <div class="voice-waves">
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
            <div class="voice-wave"></div>
        </div>
        <div class="narration-text" id="narrationText">Narrating...</div>
    </div>

    <script>
        // Journey Step Data with Complete Pedagogical Content
        const JOURNEY_DATA = {
            flower: {
                title: "Flower Structure - Nature's Reproductive Engine",
                subtitle: "Understanding floral anatomy",
                icon: "🌸",
                modelUrl: "https://sketchfab.com/3d-models/anatomy-of-a-flower-4ce0afd091d742e286a0de156e183d95/embed?autostart=1&internal=1&tracking=0&ui_ar=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "Flowers are nature's most sophisticated reproductive structures, perfectly designed to ensure successful pollination and fertilization. This longitudinal section reveals the intricate arrangement of male and female reproductive organs working together to create the next generation of plants.",
                concepts: [
                    "Sepals protect the developing flower bud",
                    "Petals attract pollinators with color and scent",
                    "Stamens produce pollen (male gametes)",
                    "Pistil contains ovules (female gametes)"
                ],
                funFact: "Some flowers can live for just one day, while others can bloom for several months. The corpse flower blooms only once every 7-10 years and can grow up to 10 feet tall!",
                objectives: "Identify the parts of a flower and understand how each component contributes to successful sexual reproduction in flowering plants.",
                narration: "Welcome to the intricate world of flower anatomy! This cross-section reveals nature's reproductive masterpiece. Starting from the outside, we see the sepals - the green, leaf-like structures that protected the flower when it was just a bud. Moving inward, the colorful petals serve as nature's advertisement, using vibrant colors, patterns, and sweet fragrances to attract pollinators like bees, butterflies, and birds. At the center, we find the reproductive organs. The stamens are the male parts, consisting of the anther, which produces pollen, and the filament that holds it up. The pistil is the female organ, with the stigma at the top to catch pollen, the style as a tube leading down to the ovary, which contains the ovules or eggs. This perfect arrangement ensures that when a pollinator visits for nectar, it gets dusted with pollen and transfers it to other flowers, enabling cross-pollination and genetic diversity in plant populations."
            },
            plant: {
                title: "Complete Flowering Plant - The Full Picture",
                subtitle: "From roots to flowers",
                icon: "🌿",
                modelUrl: "https://sketchfab.com/3d-models/flowering-plant-free-c129fa5f64cb4ca98ea92f1d5856b1e4/embed?autostart=1&internal=1&tracking=0&ui_ar=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "A complete flowering plant shows how all parts work together to support reproduction. The roots anchor and nourish, the stem provides support and transport, leaves photosynthesize to provide energy, and flowers handle the crucial task of sexual reproduction.",
                concepts: [
                    "Roots absorb water and nutrients from soil",
                    "Stems transport materials and provide structural support",
                    "Leaves carry out photosynthesis for energy",
                    "Flowers are specialized reproductive structures"
                ],
                funFact: "The largest flower in the world belongs to Rafflesia arnoldii and can measure over 3 feet across, while the smallest flowers are found on duckweed plants and are less than 1mm wide!",
                objectives: "Understand how the entire plant body supports the reproductive function and appreciate the integration of plant systems.",
                narration: "Here's the complete picture of a flowering plant, showing how every part contributes to successful reproduction! The root system below ground is like the plant's foundation and plumbing - absorbing water and essential nutrients from the soil. These roots also anchor the plant firmly in place. The stem acts as both the plant's skeleton, providing structural support, and its highway system, transporting water and nutrients up from the roots and sugars down from the leaves. The green leaves are the plant's solar panels, capturing sunlight and converting carbon dioxide and water into glucose through photosynthesis. This process provides all the energy the plant needs for growth and reproduction. Finally, we see the flowers at the top - the plant's reproductive centers. Everything the plant does throughout its life builds up to this moment of flowering, when it can reproduce and pass its genes to the next generation. It's a perfect example of how form follows function in nature, with each part specialized for its role in keeping the plant alive and reproducing successfully."
            },
            pollen: {
                title: "Pollen Grains - Male Gametes in Action",
                subtitle: "Microscopic messengers of life",
                icon: "✨",
                modelUrl: "https://sketchfab.com/models/0389ba00c29248a8933f576d1cfacf88/embed?autostart=1&internal=1&tracking=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_watermark=0",
                description: "Pollen grains are microscopic structures that carry the male genetic material in flowering plants. Each grain is a marvel of biological engineering, designed to survive the journey from one flower to another and deliver sperm cells for fertilization.",
                concepts: [
                    "Contains two sperm cells and one tube cell",
                    "Protected by a tough outer wall (exine)",
                    "Species-specific shapes aid in identification",
                    "Can be dispersed by wind, water, or animals"
                ],
                funFact: "A single ragweed plant can produce over 1 billion pollen grains in a season! Pollen grains are so distinctive that forensic scientists can use them to solve crimes by determining where someone has been.",
                objectives: "Explore pollen grain structure and understand their role in plant reproduction and pollination strategies.",
                narration: "Zoom into the microscopic world of pollen grains - nature's tiny genetic delivery vehicles! These remarkable structures may be small, but they're incredibly sophisticated. Each pollen grain is protected by one of the toughest biological materials known - the exine wall. This outer layer is so durable that pollen grains can survive for thousands of years, which is why paleontologists use them to study ancient climates and vegetation. Inside this protective shell are three cells: two sperm cells that will fertilize the egg, and one tube cell that will grow into a pollen tube to deliver the sperm. The surface of pollen grains is beautifully sculpted with species-specific patterns - spikes, ridges, and pores that help scientists identify different plant species. These patterns also help the pollen stick to pollinators or catch the wind. When a pollen grain lands on a compatible stigma, it begins an amazing transformation. The tube cell grows into a long tube that burrows down through the style to reach the ovule, creating a pathway for the sperm cells to complete fertilization. It's like nature's version of a guided missile, precisely delivering genetic material to create the next generation!"
            },
            seed: {
                title: "Seed Structure - The Next Generation",
                subtitle: "From fertilization to dispersal",
                icon: "🌱",
                modelUrl: "https://sketchfab.com/models/b033fe7d469d4469a9214faacf509ece/embed?autostart=1&internal=1&tracking=0&ui_ar=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "Seeds are the successful result of sexual reproduction in flowering plants. Each seed contains a plant embryo, stored nutrients, and protective coverings - everything needed to start a new life when conditions are right for germination.",
                concepts: [
                    "Embryo contains the future plant's basic parts",
                    "Endosperm provides stored nutrients for growth",
                    "Seed coat protects against damage and drying",
                    "Seeds can remain dormant until favorable conditions"
                ],
                funFact: "The oldest viable seeds ever discovered were 32,000-year-old arctic lupine seeds found in permafrost! When planted, they successfully grew into healthy plants.",
                objectives: "Understand seed structure and function, and appreciate how seeds enable plant survival and dispersal strategies.",
                narration: "Behold the seed - the ultimate success story of plant sexual reproduction! This cross-section reveals the intricate packaging that protects and nourishes the next generation. At the center is the embryo, a miniature plant complete with the beginnings of roots, stem, and leaves. This tiny plant is the result of successful fertilization when male and female gametes united. Surrounding the embryo is the endosperm, a nutritious tissue packed with starches, proteins, and oils that will feed the developing seedling until it can make its own food through photosynthesis. The outer seed coat is a tough, protective barrier that shields the precious contents from harsh environmental conditions, predators, and desiccation. Seeds are survival time capsules that can remain dormant for years, decades, or even centuries until the perfect conditions trigger germination. Different seeds have evolved amazing dispersal strategies - some have wings for wind dispersal, others have hooks for animal transport, and some are even designed to float across oceans. When you think about it, every plant around us started as a seed, carrying the genetic information from two parent plants and representing the successful completion of the sexual reproduction cycle."
            },
            varieties: {
                title: "Flower Diversity - Evolutionary Adaptations",
                subtitle: "Sweet pea flower variations",
                icon: "🌺",
                modelUrl: "https://sketchfab.com/3d-models/sweet-pea-2908-0047ddf99ccd4f668eb176ac77bbba6d/embed?autostart=1&internal=1&tracking=0&ui_ar=0&ui_infos=0&ui_snapshots=1&ui_stop=0&ui_theatre=1&ui_watermark=0",
                description: "Different flower varieties showcase the incredible diversity of plant sexual reproduction strategies. Sweet pea flowers demonstrate how plants can evolve different colors, shapes, and pollination mechanisms while maintaining the same basic reproductive function.",
                concepts: [
                    "Color variations attract different pollinators",
                    "Flower shape determines pollinator access",
                    "Genetic diversity within species is crucial",
                    "Natural selection shapes floral evolution"
                ],
                funFact: "Sweet pea flowers were crucial to Gregor Mendel's groundbreaking work on genetics! He used them to discover the basic principles of heredity that we still use today.",
                objectives: "Appreciate how flower diversity reflects evolutionary adaptations and understand the relationship between flower characteristics and pollination success.",
                narration: "Welcome to the wonderful world of flower diversity! These sweet pea flowers beautifully demonstrate how sexual reproduction drives evolutionary adaptation. Notice how these flowers have evolved the classic pea flower shape - this isn't by accident. The upper petal acts like a flag to attract bees, while the lower petals form a landing platform. When a bee lands and pushes into the flower seeking nectar, the reproductive organs brush against its body, ensuring pollen transfer. Different colored varieties - purple, pink, white - have evolved to attract different pollinators or to bloom at different times, reducing competition between varieties. This color variation also represents genetic diversity within the species. Some varieties might be better adapted to different climates, soil conditions, or pollinator populations. This diversity is the raw material for natural selection - if environmental conditions change, some varieties will be better equipped to survive and reproduce. The fascinating thing is that despite these visible differences, all sweet pea varieties share the same basic reproductive strategy and can potentially cross-pollinate with each other. This balance between diversity and unity is one of the most beautiful aspects of sexual reproduction in flowering plants - it creates endless variety while maintaining the essential functions needed for life to continue."
            }
        };

        // Global Variables
        let currentStep = 'flower';
        let voiceEnabled = true;
        let autoPlayEnabled = false;
        let currentSpeech = null;
        let selectedVoice = null;
        let journeyProgress = 0;
        let guidedTourActive = false;

        // Initialize Voice System
        function initVoiceSystem() {
            if (!('speechSynthesis' in window)) {
                console.warn('Speech synthesis not supported');
                voiceEnabled = false;
                document.getElementById('voiceToggle').style.display = 'none';
                return;
            }

            function loadVoices() {
                const voices = speechSynthesis.getVoices();
                if (voices.length === 0) return;

                // Prefer natural-sounding voices
                const preferredVoices = [
                    'Google UK English Female',
                    'Microsoft Sonia',
                    'Microsoft Hazel',
                    'Samantha',
                    'Victoria'
                ];

                for (const name of preferredVoices) {
                    selectedVoice = voices.find(v => v.name.includes(name));
                    if (selectedVoice) break;
                }

                if (!selectedVoice) {
                    selectedVoice = voices.find(v => v.lang.startsWith('en'));
                }
            }

            loadVoices();
            if (speechSynthesis.onvoiceschanged !== undefined) {
                speechSynthesis.onvoiceschanged = loadVoices;
            }
        }

        // Load Journey Step
        function loadJourneyStep(stepId) {
            const stepData = JOURNEY_DATA[stepId];
            if (!stepData) return;

            currentStep = stepId;
            
            // Update model
            document.getElementById('api-frame').src = stepData.modelUrl;
            
            // Update info panel
            document.getElementById('stepIcon').textContent = stepData.icon;
            document.getElementById('stepTitle').textContent = stepData.title;
            document.getElementById('stepSubtitle').textContent = stepData.subtitle;
            document.getElementById('mainDescription').textContent = stepData.description;
            
            // Update key concepts
            const conceptsList = document.getElementById('keyConcepts');
            conceptsList.innerHTML = stepData.concepts.map(c => `<li>${c}</li>`).join('');
            
            // Update fun fact
            document.getElementById('funFact').textContent = stepData.funFact;
            
            // Update learning objectives
            document.getElementById('learningObjectives').textContent = stepData.objectives;
            
            // Update navigation buttons
            updateNavigationButtons(stepId);
            
            // Update progress
            updateProgress();
            
            // Play narration if enabled
            if (voiceEnabled) {
                speakText(stepData.narration);
            }
        }

        // Update Navigation Buttons
        function updateNavigationButtons(activeStep) {
            const buttons = document.querySelectorAll('.journey-btn');
            const steps = ['flower', 'plant', 'pollen', 'seed', 'varieties'];
            const activeIndex = steps.indexOf(activeStep);
            
            buttons.forEach((btn, index) => {
                btn.classList.remove('active', 'completed');
                if (index < activeIndex) {
                    btn.classList.add('completed');
                } else if (index === activeIndex) {
                    btn.classList.add('active');
                }
            });
            
            // Update mini steps
            const miniSteps = document.querySelectorAll('.step-mini');
            miniSteps.forEach((step, index) => {
                step.classList.remove('active', 'completed');
                if (index < activeIndex) {
                    step.classList.add('completed');
                } else if (index === activeIndex) {
                    step.classList.add('active');
                }
            });
        }

        // Update Progress
        function updateProgress() {
            const steps = ['flower', 'plant', 'pollen', 'seed', 'varieties'];
            const currentIndex = steps.indexOf(currentStep);
            const progress = ((currentIndex + 1) / steps.length) * 100;
            
            document.getElementById('progressPercent').textContent = Math.round(progress) + '%';
            document.getElementById('progressFill').style.width = progress + '%';
        }

        // Speech Functions
        function speakText(text) {
            if (!voiceEnabled || !text) return;
            
            stopSpeech();
            
            currentSpeech = new SpeechSynthesisUtterance(text);
            if (selectedVoice) {
                currentSpeech.voice = selectedVoice;
            }
            currentSpeech.rate = 0.9;
            currentSpeech.pitch = 1.0;
            currentSpeech.volume = 0.9;
            
            currentSpeech.onstart = () => {
                document.getElementById('voiceIndicator').classList.add('visible');
                document.getElementById('narrationText').textContent = 
                    text.substring(0, 50) + (text.length > 50 ? '...' : '');
            };
            
            currentSpeech.onend = () => {
                document.getElementById('voiceIndicator').classList.remove('visible');
                currentSpeech = null;
                
                // Auto-advance if guided tour is active
                if (guidedTourActive) {
                    setTimeout(nextStep, 2000);
                }
            };
            
            speechSynthesis.speak(currentSpeech);
        }

        function stopSpeech() {
            if (currentSpeech) {
                speechSynthesis.cancel();
                currentSpeech = null;
                document.getElementById('voiceIndicator').classList.remove('visible');
            }
        }

        // Control Functions
        function toggleVoice() {
            voiceEnabled = !voiceEnabled;
            const btn = document.getElementById('voiceToggle');
            btn.textContent = voiceEnabled ? '🔊' : '🔇';
            btn.classList.toggle('active', voiceEnabled);
            
            if (!voiceEnabled) {
                stopSpeech();
            }
        }

        function toggleAutoPlay() {
            autoPlayEnabled = !autoPlayEnabled;
            if (autoPlayEnabled) {
                startGuidedTour();
            } else {
                guidedTourActive = false;
            }
        }

        function toggleInfo() {
            const panel = document.getElementById('infoPanel');
            panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
        }

        // Guided Tour
        function startGuidedTour() {
            guidedTourActive = true;
            const steps = ['flower', 'plant', 'pollen', 'seed', 'varieties'];
            let stepIndex = 0;
            
            function tourStep() {
                if (stepIndex < steps.length && guidedTourActive) {
                    loadJourneyStep(steps[stepIndex]);
                    stepIndex++;
                } else {
                    guidedTourActive = false;
                    if (voiceEnabled) {
                        speakText("Congratulations! You've completed your journey through sexual reproduction in flowering plants. You now understand how flowers, pollination, and seed formation work together to ensure plant survival and genetic diversity!");
                    }
                }
            }
            
            tourStep();
            window.nextStep = tourStep;
        }

        // Quiz Function
        function showQuiz() {
            const questions = [
                "What are the main parts of a flower and their functions?",
                "How does pollination lead to fertilization in plants?",
                "What advantages does sexual reproduction provide to plants?",
                "How do seeds ensure plant survival and dispersal?",
                "Why do flowers have such diverse colors and shapes?"
            ];
            
            const randomQ = questions[Math.floor(Math.random() * questions.length)];
            
            if (voiceEnabled) {
                speakText(`Here's a question to test your botanical knowledge: ${randomQ} Think about what you've learned about plant reproduction!`);
            }
        }

        // Initialize
        function init() {
            initVoiceSystem();
            
            // Hide loading screen
            setTimeout(() => {
                const loading = document.getElementById('loadingOverlay');
                loading.style.opacity = '0';
                setTimeout(() => {
                    loading.style.display = 'none';
                    
                    // Welcome message
                    if (voiceEnabled) {
                        speakText("Welcome to your botanical journey through sexual reproduction in flowering plants! We'll explore how flowers use ingenious strategies to ensure genetic diversity and species survival. Let's start by examining the intricate structure of a flower!");
                    }
                }, 1000);
            }, 3000);
            
            // Keyboard shortcuts
            document.addEventListener('keydown', (e) => {
                switch(e.key) {
                    case 'v': toggleVoice(); break;
                    case 'i': toggleInfo(); break;
                    case 'g': startGuidedTour(); break;
                    case 'Escape': stopSpeech(); guidedTourActive = false; break;
                    case 'ArrowRight': nextStep && nextStep(); break;
                }
            });
        }

        // Start the application
        init();
    </script>
</body>
</html>