<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weight - Understanding Mass vs Weight - Physics in Motion</title>
    <!-- GSAP for animations -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #334155 100%);
            color: white;
            overflow-x: hidden;
            min-height: 100vh;
        }

        /* Audio Control */
        #audio-control {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
        }

        .control-btn {
            background: rgba(59, 130, 246, 0.9);
            border: none;
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .control-btn:hover {
            transform: scale(1.1);
            background: rgba(59, 130, 246, 1);
        }

        .control-btn.muted .unmute-icon { display: none; }
        .control-btn:not(.muted) .mute-icon { display: none; }

        /* Main Container */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 30px 20px;
        }

        /* Header */
        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .header h1 {
            font-size: 3rem;
            background: linear-gradient(45deg, #3b82f6, #8b5cf6, #f59e0b);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 15px;
            font-weight: 700;
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.95;
            max-width: 800px;
            margin: 0 auto;
            line-height: 1.6;
        }

        /* Demo Stage */
        .demo-stage {
            background: linear-gradient(to bottom, #1e293b, #334155, #475569);
            border-radius: 25px;
            min-height: 500px;
            position: relative;
            margin: 40px 0;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
            overflow: hidden;
            border: 3px solid rgba(59, 130, 246, 0.4);
            padding: 40px;
        }

        /* Weight Comparison Demo - Enhanced from weight_old.html */
        .weight-demo {
            display: none;
            position: relative;
            width: 100%;
            height: 500px;
        }

        .weight-demo.active {
            display: block;
        }

        /* Comparison Stage */
        .comparison-stage {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin: 40px 0;
        }

        .planet-container {
            background: linear-gradient(to bottom, 
                #0a0e27 0%,
                #162447 30%,
                #1f4068 60%,
                #5893d4 85%);
            border-radius: 25px;
            height: 500px;
            position: relative;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.4);
            overflow: hidden;
            border: 4px solid rgba(59, 130, 246, 0.4);
            transition: all 0.5s ease;
        }

        .planet-container.active {
            border-color: #10b981;
            box-shadow: 0 25px 50px rgba(16, 185, 129, 0.3);
            animation: containerPulse 2s ease-in-out infinite;
        }

        @keyframes containerPulse {
            0%, 100% { 
                border-color: #10b981;
                box-shadow: 0 25px 50px rgba(16, 185, 129, 0.3);
            }
            50% { 
                border-color: #34d399;
                box-shadow: 0 25px 50px rgba(16, 185, 129, 0.5);
            }
        }

        /* Planets */
        .planet {
            position: absolute;
            bottom: -50%;
            left: 50%;
            transform: translateX(-50%);
            border-radius: 50%;
            box-shadow: 0 -20px 40px rgba(0, 0, 0, 0.3);
        }

        .earth {
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at 30% 30%, #4CAF50, #2E7D32, #1B5E20);
        }

        .moon {
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at 30% 30%, #e5e7eb, #9ca3af, #6b7280);
        }

        .planet-label {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 1.8rem;
            font-weight: bold;
            background: rgba(0, 0, 0, 0.7);
            padding: 10px 25px;
            border-radius: 20px;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        /* Object on planets */
        .object-on-planet {
            position: absolute;
            top: 25%;
            left: 50%;
            transform: translateX(-50%);
            width: 80px;
            height: 80px;
            background: linear-gradient(145deg, #f59e0b, #d97706);
            border: 3px solid #92400e;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            transition: all 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
            z-index: 100;
        }

        .object-on-planet.falling {
            animation: objectFall 2s cubic-bezier(0.5, 0, 1, 1) forwards;
        }

        /* Different falling speeds for Earth vs Moon */
        #earth-object.falling {
            animation: earthObjectFall 1.8s cubic-bezier(0.5, 0, 1, 1) forwards !important;
        }

        #moon-object.falling {
            animation: moonObjectFall 2.5s cubic-bezier(0.3, 0, 0.8, 1) forwards !important;
        }

        @keyframes objectFall {
            0% { top: 25%; }
            100% { top: 60%; }
        }

        @keyframes earthObjectFall {
            0% { 
                top: 25%; 
                transform: translateX(-50%) scale(1);
            }
            50% { 
                transform: translateX(-50%) scale(1.05);
            }
            100% { 
                top: 69%; 
                transform: translateX(-50%) scale(1);
            }
        }

        @keyframes moonObjectFall {
            0% { 
                top: 25%; 
                transform: translateX(-50%) scale(1);
            }
            30% { 
                transform: translateX(-50%) scale(1.02);
            }
            100% { 
                top: 62%; 
                transform: translateX(-50%) scale(1);
            }
        }

        /* Weight Display */
        .weight-display {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.85);
            padding: 12px 25px;
            border-radius: 20px;
            font-size: 1.3rem;
            font-weight: bold;
            color: #10b981;
            border: 3px solid rgba(16, 185, 129, 0.5);
            opacity: 0;
            transition: all 0.5s ease;
            z-index: 200;
        }

        .weight-display.visible {
            opacity: 1;
            transform: translateX(-50%) scale(1.05);
            animation: weightAppear 0.8s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
        }

        @keyframes weightAppear {
            0% {
                opacity: 0;
                transform: translateX(-50%) scale(0.5) translateY(20px);
            }
            60% {
                transform: translateX(-50%) scale(1.15) translateY(-5px);
            }
            100% {
                opacity: 1;
                transform: translateX(-50%) scale(1.05) translateY(0px);
            }
        }

        /* Force Arrow */
        .force-arrow {
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: all 0.8s ease;
            z-index: 50;
        }

        .force-arrow.visible {
            opacity: 1;
        }

        .arrow-shaft {
            background: #ef4444;
            width: 8px;
            margin: 0 auto;
            box-shadow: 0 0 15px #ef4444;
            border-radius: 4px;
        }

        .arrow-tip {
            width: 0;
            height: 0;
            border-left: 15px solid transparent;
            border-right: 15px solid transparent;
            border-top: 20px solid #ef4444;
            margin: 0 auto;
            filter: drop-shadow(0 0 8px #ef4444);
        }

        .force-label {
            background: #ef4444;
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 1rem;
            font-weight: 600;
            margin-top: 10px;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        /* Planet Info */
        .planet-info {
            position: absolute;
            top: 110px;
            right: 5px;
            background: rgba(0, 0, 0, 0.9);
            padding: 10px;
            border-radius: 12px;
            border: 2px solid rgba(59, 130, 246, 0.4);
            z-index: 150;
            max-width: 220px;
            font-size: 0.85rem;
            backdrop-filter: blur(10px);
        }

        .info-item {
            display: flex;
            justify-content: space-between;
            margin: 10px 0;
            min-width: 170px;
        }

        .info-label {
            color: #94a3b8;
            font-weight: 600;
        }

        .info-value {
            color: #3b82f6;
            font-weight: bold;
            font-family: 'Courier New', monospace;
        }

        /* Formula Derivation Demo - Horizontal Layout */
        .formula-demo {
            display: none;
            padding: 20px;
            overflow-x: auto;
            overflow-y: hidden;
        }

        .formula-demo.active {
            display: block;
        }

        .derivation-container {
            display: flex;
            gap: 30px;
            min-width: max-content;
            align-items: flex-start;
            padding: 20px 0;
        }

        .derivation-step {
            background: rgba(15, 23, 42, 0.9);
            padding: 25px;
            border-radius: 15px;
            opacity: 0;
            transform: translateX(-20px);
            border: 1px solid rgba(59, 130, 246, 0.3);
            min-width: 350px;
            max-width: 350px;
            flex-shrink: 0;
        }

        .derivation-step.show {
            opacity: 1;
            transform: translateX(0);
            transition: all 0.6s ease;
        }

        .step-title {
            color: #3b82f6;
            font-size: 1.3rem;
            margin-bottom: 15px;
            font-weight: 600;
        }

        .formula {
            font-family: 'Courier New', monospace;
            font-size: 1.8rem;
            color: #fbbf24;
            text-align: center;
            margin: 20px 0;
            padding: 15px;
            background: rgba(251, 191, 36, 0.1);
            border-radius: 10px;
            border: 1px solid rgba(251, 191, 36, 0.3);
        }

        .step-explanation {
            line-height: 1.6;
            color: #e2e8f0;
            font-size: 1.1rem;
        }

        /* Mass vs Weight Demo */
        .comparison-demo {
            display: none;
            position: relative;
            width: 100%;
            height: 500px;
        }

        .comparison-demo.active {
            display: flex;
            justify-content: space-around;
            align-items: center;
        }

        .comparison-card {
            background: rgba(15, 23, 42, 0.9);
            padding: 30px;
            border-radius: 20px;
            width: 300px;
            text-align: center;
            border: 2px solid rgba(59, 130, 246, 0.4);
            transition: all 0.3s ease;
        }

        .comparison-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(59, 130, 246, 0.3);
        }

        .card-title {
            font-size: 1.5rem;
            color: #3b82f6;
            margin-bottom: 20px;
            font-weight: 600;
        }

        .card-icon {
            font-size: 4rem;
            margin-bottom: 20px;
        }

        .card-properties {
            list-style: none;
            padding: 0;
        }

        .card-properties li {
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            color: #e2e8f0;
        }

        .card-properties li:last-child {
            border-bottom: none;
        }

        /* Calculation Demo - Horizontal Slider */
        .calculation-demo {
            display: none;
            padding: 20px;
            position: relative;
            overflow: hidden;
        }

        .calculation-demo.active {
            display: block;
        }

        .examples-slider {
            position: relative;
            width: 100%;
            height: 725px;
            overflow: hidden;
        }

        .examples-container {
            display: flex;
            width: 200%;
            height: 100%;
            transition: transform 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        .example-section {
            width: 50%;
            flex-shrink: 0;
            padding: 0 20px;
            padding-bottom: 80px; /* Space for controls */
            box-sizing: border-box;
            transition: opacity 0.3s ease;
        }

        .example-section:not(.active-example) {
            opacity: 0.7;
        }

        .example-section.active-example {
            opacity: 1;
        }

        .slider-controls {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 15px;
            z-index: 100;
            background: rgba(15, 23, 42, 0.9);
            padding: 15px 25px;
            border-radius: 25px;
            border: 2px solid rgba(59, 130, 246, 0.3);
            backdrop-filter: blur(10px);
        }

        .slider-btn {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            border: none;
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
        }

        .slider-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(59, 130, 246, 0.4);
        }

        .slider-btn.active {
            background: linear-gradient(135deg, #10b981, #059669);
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.4);
            transform: scale(1.05);
        }

        .slider-btn.active::before {
            content: "▶ ";
            font-size: 0.8em;
        }

        .slider-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .example-problem {
            background: rgba(59, 130, 246, 0.15);
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 20px;
            border-left: 4px solid #3b82f6;
        }

        .problem-title {
            color: #3b82f6;
            font-size: 1.3rem;
            margin-bottom: 15px;
            font-weight: 600;
        }

        .solution-steps-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 20px; /* Space before controls */
        }

        .solution-step {
            background: rgba(15, 23, 42, 0.9);
            padding: 20px;
            border-radius: 10px;
            opacity: 0;
            transform: translateY(-10px);
            border: 1px solid rgba(59, 130, 246, 0.2);
            backdrop-filter: blur(5px);
        }

        .solution-step.show {
            opacity: 1;
            transform: translateY(0);
            transition: all 0.5s ease;
        }

        .step-number {
            color: #fbbf24;
            font-weight: bold;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }

        .calculation {
            font-family: 'Courier New', monospace;
            color: #10b981;
            font-size: 1.1rem;
            margin: 10px 0;
        }

        .answer-highlight {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.3), rgba(251, 191, 36, 0.3));
            padding: 20px;
            border-radius: 15px;
            margin-top: 20px;
            text-align: center;
            font-size: 1.2rem;
            font-weight: bold;
            color: #fbbf24;
            opacity: 0;
            transform: scale(0.9);
            border: 2px solid rgba(251, 191, 36, 0.4);
        }

        .answer-highlight.show {
            opacity: 1;
            transform: scale(1);
            transition: all 0.5s ease;
        }

        /* Moon Weight Ratio Demo */
        .ratio-demo {
            display: none;
            position: relative;
            width: 100%;
            height: 500px;
            background: transparent;
            overflow: hidden;
        }

        .ratio-demo.active {
            display: block;
        }



        /* Controls */
        .controls {
            text-align: center;
            margin: 40px 0;
        }

        .controls-title {
            font-size: 1.8rem;
            margin-bottom: 25px;
            color: #3b82f6;
            font-weight: 600;
        }

        .demo-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
            margin: 25px 0;
        }

        .demo-btn {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            border: none;
            color: white;
            padding: 14px 24px;
            border-radius: 30px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 8px 20px rgba(59, 130, 246, 0.3);
            min-width: 150px;
        }

        .demo-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 25px rgba(59, 130, 246, 0.4);
        }

        .demo-btn.active {
            background: linear-gradient(135deg, #10b981, #059669);
            box-shadow: 0 8px 20px rgba(16, 185, 129, 0.4);
        }

        /* Theory Section */
        .theory-section {
            background: rgba(15, 23, 42, 0.9);
            border-radius: 25px;
            padding: 35px;
            margin: 35px 0;
            border: 3px solid rgba(59, 130, 246, 0.4);
            backdrop-filter: blur(15px);
        }

        .key-formula {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.2), rgba(251, 191, 36, 0.2));
            padding: 25px;
            border-radius: 20px;
            margin: 20px 0;
            text-align: center;
            border: 1px solid rgba(251, 191, 36, 0.3);
        }

        .main-equation {
            font-size: 2.5rem;
            color: #fbbf24;
            font-family: 'Courier New', monospace;
            margin: 15px 0;
            text-shadow: 0 0 20px rgba(251, 191, 36, 0.5);
        }

        .equation-description {
            line-height: 1.8;
            color: #e2e8f0;
            opacity: 0.95;
            margin-top: 15px;
            font-size: 1.1rem;
        }

        .data-table {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            overflow-x: auto;
        }

        .data-table table {
            width: 100%;
            border-collapse: collapse;
        }

        .data-table th,
        .data-table td {
            padding: 12px;
            text-align: center;
            border: 1px solid rgba(59, 130, 246, 0.3);
        }

        .data-table th {
            background: rgba(59, 130, 246, 0.2);
            color: #3b82f6;
            font-weight: 600;
        }

        .data-table td {
            color: #e2e8f0;
        }

        /* Activity Cards */
        .activity-card {
            background: rgba(59, 130, 246, 0.1);
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            border-left: 4px solid #3b82f6;
        }

        .activity-title {
            color: #3b82f6;
            font-size: 1.2rem;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .activity-content {
            color: #e2e8f0;
            line-height: 1.6;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .header h1 { font-size: 2.2rem; }
            .demo-stage { padding: 30px 20px; min-height: 400px; }
            .demo-buttons { flex-direction: column; align-items: center; }
            .comparison-demo { flex-direction: column; gap: 20px; }
            .comparison-card { width: 100%; max-width: 300px; }
            .ratio-visualization { flex-direction: column; gap: 30px; }
        }

        @media (max-width: 480px) {
            .container { padding: 20px 15px; }
            .header h1 { font-size: 1.8rem; }
            .demo-stage { padding: 20px 15px; }
            .theory-section { padding: 20px; }
            .main-equation { font-size: 1.8rem; }
        }
    </style>
</head>
<body>
    <!-- Audio Control -->
    <div id="audio-control">
        <button id="mute-btn" class="control-btn">
            <span class="unmute-icon">🔊</span>
            <span class="mute-icon">🔇</span>
        </button>
    </div>

    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>Understanding Weight</h1>
            <p>Discover the difference between mass and weight, and explore how gravity affects weight on Earth and the Moon!</p>
        </div>

        <!-- Demo Stage -->
        <div class="demo-stage" id="stage">
            <!-- Weight Comparison Demo -->
            <div class="weight-demo" id="weight-demo">
                <div class="comparison-stage" id="comparison-view">
                    <!-- Earth Container -->
                    <div class="planet-container" id="earth-container">
                        <div class="planet-label">🌍 Earth</div>
                        <div class="planet earth"></div>
                        
                        <div class="object-on-planet" id="earth-object">
                            10 kg
                        </div>
                        
                        <div class="force-arrow" id="earth-arrow" style="top: 35%;">
                            <div class="arrow-shaft" style="height: 100px;"></div>
                            <div class="arrow-tip"></div>
                            <div class="force-label">W = 98 N</div>
                        </div>
                        
                        <div class="weight-display" id="earth-weight">
                            Weight = 98 N
                        </div>
                        
                        <!-- Planet Info -->
                        <div class="planet-info" id="earth-info" style="display: none;">
                            <div class="info-item">
                                <span class="info-label">Mass:</span>
                                <span class="info-value">5.98 × 10²⁴ kg</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Radius:</span>
                                <span class="info-value">6.37 × 10⁶ m</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">g value:</span>
                                <span class="info-value">9.8 m/s²</span>
                            </div>
                        </div>
                    </div>

                    <!-- Moon Container -->
                    <div class="planet-container" id="moon-container">
                        <div class="planet-label">🌙 Moon</div>
                        <div class="planet moon"></div>
                        
                        <div class="object-on-planet" id="moon-object">
                            10 kg
                        </div>
                        
                        <div class="force-arrow" id="moon-arrow" style="top: 35%;">
                            <div class="arrow-shaft" style="height: 60px;"></div>
                            <div class="arrow-tip"></div>
                            <div class="force-label">W = 16.3 N</div>
                        </div>
                        
                        <div class="weight-display" id="moon-weight">
                            Weight = 16.3 N
                        </div>
                        
                        <!-- Planet Info -->
                        <div class="planet-info" id="moon-info" style="display: none;">
                            <div class="info-item">
                                <span class="info-label">Mass:</span>
                                <span class="info-value">7.36 × 10²² kg</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Radius:</span>
                                <span class="info-value">1.74 × 10⁶ m</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">g value:</span>
                                <span class="info-value">1.63 m/s²</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Formula Derivation Demo -->
            <div class="formula-demo" id="formula-demo">
                <div class="derivation-container">
                    <div class="derivation-step" id="step1">
                        <div class="step-title">Newton's Second Law</div>
                        <div class="formula">F = m × a</div>
                        <div class="step-explanation">
                            Any force acting on an object equals the product of its mass and acceleration.
                            This is the fundamental relationship in mechanics.
                        </div>
                    </div>

                    <div class="derivation-step" id="step2">
                        <div class="step-title">Gravitational Force as Weight</div>
                        <div class="formula">W = m × g</div>
                        <div class="step-explanation">
                            Weight is the gravitational force acting on an object. Since this force causes 
                            acceleration 'g', we substitute 'a' with 'g' in Newton's second law.
                        </div>
                    </div>

                    <div class="derivation-step" id="step3">
                        <div class="step-title">Universal Law of Gravitation</div>
                        <div class="formula">F = G × (M × m) / R²</div>
                        <div class="step-explanation">
                            The gravitational force between two objects depends on their masses (M and m) 
                            and the square of the distance (R) between their centers.
                        </div>
                    </div>

                    <div class="derivation-step" id="step4">
                        <div class="step-title">Weight on a Planet</div>
                        <div class="formula">W = G × (M × m) / R²</div>
                        <div class="step-explanation">
                            For an object on a planet's surface, the weight equals the gravitational force 
                            between the object and the planet.
                        </div>
                    </div>

                    <div class="derivation-step" id="step5">
                        <div class="step-title">Deriving g</div>
                        <div class="formula">g = G × M / R²</div>
                        <div class="step-explanation">
                            Comparing W = mg and W = GMm/R², we get g = GM/R². This shows that 'g' 
                            depends only on the planet's mass and radius, not on the object's mass.
                        </div>
                    </div>
                </div>
            </div>

            <!-- Mass vs Weight Comparison -->
            <div class="comparison-demo" id="comparison-demo">
                <div class="comparison-card">
                    <div class="card-title">Mass</div>
                    <div class="card-icon">⚖️</div>
                    <ul class="card-properties">
                        <li><strong>Definition:</strong> Amount of matter</li>
                        <li><strong>Unit:</strong> Kilogram (kg)</li>
                        <li><strong>Nature:</strong> Scalar quantity</li>
                        <li><strong>Variation:</strong> Constant everywhere</li>
                        <li><strong>Measurement:</strong> Physical balance</li>
                    </ul>
                </div>

                <div class="comparison-card">
                    <div class="card-title">Weight</div>
                    <div class="card-icon">⬇️</div>
                    <ul class="card-properties">
                        <li><strong>Definition:</strong> Gravitational force</li>
                        <li><strong>Unit:</strong> Newton (N)</li>
                        <li><strong>Nature:</strong> Vector quantity</li>
                        <li><strong>Variation:</strong> Changes with location</li>
                        <li><strong>Measurement:</strong> Spring balance</li>
                    </ul>
                </div>
            </div>

            <!-- Calculation Demo -->
            <div class="calculation-demo" id="calculation-demo">
                <div class="examples-slider">
                    <div class="examples-container" id="examples-container">
                        <!-- Example 9.4 -->
                        <div class="example-section active-example">
                            <div class="example-problem">
                                <div class="problem-title">Example 9.4 (NCERT)</div>
                                <p><strong>Problem:</strong> Mass of an object is 10 kg. What is its weight on Earth?</p>
                            </div>

                            <div class="solution-steps-container">
                                <div class="solution-step" id="calc-step1">
                                    <div class="step-number">Given:</div>
                                    <div>Mass, m = 10 kg<br>
                                    Acceleration due to gravity, g = 9.8 m/s²</div>
                                </div>

                                <div class="solution-step" id="calc-step2">
                                    <div class="step-number">Formula:</div>
                                    <div class="calculation">W = m × g</div>
                                </div>

                                <div class="solution-step" id="calc-step3">
                                    <div class="step-number">Calculation:</div>
                                    <div class="calculation">W = 10 kg × 9.8 m/s²<br>W = 98 N</div>
                                </div>

                                <div class="answer-highlight" id="calc-answer1">
                                    The weight of the object on Earth is 98 N
                                </div>
                            </div>
                        </div>

                        <!-- Example 9.5 -->
                        <div class="example-section">
                            <div class="example-problem">
                                <div class="problem-title">Example 9.5 (NCERT)</div>
                                <p><strong>Problem:</strong> An object weighs 10 N on Earth. What would be its weight on the Moon?</p>
                            </div>

                            <div class="solution-steps-container">
                                <div class="solution-step" id="calc-step4">
                                    <div class="step-number">Given:</div>
                                    <div>Weight on Earth, W<sub>e</sub> = 10 N<br>
                                    Weight on Moon = (1/6) × Weight on Earth</div>
                                </div>

                                <div class="solution-step" id="calc-step5">
                                    <div class="step-number">Calculation:</div>
                                    <div class="calculation">W<sub>m</sub> = W<sub>e</sub> / 6<br>
                                    W<sub>m</sub> = 10 N / 6<br>
                                    W<sub>m</sub> = 1.67 N</div>
                                </div>

                                <div class="answer-highlight" id="calc-answer2">
                                    The weight of the object on Moon is 1.67 N
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Slider Controls -->
                    <div class="slider-controls">
                        <button class="slider-btn active" onclick="slideToExample(0)" data-task-id="calculations">Example 9.4</button>
                        <button class="slider-btn" onclick="slideToExample(1)" data-task-id="calculations">Example 9.5</button>
                    </div>
                </div>
            </div>

            <!-- Moon Weight Ratio Demo -->
            <div class="ratio-demo" id="ratio-demo">
                <!-- Use same Earth vs Moon layout for consistency -->
                <div class="comparison-stage" id="ratio-comparison-view">
                    <!-- Earth Container for Ratio -->
                    <div class="planet-container" id="ratio-earth-container">
                        <div class="planet-label">🌍 Earth</div>
                        <div class="planet earth"></div>
                        
                        <div class="object-on-planet" id="ratio-earth-object">
                            10 kg
                        </div>
                        
                        <div class="force-arrow" id="ratio-earth-arrow" style="top: 35%;">
                            <div class="arrow-shaft" style="height: 100px;"></div>
                            <div class="arrow-tip"></div>
                            <div class="force-label">W = 98 N</div>
                        </div>
                        
                        <div class="weight-display" id="ratio-earth-weight">
                            Weight = 98 N
                        </div>
                    </div>

                    <!-- Moon Container for Ratio -->
                    <div class="planet-container" id="ratio-moon-container">
                        <div class="planet-label">🌙 Moon</div>
                        <div class="planet moon"></div>
                        
                        <div class="object-on-planet" id="ratio-moon-object">
                            10 kg
                        </div>
                        
                        <div class="force-arrow" id="ratio-moon-arrow" style="top: 35%;">
                            <div class="arrow-shaft" style="height: 17px;"></div>
                            <div class="arrow-tip"></div>
                            <div class="force-label">W = 16.3 N (1/6)</div>
                        </div>
                        
                        <div class="weight-display" id="ratio-moon-weight">
                            Weight = 16.3 N<br><small>(1/6 of Earth)</small>
                        </div>
                    </div>
                </div>
                
                <!-- Ratio equation overlay -->
                <div style="position: absolute; top: 20px; left: 50%; transform: translateX(-50%); z-index: 200; background: rgba(0, 0, 0, 0.8); padding: 15px 25px; border-radius: 15px; border: 2px solid rgba(59, 130, 246, 0.4); backdrop-filter: blur(10px);">
                    <div style="font-size: 1.5rem; color: #fbbf24; font-family: 'Courier New', monospace; text-align: center; margin-bottom: 5px;">W<sub>moon</sub> / W<sub>earth</sub> = 1/6</div>
                    <p style="margin: 0; color: #e2e8f0; font-size: 0.9rem; text-align: center;">Weight on Moon is 1/6th of weight on Earth</p>
                </div>
            </div>
        </div>

        <!-- Controls -->
        <div class="controls">
            <div class="controls-title" id="demo-title">Explore Weight on Different Celestial Bodies</div>
            
            <div class="demo-buttons">
                <button class="demo-btn" onclick="playCompleteLesson()" data-task-id="complete-lesson">📚 Complete Lesson</button>
                <button class="demo-btn" onclick="showWeightComparison()" data-task-id="weight-comparison">🌍🌙 Earth vs Moon</button>
                <button class="demo-btn" onclick="showFormulaDemonstration()" data-task-id="formula-demonstration">📐 Formula Derivation</button>
                <button class="demo-btn" onclick="showMassVsWeight()" data-task-id="mass-vs-weight">⚖️ Mass vs Weight</button>
                <button class="demo-btn" onclick="showCalculations()" data-task-id="calculations">🧮 NCERT Examples</button>
                <button class="demo-btn" onclick="showRatioDemo()" data-task-id="ratio-demo">📊 1/6 Ratio</button>
                <button class="demo-btn" onclick="resetAllClick()" data-task-id="reset">🔄 Reset</button>
            </div>
        </div>

        <!-- Interactive Weight Calculator -->
        <div class="theory-section">
            <div class="key-formula">
                <div class="main-equation">W = m × g</div>
                <div class="equation-description">
                    <strong>Weight</strong> is the force with which Earth (or any celestial body) attracts an object.<br>
                    <strong>SI Unit:</strong> Newton (N) - same as force<br>
                    <strong>Nature:</strong> Vector quantity (acts vertically downward)<br>
                    <strong>Key Point:</strong> Weight varies with location, but mass remains constant
                </div>
            </div>

            <!-- Weight Calculator -->
            <div style="background: rgba(59, 130, 246, 0.1); padding: 25px; border-radius: 20px; margin: 20px 0; border: 2px solid rgba(59, 130, 246, 0.3);">
                <h3 style="color: #3b82f6; margin-bottom: 20px; text-align: center;">🧮 Interactive Weight Calculator</h3>
                
                <div style="display: flex; justify-content: center; gap: 15px; margin: 20px 0; flex-wrap: wrap;">
                    <input type="number" id="mass-input" placeholder="Enter mass (kg)" step="0.1" 
                           style="background: rgba(255, 255, 255, 0.1); border: 2px solid rgba(59, 130, 246, 0.4); color: white; padding: 12px 20px; border-radius: 25px; font-size: 1.1rem; width: 200px; text-align: center;">
                    <select id="location-select" 
                            style="background: rgba(255, 255, 255, 0.1); border: 2px solid rgba(59, 130, 246, 0.4); color: white; padding: 12px 20px; border-radius: 25px; font-size: 1.1rem; width: 150px;">
                        <option value="earth">Earth</option>
                        <option value="moon">Moon</option>
                        <option value="both">Both</option>
                    </select>
                    <button onclick="calculateWeight()" 
                            style="background: linear-gradient(135deg, #10b981, #059669); border: none; color: white; padding: 12px 30px; border-radius: 25px; font-size: 1.1rem; cursor: pointer; transition: all 0.3s ease;">
                        Calculate
                    </button>
                </div>
                
                <div id="calculation-result" style="text-align: center; font-size: 1.3rem; margin-top: 20px; padding: 20px; background: rgba(16, 185, 129, 0.1); border-radius: 20px; border: 2px solid rgba(16, 185, 129, 0.3); min-height: 80px; display: flex; align-items: center; justify-content: center;">
                    Enter a mass value and select location to calculate weight
                </div>
            </div>
        </div>

        <!-- Theory Section -->
        <div class="theory-section">

            <div class="data-table">
                <h3 style="color: #3b82f6; margin-bottom: 15px;">Table 9.1: Celestial Body Data</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Celestial Body</th>
                            <th>Mass (kg)</th>
                            <th>Radius (m)</th>
                            <th>g (m/s²)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Earth</td>
                            <td>5.98 × 10²⁴</td>
                            <td>6.37 × 10⁶</td>
                            <td>9.8</td>
                        </tr>
                        <tr>
                            <td>Moon</td>
                            <td>7.36 × 10²²</td>
                            <td>1.74 × 10⁶</td>
                            <td>1.63</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="activity-card">
                <div class="activity-title">Key Insights from NCERT</div>
                <div class="activity-content">
                    <p><strong>1. Weight Definition:</strong> Weight is the force with which Earth attracts every object.</p>
                    <p><strong>2. Location Dependence:</strong> Weight depends on location because 'g' varies with the celestial body.</p>
                    <p><strong>3. Mass Constancy:</strong> Mass remains the same everywhere - on Earth, Moon, or any planet.</p>
                    <p><strong>4. Proportionality:</strong> At a given place, weight is directly proportional to mass (W ∝ m).</p>
                    <p><strong>5. Moon Relationship:</strong> Weight on Moon = (1/6) × Weight on Earth</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Voice Teacher System
        class PhysicsTeacher {
            constructor() {
                this.isEnabled = globalAudioEnabled;
                this.currentUtterance = null;
                this.settings = { rate: 0.9, pitch: 1.0, volume: 0.85 };
                this.isDestroyed = false;
            }

            async speak(text, delay = 0) {
                if (!this.isEnabled || !text || this.isDestroyed) return;
                
                return new Promise((resolve) => {
                    setTimeout(() => {
                        if (this.isDestroyed) {
                            resolve();
                            return;
                        }
                        this.stop();
                        const utterance = new SpeechSynthesisUtterance(text);
                        Object.assign(utterance, this.settings);
                        
                        utterance.onend = resolve;
                        utterance.onerror = resolve;
                        
                        this.currentUtterance = utterance;
                        speechSynthesis.speak(utterance);
                    }, delay);
                });
            }

            stop() {
                speechSynthesis.cancel();
                this.currentUtterance = null;
            }

            destroy() {
                this.isDestroyed = true;
                this.stop();
                this.currentUtterance = null;
                this.settings = null;
            }
        }

        // Global state management
        let globalAudioEnabled = true;
        let currentTeacher = null;
        let isPlaying = false;
        let animationTimeline = null;
        let currentDemoAborted = false;
        let activeAnimations = [];
        let currentRunId = 0;
        let currentTaskId = null; // Track current task ID
        let taskQueue = []; // Queue for task-specific content

        // State management functions
        function createNewTimeline() {
            if (animationTimeline) {
                animationTimeline.kill();
                animationTimeline = null;
            }
            activeAnimations.forEach(anim => {
                if (anim) anim.kill();
            });
            activeAnimations = [];
            gsap.killTweensOf("*");
            
            const newTimeline = gsap.timeline();
            animationTimeline = newTimeline;
            return newTimeline;
        }

        function trackAnimation(animation) {
            if (animation) {
                activeAnimations.push(animation);
            }
            return animation;
        }

        function stopCurrentDemo() {
            currentDemoAborted = true;
            currentRunId++;
            
            // Clear current task context
            currentTaskId = null;
            taskQueue = [];
            
            // Stop example narration and timeouts
            stopExampleNarration();
            
            // Stop teacher
            if (currentTeacher) {
                currentTeacher.destroy();
                currentTeacher = null;
            }
            
            // Kill all animations
            if (animationTimeline) {
                animationTimeline.kill();
                animationTimeline = null;
            }
            
            activeAnimations.forEach(anim => {
                if (anim) anim.kill();
            });
            activeAnimations = [];
            
            gsap.killTweensOf("*");
            
            // Hide all demos
            document.querySelectorAll('.weight-demo, .formula-demo, .comparison-demo, .calculation-demo, .ratio-demo').forEach(demo => {
                demo.classList.remove('active');
            });
            
            isPlaying = false;
        }

        function shouldContinue(taskId = null) {
            // If a specific task ID is provided, check if it matches current task
            if (taskId && currentTaskId && taskId !== currentTaskId) {
                return false;
            }
            return !currentDemoAborted;
        }

        function createNewTeacher(taskId = null) {
            if (currentTeacher) {
                currentTeacher.destroy();
                currentTeacher = null;
            }
            currentDemoAborted = false;
            currentTaskId = taskId;
            currentTeacher = new PhysicsTeacher();
            return currentTeacher;
        }

        // Content validation - ensures only relevant content is displayed and narrated
        function isContentRelevantToCurrentTask(contentType) {
            // Get currently active demo
            const activeDemos = document.querySelectorAll('.weight-demo.active, .formula-demo.active, .comparison-demo.active, .calculation-demo.active, .ratio-demo.active');
            
            if (activeDemos.length === 0) {
                return false; // No active demo
            }
            
            const activeDemo = activeDemos[0];
            const demoId = activeDemo.id;
            
            // Map content types to their relevant demos
            const contentMapping = {
                'weight-comparison': ['weight-demo'],
                'formula-derivation': ['formula-demo'],
                'mass-vs-weight': ['comparison-demo'],
                'calculations': ['calculation-demo'],
                'ratio-demo': ['ratio-demo']
            };
            
            // Check if current content type matches active demo
            return contentMapping[contentType] && contentMapping[contentType].includes(demoId);
        }
        
        // Enhanced speak function that checks content relevance
        async function speakIfRelevant(teacher, text, contentType, taskId) {
            if (!teacher || !text) return;
            
            // Check if content is relevant to current screen
            if (!isContentRelevantToCurrentTask(contentType)) {
                return; // Skip narration if content doesn't match current screen
            }
            
            // Check if task is still active
            if (!shouldContinue(taskId)) {
                return;
            }
            
            await teacher.speak(text);
        }

        // Initialize
        window.addEventListener('load', () => {
            const teacher = createNewTeacher('initialization');
            teacher.speak("Welcome to Understanding Weight! Let's explore how mass and weight are different, and why you would weigh less on the Moon!");
        });

        // Complete Lesson
        async function playCompleteLesson() {
            const taskId = 'complete-lesson';
            stopCurrentDemo();
            isPlaying = true;
            setActiveButton(0);
            
            const teacher = createNewTeacher(taskId);
            
            await resetAll();
            await wait(100);
            if (!shouldContinue(taskId)) return;
            
            updateTitle("📚 Complete NCERT Lesson: Weight");
            
            await teacher.speak("Let's begin our complete lesson on Weight from NCERT Chapter 9. We'll understand what weight is and how it differs from mass.");
            if (!shouldContinue(taskId)) return;
            
            // Start with weight comparison - enhanced with planet info
            await showWeightComparisonInternal(teacher, taskId);
            if (!shouldContinue(taskId)) return;
            
            await wait(2000);
            
            // Show formula derivation
            await teacher.speak("Now let's understand the mathematical foundation behind weight.");
            if (!shouldContinue(taskId)) return;
            await showFormulaDemonstrationInternal(teacher, taskId);
            if (!shouldContinue(taskId)) return;
            await wait(2000);
            
            // Mass vs Weight
            await teacher.speak("It's crucial to understand the difference between mass and weight.");
            if (!shouldContinue(taskId)) return;
            await showMassVsWeightInternal(teacher, taskId);
            if (!shouldContinue(taskId)) return;
            await wait(2000);
            
            // NCERT Examples
            await teacher.speak("Let's solve the NCERT example problems to apply our understanding.");
            if (!shouldContinue(taskId)) return;
            await showCalculationsInternal(teacher, taskId);
            if (!shouldContinue(taskId)) return;
            await wait(2000);
            
            // Ratio demonstration
            await teacher.speak("Finally, let's visualize why weight on Moon is exactly one-sixth of weight on Earth.");
            if (!shouldContinue(taskId)) return;
            await showRatioDemoInternal(teacher, taskId);
            if (!shouldContinue(taskId)) return;
            
            await teacher.speak("Excellent! You now understand that weight is a force that varies with location, while mass remains constant. This is why astronauts can jump so high on the Moon!");
            
            isPlaying = false;
        }

        // Weight Comparison Demo
        async function showWeightComparison() {
            const taskId = 'weight-comparison';
            stopCurrentDemo();
            isPlaying = true;
            setActiveButton(1);
            
            const teacher = createNewTeacher(taskId);
            await showWeightComparisonInternal(teacher, taskId);
            
            isPlaying = false;
        }

        async function showWeightComparisonInternal(teacher, taskId = 'weight-comparison') {
            await resetAll();
            await wait(50);
            if (!shouldContinue(taskId)) return;
            
            updateTitle("🌍🌙 Weight on Earth vs Moon");
            
            document.getElementById('weight-demo').classList.add('active');
            await wait(50);
            if (!shouldContinue(taskId)) return;
            
            await teacher.speak("Let's compare the weight of the same 10 kilogram object on Earth and Moon.");
            if (!shouldContinue(taskId)) return;
            
            // Enhanced Earth weight demonstration with container activation
            await showEarthWeightWithNarration(teacher, taskId);
            if (!shouldContinue(taskId)) return;
            
            await wait(1000);
            
            // Enhanced Moon weight demonstration with container activation
            await showMoonWeightWithNarration(teacher, taskId);
            if (!shouldContinue(taskId)) return;
            
            await wait(1500);
            
            // Demonstrate falling objects with different speeds
            await teacher.speak("Watch how objects fall at different rates due to different gravitational strengths!");
            if (!shouldContinue(taskId)) return;
            
            await demonstrateFallingWithNarration(teacher, taskId);
            if (!shouldContinue(taskId)) return;
            
            await teacher.speak("This demonstrates why astronauts can jump so high on the Moon - same mass, but much less weight!");

             // Show planet information for educational context
            await teacher.speak("Let me show you the planetary data that explains these differences.");
            if (!shouldContinue(taskId)) return;
            await showPlanetInfo('earth');
            if (!shouldContinue(taskId)) return;
            await showPlanetInfo('moon');
            if (!shouldContinue(taskId)) return;
        }

        // Enhanced animation functions with synchronized narration
        async function showEarthWeightWithNarration(teacher, taskId) {
            // Activate Earth container with visual focus
            document.getElementById('earth-container').classList.add('active');
            await wait(800);
            if (!shouldContinue(taskId)) return;
            
            await teacher.speak("First, let's look at Earth. Notice how the container lights up to show we're focusing on Earth's gravity.");
            if (!shouldContinue(taskId)) return;
            
            await wait(500);
            
            // Show the gravitational force arrow
            document.getElementById('earth-arrow').classList.add('visible');
            await wait(800);
            if (!shouldContinue(taskId)) return;
            
            await teacher.speak("See this red arrow? It represents the gravitational force pulling the object downward. The longer arrow shows stronger force.");
            if (!shouldContinue(taskId)) return;
            
            await wait(500);
            
            // Show the weight calculation
            document.getElementById('earth-weight').classList.add('visible');
            await wait(800);
            if (!shouldContinue(taskId)) return;
            
            await teacher.speak("Using the formula W equals m times g, we get 10 kilograms times 9.8 meters per second squared, which equals 98 Newtons!");
            if (!shouldContinue(taskId)) return;
            
            await wait(1000);
        }

        async function showMoonWeightWithNarration(teacher, taskId) {
            // Activate Moon container with visual focus
            document.getElementById('moon-container').classList.add('active');
            await wait(800);
            if (!shouldContinue(taskId)) return;
            
            await teacher.speak("Now let's examine the Moon. See how the Moon container is highlighted? This helps us compare the two environments.");
            if (!shouldContinue(taskId)) return;
            
            await wait(500);
            
            // Show the weaker gravitational force arrow
            document.getElementById('moon-arrow').classList.add('visible');
            await wait(800);
            if (!shouldContinue(taskId)) return;
            
            await teacher.speak("Look at this red arrow on the Moon - it's much shorter! This shows the Moon's weaker gravitational pull. Same object, weaker force!");
            if (!shouldContinue(taskId)) return;
            
            await wait(500);
            
            // Show the weight calculation
            document.getElementById('moon-weight').classList.add('visible');
            await wait(800);
            if (!shouldContinue(taskId)) return;
            
            await teacher.speak("On the Moon, the same 10 kilogram object weighs only 16.3 Newtons. That's about one-sixth of its Earth weight!");
            if (!shouldContinue(taskId)) return;
            
            await wait(1000);
        }

        async function demonstrateFallingWithNarration(teacher, taskId) {
            await teacher.speak("Watch carefully as both objects start falling. Notice the timing difference!");
            if (!shouldContinue(taskId)) return;
            
            await wait(500);
            
            // Start Earth object falling first
            document.getElementById('earth-object').classList.add('falling');
            await wait(300);
            if (!shouldContinue(taskId)) return;
            
            await teacher.speak("The Earth object falls faster due to stronger gravity...");
            if (!shouldContinue(taskId)) return;
            
            // Start Moon object falling - slower due to weaker gravity
            document.getElementById('moon-object').classList.add('falling');
            await wait(1500);
            if (!shouldContinue(taskId)) return;
            
            await teacher.speak("While the Moon object falls more slowly. This demonstrates how gravitational strength affects motion!");
            if (!shouldContinue(taskId)) return;
            
            await wait(1000);
        }

        // Formula Demonstration
        async function showFormulaDemonstration() {
            const taskId = 'formula-demonstration';
            stopCurrentDemo();
            isPlaying = true;
            setActiveButton(2);
            
            const teacher = createNewTeacher(taskId);
            await showFormulaDemonstrationInternal(teacher, taskId);
            
            isPlaying = false;
        }

        async function showFormulaDemonstrationInternal(teacher, taskId = 'formula-demonstration') {
            await resetAll();
            await wait(50);
            if (!shouldContinue(taskId)) return;
            
            updateTitle("📐 Mathematical Foundation of Weight");
            
            document.getElementById('formula-demo').classList.add('active');
            await wait(50);
            if (!shouldContinue(taskId)) return;
            
            await teacher.speak("Let's derive the weight formula step by step, starting with Newton's fundamental laws. Watch as we scroll through each step horizontally.");
            if (!shouldContinue(taskId)) return;
            
            // Step 1
            document.getElementById('step1').classList.add('show');
            await scrollToDerivationStep('step1');
            await wait(1500);
            if (!shouldContinue(taskId)) return;
            await teacher.speak("Newton's Second Law states that force equals mass times acceleration.");
            
            await wait(2000);
            if (!shouldContinue(taskId)) return;
            
            // Step 2
            document.getElementById('step2').classList.add('show');
            await scrollToDerivationStep('step2');
            await wait(1500);
            if (!shouldContinue(taskId)) return;
            await teacher.speak("Weight is the gravitational force on an object. Since gravity causes acceleration g, we get W equals m g.");
            
            await wait(2500);
            if (!shouldContinue(taskId)) return;
            
            // Step 3
            document.getElementById('step3').classList.add('show');
            await scrollToDerivationStep('step3');
            await wait(1500);
            if (!shouldContinue(taskId)) return;
            await teacher.speak("The Universal Law of Gravitation tells us that gravitational force depends on masses and distance squared.");
            
            await wait(2500);
            if (!shouldContinue(taskId)) return;
            
            // Step 4
            document.getElementById('step4').classList.add('show');
            await scrollToDerivationStep('step4');
            await wait(1500);
            if (!shouldContinue(taskId)) return;
            await teacher.speak("For an object on a planet's surface, weight equals the gravitational force between object and planet.");
            
            await wait(2500);
            if (!shouldContinue(taskId)) return;
            
            // Step 5
            document.getElementById('step5').classList.add('show');
            await scrollToDerivationStep('step5');
            await wait(1500);
            if (!shouldContinue(taskId)) return;
            await teacher.speak("By comparing the two expressions for weight, we derive that g equals G M over R squared. This shows g depends only on the planet's properties!");
        }

        // Helper function to scroll to derivation steps
        async function scrollToDerivationStep(stepId) {
            const step = document.getElementById(stepId);
            const container = document.querySelector('.derivation-container');
            
            if (step && container) {
                const scrollPosition = step.offsetLeft - (container.parentElement.clientWidth / 2) + (step.clientWidth / 2);
                container.parentElement.scrollTo({
                    left: Math.max(0, scrollPosition),
                    behavior: 'smooth'
                });
                await wait(800);
            }
        }

        // Mass vs Weight Demo
        async function showMassVsWeight() {
            const taskId = 'mass-vs-weight';
            stopCurrentDemo();
            isPlaying = true;
            setActiveButton(3);
            
            const teacher = createNewTeacher(taskId);
            await showMassVsWeightInternal(teacher, taskId);
            
            isPlaying = false;
        }

        async function showMassVsWeightInternal(teacher, taskId = 'mass-vs-weight') {
            await resetAll();
            await wait(50);
            if (!shouldContinue(taskId)) return;
            
            updateTitle("⚖️ Mass vs Weight - Key Differences");
            
            document.getElementById('comparison-demo').classList.add('active');
            await wait(50);
            if (!shouldContinue(taskId)) return;
            
            await teacher.speak("Many students confuse mass and weight. Let's understand their key differences clearly.");
            if (!shouldContinue(taskId)) return;
            
            await wait(1000);
            
            await teacher.speak("Mass is the amount of matter in an object. It's measured in kilograms and remains constant everywhere in the universe.");
            if (!shouldContinue(taskId)) return;
            
            await wait(2000);
            
            await teacher.speak("Weight is the gravitational force acting on that mass. It's measured in Newtons and changes with location because gravity varies.");
            if (!shouldContinue(taskId)) return;
            
            await wait(2000);
            
            await teacher.speak("Remember: Mass is what you are, weight is how much the planet pulls on you!");
        }

        // Calculations Demo
        async function showCalculations() {
            const taskId = 'calculations';
            stopCurrentDemo();
            isPlaying = true;
            setActiveButton(4);
            
            const teacher = createNewTeacher(taskId);
            await showCalculationsInternal(teacher, taskId);
            
            isPlaying = false;
        }

        async function showCalculationsInternal(teacher, taskId = 'calculations') {
            await resetAll();
            await wait(50);
            if (!shouldContinue(taskId)) return;
            
            updateTitle("🧮 NCERT Example Problems");
            
            document.getElementById('calculation-demo').classList.add('active');
            await wait(50);
            if (!shouldContinue(taskId)) return;
            
            await teacher.speak("Let's solve the NCERT example problems step by step. Use the buttons below to navigate between examples.");
            if (!shouldContinue(taskId)) return;
            
            await wait(1000);
            
            // Start with Example 9.4 using the isolated system
            slideToExample(0);
            
        }

        // Slider functionality for NCERT examples
        let currentSlide = 0;
        let exampleNarrationTimeouts = [];

        function slideToExample(slideIndex) {
            const container = document.getElementById('examples-container');
            const buttons = document.querySelectorAll('.slider-btn');
            
            // Only allow slider interaction if calculations demo is active
            const calculationDemo = document.getElementById('calculation-demo');
            if (!calculationDemo || !calculationDemo.classList.contains('active')) {
                return;
            }
            
            if (container && slideIndex >= 0 && slideIndex < 2) {
                // Stop current narration and clear timeouts
                stopExampleNarration();
                
                currentSlide = slideIndex;
                
                // Move the container
                const translateX = -slideIndex * 50; // 50% per slide
                container.style.transform = `translateX(${translateX}%)`;
                
                // Update button states
                buttons.forEach((btn, index) => {
                    btn.classList.toggle('active', index === slideIndex);
                });
                
                // Update example section visual states
                const exampleSections = document.querySelectorAll('.example-section');
                exampleSections.forEach((section, index) => {
                    section.classList.toggle('active-example', index === slideIndex);
                });
                
                // Reset all example animations
                resetExampleAnimations();
                
                // Start isolated narration for the selected example
                if (currentTeacher && currentTaskId === 'calculations') {
                    startIsolatedExampleNarration(slideIndex);
                }
            }
        }

        // Stop current example narration and clear timeouts
        function stopExampleNarration() {
            // Clear all narration timeouts
            exampleNarrationTimeouts.forEach(timeout => clearTimeout(timeout));
            exampleNarrationTimeouts = [];
            
            // Stop current speech
            if (currentTeacher) {
                currentTeacher.stop();
            }
        }

        // Reset all example animations
        function resetExampleAnimations() {
            // Reset all solution steps
            document.querySelectorAll('.solution-step, .answer-highlight').forEach(step => {
                step.classList.remove('show');
            });
        }

        // Start isolated narration for a specific example
        async function startIsolatedExampleNarration(exampleIndex) {
            if (!currentTeacher || currentTaskId !== 'calculations') return;
            
            const teacher = currentTeacher;
            const taskId = currentTaskId;
            
            if (exampleIndex === 0) {
                // Example 9.4 narration
                await teacher.speak("Example 9.4: Find the weight of a 10 kilogram object on Earth.");
                if (!shouldContinue(taskId)) return;
                
                document.getElementById('calc-step1').classList.add('show');
                exampleNarrationTimeouts.push(setTimeout(async () => {
                    if (!shouldContinue(taskId)) return;
                    await teacher.speak("Given: mass is 10 kilograms, and g is 9.8 meters per second squared.");
                    
                    exampleNarrationTimeouts.push(setTimeout(() => {
                        if (!shouldContinue(taskId)) return;
                        document.getElementById('calc-step2').classList.add('show');
                        exampleNarrationTimeouts.push(setTimeout(async () => {
                            if (!shouldContinue(taskId)) return;
                            await teacher.speak("We use the formula: Weight equals mass times g.");
                            
                            exampleNarrationTimeouts.push(setTimeout(() => {
                                if (!shouldContinue(taskId)) return;
                                document.getElementById('calc-step3').classList.add('show');
                                exampleNarrationTimeouts.push(setTimeout(async () => {
                                    if (!shouldContinue(taskId)) return;
                                    await teacher.speak("Calculating: 10 times 9.8 equals 98 Newtons.");
                                    
                                    exampleNarrationTimeouts.push(setTimeout(() => {
                                        if (!shouldContinue(taskId)) return;
                                        document.getElementById('calc-answer1').classList.add('show');
                                    }, 2000));
                                }, 1500));
                            }, 2000));
                        }, 1500));
                    }, 2000));
                }, 1500));
                
            } else if (exampleIndex === 1) {
                // Example 9.5 narration
                await teacher.speak("Example 9.5: If an object weighs 10 Newtons on Earth, what's its weight on Moon?");
                if (!shouldContinue(taskId)) return;
                
                document.getElementById('calc-step4').classList.add('show');
                exampleNarrationTimeouts.push(setTimeout(async () => {
                    if (!shouldContinue(taskId)) return;
                    await teacher.speak("We know that weight on Moon equals one-sixth of weight on Earth.");
                    
                    exampleNarrationTimeouts.push(setTimeout(() => {
                        if (!shouldContinue(taskId)) return;
                        document.getElementById('calc-step5').classList.add('show');
                        exampleNarrationTimeouts.push(setTimeout(async () => {
                            if (!shouldContinue(taskId)) return;
                            await teacher.speak("So, 10 Newtons divided by 6 equals 1.67 Newtons.");
                            
                            exampleNarrationTimeouts.push(setTimeout(() => {
                                if (!shouldContinue(taskId)) return;
                                document.getElementById('calc-answer2').classList.add('show');
                            }, 2000));
                        }, 1500));
                    }, 2500));
                }, 1500));
            }
        }

        // Ratio Demo
        async function showRatioDemo() {
            const taskId = 'ratio-demo';
            stopCurrentDemo();
            isPlaying = true;
            setActiveButton(5);
            
            const teacher = createNewTeacher(taskId);
            await showRatioDemoInternal(teacher, taskId);
            
            isPlaying = false;
        }

        async function showRatioDemoInternal(teacher, taskId = 'ratio-demo') {
            await resetAll();
            await wait(50);
            if (!shouldContinue(taskId)) return;
            
            updateTitle("📊 Why Moon Weight = (1/6) × Earth Weight");
            
            document.getElementById('ratio-demo').classList.add('active');
            await wait(50);
            if (!shouldContinue(taskId)) return;
            
            await teacher.speak("Let's visualize why weight on Moon is exactly one-sixth of weight on Earth using the same comparison format.");
            if (!shouldContinue(taskId)) return;
            
            await wait(1000);
            
            // Show Earth weight with animation
            await showRatioEarthWeight(teacher, taskId);
            if (!shouldContinue(taskId)) return;
            
            await wait(1500);
            
            // Show Moon weight with animation
            await showRatioMoonWeight(teacher, taskId);
            if (!shouldContinue(taskId)) return;
            
            await wait(2000);
            
            await teacher.speak("Notice the dramatic difference in arrow lengths! The Moon's arrow is exactly one-sixth the length, representing one-sixth the gravitational force.");
            if (!shouldContinue(taskId)) return;
            
            await wait(2000);
            
            await teacher.speak("This happens because the Moon has much less mass and smaller radius than Earth, resulting in weaker surface gravity.");
        }

        // Helper functions for ratio demo animations
        async function showRatioEarthWeight(teacher, taskId) {
            // Activate Earth container with visual focus
            document.getElementById('ratio-earth-container').classList.add('active');
            await wait(800);
            if (!shouldContinue(taskId)) return;
            
            await teacher.speak("First, Earth's gravitational pull on our 10 kilogram object.");
            if (!shouldContinue(taskId)) return;
            
            // Show the gravitational force arrow
            document.getElementById('ratio-earth-arrow').classList.add('visible');
            await wait(800);
            if (!shouldContinue(taskId)) return;
            
            // Show the weight calculation
            document.getElementById('ratio-earth-weight').classList.add('visible');
            await wait(800);
            if (!shouldContinue(taskId)) return;
            
            await teacher.speak("98 Newtons of force - this is our reference point.");
            if (!shouldContinue(taskId)) return;
        }

        async function showRatioMoonWeight(teacher, taskId) {
            // Activate Moon container with visual focus
            document.getElementById('ratio-moon-container').classList.add('active');
            await wait(800);
            if (!shouldContinue(taskId)) return;
            
            await teacher.speak("Now the Moon's much weaker gravitational pull on the same object.");
            if (!shouldContinue(taskId)) return;
            
            // Show the weaker gravitational force arrow
            document.getElementById('ratio-moon-arrow').classList.add('visible');
            await wait(800);
            if (!shouldContinue(taskId)) return;
            
            // Show the weight calculation
            document.getElementById('ratio-moon-weight').classList.add('visible');
            await wait(800);
            if (!shouldContinue(taskId)) return;
            
            await teacher.speak("Only 16.3 Newtons - exactly one-sixth of Earth's pull! The visual comparison makes this relationship crystal clear.");
            if (!shouldContinue(taskId)) return;
        }

        // Helper Functions
        async function resetAll() {
            // Stop example narration and clear timeouts first
            stopExampleNarration();
            
            if (animationTimeline) {
                animationTimeline.kill();
                animationTimeline = null;
            }
            gsap.killTweensOf("*");
            
            activeAnimations.forEach(anim => {
                if (anim) anim.kill();
            });
            activeAnimations = [];
            
            if (currentTeacher) {
                currentTeacher.stop();
            }
            
            // Hide all demos
            document.querySelectorAll('.weight-demo, .formula-demo, .comparison-demo, .calculation-demo, .ratio-demo').forEach(demo => {
                demo.classList.remove('active');
            });
            
            updateTitle("Explore Weight on Different Celestial Bodies");
            
            // Reset objects with proper cleanup
            const objects = ['earth-object', 'moon-object', 'ratio-earth-object', 'ratio-moon-object'];
            objects.forEach(id => {
                const obj = document.getElementById(id);
                if (obj) {
                    obj.classList.remove('falling');
                    obj.style.top = '25%';
                    obj.style.transform = 'translateX(-50%)'; // Reset transform
                    obj.style.animation = 'none'; // Clear any running animations
                }
            });
            
            // Hide weight displays and arrows with cleanup
            const elements = ['earth-weight', 'moon-weight', 'earth-arrow', 'moon-arrow', 
                            'ratio-earth-weight', 'ratio-moon-weight', 'ratio-earth-arrow', 'ratio-moon-arrow'];
            elements.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.classList.remove('visible');
                    element.style.animation = 'none'; // Clear animations
                }
            });
            
            // Reset container states with animation cleanup
            const containers = ['earth-container', 'moon-container', 'ratio-earth-container', 'ratio-moon-container'];
            containers.forEach(id => {
                const container = document.getElementById(id);
                if (container) {
                    container.classList.remove('active');
                    container.style.animation = 'none'; // Clear pulsing animation
                }
            });
            
            // Hide planet info panels
            const infoPanels = ['earth-info', 'moon-info'];
            infoPanels.forEach(id => {
                const panel = document.getElementById(id);
                if (panel) {
                    panel.style.display = 'none';
                }
            });
            
            // Reset derivation steps
            document.querySelectorAll('.derivation-step').forEach(step => {
                step.classList.remove('show');
            });
            
            // Reset calculation steps
            resetExampleAnimations();
            
            // Reset slider to first example (but don't start narration automatically)
            currentSlide = 0;
            const container = document.getElementById('examples-container');
            const buttons = document.querySelectorAll('.slider-btn');
            if (container) {
                container.style.transform = 'translateX(0%)';
            }
            buttons.forEach((btn, index) => {
                btn.classList.toggle('active', index === 0);
            });
            
            await wait(500); // Longer wait to ensure all animations are cleared
        }

        function updateTitle(title) {
            document.getElementById('demo-title').textContent = title;
        }

        function setActiveButton(index) {
            document.querySelectorAll('.demo-btn').forEach((btn, i) => {
                btn.classList.toggle('active', i === index);
            });
        }

        function wait(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        // Additional helper functions from weight_old.html
        async function showPlanetInfo(planet) {
            const planetInfo = document.getElementById(`${planet}-info`);
            
            if (planetInfo) {
                planetInfo.style.display = 'block';
                await wait(1000);
            }
        }

        // Original functions for backward compatibility
        async function showEarthWeight() {
            document.getElementById('earth-container').classList.add('active');
            await wait(500);
            document.getElementById('earth-arrow').classList.add('visible');
            await wait(500);
            document.getElementById('earth-weight').classList.add('visible');
            await wait(1000);
        }

        async function showMoonWeight() {
            document.getElementById('moon-container').classList.add('active');
            await wait(500);
            document.getElementById('moon-arrow').classList.add('visible');
            await wait(500);
            document.getElementById('moon-weight').classList.add('visible');
            await wait(1000);
        }

        async function demonstrateFalling() {
            document.getElementById('earth-object').classList.add('falling');
            await wait(200);
            document.getElementById('moon-object').classList.add('falling');
        }

        // Reset Button Handler
        async function resetAllClick() {
            stopCurrentDemo();
            isPlaying = false;
            await resetAll();
        }

        // Weight Calculator
        function calculateWeight() {
            const mass = parseFloat(document.getElementById('mass-input').value);
            const location = document.getElementById('location-select').value;
            const resultDiv = document.getElementById('calculation-result');
            
            if (isNaN(mass) || mass <= 0) {
                resultDiv.innerHTML = '⚠️ Please enter a valid mass value';
                return;
            }
            
            const earthG = 9.8;
            const moonG = 1.63;
            
            if (location === 'earth') {
                const weight = (mass * earthG).toFixed(2);
                resultDiv.innerHTML = `
                    <div>
                        <strong>Earth Weight:</strong> ${weight} N<br>
                        <small>Formula: ${mass} kg × ${earthG} m/s² = ${weight} N</small>
                    </div>
                `;
                if (currentTeacher && !isPlaying) currentTeacher.speak(`On Earth, ${mass} kilograms weighs ${weight} Newtons.`);
            } else if (location === 'moon') {
                const weight = (mass * moonG).toFixed(2);
                resultDiv.innerHTML = `
                    <div>
                        <strong>Moon Weight:</strong> ${weight} N<br>
                        <small>Formula: ${mass} kg × ${moonG} m/s² = ${weight} N</small>
                    </div>
                `;
                if (currentTeacher && !isPlaying) currentTeacher.speak(`On the Moon, ${mass} kilograms weighs ${weight} Newtons.`);
            } else {
                const earthWeight = (mass * earthG).toFixed(2);
                const moonWeight = (mass * moonG).toFixed(2);
                const ratio = (moonWeight / earthWeight).toFixed(3);
                resultDiv.innerHTML = `
                    <div>
                        <strong>Earth:</strong> ${earthWeight} N | <strong>Moon:</strong> ${moonWeight} N<br>
                        <small>Moon weight is ${ratio} (≈1/6) of Earth weight</small>
                    </div>
                `;
                if (currentTeacher && !isPlaying) currentTeacher.speak(`${mass} kilograms weighs ${earthWeight} Newtons on Earth and ${moonWeight} Newtons on the Moon.`);
            }
        }

        // Audio Control
        document.getElementById('mute-btn').addEventListener('click', () => {
            globalAudioEnabled = !globalAudioEnabled;
            document.getElementById('mute-btn').classList.toggle('muted', !globalAudioEnabled);
            
            if (!globalAudioEnabled && currentTeacher) {
                currentTeacher.stop();
            }
        });

        // Keyboard support for calculator
        document.getElementById('mass-input').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                calculateWeight();
            }
        });
    </script>
</body>
</html>