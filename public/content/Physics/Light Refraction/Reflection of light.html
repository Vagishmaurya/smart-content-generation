<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reflection of Light - Physics in Motion</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 25%, #f093fb 75%, #fbbdff 100%);
            color: white;
            overflow-x: hidden;
            min-height: 100vh;
        }

        /* Audio Control */
        #audio-control {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
        }

        .control-btn {
            background: rgba(255, 204, 0, 0.9);
            border: none;
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            aria-label: "Toggle audio narration";
        }

        .control-btn:hover {
            transform: scale(1.1);
            background: rgba(255, 204, 0, 1);
        }

        .control-btn:focus {
            outline: 3px solid #fff;
            outline-offset: 2px;
        }

        .control-btn.muted .unmute-icon { display: none; }
        .control-btn:not(.muted) .mute-icon { display: none; }

        /* Main Container */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 30px 20px;
        }

        /* Hero Section */
        .hero {
            text-align: center;
            margin-bottom: 50px;
            padding: 40px 20px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 25px;
            backdrop-filter: blur(10px);
        }

        .hero h1 {
            font-size: 3.5rem;
            background: linear-gradient(45deg, #ffcc00, #ff9900, #ff6600);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 20px;
            font-weight: 700;
        }

        .hero p {
            font-size: 1.3rem;
            opacity: 0.95;
            max-width: 800px;
            margin: 0 auto;
            line-height: 1.6;
        }

        /* Interactive Stage */
        .interactive-stage {
            background: linear-gradient(to bottom, #1a1a2e, #16213e);
            border-radius: 25px;
            min-height: 500px;
            position: relative;
            margin: 40px 0;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.4);
            overflow: hidden;
            border: 3px solid rgba(255, 204, 0, 0.4);
            padding: 20px;
        }

        /* SVG Container */
        .svg-container {
            width: 100%;
            height: 400px;
            display: block;
            margin: 20px auto;
        }

        /* Laws Cards */
        .laws-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            margin: 40px 0;
        }

        .law-card {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            border: 2px solid rgba(255, 204, 0, 0.3);
            backdrop-filter: blur(10px);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .law-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
        }

        .law-card h3 {
            color: #ffcc00;
            font-size: 1.8rem;
            margin-bottom: 15px;
        }

        /* Controls */
        .controls {
            text-align: center;
            margin: 40px 0;
        }

        .controls-title {
            font-size: 2rem;
            margin-bottom: 25px;
            color: #ffcc00;
            font-weight: 600;
        }

        .demo-buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
            margin: 25px 0;
        }

        .demo-btn {
            background: linear-gradient(135deg, #ffcc00, #ff9900);
            border: none;
            color: white;
            padding: 16px 28px;
            border-radius: 35px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 8px 25px rgba(255, 204, 0, 0.3);
            min-width: 180px;
        }

        .demo-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 30px rgba(255, 204, 0, 0.4);
        }

        .demo-btn:focus {
            outline: 3px solid #fff;
            outline-offset: 2px;
        }

        .demo-btn:active {
            transform: translateY(-1px);
        }

        .demo-btn.active {
            background: linear-gradient(135deg, #4caf50, #2e7d32);
            box-shadow: 0 8px 25px rgba(76, 175, 80, 0.4);
        }

        /* Activity Section */
        .activity-section {
            background: rgba(0, 0, 0, 0.5);
            border-radius: 25px;
            padding: 35px;
            margin: 35px 0;
            border: 3px solid rgba(255, 204, 0, 0.4);
            backdrop-filter: blur(15px);
        }

        .activity-title {
            font-size: 1.8rem;
            color: #ffcc00;
            margin-bottom: 25px;
            text-align: center;
            font-weight: 600;
        }

        .activity-steps {
            display: grid;
            gap: 20px;
            margin-top: 20px;
        }

        .activity-step {
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            border-radius: 15px;
            border-left: 4px solid #ffcc00;
        }

        .step-number {
            color: #ffcc00;
            font-weight: bold;
            font-size: 1.2rem;
            margin-bottom: 10px;
        }

        /* Worked Example */
        .example-section {
            background: rgba(0, 0, 0, 0.5);
            border-radius: 25px;
            padding: 35px;
            margin: 35px 0;
            border: 3px solid rgba(255, 204, 0, 0.4);
        }

        .example-title {
            font-size: 1.8rem;
            color: #ffcc00;
            margin-bottom: 25px;
            text-align: center;
        }

        .example-content {
            background: rgba(255, 255, 255, 0.05);
            padding: 25px;
            border-radius: 15px;
        }

        .properties-list {
            list-style: none;
            padding: 0;
            margin: 20px 0;
        }

        .properties-list li {
            padding: 12px;
            margin: 10px 0;
            background: rgba(76, 175, 80, 0.1);
            border-radius: 10px;
            border-left: 3px solid #4caf50;
        }

        /* Summary Card */
        .summary-card {
            background: linear-gradient(135deg, rgba(255, 204, 0, 0.2), rgba(255, 153, 0, 0.2));
            border-radius: 25px;
            padding: 40px;
            margin: 40px 0;
            border: 3px solid rgba(255, 204, 0, 0.4);
        }

        .summary-title {
            font-size: 2rem;
            color: #ffcc00;
            text-align: center;
            margin-bottom: 30px;
        }

        .key-points {
            display: grid;
            gap: 20px;
        }

        .key-point {
            background: rgba(0, 0, 0, 0.3);
            padding: 20px;
            border-radius: 15px;
            border-left: 4px solid #ffcc00;
        }

        .key-point h4 {
            color: #ffcc00;
            margin-bottom: 10px;
            font-size: 1.2rem;
        }

        /* Animation Classes */
        @keyframes rayAnimation {
            0% { stroke-dashoffset: 300; opacity: 0; }
            50% { opacity: 1; }
            100% { stroke-dashoffset: 0; opacity: 1; }
        }

        @keyframes angleHighlight {
            0%, 100% { fill-opacity: 0.1; }
            50% { fill-opacity: 0.3; }
        }

        @keyframes pulseGlow {
            0%, 100% { filter: drop-shadow(0 0 5px rgba(255, 204, 0, 0.5)); }
            50% { filter: drop-shadow(0 0 15px rgba(255, 204, 0, 0.8)); }
        }

        .animated-ray {
            stroke-dasharray: 300;
            stroke-dashoffset: 300;
            animation: rayAnimation 2s ease-out forwards;
        }

        .angle-arc {
            animation: angleHighlight 2s ease-in-out infinite;
        }

        .glow-element {
            animation: pulseGlow 2s ease-in-out infinite;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .hero h1 {
                font-size: 2.5rem;
            }
            
            .interactive-stage {
                min-height: 400px;
            }
            
            .demo-buttons {
                flex-direction: column;
                align-items: center;
            }
            
            .laws-container {
                grid-template-columns: 1fr;
            }
        }

        /* Reduced Motion Support */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.001s !important;
                transition-duration: 0.001s !important;
            }
        }

        /* Skip to Content Link */
        .skip-link {
            position: absolute;
            top: -40px;
            left: 0;
            background: #ffcc00;
            color: #000;
            padding: 8px;
            text-decoration: none;
            z-index: 100;
        }

        .skip-link:focus {
            top: 0;
        }
    </style>
</head>
<body>
    <!-- Skip to Content for Accessibility -->
    <a href="#main-content" class="skip-link">Skip to main content</a>

    <!-- Audio Control -->
    <div id="audio-control">
        <button id="mute-btn" class="control-btn" aria-label="Toggle audio narration">
            <span class="unmute-icon">üîä</span>
            <span class="mute-icon">üîá</span>
        </button>
    </div>

    <div class="container" id="main-content">
        <!-- Hero Section -->
        <header class="hero">
            <h1>Reflection of Light</h1>
            <p>Explore how light bounces off surfaces! Learn the fundamental laws of reflection and discover how mirrors create images through interactive demonstrations.</p>
        </header>

        <!-- Laws of Reflection Cards -->
        <section class="laws-container" role="region" aria-label="Laws of Reflection">
            <div class="law-card">
                <h3>üìê First Law</h3>
                <p>The angle of incidence (i) equals the angle of reflection (r). Light bounces off surfaces at the same angle it arrives, measured from the normal line.</p>
            </div>
            <div class="law-card">
                <h3>üéØ Second Law</h3>
                <p>The incident ray, the normal, and the reflected ray all lie in the same plane. This creates a predictable path for light reflection.</p>
            </div>
        </section>

        <!-- Interactive Stage -->
        <section class="interactive-stage" role="region" aria-label="Interactive Reflection Demonstration">
            <div id="stage-content">
                <svg id="reflection-demo" class="svg-container" viewBox="0 0 800 400" aria-label="Reflection demonstration">
                    <!-- SVG content will be dynamically generated -->
                </svg>
            </div>
        </section>

        <!-- Controls -->
        <section class="controls" role="region" aria-label="Demo Controls">
            <h2 class="controls-title" id="lesson-title">Explore Light Reflection</h2>
            
            <div class="demo-buttons" role="group" aria-label="Demonstration buttons">
                <button class="demo-btn" onclick="playStoryMode()" aria-label="Play complete story mode">üìñ Story Mode</button>
                <button class="demo-btn" onclick="showPlaneReflection()" aria-label="Show plane mirror reflection">ü™û Plane Mirror</button>
                <button class="demo-btn" onclick="showSpoonDemo()" aria-label="Show spoon demonstration">ü•Ñ Spoon Demo</button>
                <button class="demo-btn" onclick="showLawsDemo()" aria-label="Show laws of reflection">üìê Laws Demo</button>
                <button class="demo-btn" onclick="resetDemo()" aria-label="Reset demonstration">üîÑ Reset</button>
            </div>
        </section>

        <!-- Activity 9.1 Section -->
        <section class="activity-section" role="region" aria-label="Activity 9.1">
            <h2 class="activity-title">üî¨ Activity 9.1: Exploring Reflection with a Spoon</h2>
            
            <div class="activity-steps">
                <div class="activity-step">
                    <div class="step-number">Step 1</div>
                    <p>Take a large shining spoon. Try to view your face in its curved surfaces.</p>
                </div>
                <div class="activity-step">
                    <div class="step-number">Step 2</div>
                    <p>Look at the inner surface (concave side) - notice how your image appears. Is it upright or inverted? Larger or smaller?</p>
                </div>
                <div class="activity-step">
                    <div class="step-number">Step 3</div>
                    <p>Now look at the outer surface (convex side) - observe the differences. The image is always upright but smaller!</p>
                </div>
                <div class="activity-step">
                    <div class="step-number">Observation</div>
                    <p>The curved surfaces follow the same laws of reflection as plane surfaces, but create different types of images due to their curvature.</p>
                </div>
            </div>
        </section>

        <!-- Worked Example -->
        <section class="example-section" role="region" aria-label="Worked Example">
            <h2 class="example-title">üìö Worked Example: Plane Mirror Image Properties</h2>
            
            <div class="example-content">
                <div class="problem-statement">
                    <strong>Question:</strong> A person stands 2 meters in front of a plane mirror. Describe the properties of the image formed.
                </div>
                
                <ul class="properties-list">
                    <li><strong>Virtual Image:</strong> The image appears to be behind the mirror but cannot be projected on a screen.</li>
                    <li><strong>Erect (Upright):</strong> The image has the same orientation as the object - not inverted.</li>
                    <li><strong>Same Size:</strong> The image height equals the object height - no magnification.</li>
                    <li><strong>Same Distance:</strong> The image appears 2 meters behind the mirror (total distance = 4m from person).</li>
                    <li><strong>Laterally Inverted:</strong> Left appears as right and vice versa - that's why ambulance is written in reverse!</li>
                </ul>
            </div>
        </section>

        <!-- Summary Card -->
        <section class="summary-card" role="region" aria-label="Key Takeaways">
            <h2 class="summary-title">üéì Key Takeaways</h2>
            
            <div class="key-points">
                <div class="key-point">
                    <h4>Laws of Reflection</h4>
                    <p>1) Angle of incidence = Angle of reflection. 2) Incident ray, normal, and reflected ray lie in the same plane. These laws apply to all surfaces!</p>
                </div>
                <div class="key-point">
                    <h4>Plane Mirror Images</h4>
                    <p>Virtual, erect, same size, same distance behind mirror, and laterally inverted. Perfect for everyday use!</p>
                </div>
                <div class="key-point">
                    <h4>Curved Surfaces</h4>
                    <p>Concave surfaces can form real or virtual images. Convex surfaces always form virtual, diminished images. Both follow reflection laws!</p>
                </div>
                <div class="key-point">
                    <h4>Applications</h4>
                    <p>Periscopes, kaleidoscopes, car mirrors, telescopes, and solar cookers all use reflection principles!</p>
                </div>
            </div>
        </section>
    </div>

    <script>
        // Voice System
        class ReflectionNarrator {
            constructor() {
                this.isEnabled = true;
                this.currentUtterance = null;
                this.settings = { rate: 0.9, pitch: 1.0, volume: 0.85 };
                this.isDestroyed = false;
            }

            async speak(text, delay = 0) {
                if (!this.isEnabled || !text || this.isDestroyed) return;
                
                return new Promise((resolve) => {
                    setTimeout(() => {
                        if (this.isDestroyed) {
                            resolve();
                            return;
                        }
                        this.stop();
                        const utterance = new SpeechSynthesisUtterance(text);
                        Object.assign(utterance, this.settings);
                        
                        utterance.onend = resolve;
                        utterance.onerror = resolve;
                        
                        this.currentUtterance = utterance;
                        speechSynthesis.speak(utterance);
                    }, delay);
                });
            }

            stop() {
                speechSynthesis.cancel();
                this.currentUtterance = null;
            }

            toggle() {
                this.isEnabled = !this.isEnabled;
                if (!this.isEnabled) this.stop();
                return this.isEnabled;
            }
            
            destroy() {
                this.isDestroyed = true;
                this.stop();
                this.currentUtterance = null;
                this.settings = null;
            }
        }

        // Global state management
        let narrator = new ReflectionNarrator();
        let isPlaying = false;
        let currentDemoAborted = false;
        let activeAnimations = [];
        let currentRunId = 0;
        let currentTaskId = null; // Track current task ID

        // Initialize
        window.addEventListener('load', () => {
            narrator.speak("Welcome to Reflection of Light! Discover how light bounces off surfaces and creates images. Let's explore the fascinating world of reflection!");
            drawInitialDiagram();
        });

        // Draw initial diagram
        function drawInitialDiagram() {
            const svg = document.getElementById('reflection-demo');
            svg.innerHTML = `
                <defs>
                    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto">
                        <polygon points="0 0, 10 3.5, 0 7" fill="#ffcc00" />
                    </marker>
                </defs>
                <text x="400" y="200" text-anchor="middle" fill="#ffcc00" font-size="24" font-weight="bold">
                </text>
            `;
        }

        // Complete Story Mode
        async function playStoryMode() {
            const taskId = 'story-mode';
            resetDemo();
            await wait(200);
            
            isPlaying = true;
            currentDemoAborted = false;
            currentTaskId = taskId;
            const runId = ++currentRunId;
            setActiveButton(0);
            
            if (!narrator) {
                narrator = new ReflectionNarrator();
            }
            
            updateTitle("üìñ The Complete Story of Light Reflection");
            
            // Chapter 1: Introduction
            await narrator.speak("Chapter 1: What is reflection? When light hits a surface, it bounces back! This bouncing of light is called reflection.");
            if (!shouldContinue(taskId)) return;
            
            await drawPlaneReflection();
            await wait(1000);
            
            await narrator.speak("Every smooth surface acts like a mirror. Light rays follow precise mathematical rules when they reflect.");
            if (!shouldContinue(taskId)) return;
            
            // Chapter 2: First Law
            await narrator.speak("Chapter 2: The First Law of Reflection. Watch carefully - the angle at which light arrives equals the angle at which it leaves!");
            if (!shouldContinue(taskId)) return;
            
            await animateFirstLaw();
            await wait(2000);
            
            await narrator.speak("The angle of incidence always equals the angle of reflection. This is measured from the normal - an imaginary line perpendicular to the surface.");
            if (!shouldContinue(taskId)) return;
            
            // Chapter 3: Second Law
            await narrator.speak("Chapter 3: The Second Law states that the incident ray, normal, and reflected ray all lie in the same plane. They form a flat, two-dimensional path.");
            if (!shouldContinue(taskId)) return;
            
            await highlightPlane();
            await wait(2000);
            
            // Chapter 4: Plane Mirror Properties
            await narrator.speak("Chapter 4: Let's explore plane mirror images. The image appears behind the mirror, at the same distance as the object in front.");
            if (!shouldContinue(taskId)) return;
            
            await drawMirrorImage();
            await wait(1000);
            
            await narrator.speak("The image is virtual - it can't be projected on a screen. It's erect, same size, but laterally inverted - left becomes right!");
            if (!shouldContinue(taskId)) return;
            
            // Chapter 5: Curved Surfaces
            await narrator.speak("Chapter 5: Now for Activity 9.1 - the spoon experiment! Curved surfaces also follow reflection laws but create different images.");
            if (!shouldContinue(taskId)) return;
            
            await drawSpoonDemo();
            await wait(1000);
            
            await narrator.speak("The concave side can form inverted or upright images depending on distance. The convex side always forms small, upright images!");
            if (!shouldContinue(taskId)) return;
            
            // Chapter 6: Laws Demonstration
            await narrator.speak("Chapter 6: Let's see both laws of reflection working together in a complete demonstration!");
            if (!shouldContinue(taskId)) return;
            
            // Use the reusable demonstrateLaws function
            await demonstrateLaws();
            if (!shouldContinue(taskId)) return;
            
            await narrator.speak("This completes our reflection journey! Remember: angle in equals angle out, and all rays stay in the same plane!");
            
            isPlaying = false;
        }

        // Plane Mirror Reflection Demo
        async function showPlaneReflection() {
            const taskId = 'plane-reflection';
            resetDemo();
            await wait(200);
            
            isPlaying = true;
            currentDemoAborted = false;
            currentTaskId = taskId;
            setActiveButton(1);
            
            if (!narrator) {
                narrator = new ReflectionNarrator();
            }
            
            updateTitle("ü™û Plane Mirror Reflection");
            
            await narrator.speak("Let's see how a plane mirror creates an image using the laws of reflection!");
            if (!shouldContinue(taskId)) return;
            
            await drawPlaneReflection();
            await wait(1000);
            
            await narrator.speak("Notice the normal line - perpendicular to the mirror surface. All angles are measured from this line.");
            if (!shouldContinue(taskId)) return;
            
            await animateFirstLaw();
            
            await narrator.speak("The incident angle equals the reflection angle. The image appears as far behind the mirror as the object is in front!");
            if (!shouldContinue(taskId)) return;
            
            await drawMirrorImage();
            
            await narrator.speak("The image is virtual, upright, same size, but laterally inverted - that's why text appears backwards in mirrors!");
            
            isPlaying = false;
        }

        // Spoon Demonstration
        async function showSpoonDemo() {
            const taskId = 'spoon-demo';
            resetDemo();
            await wait(200);
            
            isPlaying = true;
            currentDemoAborted = false;
            currentTaskId = taskId;
            setActiveButton(2);
            
            if (!narrator) {
                narrator = new ReflectionNarrator();
            }
            
            updateTitle("ü•Ñ Activity 9.1: Spoon Reflection");
            
            await narrator.speak("Let's perform Activity 9.1! A spoon has two curved surfaces that create different types of images.");
            if (!shouldContinue(taskId)) return;
            
            await drawSpoonDemo();
            await wait(1000);
            
            await narrator.speak("The inner concave surface can create inverted images when you're far, or upright images when very close.");
            if (!shouldContinue(taskId)) return;
            
            // Animation removed - labels are now static in drawSpoonDemo()
            
            await narrator.speak("The outer convex surface always creates small, upright virtual images - perfect for wide-angle viewing!");
            
            isPlaying = false;
        }

        // Core Laws Demonstration Logic (reusable)
        async function demonstrateLaws() {
            await drawPlaneReflection();
            await wait(1000);
            
            await narrator.speak("First Law: The angle of incidence equals the angle of reflection. Watch the angles!");
            if (!shouldContinue()) return;
            
            await animateFirstLaw();
            await wait(2000);
            
            await narrator.speak("Second Law: All three elements - incident ray, normal, and reflected ray - lie in the same flat plane.");
            if (!shouldContinue()) return;
            
            await highlightPlane();
            await wait(1000);
            
            await narrator.speak("These laws apply to ALL surfaces - plane, concave, convex - making reflection predictable and useful!");
        }

        // Laws Demonstration
        async function showLawsDemo() {
            const taskId = 'laws-demo';
            resetDemo();
            await wait(200);
            
            isPlaying = true;
            currentDemoAborted = false;
            currentTaskId = taskId;
            setActiveButton(3);
            
            if (!narrator) {
                narrator = new ReflectionNarrator();
            }
            
            updateTitle("üìê Laws of Reflection in Action");
            
            await narrator.speak("Let's see both laws of reflection working together!");
            if (!shouldContinue(taskId)) return;
            
            await demonstrateLaws();
            
            isPlaying = false;
        }

        // Drawing functions
        async function drawPlaneReflection() {
            const svg = document.getElementById('reflection-demo');
            svg.innerHTML = `
                <defs>
                    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto">
                        <polygon points="0 0, 10 3.5, 0 7" fill="#ffcc00" />
                    </marker>
                    <linearGradient id="mirrorGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                        <stop offset="0%" style="stop-color:#e0e0e0;stop-opacity:1" />
                        <stop offset="50%" style="stop-color:#ffffff;stop-opacity:1" />
                        <stop offset="100%" style="stop-color:#e0e0e0;stop-opacity:1" />
                    </linearGradient>
                </defs>
                
                <!-- Mirror -->
                <rect x="380" y="100" width="40" height="200" fill="url(#mirrorGradient)" stroke="#666" stroke-width="2"/>
                <text x="400" y="320" text-anchor="middle" fill="#ffcc00" font-size="16" font-weight="bold">Mirror</text>
                
                <!-- Normal -->
                <line x1="400" y1="200" x2="250" y2="200" stroke="#4caf50" stroke-width="2" stroke-dasharray="5,5" opacity="0.8"/>
                <text x="230" y="205" fill="#4caf50" font-size="14">Normal</text>
                
                <!-- Incident ray placeholder -->
                <g id="incident-ray-group"></g>
                
                <!-- Reflected ray placeholder -->
                <g id="reflected-ray-group"></g>
                
                <!-- Angle arcs placeholders -->
                <g id="angle-arcs"></g>
                
                <!-- Labels -->
                <text x="400" y="50" text-anchor="middle" fill="#ffcc00" font-size="22" font-weight="bold">Plane Mirror Reflection</text>
            `;
        }

        async function animateFirstLaw() {
            const svg = document.getElementById('reflection-demo');
            const incidentGroup = svg.querySelector('#incident-ray-group');
            const reflectedGroup = svg.querySelector('#reflected-ray-group');
            const angleArcs = svg.querySelector('#angle-arcs');
            
            // Draw incident ray
            incidentGroup.innerHTML = `
                <line x1="150" y1="100" x2="400" y2="200" stroke="#ff6600" stroke-width="3" 
                      marker-end="url(#arrowhead)" class="animated-ray" id="incident-ray"/>
                <text x="250" y="130" fill="#ff6600" font-size="14" font-weight="bold">Incident Ray</text>
            `;
            
            await wait(1000);
            
            // Draw angle of incidence (from normal to incident ray)
            angleArcs.innerHTML += `
                <path d="M 350 200 A 30 30 0 0 0 365 185" 
                      fill="none" stroke="#ff6600" stroke-width="2" opacity="0.8"/>
                <text x="310" y="165" fill="#ff6600" font-size="14" font-weight="bold">i = 30¬∞</text>
            `;
            
            await wait(1000);
            
            // Draw reflected ray
            reflectedGroup.innerHTML = `
                <line x1="400" y1="200" x2="150" y2="300" stroke="#ffcc00" stroke-width="3" 
                      marker-end="url(#arrowhead)" class="animated-ray" id="reflected-ray"/>
                <text x="250" y="270" fill="#ffcc00" font-size="14" font-weight="bold">Reflected Ray</text>
            `;
            
            await wait(1000);
            
            // Draw angle of reflection (from normal to reflected ray)
            angleArcs.innerHTML += `
                <path d="M 350 200 A 30 30 0 0 1 365 215" 
                      fill="none" stroke="#ffcc00" stroke-width="2" opacity="0.8"/>
                <text x="310" y="245" fill="#ffcc00" font-size="14" font-weight="bold">r = 30¬∞</text>
            `;
        }

        async function highlightPlane() {
            const svg = document.getElementById('reflection-demo');
            
            // Add plane highlight
            const plane = document.createElementNS("http://www.w3.org/2000/svg", "ellipse");
            plane.setAttribute("cx", "300");
            plane.setAttribute("cy", "200");
            plane.setAttribute("rx", "200");
            plane.setAttribute("ry", "120");
            plane.setAttribute("fill", "rgba(76, 175, 80, 0.1)");
            plane.setAttribute("stroke", "#4caf50");
            plane.setAttribute("stroke-width", "2");
            plane.setAttribute("stroke-dasharray", "10,5");
            plane.classList.add("angle-arc");
            
            svg.appendChild(plane);
            
            // Add label
            const text = document.createElementNS("http://www.w3.org/2000/svg", "text");
            text.setAttribute("x", "300");
            text.setAttribute("y", "350");
            text.setAttribute("text-anchor", "middle");
            text.setAttribute("fill", "#4caf50");
            text.setAttribute("font-size", "16");
            text.setAttribute("font-weight", "bold");
            text.textContent = "All rays in same plane";
            
            svg.appendChild(text);
        }

        async function drawMirrorImage() {
            const svg = document.getElementById('reflection-demo');
            
            // Clear the SVG completely for a clean demonstration
            svg.innerHTML = `
                <defs>
                    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto">
                        <polygon points="0 0, 10 3.5, 0 7" fill="#ffcc00" />
                    </marker>
                    <linearGradient id="mirrorGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                        <stop offset="0%" style="stop-color:#e0e0e0;stop-opacity:1" />
                        <stop offset="50%" style="stop-color:#ffffff;stop-opacity:1" />
                        <stop offset="100%" style="stop-color:#e0e0e0;stop-opacity:1" />
                    </linearGradient>
                </defs>
                
                <!-- Title -->
                <text x="400" y="50" text-anchor="middle" fill="#ffcc00" font-size="22" font-weight="bold">Plane Mirror Image Formation</text>
                
                <!-- Mirror -->
                <rect x="380" y="100" width="40" height="200" fill="url(#mirrorGradient)" stroke="#666" stroke-width="2"/>
                <text x="400" y="320" text-anchor="middle" fill="#ffcc00" font-size="16" font-weight="bold">Mirror</text>
                
                <!-- Object -->
                <circle cx="250" cy="200" r="20" fill="#ff6600" opacity="0.8"/>
                <text x="250" y="240" text-anchor="middle" fill="#ff6600" font-size="14">Object</text>
                <text x="250" y="260" text-anchor="middle" fill="#fff" font-size="12">2m from mirror</text>
            `;
            
            await wait(1000);
            
            // Add virtual image
            const imageGroup = document.createElementNS("http://www.w3.org/2000/svg", "g");
            imageGroup.innerHTML = `
                <circle cx="550" cy="200" r="20" fill="#ffcc00" opacity="0.5" stroke-dasharray="5,3"/>
                <text x="550" y="240" text-anchor="middle" fill="#ffcc00" font-size="14">Virtual Image</text>
                <text x="550" y="260" text-anchor="middle" fill="#fff" font-size="12">2m behind mirror</text>
            `;
            svg.appendChild(imageGroup);
            
            // Draw light rays showing image formation
            const rays = document.createElementNS("http://www.w3.org/2000/svg", "g");
            rays.innerHTML = `
                <line x1="250" y1="180" x2="400" y2="180" stroke="#ff6600" stroke-width="2" opacity="0.6"/>
                <line x1="400" y1="180" x2="200" y2="130" stroke="#ffcc00" stroke-width="2" opacity="0.6"/>
                <line x1="400" y1="180" x2="550" y2="180" stroke="#ffcc00" stroke-width="1" 
                      stroke-dasharray="5,3" opacity="0.4"/>
                
                <line x1="250" y1="220" x2="400" y2="220" stroke="#ff6600" stroke-width="2" opacity="0.6"/>
                <line x1="400" y1="220" x2="200" y2="270" stroke="#ffcc00" stroke-width="2" opacity="0.6"/>
                <line x1="400" y1="220" x2="550" y2="220" stroke="#ffcc00" stroke-width="1" 
                      stroke-dasharray="5,3" opacity="0.4"/>
            `;
            svg.appendChild(rays);
            
            // Add distance markers
            const distanceMarkers = document.createElementNS("http://www.w3.org/2000/svg", "g");
            distanceMarkers.innerHTML = `
                <line x1="250" y1="350" x2="400" y2="350" stroke="#4caf50" stroke-width="1" opacity="0.6"/>
                <line x1="400" y1="350" x2="550" y2="350" stroke="#4caf50" stroke-width="1" opacity="0.6"/>
                <text x="325" y="370" text-anchor="middle" fill="#4caf50" font-size="12">2m</text>
                <text x="475" y="370" text-anchor="middle" fill="#4caf50" font-size="12">2m</text>
                <text x="400" y="390" text-anchor="middle" fill="#fff" font-size="12">Equal distances</text>
            `;
            svg.appendChild(distanceMarkers);
        }

        async function drawSpoonDemo() {
            const svg = document.getElementById('reflection-demo');
            svg.innerHTML = `
                <defs>
                    <marker id="arrowhead" markerWidth="4" markerHeight="3" refX="4" refY="1.5" orient="auto">
                        <polygon points="0 0, 4 1.5, 0 3" fill="#ffcc00" />
                    </marker>
                    <marker id="arrowhead-orange" markerWidth="4" markerHeight="3" refX="4" refY="1.5" orient="auto">
                        <polygon points="0 0, 4 1.5, 0 3" fill="#ff6600" />
                    </marker>
                    <linearGradient id="concaveGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                        <stop offset="0%" style="stop-color:#ffffff;stop-opacity:1" />
                        <stop offset="30%" style="stop-color:#e0e0e0;stop-opacity:1" />
                        <stop offset="70%" style="stop-color:#c0c0c0;stop-opacity:1" />
                        <stop offset="100%" style="stop-color:#888;stop-opacity:1" />
                    </linearGradient>
                    <linearGradient id="convexGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                        <stop offset="0%" style="stop-color:#ffffff;stop-opacity:1" />
                        <stop offset="30%" style="stop-color:#e0e0e0;stop-opacity:1" />
                        <stop offset="70%" style="stop-color:#c0c0c0;stop-opacity:1" />
                        <stop offset="100%" style="stop-color:#888;stop-opacity:1" />
                    </linearGradient>
                </defs>
                
                <!-- Title -->
                <text x="400" y="35" text-anchor="middle" fill="#ffcc00" font-size="22" font-weight="bold">Activity 9.1: Spoon Reflection</text>
                <text x="400" y="55" text-anchor="middle" fill="#fff" font-size="14">Hold a spoon and observe your face on each surface</text>
                
                <!-- Concave side (inner surface on left) -->
                <g id="concave-side">
                    <text x="200" y="85" text-anchor="middle" fill="#ffcc00" font-size="18" font-weight="bold">Concave Surface (Inner)</text>
                    <text x="200" y="105" text-anchor="middle" fill="#fff" font-size="12">Bowl side facing you</text>
                    
                    <!-- Concave mirror with inner surface on left -->
                    <path d="M 150 150 Q 100 200 150 250" stroke="#666" stroke-width="6" fill="none" opacity="0.3"/>
                    <path d="M 150 150 Q 120 200 150 250" stroke="url(#concaveGradient)" stroke-width="4" fill="none"/>
                    
                    <!-- Person looking at concave surface from right -->
                    <g id="concave-person">
                        <circle cx="280" cy="200" r="12" fill="#ff6600"/>
                        <line x1="280" y1="212" x2="280" y2="235" stroke="#ff6600" stroke-width="3"/>
                        <line x1="280" y1="235" x2="270" y2="250" stroke="#ff6600" stroke-width="2"/>
                        <line x1="280" y1="235" x2="290" y2="250" stroke="#ff6600" stroke-width="2"/>
                        <line x1="280" y1="220" x2="270" y2="230" stroke="#ff6600" stroke-width="2"/>
                        <line x1="280" y1="220" x2="290" y2="230" stroke="#ff6600" stroke-width="2"/>
                        <text x="280" y="270" text-anchor="middle" fill="#ff6600" font-size="11">You</text>
                        <text x="280" y="285" text-anchor="middle" fill="#fff" font-size="10">(30cm away)</text>
                    </g>
                    
                    <!-- Principal axis and points -->
                    <line x1="80" y1="200" x2="320" y2="200" stroke="#fff" stroke-width="1" stroke-dasharray="3,3" opacity="0.3"/>
                    <circle cx="185" cy="200" r="3" fill="#4caf50" opacity="0.6"/>
                    <text x="185" y="190" text-anchor="middle" fill="#4caf50" font-size="10">F</text>
                    <circle cx="220" cy="200" r="3" fill="#9c27b0" opacity="0.6"/>
                    <text x="220" y="190" text-anchor="middle" fill="#9c27b0" font-size="10">C</text>
                    
                    <!-- Reflecting surface indicator -->
                    <text x="50" y="190" fill="#4caf50" font-size="10">Reflecting</text>
                    <text x="50" y="203" fill="#4caf50" font-size="10">surface</text>
                    <path d="M 75 198 L 120 198" stroke="#4caf50" stroke-width="2" marker-end="url(#arrowhead)"/>
                    
                    <!-- Incident light rays from person to concave surface -->
                    <line x1="280" y1="188" x2="120" y2="188" stroke="#ff6600" stroke-width="2" marker-end="url(#arrowhead-orange)"/>
                    <line x1="280" y1="200" x2="120" y2="200" stroke="#ff6600" stroke-width="2" marker-end="url(#arrowhead-orange)"/>
                    <line x1="280" y1="212" x2="120" y2="212" stroke="#ff6600" stroke-width="2" marker-end="url(#arrowhead-orange)"/>
                    
                    <!-- Reflected light rays converging from concave surface -->
                    <line x1="120" y1="188" x2="160" y2="210" stroke="#ffcc00" stroke-width="2" marker-end="url(#arrowhead)"/>
                    <line x1="120" y1="200" x2="160" y2="200" stroke="#ffcc00" stroke-width="2" marker-end="url(#arrowhead)"/>
                    <line x1="120" y1="212" x2="160" y2="195" stroke="#ffcc00" stroke-width="2" marker-end="url(#arrowhead)"/>
                    
                    <!-- Real image at convergence point -->
                    <g opacity="0.8">
                        <circle cx="160" cy="210" r="8" fill="#ffcc00" stroke="#ffcc00" stroke-width="1"/>
                        <line x1="160" y1="202" x2="160" y2="185" stroke="#ffcc00" stroke-width="2.5"/>
                        <line x1="160" y1="185" x2="153" y2="175" stroke="#ffcc00" stroke-width="2"/>
                        <line x1="160" y1="185" x2="167" y2="175" stroke="#ffcc00" stroke-width="2"/>
                        <line x1="160" y1="195" x2="153" y2="185" stroke="#ffcc00" stroke-width="2"/>
                        <line x1="160" y1="195" x2="167" y2="185" stroke="#ffcc00" stroke-width="2"/>
                        
                        <text x="160" y="155" text-anchor="middle" fill="#ffcc00" font-size="11" font-weight="bold">Real Image</text>
                        <text x="160" y="250" text-anchor="middle" fill="#ffcc00" font-size="10">(Inverted)</text>
                    </g>
                    
                    <!-- Convergence point label -->
                    <text x="160" y="120" text-anchor="middle" fill="#4caf50" font-size="10">Rays converge</text>
                    <text x="160" y="133" text-anchor="middle" fill="#4caf50" font-size="10">here</text>
                    
                    <!-- Image location label -->
                    <text x="200" y="320" text-anchor="middle" fill="#ffcc00" font-size="12" font-weight="bold">Image Location:</text>
                    <text x="200" y="340" text-anchor="middle" fill="#fff" font-size="11">Between F and mirror</text>
                    <text x="200" y="355" text-anchor="middle" fill="#fff" font-size="11">(Inverted, Real)</text>
                </g>
                
                <!-- Convex side (outer surface on right) -->
                <g id="convex-side">
                    <text x="600" y="85" text-anchor="middle" fill="#ffcc00" font-size="18" font-weight="bold">Convex Surface (Outer)</text>
                    <text x="600" y="105" text-anchor="middle" fill="#fff" font-size="12">Back side facing you</text>
                    
                    <!-- Convex mirror with outer surface on right -->
                    <path d="M 650 150 Q 600 200 650 250" stroke="#666" stroke-width="6" fill="none" opacity="0.3"/>
                    <path d="M 650 150 Q 620 200 650 250" stroke="url(#convexGradient)" stroke-width="4" fill="none"/>
                    
                    <!-- Person looking at convex surface from left -->
                    <g id="convex-person">
                        <circle cx="520" cy="200" r="12" fill="#ff6600"/>
                        <line x1="520" y1="212" x2="520" y2="235" stroke="#ff6600" stroke-width="3"/>
                        <line x1="520" y1="235" x2="510" y2="250" stroke="#ff6600" stroke-width="2"/>
                        <line x1="520" y1="235" x2="530" y2="250" stroke="#ff6600" stroke-width="2"/>
                        <line x1="520" y1="220" x2="510" y2="230" stroke="#ff6600" stroke-width="2"/>
                        <line x1="520" y1="220" x2="530" y2="230" stroke="#ff6600" stroke-width="2"/>
                        <text x="520" y="270" text-anchor="middle" fill="#ff6600" font-size="11">You</text>
                        <text x="520" y="285" text-anchor="middle" fill="#fff" font-size="10">(Any distance)</text>
                    </g>
                    
                    <!-- Principal axis -->
                    <line x1="480" y1="200" x2="750" y2="200" stroke="#fff" stroke-width="1" stroke-dasharray="3,3" opacity="0.3"/>
                    
                    <!-- Virtual focus behind mirror -->
                    <circle cx="720" cy="200" r="3" fill="#4caf50" opacity="0.4"/>
                    <text x="720" y="190" text-anchor="middle" fill="#4caf50" font-size="10">F</text>
                    
                    <!-- Reflecting surface indicator -->
                   
                    <path d="M 735 198 L 680 198" stroke="#4caf50" stroke-width="2" marker-end="url(#arrowhead)"/>
                    
                    <!-- Incident light rays from person to convex surface -->
                    <line x1="520" y1="188" x2="650" y2="188" stroke="#ff6600" stroke-width="2" marker-end="url(#arrowhead-orange)"/>
                    <line x1="520" y1="200" x2="650" y2="200" stroke="#ff6600" stroke-width="2" marker-end="url(#arrowhead-orange)"/>
                    <line x1="520" y1="212" x2="650" y2="212" stroke="#ff6600" stroke-width="2" marker-end="url(#arrowhead-orange)"/>
                    
                    <!-- Reflected light rays diverging from convex surface -->
                    <line x1="650" y1="188" x2="580" y2="160" stroke="#ffcc00" stroke-width="2" marker-end="url(#arrowhead)"/>
                    <line x1="650" y1="200" x2="580" y2="200" stroke="#ffcc00" stroke-width="2" marker-end="url(#arrowhead)"/>
                    <line x1="650" y1="212" x2="580" y2="240" stroke="#ffcc00" stroke-width="2" marker-end="url(#arrowhead)"/>
                    
                    <!-- Virtual ray extensions behind mirror (dotted lines) -->
                    <line x1="650" y1="188" x2="720" y2="197" stroke="#ffcc00" stroke-width="1" stroke-dasharray="3,3" opacity="0.6"/>
                    <line x1="650" y1="200" x2="720" y2="200" stroke="#ffcc00" stroke-width="1" stroke-dasharray="3,3" opacity="0.6"/>
                    <line x1="650" y1="212" x2="720" y2="203" stroke="#ffcc00" stroke-width="1" stroke-dasharray="3,3" opacity="0.6"/>
                    
                    <!-- Virtual image behind mirror where extensions meet -->
                    <g opacity="0.7">
                        <circle cx="720" cy="200" r="6" fill="#ffcc00" stroke="#ffcc00" stroke-width="1" stroke-dasharray="2,2"/>
                        <line x1="720" y1="206" x2="720" y2="213" stroke="#ffcc00" stroke-width="1.5" stroke-dasharray="2,2"/>
                        <line x1="720" y1="213" x2="716" y2="218" stroke="#ffcc00" stroke-width="1" stroke-dasharray="2,2"/>
                        <line x1="720" y1="213" x2="724" y2="218" stroke="#ffcc00" stroke-width="1" stroke-dasharray="2,2"/>
                        <line x1="720" y1="208" x2="716" y2="211" stroke="#ffcc00" stroke-width="1" stroke-dasharray="2,2"/>
                        <line x1="720" y1="208" x2="724" y2="211" stroke="#ffcc00" stroke-width="1" stroke-dasharray="2,2"/>
                        
                        <text x="720" y="175" text-anchor="middle" fill="#ffcc00" font-size="11" font-weight="bold">Virtual Image</text>
                        <text x="720" y="245" text-anchor="middle" fill="#ffcc00" font-size="10">(Upright, Small)</text>
                    </g>
                    
                    <!-- Behind mirror label -->
                    <text x="720" y="150" text-anchor="middle" fill="#4caf50" font-size="10">Behind mirror</text>
                    <text x="720" y="163" text-anchor="middle" fill="#4caf50" font-size="10">(rays diverge from here)</text>
                    
                    <!-- Image location label -->
                    <text x="600" y="320" text-anchor="middle" fill="#ffcc00" font-size="12" font-weight="bold">Image Location:</text>
                    <text x="600" y="340" text-anchor="middle" fill="#fff" font-size="11">Behind the mirror</text>
                    <text x="600" y="355" text-anchor="middle" fill="#fff" font-size="11">(Upright, Virtual, Small)</text>
                </g>
            `;
        }

        async function animateSpoonReflections() {
            const svg = document.getElementById('reflection-demo');
            const concaveGroup = svg.querySelector('#concave-side');
            const convexGroup = svg.querySelector('#convex-side');
            
            await wait(500);
            
            // Add light rays showing image formation for concave
            const concaveRays = document.createElementNS("http://www.w3.org/2000/svg", "g");
            concaveRays.innerHTML = `
                <!-- Ray from top of head parallel to axis, reflects through F -->
                <line x1="280" y1="188" x2="120" y2="188" stroke="#ff6600" stroke-width="1.5" opacity="0.7" marker-end="url(#arrowhead)"/>
                <line x1="120" y1="188" x2="160" y2="210" stroke="#ffcc00" stroke-width="1.5" opacity="0.7"/>
                
                <!-- Ray from bottom parallel to axis, reflects through F -->
                <line x1="280" y1="235" x2="120" y2="235" stroke="#ff6600" stroke-width="1.5" opacity="0.7" marker-end="url(#arrowhead)"/>
                <line x1="120" y1="235" x2="160" y2="195" stroke="#ffcc00" stroke-width="1.5" opacity="0.7"/>
                
                <!-- Ray through focal point, reflects parallel -->
                <line x1="280" y1="200" x2="185" y2="200" stroke="#ff6600" stroke-width="1" opacity="0.5"/>
                <line x1="185" y1="200" x2="120" y2="200" stroke="#ff6600" stroke-width="1" opacity="0.5" marker-end="url(#arrowhead)"/>
                <line x1="120" y1="200" x2="120" y2="170" stroke="#ffcc00" stroke-width="1" opacity="0.5"/>
                
                <!-- Convergence point marking -->
                <circle cx="160" cy="202" r="4" fill="#ffcc00" opacity="0.8"/>
            `;
            svg.appendChild(concaveRays);
            
            // Add concave image formed by ray convergence
            const concaveImage = document.createElementNS("http://www.w3.org/2000/svg", "g");
            concaveImage.innerHTML = `
                <g opacity="0.8">
                    <!-- Inverted stick figure image at convergence point -->
                    <circle cx="160" cy="210" r="8" fill="#ffcc00" stroke="#ffcc00" stroke-width="1"/>
                    <line x1="160" y1="202" x2="160" y2="185" stroke="#ffcc00" stroke-width="2.5"/>
                    <line x1="160" y1="185" x2="153" y2="175" stroke="#ffcc00" stroke-width="2"/>
                    <line x1="160" y1="185" x2="167" y2="175" stroke="#ffcc00" stroke-width="2"/>
                    <line x1="160" y1="195" x2="153" y2="185" stroke="#ffcc00" stroke-width="2"/>
                    <line x1="160" y1="195" x2="167" y2="185" stroke="#ffcc00" stroke-width="2"/>
                    
                    <text x="160" y="165" text-anchor="middle" fill="#ffcc00" font-size="11" font-weight="bold">Real Image</text>
                    <text x="160" y="240" text-anchor="middle" fill="#ffcc00" font-size="10">(Inverted)</text>
                </g>
                
                <text x="160" y="130" text-anchor="middle" fill="#4caf50" font-size="10">Rays converge</text>
                <text x="160" y="143" text-anchor="middle" fill="#4caf50" font-size="10">here</text>
            `;
            concaveGroup.appendChild(concaveImage);
            
            await wait(1500);
            
            // Add light rays showing image formation for convex
            const convexRays = document.createElementNS("http://www.w3.org/2000/svg", "g");
            
            svg.appendChild(convexRays);
            
            // Add convex image (virtual, behind mirror where extensions meet)
            const convexImage = document.createElementNS("http://www.w3.org/2000/svg", "g");
            convexImage.innerHTML = `
                <g opacity="0.5">
                    <!-- Small upright virtual image behind the mirror -->
                    <circle cx="520" cy="200" r="5" fill="#ffcc00" stroke="#ffcc00" stroke-width="1" stroke-dasharray="2,2"/>
                    <line x1="520" y1="205" x2="520" y2="213" stroke="#ffcc00" stroke-width="1.5" stroke-dasharray="2,2"/>
                    <line x1="520" y1="213" x2="516" y2="218" stroke="#ffcc00" stroke-width="1" stroke-dasharray="2,2"/>
                    <line x1="520" y1="213" x2="524" y2="218" stroke="#ffcc00" stroke-width="1" stroke-dasharray="2,2"/>
                    <line x1="520" y1="208" x2="516" y2="211" stroke="#ffcc00" stroke-width="1" stroke-dasharray="2,2"/>
                    <line x1="520" y1="208" x2="524" y2="211" stroke="#ffcc00" stroke-width="1" stroke-dasharray="2,2"/>
                    
                    <text x="520" y="185" text-anchor="middle" fill="#ffcc00" font-size="11" font-weight="bold">Virtual Image</text>
                    <text x="520" y="235" text-anchor="middle" fill="#ffcc00" font-size="10">(Upright, Small)</text>
                </g>
                
                // <text x="520" y="160" text-anchor="middle" fill="#4caf50" font-size="10">Behind mirror</text>
                // <text x="520" y="173" text-anchor="middle" fill="#4caf50" font-size="10">(rays diverge from here)</text>
            `;
            convexGroup.appendChild(convexImage);
        }

        // Helper functions
        function resetDemo() {
            currentDemoAborted = true;
            currentRunId++;
            
            // Reset task ID
            currentTaskId = null;
            
            if (narrator) {
                narrator.stop();
                narrator.destroy();
                narrator = null;
                
                setTimeout(() => {
                    narrator = new ReflectionNarrator();
                }, 100);
            }
            
            activeAnimations.forEach(anim => {
                if (anim && anim.cancel) {
                    anim.cancel();
                }
            });
            activeAnimations = [];
            
            drawInitialDiagram();
            updateTitle("Explore Light Reflection");
            
            isPlaying = false;
            speechSynthesis.cancel();
        }

        function shouldContinue(taskId = null) {
            // If a specific task ID is provided, check if it matches current task
            if (taskId && currentTaskId && taskId !== currentTaskId) {
                return false;
            }
            return !currentDemoAborted;
        }

        function updateTitle(title) {
            document.getElementById('lesson-title').textContent = title;
        }

        function setActiveButton(index) {
            document.querySelectorAll('.demo-btn').forEach((btn, i) => {
                btn.classList.toggle('active', i === index);
            });
        }

        function wait(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        // Audio Control
        document.getElementById('mute-btn').addEventListener('click', () => {
            speechSynthesis.cancel();
            
            if (narrator) {
                narrator.stop();
                narrator.destroy();
                narrator = new ReflectionNarrator();
            }
            
            const isEnabled = narrator.toggle();
            document.getElementById('mute-btn').classList.toggle('muted', !isEnabled);
            document.getElementById('mute-btn').setAttribute('aria-pressed', !isEnabled);
        });

        // Keyboard navigation
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                resetDemo();
            }
        });
    </script>
</body>
</html>