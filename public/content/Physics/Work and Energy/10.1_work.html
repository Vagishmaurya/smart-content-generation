<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Work and Energy - Interactive Physics Learning</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #334155 100%);
            color: white;
            overflow-x: hidden;
            min-height: 100vh;
        }

        /* Audio Control */
        #audio-control {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
        }

        .control-btn {
            background: rgba(16, 185, 129, 0.9);
            border: none;
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            border: 2px solid rgba(16, 185, 129, 0.5);
        }

        .control-btn:hover {
            transform: scale(1.1);
            background: rgba(16, 185, 129, 1);
            box-shadow: 0 0 20px rgba(16, 185, 129, 0.5);
        }

        .control-btn.muted .unmute-icon { display: none; }
        .control-btn:not(.muted) .mute-icon { display: none; }

        /* Main Container */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 30px 20px;
        }

        /* Header */
        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 20px;
            background: rgba(16, 185, 129, 0.1);
            border-radius: 20px;
            border: 2px solid rgba(16, 185, 129, 0.3);
        }

        .header h1 {
            font-size: 3.5rem;
            background: linear-gradient(45deg, #10b981, #34d399, #6ee7b7);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 15px;
            font-weight: 700;
            text-shadow: 0 0 30px rgba(16, 185, 129, 0.3);
        }

        .header p {
            font-size: 1.3rem;
            opacity: 0.95;
            max-width: 800px;
            margin: 0 auto;
            line-height: 1.6;
            color: #cbd5e1;
        }

        /* Demo Stage */
        .demo-stage {
            background: linear-gradient(135deg, #1e293b 0%, #334155 50%, #475569 100%);
            border-radius: 25px;
            min-height: 650px; /* Increased height to accommodate navigation */
            position: relative;
            margin: 40px 0;
            box-shadow: 
                0 25px 50px rgba(0, 0, 0, 0.5),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            overflow: hidden;
            border: 3px solid rgba(16, 185, 129, 0.4);
            padding: 40px;
        }

        /* Work Definition Demo */
        .work-definition-demo {
            display: none;
            position: relative;
            width: 100%;
            height: 600px;
        }

        .work-definition-demo.active {
            display: block;
        }

        .work-scene {
            position: relative;
            width: 100%;
            height: 450px;
            background: linear-gradient(to bottom, #87ceeb 0%, #b0e0e6 50%, #e0f6ff 100%);
            border-radius: 20px;
            overflow: hidden;
            border: 3px solid rgba(16, 185, 129, 0.4);
            box-shadow: 
                0 15px 30px rgba(0, 0, 0, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }
        
        /* Energy particles */
        .energy-particle {
            position: absolute;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: radial-gradient(circle at 30% 30%, #ffd700, #ff6b35);
            opacity: 0;
            z-index: 30;
            filter: blur(1px) drop-shadow(0 0 2px rgba(255, 215, 0, 0.6));
        }

        .ground {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 80px;
            background: linear-gradient(to bottom, #8fbc8f, #6b8e23, #556b2f);
            border-top: 4px solid #228b22;
            box-shadow: 
                0 -5px 15px rgba(0, 0, 0, 0.3),
                inset 0 2px 4px rgba(255, 255, 255, 0.2);
        }

        .person {
            position: absolute;
            bottom: 80px;
            left: 100px;
            width: 60px;
            height: 120px;
            transition: all 2s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            z-index: 50;
        }

        .person-head {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #fdbcb4;
            margin: 0 auto 4px;
            border: 2px solid #2c2c2c;
            position: relative;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .person-body {
            width: 36px;
            height: 45px;
            background: linear-gradient(135deg, #ff6b35, #ff8c42);
            margin: 0 auto 4px;
            border-radius: 6px 6px 0 0;
            border: 2px solid #2c2c2c;
            position: relative;
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.3);
        }

        .person-arms, .person-legs {
            margin: 0 auto;
            border: 2px solid #2c2c2c;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .person-arms {
            width: 18px;
            height: 5px;
            background: #fdbcb4;
            margin-top: -20px;
            margin-bottom: 12px;
            border-radius: 3px;
        }

        .person-legs {
            width: 28px;
            height: 35px;
            background: linear-gradient(135deg, #4169e1, #1e90ff);
            border-radius: 0 0 6px 6px;
        }

        .work-object {
            position: absolute;
            bottom: 80px;
            left: 300px;
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #ff6b35, #ff8c42, #ffa726);
            border: 4px solid #e55a2b;
            border-radius: 15px;
            transition: all 1s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            box-shadow: 
                0 15px 30px rgba(255, 107, 53, 0.4),
                inset 0 2px 4px rgba(255, 255, 255, 0.3);
            z-index: 45;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
        }

        .work-object::before {
            content: '📦';
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3));
        }

        .force-vector {
            position: absolute;
            left: 180px;
            bottom: 130px;
            opacity: 0;
            transform: scale(0);
            transition: all 0.8s cubic-bezier(0.34, 1.56, 0.64, 1);
            z-index: 40;
        }

        .force-vector.visible {
            opacity: 1;
            transform: scale(1);
            animation: forcePulse 2s infinite;
        }
        
        @keyframes forcePulse {
            0% { filter: drop-shadow(0 0 2px rgba(239, 68, 68, 0.5)); }
            50% { filter: drop-shadow(0 0 8px rgba(239, 68, 68, 0.8)); }
            100% { filter: drop-shadow(0 0 2px rgba(239, 68, 68, 0.5)); }
        }

        .force-shaft {
            background: linear-gradient(90deg, #ef4444, #dc2626);
            width: 100px;
            height: 6px;
            position: relative;
            box-shadow: 
                0 0 10px rgba(239, 68, 68, 0.5),
                inset 0 1px 2px rgba(255, 255, 255, 0.3);
            border-radius: 3px;
        }

        .force-tip {
            position: absolute;
            right: -10px;
            top: -6px;
            width: 0;
            height: 0;
            border-top: 9px solid transparent;
            border-bottom: 9px solid transparent;
            border-left: 15px solid #ef4444;
            filter: drop-shadow(0 0 5px rgba(239, 68, 68, 0.5));
        }

        .force-label {
            position: absolute;
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 0.9rem;
            font-weight: 600;
            white-space: nowrap;
            box-shadow: 
                0 4px 8px rgba(0, 0, 0, 0.3),
                0 0 0 2px rgba(255, 255, 255, 0.2);
            top: -43px;
            left: 50%;
            transform: translateX(-50%);
        }

        .displacement-vector {
            position: absolute;
            bottom: 225px; /* Moved up from 200px to create more vertical gap */
            left: 150px;
            width: 0;
            height: 4px;
            background: linear-gradient(90deg, #10b981, #059669);
            border-radius: 2px;
            transition: width 1.5s cubic-bezier(0.34, 1.56, 0.64, 1);
            z-index: 35;
            box-shadow: 0 0 8px rgba(16, 185, 129, 0.5);
        }

        .displacement-vector::after {
            content: '';
            position: absolute;
            right: -10px;
            top: -5px;
            width: 0;
            height: 0;
            border-left: 15px solid #10b981;
            border-top: 7px solid transparent;
            border-bottom: 7px solid transparent;
            filter: drop-shadow(0 0 5px rgba(16, 185, 129, 0.5));
        }

        .displacement-vector.active {
            width: 200px;
        }
        
        .displacement-markers {
            position: absolute;
            bottom: 215px; /* Positioned below displacement vector */
            left: 150px;
            width: 200px;
            height: 20px;
            display: flex;
            justify-content: space-between;
            opacity: 0;
            transition: opacity 1s ease 0.5s;
            z-index: 36;
        }
        
        .displacement-markers.visible {
            opacity: 1;
        }
        
        .marker {
            width: 2px;
            height: 10px;
            background-color: rgba(16, 185, 129, 0.8);
            position: relative;
        }
        
        .marker::after {
            content: attr(data-value);
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 10px;
            color: #10b981;
            white-space: nowrap;
        }
        
        .marker-animation {
            position: absolute;
            bottom: 225px;
            left: 150px;
            width: 15px;
            height: 15px;
            border-radius: 50%;
            background-color: rgba(16, 185, 129, 0.5);
            transform: scale(0);
            opacity: 0;
            z-index: 37;
        }

        .displacement-label {
            position: absolute;
            bottom: 190px; /* Moved up from 165px to match the new vector position */
            left: 200px;
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 0.9rem;
            font-weight: 600;
            opacity: 0;
            transition: opacity 0.5s ease;
            z-index: 40;
            box-shadow: 
                0 4px 8px rgba(0, 0, 0, 0.3),
                0 0 0 2px rgba(255, 255, 255, 0.2);
        }

        .displacement-label.visible {
            opacity: 1;
        }

        .work-display {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 200px;
            background: rgba(0, 0, 0, 0.8);
            border: 3px solid #10b981;
            border-radius: 15px;
            padding: 15px;
            backdrop-filter: blur(10px);
            z-index: 60;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.5);
        }
        
        /* Energy Bar Chart */
        .energy-chart {
            position: absolute;
            top: 20px;
            left: 20px;
            width: 180px;
            background: rgba(0, 0, 0, 0.8);
            border: 3px solid #10b981;
            border-radius: 15px;
            padding: 15px;
            backdrop-filter: blur(10px);
            z-index: 60;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.5);
            opacity: 0;
            transform: translateY(-20px);
            transition: all 0.5s ease;
        }
        
        .energy-chart.visible {
            opacity: 1;
            transform: translateY(0);
        }
        
        .chart-title {
            color: #10b981;
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 12px;
            text-align: center;
        }
        
        .bar-container {
            margin-bottom: 15px;
        }
        
        .bar-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }
        
        .bar-name {
            color: #e2e8f0;
            font-size: 0.9rem;
        }
        
        .bar-value {
            color: #fbbf24;
            font-size: 0.9rem;
            font-family: 'Courier New', monospace;
        }
        
        .bar-track {
            width: 100%;
            height: 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }
        
        .bar-fill {
            height: 100%;
            width: 0;
            background: linear-gradient(90deg, #10b981, #34d399);
            border-radius: 10px;
            transition: width 1.5s cubic-bezier(0.34, 1.56, 0.64, 1);
            position: relative;
        }
        
        .bar-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(
                to bottom,
                rgba(255, 255, 255, 0.3) 0%,
                rgba(255, 255, 255, 0) 50%,
                rgba(0, 0, 0, 0.1) 100%
            );
        }
        
        .bar-fill.kinetic {
            background: linear-gradient(90deg, #3b82f6, #60a5fa);
        }
        
        /* Angle Diagram */
        .angle-diagram {
            position: absolute;
            bottom: 20px;
            right: 20px;
            width: 220px;
            height: 220px;
            background: rgba(0, 0, 0, 0.8);
            border: 3px solid #10b981;
            border-radius: 15px;
            padding: 15px;
            backdrop-filter: blur(10px);
            z-index: 60;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.5);
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.5s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .angle-diagram.visible {
            opacity: 1;
            transform: translateY(0);
        }
        
        .angle-canvas-container {
            position: relative;
            width: 180px;
            height: 180px;
            margin-top: 10px;
        }
        
        .angle-canvas {
            width: 100%;
            height: 100%;
        }
        
        .angle-value {
            position: absolute;
            top: -10px;
            right: 0;
            background: #fbbf24;
            color: #000;
            padding: 3px 8px;
            border-radius: 10px;
            font-size: 0.9rem;
            font-weight: bold;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
        }
        
        .angle-slider {
            width: 100%;
            margin-top: 10px;
            -webkit-appearance: none;
            appearance: none;
            height: 8px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            outline: none;
        }
        
        .angle-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #10b981;
            cursor: pointer;
            border: 2px solid white;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.5);
        }
        
        .work-type-indicator {
            margin-top: 10px;
            padding: 5px 10px;
            border-radius: 10px;
            font-size: 0.9rem;
            font-weight: bold;
            text-align: center;
            width: 100%;
            transition: all 0.3s ease;
        }
        
        .work-positive {
            background: rgba(16, 185, 129, 0.3);
            color: #10b981;
            border: 1px solid #10b981;
        }
        
        .work-negative {
            background: rgba(239, 68, 68, 0.3);
            color: #ef4444;
            border: 1px solid #ef4444;
        }
        
        .work-zero {
            background: rgba(100, 116, 139, 0.3);
            color: #cbd5e1;
            border: 1px solid #64748b;
        }

        .work-title {
            color: #10b981;
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 8px;
            text-align: center;
        }

        .work-formula {
            color: #60a5fa;
            font-size: 1.1rem;
            font-family: 'Courier New', monospace;
            text-align: center;
            margin-bottom: 8px;
        }

        .work-value {
            color: #fbbf24;
            font-size: 1.6rem;
            font-weight: bold;
            text-align: center;
            font-family: 'Courier New', monospace;
            text-shadow: 0 0 10px rgba(251, 191, 36, 0.5);
        }

        /* Work Formula Demo */
        .work-formula-demo {
            display: none;
            position: relative;
            width: 100%;
            height: auto;
            min-height: 850px;
            overflow-y: auto;
            padding-bottom: 40px; /* Add extra padding at the bottom */
        }

        .work-formula-demo.active {
            display: block;
        }

        .formula-container {
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            align-items: center;
            padding: 20px;
            overflow-y: auto;
            height: 100%;
        }
        
        /* Vector Components Diagram */
        .vector-components-diagram {
            position: relative;
            margin: 30px auto 0;
            width: 300px;
            height: auto; /* Change from fixed height to auto */
            min-height: 320px; /* Set minimum height */
            background: rgba(0, 0, 0, 0.8);
            border: 3px solid #10b981;
            border-radius: 15px;
            padding: 15px 15px 25px; /* Increase bottom padding */
            backdrop-filter: blur(10px);
            z-index: 60;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.5);
            opacity: 1; /* Show from the beginning */
            transform: translateY(0); /* No initial transform */
            transition: all 0.5s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .vector-components-diagram.visible {
            opacity: 1;
            transform: translateY(0);
        }
        
        .vector-canvas-container {
            position: relative;
            width: 270px;
            height: 220px;
            margin-top: 10px;
        }
        
        .vector-canvas {
            width: 100%;
            height: 100%;
        }
        
        .component-controls {
            display: flex;
            justify-content: space-between;
            width: 100%;
            margin-top: 10px;
            margin-bottom: 20px; /* Add space at the bottom of the slider */
        }
        
        .component-slider {
            width: 100%;
            -webkit-appearance: none;
            appearance: none;
            height: 8px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            outline: none;
        }
        
        .component-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #10b981;
            cursor: pointer;
            border: 2px solid white;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.5);
        }

        .formula-section {
            background: rgba(16, 185, 129, 0.1);
            padding: 30px;
            border-radius: 20px;
            border: 2px solid rgba(16, 185, 129, 0.4);
            text-align: center;
            width: 90%;
            max-width: 600px;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            margin-bottom: 30px;
        }

        .formula-title {
            color: #10b981;
            font-size: 2rem;
            margin-bottom: 20px;
            font-weight: 600;
        }

        .formula {
            font-family: 'Courier New', monospace;
            font-size: 3rem;
            color: #fbbf24;
            margin: 30px 0;
            padding: 25px;
            background: rgba(251, 191, 36, 0.1);
            border-radius: 15px;
            border: 2px solid rgba(251, 191, 36, 0.3);
            text-shadow: 0 0 20px rgba(251, 191, 36, 0.5);
            position: relative;
        }
        
        .formula-animated {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }
        
        .formula-part {
            display: inline-block;
            transition: all 0.5s ease;
            position: relative;
        }
        
        .formula-part.highlight {
            color: #ffffff;
            transform: scale(1.2);
            text-shadow: 0 0 25px rgba(255, 255, 255, 0.8);
        }
        
        .formula-part::after {
            content: attr(data-description);
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%) scale(0);
            background: rgba(16, 185, 129, 0.9);
            color: white;
            padding: 5px 10px;
            border-radius: 10px;
            font-size: 1rem;
            white-space: nowrap;
            opacity: 0;
            transition: all 0.3s ease;
            pointer-events: none;
            z-index: 100;
        }
        
        .formula-part.highlight::after {
            transform: translateX(-50%) scale(1);
            opacity: 1;
            top: 120%;
        }

        .formula-explanation {
            color: #e2e8f0;
            line-height: 1.8;
            margin-top: 20px;
            font-size: 1.2rem;
        }

        .formula-components {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-top: 30px;
        }

        .component {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 10px;
            border: 1px solid rgba(16, 185, 129, 0.3);
        }

        .component-symbol {
            color: #fbbf24;
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .component-name {
            color: #10b981;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .component-unit {
            color: #cbd5e1;
            font-size: 0.9rem;
        }

        /* Work Examples Demo */
        .work-examples-demo {
            display: none;
            position: relative;
            width: 100%;
            height: auto;
            min-height: 800px; /* Increased height to accommodate both examples and chart */
            overflow-y: auto; /* Allow scrolling if needed */
        }

        .work-examples-demo.active {
            display: block;
        }

        .examples-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 30px;
            padding: 20px;
            margin-bottom: 20px; /* Reduced space since chart is now positioned relatively */
        }
        
        /* Work Types Comparison Chart */
        .work-comparison-chart {
            position: relative;
            margin: 20px auto 40px;
            left: 0;
            transform: translateY(20px);
            width: 90%;
            background: rgba(0, 0, 0, 0.8);
            border: 3px solid #10b981;
            border-radius: 15px;
            padding: 20px;
            backdrop-filter: blur(10px);
            z-index: 60;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.5);
            opacity: 0;
            transition: all 0.5s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .work-comparison-chart.visible {
            opacity: 1;
            transform: translateY(0);
        }
        
        .comparison-title {
            color: #10b981;
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .comparison-container {
            display: flex;
            width: 100%;
            justify-content: space-around;
            align-items: flex-end;
            height: 200px;
            margin-top: 20px;
        }
        
        .comparison-bar-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100px;
        }
        
        .comparison-bar {
            width: 60px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
            position: relative;
            transition: height 1s ease;
            margin-bottom: 10px;
        }
        
        .comparison-bar-positive {
            background: linear-gradient(to top, #10b981, #34d399);
            height: 0;
            border-radius: 5px;
            box-shadow: 0 0 15px rgba(16, 185, 129, 0.5);
            position: relative;
            width: 100%;
        }
        
        .comparison-bar-negative {
            background: linear-gradient(to bottom, #ef4444, #dc2626);
            height: 0;
            border-radius: 5px;
            box-shadow: 0 0 15px rgba(239, 68, 68, 0.5);
            position: absolute;
            bottom: 0;
            width: 100%;
        }
        
        .comparison-bar-zero {
            background: linear-gradient(to top, #64748b, #94a3b8);
            height: 0;
            border-radius: 5px;
            box-shadow: 0 0 15px rgba(100, 116, 139, 0.5);
            position: relative;
            width: 100%;
        }
        
        .bar-label-inside {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(-90deg);
            color: white;
            font-weight: bold;
            font-size: 0.9rem;
            text-shadow: 0 0 3px rgba(0, 0, 0, 0.8);
            white-space: nowrap;
            opacity: 0;
            transition: opacity 0.5s ease 0.5s;
        }
        
        .zero-label {
            transform: translate(-50%, 0) rotate(0deg);
            top: 100%;
            padding-top: 5px;
            color: #64748b;
            text-shadow: none;
        }
        
        .comparison-label {
            font-size: 1rem;
            font-weight: bold;
            margin-bottom: 5px;
            text-align: center;
        }
        
        .comparison-value {
            font-size: 0.9rem;
            color: #fbbf24;
            font-family: 'Courier New', monospace;
            margin-top: 5px;
        }
        
        .comparison-description {
            font-size: 0.8rem;
            color: #cbd5e1;
            text-align: center;
            margin-top: 5px;
            max-width: 100px;
        }

        .example-card {
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(16, 185, 129, 0.3);
            border-radius: 20px;
            padding: 30px;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            align-items: center;
            text-align: center;
            backdrop-filter: blur(10px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
            transition: transform 0.3s ease;
            height: auto;
            min-height: 400px;
        }

        .example-card:hover {
            transform: translateY(-5px);
        }

        .example-icon {
            font-size: 4rem;
            margin-bottom: 20px;
            filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.3));
        }

        .example-title {
            color: #10b981;
            font-size: 1.8rem;
            font-weight: bold;
            margin-bottom: 15px;
        }

        .example-description {
            color: #e2e8f0;
            font-size: 1.1rem;
            line-height: 1.6;
            margin-bottom: 20px;
        }

        .work-calculation {
            background: rgba(251, 191, 36, 0.1);
            padding: 15px 25px;
            border-radius: 15px;
            border: 2px solid rgba(251, 191, 36, 0.3);
            margin-bottom: 20px;
            width: 100%;
        }

        .calculation-formula {
            color: #fbbf24;
            font-family: 'Courier New', monospace;
            font-size: 1.2rem;
            margin-bottom: 10px;
        }

        .calculation-result {
            color: #10b981;
            font-size: 1.6rem;
            font-weight: bold;
            font-family: 'Courier New', monospace;
        }

        /* NCERT Activities Demo */
        .ncert-activities-demo {
            display: none;
            position: relative;
            width: 100%;
            height: 600px;
            overflow: hidden;
        }

        .ncert-activities-demo.active {
            display: block;
        }

        .activities-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 30px;
            height: calc(100% - 70px); /* Adjust for navigation */
            padding: 20px;
            overflow: hidden;
        }

        .activity-card {
            background: rgba(59, 130, 246, 0.1);
            border: 2px solid rgba(59, 130, 246, 0.3);
            border-radius: 20px;
            padding: 30px;
            backdrop-filter: blur(10px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
            overflow-y: auto;
            margin-bottom: 40px; /* Add space for navigation */
        }

        .activity-title {
            color: #3b82f6;
            font-size: 1.6rem;
            font-weight: bold;
            margin-bottom: 20px;
            text-align: center;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .activity-content {
            color: #e2e8f0;
            line-height: 1.8;
            font-size: 1rem;
        }

        .activity-content h3 {
            color: #10b981;
            margin: 15px 0 10px 0;
            font-size: 1.2rem;
        }

        .activity-content ul {
            margin: 10px 0;
            padding-left: 20px;
        }

        .activity-content li {
            margin: 6px 0;
            line-height: 1.5;
        }

        .activity-content strong {
            color: #fbbf24;
        }

        /* Numerical Problems Demo */
        .numerical-demo {
            display: none;
            position: relative;
            width: 100%;
            height: 600px;
            overflow: hidden;
        }

        .numerical-demo.active {
            display: block;
        }

        .problems-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 30px;
            height: calc(100% - 70px); /* Adjust for navigation */
            padding: 20px;
            overflow: hidden;
        }

        .numerical-card {
            background: rgba(168, 85, 247, 0.1);
            border: 2px solid rgba(168, 85, 247, 0.3);
            border-radius: 20px;
            padding: 30px;
            backdrop-filter: blur(10px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
            overflow-y: auto;
            margin-bottom: 40px; /* Add space for navigation */
        }

        .problem-title {
            color: #a855f7;
            font-size: 1.6rem;
            font-weight: bold;
            margin-bottom: 20px;
            text-align: center;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .problem-statement {
            background: rgba(59, 130, 246, 0.1);
            border: 2px solid rgba(59, 130, 246, 0.3);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            color: #e2e8f0;
            font-size: 1rem;
            line-height: 1.6;
        }

        .solution-section {
            margin-top: 20px;
        }

        .solution-title {
            color: #fbbf24;
            font-size: 1.3rem;
            font-weight: bold;
            margin-bottom: 15px;
        }

        .solution-step {
            background: rgba(251, 191, 36, 0.1);
            border-left: 4px solid #fbbf24;
            padding: 15px;
            margin: 15px 0;
            border-radius: 8px;
            color: #e2e8f0;
            line-height: 1.6;
        }

        .solution-step strong {
            color: #fbbf24;
        }

        .calculation {
            font-family: 'Courier New', monospace;
            background: rgba(16, 185, 129, 0.1);
            padding: 10px;
            border-radius: 8px;
            margin: 10px 0;
            color: #10b981;
            font-size: 1rem;
        }

        .final-answer {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            font-size: 1.3rem;
            font-weight: bold;
            margin-top: 20px;
            box-shadow: 0 8px 16px rgba(16, 185, 129, 0.3);
        }

        /* Controls */
        .controls {
            text-align: center;
            margin: 40px 0;
            padding: 30px;
            background: rgba(16, 185, 129, 0.05);
            border-radius: 20px;
            border: 2px solid rgba(16, 185, 129, 0.2);
        }

        .controls-title {
            font-size: 2.2rem;
            margin-bottom: 25px;
            color: #10b981;
            font-weight: 600;
            text-shadow: 0 0 20px rgba(16, 185, 129, 0.3);
        }

        .demo-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
            margin: 25px 0;
        }

        .demo-btn {
            background: linear-gradient(135deg, #10b981, #059669);
            border: none;
            color: white;
            padding: 16px 28px;
            border-radius: 35px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 8px 25px rgba(16, 185, 129, 0.3);
            min-width: 200px;
            border: 2px solid rgba(16, 185, 129, 0.5);
        }

        .demo-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 30px rgba(16, 185, 129, 0.4);
            background: linear-gradient(135deg, #059669, #047857);
        }

        .demo-btn:active {
            transform: translateY(-1px);
        }

        .demo-btn.active {
            background: linear-gradient(135deg, #fbbf24, #f59e0b);
            box-shadow: 0 8px 25px rgba(251, 191, 36, 0.4);
            border-color: rgba(251, 191, 36, 0.5);
        }

        /* Theory Section */
        .theory-section {
            background: rgba(16, 185, 129, 0.05);
            border-radius: 25px;
            padding: 35px;
            margin: 35px 0;
            border: 3px solid rgba(16, 185, 129, 0.3);
            backdrop-filter: blur(15px);
        }

        .theory-title {
            font-size: 2rem;
            color: #10b981;
            margin-bottom: 25px;
            text-align: center;
            font-weight: 600;
        }

        .concept-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin: 25px 0;
        }

        .concept-card {
            background: rgba(255, 255, 255, 0.05);
            padding: 25px;
            border-radius: 20px;
            border: 2px solid rgba(16, 185, 129, 0.3);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }

        .concept-title {
            color: #10b981;
            font-size: 1.4rem;
            margin-bottom: 15px;
            font-weight: 600;
        }

        .concept-text {
            color: #cbd5e1;
            line-height: 1.8;
            font-size: 1.1rem;
        }

        .formula-highlight {
            background: rgba(251, 191, 36, 0.1);
            padding: 25px;
            border-radius: 20px;
            text-align: center;
            margin: 25px 0;
            border: 2px solid rgba(251, 191, 36, 0.3);
        }

        .main-formula {
            font-size: 2.5rem;
            color: #fbbf24;
            font-family: 'Courier New', monospace;
            margin: 20px 0;
            text-shadow: 0 0 30px rgba(251, 191, 36, 0.5);
        }

        /* Carousel Navigation Styles */
        .carousel-navigation {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            margin-top: 20px;
            position: relative;
            z-index: 100;
            padding: 15px 0;
            background: rgba(16, 185, 129, 0.1);
            border-top: 1px solid rgba(16, 185, 129, 0.3);
            border-radius: 0 0 20px 20px;
            width: 100%;
            bottom: 0;
            left: 0;
        }
        
        .activities-nav,
        .numerical-nav {
            background: rgba(16, 185, 129, 0.8);
            border: 2px solid rgba(16, 185, 129, 1);
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            font-size: 1.8rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 
                0 5px 15px rgba(0, 0, 0, 0.3),
                0 0 0 2px rgba(16, 185, 129, 0.3),
                inset 0 0 10px rgba(255, 255, 255, 0.1);
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
        }

        .activities-nav:hover,
        .numerical-nav:hover {
            background: rgba(16, 185, 129, 1);
            transform: scale(1.1);
            box-shadow: 
                0 8px 20px rgba(0, 0, 0, 0.4),
                0 0 0 3px rgba(16, 185, 129, 0.4),
                inset 0 0 15px rgba(255, 255, 255, 0.2);
        }

        .activities-indicators,
        .numerical-indicators {
            display: flex;
            gap: 12px;
            z-index: 10;
        }

        .activities-indicator,
        .numerical-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .activities-indicator:hover,
        .numerical-indicator:hover {
            background: rgba(16, 185, 129, 0.5);
            transform: scale(1.2);
        }

        .activities-indicator.active,
        .numerical-indicator.active {
            background: #10b981;
            transform: scale(1.3);
            box-shadow: 
                0 0 0 2px rgba(16, 185, 129, 0.3),
                0 0 10px rgba(16, 185, 129, 0.5);
        }
        
        /* Responsive Design */
        @media (max-width: 1024px) {
            .examples-grid, .activities-grid, .problems-grid {
                grid-template-columns: 1fr;
            }
            
            .formula-container {
                flex-direction: column;
            }
            
            .formula-section {
                min-width: 300px;
            }
            
            .activities-nav,
            .numerical-nav {
                width: 40px;
                height: 40px;
                font-size: 1.5rem;
            }
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2.5rem;
            }
            
            .demo-buttons {
                flex-direction: column;
                align-items: center;
            }
            
            .demo-btn {
                min-width: 250px;
            }
            
            .work-scene {
                height: 350px;
            }
            
            .concept-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Audio Control -->
    <div id="audio-control">
        <button id="mute-btn" class="control-btn">
            <span class="unmute-icon">🔊</span>
            <span class="mute-icon">🔇</span>
        </button>
    </div>

    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>Work and Energy</h1>
            <p>Discover the fascinating world of work in physics! Learn how force and displacement combine to create work, understand the difference between positive and negative work, and master the calculations with real-world examples.</p>
        </div>

        <!-- Demo Stage -->
        <div class="demo-stage" id="stage">
            <!-- Work Definition Demo -->
            <div class="work-definition-demo" id="work-definition-demo">
                <div class="work-scene">
                    <div class="ground"></div>
                    <div class="person" id="person">
                        <div class="person-head"></div>
                        <div class="person-body"></div>
                        <div class="person-arms"></div>
                        <div class="person-legs"></div>
                    </div>
                    <div class="work-object" id="work-object"></div>
                    <div class="force-vector" id="force-vector">
                        <div class="force-shaft"></div>
                        <div class="force-tip"></div>
                        <div class="force-label">Applied Force (F)</div>
                    </div>
                    <div class="displacement-vector" id="displacement-vector"></div>
                    <div class="displacement-markers" id="displacement-markers">
                        <div class="marker" data-value="0 m"></div>
                        <div class="marker" data-value="1 m"></div>
                        <div class="marker" data-value="2 m"></div>
                        <div class="marker" data-value="3 m"></div>
                        <div class="marker" data-value="4 m"></div>
                        <div class="marker" data-value="5 m"></div>
                    </div>
                    <div class="marker-animation" id="marker-animation"></div>
                    <div class="displacement-label" id="displacement-label">Displacement (s)</div>
                    <div class="work-display">
                        <div class="work-title">Work Done</div>
                        <div class="work-formula">W = F × s</div>
                        <div class="work-value" id="work-value">0 J</div>
                    </div>
                    <div class="energy-chart" id="energy-chart">
                        <div class="chart-title">Energy Transfer</div>
                        <div class="bar-container">
                            <div class="bar-label">
                                <div class="bar-name">Work</div>
                                <div class="bar-value" id="work-bar-value">0 J</div>
                            </div>
                            <div class="bar-track">
                                <div class="bar-fill" id="work-bar-fill"></div>
                            </div>
                        </div>
                        <div class="bar-container">
                            <div class="bar-label">
                                <div class="bar-name">Kinetic Energy</div>
                                <div class="bar-value" id="kinetic-bar-value">0 J</div>
                            </div>
                            <div class="bar-track">
                                <div class="bar-fill kinetic" id="kinetic-bar-fill"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="angle-diagram" id="angle-diagram">
                        <div class="chart-title">Force & Displacement Angle</div>
                        <div class="angle-canvas-container">
                            <canvas class="angle-canvas" id="angle-canvas"></canvas>
                            <div class="angle-value" id="angle-value">0°</div>
                        </div>
                        <input type="range" min="0" max="180" value="0" class="angle-slider" id="angle-slider">
                        <div class="work-type-indicator work-positive" id="work-type-indicator">Positive Work</div>
                    </div>
                </div>
            </div>

            <!-- Work Formula Demo -->
            <div class="work-formula-demo" id="work-formula-demo">
                <div class="formula-container">
                    <div class="formula-section">
                        <div class="formula-title">Work Formula</div>
                        <div class="formula formula-animated" id="animated-formula">
                            <span class="formula-part" data-description="Work (Joules)" id="formula-w">W</span>
                            <span class="formula-part" data-description="Equals">=</span>
                            <span class="formula-part" data-description="Force (Newtons)" id="formula-f">F</span>
                            <span class="formula-part" data-description="Multiplied by">×</span>
                            <span class="formula-part" data-description="Displacement (Meters)" id="formula-s">s</span>
                            <span class="formula-part" data-description="Multiplied by">×</span>
                            <span class="formula-part" data-description="Cosine of angle between force and displacement" id="formula-cos">cos(θ)</span>
                        </div>
                        <div class="formula-explanation">
                            Work is defined as the product of force and displacement in the direction of force.
                        </div>
                        <div class="formula-components">
                            <div class="component">
                                <div class="component-symbol">W</div>
                                <div class="component-name">Work</div>
                                <div class="component-unit">Joule (J)</div>
                            </div>
                            <div class="component">
                                <div class="component-symbol">F</div>
                                <div class="component-name">Force</div>
                                <div class="component-unit">Newton (N)</div>
                            </div>
                            <div class="component">
                                <div class="component-symbol">s</div>
                                <div class="component-name">Displacement</div>
                                <div class="component-unit">Meter (m)</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Vector Components Diagram -->
                <div class="vector-components-diagram" id="vector-components-diagram">
                    <div class="chart-title">Force Vector Components</div>
                    <div class="vector-canvas-container">
                        <canvas class="vector-canvas" id="vector-canvas"></canvas>
                    </div>
                    <div class="component-controls">
                        <input type="range" min="0" max="180" value="30" class="component-slider" id="vector-angle-slider">
                    </div>
                </div>
            </div>

            <!-- Work Examples Demo -->
            <div class="work-examples-demo" id="work-examples-demo">
                <div class="examples-grid">
                    <div class="example-card">
                        <div class="example-icon">🚗</div>
                        <div class="example-title">Positive Work</div>
                        <div class="example-description">
                            A car accelerates forward. The engine force and displacement are in the same direction.
                        </div>
                        <div class="work-calculation">
                            <div class="calculation-formula">W = F × s × cos(0°)</div>
                            <div class="calculation-result">W = +1000 J</div>
                        </div>
                        <div style="color: #10b981; font-weight: 600;">
                            Force and displacement in same direction → Positive Work
                        </div>
                    </div>

                    <div class="example-card">
                        <div class="example-icon">🛑</div>
                        <div class="example-title">Negative Work</div>
                        <div class="example-description">
                            A car brakes to stop. The friction force opposes the direction of motion.
                        </div>
                        <div class="work-calculation">
                            <div class="calculation-formula">W = F × s × cos(180°)</div>
                            <div class="calculation-result">W = -800 J</div>
                        </div>
                        <div style="color: #ef4444; font-weight: 600;">
                            Force opposite to displacement → Negative Work
                        </div>
                    </div>

                    <div class="example-card">
                        <div class="example-icon">💪</div>
                        <div class="example-title">Zero Work</div>
                        <div class="example-description">
                            A person pushes against a wall. Force is applied but there's no displacement.
                        </div>
                        <div class="work-calculation">
                            <div class="calculation-formula">W = F × 0</div>
                            <div class="calculation-result">W = 0 J</div>
                        </div>
                        <div style="color: #64748b; font-weight: 600;">
                            No displacement → Zero Work
                        </div>
                    </div>
                </div>
                
                <!-- Work Types Comparison Chart -->
                <div class="work-comparison-chart" id="work-comparison-chart">
                    <div class="comparison-title"></div>
                    
                    <div class="comparison-container">
                        <div class="comparison-bar-container">
                            <div class="comparison-bar" style="height: 150px;">
                                <div class="comparison-bar-positive" id="positive-work-bar">
                                    <div class="bar-label-inside">Positive Work</div>
                                </div>
                            </div>
                            <div class="comparison-value">+1000 J</div>
                            <div class="comparison-description">Energy transferred TO the object</div>
                        </div>
                        
                        <div class="comparison-bar-container">
                            <div class="comparison-bar" style="height: 150px;">
                                <div class="comparison-bar-negative" id="negative-work-bar">
                                    <div class="bar-label-inside">Negative Work</div>
                                </div>
                            </div>
                            <div class="comparison-value">-800 J</div>
                            <div class="comparison-description">Energy taken FROM the object</div>
                        </div>
                        
                        <div class="comparison-bar-container">
                            <div class="comparison-bar" style="height: 150px;">
                                <div class="comparison-bar-zero" id="zero-work-bar">
                                    <div class="bar-label-inside zero-label">Zero Work</div>
                                </div>
                            </div>
                            <div class="comparison-value">0 J</div>
                            <div class="comparison-description">No energy transfer occurs</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- NCERT Activities Demo -->
            <div class="ncert-activities-demo" id="ncert-activities-demo">
                <div class="activities-grid">
                    <div class="activity-card">
                        <div class="activity-title">Activity 10.1: Work in Daily Life</div>
                        <div class="activity-content">
                            <p>Analyze different activities and determine when work is done in physics:</p>
                            
                            <h3>Questions to Ask:</h3>
                            <ul>
                                <li>What is the work being done on?</li>
                                <li>What is happening to the object?</li>
                                <li>Who or what is doing the work?</li>
                            </ul>
                            
                            <h3>Examples:</h3>
                            <ul>
                                <li><strong>Studying:</strong> Mental effort with no physical displacement → No work in physics</li>
                                <li><strong>Pushing a wall:</strong> Force applied but no displacement → No work</li>
                                <li><strong>Climbing stairs:</strong> Force applied AND displacement occurs → Work is done</li>
                            </ul>
                            
                            <p><strong>Conclusion:</strong> Only activities involving both force and displacement constitute work in physics!</p>
                        </div>
                    </div>

                    <div class="activity-card">
                        <div class="activity-title">Activity 10.2: Identifying Work Situations</div>
                        <div class="activity-content">
                            <h3>Situations where Work IS Done:</h3>
                            <ul>
                                <li><strong>Push a pebble:</strong> Pebble moves when force is applied</li>
                                <li><strong>Pull a trolley:</strong> Trolley moves in direction of force</li>
                                <li><strong>Lift a book:</strong> Book rises up when lifted</li>
                                <li><strong>Kick a football:</strong> Ball moves due to applied force</li>
                            </ul>
                            
                            <h3>Situations where Work is NOT Done:</h3>
                            <ul>
                                <li><strong>Push against wall:</strong> No displacement occurs</li>
                                <li><strong>Hold heavy load:</strong> No displacement occurs</li>
                                <li><strong>Object moves without force:</strong> No applied force</li>
                            </ul>
                            
                            <p><strong>Key Point:</strong> For work to be done, BOTH force and displacement in the direction of force are required!</p>
                        </div>
                    </div>

                    <div class="activity-card">
                        <div class="activity-title">Activity 10.3: Force vs Displacement</div>
                        <div class="activity-content">
                            <h3>Force but No Displacement:</h3>
                            <ul>
                                <li>Pushing against immovable wall</li>
                                <li>Holding weights stationary above head</li>
                                <li>Car engine running but car not moving</li>
                            </ul>
                            
                            <h3>Displacement but No Applied Force:</h3>
                            <ul>
                                <li>Ball rolling on smooth surface (inertia)</li>
                                <li>Skateboard coasting down a hill</li>
                                <li>Satellite orbiting Earth (no external force)</li>
                            </ul>
                            
                            <p><strong>Conclusion:</strong> Work is done only when BOTH force and displacement are present! Missing either condition means no work in physics.</p>
                        </div>
                    </div>

                    <div class="activity-card">
                        <div class="activity-title">Activity 10.4: Types of Work</div>
                        <div class="activity-content">
                            <h3>Positive Work Examples:</h3>
                            <ul>
                                <li><strong>Lifting object upward:</strong> Your force (↑) + Displacement (↑) = +W</li>
                                <li><strong>Pushing car forward:</strong> Force (→) + Displacement (→) = +W</li>
                                <li><strong>Result:</strong> Energy is given TO the object</li>
                            </ul>
                            
                            <h3>Negative Work Examples:</h3>
                            <ul>
                                <li><strong>Gravity on lifted object:</strong> Gravity (↓) + Displacement (↑) = -W</li>
                                <li><strong>Friction slowing car:</strong> Friction (←) + Displacement (→) = -W</li>
                                <li><strong>Result:</strong> Energy is taken FROM the object</li>
                            </ul>
                            
                            <p><strong>Amazing Fact:</strong> The same situation can involve both positive and negative work by different forces!</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Numerical Problems Demo -->
            <div class="numerical-demo" id="numerical-demo">
                <div class="problems-grid">
                    <div class="numerical-card">
                        <div class="problem-title">Example Problem 1</div>
                        <div class="problem-statement">
                            A force of 15 N is applied to move a box 4 meters across a horizontal floor. Calculate the work done.
                        </div>
                        
                        <div class="solution-section">
                            <div class="solution-title">Solution:</div>
                            
                            <div class="solution-step">
                                <strong>Given:</strong><br>
                                Force (F) = 15 N<br>
                                Displacement (s) = 4 m<br>
                                Angle between force and displacement = 0° (same direction)
                            </div>
                            
                            <div class="solution-step">
                                <strong>Formula:</strong><br>
                                <div class="calculation">W = F × s × cos(θ)</div>
                            </div>
                            
                            <div class="solution-step">
                                <strong>Calculation:</strong><br>
                                <div class="calculation">W = 15 × 4 × cos(0°)</div>
                                <div class="calculation">W = 15 × 4 × 1</div>
                                <div class="calculation">W = 60 J</div>
                            </div>
                            
                            <div class="final-answer">
                                Work Done = 60 Joules
                            </div>
                        </div>
                    </div>

                    <div class="numerical-card">
                        <div class="problem-title">Example Problem 2</div>
                        <div class="problem-statement">
                            A person lifts a 20 kg bag to a height of 1.5 m. Calculate the work done against gravity. (g = 9.8 m/s²)
                        </div>
                        
                        <div class="solution-section">
                            <div class="solution-title">Solution:</div>
                            
                            <div class="solution-step">
                                <strong>Given:</strong><br>
                                Mass (m) = 20 kg<br>
                                Height (h) = 1.5 m<br>
                                Acceleration due to gravity (g) = 9.8 m/s²
                            </div>
                            
                            <div class="solution-step">
                                <strong>Find Force:</strong><br>
                                <div class="calculation">F = mg = 20 × 9.8 = 196 N</div>
                            </div>
                            
                            <div class="solution-step">
                                <strong>Work Done:</strong><br>
                                <div class="calculation">W = F × s</div>
                                <div class="calculation">W = 196 × 1.5</div>
                                <div class="calculation">W = 294 J</div>
                            </div>
                            
                            <div class="final-answer">
                                Work Done = 294 Joules
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Controls -->
        <div class="controls">
            <div class="controls-title" id="demo-title">Interactive Work and Energy Learning</div>
            
            <div class="demo-buttons">
                <button class="demo-btn" data-demo="complete">📚 Complete Lesson</button>
                <button class="demo-btn" data-demo="definition">🔬 What is Work?</button>
                <button class="demo-btn" data-demo="formula">📐 Work Formula</button>
                <button class="demo-btn" data-demo="examples">💡 Work Examples</button>
                <button class="demo-btn" data-demo="activities">🧪 NCERT Activities</button>
                <button class="demo-btn" data-demo="numerical">📊 Numerical Problems</button>
                <button class="demo-btn" data-demo="reset">🔄 Reset</button>
            </div>
        </div>

        <!-- Theory Section -->
        <div class="theory-section">
            <div class="theory-title">Understanding Work in Physics</div>
            
            <div class="formula-highlight">
                <div class="main-formula">W = F × s × cos(θ)</div>
                <div style="margin-top: 15px; line-height: 1.8; color: #e2e8f0;">
                    <strong>Where:</strong> W = Work (Joules), F = Force (Newtons), s = Displacement (meters), θ = angle between force and displacement
                </div>
            </div>

            <div class="concept-grid">
                <div class="concept-card">
                    <div class="concept-title">Definition of Work</div>
                    <div class="concept-text">
                        Work is done when a force causes displacement of an object in the direction of the force. It's the transfer of energy to an object by means of force acting through a distance.
                    </div>
                </div>
                
                <div class="concept-card">
                    <div class="concept-title">Conditions for Work</div>
                    <div class="concept-text">
                        Two conditions must be satisfied: (1) A force must be applied on the object, and (2) The object must be displaced in the direction of force. If either condition is missing, no work is done.
                    </div>
                </div>
                
                <div class="concept-card">
                    <div class="concept-title">Types of Work</div>
                    <div class="concept-text">
                        <strong>Positive Work:</strong> When force and displacement are in the same direction.<br>
                        <strong>Negative Work:</strong> When force opposes displacement.<br>
                        <strong>Zero Work:</strong> When there's no displacement or force is perpendicular to displacement.
                    </div>
                </div>
                
                <div class="concept-card">
                    <div class="concept-title">Units and Dimensions</div>
                    <div class="concept-text">
                        <strong>SI Unit:</strong> Joule (J) = N⋅m<br>
                        <strong>CGS Unit:</strong> Erg = dyne⋅cm<br>
                        <strong>Conversion:</strong> 1 J = 10⁷ erg<br>
                        <strong>Dimension:</strong> [ML²T⁻²]
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Enhanced Voice Teacher System with context-awareness and promise-based narration
        class PhysicsTeacher {
            constructor() {
                this.isEnabled = globalAudioEnabled;
                this.isDestroyed = false;
                this.currentUtterance = null;
                this.settings = { rate: 0.9, pitch: 1.0, volume: 0.85 };
                this.currentContext = null;
                this.queue = [];
                this.isProcessingQueue = false;
            }

            async speak(text, delay = 0, context = null) {
                if (!this.isEnabled || !text || this.isDestroyed) return Promise.resolve();
                
                // If context is provided, update current context
                if (context) {
                    this.currentContext = context;
                }
                
                // Add to queue instead of speaking immediately
                return new Promise((resolve) => {
                    this.queue.push({
                        text,
                        delay,
                        resolve,
                        context: context || this.currentContext
                    });
                    
                    // Start processing queue if not already doing so
                    if (!this.isProcessingQueue) {
                        this.processQueue();
                    }
                });
            }
            
            async processQueue() {
                if (this.isProcessingQueue || this.queue.length === 0) return;
                
                this.isProcessingQueue = true;
                
                while (this.queue.length > 0) {
                    const item = this.queue.shift();
                    
                    // Skip narration if context has changed
                    if (item.context && item.context !== this.currentContext) {
                        item.resolve();
                        continue;
                    }
                    
                    await this.speakImmediate(item.text, item.delay);
                    item.resolve();
                }
                
                this.isProcessingQueue = false;
            }
            
            async speakImmediate(text, delay = 0) {
                if (!this.isEnabled || !text || this.isDestroyed) return Promise.resolve();
                
                return new Promise((resolve) => {
                    setTimeout(() => {
                        if (this.isDestroyed) {
                            resolve();
                            return;
                        }
                        this.stop();
                        const utterance = new SpeechSynthesisUtterance(text);
                        Object.assign(utterance, this.settings);
                        
                        utterance.onend = resolve;
                        utterance.onerror = resolve;
                        
                        this.currentUtterance = utterance;
                        speechSynthesis.speak(utterance);
                    }, delay);
                });
            }

            stop() {
                speechSynthesis.cancel();
                this.currentUtterance = null;
                // Clear the queue
                this.queue = [];
                this.isProcessingQueue = false;
            }
            
            setContext(context) {
                this.currentContext = context;
                // Clear any queued items that don't match the new context
                this.queue = this.queue.filter(item => !item.context || item.context === context);
            }

            toggle() {
                this.isEnabled = !this.isEnabled;
                if (!this.isEnabled) this.stop();
                return this.isEnabled;
            }
            
            destroy() {
                this.isDestroyed = true;
                this.stop();
                this.currentUtterance = null;
                this.settings = null;
                this.queue = [];
                this.currentContext = null;
            }
        }

        // Global variables
        let globalAudioEnabled = true;
        let currentTeacher = null;
        let currentDemo = null;
        let isPlaying = false;
        let currentDemoAborted = false;
        let activeAnimations = [];
        let currentRunId = 0;
        
        // Carousel state variables
        let currentActivitiesIndex = 0;
        const totalActivitiesSlides = 4;
        let activitiesAutoTimer = null;
        
        let currentNumericalIndex = 0;
        const totalNumericalSlides = 2;
        let numericalAutoTimer = null;

        function createNewTeacher() {
            if (currentTeacher) {
                currentTeacher.destroy();
            }
            currentTeacher = new PhysicsTeacher();
            return currentTeacher;
        }

        function hideAllDemos() {
            document.querySelectorAll('.work-definition-demo, .work-formula-demo, .work-examples-demo, .ncert-activities-demo, .numerical-demo').forEach(demo => {
                demo.classList.remove('active');
            });
        }

        function setActiveButton(activeBtn) {
            document.querySelectorAll('.demo-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            if (activeBtn) {
                activeBtn.classList.add('active');
            }
        }

        function updateTitle(title) {
            document.getElementById('demo-title').textContent = title;
        }
        
        function shouldContinue(taskId = null) {
            return !currentDemoAborted;
        }
        
        function trackAnimation(animation) {
            if (animation) {
                activeAnimations.push(animation);
            }
            return animation;
        }

        function resetAll() {
            // Stop any active animations
            gsap.killTweensOf("*");
            
            // Clear any active animations
            activeAnimations.forEach(anim => {
                if (anim && anim.cancel) {
                    anim.cancel();
                }
            });
            activeAnimations = [];
            
            // Reset positions
            gsap.set(['#person', '#work-object'], { x: 0 });
            
            // Reset UI elements
            document.getElementById('work-value').textContent = '0 J';
            document.getElementById('force-vector').classList.remove('visible');
            document.getElementById('displacement-vector').classList.remove('active');
            document.getElementById('displacement-label').classList.remove('visible');
            document.getElementById('displacement-markers').classList.remove('visible');
            document.getElementById('energy-chart').classList.remove('visible');
            document.getElementById('angle-diagram').classList.remove('visible');
            
            // Hide vector components diagram if it exists
            const vectorDiagram = document.getElementById('vector-components-diagram');
            if (vectorDiagram) {
                vectorDiagram.classList.remove('visible');
            }
            
            // Reset energy chart values
            document.getElementById('work-bar-value').textContent = '0 J';
            document.getElementById('kinetic-bar-value').textContent = '0 J';
            document.getElementById('work-bar-fill').style.width = '0%';
            document.getElementById('kinetic-bar-fill').style.width = '0%';
            
            // Reset angle slider
            if (document.getElementById('angle-slider')) {
                document.getElementById('angle-slider').value = 0;
            }
            
            // Reset angle indicator
            if (document.getElementById('angle-value')) {
                document.getElementById('angle-value').textContent = '0°';
            }
            
            // Reset work type indicator
            const workTypeIndicator = document.getElementById('work-type-indicator');
            if (workTypeIndicator) {
                workTypeIndicator.className = 'work-type-indicator work-positive';
                workTypeIndicator.textContent = 'Positive Work';
            }
            
            gsap.set('#marker-animation', { x: 0, opacity: 0, scale: 0 });
            
            // Reset carousel states
            resetActivitiesCarousel();
            resetNumericalCarousel();
            
            // Hide all demos
            hideAllDemos();
            updateTitle("Interactive Work and Energy Learning");
            
            // Set abort flag to false
            currentDemoAborted = false;
        }
        
        function wait(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }
        
        // Activities Carousel Functions
        async function initializeActivitiesCarousel() {
            currentActivitiesIndex = 0;
            updateActivitiesPosition();
            
            // Add navigation controls if they don't exist
            if (!document.querySelector('.activities-nav')) {
                addActivitiesNavigation();
            }
        }
        
        function addActivitiesNavigation() {
            const activitiesDemo = document.getElementById('ncert-activities-demo');
            const activitiesGrid = document.querySelector('.activities-grid');
            
            // Create navigation container
            const navContainer = document.createElement('div');
            navContainer.className = 'carousel-navigation';
            navContainer.style.position = 'absolute';
            navContainer.style.bottom = '0';
            
            // Create navigation buttons
            const prevBtn = document.createElement('button');
            prevBtn.className = 'activities-nav prev';
            prevBtn.innerHTML = '‹';
            prevBtn.onclick = previousActivity;
            
            const nextBtn = document.createElement('button');
            nextBtn.className = 'activities-nav next';
            nextBtn.innerHTML = '›';
            nextBtn.onclick = nextActivity;
            
            // Create indicators
            const indicators = document.createElement('div');
            indicators.className = 'activities-indicators';
            
            for (let i = 0; i < totalActivitiesSlides; i++) {
                const indicator = document.createElement('div');
                indicator.className = 'activities-indicator' + (i === 0 ? ' active' : '');
                indicator.onclick = () => goToActivity(i);
                indicators.appendChild(indicator);
            }
            
            // Add elements to navigation container
            navContainer.appendChild(prevBtn);
            navContainer.appendChild(indicators);
            navContainer.appendChild(nextBtn);
            
            // Add navigation container to demo
            activitiesDemo.appendChild(navContainer);
            
            // Convert grid to carousel
            activitiesGrid.style.display = 'flex';
            activitiesGrid.style.width = (totalActivitiesSlides * 100) + '%';
            activitiesGrid.style.transition = 'transform 0.8s cubic-bezier(0.34, 1.56, 0.64, 1)';
            activitiesGrid.style.minHeight = '480px'; // Ensure minimum height for content
            
            // Adjust card styles
            document.querySelectorAll('.activity-card').forEach(card => {
                card.style.width = (100 / totalActivitiesSlides - 1) + '%';
                card.style.flexShrink = '0';
                card.style.margin = '0 10px';
                card.style.overflowY = 'auto'; // Enable scrolling for overflow content
                card.style.maxHeight = '480px'; // Set maximum height
                card.style.padding = '25px'; // Add more padding
            });
        }
        
        function updateActivitiesPosition() {
            const container = document.querySelector('.activities-grid');
            if (container) {
                const translateX = (-currentActivitiesIndex * (100 / totalActivitiesSlides));
                container.style.transform = `translateX(${translateX}%)`;
                
                // Update indicators
                document.querySelectorAll('.activities-indicator').forEach((indicator, index) => {
                    indicator.classList.toggle('active', index === currentActivitiesIndex);
                });
            }
        }
        
        function nextActivity() {
            currentActivitiesIndex = (currentActivitiesIndex + 1) % totalActivitiesSlides;
            updateActivitiesPosition();
            
            // Update narration context
            if (currentTeacher) {
                currentTeacher.setContext('activity-' + (currentActivitiesIndex + 1));
            }
            
            // Narrate the current activity
            narrateCurrentActivity();
        }
        
        function previousActivity() {
            currentActivitiesIndex = (currentActivitiesIndex - 1 + totalActivitiesSlides) % totalActivitiesSlides;
            updateActivitiesPosition();
            
            // Update narration context
            if (currentTeacher) {
                currentTeacher.setContext('activity-' + (currentActivitiesIndex + 1));
            }
            
            // Narrate the current activity
            narrateCurrentActivity();
        }
        
        function goToActivity(index) {
            currentActivitiesIndex = index;
            updateActivitiesPosition();
            
            // Update narration context
            if (currentTeacher) {
                currentTeacher.setContext('activity-' + (currentActivitiesIndex + 1));
            }
            
            // Narrate the current activity
            narrateCurrentActivity();
        }
        
        async function narrateCurrentActivity() {
            const teacher = currentTeacher || createNewTeacher();
            const context = 'activity-' + (currentActivitiesIndex + 1);
            
            // Get the current activity card
            const activityCards = document.querySelectorAll('.activity-card');
            if (activityCards[currentActivitiesIndex]) {
                const card = activityCards[currentActivitiesIndex];
                const title = card.querySelector('.activity-title').textContent;
                
                // Extract all text content from the activity card for comprehensive narration
                const contentElements = card.querySelectorAll('.activity-content p, .activity-content h3, .activity-content li');
                let fullContent = '';
                
                // Build a comprehensive narration text
                contentElements.forEach(element => {
                    if (element.tagName === 'H3') {
                        fullContent += element.textContent + ': ';
                    } else if (element.tagName === 'LI') {
                        fullContent += '• ' + element.textContent + '. ';
                    } else {
                        fullContent += element.textContent + ' ';
                    }
                });
                
                // Create a promise that resolves when the speech is done
                return new Promise(async (resolve) => {
                    // First narrate the title
                    await teacher.speak(title, 0, context);
                    
                    // Then narrate the full content
                    await teacher.speak(fullContent, 500, context);
                    
                    // Check if this is the last activity in complete lesson mode
                    if (currentActivitiesIndex === totalActivitiesSlides - 1 && teacher.currentContext === 'complete-lesson') {
                        // Mark activities as completed
                        const activitiesBtn = document.querySelector('.demo-btn[data-demo="activities"]');
                        if (activitiesBtn) {
                            activitiesBtn.innerHTML = '✅ NCERT Activities';
                        }
                        
                        // Wait a moment after narration completes before switching
                        setTimeout(() => {
                            // Switch to the numerical problems tab
                            const numericalBtn = document.querySelector('.demo-btn[data-demo="numerical"]');
                            if (numericalBtn) {
                                numericalBtn.click();
                            }
                            resolve();
                        }, 1500); // Short pause before switching
                    } else {
                        // For all other cases, resolve after a short delay
                        setTimeout(resolve, 1000);
                    }
                });
            }
            return Promise.resolve();
        }
        
        function resetActivitiesCarousel() {
            currentActivitiesIndex = 0;
            if (activitiesAutoTimer) {
                clearInterval(activitiesAutoTimer);
                activitiesAutoTimer = null;
            }
            
            const container = document.querySelector('.activities-grid');
            if (container) {
                container.style.transform = 'translateX(0%)';
            }
            
            document.querySelectorAll('.activities-indicator').forEach((indicator, index) => {
                indicator.classList.toggle('active', index === 0);
            });
        }
        
        // Numerical Problems Carousel Functions
        function initializeNumericalCarousel() {
            currentNumericalIndex = 0;
            updateNumericalPosition();
            
            // Add navigation controls if they don't exist
            if (!document.querySelector('.numerical-nav')) {
                addNumericalNavigation();
            }
        }
        
        function addNumericalNavigation() {
            const numericalDemo = document.getElementById('numerical-demo');
            const problemsGrid = document.querySelector('.problems-grid');
            
            // Create navigation container
            const navContainer = document.createElement('div');
            navContainer.className = 'carousel-navigation';
            navContainer.style.position = 'absolute';
            navContainer.style.bottom = '0';
            
            // Create navigation buttons
            const prevBtn = document.createElement('button');
            prevBtn.className = 'numerical-nav prev';
            prevBtn.innerHTML = '‹';
            prevBtn.onclick = previousNumerical;
            
            const nextBtn = document.createElement('button');
            nextBtn.className = 'numerical-nav next';
            nextBtn.innerHTML = '›';
            nextBtn.onclick = nextNumerical;
            
            // Create indicators
            const indicators = document.createElement('div');
            indicators.className = 'numerical-indicators';
            
            for (let i = 0; i < totalNumericalSlides; i++) {
                const indicator = document.createElement('div');
                indicator.className = 'numerical-indicator' + (i === 0 ? ' active' : '');
                indicator.onclick = () => goToNumerical(i);
                indicators.appendChild(indicator);
            }
            
            // Add elements to navigation container
            navContainer.appendChild(prevBtn);
            navContainer.appendChild(indicators);
            navContainer.appendChild(nextBtn);
            
            // Add navigation container to demo
            numericalDemo.appendChild(navContainer);
            
            // Convert grid to carousel
            problemsGrid.style.display = 'flex';
            problemsGrid.style.width = (totalNumericalSlides * 100) + '%';
            problemsGrid.style.transition = 'transform 0.8s cubic-bezier(0.34, 1.56, 0.64, 1)';
            problemsGrid.style.minHeight = '480px'; // Ensure minimum height for content
            
            // Adjust card styles
            document.querySelectorAll('.numerical-card').forEach(card => {
                card.style.width = (100 / totalNumericalSlides - 1) + '%';
                card.style.flexShrink = '0';
                card.style.margin = '0 10px';
                card.style.overflowY = 'auto'; // Enable scrolling for overflow content
                card.style.maxHeight = '480px'; // Set maximum height
                card.style.padding = '25px'; // Add more padding
            });
        }
        
        function updateNumericalPosition() {
            const container = document.querySelector('.problems-grid');
            if (container) {
                const translateX = -currentNumericalIndex * (100 / totalNumericalSlides);
                container.style.transform = `translateX(${translateX}%)`;
                
                // Update indicators
                document.querySelectorAll('.numerical-indicator').forEach((indicator, index) => {
                    indicator.classList.toggle('active', index === currentNumericalIndex);
                });
            }
        }
        
        function nextNumerical() {
            currentNumericalIndex = (currentNumericalIndex + 1) % totalNumericalSlides;
            updateNumericalPosition();
            
            // Update narration context
            if (currentTeacher) {
                currentTeacher.setContext('numerical-' + (currentNumericalIndex + 1));
            }
            
            // Narrate the current problem
            narrateCurrentNumerical();
        }
        
        function previousNumerical() {
            currentNumericalIndex = (currentNumericalIndex - 1 + totalNumericalSlides) % totalNumericalSlides;
            updateNumericalPosition();
            
            // Update narration context
            if (currentTeacher) {
                currentTeacher.setContext('numerical-' + (currentNumericalIndex + 1));
            }
            
            // Narrate the current problem
            narrateCurrentNumerical();
        }
        
        function goToNumerical(index) {
            currentNumericalIndex = index;
            updateNumericalPosition();
            
            // Update narration context
            if (currentTeacher) {
                currentTeacher.setContext('numerical-' + (currentNumericalIndex + 1));
            }
            
            // Narrate the current problem
            narrateCurrentNumerical();
        }
        
        function narrateCurrentNumerical() {
            const teacher = currentTeacher || createNewTeacher();
            const context = 'numerical-' + (currentNumericalIndex + 1);
            
            // Get the current problem title and statement
            const numericalCards = document.querySelectorAll('.numerical-card');
            if (numericalCards[currentNumericalIndex]) {
                const title = numericalCards[currentNumericalIndex].querySelector('.problem-title').textContent;
                const statement = numericalCards[currentNumericalIndex].querySelector('.problem-statement').textContent;
                
                teacher.speak(title + '. ' + statement, 0, context);
            }
        }
        
        function resetNumericalCarousel() {
            currentNumericalIndex = 0;
            if (numericalAutoTimer) {
                clearInterval(numericalAutoTimer);
                numericalAutoTimer = null;
            }
            
            const container = document.querySelector('.problems-grid');
            if (container) {
                container.style.transform = 'translateX(0%)';
            }
            
            document.querySelectorAll('.numerical-indicator').forEach((indicator, index) => {
                indicator.classList.toggle('active', index === 0);
            });
        }

        // Create energy particles
        function createEnergyParticles(container, count = 10) {
            const particles = [];
            for (let i = 0; i < count; i++) {
                const particle = document.createElement('div');
                particle.className = 'energy-particle';
                container.appendChild(particle);
                particles.push(particle);
            }
            return particles;
        }
        
        // Animate energy particles
        function animateEnergyTransfer(sourceX, sourceY, targetX, targetY, duration = 2) {
            const workScene = document.querySelector('.work-scene');
            const particles = createEnergyParticles(workScene, 15);
            
            particles.forEach((particle, index) => {
                // Set initial position
                gsap.set(particle, {
                    x: sourceX,
                    y: sourceY,
                    opacity: 0,
                    scale: 0
                });
                
                // Create a curved path for more natural movement
                const controlX = sourceX + (targetX - sourceX) * 0.5;
                const controlY = sourceY - 50 - Math.random() * 100;
                
                // Animate along path
                gsap.to(particle, {
                    duration: duration * 0.8 + Math.random() * duration * 0.4,
                    delay: Math.random() * 0.5,
                    motionPath: {
                        path: [
                            {x: sourceX, y: sourceY},
                            {x: controlX, y: controlY},
                            {x: targetX, y: targetY}
                        ],
                        curviness: 2
                    },
                    scale: 0.5 + Math.random() * 1,
                    opacity: () => {
                        return gsap.timeline()
                            .to({}, {duration: 0.2, onComplete: () => gsap.set(particle, {opacity: 0.7 + Math.random() * 0.3})})
                            .to(particle, {duration: 0.4, opacity: 0, delay: duration * 0.6 + Math.random() * 0.3});
                    },
                    onComplete: () => {
                        if (particle.parentNode) {
                            particle.parentNode.removeChild(particle);
                        }
                    }
                });
            });
        }

        // Draw angle diagram
        function initAngleDiagram() {
            const canvas = document.getElementById('angle-canvas');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            const width = canvas.width = 180;
            const height = canvas.height = 180;
            const centerX = width / 2;
            const centerY = height / 2;
            const radius = 60;
            
            // Set up slider
            const slider = document.getElementById('angle-slider');
            const angleValue = document.getElementById('angle-value');
            const workTypeIndicator = document.getElementById('work-type-indicator');
            
            // Initial draw
            drawAngleDiagram(0);
            
            // Add event listener
            slider.addEventListener('input', function() {
                const angle = parseInt(this.value);
                drawAngleDiagram(angle);
                angleValue.textContent = angle + '°';
                
                // Update work type indicator
                if (angle < 90) {
                    workTypeIndicator.className = 'work-type-indicator work-positive';
                    workTypeIndicator.textContent = 'Positive Work';
                } else if (angle > 90) {
                    workTypeIndicator.className = 'work-type-indicator work-negative';
                    workTypeIndicator.textContent = 'Negative Work';
                } else {
                    workTypeIndicator.className = 'work-type-indicator work-zero';
                    workTypeIndicator.textContent = 'Zero Work';
                }
                
                // Update formula display if available
                const workDisplay = document.querySelector('.work-formula');
                if (workDisplay) {
                    const cosValue = Math.cos(angle * Math.PI / 180).toFixed(2);
                    const workFactor = Math.max(0, cosValue); // For visual clarity
                    
                    // Update work calculation
                    const workValueElem = document.getElementById('work-value');
                    if (workValueElem) {
                        const baseWork = 50;
                        const adjustedWork = Math.round(baseWork * cosValue);
                        workValueElem.textContent = adjustedWork + ' J';
                    }
                }
            });
            
            function drawAngleDiagram(angle) {
                // Clear canvas
                ctx.clearRect(0, 0, width, height);
                
                // Draw coordinate system
                ctx.strokeStyle = 'rgba(255, 255, 255, 0.2)';
                ctx.lineWidth = 1;
                ctx.beginPath();
                ctx.moveTo(centerX - radius - 20, centerY);
                ctx.lineTo(centerX + radius + 20, centerY);
                ctx.moveTo(centerX, centerY - radius - 20);
                ctx.lineTo(centerX, centerY + radius + 20);
                ctx.stroke();
                
                // Draw displacement vector (always horizontal)
                ctx.strokeStyle = '#10b981';
                ctx.lineWidth = 3;
                ctx.beginPath();
                ctx.moveTo(centerX, centerY);
                ctx.lineTo(centerX + radius, centerY);
                ctx.stroke();
                
                // Draw arrowhead for displacement
                ctx.fillStyle = '#10b981';
                ctx.beginPath();
                ctx.moveTo(centerX + radius + 10, centerY);
                ctx.lineTo(centerX + radius - 5, centerY - 5);
                ctx.lineTo(centerX + radius - 5, centerY + 5);
                ctx.closePath();
                ctx.fill();
                
                // Draw force vector at specified angle
                const angleRad = angle * Math.PI / 180;
                const forceX = centerX + radius * Math.cos(angleRad);
                const forceY = centerY - radius * Math.sin(angleRad);
                
                ctx.strokeStyle = '#ef4444';
                ctx.lineWidth = 3;
                ctx.beginPath();
                ctx.moveTo(centerX, centerY);
                ctx.lineTo(forceX, forceY);
                ctx.stroke();
                
                // Draw arrowhead for force
                ctx.fillStyle = '#ef4444';
                ctx.save();
                ctx.translate(forceX, forceY);
                ctx.rotate(-angleRad);
                ctx.beginPath();
                ctx.moveTo(10, 0);
                ctx.lineTo(-5, -5);
                ctx.lineTo(-5, 5);
                ctx.closePath();
                ctx.fill();
                ctx.restore();
                
                // Draw angle arc
                ctx.strokeStyle = '#fbbf24';
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.arc(centerX, centerY, 20, 0, -angleRad, angle > 0);
                ctx.stroke();
                
                // Add labels
                ctx.font = '12px Arial';
                ctx.fillStyle = '#10b981';
                ctx.fillText('Displacement', centerX + radius - 30, centerY + 20);
                
                ctx.fillStyle = '#ef4444';
                ctx.fillText('Force', forceX - 10, forceY - 10);
                
                // Draw dot at origin
                ctx.fillStyle = 'white';
                ctx.beginPath();
                ctx.arc(centerX, centerY, 3, 0, Math.PI * 2);
                ctx.fill();
            }
        }
        
        function animateWork() {
            const workObject = document.getElementById('work-object');
            const workValue = document.getElementById('work-value');
            const markerAnimation = document.getElementById('marker-animation');
            const forceVector = document.getElementById('force-vector');
            const energyChart = document.getElementById('energy-chart');
            const angleDiagram = document.getElementById('angle-diagram');
            const workBarFill = document.getElementById('work-bar-fill');
            const kineticBarFill = document.getElementById('kinetic-bar-fill');
            const workBarValue = document.getElementById('work-bar-value');
            const kineticBarValue = document.getElementById('kinetic-bar-value');
            
            // Show displacement markers, energy chart, and angle diagram
            document.getElementById('displacement-markers').classList.add('visible');
            energyChart.classList.add('visible');
            angleDiagram.classList.add('visible');
            
            // Initialize the angle diagram
            initAngleDiagram();
            
            // Animate the measurement marker
            gsap.to(markerAnimation, { 
                duration: 2, 
                x: 200, 
                opacity: 1,
                scale: 1,
                ease: "power2.out",
                onStart: function() {
                    gsap.set(markerAnimation, { opacity: 0.7, scale: 1 });
                },
                onComplete: function() {
                    gsap.to(markerAnimation, { opacity: 0, scale: 0, duration: 0.5 });
                }
            });
            
            // Only move the object, not the person
            gsap.to(workObject, { 
                duration: 2, 
                x: 150, 
                ease: "power2.out",
                onStart: function() {
                    // Start energy particles from force vector to object
                    const forceRect = forceVector.getBoundingClientRect();
                    const objectRect = workObject.getBoundingClientRect();
                    
                    animateEnergyTransfer(
                        forceRect.right, 
                        forceRect.top + forceRect.height/2,
                        objectRect.left + objectRect.width/2,
                        objectRect.top + objectRect.height/2
                    );
                }
            });
            
            // Animate the work value counter and work bar
            gsap.to({ value: 0 }, {
                duration: 2,
                value: 50,
                ease: "power2.out",
                onUpdate: function() {
                    const currentValue = Math.round(this.targets()[0].value);
                    workValue.textContent = currentValue + " J";
                    workBarValue.textContent = currentValue + " J";
                    workBarFill.style.width = (currentValue * 2) + "%"; // 50J = 100% width
                }
            });
            
            // Animate the kinetic energy bar with slight delay
            gsap.to({ value: 0 }, {
                duration: 1.8,
                delay: 0.3,
                value: 50,
                ease: "power2.out",
                onUpdate: function() {
                    const currentValue = Math.round(this.targets()[0].value);
                    kineticBarValue.textContent = currentValue + " J";
                    kineticBarFill.style.width = (currentValue * 2) + "%"; // 50J = 100% width
                }
            });
            
            // Add subtle flash effect when work is complete
            gsap.to(workValue, { 
                delay: 2, 
                color: "#ffd700", 
                textShadow: "0 0 15px rgba(255, 215, 0, 0.8)",
                duration: 0.5,
                yoyo: true,
                repeat: 1
            });
        }

        // Demo functions with context-aware narration and sequential progression
        async function showCompleteLesson() {
            // Abort any running demo
            currentDemoAborted = true;
            await wait(200);
            
            // Start fresh
            resetAll();
            currentDemoAborted = false;
            isPlaying = true;
            const runId = ++currentRunId;
            
            const teacher = createNewTeacher();
            const lessonContext = 'complete-lesson';
            teacher.setContext(lessonContext);
            
            updateTitle("📚 Complete Work and Energy Lesson");
            
            // Welcome message
            await teacher.speak("Welcome to our comprehensive lesson on Work and Energy! Let's explore this fundamental concept in physics step by step.", 0, lessonContext);
            if (!shouldContinue()) return;
            
            // Show work definition
            await showWorkDefinitionInternal(lessonContext);
            if (!shouldContinue()) return;
            
            // Show work formula
            await showWorkFormulaInternal(lessonContext);
            if (!shouldContinue()) return;
            
            // Show work examples
            await showWorkExamplesInternal(lessonContext);
            if (!shouldContinue()) return;
            
            // Show NCERT activities and go through all of them
            // The automatic switch to numerical problems happens in narrateCurrentActivity
            await showNCERTActivitiesInternal(lessonContext, true);
            if (!shouldContinue()) return;
            
            // Show numerical problems
            await showNumericalProblemsInternal(lessonContext);
            if (!shouldContinue()) return;
            
            // Conclusion
            await teacher.speak("You've now completed the comprehensive lesson on Work and Energy! You've learned the definition, formula, types of work, and how to solve numerical problems.", 0, lessonContext);
            
            isPlaying = false;
        }

        async function showWorkDefinition() {
            // Abort any running demo
            currentDemoAborted = true;
            await wait(200);
            
            // Start fresh
            resetAll();
            currentDemoAborted = false;
            isPlaying = true;
            
            await showWorkDefinitionInternal('work-definition');
            
            isPlaying = false;
        }
        
        async function showWorkDefinitionInternal(parentContext = null) {
            const demoContext = parentContext || 'work-definition';
            const teacher = createNewTeacher();
            teacher.setContext(demoContext);
            
            // Hide all demos first
            hideAllDemos();
            
            updateTitle("🔬 What is Work in Physics?");
            document.getElementById('work-definition-demo').classList.add('active');
            
            await teacher.speak("In physics, work has a very specific meaning. It requires two essential conditions: a force must act on an object, and the object must move in the direction of the force.", 0, demoContext);
            if (!shouldContinue()) return;
            
            await wait(1000);
            document.getElementById('force-vector').classList.add('visible');
            await teacher.speak("First, we apply a force to the object.", 0, demoContext);
            if (!shouldContinue()) return;
            
            await wait(1000);
            document.getElementById('displacement-vector').classList.add('active');
            document.getElementById('displacement-label').classList.add('visible');
            await teacher.speak("Second, the object moves - this is displacement.", 0, demoContext);
            if (!shouldContinue()) return;
            
            await wait(1000);
            animateWork();
            await teacher.speak("When both conditions are met, work is done! The formula is Work equals Force times Displacement.", 0, demoContext);
            
            return true;
        }

        async function showWorkFormula() {
            // Abort any running demo
            currentDemoAborted = true;
            await wait(200);
            
            // Start fresh
            resetAll();
            currentDemoAborted = false;
            isPlaying = true;
            
            await showWorkFormulaInternal('work-formula');
            
            isPlaying = false;
        }
        
        // Initialize and animate the vector components diagram
        function initVectorComponentsDiagram() {
            const canvas = document.getElementById('vector-canvas');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            const width = canvas.width = 270;
            const height = canvas.height = 220;
            const centerX = width / 2 - 30; // Offset to leave room for labels
            const centerY = height / 2;
            const vectorLength = 100;
            
            // Set up slider
            const angleSlider = document.getElementById('vector-angle-slider');
            
            // Initial draw
            drawVectorComponents(30); // Default angle
            
            // Add event listener
            angleSlider.addEventListener('input', function() {
                const angle = parseInt(this.value);
                drawVectorComponents(angle);
            });
            
            function drawVectorComponents(angle) {
                // Clear canvas
                ctx.clearRect(0, 0, width, height);
                
                // Draw coordinate system
                ctx.strokeStyle = 'rgba(255, 255, 255, 0.2)';
                ctx.lineWidth = 1;
                ctx.beginPath();
                ctx.moveTo(20, centerY);
                ctx.lineTo(width - 20, centerY);
                ctx.moveTo(centerX, 20);
                ctx.lineTo(centerX, height - 20);
                ctx.stroke();
                
                // Add coordinate labels
                ctx.font = '12px Arial';
                ctx.fillStyle = 'rgba(255, 255, 255, 0.7)';
                ctx.fillText('X', width - 15, centerY - 5);
                ctx.fillText('Y', centerX + 5, 15);
                
                // Calculate vector components
                const angleRad = angle * Math.PI / 180;
                const vectorX = vectorLength * Math.cos(angleRad);
                const vectorY = vectorLength * Math.sin(angleRad);
                const endX = centerX + vectorX;
                const endY = centerY - vectorY; // Y is inverted in canvas
                
                // Draw main vector (force)
                ctx.strokeStyle = '#ef4444';
                ctx.lineWidth = 3;
                ctx.beginPath();
                ctx.moveTo(centerX, centerY);
                ctx.lineTo(endX, endY);
                ctx.stroke();
                
                // Draw arrowhead for main vector
                drawArrowhead(ctx, endX, endY, angleRad, '#ef4444');
                
                // Draw horizontal component (parallel to displacement)
                ctx.strokeStyle = '#10b981';
                ctx.lineWidth = 2;
                ctx.setLineDash([5, 3]);
                ctx.beginPath();
                ctx.moveTo(centerX, centerY);
                ctx.lineTo(endX, centerY);
                ctx.stroke();
                ctx.setLineDash([]);
                
                // Draw vertical component
                ctx.strokeStyle = '#3b82f6';
                ctx.lineWidth = 2;
                ctx.setLineDash([5, 3]);
                ctx.beginPath();
                ctx.moveTo(endX, centerY);
                ctx.lineTo(endX, endY);
                ctx.stroke();
                ctx.setLineDash([]);
                
                // Draw component labels
                ctx.font = '14px Arial';
                
                // Main vector label
                ctx.fillStyle = '#ef4444';
                ctx.fillText('F', endX + 10, endY);
                
                // Horizontal component label
                ctx.fillStyle = '#10b981';
                ctx.fillText('F cos(θ)', centerX + vectorX/2 - 20, centerY + 20);
                
                // Vertical component label
                ctx.fillStyle = '#3b82f6';
                ctx.fillText('F sin(θ)', endX + 10, centerY - vectorY/2);
                
                // Draw angle arc
                ctx.strokeStyle = '#fbbf24';
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.arc(centerX, centerY, 20, 0, -angleRad, angle > 0);
                ctx.stroke();
                
                // Add angle label
                ctx.fillStyle = '#fbbf24';
                const labelX = centerX + 25 * Math.cos(angleRad/2);
                const labelY = centerY - 25 * Math.sin(angleRad/2);
                ctx.fillText(angle + '°', labelX, labelY);
                
                // Add work formula
                ctx.fillStyle = 'white';
                ctx.font = '16px Arial';
                ctx.fillText('W = F × s × cos(θ) = F cos(θ) × s', 20, height - 20);
                
                // Draw dot at origin
                ctx.fillStyle = 'white';
                ctx.beginPath();
                ctx.arc(centerX, centerY, 3, 0, Math.PI * 2);
                ctx.fill();
            }
            
            function drawArrowhead(ctx, x, y, angle, color) {
                ctx.save();
                ctx.fillStyle = color;
                ctx.translate(x, y);
                ctx.rotate(-angle);
                ctx.beginPath();
                ctx.moveTo(10, 0);
                ctx.lineTo(-5, -5);
                ctx.lineTo(-5, 5);
                ctx.closePath();
                ctx.fill();
                ctx.restore();
            }
        }
        
        function animateFormula() {
            const formulaParts = ['formula-w', 'formula-f', 'formula-s', 'formula-cos'];
            let currentIndex = 0;
            
            // Clear any existing highlights
            document.querySelectorAll('.formula-part').forEach(part => {
                part.classList.remove('highlight');
            });
            
            // Function to highlight each part in sequence
            function highlightNextPart() {
                if (currentIndex > 0) {
                    // Remove highlight from previous part
                    document.getElementById(formulaParts[currentIndex - 1]).classList.remove('highlight');
                }
                
                if (currentIndex < formulaParts.length) {
                    // Highlight current part
                    document.getElementById(formulaParts[currentIndex]).classList.add('highlight');
                    currentIndex++;
                    setTimeout(highlightNextPart, 2000); // Move to next part after 2 seconds
                } else {
                    // Animation complete, remove all highlights after a delay
                    setTimeout(() => {
                        document.querySelectorAll('.formula-part').forEach(part => {
                            part.classList.remove('highlight');
                        });
                    }, 1000);
                }
            }
            
            // Start the animation
            highlightNextPart();
        }
        
        async function showWorkFormulaInternal(parentContext = null) {
            const demoContext = parentContext || 'work-formula';
            const teacher = createNewTeacher();
            teacher.setContext(demoContext);
            
            // Hide all demos first
            hideAllDemos();
            
            updateTitle("📐 Work Formula and Components");
            document.getElementById('work-formula-demo').classList.add('active');
            
            // Show and initialize vector components diagram immediately
            const vectorDiagram = document.getElementById('vector-components-diagram');
            if (vectorDiagram) {
                vectorDiagram.classList.add('visible');
                
                // Initialize the vector components diagram immediately
                initVectorComponentsDiagram();
            }
            
            await teacher.speak("The formula for work is beautifully simple yet powerful: W equals F times s times cosine theta. Let's understand each component.", 0, demoContext);
            if (!shouldContinue()) return;
            
            // Start formula animation
            animateFormula();
            
            await teacher.speak("W represents work measured in joules, F is the force in newtons, s is the displacement in meters, and cosine theta accounts for the angle between force and displacement.", 0, demoContext);
            
            await teacher.speak("The cosine component is particularly important as it determines how much of the force contributes to work. Only the component of force parallel to displacement does work.", 0, demoContext);
            
            return true;
        }

        async function showWorkExamples() {
            // Abort any running demo
            currentDemoAborted = true;
            await wait(200);
            
            // Start fresh
            resetAll();
            currentDemoAborted = false;
            isPlaying = true;
            
            await showWorkExamplesInternal('work-examples');
            
            isPlaying = false;
        }
        
        // Animate work comparison chart
        function animateWorkComparisonChart() {
            const comparisonChart = document.getElementById('work-comparison-chart');
            if (!comparisonChart) return;
            
            // Show the chart with a slight delay
            setTimeout(() => {
                comparisonChart.classList.add('visible');
                
                // Animate the bars
                setTimeout(() => {
                    // Positive work bar (100%)
                    const positiveBar = document.getElementById('positive-work-bar');
                    if (positiveBar) {
                        positiveBar.style.height = '100%';
                        // Show the label
                        const positiveLabel = positiveBar.querySelector('.bar-label-inside');
                        if (positiveLabel) {
                            positiveLabel.style.opacity = '1';
                        }
                    }
                    
                    // Negative work bar (80%)
                    const negativeBar = document.getElementById('negative-work-bar');
                    if (negativeBar) {
                        negativeBar.style.height = '80%';
                        // Show the label
                        const negativeLabel = negativeBar.querySelector('.bar-label-inside');
                        if (negativeLabel) {
                            negativeLabel.style.opacity = '1';
                        }
                    }
                    
                    // Zero work bar (0%) - keep it empty
                    const zeroBar = document.getElementById('zero-work-bar');
                    if (zeroBar) {
                        zeroBar.style.height = '0%'; // Keep it empty to show zero work
                        // Show the label outside the bar
                        const zeroLabel = zeroBar.querySelector('.bar-label-inside');
                        if (zeroLabel) {
                            zeroLabel.style.opacity = '1';
                        }
                    }
                }, 500);
            }, 1000);
        }
        
        async function showWorkExamplesInternal(parentContext = null) {
            const demoContext = parentContext || 'work-examples';
            const teacher = createNewTeacher();
            teacher.setContext(demoContext);
            
            // Hide all demos first
            hideAllDemos();
            
            updateTitle("💡 Types of Work - Real Examples");
            document.getElementById('work-examples-demo').classList.add('active');
            
            await teacher.speak("Let's explore three types of work: positive work where force helps motion, negative work where force opposes motion, and zero work where there's no displacement.", 0, demoContext);
            if (!shouldContinue()) return;
            
            // Animate the comparison chart
            animateWorkComparisonChart();
            
            await teacher.speak("In positive work, like pushing a car forward, the force and displacement are in the same direction, resulting in energy transfer to the object.", 0, demoContext);
            if (!shouldContinue()) return;
            
            await teacher.speak("In negative work, like braking a car, the force opposes the direction of motion, removing energy from the object.", 0, demoContext);
            if (!shouldContinue()) return;
            
            await teacher.speak("In zero work, like pushing against a wall, despite applying force, there's no displacement, so no work is done.", 0, demoContext);
            
            return true;
        }

        async function showNCERTActivities() {
            // Abort any running demo
            currentDemoAborted = true;
            await wait(200);
            
            // Start fresh
            resetAll();
            currentDemoAborted = false;
            isPlaying = true;
            
            await showNCERTActivitiesInternal('ncert-activities');
            
            isPlaying = false;
        }
        
        async function showNCERTActivitiesInternal(parentContext = null, goThroughAllActivities = false) {
            const demoContext = parentContext || 'ncert-activities';
            const teacher = createNewTeacher();
            teacher.setContext(demoContext);
            
            // Hide all demos first
            hideAllDemos();
            
            updateTitle("🧪 NCERT Activities - Work Exploration");
            document.getElementById('ncert-activities-demo').classList.add('active');
            
            // Initialize the activities carousel
            await initializeActivitiesCarousel();
            
            // Set context for the first activity
            teacher.setContext('activity-1');
            
            // Narrate the first activity
            await narrateCurrentActivity();
            if (!shouldContinue()) return;
            
            // If we need to go through all activities (for complete lesson)
            if (goThroughAllActivities) {
                // Go through all activities
                for (let i = 1; i < totalActivitiesSlides; i++) {
                    // Move to next activity
                    nextActivity();
                    
                    // Wait a moment for the transition
                    await wait(1000);
                    
                    // Narrate the current activity
                    await narrateCurrentActivity();
                    if (!shouldContinue()) return;
                }
            }
            
            return true;
        }

        async function showNumericalProblems() {
            // Abort any running demo
            currentDemoAborted = true;
            await wait(200);
            
            // Start fresh
            resetAll();
            currentDemoAborted = false;
            isPlaying = true;
            
            await showNumericalProblemsInternal('numerical-problems');
            
            isPlaying = false;
        }
        
        async function showNumericalProblemsInternal(parentContext = null) {
            const demoContext = parentContext || 'numerical-problems';
            const teacher = createNewTeacher();
            teacher.setContext(demoContext);
            
            // Hide all demos first
            hideAllDemos();
            
            updateTitle("📊 Numerical Problems - Practice Calculations");
            document.getElementById('numerical-demo').classList.add('active');
            
            // Initialize the numerical carousel
            initializeNumericalCarousel();
            
            // Set context for the first problem
            teacher.setContext('numerical-1');
            
            // Narrate the first problem
            await narrateCurrentNumerical();
            if (!shouldContinue()) return;
            
            return true;
        }

        // Event listeners
        document.addEventListener('DOMContentLoaded', function() {
            // Button click handlers
            document.querySelectorAll('.demo-btn').forEach(btn => {
                btn.addEventListener('click', async function() {
                    const demo = this.getAttribute('data-demo');
                    setActiveButton(this);
                    
                    // Stop any ongoing demo
                    currentDemoAborted = true;
                    if (currentTeacher) {
                        currentTeacher.stop();
                    }
                    
                    // Clear any active animations
                    activeAnimations.forEach(anim => {
                        if (anim && anim.cancel) {
                            anim.cancel();
                        }
                    });
                    activeAnimations = [];
                    
                    // Wait a moment to ensure clean state
                    await wait(200);
                    
                    // Start the selected demo
                    switch(demo) {
                        case 'complete':
                            showCompleteLesson();
                            break;
                        case 'definition':
                            showWorkDefinition();
                            break;
                        case 'formula':
                            showWorkFormula();
                            break;
                        case 'examples':
                            showWorkExamples();
                            break;
                        case 'activities':
                            showNCERTActivities();
                            break;
                        case 'numerical':
                            showNumericalProblems();
                            break;
                        case 'reset':
                            resetAll();
                            setActiveButton(null);
                            break;
                    }
                });
            });

            // Audio control
            document.getElementById('mute-btn').addEventListener('click', function() {
                globalAudioEnabled = !globalAudioEnabled;
                this.classList.toggle('muted', !globalAudioEnabled);
                
                if (!globalAudioEnabled && currentTeacher) {
                    currentTeacher.stop();
                }
            });

            // Initialize
            const teacher = createNewTeacher();
            const welcomeContext = 'initial-welcome';
            teacher.setContext(welcomeContext);
            teacher.speak("Welcome to Work and Energy! Select a demonstration to begin exploring.", 0, welcomeContext);
        });
    </script>
</body>
</html>