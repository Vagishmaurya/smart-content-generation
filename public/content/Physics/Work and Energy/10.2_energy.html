<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Work and Energy - Understanding Energy Forms and Conservation - Physics in Motion</title>
    <!-- GSAP for animations -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            color: white;
            overflow-x: hidden;
            min-height: 100vh;
        }

        /* Audio Control */
        #audio-control {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
        }

        .control-btn {
            background: rgba(16, 185, 129, 0.9);
            border: none;
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .control-btn:hover {
            transform: scale(1.1);
            background: rgba(16, 185, 129, 1);
        }

        .control-btn.muted .unmute-icon { display: none; }
        .control-btn:not(.muted) .mute-icon { display: none; }

        /* Main Container */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 30px 20px;
        }

        /* Header */
        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .header h1 {
            font-size: 3rem;
            background: linear-gradient(45deg, #10b981, #34d399, #fbbf24);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 15px;
            font-weight: 700;
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.95;
            max-width: 800px;
            margin: 0 auto;
            line-height: 1.6;
        }

        /* Demo Stage */
        .demo-stage {
            background: linear-gradient(to bottom, #1e293b, #334155, #475569);
            border-radius: 25px;
            min-height: 600px;
            position: relative;
            margin: 40px 0;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
            overflow: hidden;
            border: 3px solid rgba(16, 185, 129, 0.4);
            padding: 40px;
        }

        /* Energy Sources Demo */
        .energy-sources-demo {
            display: none;
            position: relative;
            width: 100%;
            height: 500px;
        }

        .energy-sources-demo.active {
            display: block;
        }

        .sun-system {
            position: relative;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .sun {
            position: absolute;
            width: 120px;
            height: 120px;
            background: radial-gradient(circle at 30% 30%, #fbbf24, #f59e0b, #d97706);
            border-radius: 50%;
            box-shadow: 0 0 50px rgba(251, 191, 36, 0.7);
            animation: sunPulse 3s ease-in-out infinite;
            z-index: 10;
        }

        @keyframes sunPulse {
            0%, 100% { transform: scale(1); box-shadow: 0 0 50px rgba(251, 191, 36, 0.7); }
            50% { transform: scale(1.1); box-shadow: 0 0 80px rgba(251, 191, 36, 0.9); }
        }

        .energy-source {
            position: absolute;
            background: rgba(16, 185, 129, 0.1);
            padding: 15px;
            border-radius: 15px;
            border: 2px solid rgba(16, 185, 129, 0.5);
            text-align: center;
            min-width: 135px;
            opacity: 0;
            transform: scale(0.8);
            transition: all 0.5s ease;
            white-space: nowrap;
        }

        .energy-source.visible {
            opacity: 1;
            transform: scale(1);
        }

        .source-icon {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .source-label {
            font-size: 0.9rem;
            color: #10b981;
            font-weight: 600;
        }

        .energy-ray {
            position: absolute;
            width: 3px;
            background: linear-gradient(to right, #fbbf24, transparent);
            opacity: 0;
            transform-origin: left center;
        }

        .energy-ray.visible {
            opacity: 0.8;
            animation: rayPulse 2s ease-in-out infinite;
        }

        @keyframes rayPulse {
            0%, 100% { opacity: 0.8; transform: scaleX(1); }
            50% { opacity: 1; transform: scaleX(1.2); }
        }

        /* Kinetic Energy Demo */
        .kinetic-demo {
            display: none;
            position: relative;
            width: 100%;
            height: 550px;
        }

        .kinetic-demo.active {
            display: block;
        }

        .speed-comparison {
            display: flex;
            justify-content: space-around;
            align-items: center;
            height: 100%;
        }

        .object-track {
            width: 300px;
            height: 150px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            position: relative;
            border: 2px solid rgba(16, 185, 129, 0.3);
        }

        .moving-object {
            position: absolute;
            width: 40px;
            height: 40px;
            background: linear-gradient(145deg, #ef4444, #dc2626);
            border-radius: 50%;
            top: 50%;
            left: 20px;
            transform: translateY(-50%);
            box-shadow: 0 5px 15px rgba(239, 68, 68, 0.5);
        }

        .object-info {
            position: absolute;
            bottom: -75px;
            left: 50%;
            transform: translateX(-50%);
            text-align: center;
            background: rgba(0, 0, 0, 0.7);
            padding: 10px;
            border-radius: 10px;
            border: 1px solid rgba(16, 185, 129, 0.5);
        }

        .speed-label {
            color: #10b981;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .energy-value {
            color: #fbbf24;
            font-family: 'Courier New', monospace;
            font-size: 1.1rem;
        }

        /* Trolley Experiment Demo */
        .trolley-demo {
            display: none;
            position: relative;
            width: 100%;
            height: 550px;
        }

        .trolley-demo.active {
            display: block;
        }

        .trolley-setup {
            position: relative;
            width: 100%;
            height: 100%;
            background: linear-gradient(to bottom, #f8fafc 0%, #e2e8f0 100%);
            border-radius: 15px;
            overflow: hidden;
            border: 3px solid rgba(16, 185, 129, 0.3);
        }

        .table {
            position: absolute;
            bottom: 150px;
            left: 50px;
            right: 50px;
            height: 20px;
            background: linear-gradient(to bottom, #8b5cf6, #7c3aed);
            border-radius: 5px;
            box-shadow: 0 5px 15px rgba(139, 92, 246, 0.3);
        }

        .table-legs {
            position: absolute;
            bottom: 50px;
            left: 70px;
            right: 70px;
            height: 100px;
        }

        .table-leg {
            position: absolute;
            width: 8px;
            height: 100px;
            background: linear-gradient(to bottom, #6b7280, #4b5563);
            border-radius: 4px;
        }

        .table-leg.left { left: 0; }
        .table-leg.right { right: 0; }
        .table-leg.center-left { left: 30%; }
        .table-leg.center-right { right: 30%; }

        .trolley {
            position: absolute;
            bottom: 170px;
            left: 80px;
            width: 120px;
            height: 40px;
            background: linear-gradient(145deg, #4f46e5, #3b82f6);
            border-radius: 8px;
            border: 2px solid #2563eb;
            box-shadow: 0 5px 15px rgba(59, 130, 246, 0.5);
            z-index: 10;
            overflow: visible;
        }

        .trolley::before {
            content: 'üõí';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 1.8rem;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
        }
        
        .trolley::after {
            position: absolute;
            bottom: -5px;
            right: 5px;
            font-size: 10px;
            color: white;
            font-weight: bold;
            text-shadow: 1px 1px 1px rgba(0, 0, 0, 0.5);
        }

        .trolley-wheels {
            position: absolute;
            bottom: -8px;
            left: 10px;
            right: 10px;
            height: 16px;
        }

        .wheel {
            position: absolute;
            width: 16px;
            height: 16px;
            background: #374151;
            border-radius: 50%;
            border: 2px solid #1f2937;
        }

        .wheel.front { right: 0; }
        .wheel.back { left: 0; }

        .wooden-block {
            position: absolute;
            bottom: 170px;
            left: 350px;
            width: 60px;
            height: 40px;
            background: linear-gradient(145deg, #92400e, #78350f);
            border-radius: 4px;
            border: 2px solid #451a03;
            box-shadow: 0 5px 15px rgba(146, 64, 14, 0.4);
            z-index: 20; /* Increased z-index to make it appear above other elements */
            overflow: visible;
        }
        
        .wooden-block::before {
            content: 'üì¶';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 1.5rem;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
        }
        
        .wooden-block::after {
            content: 'BLOCK';
            position: absolute;
            bottom: -15px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 10px;
            color: #451a03;
            font-weight: bold;
        }

        .pulley-system {
            position: absolute;
            top: 65%;
            right: 20px;
            width: 80px;
            height: 180px;
            overflow: visible;
        }

        .pulley {
            position: absolute;
            top: 0;
            right: 0;
            width: 40px;
            height: 40px;
            background: radial-gradient(circle, #6b7280, #4b5563);
            border-radius: 50%;
            border: 3px solid #374151;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
            overflow: visible;
        }
        
        .pulley::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 10px;
            height: 10px;
            background: #1f2937;
            border-radius: 50%;
        }
        
        .pulley::after {
            content: 'PULLEY';
            position: absolute;
            top: -20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 10px;
            color: #374151;
            font-weight: bold;
        }

        .string {
            position: absolute;
            top: 20px;
            right: 18px;
            width: 3px;
            height: 50px;
            background: #4b5563;
            box-shadow: 1px 1px 2px rgba(0, 0, 0, 0.2);
            transform-origin: top center;
        }
        
        .horizontal-string {
            position: absolute;
            top: 20px;
            right: 20px;
            height: 3px;
            width: 830px; /* Length from pulley to trolley */
            background: #4b5563;
            box-shadow: 1px 1px 2px rgba(0, 0, 0, 0.2);
            transform-origin: right center;
        }

        .hanging-mass {
            position: absolute;
            bottom: 110px;
            right: 8px;
            width: 24px;
            height: 24px;
            background: linear-gradient(145deg, #ef4444, #dc2626);
            border-radius: 4px;
            border: 2px solid #991b1b;
            box-shadow: 0 3px 10px rgba(239, 68, 68, 0.4);
            overflow: visible;
        }
        
        .hanging-mass::after {
            content: 'MASS';
            position: absolute;
            bottom: -15px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 9px;
            color: #991b1b;
            font-weight: bold;
            white-space: nowrap;
        }

        .force-arrow {
            position: absolute;
            opacity: 0;
            transition: opacity 0.5s ease;
            z-index: 15;
        }

        .force-arrow.visible {
            opacity: 1;
        }

        .arrow-line {
            background: linear-gradient(90deg, rgba(239,68,68,0.5) 0%, rgba(239,68,68,1) 100%);
            height: 5px;
            border-radius: 3px;
            position: relative;
            box-shadow: 0 2px 4px rgba(239, 68, 68, 0.3);
        }

        .arrow-head {
            position: absolute;
            right: -8px;
            top: -5px;
            width: 0;
            height: 0;
            border-left: 14px solid #ef4444;
            border-top: 8px solid transparent;
            border-bottom: 8px solid transparent;
            filter: drop-shadow(2px 2px 2px rgba(0, 0, 0, 0.2));
        }
        
        .force-arrow::after {
            content: 'FORCE';
            position: absolute;
            top: -15px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 10px;
            color: #ef4444;
            font-weight: bold;
            text-shadow: 1px 1px 1px rgba(255, 255, 255, 0.8);
        }

        .displacement-indicator {
            position: absolute;
            bottom: 120px;
            left: 350px;
            width: 0px;
            height: 4px;
            background: linear-gradient(90deg, rgba(16,185,129,0.7) 0%, rgba(16,185,129,1) 100%);
            transition: width 0.8s ease;
            border-radius: 3px;
            box-shadow: 0 2px 4px rgba(16, 185, 129, 0.3);
            z-index: 5;
        }

        .displacement-label {
            position: absolute;
            bottom: 90px;
            left: 350px;
            background: rgba(16, 185, 129, 0.9);
            color: white;
            padding: 6px 12px;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 600;
            opacity: 0;
            transition: opacity 0.5s ease;
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(16, 185, 129, 1);
            text-shadow: 1px 1px 1px rgba(0, 0, 0, 0.3);
            z-index: 15;
        }
        
        /* Energy Transfer Visualization */
        .energy-transfer-container {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            width: 300px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 10px;
            padding: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            border: 1px solid #e5e7eb;
            opacity: 0;
            transition: opacity 0.5s ease;
            z-index: 20;
            display: none;
        }
        
        .energy-transfer-container.visible {
            opacity: 1;
            display: block;
        }
        
        .energy-transfer-label {
            text-align: center;
            font-weight: bold;
            color: #1f2937;
            margin-bottom: 8px;
            font-size: 0.9rem;
        }
        
        .energy-bars {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .energy-bar-wrapper {
            flex: 1;
        }
        
        .energy-bar-label {
            text-align: center;
            font-size: 0.8rem;
            margin-bottom: 4px;
            color: #4b5563;
        }
        
        .energy-bar-outer {
            height: 15px;
            background: #e5e7eb;
            border-radius: 8px;
            overflow: hidden;
        }
        
        .energy-bar-inner {
            height: 100%;
            width: 0%;
            transition: width 0.5s ease;
        }
        
        .trolley-energy {
            background: linear-gradient(90deg, #3b82f6, #1d4ed8);
        }
        
        .block-energy {
            background: linear-gradient(90deg, #f59e0b, #d97706);
        }
        
        .energy-transfer-arrow {
            margin: 0 10px;
            color: #4b5563;
            font-size: 1.5rem;
            font-weight: bold;
        }
        
        /* Educational concept labels */
        .concept-label {
            position: absolute;
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid;
            border-radius: 6px;
            padding: 4px 8px;
            font-size: 0.8rem;
            font-weight: bold;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            z-index: 25;
            opacity: 0;
            transition: opacity 0.5s ease;
        }
        
        .concept-label.visible {
            opacity: 1;
        }
        
        .pulley-label {
            top: -25px;
            right: 0;
            color: #7c3aed;
            border-color: #7c3aed;
        }
        
        .trolley-label {
            top: -60px;
            left: 50%;
            transform: translateX(-50%);
            color: #3b82f6;
            border-color: #3b82f6;
        }
        
        .block-label {
            bottom: 220px;
            left: 350px;
            color: #10b981;
            border-color: #10b981;
            transition: left 0.8s ease;
        }

        .experiment-controls {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.8);
            padding: 15px;
            border-radius: 15px;
            border: 2px solid rgba(16, 185, 129, 0.5);
            backdrop-filter: blur(10px);
        }

        .mass-control {
            margin: 10px 0;
        }

        .mass-label {
            color: #10b981;
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .mass-slider {
            width: 150px;
            background: rgba(16, 185, 129, 0.3);
            border-radius: 5px;
        }

        .experiment-button {
            background: linear-gradient(135deg, #10b981, #059669);
            border: none;
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 10px;
            width: 100%;
        }

        .experiment-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(16, 185, 129, 0.4);
        }

        .experiment-button:disabled {
            background: #6b7280;
            cursor: not-allowed;
            transform: none;
        }

        /* Questions Demo */
        .questions-demo {
            display: none;
            padding: 20px;
            position: relative;
        }

        .questions-demo.active {
            display: block;
        }

        .questions-slideshow {
            position: relative;
            width: 100%;
            height: 550px; /* Increased height to accommodate controls */
            overflow: hidden;
            border-radius: 15px;
            padding: 0;
        }

        .questions-container {
            display: flex;
            width: 300%;
            height: 100%;
            transition: transform 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        .question-card {
            background: rgba(15, 23, 42, 0.9);
            padding: 25px;
            border-radius: 15px;
            border: 2px solid rgba(16, 185, 129, 0.3);
            width: calc(33.33% - 20px);
            flex-shrink: 0;
            margin: 0 10px;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            overflow-y: auto;
            max-height: 470px; /* Adjusted to leave space for controls */
        }

        .question-title {
            color: #10b981;
            font-size: 1.4rem;
            margin-bottom: 20px;
            font-weight: 600;
            text-align: center;
        }

        .question-problem {
            background: rgba(59, 130, 246, 0.1);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 4px solid #3b82f6;
        }

        .problem-text {
            color: #e2e8f0;
            font-size: 1.1rem;
            line-height: 1.6;
            margin-bottom: 15px;
        }

        .problem-figure {
            text-align: center;
            margin: 20px 0;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
        }

        .figure-diagram {
            font-size: 2rem;
            margin: 10px 0;
        }

        .figure-caption {
            color: #9ca3af;
            font-size: 0.9rem;
            font-style: italic;
        }

        .solution-section {
            background: rgba(16, 185, 129, 0.1);
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid #10b981;
        }

        .solution-title {
            color: #10b981;
            font-size: 1.2rem;
            margin-bottom: 15px;
            font-weight: 600;
        }

        .solution-step {
            margin: 15px 0;
            padding: 15px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
        }

        .step-header {
            color: #fbbf24;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .step-content {
            color: #e2e8f0;
            line-height: 1.5;
        }

        .formula-highlight {
            background: rgba(251, 191, 36, 0.2);
            padding: 10px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            color: #fbbf24;
            text-align: center;
            margin: 10px 0;
            border: 1px solid rgba(251, 191, 36, 0.3);
        }

        .calculation-box {
            background: rgba(239, 68, 68, 0.1);
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            color: #ef4444;
            margin: 10px 0;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        .answer-box {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.2), rgba(34, 197, 94, 0.2));
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            font-size: 1.3rem;
            font-weight: bold;
            color: #10b981;
            margin-top: 20px;
            border: 2px solid rgba(16, 185, 129, 0.4);
        }

        /* Questions Navigation */
        .carousel-controls {
            position: absolute;
            width: 90%;
            top: 84%;
            height: 70px;
            margin: 20px auto 0;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(16, 185, 129, 0.05);
            border-radius: 35px;
            padding: 8px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
        }

        .questions-nav {
            position: relative;
            background: #10b981;
            border: 4px solid white;
            color: white;
            width: 55px;
            height: 55px;
            border-radius: 50%;
            font-size: 2.5rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 300;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.3);
            margin: 0 10px;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
        }

        .questions-nav:hover {
            background: #0ea271;
            transform: scale(1.15);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
            border-color: #ffffff;
        }

        /* Questions Indicators */
        .questions-indicators {
            display: flex;
            gap: 8px;
            z-index: 100;
            margin: 0 20px;
            background: rgba(16, 185, 129, 0.1);
            padding: 8px 15px;
            border-radius: 20px;
        }

        .questions-indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: rgba(16, 185, 129, 0.4);
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            margin: 0 5px;
        }

        .questions-indicator.active {
            background: #10b981;
            transform: scale(1.3);
            border-color: white;
            width: 12px;
            height: 12px;
            box-shadow: 0 0 5px rgba(16, 185, 129, 0.8);
        }

        .questions-indicator:hover {
            background: rgba(16, 185, 129, 0.8);
            transform: scale(1.1);
        }

        /* Potential Energy Demo */
        .potential-demo {
            display: none;
            position: relative;
            width: 100%;
            height: 550px;
        }

        .potential-demo.active {
            display: block;
        }

        .height-comparison {
            display: flex;
            justify-content: space-around;
            align-items: flex-end;
            height: 100%;
            padding: 50px 0;
        }

        .height-platform {
            position: relative;
            background: linear-gradient(to bottom, #6b7280, #4b5563);
            border-radius: 10px 10px 0 0;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            padding-top: 20px;
        }

        .platform-object {
            width: 30px;
            height: 30px;
            background: linear-gradient(145deg, #3b82f6, #2563eb);
            border-radius: 50%;
            box-shadow: 0 5px 15px rgba(59, 130, 246, 0.5);
        }

        .height-label {
            position: absolute;
            bottom: -45px;
            left: 50%;
            transform: translateX(-50%);
            color: #10b981;
            font-weight: 600;
            white-space: nowrap;
        }

        .potential-value {
            position: absolute;
            top: -55px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            padding: 8px 12px;
            border-radius: 10px;
            color: #fbbf24;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            white-space: nowrap;
        }

        /* Conservation Demo */
        .conservation-demo {
            display: none;
            position: relative;
            width: 100%;
            height: 500px;
        }

        .conservation-demo.active {
            display: block;
        }

        .pendulum-container {
            position: relative;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .pendulum-support {
            position: absolute;
            top: 50px;
            width: 20px;
            height: 20px;
            background: #6b7280;
            border-radius: 50%;
            z-index: 10;
        }

        .pendulum-string {
            position: absolute;
            top: 60px;
            left: 50%;
            width: 2px;
            height: 200px;
            background: #9ca3af;
            transform-origin: top center;
            transform: translateX(-50%);
        }

        .pendulum-bob {
            position: absolute;
            bottom: -20px;
            left: 50%;
            width: 30px;
            height: 30px;
            background: linear-gradient(145deg, #8b5cf6, #7c3aed);
            border-radius: 50%;
            transform: translateX(-50%);
            box-shadow: 0 5px 15px rgba(139, 92, 246, 0.5);
        }

        .energy-bar-container {
            position: absolute;
            right: 20px;
            top: 50px;
            width: 200px;
            height: 300px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 20px;
            border: 2px solid rgba(16, 185, 129, 0.3);
        }

        .energy-bar {
            width: 100%;
            height: 40px;
            margin: 10px 0;
            border-radius: 20px;
            position: relative;
            background: rgba(255, 255, 255, 0.1);
        }

        .energy-fill {
            height: 100%;
            border-radius: 20px;
            transition: width 0.5s ease;
        }

        .kinetic-fill {
            background: linear-gradient(to right, #ef4444, #dc2626);
        }

        .potential-fill {
            background: linear-gradient(to right, #3b82f6, #2563eb);
        }

        .total-fill {
            background: linear-gradient(to right, #10b981, #059669);
        }

        .energy-label {
            position: absolute;
            left: 10px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 0.9rem;
            font-weight: 600;
            color: white;
        }

        /* Formula Demo */
        .formula-demo {
            display: none;
            padding: 20px;
            position: relative;
        }

        .formula-demo.active {
            display: block;
        }

        .formula-slideshow {
            position: relative;
            width: 100%;
            height: 550px; /* Increased height to accommodate controls */
            overflow: hidden;
            border-radius: 15px;
            padding: 0;
        }

        .formula-container {
            display: flex;
            width: 400%;
            height: 100%;
            transition: transform 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        .formula-card {
            background: rgba(15, 23, 42, 0.9);
            padding: 25px;
            border-radius: 15px;
            border: 2px solid rgba(16, 185, 129, 0.3);
            width: calc(25% - 20px);
            flex-shrink: 0;
            margin: 0 10px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            max-height: 470px; /* Adjusted to leave space for controls */
        }

        .formula-card.show {
            opacity: 1;
            transform: translateY(0);
            transition: all 0.6s ease;
        }

        /* Navigation Arrows */
        .formula-nav {
            position: relative;
            background: #10b981;
            border: 4px solid white;
            color: white;
            width: 55px;
            height: 55px;
            border-radius: 50%;
            font-size: 2.5rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 300;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.3);
            margin: 0 10px;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
        }

        .formula-nav:hover {
            background: #0ea271;
            transform: scale(1.15);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
            border-color: #ffffff;
        }

        /* Slide Indicators */
        .formula-indicators {
            display: flex;
            gap: 8px;
            z-index: 100;
            margin: 0 20px;
            background: rgba(16, 185, 129, 0.1);
            padding: 8px 15px;
            border-radius: 20px;
        }

        .formula-indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: rgba(16, 185, 129, 0.4);
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            margin: 0 5px;
        }

        .formula-indicator.active {
            background: #10b981;
            transform: scale(1.3);
            border-color: white;
            width: 12px;
            height: 12px;
            box-shadow: 0 0 5px rgba(16, 185, 129, 0.8);
        }

        .formula-indicator:hover {
            background: rgba(16, 185, 129, 0.8);
            transform: scale(1.1);
        }

        .formula-title {
            color: #10b981;
            font-size: 1.3rem;
            margin-bottom: 15px;
            font-weight: 600;
        }

        .formula-equation {
            font-family: 'Courier New', monospace;
            font-size: 1.8rem;
            color: #fbbf24;
            text-align: center;
            margin: 20px 0;
            padding: 15px;
            background: rgba(251, 191, 36, 0.1);
            border-radius: 10px;
            border: 1px solid rgba(251, 191, 36, 0.3);
        }

        .formula-explanation {
            line-height: 1.6;
            color: #e2e8f0;
            font-size: 1rem;
        }

        /* Interactive Calculator */
        .calculator-demo {
            display: none;
            padding: 30px;
        }

        .calculator-demo.active {
            display: block;
        }

        .calculator-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin: 20px 0;
        }

        .calc-section {
            background: rgba(15, 23, 42, 0.9);
            padding: 25px;
            border-radius: 15px;
            border: 2px solid rgba(16, 185, 129, 0.3);
        }

        .calc-title {
            color: #10b981;
            font-size: 1.4rem;
            margin-bottom: 20px;
            font-weight: 600;
            text-align: center;
        }

        .input-group {
            margin: 15px 0;
        }

        .input-label {
            display: block;
            color: #e2e8f0;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .calc-input {
            width: 100%;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(16, 185, 129, 0.4);
            color: white;
            padding: 12px 15px;
            border-radius: 10px;
            font-size: 1rem;
        }

        .calc-input:focus {
            outline: none;
            border-color: #10b981;
            box-shadow: 0 0 10px rgba(16, 185, 129, 0.3);
        }

        .calc-button {
            background: linear-gradient(135deg, #10b981, #059669);
            border: none;
            color: white;
            padding: 12px 25px;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            margin-top: 15px;
        }

        .calc-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(16, 185, 129, 0.4);
        }

        .result-display {
            background: rgba(251, 191, 36, 0.1);
            padding: 20px;
            border-radius: 15px;
            border: 2px solid rgba(251, 191, 36, 0.3);
            margin-top: 20px;
            text-align: center;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .result-text {
            color: #fbbf24;
            font-size: 1.2rem;
            font-weight: 600;
            font-family: 'Courier New', monospace;
        }

        /* Controls */
        .controls {
            text-align: center;
            margin: 40px 0;
        }

        .controls-title {
            font-size: 1.8rem;
            margin-bottom: 25px;
            color: #10b981;
            font-weight: 600;
        }

        .demo-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
            margin: 25px 0;
        }

        .demo-btn {
            background: linear-gradient(135deg, #10b981, #059669);
            border: none;
            color: white;
            padding: 14px 24px;
            border-radius: 30px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 8px 20px rgba(16, 185, 129, 0.3);
            min-width: 150px;
        }

        .demo-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 25px rgba(16, 185, 129, 0.4);
        }

        .demo-btn.active {
            background: linear-gradient(135deg, #fbbf24, #f59e0b);
            box-shadow: 0 8px 20px rgba(251, 191, 36, 0.4);
        }

        /* Theory Section */
        .theory-section {
            background: rgba(15, 23, 42, 0.9);
            border-radius: 25px;
            padding: 35px;
            margin: 35px 0;
            border: 3px solid rgba(16, 185, 129, 0.4);
            backdrop-filter: blur(15px);
        }

        .key-concept {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.2), rgba(251, 191, 36, 0.2));
            padding: 25px;
            border-radius: 20px;
            margin: 20px 0;
            border-left: 5px solid #10b981;
        }

        .concept-title {
            font-size: 1.4rem;
            color: #10b981;
            margin-bottom: 15px;
            font-weight: 600;
        }

        .concept-content {
            font-size: 1.1rem;
            line-height: 1.8;
            color: #e2e8f0;
        }

        .main-equation {
            font-size: 2rem;
            color: #fbbf24;
            font-family: 'Courier New', monospace;
            margin: 15px 0;
            text-shadow: 0 0 20px rgba(251, 191, 36, 0.5);
            text-align: center;
        }

        .activity-card {
            background: rgba(16, 185, 129, 0.1);
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            border-left: 4px solid #10b981;
        }

        .activity-title {
            color: #10b981;
            font-size: 1.2rem;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .activity-steps {
            list-style: none;
            padding: 0;
        }

        .activity-steps li {
            padding: 8px 0;
            padding-left: 20px;
            position: relative;
            color: #e2e8f0;
        }

        .activity-steps li:before {
            content: '‚Ä¢';
            position: absolute;
            left: 0;
            color: #10b981;
            font-size: 1.2rem;
        }

        /* Energy Forms Grid */
        .energy-forms-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .energy-form-card {
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            border-radius: 15px;
            border: 2px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
            text-align: center;
        }

        .energy-form-card:hover {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.08);
            border-color: #10b981;
        }

        .form-icon {
            font-size: 3rem;
            margin-bottom: 15px;
        }

        .form-title {
            font-size: 1.2rem;
            color: #10b981;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .form-description {
            font-size: 0.9rem;
            line-height: 1.6;
            opacity: 0.9;
            color: #e2e8f0;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .header h1 { font-size: 2.2rem; }
            .demo-stage { padding: 30px 20px; min-height: 400px; }
            .demo-buttons { flex-direction: column; align-items: center; }
            .calculator-grid { grid-template-columns: 1fr; }
            .speed-comparison, .height-comparison { flex-direction: column; gap: 30px; }
            .energy-forms-grid { grid-template-columns: 1fr; }
        }

        @media (max-width: 480px) {
            .container { padding: 20px 15px; }
            .header h1 { font-size: 1.8rem; }
            .demo-stage { padding: 20px 15px; }
            .theory-section { padding: 20px; }
            .main-equation { font-size: 1.5rem; }
        }
    </style>
</head>
<body>
    <!-- Audio Control -->
    <div id="audio-control">
        <button id="mute-btn" class="control-btn">
            <span class="unmute-icon">üîä</span>
            <span class="mute-icon">üîá</span>
        </button>
    </div>

    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>Work and Energy</h1>
            <p>Discover the fascinating world of energy - from kinetic and potential energy to the universal law of energy conservation!</p>
        </div>

        <!-- Demo Stage -->
        <div class="demo-stage" id="stage">
            <!-- Energy Sources Demo -->
            <div class="energy-sources-demo" id="energy-sources-demo">
                <div class="sun-system">
                    <div class="sun" id="sun">‚òÄÔ∏è</div>
                    
                    <!-- Energy Sources positioned around the sun -->
                    <div class="energy-source" id="source-wind" style="top: 10%; left: 15%;">
                        <div class="source-icon">üí®</div>
                        <div class="source-label">Wind Energy</div>
                    </div>
                    
                    <div class="energy-source" id="source-hydro" style="top: 10%; right: 15%;">
                        <div class="source-icon">üíß</div>
                        <div class="source-label">Hydro Energy</div>
                    </div>
                    
                    <div class="energy-source" id="source-fossil" style="bottom: 10%; left: 25%;">
                        <div class="source-icon">üè≠</div>
                        <div class="source-label">Fossil Fuels</div>
                    </div>
                    
                    <div class="energy-source" id="source-plant" style="bottom: 10%; right: 25%;">
                        <div class="source-icon">üå±</div>
                        <div class="source-label">Plants</div>
                    </div>
                    
                    <div class="energy-source" id="source-nuclear" style="top: 50%; left: 5%;">
                        <div class="source-icon">‚öõÔ∏è</div>
                        <div class="source-label">Nuclear</div>
                    </div>
                    
                    <div class="energy-source" id="source-geo" style="top: 50%; right: 5%;">
                        <div class="source-icon">üåã</div>
                        <div class="source-label">Geothermal</div>
                    </div>
                    
                    <!-- Energy rays connecting sun to sources -->
                    <div class="energy-ray" id="ray-1"></div>
                    <div class="energy-ray" id="ray-2"></div>
                    <div class="energy-ray" id="ray-3"></div>
                    <div class="energy-ray" id="ray-4"></div>
                </div>
            </div>

            <!-- Kinetic Energy Demo -->
            <div class="kinetic-demo" id="kinetic-demo">
                <div class="speed-comparison">
                    <div class="object-track">
                        <div class="moving-object" id="slow-object"></div>
                        <div class="object-info">
                            <div class="speed-label">Slow Object</div>
                            <div class="energy-value" id="slow-energy">KE = 0 J</div>
                        </div>
                    </div>
                    
                    <div class="object-track">
                        <div class="moving-object" id="fast-object"></div>
                        <div class="object-info">
                            <div class="speed-label">Fast Object</div>
                            <div class="energy-value" id="fast-energy">KE = 0 J</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Trolley Experiment Demo -->
            <div class="trolley-demo" id="trolley-demo">
                <div class="trolley-setup">
                    <!-- Table -->
                    <div class="table"></div>
                    <div class="table-legs">
                        <div class="table-leg left"></div>
                        <div class="table-leg center-left"></div>
                        <div class="table-leg center-right"></div>
                        <div class="table-leg right"></div>
                    </div>
                    
                    <!-- Trolley with wheels -->
                    <div class="trolley" id="trolley">
                        <div class="trolley-wheels">
                            <div class="wheel back"></div>
                            <div class="wheel front"></div>
                        </div>
                        <div class="concept-label trolley-label">Kinetic Energy</div>
                    </div>
                    
                    <!-- Wooden Block -->
                    <div class="wooden-block" id="wooden-block"></div>
                    <div class="concept-label block-label">Work Done</div>
                    
                    <!-- Pulley System -->
                    <div class="pulley-system">
                        <div class="pulley"></div>
                        <div class="string" id="vertical-string"></div>
                        <div class="hanging-mass" id="hanging-mass"></div>
                        <!-- <div class="concept-label pulley-label">Potential Energy</div> -->
                        <!-- Horizontal string connecting pulley to trolley -->
                        <div class="horizontal-string" id="horizontal-string"></div>
                    </div>
                    
                    <!-- Force Arrows -->
                    <div class="force-arrow" id="trolley-force" style="bottom: 190px; left: 200px;">
                        <div class="arrow-line" style="width: 80px;"></div>
                        <div class="arrow-head"></div>
                    </div>
                    
                    <!-- Displacement Indicator -->
                    <div class="displacement-indicator" id="displacement-indicator"></div>
                    <div class="displacement-label" id="displacement-label">Displacement: 0 cm</div>
                    
                    <!-- Energy Transfer Visualization -->
                    <div class="energy-transfer-container" id="energy-transfer-container">
                        <div class="energy-transfer-label">Energy Transfer</div>
                        <div class="energy-bars">
                            <div class="energy-bar-wrapper">
                                <div class="energy-bar-label">Trolley KE</div>
                                <div class="energy-bar-outer">
                                    <div class="energy-bar-inner trolley-energy" id="trolley-energy-bar"></div>
                                </div>
                            </div>
                            <div class="energy-transfer-arrow">‚Üí</div>
                            <div class="energy-bar-wrapper">
                                <div class="energy-bar-label">Block KE</div>
                                <div class="energy-bar-outer">
                                    <div class="energy-bar-inner block-energy" id="block-energy-bar"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Experiment Controls -->
                    <div class="experiment-controls">
                        <h4 style="color: #10b981; margin-bottom: 15px;">Activity 10.7 Controls</h4>
                        
                        <div class="mass-control">
                            <div class="mass-label">Hanging Mass: <span id="mass-value">100</span> g</div>
                            <!-- <input type="range" id="mass-slider" class="mass-slider" min="50" max="200" value="100" step="25"> -->
                        </div>
                        
                        <!-- <button class="experiment-button" id="run-experiment" onclick="runTrolleyExperiment()">
                            üöÄ Run Experiment
                        </button> -->
                        
                        <!-- <button class="experiment-button" id="reset-experiment" onclick="resetTrolleyExperiment()">
                            üîÑ Reset Setup
                        </button> -->
                    </div>
                </div>
            </div>

            <!-- Questions Demo -->
            <div class="questions-demo" id="questions-demo">
                <div class="questions-slideshow">
                    <div class="questions-container" id="questions-container">
                        <!-- Question 1 -->
                        <div class="question-card" id="question-1">
                            <div class="question-title">Question 1: Work Done by Force</div>
                            
                            <div class="question-problem">
                                <div class="problem-text">
                                    A force of 7 N acts on an object. The displacement is 8 m in the direction of the force (Fig. 10.3). 
                                    Let us take it that the force acts on the object through the displacement. What is the work done in this case?
                                </div>
                                
                                <div class="problem-figure">
                                    <div class="figure-diagram">
                                        üì¶ ‚Üê7N ‚Äî‚Äî‚Äî‚Äî8m‚Äî‚Äî‚Äî‚Äî üì¶
                                    </div>
                                    <div class="figure-caption">Fig. 10.3: Force acting in direction of displacement</div>
                                </div>
                            </div>
                            
                            <div class="solution-section">
                                <div class="solution-title">Solution:</div>
                                
                                <div class="solution-step">
                                    <div class="step-header">Given:</div>
                                    <div class="step-content">
                                        Force, F = 7 N<br>
                                        Displacement, s = 8 m<br>
                                        Direction: Force and displacement are in the same direction
                                    </div>
                                </div>
                                
                                <div class="solution-step">
                                    <div class="step-header">Formula:</div>
                                    <div class="formula-highlight">W = F √ó s √ó cos Œ∏</div>
                                    <div class="step-content">
                                        Since force and displacement are in the same direction, Œ∏ = 0¬∞<br>
                                        Therefore, cos Œ∏ = cos 0¬∞ = 1
                                    </div>
                                </div>
                                
                                <div class="solution-step">
                                    <div class="step-header">Calculation:</div>
                                    <div class="calculation-box">
                                        W = F √ó s<br>
                                        W = 7 N √ó 8 m<br>
                                        W = 56 J
                                    </div>
                                </div>
                                
                                <div class="answer-box">
                                    The work done is 56 J (Joules)
                                </div>
                            </div>
                        </div>

                        <!-- Example 10.4 -->
                        <div class="question-card" id="question-2">
                            <div class="question-title">Example 10.4: Work-Energy Theorem</div>
                            
                            <div class="question-problem">
                                <div class="problem-text">
                                    What is the work to be done to increase the velocity of a car from 30 km h‚Åª¬π to 60 km h‚Åª¬π 
                                    if the mass of the car is 1500 kg?
                                </div>
                                
                                <div class="problem-figure">
                                    <div class="figure-diagram">
                                        üöó 30 km/h ‚Üí üöó 60 km/h
                                    </div>
                                    <div class="figure-caption">Car accelerating from 30 to 60 km/h</div>
                                </div>
                            </div>
                            
                            <div class="solution-section">
                                <div class="solution-title">Solution:</div>
                                
                                <div class="solution-step">
                                    <div class="step-header">Given:</div>
                                    <div class="step-content">
                                        Mass of car, m = 1500 kg<br>
                                        Initial velocity, u = 30 km h‚Åª¬π<br>
                                        Final velocity, v = 60 km h‚Åª¬π
                                    </div>
                                </div>
                                
                                <div class="solution-step">
                                    <div class="step-header">Convert to m/s:</div>
                                    <div class="calculation-box">
                                        u = 30 √ó (1000/3600) = 25/3 m s‚Åª¬π<br>
                                        v = 60 √ó (1000/3600) = 50/3 m s‚Åª¬π
                                    </div>
                                </div>
                                
                                <div class="solution-step">
                                    <div class="step-header">Apply Work-Energy Theorem:</div>
                                    <div class="formula-highlight">W = ŒîKE = KEf - KEi</div>
                                    <div class="calculation-box">
                                        KEi = ¬Ω √ó 1500 √ó (25/3)¬≤ = 156,250/3 J<br>
                                        KEf = ¬Ω √ó 1500 √ó (50/3)¬≤ = 625,000/3 J<br>
                                        W = 625,000/3 - 156,250/3<br>
                                        W = 468,750/3 = 156,250 J
                                    </div>
                                </div>
                                
                                <div class="answer-box">
                                    Work done = 156,250 J = 156.25 kJ
                                </div>
                            </div>
                        </div>

                        <!-- Example 10.6 -->
                        <div class="question-card" id="question-3">
                            <div class="question-title">Example 10.6: Potential Energy</div>
                            
                            <div class="question-problem">
                                <div class="problem-text">
                                    An object of mass 12 kg is at a certain height above the ground. If the potential energy of the object is 480 J, 
                                    find the height at which the object is with respect to the ground. Given, g = 10 m s‚Åª¬≤.
                                </div>
                                
                                <div class="problem-figure">
                                    <div class="figure-diagram">
                                        üì¶ ‚Üê h = ? <br>
                                        ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî<br>
                                        üåç Ground Level
                                    </div>
                                    <div class="figure-caption">Object at height h above ground</div>
                                </div>
                            </div>
                            
                            <div class="solution-section">
                                <div class="solution-title">Solution:</div>
                                
                                <div class="solution-step">
                                    <div class="step-header">Given:</div>
                                    <div class="step-content">
                                        Mass of object, m = 12 kg<br>
                                        Potential energy, PE = 480 J<br>
                                        Acceleration due to gravity, g = 10 m s‚Åª¬≤<br>
                                        Height, h = ? (to find)
                                    </div>
                                </div>
                                
                                <div class="solution-step">
                                    <div class="step-header">Formula:</div>
                                    <div class="formula-highlight">PE = mgh</div>
                                </div>
                                
                                <div class="solution-step">
                                    <div class="step-header">Rearranging for height:</div>
                                    <div class="calculation-box">
                                        PE = mgh<br>
                                        480 J = 12 kg √ó 10 m s‚Åª¬≤ √ó h<br>
                                        480 = 120 √ó h<br>
                                        h = 480/120 = 4 m
                                    </div>
                                </div>
                                
                                <div class="answer-box">
                                    The object is at a height of 4 m above the ground
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Carousel Controls -->
                    <div class="carousel-controls">
                        <button class="questions-nav prev" id="questions-prev" onclick="previousQuestion()">‚Äπ</button>
                        <div class="questions-indicators">
                            <div class="questions-indicator active" onclick="goToQuestion(0)"></div>
                            <div class="questions-indicator" onclick="goToQuestion(1)"></div>
                            <div class="questions-indicator" onclick="goToQuestion(2)"></div>
                        </div>
                        <button class="questions-nav next" id="questions-next" onclick="nextQuestion()">‚Ä∫</button>
                    </div>
                </div>
            </div>

            <!-- Potential Energy Demo -->
            <div class="potential-demo" id="potential-demo">
                <div class="height-comparison">
                    <div class="height-platform" style="height: 100px; width: 100px;">
                        <div class="platform-object"></div>
                        <div class="height-label">h = 2m</div>
                        <div class="potential-value">PE = 196 J</div>
                    </div>
                    
                    <div class="height-platform" style="height: 150px; width: 100px;">
                        <div class="platform-object"></div>
                        <div class="height-label">h = 3m</div>
                        <div class="potential-value">PE = 294 J</div>
                    </div>
                    
                    <div class="height-platform" style="height: 200px; width: 100px;">
                        <div class="platform-object"></div>
                        <div class="height-label">h = 4m</div>
                        <div class="potential-value">PE = 392 J</div>
                    </div>
                </div>
            </div>

            <!-- Conservation Demo -->
            <div class="conservation-demo" id="conservation-demo">
                <div class="pendulum-container">
                    <div class="pendulum-support"></div>
                    <div class="pendulum-string" id="pendulum-string">
                        <div class="pendulum-bob" id="pendulum-bob"></div>
                    </div>
                    
                    <div class="energy-bar-container">
                        <h4 style="color: #10b981; margin-bottom: 20px; text-align: center;">Energy Conservation</h4>
                        
                        <div class="energy-bar">
                            <div class="energy-fill kinetic-fill" id="kinetic-bar" style="width: 0%"></div>
                            <div class="energy-label" style="color: white;">Kinetic</div>
                        </div>
                        
                        <div class="energy-bar">
                            <div class="energy-fill potential-fill" id="potential-bar" style="width: 100%"></div>
                            <div class="energy-label" style="color: white;">Potential</div>
                        </div>
                        
                        <div class="energy-bar">
                            <div class="energy-fill total-fill" id="total-bar" style="width: 100%"></div>
                            <div class="energy-label" style="color: white;">Total</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Formula Demo -->
            <div class="formula-demo" id="formula-demo">
                <div class="formula-slideshow">
                    <div class="formula-container" id="formula-container">
                        <div class="formula-card" id="formula-1">
                            <div class="formula-title">Kinetic Energy</div>
                            <div class="formula-equation">KE = ¬Ωmv¬≤</div>
                            <div class="formula-explanation">
                                Energy possessed by an object due to its motion. It depends on both mass (m) and velocity (v). 
                                Notice that velocity is squared, so doubling speed increases kinetic energy by 4 times!
                            </div>
                        </div>

                        <div class="formula-card" id="formula-2">
                            <div class="formula-title">Potential Energy</div>
                            <div class="formula-equation">PE = mgh</div>
                            <div class="formula-explanation">
                                Energy possessed by an object due to its position or height. It depends on mass (m), 
                                acceleration due to gravity (g), and height (h) above reference level.
                            </div>
                        </div>

                        <div class="formula-card" id="formula-3">
                            <div class="formula-title">Conservation of Energy</div>
                            <div class="formula-equation">KE + PE = Constant</div>
                            <div class="formula-explanation">
                                Total mechanical energy remains constant in the absence of friction. As one form decreases, 
                                the other increases by the same amount, keeping the total energy unchanged.
                            </div>
                        </div>

                        <div class="formula-card" id="formula-4">
                            <div class="formula-title">Work-Energy Theorem</div>
                            <div class="formula-equation">W = ŒîKE</div>
                            <div class="formula-explanation">
                                Work done on an object equals the change in its kinetic energy. This fundamental relationship 
                                connects the concepts of work and energy in physics.
                            </div>
                        </div>
                    </div>
                    
                    <!-- Carousel Controls -->
                    <div class="carousel-controls">
                        <button class="formula-nav prev" id="formula-prev" onclick="previousSlide()">‚Äπ</button>
                        <div class="formula-indicators">
                            <div class="formula-indicator active" onclick="goToSlide(0)"></div>
                            <div class="formula-indicator" onclick="goToSlide(1)"></div>
                            <div class="formula-indicator" onclick="goToSlide(2)"></div>
                            <div class="formula-indicator" onclick="goToSlide(3)"></div>
                        </div>
                        <button class="formula-nav next" id="formula-next" onclick="nextSlide()">‚Ä∫</button>
                    </div>
                </div>
            </div>

            <!-- Interactive Calculator -->
            <div class="calculator-demo" id="calculator-demo">
                <div class="calculator-grid">
                    <div class="calc-section">
                        <div class="calc-title">üöÄ Kinetic Energy Calculator</div>
                        
                        <div class="input-group">
                            <label class="input-label">Mass (kg):</label>
                            <input type="number" id="ke-mass" class="calc-input" placeholder="Enter mass in kg" step="0.1">
                        </div>
                        
                        <div class="input-group">
                            <label class="input-label">Velocity (m/s):</label>
                            <input type="number" id="ke-velocity" class="calc-input" placeholder="Enter velocity in m/s" step="0.1">
                        </div>
                        
                        <button class="calc-button" onclick="calculateKineticEnergy()">Calculate KE</button>
                        
                        <div class="result-display">
                            <div class="result-text" id="ke-result">Enter values to calculate kinetic energy</div>
                        </div>
                    </div>
                    
                    <div class="calc-section">
                        <div class="calc-title">‚õ∞Ô∏è Potential Energy Calculator</div>
                        
                        <div class="input-group">
                            <label class="input-label">Mass (kg):</label>
                            <input type="number" id="pe-mass" class="calc-input" placeholder="Enter mass in kg" step="0.1">
                        </div>
                        
                        <div class="input-group">
                            <label class="input-label">Height (m):</label>
                            <input type="number" id="pe-height" class="calc-input" placeholder="Enter height in m" step="0.1">
                        </div>
                        
                        <button class="calc-button" onclick="calculatePotentialEnergy()">Calculate PE</button>
                        
                        <div class="result-display">
                            <div class="result-text" id="pe-result">Enter values to calculate potential energy</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Controls -->
        <div class="controls">
            <div class="controls-title" id="demo-title">Explore Work and Energy</div>
            
            <div class="demo-buttons">
                <button class="demo-btn" onclick="playCompleteLesson()">üìö Complete Lesson</button>
                <button class="demo-btn" onclick="showEnergySources()">‚òÄÔ∏è Energy Sources</button>
                <button class="demo-btn" onclick="showKineticEnergy()">üöÄ Kinetic Energy</button>
                <button class="demo-btn" onclick="showTrolleyExperiment()">üõí Activity 10.7</button>
                <button class="demo-btn" onclick="showPotentialEnergy()">‚õ∞Ô∏è Potential Energy</button>
                <button class="demo-btn" onclick="showConservation()">üîÑ Conservation</button>
                <button class="demo-btn" onclick="showFormulas()">üìê Formulas</button>
                <button class="demo-btn" onclick="showQuestions()">‚ùì NCERT Questions</button>
                <button class="demo-btn" onclick="showCalculator()">üßÆ Calculator</button>
                <button class="demo-btn" onclick="resetAllClick()">üîÑ Reset</button>
            </div>
        </div>

        <!-- Theory Section -->
        <div class="theory-section">
            <div class="key-concept">
                <div class="concept-title">What is Energy?</div>
                <div class="concept-content">
                    Energy is the capacity to do work. An object having a capability to do work is said to possess energy. 
                    The object which does the work loses energy and the object on which the work is done gains energy.
                    Energy is measured in Joules (J), the same unit as work.
                </div>
                <div class="main-equation">Energy = Capacity to do Work</div>
            </div>

            <div class="energy-forms-grid">
                <div class="energy-form-card">
                    <div class="form-icon">üöÄ</div>
                    <div class="form-title">Kinetic Energy</div>
                    <div class="form-description">Energy due to motion. Faster objects have more kinetic energy.</div>
                </div>
                
                <div class="energy-form-card">
                    <div class="form-icon">‚õ∞Ô∏è</div>
                    <div class="form-title">Potential Energy</div>
                    <div class="form-description">Energy due to position or height. Higher objects have more potential energy.</div>
                </div>
                
                <div class="energy-form-card">
                    <div class="form-icon">üî•</div>
                    <div class="form-title">Heat Energy</div>
                    <div class="form-description">Energy due to temperature. Hot objects have more heat energy.</div>
                </div>
                
                <div class="energy-form-card">
                    <div class="form-icon">üí°</div>
                    <div class="form-title">Light Energy</div>
                    <div class="form-description">Energy carried by light waves. Brighter light has more energy.</div>
                </div>
                
                <div class="energy-form-card">
                    <div class="form-icon">‚ö°</div>
                    <div class="form-title">Electrical Energy</div>
                    <div class="form-description">Energy due to moving electric charges. Powers our devices.</div>
                </div>
                
                <div class="energy-form-card">
                    <div class="form-icon">üß™</div>
                    <div class="form-title">Chemical Energy</div>
                    <div class="form-description">Energy stored in chemical bonds. Found in food and fuel.</div>
                </div>
            </div>

            <div class="activity-card">
                <div class="activity-title">Activity 10.6: Ball Drop Experiment</div>
                <ul class="activity-steps">
                    <li>Take a heavy ball and drop it on a thick bed of sand</li>
                    <li>Drop the ball from different heights: 25 cm, 50 cm, 1m, and 1.5m</li>
                    <li>Observe the depth of depressions made at each height</li>
                    <li>Notice that greater height creates deeper depression</li>
                    <li>This shows that objects at greater heights have more energy</li>
                </ul>
            </div>

            <div class="activity-card">
                <div class="activity-title">Activity 10.7: Trolley and Block Experiment (NCERT)</div>
                <ul class="activity-steps">
                    <li>Set up the apparatus as shown in Fig. 10.5 with trolley, wooden block, and pulley system</li>
                    <li>Place a wooden block of known mass in front of the trolley at a fixed distance</li>
                    <li>Place a known mass on the pan so that the trolley starts moving</li>
                    <li>The trolley moves forward and hits the wooden block, which gets displaced</li>
                    <li>Note down the displacement of the block - this means work is done on the block</li>
                    <li>From where does this energy come? (Answer: From the kinetic energy of the moving trolley)</li>
                    <li>Repeat by increasing the mass on the pan - greater mass = more displacement = more work done</li>
                    <li><strong>Conclusion:</strong> Moving objects possess kinetic energy and can do work</li>
                </ul>
            </div>

            <div class="key-concept">
                <div class="concept-title">Law of Conservation of Energy</div>
                <div class="concept-content">
                    Energy can neither be created nor destroyed; it can only be converted from one form to another. 
                    The total energy of an isolated system remains constant. This is one of the most fundamental laws of physics.
                </div>
                <div class="main-equation">Total Energy = Constant</div>
            </div>

            <div class="activity-card">
                <div class="activity-title">NCERT Example 10.3: Kinetic Energy Calculation</div>
                <ul class="activity-steps">
                    <li><strong>Problem:</strong> Find kinetic energy of 15 kg object moving at 4 m/s</li>
                    <li><strong>Given:</strong> m = 15 kg, v = 4 m/s</li>
                    <li><strong>Formula:</strong> KE = ¬Ωmv¬≤</li>
                    <li><strong>Solution:</strong> KE = ¬Ω √ó 15 √ó 4¬≤ = ¬Ω √ó 15 √ó 16 = 120 J</li>
                    <li><strong>Answer:</strong> The kinetic energy is 120 J</li>
                </ul>
            </div>

            <div class="activity-card">
                <div class="activity-title">NCERT Example 10.5: Potential Energy Calculation</div>
                <ul class="activity-steps">
                    <li><strong>Problem:</strong> Find potential energy of 10 kg object at 6 m height</li>
                    <li><strong>Given:</strong> m = 10 kg, h = 6 m, g = 9.8 m/s¬≤</li>
                    <li><strong>Formula:</strong> PE = mgh</li>
                    <li><strong>Solution:</strong> PE = 10 √ó 9.8 √ó 6 = 588 J</li>
                    <li><strong>Answer:</strong> The potential energy is 588 J</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        // Voice Teacher System
        class PhysicsTeacher {
            constructor() {
                this.isEnabled = globalAudioEnabled;
                this.currentUtterance = null;
                this.settings = { rate: 0.9, pitch: 1.0, volume: 0.85 };
                this.isDestroyed = false;
            }

            async speak(text, delay = 0) {
                if (!this.isEnabled || !text || this.isDestroyed) return;
                
                return new Promise((resolve) => {
                    setTimeout(() => {
                        if (this.isDestroyed) {
                            resolve();
                            return;
                        }
                        this.stop();
                        const utterance = new SpeechSynthesisUtterance(text);
                        Object.assign(utterance, this.settings);
                        
                        utterance.onend = resolve;
                        utterance.onerror = resolve;
                        
                        this.currentUtterance = utterance;
                        speechSynthesis.speak(utterance);
                    }, delay);
                });
            }

            stop() {
                speechSynthesis.cancel();
                this.currentUtterance = null;
            }

            destroy() {
                this.isDestroyed = true;
                this.stop();
                this.currentUtterance = null;
                this.settings = null;
            }
        }

        // Global state management
        let globalAudioEnabled = true;
        let currentTeacher = null;
        let isPlaying = false;
        let animationTimeline = null;
        let currentDemoAborted = false;
        let activeAnimations = [];
        let currentRunId = 0;
        let currentTaskId = null; // Track current task ID
        let taskQueue = []; // Queue for task-specific content

        // State management functions
        function createNewTimeline() {
            if (animationTimeline) {
                animationTimeline.kill();
                animationTimeline = null;
            }
            activeAnimations.forEach(anim => {
                if (anim) anim.kill();
            });
            activeAnimations = [];
            gsap.killTweensOf("*");
            
            const newTimeline = gsap.timeline();
            animationTimeline = newTimeline;
            return newTimeline;
        }

        function trackAnimation(animation) {
            if (animation) {
                activeAnimations.push(animation);
            }
            return animation;
        }

        function stopCurrentDemo() {
            currentDemoAborted = true;
            currentRunId++;
            
            // Clear current task context
            currentTaskId = null;
            taskQueue = [];
            
            if (currentTeacher) {
                currentTeacher.destroy();
                currentTeacher = null;
            }
            
            if (animationTimeline) {
                animationTimeline.kill();
                animationTimeline = null;
            }
            
            activeAnimations.forEach(anim => {
                if (anim) anim.kill();
            });
            activeAnimations = [];
            
            gsap.killTweensOf("*");
            
            document.querySelectorAll('.energy-sources-demo, .kinetic-demo, .trolley-demo, .questions-demo, .potential-demo, .conservation-demo, .formula-demo, .calculator-demo').forEach(demo => {
                demo.classList.remove('active');
            });
            
            isPlaying = false;
        }

        function shouldContinue(taskId = null) {
            // If a specific task ID is provided, check if it matches current task
            if (taskId && currentTaskId && taskId !== currentTaskId) {
                return false;
            }
            return !currentDemoAborted;
        }

        function createNewTeacher(taskId = null) {
            if (currentTeacher) {
                currentTeacher.destroy();
                currentTeacher = null;
            }
            currentDemoAborted = false;
            currentTaskId = taskId;
            currentTeacher = new PhysicsTeacher();
            return currentTeacher;
        }

        // Content validation - ensures only relevant content is displayed and narrated
        function isContentRelevantToCurrentTask(contentType) {
            // Get currently active demo
            const activeDemos = document.querySelectorAll('.energy-sources-demo.active, .kinetic-demo.active, .trolley-demo.active, .questions-demo.active, .potential-demo.active, .conservation-demo.active, .formula-demo.active, .calculator-demo.active');
            
            if (activeDemos.length === 0) {
                return false; // No active demo
            }
            
            const activeDemo = activeDemos[0];
            const demoId = activeDemo.id;
            
            // Map content types to their relevant demos
            const contentMapping = {
                'energy-sources': ['energy-sources-demo'],
                'kinetic-energy': ['kinetic-demo'],
                'trolley-experiment': ['trolley-demo'],
                'questions': ['questions-demo'],
                'potential-energy': ['potential-demo'],
                'conservation': ['conservation-demo'],
                'formulas': ['formula-demo'],
                'calculator': ['calculator-demo']
            };
            
            // Check if current content type matches active demo
            return contentMapping[contentType] && contentMapping[contentType].includes(demoId);
        }
        
        // Enhanced speak function that checks content relevance
        async function speakIfRelevant(teacher, text, contentType, taskId) {
            if (!teacher || !text) return;
            
            // Check if content is relevant to current screen
            if (!isContentRelevantToCurrentTask(contentType)) {
                return; // Skip narration if content doesn't match current screen
            }
            
            // Check if task is still active
            if (!shouldContinue(taskId)) {
                return;
            }
            
            await teacher.speak(text);
        }

        // Initialize
        window.addEventListener('load', () => {
            const teacher = createNewTeacher('initialization');
            teacher.speak("Welcome to Work and Energy! Let's explore the fundamental concepts of energy and discover how it transforms from one form to another!");
        });

        // Complete Lesson
        async function playCompleteLesson() {
            const taskId = 'complete-lesson';
            stopCurrentDemo();
            isPlaying = true;
            setActiveButton(0);
            
            const teacher = createNewTeacher(taskId);
            
            await resetAll();
            await wait(100);
            if (!shouldContinue(taskId)) return;
            
            updateTitle("üìö Complete NCERT Lesson: Work and Energy");
            
            await teacher.speak("Let's begin our complete lesson on Work and Energy from NCERT Chapter 10. We'll understand what energy is and explore its different forms.");
            if (!shouldContinue(taskId)) return;
            
            // Energy Sources - Keep Complete Lesson button active but show visual indicator
            highlightSectionButton(1); // New function to highlight without changing active state
            await teacher.speak("First, let's discover where we get energy from in our world.");
            if (!shouldContinue(taskId)) return;
            await showEnergySourcesInternal(teacher, taskId);
            if (!shouldContinue(taskId)) return;
            await wait(2000);
            
            // Kinetic Energy
            highlightSectionButton(2);
            await teacher.speak("Now let's understand kinetic energy - the energy of motion.");
            if (!shouldContinue(taskId)) return;
            await showKineticEnergyInternal(teacher, taskId);
            if (!shouldContinue(taskId)) return;
            await wait(2000);
            
            // Trolley Experiment
            highlightSectionButton(3);
            await teacher.speak("Let's perform the famous NCERT Activity 10.7 to see how moving objects can do work.");
            if (!shouldContinue(taskId)) return;
            await showTrolleyExperimentInternal(teacher, taskId);
            if (!shouldContinue(taskId)) return;
            await wait(2000);
            
            // Potential Energy
            highlightSectionButton(4);
            await teacher.speak("Next, we'll explore potential energy - the energy of position.");
            if (!shouldContinue(taskId)) return;
            await showPotentialEnergyInternal(teacher, taskId);
            if (!shouldContinue(taskId)) return;
            await wait(2000);
            
            // Conservation
            highlightSectionButton(5);
            await teacher.speak("Let's see how energy is conserved - never created or destroyed, only transformed.");
            if (!shouldContinue(taskId)) return;
            await showConservationInternal(teacher, taskId);
            if (!shouldContinue(taskId)) return;
            await wait(2000);
            
            // Formulas
            highlightSectionButton(6);
            await teacher.speak("Let's review the key formulas that help us calculate different forms of energy.");
            if (!shouldContinue(taskId)) return;
            await showFormulasInternal(teacher, taskId);
            if (!shouldContinue(taskId)) return;
            await waitForFormulaNarrationComplete(taskId); // Wait for formula narration to complete
            if (!shouldContinue(taskId)) return;
            await wait(2000);
            
            // NCERT Questions
            highlightSectionButton(7);
            await teacher.speak("Now let's solve some important NCERT questions to practice our understanding.");
            if (!shouldContinue(taskId)) return;
            await showQuestionsInternal(teacher, taskId);
            if (!shouldContinue(taskId)) return;
            
            // Wait for question narration to complete before moving to next section
            await waitForQuestionNarrationComplete(taskId);
            if (!shouldContinue(taskId)) return;
            await wait(2000);
            
            // Calculator
            highlightSectionButton(8);
            await teacher.speak("Finally, let's use our interactive calculator to solve energy problems.");
            if (!shouldContinue(taskId)) return;
            await showCalculatorInternal(teacher, taskId);
            if (!shouldContinue(taskId)) return;
            
            // Keep Complete Lesson button active at the end
            setActiveButton(0);
            await teacher.speak("Excellent! You now understand that energy is the capacity to do work, and it can be transformed but never destroyed. This fundamental concept governs everything in our universe!");
            
            isPlaying = false;
        }

        // Energy Sources Demo
        async function showEnergySources() {
            const taskId = 'energy-sources';
            stopCurrentDemo();
            isPlaying = true;
            setActiveButton(1);
            
            const teacher = createNewTeacher(taskId);
            await showEnergySourcesInternal(teacher, taskId);
            
            isPlaying = false;
        }

        async function showEnergySourcesInternal(teacher, taskId = 'energy-sources') {
            await resetAll();
            await wait(50);
            if (!shouldContinue(taskId)) return;
            
            updateTitle("‚òÄÔ∏è Sources of Energy");
            
            document.getElementById('energy-sources-demo').classList.add('active');
            await wait(50);
            if (!shouldContinue(taskId)) return;
            
            await teacher.speak("Life is impossible without energy. The Sun is our biggest natural source of energy. Let's see how many energy sources are connected to the Sun.");
            if (!shouldContinue(taskId)) return;
            
            // Show energy sources one by one
            const sources = ['source-wind', 'source-hydro', 'source-plant', 'source-fossil'];
            const sourceNames = ['Wind energy comes from air heated by the Sun', 'Hydro energy comes from the water cycle powered by solar heating', 'Plants convert sunlight into chemical energy through photosynthesis', 'Fossil fuels are ancient plants that stored solar energy millions of years ago'];
            
            for (let i = 0; i < sources.length; i++) {
                if (!shouldContinue(taskId)) return;
                document.getElementById(sources[i]).classList.add('visible');
                await wait(1000);
                if (!shouldContinue(taskId)) return;
                await teacher.speak(sourceNames[i]);
                await wait(1500);
            }
            
            await wait(1000);
            if (!shouldContinue(taskId)) return;
            
            // Show non-solar sources
            document.getElementById('source-nuclear').classList.add('visible');
            await wait(800);
            if (!shouldContinue(taskId)) return;
            await teacher.speak("Nuclear energy comes from atomic nuclei, not from the Sun.");
            await wait(1500);
            
            document.getElementById('source-geo').classList.add('visible');
            await wait(800);
            if (!shouldContinue(taskId)) return;
            await teacher.speak("Geothermal energy comes from Earth's interior heat, also not from the Sun.");
            
            await wait(1000);
            await teacher.speak("Most of our energy sources are ultimately derived from the Sun, but some come from other sources like atomic nuclei and Earth's interior!");
        }

        // Kinetic Energy Demo
        async function showKineticEnergy() {
            const taskId = 'kinetic-energy';
            stopCurrentDemo();
            isPlaying = true;
            setActiveButton(2);
            
            const teacher = createNewTeacher(taskId);
            await showKineticEnergyInternal(teacher, taskId);
            
            isPlaying = false;
        }

        async function showKineticEnergyInternal(teacher, taskId = 'kinetic-energy') {
            await resetAll();
            await wait(50);
            if (!shouldContinue(taskId)) return;
            
            updateTitle("üöÄ Kinetic Energy - Energy of Motion");
            
            document.getElementById('kinetic-demo').classList.add('active');
            await wait(50);
            if (!shouldContinue(taskId)) return;
            
            await teacher.speak("Kinetic energy is the energy possessed by an object due to its motion. Let's compare objects moving at different speeds.");
            if (!shouldContinue(taskId)) return;
            
            // Reset object positions
            gsap.set('#slow-object', { x: 0 });
            gsap.set('#fast-object', { x: 0 });
            document.getElementById('slow-energy').textContent = 'KE = 0 J';
            document.getElementById('fast-energy').textContent = 'KE = 0 J';
            
            await wait(1000);
            if (!shouldContinue(taskId)) return;
            
            // Animate slow object with proper timing
            await teacher.speak("First, watch this object moving slowly.");
            if (!shouldContinue(taskId)) return;
            
            // Start slow object animation
            trackAnimation(gsap.to('#slow-object', {
                duration: 3,
                x: 200,
                ease: "none",
                onUpdate: function() {
                    const velocity = 2; // 2 m/s
                    const mass = 5; // 5 kg
                    const ke = 0.5 * mass * velocity * velocity;
                    document.getElementById('slow-energy').textContent = `KE = ${ke} J`;
                }
            }));
            
            // Wait for slow object to complete one cycle
            await wait(3000);
            if (!shouldContinue(taskId)) return;
            
            // Stop slow object and reset
            gsap.killTweensOf('#slow-object');
            gsap.set('#slow-object', { x: 0 });
            document.getElementById('slow-energy').textContent = 'KE = 0 J';
            
            await wait(1000);
            if (!shouldContinue(taskId)) return;
            
            // Animate fast object with proper timing
            await teacher.speak("Now watch this object moving much faster. Notice how its kinetic energy is much higher!");
            if (!shouldContinue(taskId)) return;
            
            // Start fast object animation
            trackAnimation(gsap.to('#fast-object', {
                duration: 1.5,
                x: 200,
                ease: "none",
                onUpdate: function() {
                    const velocity = 8; // 8 m/s (4 times faster)
                    const mass = 5; // 5 kg
                    const ke = 0.5 * mass * velocity * velocity;
                    document.getElementById('fast-energy').textContent = `KE = ${ke} J`;
                }
            }));
            
            // Wait for fast object to complete
            await wait(1500);
            if (!shouldContinue(taskId)) return;
            
            // Stop fast object
            gsap.killTweensOf('#fast-object');
            gsap.set('#fast-object', { x: 0 });
            document.getElementById('fast-energy').textContent = 'KE = 0 J';
            
            await wait(1000);
            if (!shouldContinue(taskId)) return;
            
            await teacher.speak("Notice that the faster object has 16 times more kinetic energy! This is because kinetic energy depends on velocity squared. The formula is KE equals half m v squared.");
        }

        // Trolley Experiment Demo
        async function showTrolleyExperiment() {
            const taskId = 'trolley-experiment';
            stopCurrentDemo();
            isPlaying = true;
            setActiveButton(3);
            
            const teacher = createNewTeacher(taskId);
            await showTrolleyExperimentInternal(teacher, taskId);
            
            isPlaying = false;
        }

        async function showTrolleyExperimentInternal(teacher, taskId = 'trolley-experiment') {
            await resetAll();
            await wait(50);
            if (!shouldContinue(taskId)) return;
            
            updateTitle("üõí Activity 10.7: Trolley and Block Experiment");
            
            document.getElementById('trolley-demo').classList.add('active');
            await wait(50);
            if (!shouldContinue(taskId)) return;
            
            await teacher.speak("This is NCERT Activity 10.7. We have a trolley connected to a hanging mass through a pulley system. Let me demonstrate how different masses affect the motion and energy transfer.");
            if (!shouldContinue(taskId)) return;
            
            // Initialize the mass slider event
            initializeTrolleyControls();
            
            // Reset experiment to initial state
            resetTrolleyExperiment();
            await wait(1000);
            if (!shouldContinue(taskId)) return;
            
            // Automatic demonstration with different masses
            const masses = [50, 100, 150, 200];
            const massNames = ["50 grams", "100 grams", "150 grams", "200 grams"];
            
            for (let i = 0; i < masses.length; i++) {
                if (!shouldContinue(taskId)) return;
                
                const mass = masses[i];
                const massName = massNames[i];
                
                // Update slider and display
                const slider = document.getElementById('mass-slider');
                const massDisplay = document.getElementById('mass-value');
                if (slider) slider.value = mass;
                if (massDisplay) massDisplay.textContent = mass;
                
                await teacher.speak(`Trial ${i + 1}: Setting hanging mass to ${massName}. Watch as the trolley gains kinetic energy and transfers it to the wooden block.`);
                if (!shouldContinue(taskId)) return;
                
                await wait(1000);
                if (!shouldContinue(taskId)) return;
                
                // Run the experiment automatically with proper timing
                await runTrolleyExperimentAutomatic(mass, taskId);
                if (!shouldContinue(taskId)) return;
                
                await wait(1000);
                if (!shouldContinue(taskId)) return;
                
                // Explain the result
                const displacement = calculateDisplacement(mass);
                await teacher.speak(`Result: With ${massName}, the wooden block moved ${(displacement * 0.5).toFixed(1)} centimeters. Notice that the displacement is directly proportional to the mass - more mass results in more displacement. The greater hanging mass creates more potential energy, which converts to kinetic energy in the trolley, which then transfers to the block during collision.`);
                if (!shouldContinue(taskId)) return;
                
                await wait(1500);
                if (!shouldContinue(taskId)) return;
                
                // Reset for next trial (except on last iteration)
                if (i < masses.length - 1) {
                    resetTrolleyExperiment();
                    await wait(1000);
                    if (!shouldContinue(taskId)) return;
                    await teacher.speak("Resetting the experiment for the next trial.");
                    if (!shouldContinue(taskId)) return;
                    await wait(1000);
                }
            }
            
            await wait(1000);
            if (!shouldContinue(taskId)) return;
            await teacher.speak("This experiment beautifully demonstrates several physics principles: (1) Potential energy of the hanging mass converts to kinetic energy in the trolley, (2) During collision, the trolley transfers its kinetic energy to the block following conservation of momentum, (3) The work-energy theorem shows that work done equals the change in kinetic energy, and (4) The displacement is directly proportional to the mass - more mass means more displacement. This direct relationship shows how energy transformations occur in mechanical systems!");
        }

        function initializeTrolleyControls() {
            const massSlider = document.getElementById('mass-slider');
            const massValue = document.getElementById('mass-value');
            
            if (massSlider) {
                massSlider.addEventListener('input', function() {
                    massValue.textContent = this.value;
                });
            }
        }

        // Trolley experiment variables
        let isExperimentRunning = false;

        async function runTrolleyExperiment() {
            if (isExperimentRunning) return;
            
            isExperimentRunning = true;
            const runButton = document.getElementById('run-experiment');
            const resetButton = document.getElementById('reset-experiment');
            
            runButton.disabled = true;
            resetButton.disabled = true;
            
            const mass = parseInt(document.getElementById('mass-slider').value);
            const displacement = calculateDisplacement(mass);
            
            if (currentTeacher) {
                currentTeacher.speak(`Running experiment with ${mass} grams. Watch the trolley move and hit the block!`);
            }
            
            // Animate the experiment
            await animateTrolleyExperiment(displacement);
            
            runButton.disabled = false;
            resetButton.disabled = false;
            isExperimentRunning = false;
        }

        // Automatic version for continuous demonstration
        async function runTrolleyExperimentAutomatic(mass, taskId) {
            if (isExperimentRunning) return;
            
            isExperimentRunning = true;
            
            // Calculate displacement based on mass
            const displacement = calculateDisplacement(mass);
            
            // Animate the experiment with proper timing
            await animateTrolleyExperiment(displacement, taskId);
            
            isExperimentRunning = false;
        }

        function calculateDisplacement(mass) {
            // Simplified calculation to make displacement directly proportional to mass
            // This ensures that more mass = more displacement in a clear linear relationship
            
            // Convert mass from grams to kg
            const hangingMass = mass / 1000;
            
            // Define the minimum and maximum displacement in pixels
            const minDisplacement = 20;  // For the minimum mass (50g)
            const maxDisplacement = 120; // For the maximum mass (200g)
            
            // Calculate the range of masses
            const minMass = 0.05;  // 50g in kg
            const maxMass = 0.2;   // 200g in kg
            
            // Calculate displacement using linear interpolation
            // Formula: displacement = minDisplacement + (mass - minMass) * (maxDisplacement - minDisplacement) / (maxMass - minMass)
            const displacementPixels = minDisplacement + 
                ((hangingMass - minMass) * (maxDisplacement - minDisplacement) / (maxMass - minMass));
            
            // Ensure the displacement is within bounds
            return Math.min(maxDisplacement, Math.max(minDisplacement, displacementPixels));
        }

        async function animateTrolleyExperiment(displacement, taskId) {
            const trolley = document.getElementById('trolley');
            const woodenBlock = document.getElementById('wooden-block');
            const forceArrow = document.getElementById('trolley-force');
            const displacementIndicator = document.getElementById('displacement-indicator');
            const displacementLabel = document.getElementById('displacement-label');
            const hangingMass = document.getElementById('hanging-mass');
            const energyContainer = document.getElementById('energy-transfer-container');
            const trolleyEnergyBar = document.getElementById('trolley-energy-bar');
            const blockEnergyBar = document.getElementById('block-energy-bar');
            
            // Get concept labels
            const pulleyLabel = document.querySelector('.pulley-label');
            const trolleyLabel = document.querySelector('.trolley-label');
            const blockLabel = document.querySelector('.block-label');
            
            // Get string elements
            const verticalString = document.querySelector('#vertical-string');
            const horizontalString = document.querySelector('#horizontal-string');
            
            // Reset positions and energy bars
            gsap.set(trolley, { left: '80px' });
            gsap.set(woodenBlock, { left: '350px' });
            gsap.set(displacementIndicator, { width: '0px' });
            gsap.set(hangingMass, { bottom: '110px' }); // Start at top position (110px)
            gsap.set(displacementLabel, { opacity: '0' });
            gsap.set(trolleyEnergyBar, { width: '0%' });
            gsap.set(blockEnergyBar, { width: '0%' });
            gsap.set('#vertical-string', { height: '50px' }); // Start with shorter string at top
            gsap.set('#horizontal-string', { width: '830px' }); // Set horizontal string length
            
            // Show force arrow and energy container
            forceArrow.classList.add('visible');
            energyContainer.classList.add('visible');
            
            // Show initial concept label (potential energy)
            if (pulleyLabel) pulleyLabel.classList.add('visible');
            
            // Phase 1: Hanging mass moves from top to bottom, trolley accelerates
            // Create a timeline for synchronized animations
            const timeline = gsap.timeline();
            
            // Animate mass and string simultaneously
            timeline.to(hangingMass, {
                duration: 1.5,
                bottom: '5px', // Move to bottom (5px instead of 0px)
                ease: "power2.in"
            });
            
            timeline.to('#vertical-string', {
                duration: 1.5,
                height: '155px', // Final string length reduced by 5px (from 160px to 155px)
                ease: "power2.in"
            }, 0); // Start at the same time as the mass animation
            
            // We'll update the horizontal string position dynamically in the onUpdate function
            
            // Move trolley simultaneously with mass falling
            timeline.to(trolley, {
                duration: 1.5,
                left: '150px', // Move trolley part way (adjusted to match new final position)
                ease: "power2.in"
            }, 0); // Start at the same time as the mass animation
            
            // Update energy bar and horizontal string during animation
            timeline.eventCallback("onUpdate", function() {
                const progress = timeline.progress();
                gsap.set(trolleyEnergyBar, { width: `${progress * 100}%` });
                
                // Update horizontal string width and position to connect to trolley
                const trolleyPosition = gsap.getProperty(trolley, "left");
                const newWidth = 830 - (trolleyPosition - 80); // 830px is initial width, 80px is initial trolley position
                gsap.set('#horizontal-string', { width: `${newWidth}px` });
            });
            
            // Wait for the timeline to complete
            await timeline.play();
            
            // Check if task is still active
            if (!shouldContinue(taskId)) return;
            
            // Show trolley kinetic energy label
            if (trolleyLabel) trolleyLabel.classList.add('visible');
            
            // Phase 2: Trolley moves toward block (already started moving with the mass)
            // Continue the movement to ensure it reaches the block
            await gsap.to(trolley, {
                duration: 1,
                left: '220px', // Stop with proper distance from the block (350px - 120px - 10px = 220px)
                ease: "power2.out",
                onUpdate: function() {
                    // Update horizontal string to stay connected to trolley
                    const trolleyPosition = gsap.getProperty(trolley, "left");
                    const newWidth = 830 - (trolleyPosition - 80); // 830px is initial width, 80px is initial trolley position
                    gsap.set('#horizontal-string', { width: `${newWidth}px` });
                }
            });
            
            // Check if task is still active
            if (!shouldContinue(taskId)) return;
            
            // Phase 3: Collision effect and block displacement
            // First, create a small "bump" effect for the trolley to simulate collision
            await gsap.to(trolley, {
                duration: 0.2,
                left: '230px', // Move slightly forward during collision
                ease: "power1.out",
                onUpdate: function() {
                    // Update horizontal string to stay connected to trolley
                    const trolleyPosition = gsap.getProperty(trolley, "left");
                    const newWidth = 830 - (trolleyPosition - 80);
                    gsap.set('#horizontal-string', { width: `${newWidth}px` });
                }
            });
            
            // Then move back slightly to show recoil
            gsap.to(trolley, {
                duration: 0.3,
                left: '220px',
                ease: "power2.out",
                onUpdate: function() {
                    // Update horizontal string to stay connected to trolley
                    const trolleyPosition = gsap.getProperty(trolley, "left");
                    const newWidth = 830 - (trolleyPosition - 80);
                    gsap.set('#horizontal-string', { width: `${newWidth}px` });
                }
            });
            
            // Simultaneously displace the block
            await gsap.to(woodenBlock, {
                duration: 0.8,
                left: `${350 + displacement}px`,
                ease: "power2.out",
                onUpdate: function() {
                    // Transfer energy from trolley to block during collision
                    const progress = this.progress();
                    gsap.set(trolleyEnergyBar, { width: `${(1 - progress) * 100}%` });
                    gsap.set(blockEnergyBar, { width: `${progress * 100}%` });
                    
                    // Show block work label once the collision starts
                    if (progress > 0.1 && blockLabel) {
                        blockLabel.classList.add('visible');
                        // Also update the block label position as it moves
                        gsap.set(blockLabel, { left: `${350 + (progress * displacement)}px` });
                    }
                }
            });
            
            // Show displacement indicator
            await gsap.to(displacementIndicator, {
                duration: 0.8,
                width: `${displacement}px`,
                ease: "power2.out"
            });
            
            // Update displacement label
            const displacementCm = (displacement * 0.5).toFixed(1); // Convert pixels to cm for display
            displacementLabel.textContent = `Displacement: ${displacementCm} cm`;
            gsap.to(displacementLabel, { duration: 0.5, opacity: '1' });
            
            // Hide force arrow after collision
            gsap.delayedCall(0.8, () => {
                forceArrow.classList.remove('visible');
            });
            
            // Wait for animation to complete
            await wait(1000);
            
            // After a delay, fade out the energy visualization
            gsap.delayedCall(3, () => {
                if (energyContainer.classList.contains('visible')) {
                    gsap.to(energyContainer, { 
                        duration: 0.5, 
                        opacity: 0,
                        onComplete: () => energyContainer.classList.remove('visible')
                    });
                }
            });
        }

        function resetTrolleyExperiment() {
            if (isExperimentRunning) return;
            
            // Reset all positions
            gsap.set('#trolley', { left: '80px' });
            gsap.set('#wooden-block', { left: '350px' });
            gsap.set('#displacement-indicator', { width: '0px' });
            gsap.set('#hanging-mass', { bottom: '110px' }); // Start at top position
            gsap.set('#vertical-string', { height: '50px' }); // Start with shorter string at top
            gsap.set('#horizontal-string', { width: '830px' }); // Reset horizontal string to full length
            
            // Hide indicators
            document.getElementById('trolley-force').classList.remove('visible');
            document.getElementById('displacement-label').style.opacity = '0';
            document.getElementById('displacement-label').textContent = 'Displacement: 0 cm';
            
            // Reset energy visualization
            const energyContainer = document.getElementById('energy-transfer-container');
            const trolleyEnergyBar = document.getElementById('trolley-energy-bar');
            const blockEnergyBar = document.getElementById('block-energy-bar');
            
            if (energyContainer) {
                energyContainer.classList.remove('visible');
                gsap.set(energyContainer, { opacity: 0 });
            }
            
            if (trolleyEnergyBar) gsap.set(trolleyEnergyBar, { width: '0%' });
            if (blockEnergyBar) gsap.set(blockEnergyBar, { width: '0%' });
            
            // Hide all concept labels
            document.querySelectorAll('.concept-label').forEach(label => {
                label.classList.remove('visible');
            });
            
            if (currentTeacher) {
                currentTeacher.speak("Experiment reset. Ready for another trial!");
            }
        }

        // Questions Demo
        async function showQuestions() {
            const taskId = 'questions';
            stopCurrentDemo();
            isPlaying = true;
            setActiveButton(7);
            
            const teacher = createNewTeacher(taskId);
            await showQuestionsInternal(teacher, taskId);
            
            isPlaying = false;
        }

        async function showQuestionsInternal(teacher, taskId = 'questions') {
            await resetAll();
            await wait(50);
            if (!shouldContinue(taskId)) return;
            
            updateTitle("‚ùì NCERT Questions and Examples");
            
            document.getElementById('questions-demo').classList.add('active');
            await wait(50);
            if (!shouldContinue(taskId)) return;
            
            await teacher.speak("Let's solve important NCERT questions and examples on Work and Energy. This slideshow contains step-by-step solutions with detailed explanations.");
            if (!shouldContinue(taskId)) return;
            
            // Initialize questions slideshow
            initializeQuestionsSlideshow();
            
            // Start narration for the first question
            startQuestionNarration(0, taskId);
            
            // Start auto-slideshow only if not in complete lesson mode
            if (taskId !== 'complete-lesson') {
                startQuestionsAutoSlideshow();
            }
            
            await wait(1000);
            if (!shouldContinue(taskId)) return;
            await teacher.speak("Use the arrows to navigate between questions, or let the slideshow auto-advance. Each question shows the complete solution process!");
        }

        // Questions slideshow state
        let currentQuestionIndex = 0;
        let questionsInterval = null;
        const totalQuestions = 3;
        const questionsDuration = 8000; // 8 seconds per question
        let currentQuestionNarration = null; // Track current question narration

        // Question-specific narration content
        const questionNarrations = [
            {
                id: 'question-1',
                title: "Question 1: Work Done by Force",
                content: [
                    "Question 1: A force of 7 Newtons acts on an object. The displacement is 8 meters in the direction of the force.",
                    "Given: Force equals 7 Newtons, displacement equals 8 meters, and they are in the same direction.",
                    "Formula: Work equals force times displacement times cosine of angle. Since they're in the same direction, cosine of 0 degrees equals 1.",
                    "Calculation: Work equals 7 Newtons times 8 meters, which equals 56 Joules.",
                    "The work done is 56 Joules."
                ]
            },
            {
                id: 'question-2',
                title: "Example 10.4: Work-Energy Theorem",
                content: [
                    "Example 10.4: What is the work to be done to increase the velocity of a car from 30 kilometers per hour to 60 kilometers per hour if the mass is 1500 kilograms?",
                    "Given: Mass equals 1500 kilograms, initial velocity equals 30 kilometers per hour, final velocity equals 60 kilometers per hour.",
                    "First, convert velocities to meters per second: 30 kilometers per hour equals 25 over 3 meters per second, and 60 kilometers per hour equals 50 over 3 meters per second.",
                    "Apply Work-Energy Theorem: Work equals change in kinetic energy equals final kinetic energy minus initial kinetic energy.",
                    "Initial kinetic energy equals half times 1500 times 25 over 3 squared, which equals 156,250 over 3 Joules.",
                    "Final kinetic energy equals half times 1500 times 50 over 3 squared, which equals 625,000 over 3 Joules.",
                    "Work equals 625,000 over 3 minus 156,250 over 3, which equals 468,750 over 3, which equals 156,250 Joules.",
                    "The work done is 156,250 Joules or 156.25 kilojoules."
                ]
            },
            {
                id: 'question-3',
                title: "Example 10.6: Potential Energy",
                content: [
                    "Example 10.6: An object of mass 12 kilograms is at a certain height above the ground. If the potential energy is 480 Joules, find the height.",
                    "Given: Mass equals 12 kilograms, potential energy equals 480 Joules, acceleration due to gravity equals 10 meters per second squared.",
                    "Formula: Potential energy equals mass times gravity times height.",
                    "Rearranging for height: height equals potential energy divided by mass times gravity.",
                    "Height equals 480 Joules divided by 12 kilograms times 10 meters per second squared.",
                    "Height equals 480 divided by 120, which equals 4 meters.",
                    "The object is at a height of 4 meters above the ground."
                ]
            }
        ];

        function initializeQuestionsSlideshow() {
            currentQuestionIndex = 0;
            updateQuestionsPosition();
            updateQuestionsIndicators();
        }

        // Stop current question narration
        function stopQuestionNarration() {
            // Stop current speech
            if (currentTeacher) {
                currentTeacher.stop();
            }
            
            currentQuestionNarration = null;
        }

        // Start narration for a specific question
        async function startQuestionNarration(questionIndex, taskId) {
            if (!currentTeacher || currentTaskId !== taskId) return;
            
            // Stop any existing narration
            stopQuestionNarration();
            
            const question = questionNarrations[questionIndex];
            if (!question) return;
            
            currentQuestionNarration = questionIndex;
            
            // Narrate each part sequentially with proper waiting
            for (let i = 0; i < question.content.length; i++) {
                if (!shouldContinue(taskId) || currentQuestionNarration !== questionIndex) {
                    return; // Stop if task changed or question changed
                }
                
                // Wait for previous narration to complete before starting next
                if (i > 0) {
                    await wait(1500); // 1.5 second pause between parts
                }
                
                if (!shouldContinue(taskId) || currentQuestionNarration !== questionIndex) {
                    return;
                }
                
                // Speak the current part
                await currentTeacher.speak(question.content[i]);
            }
            
            // Mark narration as complete
            currentQuestionNarration = null;
        }

        // Check if current question narration is complete
        function isQuestionNarrationComplete(questionIndex) {
            // If no narration is active or different question, consider it complete
            return currentQuestionNarration === null || currentQuestionNarration !== questionIndex;
        }

        // Wait for current question narration to complete
        async function waitForQuestionNarrationComplete(taskId, maxWaitTime = 60000) {
            const startTime = Date.now();
            const lastQuestionIndex = questionNarrations.length - 1;
            
            // First, ensure we're starting from the first question
            if (currentQuestionIndex !== 0) {
                // Reset to the first question
                currentQuestionIndex = 0;
                updateQuestionsPosition();
                updateQuestionsIndicators();
                // Start narration for the first question
                startQuestionNarration(0, taskId);
                await wait(1000); // Give time for transition
            }
            
            // Process each question sequentially
            for (let qIndex = 0; qIndex <= lastQuestionIndex; qIndex++) {
                console.log(`Playing question ${qIndex + 1} of ${lastQuestionIndex + 1}`);
                
                // Ensure we're on the correct question
                if (currentQuestionIndex !== qIndex) {
                    currentQuestionIndex = qIndex;
                    updateQuestionsPosition();
                    updateQuestionsIndicators();
                    startQuestionNarration(qIndex, taskId);
                    await wait(1000); // Give time for transition
                }
                
                // Wait for this question's narration to complete
                let questionComplete = false;
                while (!questionComplete) {
                    if (!shouldContinue(taskId)) return false;
                    
                    if (isQuestionNarrationComplete(qIndex)) {
                        questionComplete = true;
                    } else {
                        await wait(500); // Check every 500ms
                    }
                    
                    // Safety timeout per question
                    if (Date.now() - startTime > maxWaitTime) {
                        return false;
                    }
                }
                
                // Give a short pause between questions
                await wait(1500);
                
                // Move to next question if not the last one
                if (qIndex < lastQuestionIndex) {
                    currentQuestionIndex = qIndex + 1;
                    updateQuestionsPosition();
                    updateQuestionsIndicators();
                    startQuestionNarration(qIndex + 1, taskId);
                    await wait(1000); // Give time for transition
                }
            }
            
            return true; // All questions have been narrated
        }

        function updateQuestionsPosition() {
            const container = document.getElementById('questions-container');
            const translateX = -currentQuestionIndex * 33.33; // 33.33% per slide
            container.style.transform = `translateX(${translateX}%)`;
        }

        function updateQuestionsIndicators() {
            const indicators = document.querySelectorAll('.questions-indicator');
            indicators.forEach((indicator, index) => {
                indicator.classList.toggle('active', index === currentQuestionIndex);
            });
        }

        function nextQuestion() {
            // Only allow navigation if questions demo is active
            const questionsDemo = document.getElementById('questions-demo');
            if (!questionsDemo || !questionsDemo.classList.contains('active')) {
                return;
            }
            
            currentQuestionIndex = (currentQuestionIndex + 1) % totalQuestions;
            updateQuestionsPosition();
            updateQuestionsIndicators();
            
            // Start narration for the new question
            if (currentTeacher && currentTaskId) {
                startQuestionNarration(currentQuestionIndex, currentTaskId);
            }
            
            resetQuestionsAutoSlideshow();
        }

        function previousQuestion() {
            // Only allow navigation if questions demo is active
            const questionsDemo = document.getElementById('questions-demo');
            if (!questionsDemo || !questionsDemo.classList.contains('active')) {
                return;
            }
            
            currentQuestionIndex = (currentQuestionIndex - 1 + totalQuestions) % totalQuestions;
            updateQuestionsPosition();
            updateQuestionsIndicators();
            
            // Start narration for the new question
            if (currentTeacher && currentTaskId) {
                startQuestionNarration(currentQuestionIndex, currentTaskId);
            }
            
            resetQuestionsAutoSlideshow();
        }

        function goToQuestion(index) {
            // Only allow navigation if questions demo is active
            const questionsDemo = document.getElementById('questions-demo');
            if (!questionsDemo || !questionsDemo.classList.contains('active')) {
                return;
            }
            
            currentQuestionIndex = index;
            updateQuestionsPosition();
            updateQuestionsIndicators();
            
            // Start narration for the new question
            if (currentTeacher && currentTaskId) {
                startQuestionNarration(currentQuestionIndex, currentTaskId);
            }
            
            resetQuestionsAutoSlideshow();
        }

        function startQuestionsAutoSlideshow() {
            stopQuestionsAutoSlideshow();
            questionsInterval = setInterval(async () => {
                if (shouldContinue() && document.getElementById('questions-demo').classList.contains('active')) {
                    // Wait for current question narration to complete before moving to next
                    if (isQuestionNarrationComplete(currentQuestionIndex)) {
                        nextQuestion();
                    } else {
                        // If narration is still in progress, check again in 1 second
                        setTimeout(() => {
                            if (shouldContinue() && document.getElementById('questions-demo').classList.contains('active')) {
                                if (isQuestionNarrationComplete(currentQuestionIndex)) {
                                    nextQuestion();
                                }
                            }
                        }, 1000);
                    }
                } else {
                    stopQuestionsAutoSlideshow();
                }
            }, questionsDuration);
        }

        function stopQuestionsAutoSlideshow() {
            if (questionsInterval) {
                clearInterval(questionsInterval);
                questionsInterval = null;
            }
        }

        function resetQuestionsAutoSlideshow() {
            startQuestionsAutoSlideshow();
        }

        // Potential Energy Demo
        async function showPotentialEnergy() {
            const taskId = 'potential-energy';
            stopCurrentDemo();
            isPlaying = true;
            setActiveButton(4);
            
            const teacher = createNewTeacher(taskId);
            await showPotentialEnergyInternal(teacher, taskId);
            
            isPlaying = false;
        }

        async function showPotentialEnergyInternal(teacher, taskId = 'potential-energy') {
            await resetAll();
            await wait(50);
            if (!shouldContinue(taskId)) return;
            
            updateTitle("‚õ∞Ô∏è Potential Energy - Energy of Position");
            
            document.getElementById('potential-demo').classList.add('active');
            await wait(50);
            if (!shouldContinue(taskId)) return;
            
            await teacher.speak("Potential energy is the energy possessed by an object due to its position or height. Let's see how it increases with height.");
            if (!shouldContinue(taskId)) return;
            
            await wait(1000);
            
            await teacher.speak("Here we have three identical objects at different heights. Each has a mass of 10 kilograms.");
            if (!shouldContinue(taskId)) return;
            
            await wait(1500);
            
            await teacher.speak("The object at 2 meters height has 196 Joules of potential energy.");
            await wait(1500);
            if (!shouldContinue(taskId)) return;
            
            await teacher.speak("At 3 meters, it has 294 Joules - notice the linear increase with height.");
            await wait(1500);
            if (!shouldContinue(taskId)) return;
            
            await teacher.speak("At 4 meters, it has 392 Joules. The formula is PE equals m g h, where g is 9.8 meters per second squared.");
            await wait(2000);
            if (!shouldContinue(taskId)) return;
            
            await teacher.speak("The higher an object is placed, the more potential energy it possesses. This energy can be converted to kinetic energy when the object falls!");
        }

        // Conservation Demo
        async function showConservation() {
            const taskId = 'conservation';
            stopCurrentDemo();
            isPlaying = true;
            setActiveButton(5);
            
            const teacher = createNewTeacher(taskId);
            await showConservationInternal(teacher, taskId);
            
            isPlaying = false;
        }

        async function showConservationInternal(teacher, taskId = 'conservation') {
            await resetAll();
            await wait(50);
            if (!shouldContinue(taskId)) return;
            
            updateTitle("üîÑ Law of Conservation of Energy");
            
            document.getElementById('conservation-demo').classList.add('active');
            await wait(50);
            if (!shouldContinue(taskId)) return;
            
            await teacher.speak("The Law of Conservation of Energy states that energy cannot be created or destroyed, only converted from one form to another. Watch this pendulum demonstrate this principle.");
            if (!shouldContinue(taskId)) return;
            
            // Animate pendulum swing with energy bars
            trackAnimation(gsap.to('#pendulum-string', {
                duration: 2,
                rotation: 45,
                ease: "power2.inOut",
                repeat: -1,
                yoyo: true,
                onUpdate: function() {
                    const angle = Math.abs(gsap.getProperty('#pendulum-string', 'rotation'));
                    const maxAngle = 45;
                    
                    // Calculate energy percentages
                    const potentialPercent = (angle / maxAngle) * 100;
                    const kineticPercent = 100 - potentialPercent;
                    
                    // Update energy bars
                    document.getElementById('kinetic-bar').style.width = kineticPercent + '%';
                    document.getElementById('potential-bar').style.width = potentialPercent + '%';
                    document.getElementById('total-bar').style.width = '100%'; // Always constant
                }
            }));
            
            await wait(2000);
            if (!shouldContinue(taskId)) return;
            
            await teacher.speak("At the highest points, the pendulum has maximum potential energy and zero kinetic energy.");
            await wait(3000);
            if (!shouldContinue(taskId)) return;
            
            await teacher.speak("At the bottom, it has maximum kinetic energy and minimum potential energy.");
            await wait(3000);
            if (!shouldContinue(taskId)) return;
            
            await teacher.speak("Notice how the total energy bar stays constant? The sum of kinetic and potential energy never changes - energy is conserved!");
        }

        // Formulas Demo
        async function showFormulas() {
            const taskId = 'formulas';
            stopCurrentDemo();
            isPlaying = true;
            setActiveButton(6);
            
            const teacher = createNewTeacher(taskId);
            await showFormulasInternal(teacher, taskId);
            
            isPlaying = false;
        }

        // Slideshow state
        let currentSlideIndex = 0;
        let slideInterval = null;
        const totalSlides = 4;
        const slideDuration = 4000; // 4 seconds per slide
        let currentFormulaNarration = null; // Track current formula narration

        // Formula-specific narration content
        const formulaNarrations = [
            {
                id: 'formula-1',
                title: "Kinetic Energy Formula",
                content: [
                    "Kinetic Energy Formula: KE equals half mass times velocity squared.",
                    "This formula shows that kinetic energy depends on both the mass of the object and its velocity.",
                    "Notice that velocity is squared, which means doubling the speed increases kinetic energy by four times!",
                    "This is why high-speed collisions can be so destructive."
                ]
            },
            {
                id: 'formula-2',
                title: "Potential Energy Formula",
                content: [
                    "Potential Energy Formula: PE equals mass times gravity times height.",
                    "This energy depends on the object's position or height above a reference level.",
                    "The higher an object is lifted, the more potential energy it gains.",
                    "When the object falls, this potential energy converts to kinetic energy."
                ]
            },
            {
                id: 'formula-3',
                title: "Conservation of Energy",
                content: [
                    "Conservation of Energy: The sum of kinetic and potential energy remains constant.",
                    "In an isolated system without friction, total mechanical energy is conserved.",
                    "As one form of energy decreases, the other increases by the same amount.",
                    "This principle is fundamental to understanding energy transformations in physics."
                ]
            },
            {
                id: 'formula-4',
                title: "Work-Energy Theorem",
                content: [
                    "Work-Energy Theorem: Work done on an object equals its change in kinetic energy.",
                    "This fundamental relationship connects the concepts of work and energy.",
                    "When work is done on an object, it either gains or loses kinetic energy.",
                    "This theorem is essential for solving many physics problems involving motion and energy."
                ]
            }
        ];

        async function showFormulasInternal(teacher, taskId = 'formulas') {
            await resetAll();
            await wait(50);
            if (!shouldContinue(taskId)) return;
            
            updateTitle("üìê Key Energy Formulas");
            
            document.getElementById('formula-demo').classList.add('active');
            await wait(50);
            if (!shouldContinue(taskId)) return;
            
            await teacher.speak("Let's review the key formulas for calculating different forms of energy. The slideshow will automatically progress, or you can use the arrows to navigate manually.");
            if (!shouldContinue(taskId)) return;
            
            // Initialize slideshow
            initializeSlideshow();
            
            // Start narration for the first formula
            startFormulaNarration(0, taskId);
            
            // Start auto-slideshow only if not in complete lesson mode
            if (taskId !== 'complete-lesson') {
                startAutoSlideshow();
            }
            
            await wait(1000);
            if (!shouldContinue(taskId)) return;
            await teacher.speak("These formulas are the foundation for understanding energy calculations in physics!");
        }

        // Stop current formula narration
        function stopFormulaNarration() {
            // Stop current speech
            if (currentTeacher) {
                currentTeacher.stop();
            }
            
            currentFormulaNarration = null;
        }

        // Start narration for a specific formula
        async function startFormulaNarration(formulaIndex, taskId) {
            if (!currentTeacher || currentTaskId !== taskId) return;
            
            // Stop any existing narration
            stopFormulaNarration();
            
            const formula = formulaNarrations[formulaIndex];
            if (!formula) return;
            
            currentFormulaNarration = formulaIndex;
            
            // Narrate each part sequentially with proper waiting
            for (let i = 0; i < formula.content.length; i++) {
                if (!shouldContinue(taskId) || currentFormulaNarration !== formulaIndex) {
                    return; // Stop if task changed or formula changed
                }
                
                // Wait for previous narration to complete before starting next
                if (i > 0) {
                    await wait(1500); // 1.5 second pause between parts
                }
                
                if (!shouldContinue(taskId) || currentFormulaNarration !== formulaIndex) {
                    return;
                }
                
                // Speak the current part
                await currentTeacher.speak(formula.content[i]);
            }
            
            // Mark narration as complete
            currentFormulaNarration = null;
        }

        // Check if current formula narration is complete
        function isFormulaNarrationComplete(formulaIndex) {
            // If no narration is active or different formula, consider it complete
            return currentFormulaNarration === null || currentFormulaNarration !== formulaIndex;
        }

        // Wait for current formula narration to complete
        async function waitForFormulaNarrationComplete(taskId, maxWaitTime = 60000) {
            const startTime = Date.now();
            const lastFormulaIndex = formulaNarrations.length - 1;
            
            // First, ensure we're starting from the first formula
            if (currentSlideIndex !== 0) {
                // Reset to the first formula
                currentSlideIndex = 0;
                updateSlidePosition();
                updateIndicators();
                // Start narration for the first formula
                startFormulaNarration(0, taskId);
                await wait(1000); // Give time for transition
            }
            
            // Process each formula sequentially
            for (let fIndex = 0; fIndex <= lastFormulaIndex; fIndex++) {
                console.log(`Playing formula ${fIndex + 1} of ${lastFormulaIndex + 1}`);
                
                // Ensure we're on the correct formula
                if (currentSlideIndex !== fIndex) {
                    currentSlideIndex = fIndex;
                    updateSlidePosition();
                    updateIndicators();
                    startFormulaNarration(fIndex, taskId);
                    await wait(1000); // Give time for transition
                }
                
                // Wait for this formula's narration to complete
                let formulaComplete = false;
                while (!formulaComplete) {
                    if (!shouldContinue(taskId)) return false;
                    
                    if (isFormulaNarrationComplete(fIndex)) {
                        formulaComplete = true;
                    } else {
                        await wait(500); // Check every 500ms
                    }
                    
                    // Safety timeout per formula
                    if (Date.now() - startTime > maxWaitTime) {
                        return false;
                    }
                }
                
                // Give a short pause between formulas
                await wait(1500);
                
                // Move to next formula if not the last one
                if (fIndex < lastFormulaIndex) {
                    currentSlideIndex = fIndex + 1;
                    updateSlidePosition();
                    updateIndicators();
                    startFormulaNarration(fIndex + 1, taskId);
                    await wait(1000); // Give time for transition
                }
            }
            
            return true; // All formulas have been narrated
        }

        function initializeSlideshow() {
            currentSlideIndex = 0;
            updateSlidePosition();
            updateIndicators();
        }

        function updateSlidePosition() {
            const container = document.getElementById('formula-container');
            const translateX = -currentSlideIndex * 25; // 25% per slide
            container.style.transform = `translateX(${translateX}%)`;
        }

        function updateIndicators() {
            const indicators = document.querySelectorAll('.formula-indicator');
            indicators.forEach((indicator, index) => {
                indicator.classList.toggle('active', index === currentSlideIndex);
            });
        }

        function nextSlide() {
            // Only allow navigation if formula demo is active
            const formulaDemo = document.getElementById('formula-demo');
            if (!formulaDemo || !formulaDemo.classList.contains('active')) {
                return;
            }
            
            currentSlideIndex = (currentSlideIndex + 1) % totalSlides;
            updateSlidePosition();
            updateIndicators();
            
            // Start narration for the new formula
            startFormulaNarration(currentSlideIndex, currentTaskId);
            
            resetAutoSlideshow();
        }

        function previousSlide() {
            // Only allow navigation if formula demo is active
            const formulaDemo = document.getElementById('formula-demo');
            if (!formulaDemo || !formulaDemo.classList.contains('active')) {
                return;
            }
            
            currentSlideIndex = (currentSlideIndex - 1 + totalSlides) % totalSlides;
            updateSlidePosition();
            updateIndicators();
            
            // Start narration for the new formula
            startFormulaNarration(currentSlideIndex, currentTaskId);
            
            resetAutoSlideshow();
        }

        function goToSlide(index) {
            // Only allow navigation if formula demo is active
            const formulaDemo = document.getElementById('formula-demo');
            if (!formulaDemo || !formulaDemo.classList.contains('active')) {
                return;
            }
            
            currentSlideIndex = index;
            updateSlidePosition();
            updateIndicators();
            
            // Start narration for the new formula
            startFormulaNarration(currentSlideIndex, currentTaskId);
            
            resetAutoSlideshow();
        }

        function startAutoSlideshow() {
            stopAutoSlideshow();
            slideInterval = setInterval(async () => {
                if (shouldContinue() && document.getElementById('formula-demo').classList.contains('active')) {
                    // Wait for current formula narration to complete before moving to next
                    if (isFormulaNarrationComplete(currentSlideIndex)) {
                        nextSlide();
                    } else {
                        // If narration is still in progress, check again in 1 second
                        setTimeout(() => {
                            if (shouldContinue() && document.getElementById('formula-demo').classList.contains('active')) {
                                if (isFormulaNarrationComplete(currentSlideIndex)) {
                                    nextSlide();
                                }
                            }
                        }, 1000);
                    }
                } else {
                    stopAutoSlideshow();
                }
            }, slideDuration);
        }

        function stopAutoSlideshow() {
            if (slideInterval) {
                clearInterval(slideInterval);
                slideInterval = null;
            }
        }

        function resetAutoSlideshow() {
            startAutoSlideshow();
        }

        // Calculator Demo
        async function showCalculator() {
            const taskId = 'calculator';
            stopCurrentDemo();
            isPlaying = true;
            setActiveButton(8);
            
            const teacher = createNewTeacher(taskId);
            await showCalculatorInternal(teacher, taskId);
            
            isPlaying = false;
        }

        async function showCalculatorInternal(teacher, taskId = 'calculator') {
            await resetAll();
            await wait(50);
            if (!shouldContinue(taskId)) return;
            
            updateTitle("üßÆ Interactive Energy Calculator");
            
            document.getElementById('calculator-demo').classList.add('active');
            await wait(50);
            if (!shouldContinue(taskId)) return;
            
            await teacher.speak("Now you can practice calculating kinetic and potential energy using these interactive calculators. Try entering different values to see how energy changes!");
            if (!shouldContinue(taskId)) return;
            
            await wait(2000);
            
            await teacher.speak("Remember: kinetic energy depends on both mass and velocity squared, while potential energy depends on mass, gravity, and height.");
        }

        // Calculator Functions
        function calculateKineticEnergy() {
            const mass = parseFloat(document.getElementById('ke-mass').value);
            const velocity = parseFloat(document.getElementById('ke-velocity').value);
            const resultDiv = document.getElementById('ke-result');
            
            if (isNaN(mass) || isNaN(velocity) || mass <= 0 || velocity < 0) {
                resultDiv.textContent = '‚ö†Ô∏è Please enter valid positive values';
                return;
            }
            
            const ke = 0.5 * mass * velocity * velocity;
            resultDiv.innerHTML = `
                KE = ¬Ω √ó ${mass} √ó ${velocity}¬≤ = ${ke.toFixed(2)} J
            `;
            
            if (currentTeacher) {
                currentTeacher.speak(`The kinetic energy is ${ke.toFixed(1)} Joules.`);
            }
        }

        function calculatePotentialEnergy() {
            const mass = parseFloat(document.getElementById('pe-mass').value);
            const height = parseFloat(document.getElementById('pe-height').value);
            const g = 9.8; // acceleration due to gravity
            const resultDiv = document.getElementById('pe-result');
            
            if (isNaN(mass) || isNaN(height) || mass <= 0 || height < 0) {
                resultDiv.textContent = '‚ö†Ô∏è Please enter valid positive values';
                return;
            }
            
            const pe = mass * g * height;
            resultDiv.innerHTML = `
                PE = ${mass} √ó 9.8 √ó ${height} = ${pe.toFixed(2)} J
            `;
            
            if (currentTeacher) {
                currentTeacher.speak(`The potential energy is ${pe.toFixed(1)} Joules.`);
            }
        }

        // Helper Functions
        async function resetAll() {
            if (animationTimeline) {
                animationTimeline.kill();
                animationTimeline = null;
            }
            gsap.killTweensOf("*");
            
            activeAnimations.forEach(anim => {
                if (anim) anim.kill();
            });
            activeAnimations = [];
            
            if (currentTeacher) {
                currentTeacher.stop();
            }
            
            // Stop slideshows
            stopAutoSlideshow();
            stopQuestionsAutoSlideshow();
            stopQuestionNarration();
            stopFormulaNarration();
            
            // Hide all demos
            document.querySelectorAll('.energy-sources-demo, .kinetic-demo, .trolley-demo, .questions-demo, .potential-demo, .conservation-demo, .formula-demo, .calculator-demo').forEach(demo => {
                demo.classList.remove('active');
            });
            
            updateTitle("Explore Work and Energy");
            
            // Reset energy sources
            document.querySelectorAll('.energy-source').forEach(source => {
                source.classList.remove('visible');
            });
            
            // Reset moving objects
            gsap.set('#slow-object, #fast-object', { x: 0 });
            document.getElementById('slow-energy').textContent = 'KE = 0 J';
            document.getElementById('fast-energy').textContent = 'KE = 0 J';
            
            // Reset pendulum
            gsap.set('#pendulum-string', { rotation: 0 });
            document.getElementById('kinetic-bar').style.width = '0%';
            document.getElementById('potential-bar').style.width = '100%';
            document.getElementById('total-bar').style.width = '100%';
            
            // Reset formula cards and slideshow
            document.querySelectorAll('.formula-card').forEach(card => {
                card.classList.remove('show');
            });
            
            // Reset slideshow position
            currentSlideIndex = 0;
            const container = document.getElementById('formula-container');
            if (container) {
                container.style.transform = 'translateX(0%)';
            }
            
            // Reset indicators
            document.querySelectorAll('.formula-indicator').forEach((indicator, index) => {
                indicator.classList.toggle('active', index === 0);
            });
            
            // Reset questions slideshow position
            currentQuestionIndex = 0;
            const questionsContainer = document.getElementById('questions-container');
            if (questionsContainer) {
                questionsContainer.style.transform = 'translateX(0%)';
            }
            
            // Reset questions indicators
            document.querySelectorAll('.questions-indicator').forEach((indicator, index) => {
                indicator.classList.toggle('active', index === 0);
            });
            
            // Reset trolley experiment
            gsap.set('#trolley', { left: '80px' });
            gsap.set('#wooden-block', { left: '350px' });
            gsap.set('#displacement-indicator', { width: '0px' });
            gsap.set('#hanging-mass', { bottom: '110px' });
            const trolleyForce = document.getElementById('trolley-force');
            const displacementLabel = document.getElementById('displacement-label');
            if (trolleyForce) trolleyForce.classList.remove('visible');
            if (displacementLabel) {
                displacementLabel.style.opacity = '0';
                displacementLabel.textContent = 'Displacement: 0 cm';
            }
            
            // Reset calculator
            document.getElementById('ke-mass').value = '';
            document.getElementById('ke-velocity').value = '';
            document.getElementById('pe-mass').value = '';
            document.getElementById('pe-height').value = '';
            document.getElementById('ke-result').textContent = 'Enter values to calculate kinetic energy';
            document.getElementById('pe-result').textContent = 'Enter values to calculate potential energy';
            
            await wait(300);
        }



        function updateTitle(title) {
            document.getElementById('demo-title').textContent = title;
        }

        // Highlights a section button visually without changing the active state
        // Used during complete lesson playback to indicate current section
        function highlightSectionButton(index) {
            // This function only provides visual feedback but doesn't change active state
            // Implementation could include a subtle visual indicator or temporary highlight
            // For now, we'll just keep the complete lesson button active
        }
        
        function setActiveButton(index) {
            document.querySelectorAll('.demo-btn').forEach((btn, i) => {
                btn.classList.toggle('active', i === index);
            });
        }

        function wait(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        // Reset Button Handler
        async function resetAllClick() {
            stopCurrentDemo();
            isPlaying = false;
            await resetAll();
        }

        // Audio Control
        document.getElementById('mute-btn').addEventListener('click', () => {
            globalAudioEnabled = !globalAudioEnabled;
            document.getElementById('mute-btn').classList.toggle('muted', !globalAudioEnabled);
            
            if (!globalAudioEnabled && currentTeacher) {
                currentTeacher.stop();
            }
        });

        // Keyboard support for calculators
        document.getElementById('ke-velocity').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                calculateKineticEnergy();
            }
        });

        document.getElementById('pe-height').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                calculatePotentialEnergy();
            }
        });
    </script>
</body>
</html>
