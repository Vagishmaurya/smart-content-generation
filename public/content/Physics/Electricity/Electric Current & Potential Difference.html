<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chapter 11: Electric Current and Potential Difference</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --electric-gradient: linear-gradient(135deg, #ffd89b 0%, #19547b 100%);
            --current-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --glass-bg: rgba(255, 255, 255, 0.15);
            --glass-border: rgba(255, 255, 255, 0.3);
            --text-primary: #ffffff;
            --text-secondary: #e2e8f0;
            --shadow-primary: 0 25px 50px rgba(0, 0, 0, 0.4);
            --transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #0f2027 0%, #203a43 50%, #2c5364 100%);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: 
                radial-gradient(circle at 20% 50%, rgba(102, 126, 234, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(118, 75, 162, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 20%, rgba(255, 216, 155, 0.1) 0%, transparent 50%);
            pointer-events: none;
            z-index: 1;
        }

        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #0f2027 0%, #203a43 50%, #2c5364 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 0.8s ease;
        }

        .loading-overlay.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .loading-content {
            text-align: center;
        }

        .loading-particles {
            width: 200px;
            height: 200px;
            position: relative;
            margin: 0 auto 30px;
        }

        .particle {
            position: absolute;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            animation: scatter 3s ease-in-out infinite;
            box-shadow: 0 0 15px currentColor;
        }

        .particle:nth-child(1) { background: #ffd89b; left: 100px; top: 100px; animation-delay: 0s; }
        .particle:nth-child(2) { background: #19547b; left: 100px; top: 100px; animation-delay: 0.3s; }
        .particle:nth-child(3) { background: #f093fb; left: 100px; top: 100px; animation-delay: 0.6s; }
        .particle:nth-child(4) { background: #667eea; left: 100px; top: 100px; animation-delay: 0.9s; }
        .particle:nth-child(5) { background: #764ba2; left: 100px; top: 100px; animation-delay: 1.2s; }

        @keyframes scatter {
            0% {
                transform: translate(0, 0) scale(1);
                opacity: 1;
            }
            50% {
                transform: translate(calc(var(--x) * 50px), calc(var(--y) * 50px)) scale(1.5);
                opacity: 0.7;
            }
            100% {
                transform: translate(calc(var(--x) * 100px), calc(var(--y) * 100px)) scale(0.5);
                opacity: 0;
            }
        }

        .particle:nth-child(1) { --x: 1; --y: -1; }
        .particle:nth-child(2) { --x: -1; --y: -1; }
        .particle:nth-child(3) { --x: -1; --y: 1; }
        .particle:nth-child(4) { --x: 1; --y: 1; }
        .particle:nth-child(5) { --x: 0; --y: -1.5; }

        .loading-text {
            color: var(--text-primary);
            font-size: 1.4rem;
            font-weight: 600;
            background: var(--electric-gradient);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: shimmer 2s linear infinite;
            background-size: 200% auto;
        }

        @keyframes shimmer {
            0% { background-position: 0% 50%; }
            100% { background-position: 200% 50%; }
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 40px 20px;
            position: relative;
            z-index: 2;
        }

        .header {
            text-align: center;
            padding: 60px;
            background: var(--glass-bg);
            border-radius: 30px;
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            margin-bottom: 40px;
            border: 2px solid var(--glass-border);
            box-shadow: var(--shadow-primary);
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: var(--electric-gradient);
            opacity: 0.3;
            z-index: -1;
            border-radius: 30px;
            animation: electricPulse 5s ease-in-out infinite;
        }

        @keyframes electricPulse {
            0%, 100% { opacity: 0.3; transform: scale(1); }
            50% { opacity: 0.5; transform: scale(1.02); }
        }

        .header h1 {
            font-size: 3.5rem;
            background: var(--electric-gradient);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 20px;
            font-weight: 800;
            animation: titleFloat 3s ease-in-out infinite;
            text-shadow: 0 0 30px rgba(255, 216, 155, 0.3);
        }

        @keyframes titleFloat {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        .main-display {
            background: var(--glass-bg);
            backdrop-filter: blur(25px);
            -webkit-backdrop-filter: blur(25px);
            border-radius: 30px;
            padding: 40px;
            margin-bottom: 40px;
            border: 2px solid var(--glass-border);
            box-shadow: var(--shadow-primary);
        }

        .demo-container {
            height: 500px;
            overflow: hidden;
            border-radius: 20px;
            margin-bottom: 20px;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.4);
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 100%);
        }

        .demo-stage {
            position: relative;
            width: 100%;
            height: 100%;
            border-radius: 20px;
            overflow: hidden;
        }

        .demo-stage canvas {
            width: 100%;
            height: 100%;
        }

        #chartContainer {
            width: 100%;
            height: 450px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            display: none;
        }

        #audio-toggle {
            position: fixed;
            top: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: var(--electric-gradient);
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            z-index: 1000;
            box-shadow: var(--shadow-primary);
            transition: var(--transition);
        }

        #audio-toggle:hover {
            transform: scale(1.1) rotate(10deg);
        }

        .control-panel {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 40px 0;
            flex-wrap: wrap;
        }

        .control-btn {
            background: var(--primary-gradient);
            border: none;
            color: white;
            padding: 15px 30px;
            border-radius: 50px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            min-width: 180px;
            position: relative;
            overflow: hidden;
            text-shadow: 0 1px 3px rgba(0,0,0,0.3);
        }

        .control-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
            transition: left 0.6s ease;
        }

        .control-btn:hover::before {
            left: 100%;
        }

        .control-btn:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
        }

        .control-btn.active {
            background: var(--electric-gradient);
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(255, 216, 155, 0.4);
        }

        .reset-btn {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            margin-top: 20px;
        }

        .info-panel {
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.4), rgba(0, 0, 0, 0.2));
            padding: 30px;
            border-radius: 20px;
            margin: 20px 0;
            border-left: 5px solid #ffd89b;
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .info-title {
            color: #ffd89b;
            font-size: 1.8rem;
            margin-bottom: 20px;
            font-weight: 700;
            text-shadow: 0 2px 10px rgba(255, 216, 155, 0.3);
        }

        .formula-display {
            text-align: center;
            font-size: 2rem;
            margin: 30px 0;
            padding: 25px;
            background: linear-gradient(135deg, rgba(255, 216, 155, 0.1), rgba(25, 84, 123, 0.1));
            border-radius: 15px;
            font-family: 'Georgia', serif;
            color: #ffd89b;
            box-shadow: inset 0 2px 10px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 216, 155, 0.2);
        }

        .example-box {
            background: linear-gradient(135deg, rgba(0, 150, 100, 0.15), rgba(0, 100, 0, 0.1));
            border-left: 5px solid #4ecdc4;
            padding: 25px;
            margin: 20px 0;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
        }

        .example-box h4 {
            color: #4ecdc4;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        .question-box {
            background: linear-gradient(135deg, rgba(240, 147, 251, 0.15), rgba(100, 0, 100, 0.1));
            border-left: 5px solid #f093fb;
            padding: 25px;
            margin: 20px 0;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
        }

        .question-box h4 {
            color: #f093fb;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        .lesson-section {
            padding: 40px;
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.3), rgba(0, 0, 0, 0.1));
            border-radius: 20px;
            margin: 20px 0;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .lesson-title {
            color: #ffd89b;
            font-size: 2.2rem;
            margin-bottom: 25px;
            text-align: center;
            text-shadow: 0 3px 15px rgba(255, 216, 155, 0.3);
        }

        .lesson-text {
            font-size: 1.15rem;
            line-height: 1.9;
            color: #e2e8f0;
        }

        .data-table {
            width: 100%;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            overflow: hidden;
            margin: 30px 0;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        .data-table th {
            background: var(--electric-gradient);
            padding: 18px;
            text-align: left;
            font-weight: 600;
            text-shadow: 0 1px 3px rgba(0,0,0,0.3);
        }

        .data-table td {
            padding: 15px 18px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            transition: background 0.3s;
        }

        .data-table tr:hover td {
            background: rgba(255, 255, 255, 0.05);
        }

        .solution-step {
            margin: 15px 0;
            padding-left: 25px;
            color: #e2e8f0;
            font-size: 1.1rem;
            position: relative;
        }

        .solution-step::before {
            content: '▸';
            position: absolute;
            left: 5px;
            color: #4ecdc4;
        }

        @keyframes fadeInUp {
            0% {
                opacity: 0;
                transform: translateY(20px);
            }
            100% {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes glow {
            0%, 100% { box-shadow: 0 0 20px rgba(255, 216, 155, 0.5); }
            50% { box-shadow: 0 0 40px rgba(255, 216, 155, 0.8); }
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }
            
            .control-panel {
                flex-direction: column;
                align-items: center;
            }
            
            .control-btn {
                width: 100%;
                max-width: 300px;
            }
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-content">
            <div class="loading-particles">
                <div class="particle"></div>
                <div class="particle"></div>
                <div class="particle"></div>
                <div class="particle"></div>
                <div class="particle"></div>
            </div>
            <div class="loading-text">Preparing Electricity Lab...</div>
        </div>
    </div>

    <!-- Audio Control -->
    <button id="audio-toggle" title="Toggle Audio Narration">🔊</button>

    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>⚡ Electric Current & Potential Difference</h1>
            <p>Chapter 11.1 & 11.2 - Understanding the fundamentals of electricity</p>
        </div>

        <!-- Main Display Area -->
        <div class="main-display">
            <!-- Demo Container -->
            <div class="demo-container">
                <div class="demo-stage">
                    <canvas id="demoCanvas" width="1200" height="500"></canvas>
                    <div id="chartContainer">
                        <canvas id="dataChart"></canvas>
                    </div>
                    <div id="lessonContent" style="display: none; padding: 20px; color: white;"></div>
                </div>
            </div>

            <!-- Information Panels -->
            <div class="info-panel" id="currentPanel" style="display: none;">
                <div class="info-title">⚡ 11.1 Electric Current and Circuit</div>
                <p>We are familiar with air current and water current. Similarly, if electric charge flows through a conductor (like a metallic wire), we say there is an electric current in the conductor.</p>
                
                <div class="formula-display">
                    I = Q/t
                </div>
                
                <p>Where:</p>
                <ul style="margin-left: 20px; line-height: 2;">
                    <li><strong>I</strong> = Current (Amperes, A)</li>
                    <li><strong>Q</strong> = Charge (Coulombs, C)</li>
                    <li><strong>t</strong> = Time (Seconds, s)</li>
                </ul>
                
                <p style="margin-top: 20px;"><strong>Key Facts:</strong></p>
                <ul style="margin-left: 20px; line-height: 2;">
                    <li>1 Coulomb = charge of 6 × 10¹⁸ electrons</li>
                    <li>1 Ampere = 1 Coulomb/second</li>
                    <li>Electron charge = -1.6 × 10⁻¹⁹ C</li>
                    <li>Conventional current direction is opposite to electron flow</li>
                </ul>
            </div>

            <div class="info-panel" id="potentialPanel" style="display: none;">
                <div class="info-title">🔋 11.2 Electric Potential and Potential Difference</div>
                <p>Charges don't flow in a copper wire by themselves, just as water in a horizontal tube doesn't flow. We need a potential difference to make charges move.</p>
                
                <div class="formula-display">
                    V = W/Q
                </div>
                
                <p>Where:</p>
                <ul style="margin-left: 20px; line-height: 2;">
                    <li><strong>V</strong> = Potential Difference (Volts, V)</li>
                    <li><strong>W</strong> = Work Done (Joules, J)</li>
                    <li><strong>Q</strong> = Charge (Coulombs, C)</li>
                </ul>
                
                <p style="margin-top: 20px;"><strong>Key Facts:</strong></p>
                <ul style="margin-left: 20px; line-height: 2;">
                    <li>1 Volt = 1 Joule/Coulomb</li>
                    <li>Named after Alessandro Volta (1745-1827)</li>
                    <li>Voltmeter measures potential difference</li>
                    <li>Battery creates potential difference through chemical action</li>
                </ul>
            </div>

            <!-- Example Problems -->
            <div class="example-box" id="example1" style="display: none;">
                <h4>Example 11.1 - Solving with Animation</h4>
                <p><strong>Problem:</strong> A current of 0.5 A is drawn by a filament of an electric bulb for 10 minutes. Find the amount of electric charge that flows through the circuit.</p>
                
                <p style="margin-top: 15px;"><strong>Solution:</strong></p>
                <div class="solution-step">Given: I = 0.5 A, t = 10 min = 600 s</div>
                <div class="solution-step">Formula: Q = I × t</div>
                <div class="solution-step">Q = 0.5 A × 600 s</div>
                <div class="solution-step"><strong>Answer: Q = 300 C</strong></div>
                
                <p style="margin-top: 20px; padding: 15px; background: rgba(255,255,255,0.05); border-radius: 10px;">
                    💡 Watch the animation above to see how 300 coulombs of charge flows through the bulb filament over 10 minutes!
                </p>
            </div>

            <!-- Practice Questions -->
            <div class="question-box" id="questions" style="display: none;">
                <h4>Practice Questions</h4>
                <ol style="line-height: 2;">
                    <li>What does an electric circuit mean?</li>
                    <li>Define the unit of current.</li>
                    <li>Calculate the number of electrons constituting one coulomb of charge.</li>
                </ol>
                
                <div style="margin-top: 20px; padding: 15px; background: rgba(255,255,255,0.05); border-radius: 10px;">
                    <p><strong>Answers:</strong></p>
                    <p>1. A continuous and closed path of electric current</p>
                    <p>2. One ampere = flow of one coulomb of charge per second</p>
                    <p>3. Number of electrons = 1/(1.6 × 10⁻¹⁹) = 6.25 × 10¹⁸ electrons</p>
                </div>
            </div>

            <table class="data-table">
                <thead>
                    <tr>
                        <th>Quantity</th>
                        <th>Symbol</th>
                        <th>Unit</th>
                        <th>Formula</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Electric Current</td>
                        <td>I</td>
                        <td>Ampere (A)</td>
                        <td>I = Q/t</td>
                    </tr>
                    <tr>
                        <td>Electric Charge</td>
                        <td>Q</td>
                        <td>Coulomb (C)</td>
                        <td>Q = I × t</td>
                    </tr>
                    <tr>
                        <td>Potential Difference</td>
                        <td>V</td>
                        <td>Volt (V)</td>
                        <td>V = W/Q</td>
                    </tr>
                    <tr>
                        <td>Work Done</td>
                        <td>W</td>
                        <td>Joule (J)</td>
                        <td>W = V × Q</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Control Panel -->
        <div class="control-panel">
            <button class="control-btn active" data-mode="lesson">📚 Complete Lesson</button>
            <button class="control-btn" data-mode="current">⚡ Electric Current</button>
            <button class="control-btn" data-mode="circuit">🔌 Circuit Animation</button>
            <button class="control-btn" data-mode="potential">🔋 Potential Difference</button>
            <button class="control-btn" data-mode="wateranalogy">💧 Water Analogy</button>
            <button class="control-btn" data-mode="datachart">📊 Data Visualization</button>
            <button class="control-btn" data-mode="solving">✏️ Problem Solving</button>
        </div>
        
        <!-- Reset Button -->
        <div style="text-align: center;">
            <button class="control-btn reset-btn" id="resetBtn">🔄 Reset Everything</button>
        </div>
    </div>

    <script>
        // Global Variables
        let currentMode = 'lesson';
        let animationFrame = null;
        let time = 0;
        let lessonSequence = null;
        let lessonStarted = false;
        let audioEnabled = true;
        let chartInstance = null;

        // Canvas and Context
        const canvas = document.getElementById('demoCanvas');
        const ctx = canvas.getContext('2d');

        // Audio Narrator Class
        class AudioNarrator {
            constructor() {
                this.synth = window.speechSynthesis;
                this.enabled = true;
                this.speaking = false;
            }

            speak(text, priority = false) {
                if (!this.enabled) return Promise.resolve();
                
                return new Promise((resolve) => {
                    if (priority) {
                        this.stop();
                    }
                    
                    const utterance = new SpeechSynthesisUtterance(text);
                    utterance.rate = 0.9;
                    utterance.pitch = 1.0;
                    utterance.volume = 0.9;
                    
                    utterance.onend = () => {
                        this.speaking = false;
                        resolve();
                    };
                    
                    this.synth.speak(utterance);
                    this.speaking = true;
                });
            }

            stop() {
                this.synth.cancel();
                this.speaking = false;
            }

            toggle() {
                this.enabled = !this.enabled;
                if (!this.enabled) this.stop();
                return this.enabled;
            }
        }

        const narrator = new AudioNarrator();

        // Lesson Sequence Class
        class LessonSequence {
            constructor() {
                this.sections = [
                    { id: 'intro', name: 'Introduction', duration: 5000 },
                    { id: 'current', name: 'Electric Current', duration: 10000 },
                    { id: 'circuit', name: 'Electric Circuit', duration: 8000 },
                    { id: 'potential', name: 'Potential Difference', duration: 10000 },
                    { id: 'wateranalogy', name: 'Water Analogy', duration: 8000 },
                    { id: 'datachart', name: 'Data Visualization', duration: 8000 },
                    { id: 'solving', name: 'Problem Solving', duration: 10000 }
                ];
                this.currentSection = 0;
                this.running = false;
                this.timeout = null;
            }

            async start() {
                this.stop();
                this.running = true;
                this.currentSection = 0;
                
                document.getElementById('demoCanvas').style.display = 'none';
                document.getElementById('chartContainer').style.display = 'none';
                document.getElementById('lessonContent').style.display = 'block';
                hideAllPanels();
                
                await narrator.speak("Welcome to Chapter 11. Let's explore electric current and potential difference!");
                
                await this.runNextSection();
            }

            async runNextSection() {
                if (!this.running || this.currentSection >= this.sections.length) {
                    if (this.running) {
                        await narrator.speak("Congratulations! You've completed the lesson on electric current and potential difference.");
                        this.showCompletionMessage();
                    }
                    return;
                }

                const section = this.sections[this.currentSection];
                
                // Update display based on section
                this.updateDisplay(section.id);
                
                // Set mode for animation
                currentMode = section.id;
                
                // Start narration for each section
                await this.narrate(section.id);
                
                await this.wait(section.duration);
                
                if (this.running) {
                    this.currentSection++;
                    await this.runNextSection();
                }
            }

            updateDisplay(sectionId) {
                hideAllPanels();
                document.getElementById('chartContainer').style.display = 'none';
                document.getElementById('lessonContent').style.display = 'none';
                document.getElementById('demoCanvas').style.display = 'block';
                
                switch(sectionId) {
                    case 'intro':
                        document.getElementById('demoCanvas').style.display = 'none';
                        document.getElementById('lessonContent').style.display = 'block';
                        this.showIntroContent();
                        break;
                    case 'current':
                        document.getElementById('currentPanel').style.display = 'block';
                        break;
                    case 'circuit':
                        document.getElementById('currentPanel').style.display = 'block';
                        break;
                    case 'potential':
                        document.getElementById('potentialPanel').style.display = 'block';
                        break;
                    case 'wateranalogy':
                        document.getElementById('potentialPanel').style.display = 'block';
                        break;
                    case 'datachart':
                        document.getElementById('demoCanvas').style.display = 'none';
                        document.getElementById('chartContainer').style.display = 'block';
                        createDataChart();
                        break;
                    case 'solving':
                        document.getElementById('example1').style.display = 'block';
                        document.getElementById('questions').style.display = 'block';
                        break;
                }
            }

            async narrate(sectionId) {
                switch(sectionId) {
                    case 'intro':
                        await narrator.speak("Electricity has an important place in modern society. It is a controllable and convenient form of energy for various uses in homes, schools, hospitals, and industries. Electricity is the flow of electric charge through conductors, primarily electrons moving through metallic wires. This flow of charge creates electric current, which powers our lights, computers, and countless other devices. Let's understand what constitutes electricity, how it flows, and the fundamental principles that govern electrical circuits and potential differences.");
                        break;
                    case 'current':
                        await narrator.speak("Electric current is the flow of electric charge through a conductor. Just like water flowing in a river, electrons flow through metallic wires. The current I equals charge Q divided by time t. One ampere equals one coulomb of charge flowing per second. Notice how the yellow electrons move through the conductor, creating a flow of charge. The red arrow shows conventional current direction, which is opposite to electron flow. This is because early scientists thought positive charges moved, but we now know electrons carry the charge. The current strength depends on how many electrons pass through a point per second, measured in amperes.");
                        break;
                    case 'circuit':
                        await narrator.speak("An electric circuit is a continuous closed path for current flow. A torch works when its switch completes the circuit between the battery and bulb. Watch how current flows from positive to negative terminal. The battery provides the energy source, creating a potential difference that drives electrons through the circuit. The glowing bulb filament shows electrical energy being converted to light and heat. The ammeter measures the current strength, and the red particles show how charge carriers move through the complete loop. Without a complete circuit, no current flows, which is why switches can turn devices on and off by breaking or completing the circuit path.");
                        break;
                    case 'potential':
                        await narrator.speak("Potential difference is what makes charges flow. It's the work done per unit charge moved between two points. V equals W divided by Q. Batteries create potential difference through chemical reactions. The positive terminal has high potential energy, while the negative terminal has low potential energy. This difference in potential energy creates an electric field that pushes charges through the circuit. The yellow charge particles show how positive charges move from high to low potential, doing work as they flow through the resistor. The voltmeter measures this potential difference, and the energy lines show work being done as charges move through the circuit. Higher potential difference means more energy per charge, creating stronger current flow.");
                        break;
                    case 'wateranalogy':
                        await narrator.speak("Think of electricity like water flow. Water needs pressure difference to flow through pipes, similarly charges need potential difference to flow through wires. Higher voltage creates more current. The upper tank represents high potential with high pressure, while the lower tank represents low potential with low pressure. Water flows from high pressure to low pressure through the pipe, just as electric charges flow from high potential to low potential through wires. The blue water droplets show the flow rate, similar to current in electrical circuits. The pressure difference drives the flow, and the pipe resistance affects how fast water flows, just like electrical resistance affects current flow. This analogy helps us understand why we need voltage to create current flow.");
                        break;
                    case 'datachart':
                        await narrator.speak("Let's visualize the relationship between current, charge, time, and potential difference through interactive charts. Notice how these quantities are interconnected. The yellow line shows charge accumulation over time, increasing linearly as Q equals I times t. The cyan line shows constant current of 0.5 amperes, while the pink dashed line shows constant potential difference of 12 volts. This demonstrates how charge builds up when current flows for a specific time period. The mathematical relationships between these quantities are fundamental to understanding electrical circuits and solving problems involving current, charge, time, and voltage.");
                        break;
                    case 'solving':
                        await narrator.speak("Now let's solve Example 11.1: A 0.5 ampere current flows for 10 minutes. Using Q equals I times t, we get 300 coulombs of charge. Watch the animation to see this in action! The glowing bulb shows electrical energy being converted to light and heat. The yellow electrons flow through the circuit, and the clock shows the 10-minute duration. Step by step, we identify the given values, apply the formula Q equals I times t, substitute the values, and calculate the result. This 300 coulombs represents an enormous number of electrons - approximately 1.875 times 10 to the power of 21 electrons flowing through the bulb filament over 10 minutes!");
                        break;
                }
            }

            showIntroContent() {
                const html = `
                    <div class="lesson-section">
                        <h2 class="lesson-title">Introduction to Electricity</h2>
                        <div class="lesson-text">
                            <p>Electricity is fundamental to modern life. In this lesson, we'll explore:</p>
                            <ul style="margin: 20px; line-height: 2;">
                                <li>⚡ What is electric current and how does it flow?</li>
                                <li>🔌 What makes a complete electric circuit?</li>
                                <li>🔋 What is potential difference and why is it important?</li>
                                <li>📊 How to visualize electrical relationships?</li>
                                <li>💡 How do we calculate electrical quantities?</li>
                            </ul>
                        </div>
                    </div>
                `;
                document.getElementById('lessonContent').innerHTML = html;
            }

            showCompletionMessage() {
                const html = `
                    <div style="text-align: center; padding: 40px;">
                        <h2 style="color: #ffd89b; margin-bottom: 20px;">
                            🎉 Lesson Complete!
                        </h2>
                        <p style="font-size: 1.2rem;">You've mastered:</p>
                        <ul style="margin: 20px auto; max-width: 400px; text-align: left; list-style: none;">
                            <li style="margin: 10px 0; color: #4ecdc4;">✓ Electric Current (I = Q/t)</li>
                            <li style="margin: 10px 0; color: #4ecdc4;">✓ Electric Circuits</li>
                            <li style="margin: 10px 0; color: #4ecdc4;">✓ Potential Difference (V = W/Q)</li>
                            <li style="margin: 10px 0; color: #4ecdc4;">✓ Data Visualization</li>
                            <li style="margin: 10px 0; color: #4ecdc4;">✓ Problem Solving</li>
                        </ul>
                        <p style="margin-top: 30px;">
                            Explore individual sections or reset to review.
                        </p>
                    </div>
                `;
                document.getElementById('lessonContent').innerHTML = html;
                document.getElementById('lessonContent').style.display = 'block';
                document.getElementById('demoCanvas').style.display = 'none';
            }

            wait(ms) {
                return new Promise(resolve => {
                    this.timeout = setTimeout(resolve, ms);
                });
            }

            stop() {
                this.running = false;
                if (this.timeout) {
                    clearTimeout(this.timeout);
                    this.timeout = null;
                }
                narrator.stop();
            }
        }

        // Helper function to hide all panels
        function hideAllPanels() {
            document.getElementById('currentPanel').style.display = 'none';
            document.getElementById('potentialPanel').style.display = 'none';
            document.getElementById('example1').style.display = 'none';
            document.getElementById('questions').style.display = 'none';
        }

        // Create Data Chart
        function createDataChart() {
            const chartCanvas = document.getElementById('dataChart');
            
            if (chartInstance) {
                chartInstance.destroy();
            }
            
            const chartData = {
                labels: ['1s', '2s', '3s', '4s', '5s', '6s', '7s', '8s', '9s', '10s'],
                datasets: [
                    {
                        label: 'Charge Accumulated (Q) in Coulombs',
                        data: [0.5, 1, 1.5, 2, 2.5, 3, 3.5, 4, 4.5, 5],
                        borderColor: '#ffd89b',
                        backgroundColor: 'rgba(255, 216, 155, 0.1)',
                        borderWidth: 3,
                        tension: 0.4,
                        pointRadius: 5,
                        pointHoverRadius: 8,
                        pointBackgroundColor: '#ffd89b',
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2
                    },
                    {
                        label: 'Current (I) in Amperes',
                        data: [0.5, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5],
                        borderColor: '#4ecdc4',
                        backgroundColor: 'rgba(78, 205, 196, 0.1)',
                        borderWidth: 3,
                        tension: 0.4,
                        pointRadius: 5,
                        pointHoverRadius: 8,
                        pointBackgroundColor: '#4ecdc4',
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2
                    },
                    {
                        label: 'Potential Difference (V) in Volts',
                        data: [12, 12, 12, 12, 12, 12, 12, 12, 12, 12],
                        borderColor: '#f093fb',
                        backgroundColor: 'rgba(240, 147, 251, 0.1)',
                        borderWidth: 3,
                        borderDash: [5, 5],
                        tension: 0.4,
                        pointRadius: 5,
                        pointHoverRadius: 8,
                        pointBackgroundColor: '#f093fb',
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2
                    }
                ]
            };
            
            chartInstance = new Chart(chartCanvas, {
                type: 'line',
                data: chartData,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        mode: 'index',
                        intersect: false
                    },
                    plugins: {
                        title: {
                            display: true,
                            text: 'Relationship Between Electrical Quantities Over Time',
                            color: '#ffd89b',
                            font: {
                                size: 20,
                                weight: 'bold'
                            },
                            padding: 20
                        },
                        legend: {
                            display: true,
                            position: 'top',
                            labels: {
                                color: '#ffffff',
                                font: {
                                    size: 14
                                },
                                padding: 15,
                                usePointStyle: true
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            titleColor: '#ffd89b',
                            bodyColor: '#ffffff',
                            borderColor: '#ffd89b',
                            borderWidth: 1,
                            padding: 12,
                            displayColors: true,
                            callbacks: {
                                afterLabel: function(context) {
                                    if (context.dataset.label.includes('Charge')) {
                                        return 'Q = I × t = 0.5A × ' + (context.dataIndex + 1) + 's';
                                    }
                                    return '';
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)',
                                borderColor: 'rgba(255, 255, 255, 0.3)'
                            },
                            ticks: {
                                color: '#ffffff',
                                font: {
                                    size: 12
                                }
                            },
                            title: {
                                display: true,
                                text: 'Value',
                                color: '#ffffff',
                                font: {
                                    size: 14
                                }
                            }
                        },
                        x: {
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)',
                                borderColor: 'rgba(255, 255, 255, 0.3)'
                            },
                            ticks: {
                                color: '#ffffff',
                                font: {
                                    size: 12
                                }
                            },
                            title: {
                                display: true,
                                text: 'Time',
                                color: '#ffffff',
                                font: {
                                    size: 14
                                }
                            }
                        }
                    },
                    animation: {
                        duration: 2000,
                        easing: 'easeInOutQuart'
                    }
                }
            });
        }

        // Animation Functions
        function animateCurrent() {
            // Clear canvas with gradient background
            const gradient = ctx.createLinearGradient(0, 0, 1200, 500);
            gradient.addColorStop(0, '#0a0a0a');
            gradient.addColorStop(1, '#1a1a2e');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, 1200, 500);
            
            // Draw wire with gradient
            const wireGradient = ctx.createLinearGradient(100, 240, 1100, 260);
            wireGradient.addColorStop(0, '#444');
            wireGradient.addColorStop(0.5, '#666');
            wireGradient.addColorStop(1, '#444');
            ctx.strokeStyle = wireGradient;
            ctx.lineWidth = 25;
            ctx.lineCap = 'round';
            ctx.beginPath();
            ctx.moveTo(100, 250);
            ctx.lineTo(1100, 250);
            ctx.stroke();
            
            // Draw glowing electrons
            for (let i = 0; i < 12; i++) {
                const x = 100 + ((time * 4 + i * 100) % 1000);
                const pulse = Math.sin((time + i * 20) * 0.05) * 0.3 + 1;
                
                // Glow effect
                ctx.shadowColor = '#ffff00';
                ctx.shadowBlur = 20 * pulse;
                
                // Electron
                const electronGradient = ctx.createRadialGradient(x, 250, 0, x, 250, 10);
                electronGradient.addColorStop(0, '#ffffff');
                electronGradient.addColorStop(0.5, '#ffff00');
                electronGradient.addColorStop(1, '#ffaa00');
                ctx.fillStyle = electronGradient;
                ctx.beginPath();
                ctx.arc(x, 250, 8 * pulse, 0, Math.PI * 2);
                ctx.fill();
                
                // Reset shadow
                ctx.shadowBlur = 0;
                
                // Minus sign
                ctx.fillStyle = '#000';
                ctx.fillRect(x - 4, 249, 8, 2);
            }
            
            // Draw animated current arrow
            ctx.strokeStyle = '#ff6b6b';
            ctx.lineWidth = 4;
            ctx.setLineDash([10, 5]);
            ctx.lineDashOffset = -time * 0.5;
            ctx.beginPath();
            ctx.moveTo(150, 200);
            ctx.lineTo(1050, 200);
            ctx.stroke();
            ctx.setLineDash([]);
            
            // Arrow head with animation
            const arrowPulse = Math.sin(time * 0.05) * 5;
            ctx.fillStyle = '#ff6b6b';
            ctx.beginPath();
            ctx.moveTo(1050 + arrowPulse, 200);
            ctx.lineTo(1030 + arrowPulse, 190);
            ctx.lineTo(1030 + arrowPulse, 210);
            ctx.closePath();
            ctx.fill();
            
            // Animated labels
            ctx.fillStyle = '#ffffff';
            ctx.font = 'bold 18px Arial';
            ctx.shadowColor = '#000';
            ctx.shadowBlur = 5;
            ctx.fillText('Electron Flow (−)', 500, 300);
            ctx.fillText('Conventional Current (+)', 500, 175);
            
            // Current calculation with animation
            const displayCurrent = 0.5;
            ctx.font = 'bold 28px Arial';
            ctx.fillStyle = '#ffd89b';
            ctx.shadowColor = '#ffd89b';
            ctx.shadowBlur = 10;
            ctx.fillText(`I = Q/t = 300C / 600s = ${displayCurrent} A`, 350, 100);
            
            ctx.shadowBlur = 0;
            time++;
        }

        function animateCircuit() {
    // Clear canvas with solid color (faster than gradient)
    ctx.fillStyle = '#0a0a15';
    ctx.fillRect(0, 0, 1200, 500);
    
    // Grid pattern - draw less frequently (every 3rd frame)
    if (time % 3 === 0) {
        ctx.strokeStyle = 'rgba(100, 100, 150, 0.03)';
        ctx.lineWidth = 1;
        ctx.beginPath();
        // Reduced grid lines
        for (let i = 0; i < 1200; i += 120) {
            ctx.moveTo(i, 0);
            ctx.lineTo(i, 500);
        }
        for (let i = 0; i < 500; i += 120) {
            ctx.moveTo(0, i);
            ctx.lineTo(1200, i);
        }
        ctx.stroke();
    }
    
    // Draw battery - simplified
    ctx.strokeStyle = '#00ffff';
    ctx.lineWidth = 2;
    ctx.strokeRect(150, 210, 70, 80);
    
    // Battery fill
    ctx.fillStyle = 'rgba(0, 255, 255, 0.1)';
    ctx.fillRect(155, 215, 60, 70);
    
    // Terminals - static, no pulse
    ctx.strokeStyle = '#ff6b6b';
    ctx.lineWidth = 4;
    ctx.beginPath();
    ctx.moveTo(220, 230);
    ctx.lineTo(220, 270);
    ctx.stroke();
    
    ctx.strokeStyle = '#4ecdc4';
    ctx.beginPath();
    ctx.moveTo(150, 240);
    ctx.lineTo(150, 260);
    ctx.stroke();
    
    // Terminal signs - draw every frame
    ctx.fillStyle = '#ff6b6b';
    ctx.font = '20px Arial';
    ctx.fillText('+', 225, 245);
    ctx.fillStyle = '#4ecdc4';
    ctx.fillText('−', 125, 250);
    
    // Circuit Wires - solid color, no gradient
    ctx.strokeStyle = '#666';
    ctx.lineWidth = 6;
    ctx.lineCap = 'round';
    
    // All wires in one path
    ctx.beginPath();
    // Battery to bulb
    ctx.moveTo(220, 250);
    ctx.lineTo(400, 250);
    ctx.lineTo(400, 180);
    ctx.lineTo(565, 180);
    ctx.lineTo(565, 215);
    // Bulb to ammeter
    ctx.moveTo(565, 285);
    ctx.lineTo(565, 320);
    ctx.lineTo(852, 320);
    ctx.lineTo(852, 250);
    // Ammeter to battery
    ctx.moveTo(948, 250);
    ctx.lineTo(1000, 250);
    ctx.lineTo(1000, 400);
    ctx.lineTo(100, 400);
    ctx.lineTo(100, 250);
    ctx.lineTo(150, 250);
    ctx.stroke();
    
    // Bulb - simplified glow
    const glowIntensity = Math.sin(time * 0.03) * 0.2 + 0.8;
    
    // Single glow layer
    ctx.fillStyle = `rgba(255, 220, 100, ${glowIntensity * 0.2})`;
    ctx.beginPath();
    ctx.arc(565, 250, 40, 0, Math.PI * 2);
    ctx.fill();
    
    // Bulb outline
    ctx.strokeStyle = 'rgba(255, 255, 255, 0.6)';
    ctx.lineWidth = 2;
    ctx.beginPath();
    ctx.arc(565, 250, 35, 0, Math.PI * 2);
    ctx.stroke();
    
    // Bulb base
    ctx.fillStyle = '#333';
    ctx.fillRect(555, 280, 20, 15);
    
    // Simple filament
    ctx.strokeStyle = `rgba(255, 230, 150, ${glowIntensity})`;
    ctx.lineWidth = 2;
    ctx.beginPath();
    ctx.moveTo(545, 250);
    ctx.lineTo(585, 250);
    ctx.stroke();
    
    // Ammeter - simplified
    ctx.strokeStyle = '#4b86b4';
    ctx.lineWidth = 3;
    ctx.beginPath();
    ctx.arc(900, 250, 45, 0, Math.PI * 2);
    ctx.stroke();
    
    ctx.fillStyle = 'rgba(20, 30, 40, 0.8)';
    ctx.beginPath();
    ctx.arc(900, 250, 42, 0, Math.PI * 2);
    ctx.fill();
    
    // Fewer scale marks
    ctx.strokeStyle = '#4ecdc4';
    ctx.lineWidth = 1;
    for (let i = 0; i < 4; i++) {
        const angle = (i * Math.PI / 2) - Math.PI / 2;
        const x1 = 900 + Math.cos(angle) * 35;
        const y1 = 250 + Math.sin(angle) * 35;
        const x2 = 900 + Math.cos(angle) * 40;
        const y2 = 250 + Math.sin(angle) * 40;
        ctx.beginPath();
        ctx.moveTo(x1, y1);
        ctx.lineTo(x2, y2);
        ctx.stroke();
    }
    
    // Ammeter needle
    const needleAngle = -Math.PI/2 + (Math.PI/3) + Math.sin(time * 0.02) * Math.PI/16;
    ctx.strokeStyle = '#ff6b6b';
    ctx.lineWidth = 2;
    ctx.beginPath();
    ctx.moveTo(900, 250);
    ctx.lineTo(900 + Math.cos(needleAngle) * 30, 250 + Math.sin(needleAngle) * 30);
    ctx.stroke();
    
    // Center pivot
    ctx.fillStyle = '#ff6b6b';
    ctx.beginPath();
    ctx.arc(900, 250, 4, 0, Math.PI * 2);
    ctx.fill();
    
    // A label
    ctx.fillStyle = '#4ecdc4';
    ctx.font = '20px Arial';
    ctx.fillText('A', 893, 257);
    
    // Current flow - reduced to 5 particles
    for (let i = 0; i < 5; i++) {
        const progress = (time * 0.012 + i * 0.2) % 1;
        let x, y;
        
        // Simplified path calculation
        if (progress < 0.25) {
            // Battery to bulb top
            const p = progress / 0.25;
            if (p < 0.5) {
                x = 220 + p * 360;
                y = 250;
            } else {
                x = 400;
                y = 250 - (p - 0.5) * 140;
            }
        } else if (progress < 0.5) {
            // Bulb area
            const p = (progress - 0.25) / 0.25;
            if (p < 0.5) {
                x = 400 + p * 330;
                y = 180;
            } else {
                x = 565;
                y = 180 + (p - 0.5) * 280;
            }
        } else if (progress < 0.75) {
            // Bulb to ammeter
            const p = (progress - 0.5) / 0.25;
            if (p < 0.5) {
                x = 565 + p * 574;
                y = 320;
            } else {
                x = 852;
                y = 320 - (p - 0.5) * 140;
            }
        } else {
            // Return path
            const p = (progress - 0.75) / 0.25;
            if (p < 0.2) {
                x = 948 + p * 260;
                y = 250;
            } else if (p < 0.6) {
                x = 1000;
                y = 250 + (p - 0.2) * 375;
            } else {
                x = 1000 - (p - 0.6) * 2250;
                y = 400;
            }
        }
        
        // Simple particle
        ctx.fillStyle = 'rgba(100, 200, 255, 0.7)';
        ctx.beginPath();
        ctx.arc(x, y, 4, 0, Math.PI * 2);
        ctx.fill();
    }
    
    // Labels - draw every frame
    ctx.fillStyle = '#ffffff';
    ctx.font = '16px Arial';
    ctx.fillText('Battery', 140, 355);
    ctx.fillText('Bulb', 548, 355);
    ctx.fillText('Ammeter', 875, 355);
    
    // Title - draw every frame
    ctx.font = '30px Arial';
    ctx.fillStyle = '#ffed4e';
    ctx.fillText('Series Electric Circuit', 440, 55);
    
    // Circuit info - draw every frame
    const currentValue = (3.5 + Math.sin(time * 0.02) * 0.5).toFixed(1);
    const voltageValue = '12.0';
    const resistanceValue = (12 / currentValue).toFixed(1);
    
    ctx.font = '14px monospace';
    ctx.fillStyle = '#4ecdc4';
    ctx.fillText(`I: ${currentValue}A`, 60, 450);
    ctx.fillText(`V: ${voltageValue}V`, 180, 450);
    ctx.fillText(`R: ${resistanceValue}Ω`, 300, 450);
    
    // Simple Ohm's Law
    ctx.fillStyle = '#ffd89b';
    ctx.fillText(`V = I × R`, 450, 450);
    
     time++;
 }
        function animatePotential() {
            // Clear canvas with gradient
            const gradient = ctx.createLinearGradient(0, 0, 1200, 500);
            gradient.addColorStop(0, '#0a0a0a');
            gradient.addColorStop(1, '#1a1a2e');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, 1200, 500);
            
            // Battery terminals with realistic design
            const batteryX = 150;
            const batteryY = 250;
            
            // Battery case
            ctx.fillStyle = 'rgba(50, 50, 50, 0.8)';
            ctx.fillRect(batteryX - 50, batteryY - 100, 100, 200);
            
            // Positive terminal (top)
            ctx.fillStyle = '#ff6b6b';
            ctx.fillRect(batteryX - 40, batteryY - 100, 80, 30);
            ctx.fillStyle = '#ffffff';
            ctx.font = 'bold 24px Arial';
            ctx.fillText('+', batteryX - 10, batteryY - 75);
            
            // Negative terminal (bottom)
            ctx.fillStyle = '#4169e1';
            ctx.fillRect(batteryX - 40, batteryY + 70, 80, 30);
            ctx.fillStyle = '#ffffff';
            ctx.fillText('−', batteryX - 10, batteryY + 95);
            
            // Voltage display on battery
            ctx.fillStyle = '#ffd89b';
            ctx.font = 'bold 20px Arial';
            ctx.fillText('12V', batteryX - 15, batteryY + 5);
            
            // Draw circuit with resistor
            ctx.strokeStyle = '#666';
            ctx.lineWidth = 8;
            ctx.lineCap = 'round';
            
            // Wire from positive terminal
            ctx.beginPath();
            ctx.moveTo(batteryX + 40, batteryY - 85);
            ctx.lineTo(400, batteryY - 85);
            ctx.lineTo(400, batteryY - 50);
            ctx.stroke();
            
            // Resistor (zigzag pattern)
            ctx.strokeStyle = '#888';
            ctx.lineWidth = 4;
            ctx.beginPath();
            ctx.moveTo(400, batteryY - 50);
            for (let i = 0; i < 8; i++) {
                const x = 400 + (i % 2 === 0 ? -15 : 15);
                const y = batteryY - 50 + i * 12.5;
                ctx.lineTo(x, y);
            }
            ctx.lineTo(400, batteryY + 50);
            ctx.stroke();
            
            // Wire to voltmeter and back
            ctx.strokeStyle = '#666';
            ctx.lineWidth = 8;
            ctx.beginPath();
            ctx.moveTo(400, batteryY + 50);
            ctx.lineTo(400, batteryY + 85);
            ctx.lineTo(batteryX + 40, batteryY + 85);
            ctx.stroke();
            
            // Voltmeter parallel to resistor
            ctx.strokeStyle = '#ffd89b';
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.arc(550, batteryY, 50, 0, Math.PI * 2);
            ctx.stroke();
            ctx.fillStyle = '#ffd89b';
            ctx.font = 'bold 24px Arial';
            ctx.fillText('V', 540, batteryY + 8);
            
            // Voltmeter connections
            ctx.strokeStyle = '#ffd89b';
            ctx.lineWidth = 2;
            ctx.setLineDash([5, 5]);
            ctx.beginPath();
            ctx.moveTo(400, batteryY - 50);
            ctx.lineTo(500, batteryY - 50);
            ctx.lineTo(500, batteryY);
            ctx.stroke();
            ctx.beginPath();
            ctx.moveTo(400, batteryY + 50);
            ctx.lineTo(500, batteryY + 50);
            ctx.lineTo(500, batteryY);
            ctx.stroke();
            ctx.setLineDash([]);
            
            // Animate charges through circuit
            for (let i = 0; i < 8; i++) {
                const progress = (time * 0.01 + i * 0.125) % 1;
                let x, y;
                
                if (progress < 0.3) {
                    // Moving through top wire
                    x = batteryX + 40 + progress * 3 * (360 - batteryX);
                    y = batteryY - 85;
                } else if (progress < 0.5) {
                    // Moving through resistor
                    x = 400;
                    y = batteryY - 50 + (progress - 0.3) * 5 * 100;
                } else {
                    // Moving through bottom wire
                    x = 400 - (progress - 0.5) * 2 * (400 - batteryX - 40);
                    y = batteryY + 85;
                }
                
                // Draw charge with gradient
                const chargeGradient = ctx.createRadialGradient(x, y, 0, x, y, 10);
                chargeGradient.addColorStop(0, '#ffff00');
                chargeGradient.addColorStop(0.5, '#ffaa00');
                chargeGradient.addColorStop(1, 'rgba(255, 170, 0, 0)');
                ctx.fillStyle = chargeGradient;
                ctx.beginPath();
                ctx.arc(x, y, 10, 0, Math.PI * 2);
                ctx.fill();
                
                // Plus sign on charge
                ctx.fillStyle = '#000';
                ctx.font = 'bold 12px Arial';
                ctx.fillText('+', x - 4, y + 4);
            }
            
            // Energy visualization (work done)
            const energyPulse = Math.sin(time * 0.03) * 0.3 + 0.7;
            ctx.strokeStyle = `rgba(255, 216, 155, ${energyPulse})`;
            ctx.lineWidth = 2;
            ctx.setLineDash([10, 10]);
            ctx.lineDashOffset = time * 0.5;
            
            // Energy flow lines
            for (let i = 0; i < 3; i++) {
                ctx.beginPath();
                ctx.moveTo(batteryX + 50, batteryY - 70 + i * 20);
                ctx.lineTo(380, batteryY - 70 + i * 20);
                ctx.stroke();
            }
            ctx.setLineDash([]);
            
            // Labels and formulas
            ctx.fillStyle = '#ffffff';
            ctx.font = 'bold 20px Arial';
            ctx.shadowColor = '#000';
            ctx.shadowBlur = 5;
            ctx.fillText('High Potential (+)', 50, 120);
            ctx.fillText('Low Potential (−)', 50, 380);
            ctx.fillText('Resistor', 350, 180);
            ctx.fillText('Work Done', 650, 200);
            
            // Formula display
            ctx.font = 'bold 28px Arial';
            ctx.fillStyle = '#ffd89b';
            ctx.shadowColor = '#ffd89b';
            ctx.shadowBlur = 10;
            ctx.fillText('V = W/Q = 24J / 2C = 12V', 700, 300);
            
            // Energy transfer visualization
            ctx.fillStyle = '#4ecdc4';
            ctx.font = '16px Arial';
            ctx.fillText('Energy transferred: 24 Joules', 700, 340);
            ctx.fillText('Charge moved: 2 Coulombs', 700, 365);
            
            ctx.shadowBlur = 0;
            time++;
        }

        function animateWaterAnalogy() {
    // Clear canvas with gradient
    const gradient = ctx.createLinearGradient(0, 0, 1200, 500);
    gradient.addColorStop(0, '#0a0a0a');
    gradient.addColorStop(1, '#1a1a2e');
    ctx.fillStyle = gradient;
    ctx.fillRect(0, 0, 1200, 500);
    
    // Draw left water tank (more water) with 3D effect
    const tankGradient = ctx.createLinearGradient(100, 200, 250, 400);
    tankGradient.addColorStop(0, 'rgba(78, 205, 196, 0.4)');
    tankGradient.addColorStop(1, 'rgba(78, 205, 196, 0.2)');
    
    ctx.fillStyle = tankGradient;
    ctx.fillRect(100, 200, 150, 200);
    ctx.strokeStyle = '#4ecdc4';
    ctx.lineWidth = 3;
    ctx.strokeRect(100, 200, 150, 200);
    
    // Water in left tank (HIGH level) with wave animation
    const waveOffset = Math.sin(time * 0.02) * 5;
    const leftWaterLevel = 250; // Higher water level
    ctx.fillStyle = 'rgba(100, 200, 255, 0.6)';
    ctx.beginPath();
    ctx.moveTo(105, leftWaterLevel + waveOffset);
    for (let x = 105; x <= 245; x += 5) {
        const y = leftWaterLevel + Math.sin((x + time) * 0.05) * 3;
        ctx.lineTo(x, y);
    }
    ctx.lineTo(245, 395);
    ctx.lineTo(105, 395);
    ctx.closePath();
    ctx.fill();
    
    // Draw right water tank (less water)
    ctx.fillStyle = tankGradient;
    ctx.fillRect(950, 200, 150, 200);
    ctx.strokeStyle = '#4ecdc4';
    ctx.strokeRect(950, 200, 150, 200);
    
    // Water in right tank (LOW level)
    const rightWaterLevel = 340; // Lower water level
    ctx.fillStyle = 'rgba(100, 200, 255, 0.6)';
    ctx.beginPath();
    ctx.moveTo(955, rightWaterLevel + waveOffset);
    for (let x = 955; x <= 1095; x += 5) {
        const y = rightWaterLevel + Math.sin((x + time) * 0.05) * 3;
        ctx.lineTo(x, y);
    }
    ctx.lineTo(1095, 395);
    ctx.lineTo(955, 395);
    ctx.closePath();
    ctx.fill();
    
    // Connecting pipe at bottom level
    const pipeGradient = ctx.createLinearGradient(250, 380, 950, 380);
    pipeGradient.addColorStop(0, '#555');
    pipeGradient.addColorStop(0.5, '#777');
    pipeGradient.addColorStop(1, '#555');
    ctx.strokeStyle = pipeGradient;
    ctx.lineWidth = 35;
    ctx.lineCap = 'round';
    ctx.beginPath();
    ctx.moveTo(250, 380);
    ctx.lineTo(950, 380);
    ctx.stroke();
    
    // Animate water flow from left (more) to right (less)
    for (let i = 0; i < 8; i++) {
        const progress = (time * 0.03 + i * 0.125) % 1;
        const x = 250 + progress * 700;
        const y = 380;
        
        // Water droplet with glow
        const dropGradient = ctx.createRadialGradient(x, y, 0, x, y, 10);
        dropGradient.addColorStop(0, 'rgba(100, 200, 255, 1)');
        dropGradient.addColorStop(0.5, 'rgba(100, 200, 255, 0.6)');
        dropGradient.addColorStop(1, 'rgba(100, 200, 255, 0)');
        ctx.fillStyle = dropGradient;
        ctx.beginPath();
        ctx.arc(x, y, 10, 0, Math.PI * 2);
        ctx.fill();
    }
    
    // Flow direction arrow
    ctx.strokeStyle = '#4ecdc4';
    ctx.lineWidth = 3;
    ctx.beginPath();
    ctx.moveTo(550, 350);
    ctx.lineTo(650, 350);
    ctx.stroke();
    
    // Arrow head
    ctx.fillStyle = '#4ecdc4';
    ctx.beginPath();
    ctx.moveTo(650, 350);
    ctx.lineTo(640, 345);
    ctx.lineTo(640, 355);
    ctx.closePath();
    ctx.fill();
    
    // Pressure indicators with animation
    const pressurePulse = Math.sin(time * 0.03) * 0.2 + 0.8;
    
    // High pressure indicator (left tank)
    ctx.strokeStyle = `rgba(255, 100, 100, ${pressurePulse})`;
    ctx.lineWidth = 3;
    for (let i = 0; i < 3; i++) {
        ctx.beginPath();
        ctx.arc(175, 200 - i * 20, 30 + i * 10, 0, Math.PI * 2);
        ctx.stroke();
    }
    
    // Low pressure indicator (right tank)
    ctx.strokeStyle = `rgba(100, 100, 255, ${pressurePulse * 0.5})`;
    for (let i = 0; i < 2; i++) {
        ctx.beginPath();
        ctx.arc(1025, 200 - i * 20, 20 + i * 10, 0, Math.PI * 2);
        ctx.stroke();
    }
    
    // Water level indicators
    ctx.strokeStyle = '#ffffff';
    ctx.lineWidth = 2;
    ctx.setLineDash([5, 5]);
    
    // Left water level line
    ctx.beginPath();
    ctx.moveTo(30, leftWaterLevel);
    ctx.lineTo(90, leftWaterLevel);
    ctx.stroke();
    
    // Right water level line
    ctx.beginPath();
    ctx.moveTo(1110, rightWaterLevel);
    ctx.lineTo(1170, rightWaterLevel);
    ctx.stroke();
    
    ctx.setLineDash([]);
    
    // Labels with enhanced styling
    ctx.fillStyle = '#ffffff';
    ctx.font = 'bold 20px Arial';
    ctx.shadowColor = '#000';
    ctx.shadowBlur = 5;
    
    // Left container labels
    ctx.fillStyle = '#ff6b6b';
    ctx.fillText('High Pressure', 100, 150);
    ctx.fillStyle = '#ffffff';
    ctx.font = '16px Arial';
    ctx.fillText('More Water', 120, 175);
    ctx.fillText('(High Potential)', 105, 430);
    
    // Right container labels
    ctx.font = 'bold 20px Arial';
    ctx.fillStyle = '#4169e1';
    ctx.fillText('Low Pressure', 970, 150);
    ctx.fillStyle = '#ffffff';
    ctx.font = '16px Arial';
    ctx.fillText('Less Water', 990, 175);
    ctx.fillText('(Low Potential)', 965, 430);
    
    // Flow label
    ctx.font = 'bold 18px Arial';
    ctx.fillStyle = '#4ecdc4';
    ctx.fillText('Water Flows →', 530, 340);
    
    // Analogy explanation
    ctx.font = 'bold 22px Arial';
    ctx.fillStyle = '#ffd89b';
    ctx.shadowColor = '#ffd89b';
    ctx.shadowBlur = 10;
    ctx.fillText('Water Level Difference = Potential Difference', 350, 50);
    ctx.fillText('Water Flow = Electric Current', 430, 470);
    
    // Additional explanation
    ctx.font = '18px Arial';
    ctx.fillStyle = '#aaa';
    ctx.shadowBlur = 3;
    ctx.fillText('Water flows from higher level to lower level', 400, 90);
    ctx.fillText('Similarly, current flows from higher to lower potential', 360, 115);
    
    ctx.shadowBlur = 0;
    time++;
}

        function animateSolving() {
            // Clear canvas with gradient
            const gradient = ctx.createLinearGradient(0, 0, 1200, 500);
            gradient.addColorStop(0, '#0a0a0a');
            gradient.addColorStop(1, '#1a1a2e');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, 1200, 500);
            
            // Title
            ctx.font = 'bold 28px Arial';
            ctx.fillStyle = '#ffd89b';
            ctx.shadowColor = '#ffd89b';
            ctx.shadowBlur = 10;
            ctx.fillText('Example 11.1 - Animated Solution', 400, 40);
            
            // Problem visualization
            // Draw bulb with filament
            const bulbX = 200;
            const bulbY = 200;
            const glowIntensity = Math.sin(time * 0.03) * 0.3 + 0.7;
            
            ctx.shadowColor = '#ffd700';
            ctx.shadowBlur = 50 * glowIntensity;
            
            // Bulb glass
            ctx.strokeStyle = '#ffd700';
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.arc(bulbX, bulbY, 50, 0, Math.PI * 2);
            ctx.stroke();
            
            // Filament with glow
            ctx.strokeStyle = `rgba(255, 215, 0, ${glowIntensity})`;
            ctx.lineWidth = 4;
            ctx.beginPath();
            for (let i = 0; i < 7; i++) {
                const x = bulbX - 30 + i * 10;
                const y = bulbY + Math.sin(i * 0.8) * 15;
                if (i === 0) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
            }
            ctx.stroke();
            
            ctx.fillStyle = `rgba(255, 215, 0, ${0.2 * glowIntensity})`;
            ctx.beginPath();
            ctx.arc(bulbX, bulbY, 50, 0, Math.PI * 2);
            ctx.fill();
            
            ctx.shadowBlur = 0;
            
            // Draw current flow visualization
            ctx.strokeStyle = '#666';
            ctx.lineWidth = 8;
            ctx.beginPath();
            ctx.moveTo(bulbX - 50, bulbY);
            ctx.lineTo(50, bulbY);
            ctx.lineTo(50, bulbY + 100);
            ctx.lineTo(350, bulbY + 100);
            ctx.lineTo(350, bulbY);
            ctx.lineTo(bulbX + 50, bulbY);
            ctx.stroke();
            
            // Animate electrons for 10 minutes (600 seconds)
            const totalElectrons = 20;
            for (let i = 0; i < totalElectrons; i++) {
                const progress = (time * 0.01 + i / totalElectrons) % 1;
                let x, y;
                
                if (progress < 0.25) {
                    x = bulbX - 50 - progress * 4 * (bulbX - 100);
                    y = bulbY;
                } else if (progress < 0.5) {
                    x = 50;
                    y = bulbY + (progress - 0.25) * 4 * 100;
                } else if (progress < 0.75) {
                    x = 50 + (progress - 0.5) * 4 * 300;
                    y = bulbY + 100;
                } else {
                    x = 350;
                    y = bulbY + 100 - (progress - 0.75) * 4 * 100;
                }
                
                // Electron visualization
                const electronGradient = ctx.createRadialGradient(x, y, 0, x, y, 6);
                electronGradient.addColorStop(0, '#ffff00');
                electronGradient.addColorStop(1, 'rgba(255, 255, 0, 0)');
                ctx.fillStyle = electronGradient;
                ctx.beginPath();
                ctx.arc(x, y, 6, 0, Math.PI * 2);
                ctx.fill();
            }
            
            // Timer visualization
            const clockX = 500;
            const clockY = 200;
            
            ctx.strokeStyle = '#4ecdc4';
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.arc(clockX, clockY, 40, 0, Math.PI * 2);
            ctx.stroke();
            
            // Clock hands
            const minutes = (time * 0.5) % 360;
            const minuteAngle = (minutes - 90) * Math.PI / 180;
            
            ctx.strokeStyle = '#ffffff';
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.moveTo(clockX, clockY);
            ctx.lineTo(clockX + Math.cos(minuteAngle) * 30, clockY + Math.sin(minuteAngle) * 30);
            ctx.stroke();
            
            ctx.fillStyle = '#4ecdc4';
            ctx.font = '16px Arial';
            ctx.fillText('10 min', clockX - 20, clockY + 60);
            
            // Calculation visualization with step-by-step animation
            const step = Math.floor((time / 100) % 4);
            
            ctx.font = 'bold 20px Arial';
            ctx.fillStyle = '#ffffff';
            
            // Given values
            ctx.fillText('Given:', 700, 100);
            ctx.font = '18px Arial';
            ctx.fillStyle = '#4ecdc4';
            ctx.fillText('I = 0.5 A', 720, 130);
            ctx.fillText('t = 10 min = 600 s', 720, 160);
            
            if (step >= 1) {
                // Formula
                ctx.font = 'bold 20px Arial';
                ctx.fillStyle = '#ffffff';
                ctx.fillText('Formula:', 700, 210);
                ctx.font = '18px Arial';
                ctx.fillStyle = '#ffd89b';
                ctx.fillText('Q = I × t', 720, 240);
            }
            
            if (step >= 2) {
                // Substitution
                ctx.font = 'bold 20px Arial';
                ctx.fillStyle = '#ffffff';
                ctx.fillText('Solution:', 700, 290);
                ctx.font = '18px Arial';
                ctx.fillStyle = '#f093fb';
                ctx.fillText('Q = 0.5 A × 600 s', 720, 320);
            }
            
            if (step >= 3) {
                // Answer with highlight
                ctx.font = 'bold 24px Arial';
                ctx.fillStyle = '#ffd89b';
                ctx.shadowColor = '#ffd89b';
                ctx.shadowBlur = 15;
                ctx.fillText('Q = 300 C', 720, 370);
                
                // Visual representation of 300 coulombs
                ctx.font = '16px Arial';
                ctx.shadowBlur = 0;
                ctx.fillStyle = '#4ecdc4';
                ctx.fillText('300 Coulombs = 1.875 × 10²¹ electrons!', 680, 410);
            }
            
            ctx.shadowBlur = 0;
            time++;
        }

        // Main animation loop
        function animate() {
            switch (currentMode) {
                case 'current':
                    animateCurrent();
                    break;
                case 'circuit':
                    animateCircuit();
                    break;
                case 'potential':
                    animatePotential();
                    break;
                case 'wateranalogy':
                    animateWaterAnalogy();
                    break;
                case 'solving':
                    animateSolving();
                    break;
            }
            
            animationFrame = requestAnimationFrame(animate);
        }

        // Reset Function
        function resetEverything() {
            lessonStarted = false;
            
            if (lessonSequence) {
                lessonSequence.stop();
            }
            narrator.stop();
            
            if (animationFrame) {
                cancelAnimationFrame(animationFrame);
            }
            
            // Reset parameters
            time = 0;
            
            // Reset UI
            document.querySelectorAll('.control-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector('[data-mode="lesson"]').classList.add('active');
            
            hideAllPanels();
            document.getElementById('demoCanvas').style.display = 'none';
            document.getElementById('chartContainer').style.display = 'none';
            document.getElementById('lessonContent').style.display = 'block';
            
            currentMode = 'lesson';
            
            // Restart animation
            animate();
        }

        // Event Listeners
        document.addEventListener('DOMContentLoaded', function() {
            // Hide loading screen
            setTimeout(() => {
                document.getElementById('loadingOverlay').classList.add('hidden');
            }, 1500);
            
            lessonSequence = new LessonSequence();
            
            // Control buttons
            document.querySelectorAll('.control-btn:not(.reset-btn)').forEach(btn => {
                btn.addEventListener('click', function() {
                    const mode = this.getAttribute('data-mode');
                    
                    // Stop any running sequences
                    if (lessonSequence) lessonSequence.stop();
                    narrator.stop();
                    
                    currentMode = mode;
                    document.querySelectorAll('.control-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Show/hide elements based on mode
                    hideAllPanels();
                    document.getElementById('lessonContent').style.display = 'none';
                    document.getElementById('chartContainer').style.display = 'none';
                    
                    if (mode === 'lesson') {
                        resetEverything();
                        lessonStarted = true;
                        lessonSequence.start();
                    } else if (mode === 'datachart') {
                        document.getElementById('demoCanvas').style.display = 'none';
                        document.getElementById('chartContainer').style.display = 'block';
                        createDataChart();
                        narrator.speak("This chart shows the relationship between current, charge, and time. Notice how charge accumulates linearly when current is constant. The yellow line shows charge accumulation over time, increasing linearly as Q equals I times t. The cyan line shows constant current of 0.5 amperes, while the pink dashed line shows constant potential difference of 12 volts. This demonstrates how charge builds up when current flows for a specific time period. The mathematical relationships between these quantities are fundamental to understanding electrical circuits and solving problems involving current, charge, time, and voltage.", true);
                    } else {
                        document.getElementById('demoCanvas').style.display = 'block';
                        
                        switch(mode) {
                            case 'current':
                                document.getElementById('currentPanel').style.display = 'block';
                                narrator.speak("Electric current is the rate of flow of charge. Observe how electrons flow through the conductor, creating current in the opposite direction. The yellow glowing particles represent electrons moving through the metallic wire. Notice how the red arrow shows conventional current direction, which is opposite to electron flow. This is because early scientists thought positive charges moved, but we now know electrons carry the charge. The current strength depends on how many electrons pass through a point per second, measured in amperes. One ampere equals one coulomb of charge flowing per second.", true);
                                break;
                            case 'circuit':
                                document.getElementById('currentPanel').style.display = 'block';
                                narrator.speak("A complete circuit needs a source, conductor, and load. Watch how current flows from positive to negative terminal through the circuit components. The battery provides the energy source, creating a potential difference that drives electrons through the circuit. The glowing bulb filament shows electrical energy being converted to light and heat. The ammeter measures the current strength, and the red particles show how charge carriers move through the complete loop. Without a complete circuit, no current flows, which is why switches can turn devices on and off by breaking or completing the circuit path.", true);
                                break;
                            case 'potential':
                                document.getElementById('potentialPanel').style.display = 'block';
                                narrator.speak("Potential difference drives current flow. Higher potential difference means more work done per unit charge, creating stronger current. The positive terminal has high potential energy, while the negative terminal has low potential energy. This difference in potential energy creates an electric field that pushes charges through the circuit. The yellow charge particles show how positive charges move from high to low potential, doing work as they flow through the resistor. The voltmeter measures this potential difference, and the energy lines show work being done as charges move through the circuit.", true);
                                break;
                            case 'wateranalogy':
                                document.getElementById('potentialPanel').style.display = 'block';
                                narrator.speak("Like water flows from high to low pressure, charges flow from high to low potential. This analogy helps visualize electrical concepts. The upper tank represents high potential with high pressure, while the lower tank represents low potential with low pressure. Water flows from high pressure to low pressure through the pipe, just as electric charges flow from high potential to low potential through wires. The blue water droplets show the flow rate, similar to current in electrical circuits. The pressure difference drives the flow, and the pipe resistance affects how fast water flows, just like electrical resistance affects current flow.", true);
                                break;
                            case 'solving':
                                document.getElementById('example1').style.display = 'block';
                                document.getElementById('questions').style.display = 'block';
                                narrator.speak("Let's solve Example 11.1 step by step. Watch how we calculate the charge flowing through a bulb when current and time are known. The glowing bulb shows electrical energy being converted to light and heat. The yellow electrons flow through the circuit, and the clock shows the 10-minute duration. Step by step, we identify the given values, apply the formula Q equals I times t, substitute the values, and calculate the result. This 300 coulombs represents an enormous number of electrons - approximately 1.875 times 10 to the power of 21 electrons flowing through the bulb filament over 10 minutes!", true);
                                break;
                        }
                    }
                    
                    time = 0;
                });
            });
            
            // Reset button
            document.getElementById('resetBtn').addEventListener('click', function() {
                narrator.speak("Resetting lesson to the beginning.", true);
                resetEverything();
            });
            
            // Audio toggle
            document.getElementById('audio-toggle').addEventListener('click', function() {
                audioEnabled = narrator.toggle();
                this.textContent = audioEnabled ? '🔊' : '🔇';
            });
            
            // Start initial display
            document.getElementById('lessonContent').innerHTML = `
                <div class="lesson-section">
                    <h2 class="lesson-title">Welcome to Chapter 11</h2>
                    <div class="lesson-text">
                        <p>Click "Complete Lesson" to start the full guided tour, or choose any specific topic to explore.</p>
                    </div>
                </div>
            `;
            
            // Start animation
            animate();
        });
        
        // Cleanup on page unload
        window.addEventListener('beforeunload', function() {
            narrator.stop();
            if (lessonSequence) lessonSequence.stop();
            if (animationFrame) {
                cancelAnimationFrame(animationFrame);
            }
        });
    </script>
</body>
</html>