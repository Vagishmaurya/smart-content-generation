<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reflection of Sound - Physics in Motion</title>
    <!-- GSAP for animations -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #334155 100%);
            color: white;
            overflow-x: hidden;
            min-height: 100vh;
        }

        /* Audio Control */
        #audio-control {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
        }

        .control-btn {
            background: rgba(59, 130, 246, 0.9);
            border: none;
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .control-btn:hover {
            transform: scale(1.1);
            background: rgba(59, 130, 246, 1);
        }

        .control-btn.muted .unmute-icon { display: none; }
        .control-btn:not(.muted) .mute-icon { display: none; }

        /* Main Container */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 30px 20px;
        }

        /* Header */
        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .header h1 {
            font-size: 3rem;
            background: linear-gradient(45deg, #3b82f6, #8b5cf6, #ec4899);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 15px;
            font-weight: 700;
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.95;
            max-width: 800px;
            margin: 0 auto;
            line-height: 1.6;
        }

        /* Demo Stage */
        .demo-stage {
            background: linear-gradient(to bottom, #1e293b, #334155, #475569);
            border-radius: 25px;
            min-height: 500px;
            position: relative;
            margin: 40px 0;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
            overflow: hidden;
            border: 3px solid rgba(59, 130, 246, 0.4);
            padding: 40px;
        }

        /* Sound Introduction Demo */
        .sound-intro-demo {
            display: none;
            position: relative;
            width: 100%;
            height: 500px;
        }

        .sound-intro-demo.active {
            display: block;
        }

        .reflection-comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            height: 100%;
        }

        .reflection-type {
            background: rgba(15, 23, 42, 0.9);
            border-radius: 20px;
            padding: 25px;
            border: 2px solid rgba(59, 130, 246, 0.3);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
        }

        .reflection-title {
            color: #3b82f6;
            font-size: 1.8rem;
            margin-bottom: 20px;
            font-weight: 600;
        }

        .sound-wave-display {
            width: 100%;
            height: 200px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            position: relative;
            margin: 20px 0;
            overflow: hidden;
        }

        .sound-source {
            position: absolute;
            width: 15px;
            height: 15px;
            background: #f59e0b;
            border-radius: 50%;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
        }

        .reflecting-surface {
            position: absolute;
            width: 5px;
            height: 80%;
            background: #6b7280;
            right: 20px;
            top: 10%;
            border-radius: 3px;
        }

        .incident-wave {
            position: absolute;
            height: 3px;
            background: linear-gradient(to right, #10b981, transparent);
            top: 50%;
            left: 35px;
            width: 0;
            transform: translateY(-50%);
        }

        .reflected-wave {
            position: absolute;
            height: 3px;
            background: linear-gradient(to left, #ef4444, transparent);
            top: 50%;
            right: 35px;
            width: 0;
            transform: translateY(-50%);
        }

        .wave-description {
            line-height: 1.6;
            color: #e2e8f0;
            font-size: 1.1rem;
            margin-top: 15px;
        }

        /* Laws of Reflection Demo */
        .laws-demo {
            display: none;
            position: relative;
            width: 100%;
            height: 500px;
        }

        .laws-demo.active {
            display: block;
        }

        .laws-container {
            display: flex;
            justify-content: space-around;
            align-items: center;
            height: 100%;
        }

        .angle-demonstration {
            background: rgba(15, 23, 42, 0.9);
            padding: 30px;
            border-radius: 20px;
            border: 2px solid rgba(168, 85, 247, 0.4);
            text-align: center;
            min-width: 400px;
            position: relative;
        }

        .angle-title {
            color: #a855f7;
            font-size: 1.5rem;
            margin-bottom: 20px;
            font-weight: 600;
        }

        .angle-diagram {
            width: 300px;
            height: 250px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            position: relative;
            margin: 20px auto;
            overflow: hidden;
        }

        .normal-line {
            position: absolute;
            width: 2px;
            height: 100%;
            background: #fbbf24;
            left: 50%;
            transform: translateX(-50%);
        }

        .surface-line {
            position: absolute;
            width: 100%;
            height: 3px;
            background: #6b7280;
            bottom: 0;
        }

        .incident-ray {
            position: absolute;
            width: 100px;
            height: 2px;
            background: #10b981;
            top: 60px;
            left: 50px;
            transform-origin: right center;
            transform: rotate(30deg);
        }

        .reflected-ray {
            position: absolute;
            width: 100px;
            height: 2px;
            background: #ef4444;
            top: 60px;
            right: 50px;
            transform-origin: left center;
            transform: rotate(-30deg);
        }

        .angle-label {
            position: absolute;
            color: #fbbf24;
            font-size: 0.9rem;
            font-weight: bold;
        }

        .angle-i {
            top: 80px;
            left: 60px;
        }

        .angle-r {
            top: 80px;
            right: 60px;
        }

        .laws-text {
            color: #e2e8f0;
            line-height: 1.8;
            margin-top: 15px;
            font-size: 1.1rem;
        }

        /* Echo Demo */
        .echo-demo {
            display: none;
            position: relative;
            width: 100%;
            height: 500px;
        }

        .echo-demo.active {
            display: block;
        }

        .echo-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 100%;
            gap: 30px;
        }

        .echo-animation {
            background: rgba(15, 23, 42, 0.9);
            padding: 30px;
            border-radius: 20px;
            border: 2px solid rgba(16, 185, 129, 0.4);
            min-width: 400px;
        }

        .echo-title {
            color: #10b981;
            font-size: 1.5rem;
            margin-bottom: 20px;
            font-weight: 600;
            text-align: center;
        }

        .echo-scene {
            width: 100%;
            height: 200px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            position: relative;
            margin: 20px 0;
            overflow: hidden;
        }

        .person {
            position: absolute;
            width: 30px;
            height: 50px;
            background: #f59e0b;
            border-radius: 15px 15px 5px 5px;
            left: 30px;
            bottom: 20px;
        }

        .cliff {
            position: absolute;
            width: 60px;
            height: 120px;
            background: linear-gradient(135deg, #6b7280, #374151);
            right: 20px;
            bottom: 20px;
            clip-path: polygon(0 100%, 100% 100%, 80% 0);
        }

        .echo-wave {
            position: absolute;
            width: 8px;
            height: 8px;
            background: #10b981;
            border-radius: 50%;
            left: 55px;
            bottom: 45px;
            opacity: 0;
        }

        .echo-calculator {
            background: rgba(15, 23, 42, 0.9);
            padding: 30px;
            border-radius: 20px;
            border: 2px solid rgba(59, 130, 246, 0.4);
            min-width: 350px;
        }

        .calc-title {
            color: #3b82f6;
            font-size: 1.5rem;
            margin-bottom: 20px;
            font-weight: 600;
            text-align: center;
        }

        .input-group {
            margin: 15px 0;
        }

        .input-label {
            display: block;
            color: #93c5fd;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .input-field {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid rgba(59, 130, 246, 0.4);
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 1.1rem;
            text-align: center;
        }

        .calc-btn {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            border: none;
            border-radius: 10px;
            color: white;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 15px 0;
        }

        .calc-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(59, 130, 246, 0.4);
        }

        .result-display {
            background: rgba(16, 185, 129, 0.2);
            padding: 15px;
            border-radius: 10px;
            border: 2px solid rgba(16, 185, 129, 0.4);
            text-align: center;
            font-size: 1.2rem;
            font-weight: bold;
            color: #10b981;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Reverberation Demo */
        .reverberation-demo {
            display: none;
            position: relative;
            width: 100%;
            height: 500px;
        }

        .reverberation-demo.active {
            display: block;
        }

        .reverb-comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            height: 100%;
        }

        .reverb-scenario {
            background: rgba(15, 23, 42, 0.9);
            border-radius: 20px;
            padding: 25px;
            border: 2px solid rgba(236, 72, 153, 0.3);
        }

        .reverb-title {
            color: #ec4899;
            font-size: 1.5rem;
            margin-bottom: 20px;
            font-weight: 600;
            text-align: center;
        }

        .hall-visualization {
            width: 100%;
            height: 200px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            position: relative;
            margin: 20px 0;
            overflow: hidden;
        }

        .hall-walls {
            position: absolute;
            width: 100%;
            height: 100%;
            border: 3px solid #6b7280;
            border-radius: 10px;
        }

        .sound-source-hall {
            position: absolute;
            width: 15px;
            height: 15px;
            background: #f59e0b;
            border-radius: 50%;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
        }

        .sound-absorption {
            position: absolute;
            width: 100%;
            height: 20px;
            background: repeating-linear-gradient(
                90deg,
                rgba(239, 68, 68, 0.3),
                rgba(239, 68, 68, 0.3) 5px,
                transparent 5px,
                transparent 10px
            );
            top: 0;
            border-radius: 10px 10px 0 0;
        }

        .reverb-waves {
            position: absolute;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        .reverb-wave {
            position: absolute;
            border: 2px solid #ec4899;
            border-radius: 50%;
            opacity: 0;
        }

        .reverb-description {
            text-align: center;
            color: #e2e8f0;
            margin-top: 15px;
            line-height: 1.6;
        }

        /* Applications Demo */
        .applications-demo {
            display: none;
            position: relative;
            width: 100%;
            height: 500px;
        }

        .applications-demo.active {
            display: block;
        }

        .app-info-overlay {
            background: rgba(15, 23, 42, 0.8);
            border-radius: 15px;
            padding: 15px 20px;
            margin-bottom: 20px;
            backdrop-filter: blur(8px);
            border: 2px solid rgba(59, 130, 246, 0.4);
        }

        .app-info-title {
            color: #3b82f6;
            font-size: 1.3rem;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .app-info-text {
            color: #e2e8f0;
            line-height: 1.5;
            font-size: 1rem;
        }

        .app-type-buttons {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .app-type-btn {
            background: linear-gradient(135deg, #334155, #1e293b);
            color: white;
            border: none;
            padding: 10px 16px;
            border-radius: 30px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            border: 1px solid rgba(59, 130, 246, 0.3);
        }

        .app-type-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(59, 130, 246, 0.3);
        }

        .app-type-btn.active {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            box-shadow: 0 5px 15px rgba(59, 130, 246, 0.4);
        }

        .app-animation-stage {
            position: relative;
            height: 350px;
            background: rgba(15, 23, 42, 0.5);
            border-radius: 15px;
            overflow: hidden;
            border: 2px solid rgba(59, 130, 246, 0.3);
        }

        .app-demo-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            padding: 20px;
            display: flex;
            flex-direction: column;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.5s ease;
        }

        .app-demo-container.active {
            opacity: 1;
            pointer-events: auto;
        }

        /* Megaphone Demo */
        .megaphone-container {
            position: relative;
            height: 200px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            margin-bottom: 20px;
            overflow: hidden;
        }

        .megaphone {
            position: absolute;
            width: 80px;
            height: 30px;
            background: linear-gradient(to right, #374151, #6b7280);
            left: 30px;
            top: 50%;
            transform: translateY(-50%);
            clip-path: polygon(0 20%, 100% 0, 100% 100%, 0 80%);
        }

        .sound-beam {
            position: absolute;
            width: 0;
            height: 40px;
            background: linear-gradient(to right, rgba(16, 185, 129, 0.6), transparent);
            left: 110px;
            top: 50%;
            transform: translateY(-50%);
        }

        /* Stethoscope Demo */
        .stethoscope-container {
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 200px;
            gap: 40px;
        }

        .patient-body {
            width: 80px;
            height: 120px;
            background: rgba(251, 191, 36, 0.3);
            border-radius: 40px 40px 20px 20px;
            position: relative;
            border: 2px solid #fbbf24;
        }

        .heart {
            position: absolute;
            width: 20px;
            height: 18px;
            background: #ef4444;
            border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
            left: 30px;
            top: 30px;
        }

        .stethoscope-emoji {
            font-size: 4rem;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .sound-waves-stethoscope {
            position: absolute;
            width: 30px;
            height: 3px;
            background: linear-gradient(to right, #10b981, transparent);
            left: -40px;
            opacity: 0;
        }

        /* Concert Hall Demo */
        .concert-hall {
            position: relative;
            width: 100%;
            height: 150px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            overflow: hidden;
        }

        .curved-ceiling {
            position: absolute;
            width: 100%;
            height: 40px;
            background: #6b7280;
            top: 0;
            border-radius: 0 0 100px 100px;
        }

        .stage {
            position: absolute;
            width: 60px;
            height: 30px;
            background: #8b5cf6;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
        }

        .sound-source-stage {
            position: absolute;
            width: 8px;
            height: 8px;
            background: #f59e0b;
            border-radius: 50%;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
        }

        .audience-area {
            position: absolute;
            width: 200px;
            height: 20px;
            background: repeating-linear-gradient(
                90deg,
                #374151,
                #374151 10px,
                transparent 10px,
                transparent 15px
            );
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
        }

        .hall-sound-wave {
            position: absolute;
            width: 3px;
            height: 3px;
            background: #10b981;
            border-radius: 50%;
            opacity: 0;
        }

        /* Example Demo */
        .example-demo {
            display: none;
            padding: 15px 10px;
            overflow-x: hidden;
        }

        .example-demo.active {
            display: block;
        }

        .example-container {
            display: flex;
            justify-content: center;
            padding: 10px 0;
        }

        .example-card {
            background: rgba(15, 23, 42, 0.9);
            padding: 20px 15px;
            border-radius: 15px;
            border: 2px solid rgba(59, 130, 246, 0.3);
            width: 98%;
            max-width: 100%;
            margin: 0 auto;
        }

        .example-title {
            color: #3b82f6;
            font-size: 1.5rem;
            margin-bottom: 10px;
            font-weight: 700;
            text-align: center;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.2), rgba(59, 130, 246, 0.05));
            padding: 10px;
            border-radius: 10px;
        }

        .example-problem {
            background: rgba(59, 130, 246, 0.1);
            padding: 15px;
            border-radius: 10px;
            margin: 15px auto;
            border-left: 4px solid #3b82f6;
            line-height: 1.6;
            font-size: 1rem;
            max-width: 95%;
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.2);
        }

        .solution-sections-container {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
            margin: 20px 0;
        }

        .solution-section {
            margin-bottom: 0;
            border: 1px solid rgba(59, 130, 246, 0.3);
            padding: 15px;
            border-radius: 10px;
            background: rgba(0, 0, 0, 0.2);
        }

        .case-title {
            color: #fbbf24;
            font-size: 1.3rem;
            margin-bottom: 15px;
            font-weight: 600;
            text-align: center;
            background: rgba(251, 191, 36, 0.1);
            padding: 8px;
            border-radius: 10px;
            border-left: 4px solid #fbbf24;
        }

        .solution-steps {
            display: flex;
            flex-direction: column;
            gap: 15px;
            max-width: 100%;
            margin: 0 auto;
        }

        .solution-step {
            background: rgba(0, 0, 0, 0.3);
            padding: 12px;
            border-radius: 10px;
            opacity: 1;
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(251, 191, 36, 0.3);
            display: flex;
            flex-direction: column;
        }

        .step-label {
            color: #fbbf24;
            font-weight: bold;
            margin-bottom: 8px;
            font-size: 1rem;
        }

        .step-calculation {
            font-family: 'Courier New', monospace;
            color: #10b981;
            font-size: 1.2rem;
            margin: 8px 0;
            text-align: center;
            background: rgba(16, 185, 129, 0.1);
            padding: 8px;
            border-radius: 6px;
        }

        .final-answer {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.3), rgba(251, 191, 36, 0.3));
            padding: 12px;
            border-radius: 10px;
            margin-top: 15px;
            text-align: center;
            font-weight: bold;
            color: #fbbf24;
            border: 2px solid rgba(251, 191, 36, 0.4);
            font-size: 1.2rem;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }

        /* Activity Demo */
        .activity-demo {
            display: none;
            padding: 30px;
        }

        .activity-demo.active {
            display: block;
        }

        .activity-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin: 30px 0;
        }

        .activity-card {
            background: rgba(59, 130, 246, 0.1);
            padding: 25px;
            border-radius: 15px;
            border: 2px solid rgba(59, 130, 246, 0.3);
            transition: all 0.3s ease;
        }

        .activity-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(59, 130, 246, 0.3);
        }

        .activity-title {
            color: #3b82f6;
            font-size: 1.3rem;
            margin-bottom: 15px;
            font-weight: 600;
        }

        .activity-type {
            background: rgba(251, 191, 36, 0.2);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            border-left: 4px solid #fbbf24;
        }

        .activity-type-title {
            color: #fbbf24;
            font-weight: bold;
            margin-bottom: 8px;
        }

        .activity-example {
            color: #e2e8f0;
            line-height: 1.6;
            font-style: italic;
        }

        /* Questions Demo */
        .questions-demo {
            display: none;
            padding: 30px;
        }

        .questions-demo.active {
            display: block;
        }

        .questions-carousel {
            position: relative;
            max-width: 800px;
            margin: 0 auto;
            overflow: hidden;
        }

        .questions-container {
            display: flex;
            transition: transform 0.5s ease;
            min-height: 400px;
        }

        .question-slide {
            flex: 0 0 100%;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease;
            position: absolute;
            width: 100%;
            left: 0;
            top: 0;
        }

        .question-slide.active {
            opacity: 1;
            visibility: visible;
            position: relative;
        }

        .carousel-nav {
            display: flex;
            justify-content: center;
            margin-top: 20px;
            gap: 15px;
        }

        .carousel-btn {
            background: linear-gradient(135deg, #334155, #1e293b);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 30px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            border: 1px solid rgba(59, 130, 246, 0.3);
        }

        .carousel-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(59, 130, 246, 0.3);
        }

        .carousel-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .carousel-indicator {
            display: flex;
            justify-content: center;
            margin-top: 15px;
            gap: 10px;
        }

        .indicator-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: rgba(59, 130, 246, 0.3);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .indicator-dot.active {
            background: #3b82f6;
            transform: scale(1.2);
        }

        .question-card {
            background: rgba(0, 0, 0, 0.3);
            padding: 25px;
            border-radius: 15px;
            margin: 10px 0;
            border-left: 4px solid #3b82f6;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .question-number {
            color: #3b82f6;
            font-weight: bold;
            font-size: 1.2rem;
            margin-bottom: 10px;
        }

        .question-text {
            font-size: 1.1rem;
            line-height: 1.6;
            margin-bottom: 15px;
            color: #e2e8f0;
        }

        .answer-section {
            background: rgba(59, 130, 246, 0.1);
            padding: 15px;
            margin-top: 5px;
            border-radius: 10px;
            border: 1px solid rgba(59, 130, 246, 0.3);
            opacity: 0;
            transform: translateY(-10px);
            transition: all 0.5s ease;
        }

        .answer-section.show {
            opacity: 1;
            transform: translateY(0);
        }

        .show-answer-btn {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            border: none;
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .show-answer-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(59, 130, 246, 0.4);
        }

        /* Controls */
        .controls {
            text-align: center;
            margin: 40px 0;
        }

        .controls-title {
            font-size: 1.8rem;
            margin-bottom: 25px;
            color: #3b82f6;
            font-weight: 600;
        }

        .demo-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
            margin: 25px 0;
        }

        .demo-btn {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            border: none;
            color: white;
            padding: 14px 24px;
            border-radius: 30px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 8px 20px rgba(59, 130, 246, 0.3);
            min-width: 150px;
        }

        .demo-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 25px rgba(59, 130, 246, 0.4);
        }

        .demo-btn.active {
            background: linear-gradient(135deg, #10b981, #059669);
            box-shadow: 0 8px 20px rgba(16, 185, 129, 0.4);
        }

        /* Theory Section */
        .theory-section {
            background: rgba(15, 23, 42, 0.9);
            border-radius: 25px;
            padding: 35px;
            margin: 35px 0;
            border: 3px solid rgba(59, 130, 246, 0.4);
            backdrop-filter: blur(15px);
        }

        .concept-box {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.2), rgba(147, 197, 253, 0.2));
            padding: 25px;
            border-radius: 20px;
            margin: 20px 0;
            border: 1px solid rgba(59, 130, 246, 0.3);
        }

        .concept-box-title {
            font-size: 1.5rem;
            color: #3b82f6;
            margin-bottom: 15px;
            font-weight: 600;
        }

        .concept-text {
            font-size: 1.1rem;
            line-height: 1.8;
            color: #e2e8f0;
        }

        .formula-highlight {
            background: rgba(251, 191, 36, 0.1);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            margin: 20px 0;
            border: 2px solid rgba(251, 191, 36, 0.3);
        }

        .main-formula {
            font-size: 2rem;
            color: #fbbf24;
            font-family: 'Courier New', monospace;
            margin: 15px 0;
            text-shadow: 0 0 20px rgba(251, 191, 36, 0.5);
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .header h1 { font-size: 2.2rem; }
            .demo-stage { padding: 30px 20px; min-height: 400px; }
            .demo-buttons { flex-direction: column; align-items: center; }
            .reflection-comparison { grid-template-columns: 1fr; }
            .laws-container { flex-direction: column; gap: 20px; }
            .echo-container { flex-direction: column; gap: 20px; }
            .reverb-comparison { grid-template-columns: 1fr; }
            .activity-grid { grid-template-columns: 1fr; }
            .solution-sections-container { grid-template-columns: 1fr; }
        }

        @media (max-width: 480px) {
            .container { padding: 20px 15px; }
            .header h1 { font-size: 1.8rem; }
            .demo-stage { padding: 20px 15px; }
            .theory-section { padding: 20px; }
            .main-formula { font-size: 1.5rem; }
        }
    </style>
</head>
<body>
    <!-- Audio Control -->
    <div id="audio-control">
        <button id="mute-btn" class="control-btn">
            <span class="unmute-icon">ðŸ”Š</span>
            <span class="mute-icon">ðŸ”‡</span>
        </button>
    </div>

    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>Reflection of Sound</h1>
            <p>Explore how sound waves bounce off surfaces, create echoes, and enable amazing applications from stethoscopes to concert halls!</p>
        </div>

        <!-- Demo Stage -->
        <div class="demo-stage" id="stage">
            <!-- Sound Introduction Demo -->
            <div class="sound-intro-demo" id="sound-intro-demo">
                <div class="reflection-comparison">
                    <div class="reflection-type">
                        <div class="reflection-title">Sound Reflection Basics</div>
                        <div class="sound-wave-display">
                            <div class="sound-source"></div>
                            <div class="reflecting-surface"></div>
                            <div class="incident-wave" id="incident-wave-1"></div>
                            <div class="reflected-wave" id="reflected-wave-1"></div>
                        </div>
                        <div class="wave-description">
                            Sound waves travel from source to reflecting surface and bounce back following the laws of reflection.
                            <br><br><strong>Just like light reflection!</strong>
                        </div>
                    </div>

                    <div class="reflection-type">
                        <div class="reflection-title">Multiple Reflections</div>
                        <div class="sound-wave-display">
                            <div class="sound-source"></div>
                            <div class="reflecting-surface"></div>
                            <div class="incident-wave" id="incident-wave-2"></div>
                            <div class="reflected-wave" id="reflected-wave-2"></div>
                        </div>
                        <div class="wave-description">
                            Multiple reflections create echoes and reverberation. This enables many practical applications.
                            <br><br><strong>Nature's acoustic engineering!</strong>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Laws of Reflection Demo -->
            <div class="laws-demo" id="laws-demo">
                <div class="laws-container">
                    <div class="angle-demonstration">
                        <div class="angle-title">Laws of Reflection</div>
                        <div class="angle-diagram">
                            <div class="normal-line"></div>
                            <div class="surface-line"></div>
                            <div class="incident-ray" id="incident-ray"></div>
                            <div class="reflected-ray" id="reflected-ray"></div>
                            <div class="angle-label angle-i" id="angle-i">âˆ i</div>
                            <div class="angle-label angle-r" id="angle-r">âˆ r</div>
                        </div>
                        <div class="laws-text">
                            <strong>1. Angle of incidence = Angle of reflection</strong><br>
                            <strong>2. Incident ray, reflected ray, and normal are in the same plane</strong><br>
                            <strong>3. The reflection occurs at the point of incidence</strong>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Echo Demo -->
            <div class="echo-demo" id="echo-demo">
                <div class="echo-container">
                    <div class="echo-animation">
                        <div class="echo-title">Echo Formation</div>
                        <div class="echo-scene">
                            <div class="person"></div>
                            <div class="cliff"></div>
                            <div class="echo-wave" id="echo-wave"></div>
                        </div>
                        <div class="reverb-description">
                            <strong>Echo:</strong> Reflected sound that reaches the ear after at least 0.1 seconds<br>
                            <strong>Minimum distance:</strong> 17.2 m (at 22Â°C)
                        </div>
                    </div>

                    <div class="echo-calculator">
                        <div class="calc-title">Echo Distance Calculator</div>
                        <div class="input-group">
                            <label class="input-label">Echo Time (seconds):</label>
                            <input type="number" class="input-field" id="echo-time-input" placeholder="Enter time" value="2">
                        </div>
                        <div class="input-group">
                            <label class="input-label">Sound Speed (m/s):</label>
                            <input type="number" class="input-field" id="sound-speed-input" placeholder="Enter speed" value="346">
                        </div>
                        <button class="calc-btn" onclick="calculateEchoDistance()">Calculate Distance</button>
                        <div class="result-display" id="echo-result">
                            Enter values to calculate distance
                        </div>
                    </div>
                </div>
            </div>

            <!-- Reverberation Demo -->
            <div class="reverberation-demo" id="reverberation-demo">
                <div class="reverb-comparison">
                    <div class="reverb-scenario">
                        <div class="reverb-title">Without Sound Absorption</div>
                        <div class="hall-visualization">
                            <div class="hall-walls"></div>
                            <div class="sound-source-hall"></div>
                            <div class="reverb-waves" id="reverb-waves-1"></div>
                        </div>
                        <div class="reverb-description">
                            Sound reflects repeatedly off hard surfaces creating excessive reverberation. This makes speech unclear and music muddy.
                        </div>
                    </div>

                    <div class="reverb-scenario">
                        <div class="reverb-title">With Sound Absorption</div>
                        <div class="hall-visualization">
                            <div class="hall-walls"></div>
                            <div class="sound-absorption"></div>
                            <div class="sound-source-hall"></div>
                            <div class="reverb-waves" id="reverb-waves-2"></div>
                        </div>
                        <div class="reverb-description">
                            Sound-absorbing materials reduce excessive reflections, creating optimal acoustics for clear communication and music.
                        </div>
                    </div>
                </div>
            </div>

            <!-- Applications Demo -->
            <div class="applications-demo" id="applications-demo">
                <div class="app-info-overlay" id="app-info-overlay">
                    <div class="app-info-title" id="app-type-title">Select a reflection application</div>
                    <div class="app-info-text" id="app-info-text">Explore how sound reflection enables amazing technologies and applications</div>
                </div>

                <div class="app-type-buttons">
                    <button class="app-type-btn" id="megaphone-btn" onclick="appTypeTab('megaphone')">Megaphones</button>
                    <button class="app-type-btn" id="stethoscope-btn" onclick="appTypeTab('stethoscope')">Stethoscopes</button>
                    <button class="app-type-btn" id="concert-btn" onclick="appTypeTab('concert')">Concert Halls</button>
                </div>

                <div class="app-animation-stage">
                    <!-- Megaphone Demo -->
                    <div class="app-demo-container" id="megaphone-demo">
                        <div class="megaphone-container">
                            <div class="megaphone"></div>
                            <div class="sound-beam" id="sound-beam"></div>
                        </div>
                        <div class="reverb-description">
                            <strong>Megaphones and Horns:</strong> Conical shape reflects sound waves multiple times, focusing them in a specific direction for maximum amplification.
                        </div>
                    </div>

                    <!-- Stethoscope Demo -->
                    <div class="app-demo-container" id="stethoscope-demo">
                        <div class="stethoscope-container">
                            <div class="patient-body">
                                <div class="heart" id="heart"></div>
                            </div>
                            <div class="stethoscope-emoji">
                                ðŸ©º
                                <div class="sound-waves-stethoscope" id="sound-waves-stethoscope"></div>
                            </div>
                        </div>
                        <div class="reverb-description">
                            <strong>Stethoscope:</strong> Multiple reflections through hollow tubes carry heartbeat sounds directly to doctor's ears without external interference.
                        </div>
                    </div>

                    <!-- Concert Hall Demo -->
                    <div class="app-demo-container" id="concert-demo">
                        <div class="concert-hall">
                            <div class="curved-ceiling" id="curved-ceiling"></div>
                            <div class="stage"></div>
                            <div class="sound-source-stage"></div>
                            <div class="audience-area"></div>
                        </div>
                        <div class="reverb-description">
                            <strong>Concert Hall Design:</strong> Curved ceilings and walls reflect sound evenly to all corners, ensuring every seat receives optimal audio quality.
                        </div>
                    </div>
                </div>
            </div>

            <!-- Example Demo -->
            <div class="example-demo" id="example-demo">
                <div class="example-container">
                    <div class="example-card">
                        <div class="example-title">Echo Distance Problem</div>
                        <div class="example-problem">
                            <strong>Problem:</strong> A person clapped his hands near a cliff and heard the echo after 2 s. What is the distance of the cliff from the person if the speed of sound is 346 m/s?
                        </div>

                        <div class="solution-sections-container">
                            <div class="solution-section">
                                <div class="case-title">Solution</div>
                                <div class="solution-steps">
                                    <div class="solution-step" id="step1">
                                        <div class="step-label">Given:</div>
                                        <div>Time for echo, t = 2 s</div>
                                        <div>Speed of sound, v = 346 m/s</div>
                                        <div>Find: Distance to cliff = ?</div>
                                    </div>
                                    <div class="solution-step" id="step2">
                                        <div class="step-label">Concept:</div>
                                        <div>Sound travels to cliff and back</div>
                                        <div class="step-calculation">Total distance = v Ã— t</div>
                                        <div class="step-calculation">Distance to cliff = (v Ã— t) Ã· 2</div>
                                    </div>
                                    <div class="solution-step" id="step3">
                                        <div class="step-label">Calculation:</div>
                                        <div class="step-calculation">Total distance = 346 Ã— 2 = 692 m</div>
                                        <div class="step-calculation">Distance to cliff = 692 Ã· 2 = 346 m</div>
                                    </div>
                                    <div class="final-answer" id="final-answer">
                                        Distance to cliff = 346 m<br>
                                        <small>Sound traveled 692 m total (there and back)</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Activity Demo -->
            <div class="activity-demo" id="activity-demo">
                <h2 style="color: #3b82f6; text-align: center; margin-bottom: 30px;">Real-World Sound Reflection</h2>
                
                <div class="activity-grid">
                    <div class="activity-card">
                        <div class="activity-title">Communication Devices</div>
                        <div class="activity-type">
                            <div class="activity-type-title">Sound Focusing</div>
                            <div class="activity-example">
                                â€¢ Megaphones and public address systems<br>
                                â€¢ Trumpets and horns in orchestras<br>
                                â€¢ Shehnai and traditional wind instruments<br>
                                â€¢ Emergency sirens and fog horns
                            </div>
                        </div>
                    </div>

                    <div class="activity-card">
                        <div class="activity-title">Medical Applications</div>
                        <div class="activity-type">
                            <div class="activity-type-title">Sound Transmission</div>
                            <div class="activity-example">
                                â€¢ Stethoscopes for heart monitoring<br>
                                â€¢ Acoustic examination techniques<br>
                                â€¢ Diagnostic sound analysis<br>
                                â€¢ Medical communication tubes
                            </div>
                        </div>
                    </div>

                    <div class="activity-card">
                        <div class="activity-title">Architectural Acoustics</div>
                        <div class="activity-type">
                            <div class="activity-type-title">Sound Distribution</div>
                            <div class="activity-example">
                                â€¢ Concert hall ceiling design<br>
                                â€¢ Theater acoustic engineering<br>
                                â€¢ Conference room sound boards<br>
                                â€¢ Auditorium wall treatments
                            </div>
                        </div>
                    </div>

                    <div class="activity-card">
                        <div class="activity-title">Natural Phenomena</div>
                        <div class="activity-type">
                            <div class="activity-type-title">Environmental Acoustics</div>
                            <div class="activity-example">
                                â€¢ Thunder rolling due to multiple reflections<br>
                                â€¢ Mountain and canyon echoes<br>
                                â€¢ Sound focusing in curved structures<br>
                                â€¢ Acoustic shadows and amplification
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Questions Demo -->
            <div class="questions-demo" id="questions-demo">
                <h2 style="color: #3b82f6; text-align: center; margin-bottom: 30px;">Practice Questions</h2>
                
                <div class="questions-carousel">
                    <div class="questions-container">
                        <!-- Question 1 -->
                        <div class="question-slide" id="question-slide-1">
                            <div class="question-card">
                                <div class="question-number">Q1.</div>
                                <div class="question-text" id="question-text-1">
                                    What are the two main laws of reflection of sound? How are they similar to the laws of reflection of light?
                                </div>
                                <button class="show-answer-btn" onclick="showAnswer(1)">Show Answer</button>
                                <div class="answer-section" id="answer-1">
                                    <strong>Answer:</strong><br>
                                    <strong>Laws of Reflection of Sound:</strong><br>
                                    1. The angle of incidence equals the angle of reflection<br>
                                    2. The incident ray, reflected ray, and normal lie in the same plane<br><br>
                                    <strong>Similarity to Light:</strong> Sound follows exactly the same laws of reflection as light, demonstrating that both are wave phenomena with similar behavior at boundaries.
                                </div>
                            </div>
                        </div>
                        
                        <!-- Question 2 -->
                        <div class="question-slide" id="question-slide-2">
                            <div class="question-card">
                                <div class="question-number">Q2.</div>
                                <div class="question-text" id="question-text-2">
                                    Why is the minimum distance for hearing a distinct echo 17.2 m? Calculate this distance if the temperature changes.
                                </div>
                                <button class="show-answer-btn" onclick="showAnswer(2)">Show Answer</button>
                                <div class="answer-section" id="answer-2">
                                    <strong>Answer:</strong><br>
                                    â€¢ The brain retains sound sensation for 0.1 seconds<br>
                                    â€¢ For distinct echo, reflected sound must reach after at least 0.1s<br>
                                    â€¢ At 22Â°C, sound speed = 344 m/s<br>
                                    â€¢ Total distance = 344 Ã— 0.1 = 34.4 m<br>
                                    â€¢ Minimum distance to obstacle = 34.4 Ã· 2 = 17.2 m<br><br>
                                    <strong>Note:</strong> This distance changes with temperature as sound speed varies with temperature.
                                </div>
                            </div>
                        </div>
                        
                        <!-- Question 3 -->
                        <div class="question-slide" id="question-slide-3">
                            <div class="question-card">
                                <div class="question-number">Q3.</div>
                                <div class="question-text" id="question-text-3">
                                    How does a stethoscope work? Explain the role of multiple reflections in its functioning.
                                </div>
                                <button class="show-answer-btn" onclick="showAnswer(3)">Show Answer</button>
                                <div class="answer-section" id="answer-3">
                                    <strong>Answer:</strong><br>
                                    <strong>Stethoscope Working:</strong><br>
                                    â€¢ Chest piece collects heartbeat sounds<br>
                                    â€¢ Sound waves travel through hollow tubes<br>
                                    â€¢ Multiple reflections off tube walls guide sound<br>
                                    â€¢ Sound reaches doctor's ears with minimal loss<br><br>
                                    <strong>Role of Multiple Reflections:</strong> The hollow tubes act as sound guides, with multiple reflections ensuring sound travels efficiently from patient to doctor without external interference.
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Carousel Navigation -->
                    <div class="carousel-nav">
                        <button id="prev-question" class="carousel-btn" disabled>Previous</button>
                        <button id="next-question" class="carousel-btn">Next</button>
                    </div>
                    
                    <!-- Carousel Indicators -->
                    <div class="carousel-indicator">
                        <div class="indicator-dot active" data-slide="0"></div>
                        <div class="indicator-dot" data-slide="1"></div>
                        <div class="indicator-dot" data-slide="2"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Controls -->
        <div class="controls">
            <div class="controls-title" id="demo-title">Explore Sound Reflection</div>
            
            <div class="demo-buttons">
                <button class="demo-btn" onclick="playCompleteLesson()">ðŸ“š Complete Lesson</button>
                <button class="demo-btn" onclick="showSoundIntro()">ðŸ”Š Sound Reflection</button>
                <button class="demo-btn" onclick="showLaws()">ðŸ“ Laws of Reflection</button>
                <button class="demo-btn" onclick="showEcho()">ðŸ”ï¸ Echo Formation</button>
                <button class="demo-btn" onclick="showReverberation()">ðŸ›ï¸ Reverberation</button>
                <button class="demo-btn" onclick="showApplications()">ðŸŽº Applications</button>
                <button class="demo-btn" onclick="showExample()">ðŸ“– NCERT Example</button>
                <button class="demo-btn" onclick="showActivity()">ðŸŽ­ Real-World Uses</button>
                <button class="demo-btn" onclick="showQuestions()">â“ Questions</button>
                <button class="demo-btn" onclick="resetAllClick()">ðŸ”„ Reset</button>
            </div>
        </div>

        <!-- Theory Section -->
        <div class="theory-section">
            <div class="concept-box">
                <div class="concept-box-title">Understanding Sound Reflection</div>
                <div class="concept-text">
                    Sound waves bounce off surfaces just like a ball bounces off a wall. This reflection follows the same laws as light reflection, 
                    creating fascinating phenomena like echoes and enabling practical applications from stethoscopes to concert hall design.
                </div>
            </div>

            <div class="formula-highlight">
                <div class="main-formula">âˆ i = âˆ r</div>
                <div style="margin-top: 15px; line-height: 1.8; color: #e2e8f0;">
                    <strong>Key Law:</strong> Angle of incidence = Angle of reflection<br>
                    <strong>Echo Condition:</strong> Minimum 0.1 second delay for distinct echo<br>
                    <strong>Minimum Distance:</strong> 17.2 m (at 22Â°C) for echo formation
                </div>
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0;">
                <div class="concept-box">
                    <div class="concept-box-title">Echo vs Reverberation</div>
                    <div class="concept-text">
                        â€¢ <strong>Echo:</strong> Distinct reflected sound after 0.1s delay<br>
                        â€¢ <strong>Reverberation:</strong> Multiple reflections creating persistence<br>
                        â€¢ <strong>Control:</strong> Sound-absorbing materials reduce excess reflection<br>
                        â€¢ <strong>Applications:</strong> Both used in acoustic design
                    </div>
                </div>
                <div class="concept-box">
                    <div class="concept-box-title">Practical Applications</div>
                    <div class="concept-text">
                        â€¢ <strong>Megaphones:</strong> Focus sound in specific direction<br>
                        â€¢ <strong>Stethoscopes:</strong> Guide sounds through tubes<br>
                        â€¢ <strong>Concert Halls:</strong> Distribute sound evenly<br>
                        â€¢ <strong>Thunder:</strong> Multiple reflections from clouds
                    </div>
                </div>
            </div>

            <div class="concept-box">
                <div class="concept-box-title">Key Principles</div>
                <div class="concept-text">
                    â€¢ <strong>Large obstacles needed:</strong> Sound wavelength is much larger than light<br>
                    â€¢ <strong>Same plane reflection:</strong> Incident, reflected rays and normal are coplanar<br>
                    â€¢ <strong>Temperature dependence:</strong> Echo distance varies with sound speed<br>
                    â€¢ <strong>Absorption control:</strong> Materials like fibreboard reduce unwanted reflections<br>
                    â€¢ <strong>Multiple uses:</strong> From medical diagnosis to architectural acoustics
                </div>
            </div>
        </div>
    </div>

    <script>
        // Voice Teacher System
        class PhysicsTeacher {
            constructor() {
                this.isEnabled = globalAudioEnabled;
                this.currentUtterance = null;
                this.settings = { rate: 0.9, pitch: 1.0, volume: 0.85 };
                this.isDestroyed = false;
            }

            async speak(text, delay = 0) {
                if (!this.isEnabled || !text || this.isDestroyed) return;
                
                return new Promise((resolve) => {
                    setTimeout(() => {
                        if (this.isDestroyed) {
                            resolve();
                            return;
                        }
                        this.stop();
                        const utterance = new SpeechSynthesisUtterance(text);
                        Object.assign(utterance, this.settings);
                        
                        utterance.onend = resolve;
                        utterance.onerror = resolve;
                        
                        this.currentUtterance = utterance;
                        speechSynthesis.speak(utterance);
                    }, delay);
                });
            }

            stop() {
                speechSynthesis.cancel();
                this.currentUtterance = null;
            }

            destroy() {
                this.isDestroyed = true;
                this.stop();
                this.currentUtterance = null;
                this.settings = null;
            }
        }

        // Global state management
        let globalAudioEnabled = true;
        let currentTeacher = null;
        let isPlaying = false;
        let animationTimeline = null;
        let currentDemoAborted = false;
        let activeAnimations = [];
        let currentRunId = 0;
        let currentTaskId = null;

        // State management functions
        function createNewTimeline() {
            if (animationTimeline) {
                animationTimeline.kill();
                animationTimeline = null;
            }
            activeAnimations.forEach(anim => {
                if (anim) anim.kill();
            });
            activeAnimations = [];
            gsap.killTweensOf("*");
            
            const newTimeline = gsap.timeline();
            animationTimeline = newTimeline;
            return newTimeline;
        }

        function trackAnimation(animation) {
            if (animation) {
                activeAnimations.push(animation);
            }
            return animation;
        }

        function stopCurrentDemo() {
            currentDemoAborted = true;
            currentRunId++;
            
            if (currentTeacher) {
                currentTeacher.destroy();
                currentTeacher = null;
            }
            
            if (animationTimeline) {
                animationTimeline.kill();
                animationTimeline = null;
            }
            
            activeAnimations.forEach(anim => {
                if (anim) anim.kill();
            });
            activeAnimations = [];
            
            gsap.killTweensOf("*");
            
            document.querySelectorAll('.sound-intro-demo, .laws-demo, .echo-demo, .reverberation-demo, .applications-demo, .example-demo, .activity-demo, .questions-demo').forEach(demo => {
                demo.classList.remove('active');
            });
            
            isPlaying = false;
        }

        function shouldContinue(taskId) {
            if (!taskId) {
                return !currentDemoAborted;
            }
            return !currentDemoAborted && currentTaskId === taskId;
        }

        function createNewTeacher(taskId) {
            if (currentTeacher) {
                currentTeacher.destroy();
                currentTeacher = null;
            }
            currentDemoAborted = false;
            
            if (taskId) {
                currentTaskId = taskId;
            }
            currentTeacher = new PhysicsTeacher();
            return currentTeacher;
        }

        // Initialize
        window.addEventListener('load', () => {
            const teacher = createNewTeacher();
            teacher.speak("Welcome to Reflection of Sound! Let's explore how sound waves bounce off surfaces and create echoes, just like light reflection!");
        });

        // Complete Lesson
        async function playCompleteLesson() {
            stopCurrentDemo();
            isPlaying = true;
            setActiveButton(0);
            
            const teacher = createNewTeacher('complete-lesson');
            
            await resetAll();
            await wait(100);
            if (!shouldContinue('complete-lesson')) return;
            
            updateTitle("ðŸ“š Complete Sound Reflection Lesson");
            
            await teacher.speak("Let's begin our complete lesson on Reflection of Sound. We'll understand how sound bounces off surfaces and explore its amazing applications.");
            if (!shouldContinue('complete-lesson')) return;
            
            await showSoundIntroInternal(teacher);
            if (!shouldContinue('complete-lesson')) return;
            
            await wait(2000);
            
            await teacher.speak("Now let's learn about the laws that govern sound reflection.");
            if (!shouldContinue('complete-lesson')) return;
            await showLawsInternal(teacher);
            if (!shouldContinue('complete-lesson')) return;
            
            await wait(2000);
            
            await teacher.speak("Next, let's explore how echoes form and calculate distances.");
            if (!shouldContinue('complete-lesson')) return;
            await showEchoInternal(teacher);
            if (!shouldContinue('complete-lesson')) return;
            
            await wait(2000);
            
            await teacher.speak("Now let's understand reverberation and how to control it.");
            if (!shouldContinue('complete-lesson')) return;
            await showReverberationInternal(teacher);
            if (!shouldContinue('complete-lesson')) return;
            
            await wait(2000);
            
            await teacher.speak("Let's see practical applications of sound reflection in everyday devices.");
            if (!shouldContinue('complete-lesson')) return;
            await showApplicationsInternal(teacher);
            if (!shouldContinue('complete-lesson')) return;
            
            await wait(2000);
            
            await teacher.speak("Finally, let's solve the echo problem from your textbook.");
            if (!shouldContinue('complete-lesson')) return;
            await showExampleInternal(teacher);
            if (!shouldContinue('complete-lesson')) return;
            
            await teacher.speak("Excellent! You now understand how sound reflection creates echoes and enables amazing technologies from stethoscopes to concert halls!");
            
            isPlaying = false;
        }

        // Sound Introduction Demo
        async function showSoundIntro() {
            stopCurrentDemo();
            isPlaying = true;
            setActiveButton(1);
            
            const teacher = createNewTeacher('sound-intro');
            await showSoundIntroInternal(teacher);
            
            isPlaying = false;
        }

        async function showSoundIntroInternal(teacher) {
            await resetAll();
            await wait(50);
            const taskId = currentTaskId;
            if (!shouldContinue(taskId)) return;
            
            updateTitle("ðŸ”Š Understanding Sound Reflection");
            
            document.getElementById('sound-intro-demo').classList.add('active');
            await wait(50);
            if (!shouldContinue(taskId)) return;
            
            await teacher.speak("Sound bounces off solid or liquid surfaces just like a rubber ball bounces off a wall. Let's see how this reflection works!");
            if (!shouldContinue(taskId)) return;
            
            // Animate sound reflection
            startSoundReflection();
            await wait(3000);
            
            await teacher.speak("Sound waves travel from the source to the reflecting surface and bounce back, following the same laws as light reflection!");
            if (!shouldContinue(taskId)) return;
        }

        function startSoundReflection() {
            // First reflection demo
            trackAnimation(gsap.timeline({repeat: -1, repeatDelay: 1})
                .to('#incident-wave-1', {duration: 1.5, width: '60%', ease: "power2.out"})
                .to('#reflected-wave-1', {duration: 1.5, width: '60%', ease: "power2.out"}, 0.5)
                .to(['#incident-wave-1', '#reflected-wave-1'], {duration: 0.5, width: '0%'})
            );

            // Second reflection demo
            trackAnimation(gsap.timeline({repeat: -1, repeatDelay: 1, delay: 0.5})
                .to('#incident-wave-2', {duration: 1.5, width: '60%', ease: "power2.out"})
                .to('#reflected-wave-2', {duration: 1.5, width: '60%', ease: "power2.out"}, 0.5)
                .to(['#incident-wave-2', '#reflected-wave-2'], {duration: 0.5, width: '0%'})
            );
        }

        // Laws of Reflection Demo
        async function showLaws() {
            stopCurrentDemo();
            isPlaying = true;
            setActiveButton(2);
            
            const teacher = createNewTeacher('laws');
            await showLawsInternal(teacher);
            
            isPlaying = false;
        }

        async function showLawsInternal(teacher) {
            await resetAll();
            await wait(50);
            const taskId = currentTaskId;
            if (!shouldContinue(taskId)) return;
            
            updateTitle("ðŸ“ Laws of Sound Reflection");
            
            document.getElementById('laws-demo').classList.add('active');
            await wait(50);
            if (!shouldContinue(taskId)) return;
            
            await teacher.speak("Sound follows the same laws of reflection as light. The angle of incidence equals the angle of reflection, and all rays lie in the same plane.");
            if (!shouldContinue(taskId)) return;
            
            // Animate angle demonstration
            startAngleAnimation();
        }

        function startAngleAnimation() {
            trackAnimation(gsap.timeline({repeat: -1, repeatDelay: 2})
                .to('#incident-ray', {duration: 0.5, opacity: 1, scale: 1.1})
                .to('#reflected-ray', {duration: 0.5, opacity: 1, scale: 1.1})
                .to('#angle-i', {duration: 0.5, scale: 1.2, color: '#fbbf24'})
                .to('#angle-r', {duration: 0.5, scale: 1.2, color: '#fbbf24'}, '-=0.5')
                .to(['#angle-i', '#angle-r'], {duration: 0.5, scale: 1, color: '#fbbf24'})
                .to(['#incident-ray', '#reflected-ray'], {duration: 0.5, opacity: 0.7, scale: 1})
            );
        }

        // Echo Demo
        async function showEcho() {
            stopCurrentDemo();
            isPlaying = true;
            setActiveButton(3);
            
            const teacher = createNewTeacher('echo');
            await showEchoInternal(teacher);
            
            isPlaying = false;
        }

        async function showEchoInternal(teacher) {
            await resetAll();
            await wait(50);
            const taskId = currentTaskId;
            if (!shouldContinue(taskId)) return;
            
            updateTitle("ðŸ”ï¸ Echo Formation");
            
            document.getElementById('echo-demo').classList.add('active');
            await wait(50);
            if (!shouldContinue(taskId)) return;
            
            await teacher.speak("An echo is reflected sound that reaches our ears after at least 0.1 seconds. For distinct echoes, the obstacle must be at least 17.2 meters away.");
            if (!shouldContinue(taskId)) return;
            
            // Animate echo formation
            startEchoAnimation();
        }

        function startEchoAnimation() {
            const echoWave = document.getElementById('echo-wave');
            
            trackAnimation(gsap.timeline({repeat: -1, repeatDelay: 2})
                .set(echoWave, {x: 0, opacity: 1, scale: 1})
                .to(echoWave, {
                    duration: 1.5, 
                    x: 240, // Travel to cliff
                    ease: "power2.out"
                })
                .to(echoWave, {
                    duration: 0.1,
                    scale: 1.5,
                    backgroundColor: '#ef4444' // Color change on reflection
                })
                .to(echoWave, {
                    duration: 1.5, 
                    x: 0, // Return to person
                    scale: 1,
                    backgroundColor: '#10b981',
                    ease: "power2.out"
                })
                .to(echoWave, {duration: 0.5, opacity: 0})
            );
        }

        // Echo Calculator Function
        function calculateEchoDistance() {
            const t = parseFloat(document.getElementById('echo-time-input').value);
            const v = parseFloat(document.getElementById('sound-speed-input').value);
            const resultDiv = document.getElementById('echo-result');
            
            if (isNaN(t) || isNaN(v) || t <= 0 || v <= 0) {
                resultDiv.innerHTML = 'âš ï¸ Please enter valid positive values';
                return;
            }
            
            const totalDistance = v * t;
            const distanceToCliff = totalDistance / 2;
            
            resultDiv.innerHTML = `
                <div>
                    <strong>Distance to cliff:</strong> ${distanceToCliff} m<br>
                    <strong>Total distance traveled:</strong> ${totalDistance} m<br>
                    <small>Sound travels there and back</small>
                </div>
            `;
            
            if (currentTeacher) {
                currentTeacher.speak(`The distance to the cliff is ${distanceToCliff} meters. Sound traveled a total distance of ${totalDistance} meters.`);
            }
        }

        // Reverberation Demo
        async function showReverberation() {
            stopCurrentDemo();
            isPlaying = true;
            setActiveButton(4);
            
            const teacher = createNewTeacher('reverberation');
            await showReverberationInternal(teacher);
            
            isPlaying = false;
        }

        async function showReverberationInternal(teacher) {
            await resetAll();
            await wait(50);
            const taskId = currentTaskId;
            if (!shouldContinue(taskId)) return;
            
            updateTitle("ðŸ›ï¸ Reverberation Control");
            
            document.getElementById('reverberation-demo').classList.add('active');
            await wait(50);
            if (!shouldContinue(taskId)) return;
            
            await teacher.speak("Reverberation is the persistence of sound due to repeated reflections. In auditoriums, we use sound-absorbing materials to control excessive reverberation.");
            if (!shouldContinue(taskId)) return;
            
            // Animate reverberation
            startReverberationAnimation();
        }

        function startReverberationAnimation() {
            // Without absorption - many waves
            const createReverbWave1 = () => {
                const container = document.getElementById('reverb-waves-1');
                const wave = document.createElement('div');
                wave.className = 'reverb-wave';
                wave.style.left = '50%';
                wave.style.top = '50%';
                wave.style.width = '10px';
                wave.style.height = '10px';
                wave.style.marginLeft = '-5px';
                wave.style.marginTop = '-5px';
                container.appendChild(wave);
                
                trackAnimation(gsap.timeline()
                    .to(wave, {duration: 2, width: '150px', height: '150px', marginLeft: '-75px', marginTop: '-75px', opacity: 0.8})
                    .to(wave, {duration: 1, opacity: 0, onComplete: () => wave.remove()})
                );
            };

            // With absorption - fewer, weaker waves
            const createReverbWave2 = () => {
                const container = document.getElementById('reverb-waves-2');
                const wave = document.createElement('div');
                wave.className = 'reverb-wave';
                wave.style.left = '50%';
                wave.style.top = '50%';
                wave.style.width = '10px';
                wave.style.height = '10px';
                wave.style.marginLeft = '-5px';
                wave.style.marginTop = '-5px';
                wave.style.borderColor = 'rgba(236, 72, 153, 0.4)';
                container.appendChild(wave);
                
                trackAnimation(gsap.timeline()
                    .to(wave, {duration: 1.5, width: '100px', height: '100px', marginLeft: '-50px', marginTop: '-50px', opacity: 0.4})
                    .to(wave, {duration: 0.8, opacity: 0, onComplete: () => wave.remove()})
                );
            };

            // Create waves periodically
            const interval1 = setInterval(() => {
                if (currentDemoAborted) {
                    clearInterval(interval1);
                    return;
                }
                createReverbWave1();
            }, 400);

            const interval2 = setInterval(() => {
                if (currentDemoAborted) {
                    clearInterval(interval2);
                    return;
                }
                createReverbWave2();
            }, 600);
        }

        // Applications Demo
        async function showApplications() {
            stopCurrentDemo();
            isPlaying = true;
            setActiveButton(5);
            
            const teacher = createNewTeacher('applications');
            await showApplicationsInternal(teacher);
            
            isPlaying = false;
        }

        async function showApplicationsInternal(teacher) {
            await resetAll();
            await wait(50);
            const taskId = currentTaskId;
            if (!shouldContinue(taskId)) return;
            
            updateTitle("ðŸŽº Sound Reflection Applications");
            
            document.getElementById('applications-demo').classList.add('active');
            await wait(50);
            if (!shouldContinue(taskId)) return;
            
            await teacher.speak("Sound reflection enables amazing applications. Let's explore megaphones, stethoscopes, and concert hall design.");
            if (!shouldContinue(taskId)) return;
            
            await wait(500);
            
            if (taskId === 'complete-lesson') {
                await playApplicationsFrom('all');
            } else {
                playApplicationsFrom('all');
            }
        }

        function appTypeTab(which) {
            currentDemoAborted = true;
            
            setTimeout(() => {
                currentDemoAborted = false;
                
                if (which === 'megaphone') {
                    playApplicationsFrom('megaphone');
                } else if (which === 'stethoscope') {
                    playApplicationsFrom('stethoscope');
                } else if (which === 'concert') {
                    playApplicationsFrom('concert');
                }
            }, 100);
        }

        async function playApplicationsFrom(startType) {
            const localRunId = ++currentRunId;
            
            async function waitForSpeechCompletion(speechPromise) {
                if (speechPromise instanceof Promise) {
                    await speechPromise;
                    await wait(500);
                } else if (currentTeacher && currentTeacher.currentUtterance) {
                    await new Promise(resolve => {
                        const utterance = currentTeacher.currentUtterance;
                        if (utterance) {
                            const originalOnEnd = utterance.onend;
                            utterance.onend = (event) => {
                                if (originalOnEnd) originalOnEnd(event);
                                resolve();
                            };
                        } else {
                            setTimeout(resolve, 1000);
                        }
                    });
                    await wait(500);
                } else {
                    await wait(3000);
                }
                
                return !currentDemoAborted && shouldContinue() && localRunId === currentRunId;
            }
            
            if (startType === 'megaphone' || startType === 'all') {
                const speechPromise = showMegaphoneApplication();
                await wait(2000);
                if (!shouldContinue() || localRunId !== currentRunId) return;
                if (!await waitForSpeechCompletion(speechPromise)) return;
            }
            
            if (startType === 'stethoscope' || startType === 'megaphone' || startType === 'all') {
                const speechPromise = showStethoscopeApplication();
                await wait(2000);
                if (!shouldContinue() || localRunId !== currentRunId) return;
                if (!await waitForSpeechCompletion(speechPromise)) return;
            }
            
            const concertSpeechPromise = showConcertApplication();
            
            if (currentTaskId === 'complete-lesson') {
                await wait(2000);
                if (!shouldContinue() || localRunId !== currentRunId) return;
                await waitForSpeechCompletion(concertSpeechPromise);
            }
        }

        function showMegaphoneApplication() {
            resetApplicationDemos();
            setActiveAppButton("megaphone-btn");
            
            document.getElementById('megaphone-demo').classList.add('active');
            
            document.getElementById('app-type-title').textContent = "Megaphones and Horns";
            document.getElementById('app-info-text').textContent = 
                "Conical shape uses multiple reflections to focus sound waves in a specific direction, amplifying volume without electrical power.";
            
            // Animate sound beam
            const soundBeam = document.getElementById('sound-beam');
            
            trackAnimation(gsap.timeline({repeat: -1, repeatDelay: 0.5})
                .to(soundBeam, {duration: 1.5, width: '150px', ease: "power2.out"})
                .to(soundBeam, {duration: 0.5, width: '0px'})
            );
            
            if (currentTeacher && currentTeacher.speak) {
                return currentTeacher.speak("Megaphones and horns use their conical shape to reflect sound waves multiple times, focusing them in a specific direction for maximum amplification and reach.");
            }
        }

        function showStethoscopeApplication() {
            resetApplicationDemos();
            setActiveAppButton("stethoscope-btn");
            
            document.getElementById('stethoscope-demo').classList.add('active');
            
            document.getElementById('app-type-title').textContent = "Stethoscopes";
            document.getElementById('app-info-text').textContent = 
                "Hollow tubes guide heartbeat sounds through multiple reflections directly to doctor's ears without external interference.";
            
            // Animate heartbeat and sound waves
            const heart = document.getElementById('heart');
            const soundWaves = document.getElementById('sound-waves-stethoscope');
            
            trackAnimation(gsap.timeline({repeat: -1, repeatDelay: 0.5})
                .to(heart, {duration: 0.3, scale: 1.2, backgroundColor: '#dc2626'})
                .to(heart, {duration: 0.3, scale: 1, backgroundColor: '#ef4444'})
                .to(soundWaves, {duration: 0.6, opacity: 1, width: '50px'}, 0)
                .to(soundWaves, {duration: 0.4, opacity: 0, width: '30px'})
            );
            
            if (currentTeacher && currentTeacher.speak) {
                return currentTeacher.speak("Stethoscopes use multiple reflections through hollow tubes to carry heartbeat sounds directly to the doctor's ears, allowing clear medical diagnosis without electronic amplification.");
            }
        }

        function showConcertApplication() {
            resetApplicationDemos();
            setActiveAppButton("concert-btn");
            
            document.getElementById('concert-demo').classList.add('active');
            
            document.getElementById('app-type-title').textContent = "Concert Halls";
            document.getElementById('app-info-text').textContent = 
                "Curved ceilings and walls are designed to reflect sound evenly to all corners, ensuring optimal acoustics for every audience member.";
            
            // Animate ceiling and sound waves
            const ceiling = document.getElementById('curved-ceiling');
            
            // Create sound waves that reflect off ceiling
            const createConcertWave = (angle, targetX) => {
                const concertHall = document.querySelector('#concert-demo .concert-hall');
                const wave = document.createElement('div');
                wave.className = 'hall-sound-wave';
                wave.style.left = '50%';
                wave.style.bottom = '35px';
                wave.style.marginLeft = '-1.5px';
                concertHall.appendChild(wave);
                
                // Calculate reflection point on ceiling
                const reflectionX = targetX * 0.6; // Point on ceiling curve
                
                trackAnimation(gsap.timeline()
                    .to(wave, {
                        duration: 0.8,
                        x: reflectionX,
                        y: 80,
                        opacity: 1,
                        ease: "power2.out"
                    })
                    .to(wave, {
                        duration: 0.8,
                        x: targetX,
                        y: 5,
                        backgroundColor: '#ef4444',
                        ease: "power2.out"
                    })
                    .to(wave, {
                        duration: 0.3,
                        opacity: 0,
                        onComplete: () => wave.remove()
                    })
                );
            };
            
            // Create waves to different audience positions
            const waveInterval = setInterval(() => {
                if (currentDemoAborted) {
                    clearInterval(waveInterval);
                    return;
                }
                createConcertWave(30, -80);  // Left audience
                setTimeout(() => createConcertWave(0, 0), 200);    // Center audience
                setTimeout(() => createConcertWave(-30, 80), 400);  // Right audience
            }, 1500);
            
            trackAnimation(gsap.timeline({repeat: -1, repeatDelay: 1})
                .to(ceiling, {duration: 0.5, backgroundColor: '#9ca3af'})
                .to(ceiling, {duration: 0.5, backgroundColor: '#6b7280'})
            );
            
            if (currentTeacher && currentTeacher.speak) {
                return currentTeacher.speak("Concert halls use curved ceilings and strategic wall placement to reflect sound evenly throughout the space, ensuring every seat receives optimal audio quality for the best musical experience.");
            }
        }

        function resetApplicationDemos() {
            document.querySelectorAll('.app-demo-container').forEach(demo => {
                demo.classList.remove('active');
            });
            
            document.querySelectorAll('.app-type-btn').forEach(btn => {
                btn.classList.remove('active');
            });
        }

        function setActiveAppButton(id) {
            document.querySelectorAll('.app-type-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.getElementById(id).classList.add('active');
        }

        // Example Demo
        async function showExample() {
            stopCurrentDemo();
            isPlaying = true;
            setActiveButton(6);
            
            const teacher = createNewTeacher('example');
            await showExampleInternal(teacher);
            
            isPlaying = false;
        }

        async function showExampleInternal(teacher) {
            await resetAll();
            await wait(50);
            const taskId = currentTaskId;
            if (!shouldContinue(taskId)) return;
            
            updateTitle("ðŸ“– Echo Distance Calculation");
            
            document.getElementById('example-demo').classList.add('active');
            await wait(50);
            if (!shouldContinue(taskId)) return;
            
            await teacher.speak("Let's solve the echo problem from your textbook. A person hears an echo after 2 seconds - we need to find the distance to the cliff.");
            if (!shouldContinue(taskId)) return;
            
            await wait(3000);
            
            await teacher.speak("The answer is 346 meters. Remember, sound travels to the cliff and back, so we divide the total distance by 2!");
        }

        // Activity Demo
        async function showActivity() {
            stopCurrentDemo();
            isPlaying = true;
            setActiveButton(7);
            
            const teacher = createNewTeacher('activity');
            await showActivityInternal(teacher);
            
            isPlaying = false;
        }

        async function showActivityInternal(teacher) {
            await resetAll();
            await wait(50);
            const taskId = currentTaskId;
            if (!shouldContinue(taskId)) return;
            
            updateTitle("ðŸŽ­ Real-World Sound Reflection");
            
            document.getElementById('activity-demo').classList.add('active');
            await wait(50);
            if (!shouldContinue(taskId)) return;
            
            await teacher.speak("Sound reflection is everywhere around us! From communication devices to medical instruments, from architectural acoustics to natural phenomena like thunder.");
            if (!shouldContinue(taskId)) return;
            
            await wait(3500);
            
            await teacher.speak("These applications show how understanding basic physics principles leads to technologies that improve our daily lives!");
        }

        // Questions Demo
        async function showQuestions() {
            stopCurrentDemo();
            isPlaying = true;
            setActiveButton(8);
            
            const teacher = createNewTeacher('questions');
            await showQuestionsInternal(teacher);
            
            isPlaying = false;
        }

        async function showQuestionsInternal(teacher) {
            await resetAll();
            await wait(50);
            const taskId = currentTaskId;
            if (!shouldContinue(taskId)) return;
            
            updateTitle("â“ Practice Questions");
            
            document.getElementById('questions-demo').classList.add('active');
            
            initQuestionsCarousel();
            
            await wait(50);
            if (!shouldContinue(taskId)) return;
            
            await teacher.speak("Test your understanding with practice questions about sound reflection. Click 'Show Answer' to see detailed explanations.");
            if (!shouldContinue(taskId)) return;
            
            const questionText = document.getElementById('question-text-1').textContent.trim();
            await teacher.speak(`Question 1: ${questionText}`);
        }

        // Questions Carousel
        let currentQuestionIndex = 0;
        const totalQuestions = 3;
        
        function initQuestionsCarousel() {
            document.getElementById('question-slide-1').classList.add('active');
            
            document.getElementById('prev-question').addEventListener('click', showPreviousQuestion);
            document.getElementById('next-question').addEventListener('click', showNextQuestion);
            
            document.querySelectorAll('.indicator-dot').forEach((dot, index) => {
                dot.addEventListener('click', () => goToQuestion(index));
            });
        }
        
        function showNextQuestion() {
            if (currentQuestionIndex < totalQuestions - 1) {
                goToQuestion(currentQuestionIndex + 1);
            }
        }
        
        function showPreviousQuestion() {
            if (currentQuestionIndex > 0) {
                goToQuestion(currentQuestionIndex - 1);
            }
        }
        
        function goToQuestion(index) {
            document.querySelectorAll('.question-slide').forEach(slide => {
                slide.classList.remove('active');
            });
            
            document.getElementById(`question-slide-${index + 1}`).classList.add('active');
            
            document.querySelectorAll('.indicator-dot').forEach((dot, i) => {
                dot.classList.toggle('active', i === index);
            });
            
            document.getElementById('prev-question').disabled = index === 0;
            document.getElementById('next-question').disabled = index === totalQuestions - 1;
            
            currentQuestionIndex = index;
            
            if (currentTeacher && currentTeacher.speak) {
                const questionText = document.getElementById(`question-text-${index + 1}`).textContent.trim();
                currentTeacher.speak(`Question ${index + 1}: ${questionText}`);
            }
            
            document.querySelectorAll('.answer-section').forEach(section => {
                section.classList.remove('show');
            });
        }
        
        function showAnswer(questionNumber) {
            const answerSection = document.getElementById(`answer-${questionNumber}`);
            answerSection.classList.add('show');
            
            if (currentTeacher) {
                const answers = {
                    1: "Sound follows the same laws of reflection as light: angle of incidence equals angle of reflection, and all rays lie in the same plane.",
                    2: "The minimum distance is 17.2 meters because our brain retains sound for 0.1 seconds, and sound must travel there and back in that time.",
                    3: "Stethoscopes use multiple reflections through hollow tubes to guide heartbeat sounds directly to the doctor's ears without interference."
                };
                currentTeacher.speak(answers[questionNumber]);
            }
        }

        // Helper Functions
        async function resetAll() {
            if (animationTimeline) {
                animationTimeline.kill();
                animationTimeline = null;
            }
            gsap.killTweensOf("*");
            
            activeAnimations.forEach(anim => {
                if (anim) anim.kill();
            });
            activeAnimations = [];
            
            if (currentTeacher) {
                currentTeacher.stop();
            }
            
            document.querySelectorAll('.sound-intro-demo, .laws-demo, .echo-demo, .reverberation-demo, .applications-demo, .example-demo, .activity-demo, .questions-demo').forEach(demo => {
                demo.classList.remove('active');
            });
            
            updateTitle("Explore Sound Reflection");
            
            // Reset calculator
            document.getElementById('echo-time-input').value = '2';
            document.getElementById('sound-speed-input').value = '346';
            document.getElementById('echo-result').innerHTML = 'Enter values to calculate distance';
            
            // Reset wave animations
            gsap.set(['#incident-wave-1', '#reflected-wave-1', '#incident-wave-2', '#reflected-wave-2'], { width: '0%' });
            gsap.set(['#incident-ray', '#reflected-ray'], { opacity: 0.7, scale: 1 });
            gsap.set(['#angle-i', '#angle-r'], { scale: 1, color: '#fbbf24' });
            
            // Reset application demos
            resetApplicationDemos();
            
            // Reset example steps
            document.querySelectorAll('.solution-step').forEach(step => {
                step.classList.add('show');
                gsap.set(step, { opacity: 1, scale: 1 });
            });
            
            document.querySelectorAll('.final-answer').forEach(answer => {
                gsap.set(answer, { opacity: 1, scale: 1 });
            });
            
            // Reset answer sections
            document.querySelectorAll('.answer-section').forEach(section => {
                section.classList.remove('show');
            });
            
            // Reset questions carousel
            currentQuestionIndex = 0;
            document.querySelectorAll('.question-slide').forEach((slide, index) => {
                slide.classList.toggle('active', index === 0);
            });
            document.querySelectorAll('.indicator-dot').forEach((dot, index) => {
                dot.classList.toggle('active', index === 0);
            });
            
            await wait(500);
        }

        function updateTitle(title) {
            document.getElementById('demo-title').textContent = title;
        }

        function setActiveButton(index) {
            document.querySelectorAll('.demo-btn').forEach((btn, i) => {
                btn.classList.toggle('active', i === index);
            });
        }

        function wait(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        async function resetAllClick() {
            stopCurrentDemo();
            isPlaying = false;
            await resetAll();
        }

        // Audio Control
        document.getElementById('mute-btn').addEventListener('click', () => {
            globalAudioEnabled = !globalAudioEnabled;
            document.getElementById('mute-btn').classList.toggle('muted', !globalAudioEnabled);
            
            if (!globalAudioEnabled && currentTeacher) {
                currentTeacher.stop();
            }
        });

        // Enter key support for calculator
        ['echo-time-input', 'sound-speed-input'].forEach(id => {
            document.getElementById(id).addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    calculateEchoDistance();
                }
            });
        });
    </script>
</body>
</html>